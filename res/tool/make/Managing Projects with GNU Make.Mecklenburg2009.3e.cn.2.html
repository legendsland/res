<!DOCTYPE html><html class="translated-ltr" style=""><!--
 Page saved with SingleFile 
 url: file:///home/zy/ws/res/res/tool/make/Managing%20Projects%20with%20GNU%20Make.Mecklenburg2009.html 
 saved date: Mon Apr 29 2024 21:16:46 GMT+0800 (Hong Kong Standard Time)
--><head>
<meta name="dc.identifier" content="res/78d22652ffd0b9e4a61705f858c5b7b918e44564">
<meta charset="utf-8">


<title>Managing Projects with GNU Make.Mecklenburg2009.3e</title>
<style></style>
<style>@page{margin-left:8px;margin-right:8px}p{margin-top:10px;margin-bottom:10px}em{font-style:italic;font-family:serif}strong{font-weight:bold;font-family:serif}code em,em code,pre em{font-family:monospace;font-style:italic}strong code,pre strong{font-family:monospace;font-weight:bold}code{font-family:"DejaVu Sans Mono",monospace}h1,h2,h3,h4{text-align:left;page-break-inside:avoid;page-break-after:avoid;font-weight:bold;display:block;font-family:sans-serif}.title{font-family:sans-serif;font-weight:bold}h1{font-size:1.5em;color:#000033}h2{font-size:1.3em;color:#000080}h3{font-size:1.1em;color:#00009C}img{max-width:100%;margin:auto}.figure-contents{page-break-after:avoid;page-break-inside:avoid;padding-bottom:0.10em}.figure{background:#F5F5F5;page-break-inside:avoid;padding:5px;text-align:center}.figure .title{page-break-before:avoid;margin:0;text-align:center;font-weight:normal;font-style:italic;font-family:serif}pre{white-space:pre-wrap;font-family:"DejaVu Sans Mono",monospace;font-size:85%;margin-left:1.5em;margin-bottom:10px}.book .titlepage .title{font-size:2em;text-align:center}.author h3{font-family:serif;font-size:1.7em;font-style:italic;text-align:center}.editor h3,.editor h4{color:black;margin:10px 0 10px 0;font-weight:normal;font-style:normal;font-size:1em;font-family:serif}dd{margin-left:1.5em}ol{margin-left:1em;padding-left:1em;list-style-type:decimal}ul{margin-left:1em;padding-left:1em;list-style:square outside}.simplelist{margin-left:1.5em;margin-top:0;width:100%}.simplelist td{border:none;font-size:medium;padding:0}.example .title{font-weight:normal;font-style:italic;font-family:serif;page-break-after:avoid}.example{background-color:#F5F5F5}.note{width:95%;margin:10px 10px 10px 5px;page-break-inside:avoid;border:dashed black 1px;background-color:#F5F5F5}.note>*{padding-left:5px;padding-right:5px}.note h3{text-align:left!important;page-break-after:avoid}.tip h3:after,.note h3:after{content:" âœŽ"}table{margin-top:0.5em;max-width:100%;border-collapse:collapse;border-spacing:0}th{color:black;background-color:#F5F5F5;border:black 1px solid;font-weight:bold;font-family:sans-serif;font-size:smaller;padding:0.2em;margin:0;text-align:left}td{border:black 1px solid;padding:0.2em;margin:0;border-spacing:0;font-size:smaller}.table .title{font-size:medium;font-weight:normal;font-style:italic;font-family:serif;page-break-after:avoid;margin-bottom:0.50em}table code{font-size:x-small}code.function{color:rgb(0,128,0)}@font-face{font-family:"DejaVu Serif";font-style:normal;font-weight:normal;src:}@font-face{font-family:"DejaVu Sans Mono";font-weight:normal;font-style:normal;src:}body{font-family:"DejaVu Serif",serif;margin:0;padding:0;text-align:left}</style>
<style></style>
<style>@-webkit-keyframes spinner-rotator{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(270deg);transform:rotate(270deg)}}@keyframes spinner-rotator{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(270deg);transform:rotate(270deg)}}@-webkit-keyframes spinner-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;-webkit-transform:rotate(135deg);transform:rotate(135deg)}100%{stroke-dashoffset:187;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}@keyframes spinner-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;-webkit-transform:rotate(135deg);transform:rotate(135deg)}100%{stroke-dashoffset:187;-webkit-transform:rotate(450deg);transform:rotate(450deg)}}.VIpgJd-yAWNEb-L7lbkb div,.VIpgJd-yAWNEb-L7lbkb span,.VIpgJd-yAWNEb-L7lbkb iframe,.VIpgJd-yAWNEb-L7lbkb img,.VIpgJd-yAWNEb-L7lbkb form{margin:0;padding:0;border:0;font:inherit;font-size:100%;vertical-align:baseline;text-align:left;line-height:normal}.VIpgJd-yAWNEb-L7lbkb{color:#222;background-color:#fff;border:1px solid #eee;box-shadow:0 4px 16px rgba(0,0,0,.2);-moz-box-shadow:0 4px 16px rgba(0,0,0,.2);-webkit-box-shadow:0 4px 16px rgba(0,0,0,.2);display:none;font-size:10pt;width:420px;position:absolute;z-index:10000}.VIpgJd-yAWNEb-L7lbkb .VIpgJd-yAWNEb-nVMfcd-fmcmS{clear:both;position:relative}.VIpgJd-yAWNEb-L7lbkb span:focus{outline:none}.VIpgJd-yAWNEb-hvhgNd{font-family:"Google Sans",Arial,sans-serif}.VIpgJd-yAWNEb-hvhgNd .VIpgJd-yAWNEb-hvhgNd-l4eHX-i3jM8c{position:absolute;top:10px;left:14px}.VIpgJd-yAWNEb-hvhgNd .VIpgJd-yAWNEb-hvhgNd-k77Iif-i3jM8c{margin:16px;padding:0}.VIpgJd-yAWNEb-hvhgNd .VIpgJd-yAWNEb-hvhgNd-IuizWc{margin:0 0 0 36px;padding:0;color:#747775;font-size:14px;font-weight:500}.VIpgJd-yAWNEb-hvhgNd .VIpgJd-yAWNEb-hvhgNd-axAV1{width:auto;padding:12px 0 0;color:#1f1f1f;font-size:16px;text-align:initial}.VIpgJd-yAWNEb-hvhgNd .VIpgJd-yAWNEb-hvhgNd-N7Eqid{border-radius:0 0 12px 12px;margin:0;background:#f1f4f9;position:relative;min-height:50px}.VIpgJd-yAWNEb-hvhgNd .VIpgJd-yAWNEb-hvhgNd-N7Eqid-B7I4Od{display:inline-block;width:77%;padding:12px}.VIpgJd-yAWNEb-hvhgNd .VIpgJd-yAWNEb-hvhgNd-UTujCb{color:#1f1f1f;font-size:12px;font-weight:500}.VIpgJd-yAWNEb-hvhgNd .VIpgJd-yAWNEb-hvhgNd-eO9mKe{color:#444746;font-size:12px;padding-top:4px}.VIpgJd-yAWNEb-hvhgNd .VIpgJd-yAWNEb-hvhgNd-xgov5{position:absolute;top:10px;right:5px}.VIpgJd-yAWNEb-hvhgNd .VIpgJd-yAWNEb-hvhgNd-THI6Vb{fill:#0b57d0}.VIpgJd-yAWNEb-hvhgNd .VIpgJd-yAWNEb-hvhgNd-bgm6sf{margin:-4px 2px 0 0;padding:2px 0 0;width:48px;height:48px;border:none;border-radius:24px;cursor:pointer;background:none}.VIpgJd-yAWNEb-hvhgNd .VIpgJd-yAWNEb-hvhgNd-bgm6sf:hover{background:#e8ebec}.VIpgJd-yAWNEb-hvhgNd .VIpgJd-yAWNEb-hvhgNd-aXYTce{display:none}</style><meta name="referrer" content="no-referrer"><link type="image/x-icon" rel="shortcut icon" href="data:application/octet-stream;base64,"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style><link id="res-style" rel="stylesheet" href="/res/dist/res/style.css" type="text/css">
</head>
<body>
<div id="book-container"><div id="OEBPS/cover.html"><div>

    <div id="OEBPS/cover.html.cover-image">
      <img src="data:image/jpg;base64,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9FAFH+yLQ3sF86GS8ggaCOdzllViC3tklRz7VRsfCunWM2oyBrib+0sm7W4lMiynbtyQenyjGBxityigDF0nwxY6PHFHDLdzRW4xbx3Nw0qwKBgBQfQcAnJA71DF4O0qC+nnjN0sFxKZ5bIXDfZ2kJyWMfTk8kdCecV0FFAGPc+F9Ivf7W+1WvnDVUSO7DsSGVV2qB/dxyeO5z1qu/g3SporVJ/tEzW9wLnzGmIeWQR+XlyMbvk4569810FFAGHP4V0+XV31OJ7q1nljWOcWtw0Szqv3QwHoCQCMHHGaty6JYS3WnXDQYbTizWyqSFQsu0nb0JwSBnpk1o0UAZQ8O6eNfm1orI13LHHGwaQlPk3bSF6ZG48+9Ry+GNOmint5BMbK4laaa08wiKRmOWyByQTklc4OTxzWzRQBk6h4dsNSu9PuZhMj2BfyPJlMYAZdrA7e2OKSDw1plvrUmqxxOLh4o4tvmHy1VM7cJ0BG48+9a9FAGUmlrpGn6kdIhQ3dy8t0BM5KyTsONx6gZCj2A4rkf7H3ac+pQ3Wt2PiWWMSTi3VlEk4XGGhwYmGQBn0/i716HRQBW043Z0y1N+sa3hhTzxF90SYG7HtnNWaKKACiiigAooooAKwrj/j5l/3z/Ot2sK4/4+Zf98/zoA2bf/j2i/3B/KpKjt/+PaL/AHB/KpKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigArCuP8Aj5l/3z/Ot2sK4/4+Zf8AfP8AOgDZt/8Aj2i/3B/KpKjt/wDj2i/3B/KpKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigArCuP+PmX/fP863awrj/j5l/3z/OgDVt54Rbx/vU+4P4h6VJ9oh/56x/99CiigA+0Q/8APWP/AL6FH2iH/nrH/wB9CiigA+0Q/wDPWP8A76FH2iH/AJ6x/wDfQoooAPtEP/PWP/voUfaIf+esf/fQoooAPtEP/PWP/voUfaIf+esf/fQoooAPtEP/AD1j/wC+hR9oh/56x/8AfQoooAPtEP8Az1j/AO+hR9oh/wCesf8A30KKKAD7RD/z1j/76FH2iH/nrH/30KKKAD7RD/z1j/76FH2iH/nrH/30KKKAD7RD/wA9Y/8AvoUfaIf+esf/AH0KKKAD7RD/AM9Y/wDvoUfaIf8AnrH/AN9CiigA+0Q/89Y/++hR9oh/56x/99CiigA+0Q/89Y/++hR9oh/56x/99CiigA+0Q/8APWP/AL6FH2iH/nrH/wB9CiigA+0Q/wDPWP8A76FH2iH/AJ6x/wDfQoooAPtEP/PWP/voUfaIf+esf/fQoooAPtEP/PWP/voUfaIf+esf/fQoooAPtEP/AD1j/wC+hR9oh/56x/8AfQoooAPtEP8Az1j/AO+hR9oh/wCesf8A30KKKAD7RD/z1j/76FH2iH/nrH/30KKKAD7RD/z1j/76FH2iH/nrH/30KKKAD7RD/wA9Y/8AvoUfaIf+esf/AH0KKKAD7RD/AM9Y/wDvoUfaIf8AnrH/AN9CiigA+0Q/89Y/++hR9oh/56x/99CiigA+0Q/89Y/++hR9oh/56x/99CiigA+0Q/8APWP/AL6FH2iH/nrH/wB9CiigA+0Q/wDPWP8A76FH2iH/AJ6x/wDfQoooAPtEP/PWP/voUfaIf+esf/fQoooAPtEP/PWP/voUfaIf+esf/fQoooAPtEP/AD1j/wC+hR9oh/56x/8AfQoooAPtEP8Az1j/AO+hR9oh/wCesf8A30KKKAD7RD/z1j/76FH2iH/nrH/30KKKAD7RD/z1j/76FH2iH/nrH/30KKKAD7RD/wA9Y/8AvoUfaIf+esf/AH0KKKAD7RD/AM9Y/wDvoUfaIf8AnrH/AN9CiigA+0Q/89Y/++hR9oh/56x/99CiigA+0Q/89Y/++hR9oh/56x/99CiigA+0Q/8APWP/AL6FH2iH/nrH/wB9CiigA+0Q/wDPWP8A76FH2iH/AJ6x/wDfQoooAPtEP/PWP/voUfaIf+esf/fQoooAPtEP/PWP/voUfaIf+esf/fQoooAPtEP/AD1j/wC+hR9oh/56x/8AfQoooAPtEP8Az1j/AO+hR9oh/wCesf8A30KKKAD7RD/z1j/76FH2iH/nrH/30KKKAD7RD/z1j/76FH2iH/nrH/30KKKAD7RD/wA9Y/8AvoUfaIf+esf/AH0KKKAD7RD/AM9Y/wDvoUfaIf8AnrH/AN9CiigA+0Q/89Y/++hWHPLGbiX94n3z/EPWiigD/9k=" alt="ä½¿ç”¨ GNU Make ç®¡ç†é¡¹ç›®ï¼Œç¬¬ä¸‰ç‰ˆ">
    </div>
  </div></div>
<div id="OEBPS/index.html"><div>
<div class="book" title="ä½¿ç”¨ GNU Make ç®¡ç†é¡¹ç›®ï¼Œç¬¬ä¸‰ç‰ˆ"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/index.html.I__tt2"></a>ä½¿ç”¨ GNU Make ç®¡ç†é¡¹ç›®ï¼Œç¬¬ä¸‰ç‰ˆ</h1><h1 class="title"><a></a>Managing Projects with GNU Make, 3rd Edition</h1></div><div><div class="author"><h3 class="author"><span class="firstname">ç½—ä¼¯ç‰¹Â·æ¢…å…‹ä¼¦å ¡</span></h3><h3 class="author"><span class="firstname">Robert Mecklenburg</span></h3></div></div><div class="editor"><h4>ç¼–è¾‘</h4><h4>Editor</h4><h3 class="editor"><span class="firstname">å®‰è¿ªÂ·å¥¥æ‹‰å§†</span></h3><h3 class="editor"><span class="firstname">Andy Oram</span></h3></div><div><p class="copyright">ç‰ˆæƒæ‰€æœ‰ Â© 2009 O'Reilly Media, Inc.</p><p class="copyright">Copyright Â© 2009 O'Reilly Media, Inc.</p></div><div><div class="legalnotice" title="æ³•å¾‹å£°æ˜Ž"><a id="OEBPS/index.html.id3049770"></a><p><span class="inlinemediaobject"><img src="data:image/gif;base64,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PXLnvnhUoOtxaW1TLJAGw1oh1dwzsFG9yzVPW8DCJkkFiCkdA6QmI7OGDgekvOiDHJpZj261qadtY2sr9iPRJslllYSRA1Pp201ltkCMyL6lSvvdcP10lU+N7egM9yPFhg4GcpuQDcT3HyS4p76bTR566vnMp273rwHOajOXxNkemkCtB5KATW8Y46n/Lt/XuFhqT7N74gxZMUbibdCH86UDA+BuAi5gW+gkD+XVfkiSodNpgrQcxKe+tYoLjRHhogRwHeLAwwhAAQvUBgPcZs+X1x30hzC2ecwtVM+wSdOeF2pf3jVjdz1+EpN79+AX0fhD9IfdyyrqjLnUqEN31aq0QwfvUGb7SSgw1l0ZAPASL/dC7E3LwHu3ZxP2e9/9jrS1N34lCTA7nxww8mUr/m003jflIS9p786Q8pXXrQ1boqfdxprHn0/3dC41kLDzifRopva6Ju93xNcewy4ZAEn5ZAAHHBvo5KNIwodqeywhfqboWhXv017Wi8MkARagGIkkYF+UyD0iHjxyYfOnhPukU376jzcqzNQa8ZqcBqwtAwFuBsBwutj//vjPv/73z//++///ABiAAjiABFiABniACJiACriADNiADviAEBiBEjiBFFiBFniBGJiBGriBHNiBHviBIBiCIsgRAQEAOw==" alt=""></span></p><p><span class="inlinemediaobject"></span></p></div></div>å¥¥èŽ±åˆ©åª’ä½“</div><hr></div></div></div></div>
<div id="OEBPS/examples_page.html"><div>
<div class="preface" title="å…³äºŽè¡¥å……æ–‡ä»¶çš„æ³¨æ„äº‹é¡¹"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/examples_page.html.id3071145"></a>å…³äºŽè¡¥å……æ–‡ä»¶çš„æ³¨æ„äº‹é¡¹</h1><h1 class="title"><a></a>A Note Regarding Supplemental Files</h1></div></div></div><p>æœ¬ä¹¦çš„è¡¥å……æ–‡ä»¶å’Œç¤ºä¾‹å¯ä»¥åœ¨<a class="ulink" href="http://examples.oreilly.com/9780596006105/">http://examples.oreilly.com/9780596006105/</a>æ‰¾åˆ°ã€‚è¯·ä½¿ç”¨æ ‡å‡†æ¡Œé¢ç½‘ç»œæµè§ˆå™¨è®¿é—®è¿™äº›æ–‡ä»¶ï¼Œå› ä¸ºå¯èƒ½æ— æ³•ä»Žæ‰€æœ‰ç”µå­é˜…è¯»å™¨è®¾å¤‡è®¿é—®è¿™äº›æ–‡ä»¶ã€‚</p><p>Supplemental files and examples for this book can be found at <a class="ulink" href="http://examples.oreilly.com/9780596006105/">http://examples.oreilly.com/9780596006105/</a>. Please use a standard desktop web browser to access these files, as they may not be accessible from all ereader devices.</p><p>ä¹¦ä¸­å¼•ç”¨çš„æ‰€æœ‰ä»£ç æ–‡ä»¶æˆ–ç¤ºä¾‹éƒ½å¯ä»¥åœ¨çº¿èŽ·å–ã€‚å¯¹äºŽé™„å¸¦å…‰ç›˜çš„å®žä½“ä¹¦ï¼Œæˆ‘ä»¬å°½å¯èƒ½å‘å¸ƒæ‰€æœ‰ CD/DVD å†…å®¹ã€‚è¯·æ³¨æ„ï¼Œè™½ç„¶æˆ‘ä»¬é€šè¿‡å…è´¹ä¸‹è½½æä¾›å°½å¯èƒ½å¤šçš„åª’ä½“å†…å®¹ï¼Œä½†æˆ‘ä»¬æœ‰æ—¶ä¼šå—åˆ°è®¸å¯é™åˆ¶ã€‚å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–ç–‘è™‘ï¼Œè¯·å‘é€è‡³<span class="email"><a class="email" href="#OEBPS/mailto:booktech@oreilly.com">booktech@oreilly.com</a></span>ã€‚</p><p>All code files or examples referenced in the book will be available online. For physical books that ship with an accompanying disc, whenever possible, weâ€™ve posted all CD/DVD content. Note that while we provide as much of the media content as we are able via free download, we are sometimes limited by licensing restrictions. Please direct any questions or concerns to <span class="email"><a class="email" href="#OEBPS/mailto:booktech@oreilly.com">booktech@oreilly.com</a></span>.</p></div></div></div>
<div id="OEBPS/pr02.html"><div>
<div class="preface" title="å‰è¨€"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/pr02.html.make3-PREFACE-2"></a>å‰è¨€</h1><h1 class="title"><a></a>Foreword</h1></div></div></div><p>make<em class="command">å®žç”¨</em>ç¨‹åºæ˜¯ä¸€ä¸ªè¯±äººçš„ä»†äººï¼Œæ€»æ˜¯åœ¨é‚£é‡Œå¹¶ä¸”æ€»æ˜¯ä¹äºŽåŠ©äººã€‚å°±åƒè®¸å¤šå°è¯´å’Œç”µå½±ä¸­ä¸å¯æˆ–ç¼ºçš„åŠ©æ‰‹ä¸€æ ·ï¼Œ<em class="command">make</em>ä¸€å¼€å§‹åªæ˜¯ä¸€ä¸ªä¸å—é‡è§†çš„æ³æ±‚è€…ï¼Œä½ å¯ä»¥ç»™ä»–åšä¸€äº›é›¶å·¥ï¼Œç„¶åŽé€æ¸æŽ¥ç®¡æ•´ä¸ªä¼ä¸šã€‚</p><p>The <em class="command">make</em> utility is an enticing
    servant, always there and always accommodating. Like the indispensable
    sidekicks found in many novels and movies, <em class="command">make</em> starts out as the underappreciated
    supplicant to whom you throw a few odd jobs, and then gradually takes over
    the entire enterprise.</p><p>å½“æˆ‘çš„å¯¼å¸ˆã€O'Reilly ç»å…¸è‘—ä½œã€Š<span class="emphasis"><em>Managing Projects with make</em></span>ã€‹çš„ä½œè€… Steve Talbott æ³¨æ„åˆ°æˆ‘çš„ç—´è¿·å¹¶è¦æ±‚æˆ‘ç¼–å†™ç¬¬äºŒç‰ˆæ—¶ï¼Œæˆ‘å·²ç»åˆ°äº†å°†<em class="command">make</em>ç½®äºŽæˆ‘æŽ¥è§¦çš„æ¯ä¸ªé¡¹ç›®ä¸­å¿ƒçš„æœ€åŽé˜¶æ®µã€‚äº‹å®žè¯æ˜Žï¼Œè¿™å¯¹æˆ‘æ¥è¯´æ˜¯ä¸€æ¬¡é‡è¦çš„æˆé•¿ç»åŽ†ï¼ˆä¹Ÿæ˜¯ä¸€æ¬¡ç›¸å½“ç‹‚é‡Žçš„æ—…ç¨‹ï¼‰ï¼Œä¹Ÿæ˜¯æˆ‘è¿›å…¥ O'Reilly å¥‡å¦™ä¸–ç•Œçš„æœºä¼šï¼Œä½†æˆ‘ä»¬å¹¶æ²¡æœ‰çœŸæ­£è€ƒè™‘è¿‡ç»“æžœä¼šåœ¨å¸‚åœºä¸Šåœç•™å¤šä¹…ã€‚ä¸€ç‰ˆåä¸‰å¹´ï¼Ÿ<span class="emphasis"><em></em></span></p><p>I had reached the terminal stage of putting <em class="command">make</em> at the center of every project I touched
    when Steve Talbott, my supervisor and the author of the original O'Reilly
    classic <span class="emphasis"><em>Managing Projects with make</em></span>, noticed my
    obsession and asked me to write the second edition. It proved to be a key
    growth experience for me (as well as a pretty wild ride) and my entry into
    the wonderful world of O'Reilly, but we didn't really think about how long
    the result would stay on the market. Thirteen years for one
    edition?</p><p>å½“æˆ‘è¿˜æ˜¯ä¸€åä¸“ä¸šæŠ€æœ¯ä½œå®¶æ—¶ï¼Œæˆ‘æ·±æ·±åœ°æ²‰æµ¸åœ¨å¾ˆä¹…ä»¥å‰çš„å›žå¿†ä¸­ï¼Œæˆ‘å°†æ²‰è¿·äºŽä¸€ä»½é¡¹ç›®ç¬¦å·åˆ—è¡¨æ¥æ€»ç»“è‡ªç¬¬äºŒç‰ˆã€Š<span class="emphasis"><em>ä½¿ç”¨ make ç®¡ç†é¡¹ç›®ã€‹</em></span>é—®ä¸–ä»¥æ¥<em class="command">makeçš„æ¼”å˜ï¼š</em><span class="emphasis"><em></em></span></p><p>Enthralled in the memories of those days long ago when I was a
    professional technical writer, I'll indulge myself with a bulleted list to
    summarize the evolution of <em class="command">make</em> since
    the second edition of <span class="emphasis"><em>Managing Projects with make</em></span> hit
    the stands:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>å½“æœ¬ä¹¦ç¬¬äºŒç‰ˆå‡ºç‰ˆæ—¶ï¼ŒGNU ç‰ˆæœ¬çš„<em class="command">makeå·²ç»æˆä¸ºæœ€è®¤çœŸçš„ç¨‹åºå‘˜çš„é€‰æ‹©ï¼Œå®ƒè¶…è¶Šäº†æ•´ä¸ªè¡Œä¸šï¼Œå¹¶æˆä¸ºäº‹å®žä¸Šçš„æ ‡å‡†ã€‚</em></p></li><li class="listitem"><p>The GNU version of <em class="command">make</em>,
        already the choice of most serious coders when the second edition of
        the book came out, overran the industry and turned into the de facto
        standard.</p></li><li class="listitem"><p>GNU/Linux çš„å…´èµ·ä½¿å¾— GNU ç¼–è¯‘å™¨å·¥å…·é“¾å˜å¾—æ›´åŠ æ™®éï¼Œå…¶ä¸­åŒ…æ‹¬ GNU ç‰ˆæœ¬çš„<em class="command">make</em>ã€‚ä»…ä¸¾ä¸€ä¸ªä¾‹å­ï¼ŒLinux å†…æ ¸æœ¬èº«ä¸¥é‡ä¾èµ– GNU <em class="command">make</em>æä¾›çš„æ‰©å±•ï¼Œå¦‚æœ¬ä¹¦<a class="link" href="#OEBPS/ch11.html" title="ç¬¬ 11 ç«  Makefile ç¤ºä¾‹">ç¬¬ 11 ç« </a>æ‰€è¿°ã€‚</p></li><li class="listitem"><p>The rise of GNU/Linux made the GNU compiler tool chain even more
        common, and that includes the GNU version of <em class="command">make</em>. As just one example, the Linux kernel
        itself relies heavily on extensions provided by GNU <em class="command">make</em>, as documented in <a class="link" href="#OEBPS/ch11.html" title="Chapter&nbsp;11.&nbsp;Example Makefiles">Chapter 11</a> of this book.</p></li><li class="listitem"><p><em class="command">é‡‡ç”¨ BSD (Darwin) çš„å˜ä½“ä½œä¸º Mac OS X çš„æ ¸å¿ƒå»¶ç»­äº† GNU å·¥å…·é“¾å’Œ GNU make</em>å æ®ä¸»å¯¼åœ°ä½çš„è¶‹åŠ¿ã€‚</p></li><li class="listitem"><p>The adoption of a variant of BSD (Darwin) as the core of Mac OS
        X continues the trend toward the dominance of the GNU tool chain and
        GNU <em class="command">make</em>.</p></li><li class="listitem"><p>äººä»¬å‘çŽ°äº†è¶Šæ¥è¶Šå¤šçš„æŠ€å·§æ¥ä»¥å¥å£®ã€æ— é”™è¯¯ã€å¯ç§»æ¤å’Œçµæ´»çš„æ–¹å¼ä½¿ç”¨<em class="command">make</em> ã€‚å¤§åž‹é¡¹ç›®ä¸­å¸¸è§é—®é¢˜çš„æ ‡å‡†è§£å†³æ–¹æ¡ˆå·²ç»åœ¨ç¼–ç¨‹ç¤¾åŒºä¸­å‘å±•èµ·æ¥ã€‚çŽ°åœ¨æ˜¯æ—¶å€™å°†è¿™äº›è§£å†³æ–¹æ¡ˆä»Žæ°‘é—´ä¼ è¯´é¢†åŸŸè½¬ç§»åˆ°è®°å½•å®žè·µé¢†åŸŸäº†ï¼Œæ­£å¦‚æœ¬ä¹¦æ‰€åšçš„é‚£æ ·ã€‚</p></li><li class="listitem"><p>More and more tricks are being discovered for using <em class="command">make</em> in a robust, error-free, portable, and
        flexible way. Standard solutions to common problems on large projects
        have grown up in the programming community. It's time to move many of
        these solutions from the realm of folklore to the realm of documented
        practices, as this book does.</p></li><li class="listitem"><p>ç‰¹åˆ«æ˜¯ï¼Œéœ€è¦æ–°çš„å®žè·µæ¥ä½¿<em class="command">make</em>é€‚åº” C++ å’Œ JavaÂ© è¯­è¨€ï¼Œè€Œåœ¨å‘æ˜Ž<em class="command">make</em>æ—¶è¿™äº›è¯­è¨€è¿˜ä¸å­˜åœ¨ã€‚ä¸ºäº†è¯´æ˜Žæ—¶é—´çš„æµæ²™ï¼Œæœ€åˆçš„
        <em class="command">ç‰ˆæœ¬</em>åŒ…å«æ”¯æŒä¸¤ç§ FORTRAN å˜ä½“çš„ç‰¹æ®ŠåŠŸèƒ½ï¼ˆå…¶ä¸­çš„ç—•è¿¹ä»ç„¶å­˜åœ¨ï¼ï¼‰å¹¶ä¸”ä¸Ž SCCS çš„é›†æˆç›¸å½“æ— æ•ˆã€‚ï¼‰</p></li><li class="listitem"><p>In particular, new practices are required to adapt <em class="command">make</em> to the C++ and JavaÂ© languages, which
        did not exist when <em class="command">make</em> was
        invented. To illustrate the shifting sands of time, the original
        <em class="command">make</em> contained special features to
        support two variants of FORTRANâ€”of which vestiges remain!â€”and rather
        ineffective integration with SCCS.)</p></li><li class="listitem"><p>å°½ç®¡å›°éš¾é‡é‡ï¼Œ<em class="command">make</em>ä»ç„¶æ˜¯å‡ ä¹Žæ‰€æœ‰è®¡ç®—æœºå¼€å‘é¡¹ç›®çš„å…³é”®å·¥å…·ã€‚13 å¹´å‰ï¼Œmake çš„è®¸å¤šï¼ˆä¸”å¯Œæœ‰æ´žå¯ŸåŠ›çš„ï¼‰æ‰¹è¯„è€…éƒ½ä¸ä¼šé¢„è§åˆ°è¿™<em class="command">ä¸€ç‚¹</em>ã€‚è¿™äº›å¹´ï¼Œæ›¿ä»£è€…ä¸æ–­æ¶ŒçŽ°ï¼ŒçŠ¹å¦‚é¾™ç‰™å·²ç§ä¸‹ã€‚æ¯ä¸ªæ–°å·¥å…·éƒ½åº”è¯¥ç»•è¿‡
        <em class="command">make</em>è®¾è®¡çš„é™åˆ¶ï¼Œè€Œä¸”å¤§å¤šæ•°ç¡®å®žå·§å¦™ä¸”ä»¤äººé’¦ä½©ã€‚ç„¶è€Œ<em class="command">åˆ¶ä½œ</em>çš„ç®€å•æ€§ä½¿å…¶å§‹ç»ˆä¿æŒè‡³é«˜æ— ä¸Šçš„åœ°ä½ã€‚</p></li><li class="listitem"><p>Against all odds, <em class="command">make</em> has
        remained a critical tool for nearly all computer development projects.
        None of <em class="command">make</em>'s many (and
        insightful) critics would have predicted this 13 years ago. Over these
        years, replacements sprang up repeatedly, as if dragon's teeth had
        been sown. Each new tool was supposed to bypass the limitations in
        <em class="command">make</em>'s design, and most were indeed
        ingenious and admirable. Yet the simplicity of <em class="command">make</em> has kept it supreme.</p></li></ul></div><p>å½“æˆ‘çœ‹åˆ°è¿™äº›è¶‹åŠ¿æ—¶ï¼Œå¤§çº¦åå¹´æ¥ï¼Œæˆ‘ä¸€ç›´åœ¨æƒ³ç¼–å†™æ–°ç‰ˆæœ¬çš„ã€Š<span class="emphasis"><em>ä½¿ç”¨ make ç®¡ç†é¡¹ç›®ã€‹</em></span>ã€‚ä½†æˆ‘æ„Ÿè§‰åˆ°éœ€è¦æ¯”æˆ‘æ‹¥æœ‰æ›´å¹¿æ³›ä¸“ä¸šç»éªŒçš„äººã€‚æœ€åŽï¼Œç½—ä¼¯ç‰¹Â·æ¢…å…‹ä¼¦å ¡å‡ºçŽ°äº†ï¼Œä»–çš„ä¸“ä¸šçŸ¥è¯†è®© O'Reilly çš„æˆ‘ä»¬æ‰€æœ‰äººæƒŠå¹ä¸å·²ã€‚æˆ‘å¾ˆé«˜å…´è®©ä»–æŽ¥æ‰‹è¿™æœ¬ä¹¦å¹¶é€€ä¼‘ï¼Œæ‹…ä»» kibitzer çš„è§’è‰²ï¼Œè¿™è®©æˆ‘åœ¨è¿™æœ¬ä¹¦çš„ç‰ˆæƒé¡µä¸Šå¾—åˆ°äº†æåŠã€‚ ï¼ˆé¡ºä¾¿è¯´ä¸€å¥ï¼Œæˆ‘ä»¬å°†æœ¬ä¹¦ç½®äºŽ GNU è‡ªç”±æ–‡æ¡£è®¸å¯è¯ä¹‹ä¸‹ï¼Œä»¥åæ˜  GNU <em class="command">make</em>çš„ GPL çŠ¶æ€ã€‚ï¼‰</p><p>As I watched these trends, it had been in the back of my mind for
    about a decade to write a new edition of <span class="emphasis"><em>Managing Projects with
    make</em></span>. But I sensed that someone with a broader range of
    professional experience than mine was required. Finally, Robert
    Mecklenburg came along and wowed us all at O'Reilly with his expertise. I
    was happy to let him take over the book and to retire to the role of
    kibitzer, which earns me a mention on the copyright page of this book.
    (Incidentally, we put the book under the GNU Free Documentation License to
    mirror the GPL status of GNU <em class="command">make</em>.)</p><p>ç½—ä¼¯ç‰¹è¿‡äºŽè°¦è™šï¼Œä¸æ„¿å¹æ§ä»–çš„åšå£«å­¦ä½ï¼Œä½†ä»–åœ¨è¿™ä¸€åŠªåŠ›ä¸­æ‰€è¿ç”¨çš„æ€è€ƒçš„æ·±åº¦å’Œç²¾ç¡®æ€§åœ¨æœ¬ä¹¦ä¸­æ¸…æ™°å¯è§ã€‚ä¹Ÿè®¸å¯¹è¿™æœ¬ä¹¦æ¥è¯´æ›´é‡è¦çš„æ˜¯ä»–å¯¹å®žç”¨æ€§çš„å…³æ³¨ã€‚ä»–è‡´åŠ›äºŽè®©<em class="command">make</em>ä¸ºæ‚¨æœåŠ¡ï¼Œè¿™ç§æ‰¿è¯ºçš„èŒƒå›´ä»Žå¯¹æ•ˆçŽ‡çš„è­¦æƒ•åˆ°å·§å¦™åœ°é¿å…åœ¨<span class="emphasis"><em>makefile</em></span>çš„è‡ªè®°å½•ä¸­å‡ºçŽ°å°åˆ·é”™è¯¯ã€‚</p><p>Robert is too modest to tout his Ph.D., but the depth and precision
    of thinking he must have applied to that endeavor comes through clearly in
    this book. Perhaps more important to the book is his focus on
    practicality. He's committed to making <em class="command">make</em> work for you, and this commitment ranges
    from being alert about efficiency to being clever about making even
    typographical errors in <span class="emphasis"><em>makefile</em></span>s
    self-documenting.</p><p>è¿™æ˜¯ä¸€ä¸ªä¼Ÿå¤§çš„æ—¶åˆ»ï¼šå¥¥èŽ±åˆ©æœ€æ—©ã€æœ€ç»ä¹…ä¸è¡°çš„ä¹¦ç±ä¹‹ä¸€çš„æ–°ç‰ˆæœ¬è¯žç”Ÿäº†ã€‚åä¸‹æ¥é˜…è¯»ä¸€ä¸‹ï¼Œå‡ ä¹Žæ¯ä¸ªé¡¹ç›®èƒŒæ™¯ä¸­çš„ä¸€ä¸ªä¸èµ·çœ¼çš„å°å·¥å…·å¦‚ä½•ä½“çŽ°å‡ºæ‚¨ä»Žæœªæƒ³è±¡è¿‡çš„åŠ›é‡ã€‚ä¸è¦æ»¡è¶³äºŽå˜Žå±ä½œå“ä¸”ä»¤äººä¸æ»¡æ„çš„<span class="emphasis"><em>makefile</em></span>ï¼Œç«‹å³æ‰©å±•æ‚¨çš„æ½œåŠ›ã€‚</p><p>This is a great moment: the creation of a new edition of one of
    O'Reilly's earliest and most enduring books. Sit back and read about how
    an unassuming little tool at the background of almost every project
    embodies powers you never imagined. Don't settle for creaky and
    unsatisfying <span class="emphasis"><em>makefile</em></span>sâ€”expand your potential
    today.</p><p><span class="emphasis"><em>â€”Andy Oram</em></span>  <span class="emphasis"><em>ç¼–è¾‘ï¼ŒO'Reilly Media </em></span>  <span class="emphasis"><em>2004 å¹´ 8 æœˆ 19 æ—¥</em></span></p><p><span class="emphasis"><em>â€”Andy Oram </em></span>  <span class="emphasis"><em>Editor, O'Reilly
    Media</em></span>  <span class="emphasis"><em>August 19, 2004</em></span></p></div></div></div>
<div id="OEBPS/pr03.html"><div>
<div class="preface" title="å¥‰çŒ®ç²¾ç¥ž"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/pr03.html.make3-PREFACE-3"></a>å¥‰çŒ®ç²¾ç¥ž</h1><h1 class="title"><a></a>Dedication</h1></div></div></div><p><span class="emphasis"><em>çŒ®ç»™æ‹‰å°”å¤«å’Œå·´å¤«</em></span></p><p><span class="emphasis"><em>For Ralph and Buff</em></span></p></div></div></div>
<div id="OEBPS/pr04.html"><div>
<div class="preface" title="å‰è¨€"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/pr04.html.make3-PREFACE-4"></a>å‰è¨€</h1><h1 class="title"><a></a>Preface</h1></div></div></div><div class="sect1" title="é€šå‘ç¬¬ä¸‰ç‰ˆä¹‹è·¯"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/pr04.html.make3-PREFACE-4-SECT-1"></a>é€šå‘ç¬¬ä¸‰ç‰ˆä¹‹è·¯</h1><h1 class="title"><a></a>The Road to the Third Edition</h1></div></div></div><p>æˆ‘ç¬¬ä¸€æ¬¡æŽ¥è§¦<em class="command">make</em>æ˜¯åœ¨ 1979 å¹´ï¼Œå½“æ—¶è¿˜æ˜¯ä¼¯å…‹åˆ©å¤§å­¦çš„ä¸€åæœ¬ç§‘ç”Ÿã€‚æˆ‘å¾ˆé«˜å…´èƒ½ä½¿ç”¨â€œæœ€æ–°â€è®¾å¤‡ï¼šä¸€å°å…·æœ‰ 128 KB RAM çš„ DEC PDP 11/70ã€ä¸€å° ADM 3aâ€œçŽ»ç’ƒç»ˆç«¯â€ã€ä¼¯å…‹åˆ© Unixã€ä»¥åŠå…¶ä»– 20 ä¸ªåŒæ—¶ç”¨æˆ·ï¼æœ‰ä¸€æ¬¡ï¼Œå½“ä½œä¸šåˆ°æœŸæ—¶ï¼Œæˆ‘è®°å¾—è®¡ç®—ç™»å½•éœ€è¦å¤šé•¿æ—¶é—´â€”â€”ä»Žè¾“å…¥ç”¨æˆ·ååˆ°æ”¶åˆ°æç¤ºï¼Œéœ€è¦äº”åˆ†é’Ÿã€‚</p><p>My first exposure to <em class="command">make</em> was
      as an undergraduate at Berkeley in 1979. I was thrilled to be working
      with the "latest" equipment: a DEC PDP 11/70 with 128 kilobytes of RAM,
      an ADM 3a "glass tty," Berkeley Unix, and 20 other simultaneous users!
      Once, when an assignment was due, I remember timing how long it took to
      log inâ€”five minutes from typing my username until I got a prompt.</p><p>ç¦»å¼€å­¦æ ¡åŽï¼Œæˆ‘å†æ¬¡å¼€å§‹ä»Žäº‹ Unix å·¥ä½œæ˜¯åœ¨ 1984 å¹´ã€‚è¿™æ¬¡æ˜¯åœ¨ NASA è‰¾å§†æ–¯ç ”ç©¶ä¸­å¿ƒæ‹…ä»»ç¨‹åºå‘˜ã€‚æˆ‘ä»¬è´­ä¹°äº†ç¬¬ä¸€æ‰¹åŸºäºŽå¾®æœºçš„ Unix ç³»ç»Ÿï¼Œå³ 68000ï¼ˆä¸æ˜¯ 68010 æˆ– 20ï¼‰ï¼Œå®ƒæœ‰ 1 MB çš„ RAM å’Œ Unix ç‰ˆæœ¬ 7ï¼ŒåŒæ—¶åªæœ‰ 6 ä¸ªç”¨æˆ·ã€‚æˆ‘çš„ä¸Šä¸€ä¸ªé¡¹ç›®æ˜¯ä¸€ä¸ªç”¨ C è¯­è¨€ç¼–å†™çš„äº¤äº’å¼å«æ˜Ÿæ•°æ®åˆ†æžç³»ç»Ÿï¼Œä½¿ç”¨<em class="command">yacc</em> / <em class="command">lex</em>
      å‘½ä»¤è¯­è¨€ï¼Œå½“ç„¶è¿˜æœ‰<em class="command">make</em>ã€‚</p><p>After leaving school, it was 1984 before I got to work on Unix
      again. This time it was as a programmer at NASA's Ames Research Center.
      We purchased one of the first microcomputer-based Unix systems, a 68000
      (not a 68010 or 20) that had a megabyte of RAM and Unix Version 7â€”with
      only six simultaneous users. My last project there was an interactive
      satellite data analysis system written in C with a <em class="command">yacc</em>/<em class="command">lex</em>
      command language, and, of course, <em class="command">make</em>.</p><p>åˆ° 1988 å¹´ï¼Œæˆ‘å›žåˆ°äº†å­¦æ ¡ï¼Œå¹¶è‡´åŠ›äºŽä¸€ä¸ªæž„å»ºåŸºäºŽæ ·æ¡çº¿çš„å‡ ä½•å»ºæ¨¡å™¨çš„é¡¹ç›®ã€‚è¯¥ç³»ç»Ÿç”±å¤§çº¦ 120,000 è¡Œ C ä»£ç ç»„æˆï¼Œåˆ†å¸ƒåœ¨å¤§çº¦ 20 ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚è¯¥ç³»ç»Ÿæ˜¯ä½¿ç”¨<em class="filename">makefile</em>æ¨¡æ¿æž„å»ºçš„ï¼Œè¿™äº›æ¨¡æ¿é€šè¿‡åä¸º<em class="command">genmakefile çš„</em>æ‰‹åŠ¨å·¥å…·ï¼ˆæœ¬è´¨ä¸Šä¸Ž<em class="command">imake</em>ç±»ä¼¼ï¼‰æ‰©å±•ä¸ºæ™®é€šçš„<em class="filename">makefile</em>ã€‚è¯¥å·¥å…·æ‰§è¡Œç®€å•çš„æ–‡ä»¶åŒ…å«ã€æ¡ä»¶ç¼–è¯‘å’Œä¸€äº›è‡ªå®šä¹‰é€»è¾‘æ¥ç®¡ç†æºä»£ç å’ŒäºŒè¿›åˆ¶æ ‘ã€‚å½“æ—¶äººä»¬æ™®éè®¤ä¸º
      <em class="command">make</em>éœ€è¦è¿™æ ·çš„åŒ…è£…å™¨æ‰èƒ½æˆä¸ºå®Œæ•´çš„æž„å»ºå·¥å…·ã€‚å‡ å¹´å‰ï¼Œæˆ‘å‘çŽ°äº†
      <acronym class="acronym">GNU</acronym>é¡¹ç›®å’Œ<acronym class="acronym">GNU </acronym><em class="command">make</em>ï¼Œå¹¶æ„è¯†åˆ°åŒ…è£…ç¨‹åºå¯èƒ½æ˜¯ä¸å¿…è¦çš„ã€‚æˆ‘åœ¨æ²¡æœ‰æ¨¡æ¿æˆ–ç”Ÿæˆå™¨çš„æƒ…å†µä¸‹é‡å»ºäº†æž„å»ºç³»ç»Ÿã€‚ä»¤æˆ‘æ‡Šæ¼çš„æ˜¯ï¼Œæˆ‘æœ€ç»ˆåœ¨æŽ¥ä¸‹æ¥çš„å››å¹´é‡Œç»´æŠ¤äº†æž„å»ºç³»ç»Ÿï¼ˆç›´åˆ°ä»Šå¤©æˆ‘ä»ç„¶æ„šè ¢åœ°é‡å¤è¿™ç§æ¨¡å¼ï¼‰ã€‚è¯¥æž„å»ºç³»ç»Ÿå¯ç§»æ¤åˆ°äº”ç§ç‰ˆæœ¬çš„ Unixï¼Œå¹¶åŒ…æ‹¬å•ç‹¬çš„æºä»£ç å’ŒäºŒå‰æ ‘ã€è‡ªåŠ¨å¤œé—´æž„å»ºä»¥åŠæ”¯æŒå¼€å‘äººå‘˜é€šè¿‡æž„å»ºç³»ç»Ÿå¡«å……ç¼ºå¤±çš„å¯¹è±¡è¿›è¡Œéƒ¨åˆ†ç­¾å‡ºã€‚<em class="command"></em><em class="command"></em><em class="command"></em><acronym class="acronym"></acronym><acronym class="acronym"></acronym> <em class="command"></em></p><p>By 1988, I had gone back to school and was working on a project to
      build a spline-based geometric modeler. The system consisted of about
      120,000 lines of C, spread across 20 or so executables. The system was
      built using <em class="filename">makefile</em> templates that
      were expanded into normal <em class="filename">makefile</em>s
      by a hand-rolled tool call <em class="command">genmakefile</em> (similar in spirit to <em class="command">imake</em>). The tool performed simple file
      inclusion, conditional compilation, and some custom logic to manage
      source and binary trees. It was a common belief in those days that
      <em class="command">make</em> required such a wrapper to be a
      complete build tool. Several years earlier, I had discovered the
      <acronym class="acronym">GNU</acronym> project and <acronym class="acronym">GNU</acronym> <em class="command">make</em> and realized that the wrapper program was
      probably unnecessary. I rebuilt the build system without the templates
      or a generator. To my chagrin, I wound up maintaining the build system
      for the next four years (a pattern I foolishly repeat to this day). The
      build system was portable to five flavors of Unix and included separate
      source and binary trees, automated nightly builds, and support for
      partial checkouts by developers with the build system filling in the
      missing objects.</p><p><em class="command">æˆ‘å¯¹make çš„</em>ä¸‹ä¸€æ¬¡æœ‰è¶£çš„æŽ¥è§¦æ˜¯åœ¨ 1996 å¹´ï¼Œå½“æ—¶æˆ‘æ­£åœ¨å¼€å‘ä¸€ä¸ªå•†ä¸š CAD ç³»ç»Ÿã€‚æˆ‘çš„å·¥ä½œæ˜¯ä½¿ç”¨ Microsoft C++ ç¼–è¯‘å™¨å°† 200 ä¸‡è¡Œ C++ï¼ˆä»¥åŠ 400,000 è¡Œ Lispï¼‰ä»Ž Unix ç§»æ¤åˆ° Windows NTã€‚å°±åœ¨é‚£æ—¶æˆ‘å‘çŽ°äº† Cygwin é¡¹ç›®ã€‚ä½œä¸ºç§»æ¤çš„ä¸€ä¸ªé‡è¦å‰¯äº§å“ï¼Œæˆ‘é‡æ–°è®¾è®¡äº†æž„å»ºç³»ç»Ÿä»¥æ”¯æŒ NTã€‚è¯¥æž„å»ºç³»ç»Ÿè¿˜æ”¯æŒå•ç‹¬çš„æºä»£ç æ ‘å’ŒäºŒå‰æ ‘ã€å¤šç§ Unix é£Žæ ¼ã€å¤šç§å›¾å½¢æ”¯æŒã€è‡ªåŠ¨å¤œé—´æž„å»ºå’Œæµ‹è¯•ä»¥åŠä½¿ç”¨å‚è€ƒæž„å»ºè¿›è¡Œéƒ¨åˆ†å¼€å‘äººå‘˜æ£€æŸ¥ã€‚</p><p>My next interesting encounter with <em class="command">make</em> came in 1996, working on a commercial CAD
      system. It was my job to port 2 million lines of C++ (and 400,000 lines
      of Lisp) from Unix to Windows NT, using the Microsoft C++ compiler.
      That's when I discovered the Cygwin project. As an important byproduct
      of the port, I reworked the build system to support NT. This build
      system also supported separate source and binary trees, many flavors of
      Unix, several varieties of graphics support, automated nightly builds
      and tests, and partial developer checkouts with reference builds.</p><p>2000 å¹´ï¼Œæˆ‘å¼€å§‹ä½¿ç”¨ Java ç¼–å†™å®žéªŒå®¤ä¿¡æ¯ç®¡ç†ç³»ç»Ÿã€‚è¿™æ˜¯æˆ‘å¤šå¹´æ¥å·¥ä½œè¿‡çš„ç¬¬ä¸€ä¸ªçœŸæ­£ä¸åŒçš„å¼€å‘çŽ¯å¢ƒã€‚å¤§å¤šæ•°ç¨‹åºå‘˜éƒ½æœ‰ Windows èƒŒæ™¯ï¼Œè®¸å¤šäººä¼¼ä¹Žéƒ½çŸ¥é“ Java ä½œä¸ºä»–ä»¬çš„ç¬¬ä¸€é—¨ç¼–ç¨‹è¯­è¨€ã€‚æž„å»ºçŽ¯å¢ƒå‡ ä¹Žå®Œå…¨ç”±å•†ä¸š Java é›†æˆå¼€å‘çŽ¯å¢ƒ (IDE) ç”Ÿæˆçš„é¡¹ç›®æ–‡ä»¶ç»„æˆã€‚å°½ç®¡é¡¹ç›®æ–‡ä»¶å·²ç­¾å…¥ï¼Œä½†å®ƒå¾ˆå°‘â€œå¼€ç®±å³ç”¨â€ï¼Œå¹¶ä¸”ç¨‹åºå‘˜ç»å¸¸ååœ¨å½¼æ­¤çš„éš”é—´ä¸­è§£å†³æž„å»ºé—®é¢˜ã€‚</p><p>In 2000, I began working in Java writing laboratory information
      management systems. This was one of the first really different
      development environments I'd worked in for many years. Most of the
      programmers came from a Windows background and many seemed to know Java
      as their first programming language. The build environment consisted
      almost entirely of the project file generated by a commercial Java
      Integrated Development Environment (IDE). Although the project file was
      checked in, it rarely worked "out of the box" and programmers often sat
      in each other's cubes working through build problems.</p><p>å½“ç„¶ï¼Œæˆ‘å¼€å§‹ä½¿ç”¨<em class="command">make</em>ç¼–å†™æž„å»ºç³»ç»Ÿï¼Œä½†æ˜¯å‘ç”Ÿäº†å¥‡æ€ªçš„äº‹æƒ…ã€‚è®¸å¤šå¼€å‘äººå‘˜ä¸æ„¿æ„ä½¿ç”¨ä»»ä½•å‘½ä»¤è¡Œå·¥å…·ã€‚æ­¤å¤–ï¼Œè®¸å¤šäººå¹¶æ²¡æœ‰ç‰¢ç‰¢æŽŒæ¡çŽ¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œé€‰é¡¹ç­‰æ¦‚å¿µï¼Œä¹Ÿæ²¡æœ‰ç†è§£ç”¨äºŽæž„å»ºç¨‹åºçš„å·¥å…·ã€‚ IDE éšè—äº†æ‰€æœ‰è¿™äº›é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘æ­£åœ¨ç¼–å†™çš„æž„å»ºç³»ç»Ÿå˜å¾—æ›´åŠ å¤æ‚ã€‚æˆ‘å¼€å§‹æ·»åŠ æ›´å¥½çš„é”™è¯¯æ¶ˆæ¯ã€å‰ç½®æ¡ä»¶æ£€æŸ¥ã€å¼€å‘äººå‘˜æœºå™¨é…ç½®çš„ç®¡ç†ä»¥åŠå¯¹ IDE çš„æ”¯æŒã€‚</p><p>Of course, I began to write a build system using <em class="command">make</em>, but an odd thing happened. Many of the
      developers were reluctant to use any command-line tool. Further, many
      did not have a firm grasp of such concepts as environment variables,
      command-line options, or an understanding of the tools used to build
      programs. The IDE hid all of these issues. To address these issues, the
      build system I was writing became more complex. I began to add better
      error messages, precondition checking, management of the developer's
      machine configuration, and support for IDEs.</p><p>ä¸€è·¯ä¸Šï¼Œæˆ‘è¯»äº†å‡ åé<acronym class="acronym">GNU </acronym> <em class="command">make</em>æ‰‹å†Œã€‚å½“æˆ‘å¯»æ‰¾æ›´å¤šææ–™æ—¶ï¼Œæˆ‘å‘çŽ°äº†è¿™æœ¬ä¹¦çš„ç¬¬äºŒç‰ˆã€‚å®ƒå……æ»¡äº†æœ‰ä»·å€¼çš„ææ–™ï¼Œä½†é—æ†¾çš„æ˜¯ç¼ºä¹
      <acronym class="acronym">GNU </acronym> <em class="command">make</em>çš„ç»†èŠ‚ã€‚è€ƒè™‘åˆ°å®ƒçš„å¹´é¾„ï¼Œè¿™å¹¶ä¸å¥‡æ€ªã€‚è¯¥å·ç»å—ä½äº†æ—¶é—´çš„è€ƒéªŒï¼Œä½†åˆ° 2003 å¹´éœ€è¦æ›´æ–°ã€‚ç¬¬ä¸‰ç‰ˆä¸»è¦å…³æ³¨<acronym class="acronym">GNU </acronym> <em class="command">make</em>ã€‚æ­£å¦‚ Paul Smithï¼ˆ<acronym class="acronym">GNU </acronym> <em class="command">make</em>ç»´æŠ¤è€…ï¼‰æ‰€å†™ï¼šâ€œä¸è¦ä¸ºç¼–å†™å¯ç§»æ¤çš„ ` <span class="emphasis"><em>makefile</em></span> ' è€Œçƒ¦æ¼ï¼Œè€Œæ˜¯ä½¿ç”¨å¯ç§»æ¤çš„
      <span class="emphasis"><em>make</em></span>ï¼â€</p><p>Along the way, I'd read the <acronym class="acronym">GNU</acronym> <em class="command">make</em> manual several dozen times. As I looked
      for more material, I found the second edition of this book. It was
      filled with valuable material, but was sadly lacking in details of
      <acronym class="acronym">GNU</acronym> <em class="command">make</em>. That
      wasn't surprising, considering its age. The volume had stood the test of
      time, but by 2003 needed updating. The third edition focuses primarily
      on <acronym class="acronym">GNU</acronym> <em class="command">make</em>. As
      Paul Smith (the <acronym class="acronym">GNU</acronym> <em class="command">make</em> maintainer) writes: "Don't hassle with
      writing portable `<span class="emphasis"><em>makefile</em></span>s', use a portable
      <span class="emphasis"><em>make</em></span> instead!"</p></div></div></div></div>
<div id="OEBPS/pr04s02.html"><div>
<div class="sect1" title="æ­¤ç‰ˆæœ¬çš„æ–°å¢žå†…å®¹"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/pr04s02.html.make3-PREFACE-4-SECT-2"></a>æ­¤ç‰ˆæœ¬çš„æ–°å¢žå†…å®¹</h1><h1 class="title"><a></a>What's New in This Edition</h1></div></div></div><p>æœ¬ä¹¦ä¸­çš„å‡ ä¹Žæ‰€æœ‰ææ–™éƒ½æ˜¯æ–°çš„ã€‚æˆ‘å°†ææ–™åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ã€‚</p><p>Almost all the material in this book is new. I've divided the
      material into three parts.</p><p><a class="link" href="#OEBPS/pt01.html" title="ç¬¬ä¸€éƒ¨åˆ† åŸºæœ¬æ¦‚å¿µ">ç¬¬ä¸€éƒ¨åˆ†</a>ï¼Œ<span class="emphasis"><em>åŸºæœ¬æ¦‚å¿µ</em></span><code class="literal">make</code>ï¼Œå¯¹ GNUç‰¹æ€§ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬è¿›è¡Œäº†ç›¸å½“è¯¦ç»†çš„æ£€æŸ¥ã€‚</p><p><a class="link" href="#OEBPS/pt01.html" title="Part&nbsp;I.&nbsp;Basic Concepts">Part I</a>, <span class="emphasis"><em>Basic
      Concepts</em></span>, provides a moderately detailed examination of the
      GNU <code class="literal">make</code> features and how to use
      them.</p><p><a class="link" href="#OEBPS/ch01.html" title="ç¬¬ 1 ç«  å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile">ç¬¬ 1 ç« </a>ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•ä½†å®Œæ•´çš„ç¤ºä¾‹<em class="command">è¿›è¡Œ</em>ç®€è¦ä»‹ç»ã€‚å®ƒè§£é‡Šäº†<em class="command">make</em>çš„åŸºæœ¬æ¦‚å¿µï¼Œä¾‹å¦‚ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶ï¼Œå¹¶æ¶µç›–äº†<em class="filename">makefile</em>çš„è¯­æ³•ã€‚è¿™åº”è¯¥è¶³ä»¥è®©æ‚¨å¼€å§‹åˆ›å»ºç¬¬ä¸€ä¸ª<em class="filename">makefile</em>ã€‚</p><p><a class="link" href="#OEBPS/ch01.html" title="Chapter&nbsp;1.&nbsp;How to Write a Simple Makefile">Chapter 1</a>, is a brief
      introduction to <em class="command">make</em> with a simple,
      but complete example. It explains the basic concepts of <em class="command">make</em> such as targets and prerequisites, and
      covers the syntax of <em class="filename">makefile</em>s.
      This should be sufficient to get you going with your first <em class="filename">makefile</em>s.</p><p><a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™">ç¬¬2ç« </a>ï¼Œè®¨è®ºè§„åˆ™çš„ç»“æž„å’Œè¯­æ³•ã€‚è¯¦ç»†ä»‹ç»äº†æ˜¾å¼è§„åˆ™å’Œæ¨¡å¼è§„åˆ™ä»¥åŠè€å¼åŽç¼€è§„åˆ™ã€‚è¿™é‡Œè¿˜è®¨è®ºäº†ç‰¹æ®Šç›®æ ‡å’Œç®€å•ä¾èµ–é¡¹ç”Ÿæˆã€‚</p><p><a class="link" href="#OEBPS/ch02.html" title="Chapter&nbsp;2.&nbsp;Rules">Chapter 2</a>, discusses the
      structure and syntax of rules. Explicit rules and pattern rules are
      covered in great detail along with old-fashioned suffix rules. Special
      targets and simple dependency generation are also discussed here.</p><p><a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®">ç¬¬ 3 ç« </a>ä»‹ç»äº†ç®€å•å˜é‡å’Œé€’å½’å˜é‡ã€‚æœ¬ç« è¿˜è®¨è®ºäº†å¦‚ä½•è§£æž<em class="filename">makefile ã€ä½•æ—¶æ‰©å±•å˜é‡ä»¥åŠæ¡ä»¶</em><em class="filename">makefile</em>å¤„ç†çš„æŒ‡ä»¤ã€‚</p><p><a class="link" href="#OEBPS/ch03.html" title="Chapter&nbsp;3.&nbsp;Variables and Macros">Chapter 3</a>, covers simple and
      recursive variables. This chapter also discusses how <em class="filename">makefile</em>s are parsed, when variables are
      expanded, and the directives for conditional <em class="filename">makefile</em> processing.</p><p><a class="link" href="#OEBPS/ch04.html" title="ç¬¬ 4 ç« å‡½æ•°">ç¬¬ 4 ç« è€ƒå¯Ÿäº†</a><acronym class="acronym">GNU </acronym>
      <em class="command">make</em>æ”¯æŒçš„å„ç§å†…ç½®å‡½æ•°ã€‚è¿™é‡Œä»‹ç»äº†ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼Œå¹¶æä¾›äº†å¤§é‡ç¤ºä¾‹ï¼Œä»Žç®€å•çš„åˆ°é«˜çº§æ¦‚å¿µçš„è¯´æ˜Žã€‚</p><p><a class="link" href="#OEBPS/ch04.html" title="Chapter&nbsp;4.&nbsp;Functions">Chapter 4</a>, examines the wide
      variety of built-in functions supported by <acronym class="acronym">GNU</acronym>
      <em class="command">make</em>. User-defined functions are
      introduced here, with numerous examples ranging from the trivial to
      illustrations of advanced concepts.</p><p><a class="link" href="#OEBPS/ch05.html" title="ç¬¬ 5 ç« å‘½ä»¤">ç¬¬ 5 ç« </a>è§£é‡Šäº†å‘½ä»¤è„šæœ¬çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¦‚ä½•è§£æžå’Œè¯„ä¼°å®ƒä»¬ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬è¿˜è®¨è®ºå‘½ä»¤ä¿®é¥°ç¬¦ã€æ£€æŸ¥å‘½ä»¤é€€å‡ºçŠ¶æ€å’Œå‘½ä»¤çŽ¯å¢ƒã€‚æˆ‘ä»¬æŽ¢è®¨å‘½ä»¤è¡Œé™åˆ¶çš„é—®é¢˜ä»¥åŠè§£å†³è¿™äº›é—®é¢˜çš„ä¸€äº›æ–¹æ³•ã€‚è‡³æ­¤ï¼Œæ‚¨å°†äº†è§£
      æœ¬ä¹¦ä¸­è®¨è®ºçš„æ‰€æœ‰<acronym class="acronym">GNU </acronym> <em class="command">makeåŠŸèƒ½ã€‚</em></p><p><a class="link" href="#OEBPS/ch05.html" title="Chapter&nbsp;5.&nbsp;Commands">Chapter 5</a>, explains the details
      of command scripts, covering how they are parsed and evaluated. Here we
      also discuss command modifiers, checking command exit status, and the
      command environment. We explore the problems of command-line limits and
      some ways to work around these problems. At this point, you will know
      all the <acronym class="acronym">GNU</acronym> <em class="command">make</em>
      features discussed in this book.</p><p><a class="link" href="#OEBPS/pt02.html" title="ç¬¬äºŒéƒ¨åˆ†ã€‚é«˜çº§å’Œä¸“ä¸šä¸»é¢˜">ç¬¬äºŒéƒ¨åˆ†</a>ï¼Œ<span class="emphasis"><em>é«˜çº§å’Œä¸“ä¸šä¸»é¢˜</em></span>ï¼Œæ¶µç›–æ›´å¤§çš„ä¸»é¢˜ï¼Œä¾‹å¦‚
      <code class="literal">make</code>åœ¨å¤§åž‹é¡¹ç›®ä¸Šçš„ä½¿ç”¨ã€å¯ç§»æ¤æ€§å’Œè°ƒè¯•ã€‚</p><p><a class="link" href="#OEBPS/pt02.html" title="Part&nbsp;II.&nbsp;Advanced and Specialized Topics">Part II</a>, <span class="emphasis"><em>Advanced
      and Specialized Topics</em></span>, covers larger topics, such as using
      <code class="literal">make</code> on large projects, portability,
      and debugging.</p><p><a class="link" href="#OEBPS/ch06.html" title="ç¬¬ 6 ç« ç®¡ç†å¤§åž‹é¡¹ç›®">ç¬¬ 6 ç« è®¨è®ºäº†åœ¨</a><em class="command">make</em>ä¸­æž„å»ºå¤§åž‹é¡¹ç›®æ—¶é‡åˆ°çš„è®¸å¤šé—®é¢˜ã€‚ç¬¬ä¸€ä¸ªä¸»é¢˜æ˜¯<em class="command">make</em>é€’å½’è°ƒç”¨çš„ä½¿ç”¨ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å•ä¸ªéžé€’å½’<em class="filename">makefileå®žçŽ°è¿™äº›</em><em class="filename">makefile</em>ã€‚æ­¤å¤–ï¼Œè¿˜è®¨è®ºäº†å¤§åž‹ç³»ç»Ÿçš„å…¶ä»–é—®é¢˜ï¼Œä¾‹å¦‚æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€ã€ç»„ä»¶ç®¡ç†ä»¥åŠè‡ªåŠ¨åŒ–æž„å»ºå’Œæµ‹è¯•ã€‚<em class="filename"></em></p><p><a class="link" href="#OEBPS/ch06.html" title="Chapter&nbsp;6.&nbsp;Managing Large Projects">Chapter 6</a>, discusses many
      issues encountered when building large projects in <em class="command">make</em>. The first topic is the use of recursive
      invocations of <em class="command">make</em>, as well as how
      to implement these <em class="filename">makefile</em>s with a
      single, nonrecursive <em class="filename">makefile</em>. In
      addition, other issues of large systems are discussed, such as
      filesystem layout, component management, and automated building and
      testing.</p><p><a class="link" href="#OEBPS/ch07.html" title="ç¬¬ 7 ç« å¯ç§»æ¤ Makefile">ç¬¬ 7 ç« ï¼Œè®¨è®º</a><em class="filename">makefile</em>çš„å¯ç§»æ¤æ€§é—®é¢˜ï¼Œä¸»è¦æ˜¯åœ¨ä¸åŒé£Žæ ¼çš„ Unix å’Œ Windows ä¹‹é—´ã€‚è¯¦ç»†è®¨è®ºäº† Cygwin Unix ä»¿çœŸçŽ¯å¢ƒï¼Œä»¥åŠç”±ä¸å¯ç§»æ¤æ–‡ä»¶ç³»ç»ŸåŠŸèƒ½å’Œå·¥å…·å¼•èµ·çš„é—®é¢˜ã€‚</p><p><a class="link" href="#OEBPS/ch07.html" title="Chapter&nbsp;7.&nbsp;Portable Makefiles">Chapter 7</a>, discusses issues
      with portability of <em class="filename">makefile</em>s,
      primarily between various flavors of Unix and Windows. The Cygwin Unix
      emulation environment is discussed in some detail, along with issues
      arising from nonportable filesystem features and tools.</p><p><a class="link" href="#OEBPS/ch08.html" title="ç¬¬ 8 ç«  C å’Œ C++">ç¬¬ 8 ç« </a>æä¾›äº†å¦‚ä½•åˆ†ç¦»æºä»£ç æ ‘å’ŒäºŒå‰æ ‘ä»¥åŠå¦‚ä½•åˆ›å»ºåªè¯»æºä»£ç æ ‘çš„å…·ä½“ç¤ºä¾‹ã€‚é‡æ–°å®¡è§†ä¾èµ–æ€§åˆ†æžï¼Œé‡ç‚¹æ˜¯ç‰¹å®šäºŽè¯­è¨€çš„è§£å†³æ–¹æ¡ˆã€‚æœ¬ç« å’Œä¸‹ä¸€ç« ä¸Ž<a class="link" href="#OEBPS/ch06.html" title="ç¬¬ 6 ç« ç®¡ç†å¤§åž‹é¡¹ç›®">ç¬¬ 6 ç« </a>ä¸­æå‡ºçš„è®¸å¤šé—®é¢˜å¯†åˆ‡ç›¸å…³ã€‚</p><p><a class="link" href="#OEBPS/ch08.html" title="Chapter&nbsp;8.&nbsp;C and C++">Chapter 8</a>, provides specific
      examples of how to separate source and binary trees and how to create
      read-only source trees. Dependency analysis is revisited, with an
      emphasis on language-specific solutions. This chapter and the next tie
      in closely with many issues raised in <a class="link" href="#OEBPS/ch06.html" title="Chapter&nbsp;6.&nbsp;Managing Large Projects">Chapter 6</a>.</p><p><a class="link" href="#OEBPS/ch09.html" title="ç¬¬ 9 ç«  Java">ç¬¬9ç« </a>ï¼Œè§£é‡Šå¦‚ä½•å°†<em class="command">make</em>åº”ç”¨äºŽåŸºäºŽJavaçš„å¼€å‘çŽ¯å¢ƒã€‚ä»‹ç»äº†ç®¡ç†<code class="literal">CLASSPATH</code>å˜é‡ã€ç¼–è¯‘å¤§é‡æ–‡ä»¶ã€åˆ›å»º jar å’Œæž„å»º Enterprise JavaBeans (EJB) çš„æŠ€æœ¯ã€‚</p><p><a class="link" href="#OEBPS/ch09.html" title="Chapter&nbsp;9.&nbsp;Java">Chapter 9</a>, explains how to
      apply <em class="command">make</em> to Java-based development
      environments. Techniques for managing the <code class="literal">CLASSPATH</code> variable, compiling large numbers of
      files, creating jars, and constructing Enterprise JavaBeans (EJBs) are
      introduced.</p><p><a class="link" href="#OEBPS/ch10.html" title="ç¬¬ 10 ç« æé«˜ make çš„æ€§èƒ½">ç¬¬ 10 ç« </a>é¦–å…ˆå›žé¡¾å‡ ä¸ª<em class="command">make</em>æ“ä½œçš„æ€§èƒ½ç‰¹å¾ï¼Œä¸ºå¦‚ä½•ç¼–å†™é«˜æ•ˆçš„<em class="filename">makefile</em>æä¾›ä¸Šä¸‹æ–‡ã€‚è®¨è®ºäº†è¯†åˆ«å’Œå‡å°‘ç“¶é¢ˆçš„æŠ€æœ¯ã€‚ GNU
       <acronym class="acronym">make</acronym> å¹¶è¡Œä½œä¸šåŠŸèƒ½æœ‰ä¸€äº›è¯¦ç»†çš„æè¿°<em class="command">ã€‚</em></p><p><a class="link" href="#OEBPS/ch10.html" title="Chapter&nbsp;10.&nbsp;Improving the Performance of make">Chapter 10</a>, begins by
      reviewing the performance characteristics of several <em class="command">make</em> operations to provide context for how to
      write efficient <em class="filename">makefile</em>s.
      Techniques for identifying and reducing bottlenecks are discussed. The
      <acronym class="acronym">GNU</acronym> <em class="command">make</em> parallel
      jobs feature is described in some detail.</p><p><a class="link" href="#OEBPS/ch11.html" title="ç¬¬ 11 ç«  Makefile ç¤ºä¾‹">ç¬¬ 11 ç« ï¼Œæä¾›äº†ä¸¤ä¸ªçœŸå®ž</a><em class="filename">makefile</em>çš„å¤æ‚ç¤ºä¾‹ã€‚ç¬¬ä¸€ä¸ªæ˜¯ç”¨äºŽåˆ›å»ºæœ¬ä¹¦çš„<em class="filename">makefile</em> ã€‚å®ƒå¾ˆæœ‰è¶£ï¼Œéƒ¨åˆ†åŽŸå› æ˜¯ç›¸å½“æžç«¯çš„è‡ªåŠ¨åŒ–ç¨‹åº¦ï¼Œéƒ¨åˆ†åŽŸå› æ˜¯å®ƒå°†<em class="command">make</em>åº”ç”¨äºŽéžä¼ ç»Ÿé¢†åŸŸã€‚å¦ä¸€ä¸ªç¤ºä¾‹åŒ…å« Linux 2.6 kbuild ç³»ç»Ÿçš„æ‘˜å½•ã€‚</p><p><a class="link" href="#OEBPS/ch11.html" title="Chapter&nbsp;11.&nbsp;Example Makefiles">Chapter 11</a>, provides two
      complex examples of real <em class="filename">makefile</em>s.
      The first is the <em class="filename">makefile</em> used to
      create this book. It is interesting, partly due to a fairly extreme
      degree of automation and partly because it applies <em class="command">make</em> to a nontraditional domain. The other
      example consists of excerpts from the Linux 2.6 kbuild system.</p><p><a class="link" href="#OEBPS/ch12.html" title="ç¬¬ 12 ç« è°ƒè¯• Makefile">ç¬¬ 12 ç« </a>ï¼Œæ·±å…¥ç ”ç©¶ä¿®å¤æŸåçš„<em class="filename">makefile</em>çš„é»‘é­”æ³•ã€‚æˆ‘ä»¬ä»‹ç»ä¸€äº›æŠ€æœ¯æ¥å‘çŽ°<em class="command">make</em>åœ¨å¹•åŽæ‰€åšçš„äº‹æƒ…ä»¥åŠå¦‚ä½•å‡è½»å¼€å‘çš„ç—›è‹¦ã€‚</p><p><a class="link" href="#OEBPS/ch12.html" title="Chapter&nbsp;12.&nbsp;Debugging Makefiles">Chapter 12</a>, delves into the
      black art of fixing broken <em class="filename">makefile</em>s. We introduce techniques for
      discovering what <em class="command">make</em> is doing under
      the covers and how to ease development pains.</p><p><a class="link" href="#OEBPS/pt03.html" title="ç¬¬ä¸‰éƒ¨åˆ†ã€‚é™„å½•">ç¬¬ä¸‰éƒ¨åˆ†</a>ï¼Œ
      <span class="emphasis"><em>é™„å½•</em></span>ï¼ŒåŒ…æ‹¬è¡¥å……ææ–™ã€‚</p><p><a class="link" href="#OEBPS/pt03.html" title="Part&nbsp;III.&nbsp;Appendixes">Part III</a>,
      <span class="emphasis"><em>Appendixes</em></span>, includes supplemental material.</p><p><a class="link" href="#OEBPS/apa.html" title="é™„å½• A. è¿è¡Œ make">é™„å½• Aæä¾›äº†</a><acronym class="acronym">GNU </acronym> <em class="command">make</em>å‘½ä»¤è¡Œé€‰é¡¹çš„å‚è€ƒæŒ‡å—ã€‚</p><p><a class="link" href="#OEBPS/apa.html" title="Appendix&nbsp;A.&nbsp;Running make">Appendix A</a>, provides a
      reference guide to <acronym class="acronym">GNU</acronym> <em class="command">make</em>'s command-line options.</p><p><a class="link" href="#OEBPS/apb.html" title="é™„å½• B. å¤–éƒ¨é™åˆ¶">é™„å½• BæŽ¢è®¨äº†</a><acronym class="acronym">GNU </acronym> <em class="command">make</em>çš„ä¸¤ç§ä¸å¤ªå¯èƒ½çš„åŠŸèƒ½çš„å±€é™æ€§ï¼šç®¡ç†æ•°æ®ç»“æž„å’Œæ‰§è¡Œç®—æœ¯ã€‚</p><p><a class="link" href="#OEBPS/apb.html" title="Appendix&nbsp;B.&nbsp;The Outer Limits">Appendix B</a>, explores the limits
      of <acronym class="acronym">GNU</acronym> <em class="command">make</em> with
      two unlikely capabilities: managing data structures and performing
      arithmetic.</p><p><a class="link" href="#OEBPS/apc.html" title="é™„å½• C. GNU è‡ªç”±æ–‡æ¡£è®¸å¯è¯ â€” GNU é¡¹ç›® â€” è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼š (FSF)">é™„å½• C</a>åŒ…å« GNU è‡ªç”±æ–‡æ¡£è®¸å¯è¯ï¼Œæœ¬ä¹¦çš„æ–‡æœ¬æ ¹æ®è¯¥è®¸å¯è¯åˆ†å‘ã€‚</p><p><a class="link" href="#OEBPS/apc.html" title="Appendix&nbsp;C.&nbsp;GNU Free Documentation Licenseâ€”GNU Projectâ€”Free Software Foundation (FSF)">Appendix C</a>, contains the GNU
      Free Documentation License, under which the text of the book is
      distributed.</p></div></div></div>
<div id="OEBPS/pr04s03.html"><div>
<div class="sect1" title="æœ¬ä¹¦ä¸­ä½¿ç”¨çš„çº¦å®š"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/pr04s03.html.make3-PREFACE-4-SECT-3"></a>æœ¬ä¹¦ä¸­ä½¿ç”¨çš„çº¦å®š</h1><h1 class="title"><a></a>Conventions Used in This Book</h1></div></div></div><p>æœ¬ä¹¦ä½¿ç”¨ä»¥ä¸‹å°åˆ·çº¦å®šï¼š</p><p>The following typographical conventions are used in this
      book:</p><div class="variablelist"><dl><dt><span class="term">æ–œä½“</span></dt><dt><span class="term">Italic</span></dt><dd><p>è¡¨ç¤ºæ–°æœ¯è¯­ã€URLã€ç”µå­é‚®ä»¶åœ°å€ã€æ–‡ä»¶åã€æ–‡ä»¶æ‰©å±•åã€è·¯å¾„åå’Œç›®å½•</p></dd><dd><p>Indicates new terms, URLs, email addresses, filenames, file
            extensions, pathnames, and directories</p></dd><dt><span class="term"><code class="literal">Constant width</code></span></dt><dt><span class="term"><code class="literal">Constant width</code></span></dt><dd><p>è¡¨ç¤ºæºä»£ç å‘½ä»¤ã€å‘½ä»¤è¡Œé€‰é¡¹ã€æ–‡ä»¶å†…å®¹æˆ–å‘½ä»¤çš„è¾“å‡º</p></dd><dd><p>Indicates source code commands, command-line options, the
            contents of files, or the output from commands</p></dd><dt><span class="term"><strong class="userinput"><code>Constant width
          bold</code></strong></span></dt><dt><span class="term"><strong class="userinput"><code>Constant width
          bold</code></strong></span></dt><dd><p>æ˜¾ç¤ºåº”ç”±ç”¨æˆ·é€å­—é”®å…¥çš„å‘½ä»¤æˆ–å…¶ä»–æ–‡æœ¬</p></dd><dd><p>Shows commands or other text that should be typed literally
            by the user</p></dd><dt><span class="term"><em class="replaceable"><code>Constant width italic</code></em></span></dt><dt><span class="term"><em class="replaceable"><code>Constant width italic</code></em></span></dt><dd><p>æ˜¾ç¤ºåº”æ›¿æ¢ä¸ºç”¨æˆ·æä¾›çš„å€¼çš„æ–‡æœ¬</p></dd><dd><p>Shows text that should be replaced with user-supplied
            values</p></dd></dl></div></div></div></div>
<div id="OEBPS/pr04s04.html"><div>
<div class="sect1" title="ä½¿ç”¨ä»£ç ç¤ºä¾‹"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/pr04s04.html.make3-PREFACE-4-SECT-4"></a>ä½¿ç”¨ä»£ç ç¤ºä¾‹</h1><h1 class="title"><a></a>Using Code Examples</h1></div></div></div><p>æœ¬ä¹¦æ—¨åœ¨å¸®åŠ©æ‚¨å®Œæˆå·¥ä½œã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ‚¨å¯ä»¥åœ¨æ‚¨çš„ç¨‹åºå’Œæ–‡æ¡£ä¸­ä½¿ç”¨æœ¬ä¹¦ä¸­çš„ä»£ç ã€‚é™¤éžæ‚¨è¦å¤åˆ¶å¤§éƒ¨åˆ†ä»£ç ï¼Œå¦åˆ™æ‚¨æ— éœ€è”ç³» O'Reilly ä»¥èŽ·å¾—è®¸å¯ã€‚ä¾‹å¦‚ï¼Œç¼–å†™ä½¿ç”¨æœ¬ä¹¦ä¸­çš„å‡ æ®µä»£ç çš„ç¨‹åºä¸éœ€è¦è®¸å¯ã€‚é”€å”®æˆ–åˆ†å‘ O'Reilly ä¹¦ç±ä¸­ç¤ºä¾‹çš„ CD-ROM
      <span class="emphasis"><em>ç¡®å®ž</em></span>éœ€è¦è®¸å¯ã€‚é€šè¿‡å¼•ç”¨æœ¬ä¹¦å’Œç¤ºä¾‹ä»£ç æ¥å›žç­”é—®é¢˜ä¸éœ€è¦è®¸å¯ã€‚å°†æœ¬ä¹¦ä¸­çš„å¤§é‡ç¤ºä¾‹ä»£ç åˆå¹¶åˆ°æ‚¨çš„äº§å“æ–‡æ¡£ä¸­<span class="emphasis"><em>ç¡®å®ž</em></span>éœ€è¦è®¸å¯ã€‚</p><p>This book is here to help you get your job done. In general, you
      may use the code in this book in your programs and documentation. You do
      not need to contact O'Reilly for permission unless you're reproducing a
      significant portion of the code. For example, writing a program that
      uses several chunks of code from this book does not require permission.
      Selling or distributing a CD-ROM of examples from O'Reilly books
      <span class="emphasis"><em>does</em></span> require permission. Answering a question by
      citing this book and quoting example code does not require permission.
      Incorporating a significant amount of example code from this book into
      your product's documentation <span class="emphasis"><em>does</em></span> require
      permission.</p><p>å¥¥èŽ±åˆ©èµžèµä½†ä¸è¦æ±‚æ³¨æ˜Žå‡ºå¤„ã€‚å½’å±žé€šå¸¸åŒ…æ‹¬æ ‡é¢˜ã€ä½œè€…ã€å‡ºç‰ˆå•†å’Œ ISBNã€‚ä¾‹å¦‚ï¼šâ€œ<span class="emphasis"><em>ä½¿ç”¨ GNU Make ç®¡ç†é¡¹ç›®</em></span>ï¼Œç¬¬ä¸‰ç‰ˆï¼Œä½œè€…ï¼šRobert Mecklenburgã€‚ç‰ˆæƒæ‰€æœ‰ 2005 O'Reilly Media, Inc.ï¼Œ0-596-00610-1ã€‚â€</p><p>O'Reilly appreciates, but does not require, attribution. An
      attribution usually includes the title, author, publisher, and ISBN. For
      example: "<span class="emphasis"><em>Managing Projects with GNU Make</em></span>, Third
      Edition, by Robert Mecklenburg. Copyright 2005 O'Reilly Media, Inc.,
      0-596-00610-1."</p><p>å¦‚æžœæ‚¨è®¤ä¸ºæ‚¨å¯¹ä»£ç ç¤ºä¾‹çš„ä½¿ç”¨ä¸ç¬¦åˆåˆç†ä½¿ç”¨æˆ–ä¸Šè¿°è®¸å¯çš„èŒƒå›´ï¼Œè¯·éšæ—¶é€šè¿‡
      <span class="email"><a class="email" href="#OEBPS/mailto:permissions@oreilly.com">Permissions@oreilly.com</a></span>è”ç³» O'Reilly ã€‚</p><p>If you feel your use of code examples falls outside fair use or
      the permission given above, feel free to contact O'Reilly at
      <span class="email"><a class="email" href="#OEBPS/mailto:permissions@oreilly.com">permissions@oreilly.com</a></span>.</p></div></div></div>
<div id="OEBPS/pr04s05.html"><div>
<div class="sect1" title="è¯„è®ºå’Œé—®é¢˜"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/pr04s05.html.make3-PREFACE-4-SECT-5"></a>è¯„è®ºå’Œé—®é¢˜</h1><h1 class="title"><a></a>Comments and Questions</h1></div></div></div><p>è¯·å‘å‡ºç‰ˆå•†æå‡ºæœ‰å…³æœ¬ä¹¦çš„æ„è§å’Œé—®é¢˜ï¼š</p><p>Please address comments and questions concerning this book to the
      publisher:</p><table border="0" summary="Simple list" class="simplelist"><tbody><tr><td>å¥¥èŽ±åˆ©åª’ä½“å…¬å¸</td></tr><tr><td>æ ¼æ‹‰æ–‡æ–¯å¦å…¬è·¯åŒ—1005å·</td></tr><tr><td>å¡žç“¦æ–¯æ‰˜æ³¢å°”, CA 95472</td></tr><tr><td>(800) 998-9938ï¼ˆç¾Žå›½æˆ–åŠ æ‹¿å¤§ï¼‰</td></tr><tr><td>(707) 829-0515ï¼ˆå›½é™…æˆ–æœ¬åœ°ï¼‰</td></tr><tr><td>(707) 829-0104ï¼ˆä¼ çœŸï¼‰</td></tr></tbody></table><p>O'Reilly ç»´æŠ¤äº†æœ¬ä¹¦çš„ç½‘é¡µï¼Œå…¶ä¸­åˆ—å‡ºäº†å‹˜è¯¯è¡¨ã€ç¤ºä¾‹å’Œä»»ä½•é™„åŠ ä¿¡æ¯ã€‚æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®æ­¤é¡µé¢ï¼š</p><p>O'Reilly maintains a web page for this book, which lists errata,
      examples, and any additional information. You can access this page
      at:</p><table border="0" summary="Simple list" class="simplelist"><tbody><tr><td><a class="ulink" href="http://www.oreilly.com/catalog/make3">http://www.oreilly.com/catalog/make3</a></td></tr></tbody></table><p>è¦è¯„è®ºæˆ–è¯¢é—®æœ‰å…³æœ¬ä¹¦çš„æŠ€æœ¯é—®é¢˜ï¼Œè¯·å‘é€ç”µå­é‚®ä»¶è‡³ï¼š</p><p>To comment or ask technical questions about this book, send email
      to:</p><table border="0" summary="Simple list" class="simplelist"><tbody><tr><td><span class="email"><a class="email" href="#OEBPS/mailto:bookquestions@oreilly.com">bookquestions@oreilly.com</a></span></td></tr></tbody></table><p>æœ‰å…³ O'Reilly ä¹¦ç±ã€ä¼šè®®ã€èµ„æºä¸­å¿ƒå’Œ O'Reilly ç½‘ç»œçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—® O'Reilly çš„ç½‘ç«™ï¼š</p><p>For more information about O'Reilly books, conferences, Resource
      Centers, and the O'Reilly Network, see O'Reilly's web site at:</p><table border="0" summary="Simple list" class="simplelist"><tbody><tr><td><a class="ulink" href="http://www.oreilly.com/">http://www.oreilly.com</a></td></tr></tbody></table></div></div></div>
<div id="OEBPS/pr04s06.html"><div>
<div class="sect1" title="è‡´è°¢"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/pr04s06.html.make3-PREFACE-4-SECT-6"></a>è‡´è°¢</h1><h1 class="title"><a></a>Acknowledgments</h1></div></div></div><p>æˆ‘è¦æ„Ÿè°¢ç†æŸ¥å¾·Â·æ–¯æ‰˜æ›¼ï¼ˆRichard Stallmanï¼‰æä¾›çš„æ„¿æ™¯ä»¥åŠç›¸ä¿¡å®ƒå¯ä»¥å®žçŽ°çš„ä¿¡å¿µã€‚å½“ç„¶ï¼Œå¦‚æžœæ²¡æœ‰ Paul Smithï¼Œ
       <acronym class="acronym">GNU </acronym> <em class="command">make</em>å°±ä¸ä¼šä»¥çŽ°åœ¨çš„å½¢å¼å­˜åœ¨ã€‚è°¢è°¢ã€‚</p><p>I'd like to thank Richard Stallman for providing a vision and the
      belief that it can come true. Of course, without Paul Smith,
      <acronym class="acronym">GNU</acronym> <em class="command">make</em> would not
      exist in its current form today. Thank you.</p><p>æˆ‘è¦æ„Ÿè°¢æˆ‘çš„ç¼–è¾‘å®‰è¿ªÂ·å¥¥æ‹‰å§† (Andy Oram) çš„ä¸æ‡ˆæ”¯æŒå’Œçƒ­æƒ…ã€‚</p><p>I'd like to thank my editor, Andy Oram, for his unflagging support
      and enthusiasm.</p><p>Cimarron Software å€¼å¾—æˆ‘æ„Ÿè°¢ï¼Œä»–ä»¬æä¾›äº†ä¸€ä¸ªé¼“åŠ±æˆ‘å¼€å§‹è¿™ä¸ªé¡¹ç›®çš„çŽ¯å¢ƒã€‚ Realm Systems ä¹Ÿå€¼å¾—æ„Ÿè°¢ï¼Œä»–ä»¬æä¾›äº†ä¸€ä¸ªé¼“åŠ±æˆ‘å®Œæˆè¯¥é¡¹ç›®çš„çŽ¯å¢ƒã€‚æˆ‘è¦ç‰¹åˆ«æ„Ÿè°¢é“æ ¼Â·äºšå½“æ£®ã€å‡¯èŒœÂ·å®‰å¾·æ£®å’Œå½¼å¾—Â·å¸ƒå…‹æ›¼ã€‚</p><p>Cimarron Software deserves my thanks for providing an environment
      that encouraged me to begin this project. Realm Systems also deserves
      thanks for providing an environment that encouraged me to finish the
      project. In particular, I'd like to thank Doug Adamson, Cathy Anderson,
      and Peter Bookman.</p><p>æ„Ÿè°¢æˆ‘çš„å®¡ç¨¿äºº Simon Gerratyã€John Macdonald å’Œ Paul Smithï¼Œä»–ä»¬æä¾›äº†è®¸å¤šå¯Œæœ‰æ´žå¯ŸåŠ›çš„è¯„è®ºå¹¶çº æ­£äº†è®¸å¤šä»¤äººå°´å°¬çš„é”™è¯¯ã€‚</p><p>Thanks to my reviewers, Simon Gerraty, John Macdonald, and Paul
      Smith, who provided many insightful comments and corrected many
      embarrassing errors.</p><p>ä»¥ä¸‹äººå‘˜å¯¹è¿™é¡¹å·¥ä½œåšå‡ºçš„å®è´µè´¡çŒ®å€¼å¾—æ„Ÿè°¢ï¼šSteve Bayerã€Richard Bogartã€Beth Cobbã€Julie Dailyã€David Johnsonã€Andrew Mortonã€Richard Pimentelã€Brian Stevens å’Œ Linus Torvaldsã€‚éžå¸¸æ„Ÿè°¢åœ¨æ³¢æ¶›æ±¹æ¶Œçš„å¤§æµ·ä¸­æä¾›å®‰å…¨é¿éš¾æ‰€çš„é˜´è°‹é›†å›¢ï¼šå…‹é‡Œæ–¯æ±€Â·å¾·èŽ±å°¼ã€æ‰˜å°¼Â·è¿ªÂ·å¡žæ‹‰ã€çº¦ç¿°Â·æ¢…æ°å’Œä¸¹å°¼å°”Â·é›·ä¸ã€‚</p><p>The following people deserve thanks for valuable contributions to
      this work: Steve Bayer, Richard Bogart, Beth Cobb, Julie Daily, David
      Johnson, Andrew Morton, Richard Pimentel, Brian Stevens, and Linus
      Torvalds. Many thanks to the cabal that provided a safe haven in stormy
      seas: Christine Delaney, Tony Di Sera, John Major, and Daniel
      Reading.</p><p>æœ€åŽï¼Œæˆ‘æ·±æ·±åœ°æ„Ÿè°¢å’Œçˆ±æˆ‘çš„å¦»å­çŽ›å‰Â·å¡æ–¯æ»•ä»¥åŠæˆ‘ä»¬çš„å­©å­å¨å»‰å’Œè©¹å§†æ–¯ï¼Œæ„Ÿè°¢ä»–ä»¬åœ¨è¿‡åŽ»åå…­ä¸ªæœˆé‡Œçš„æ”¯æŒã€é¼“åŠ±å’Œçˆ±ã€‚æ„Ÿè°¢æ‚¨ä¸Žæˆ‘åˆ†äº«è¿™ä¸ªã€‚</p><p>Finally, my profound gratitude and love goes to my wife, Maggie
      Kasten, and our children, William and James, for their support,
      encouragement, and love during the last sixteen months. Thank you for
      sharing this with me.</p></div></div></div>
<div id="OEBPS/pt01.html"><div>
<div class="part" title="ç¬¬ä¸€éƒ¨åˆ† åŸºæœ¬æ¦‚å¿µ"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/pt01.html.make3-PART-1"></a>ç¬¬ä¸€éƒ¨åˆ† åŸºæœ¬æ¦‚å¿µ</h1><h1 class="title"><a></a>Part&nbsp;I.&nbsp;Basic Concepts</h1></div></div></div><div class="partintro" title="åŸºæœ¬æ¦‚å¿µ" id="OEBPS/pt01.html.id2951876"><div></div><p>åœ¨<a class="link" href="#OEBPS/pt01.html" title="ç¬¬ä¸€éƒ¨åˆ† åŸºæœ¬æ¦‚å¿µ">ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹ä»‹ç»</a><em class="command">make</em>çš„åŠŸèƒ½ã€å®ƒä»¬çš„ç”¨é€”ä»¥åŠå¦‚ä½•æ­£ç¡®ä½¿ç”¨å®ƒä»¬ã€‚æˆ‘ä»¬é¦–å…ˆè¿›è¡Œç®€çŸ­çš„ä»‹ç»å’Œæ¦‚è¿°ï¼Œè¿™åº”è¯¥è¶³ä»¥è®©æ‚¨å¼€å§‹ç¼–å†™ç¬¬ä¸€ä¸ª
      <em class="filename">makefile</em>ã€‚è¿™äº›ç« èŠ‚éšåŽä»‹ç»äº†
      <em class="command">make</em>è§„åˆ™ã€å˜é‡ã€å‡½æ•°ï¼Œæœ€åŽæ˜¯å‘½ä»¤è„šæœ¬ã€‚</p><p>In <a class="link" href="#OEBPS/pt01.html" title="Part&nbsp;I.&nbsp;Basic Concepts">Part I</a>, we focus on the
      features of <em class="command">make</em>, what they do, and
      how to use them properly. We begin with a brief introduction and
      overview that should be enough to get you started on your first
      <em class="filename">makefile</em>. The chapters then cover
      <em class="command">make</em> rules, variables, functions, and
      finally command scripts.</p><p>å½“æ‚¨å®Œæˆ<a class="link" href="#OEBPS/pt01.html" title="ç¬¬ä¸€éƒ¨åˆ† åŸºæœ¬æ¦‚å¿µ">ç¬¬ä¸€éƒ¨åˆ†æ—¶ï¼Œæ‚¨å°†æ‹¥æœ‰ç›¸å½“å®Œæ•´çš„</a><acronym class="acronym">GNU </acronym> <em class="command">make</em>å·¥ä½œçŸ¥è¯†
      ï¼Œå¹¶æŽŒæ¡è®¸å¤šé«˜çº§ç”¨æ³•ã€‚</p><p>When you are finished with <a class="link" href="#OEBPS/pt01.html" title="Part&nbsp;I.&nbsp;Basic Concepts">Part
      I</a>, you will have a fairly complete working knowledge of
      <acronym class="acronym">GNU</acronym> <em class="command">make</em> and have
      many advanced usages well in hand.</p><p><a class="link" href="#OEBPS/ch01.html" title="ç¬¬ 1 ç«  å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile">ç¬¬ 1 ç« </a>ï¼Œå¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile</p><p><a class="link" href="#OEBPS/ch01.html" title="Chapter&nbsp;1.&nbsp;How to Write a Simple Makefile">Chapter 1</a>, How to Write a
      Simple Makefile</p><p><a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™">ç¬¬2ç« </a>ï¼Œè§„åˆ™</p><p><a class="link" href="#OEBPS/ch02.html" title="Chapter&nbsp;2.&nbsp;Rules">Chapter 2</a>, Rules</p><p><a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®">ç¬¬3ç« </a>,å˜é‡å’Œå®</p><p><a class="link" href="#OEBPS/ch03.html" title="Chapter&nbsp;3.&nbsp;Variables and Macros">Chapter 3</a>, Variables and
      Macros</p><p><a class="link" href="#OEBPS/ch04.html" title="ç¬¬ 4 ç« å‡½æ•°">ç¬¬ 4 ç« </a>ï¼Œå‡½æ•°</p><p><a class="link" href="#OEBPS/ch04.html" title="Chapter&nbsp;4.&nbsp;Functions">Chapter 4</a>, Functions</p><p><a class="link" href="#OEBPS/ch05.html" title="ç¬¬ 5 ç« å‘½ä»¤">ç¬¬ 5 ç« </a>ï¼Œå‘½ä»¤</p><p><a class="link" href="#OEBPS/ch05.html" title="Chapter&nbsp;5.&nbsp;Commands">Chapter 5</a>, Commands</p></div></div></div></div>
<div id="OEBPS/ch01.html"><div>
<div class="chapter" title="ç¬¬ 1 ç«  å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch01.html.make3-CHP-1"></a>ç¬¬ 1 ç«  å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile</h1><h1 class="title"><a></a>Chapter&nbsp;1.&nbsp;How to Write a Simple Makefile</h1></div></div></div><p>ç¼–ç¨‹æœºåˆ¶é€šå¸¸éµå¾ªç›¸å½“ç®€å•çš„ä¾‹ç¨‹ï¼šç¼–è¾‘æºæ–‡ä»¶ã€å°†æºä»£ç ç¼–è¯‘æˆå¯æ‰§è¡Œå½¢å¼å¹¶è°ƒè¯•ç»“æžœã€‚å°½ç®¡å°†æºä»£ç è½¬æ¢ä¸ºå¯æ‰§è¡Œæ–‡ä»¶è¢«è®¤ä¸ºæ˜¯ä¾‹è¡Œå…¬äº‹ï¼Œä½†å¦‚æžœåšå¾—ä¸æ­£ç¡®ï¼Œç¨‹åºå‘˜å¯èƒ½ä¼šæµªè´¹å¤§é‡æ—¶é—´æ¥è¿½è¸ªé—®é¢˜ã€‚å¤§å¤šæ•°å¼€å‘äººå‘˜éƒ½ç»åŽ†è¿‡ä¿®æ”¹å‡½æ•°å¹¶è¿è¡Œæ–°ä»£ç å´å‘çŽ°ä»–ä»¬çš„æ›´æ”¹æ²¡æœ‰ä¿®å¤é”™è¯¯çš„æŒ«è´¥æ„Ÿã€‚åŽæ¥ä»–ä»¬å‘çŽ°ï¼Œç”±äºŽæŸäº›ç¨‹åºé”™è¯¯ï¼Œä¾‹å¦‚æœªèƒ½é‡æ–°ç¼–è¯‘æºä»£ç ã€é‡æ–°é“¾æŽ¥å¯æ‰§è¡Œæ–‡ä»¶æˆ–é‡å»º jarï¼Œä»–ä»¬ä»Žæœªæ‰§è¡Œä¿®æ”¹è¿‡çš„å‡½æ•°ã€‚æ­¤å¤–ï¼Œéšç€ç¨‹åºå¤æ‚æ€§çš„å¢žåŠ ï¼Œéšç€ç¨‹åºçš„ä¸åŒç‰ˆæœ¬çš„å¼€å‘ï¼ˆå¯èƒ½æ˜¯é’ˆå¯¹å…¶ä»–å¹³å°æˆ–å…¶ä»–ç‰ˆæœ¬çš„æ”¯æŒåº“ç­‰ï¼‰ï¼Œè¿™äº›å¹³å‡¡çš„ä»»åŠ¡å¯èƒ½ä¼šå˜å¾—è¶Šæ¥è¶Šå®¹æ˜“å‡ºé”™ã€‚</p><p>The mechanics of programming usually follow a fairly simple
      routine of editing source files, compiling the source into an executable
      form, and debugging the result. Although transforming the source into an
      executable is considered routine, if done incorrectly a programmer can
      waste immense amounts of time tracking down the problem. Most developers
      have experienced the frustration of modifying a function and running the
      new code only to find that their change did not fix the bug. Later they
      discover that they were never executing their modified function because
      of some procedural error such as failing to recompile the source, relink
      the executable, or rebuild a jar. Moreover, as the program's complexity
      grows these mundane tasks can become increasingly error-prone as
      different versions of the program are developed, perhaps for other
      platforms or other versions of support libraries, etc.</p><p><em class="command">make</em>ç¨‹åºçš„ç›®çš„æ˜¯
      <a id="OEBPS/ch01.html.make3-CHP-1-ITERM-786" class="indexterm"></a> <a id="OEBPS/ch01.html.make3-CHP-1-ITERM-787" class="indexterm"></a> <a id="OEBPS/ch01.html.make3-CHP-1-ITERM-788" class="indexterm"></a>å°†æºä»£ç è½¬æ¢ä¸ºå¯æ‰§è¡Œæ–‡ä»¶çš„æ—¥å¸¸å·¥ä½œå®žçŽ°è‡ªåŠ¨åŒ–ã€‚<em class="command">make</em> over è„šæœ¬çš„ä¼˜ç‚¹åœ¨äºŽï¼Œæ‚¨å¯ä»¥æŒ‡å®šè¦<em class="command">make</em>çš„ç¨‹åºå…ƒç´ ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶ä¸”å®ƒé€šè¿‡è¿™äº›å…³ç³»å’Œæ—¶é—´æˆ³å‡†ç¡®åœ°çŸ¥é“æ¯æ¬¡éœ€è¦é‡åšå“ªäº›æ­¥éª¤æ‰èƒ½ç”Ÿæˆæ‰€éœ€çš„ç¨‹åºã€‚ä½¿ç”¨æ­¤ä¿¡æ¯ï¼Œ<em class="command">make</em>è¿˜å¯ä»¥ä¼˜åŒ–æž„å»ºè¿‡ç¨‹ï¼Œé¿å…ä¸å¿…è¦çš„æ­¥éª¤ã€‚</p><p>The <em class="command">make</em> program is intended to
      <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>automate the mundane aspects of transforming source code
      into an executable. The advantages of <em class="command">make</em> over scripts is that you can specify the
      relationships between the elements of your program to <em class="command">make</em>, and it knows through these relationships
      and timestamps exactly what steps need to be redone to produce the
      desired program each time. Using this information, <em class="command">make</em> can also optimize the build process
      avoiding unnecessary steps.</p><p><acronym class="acronym">GNU </acronym> <em class="command">make ï¼ˆä»¥åŠ</em><em class="command">make</em>
      çš„å…¶ä»–å˜ä½“ï¼‰æ­£æ˜¯è¿™æ ·åšçš„ã€‚<em class="command">make</em>å®šä¹‰äº†ä¸€ç§ç”¨äºŽæè¿°æºä»£ç ã€ä¸­é—´æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶ä¹‹é—´å…³ç³»çš„è¯­è¨€ã€‚å®ƒè¿˜æä¾›ç®¡ç†å¤‡ç”¨é…ç½®ã€å®žçŽ°å¯é‡ç”¨è§„èŒƒåº“ä»¥åŠä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„å®å‚æ•°åŒ–æµç¨‹çš„åŠŸèƒ½ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ<em class="command">make</em>å¯ä»¥è¢«è®¤ä¸ºæ˜¯å¼€å‘è¿‡ç¨‹çš„ä¸­å¿ƒï¼Œå®ƒæä¾›äº†åº”ç”¨ç¨‹åºç»„ä»¶çš„è·¯çº¿å›¾ä»¥åŠå®ƒä»¬å¦‚ä½•ç»„åˆåœ¨ä¸€èµ·ã€‚</p><p><acronym class="acronym">GNU</acronym> <em class="command">make</em>
      (and other variants of <em class="command">make</em>) do
      precisely this. <em class="command">make</em> defines a
      language for describing the relationships between source code,
      intermediate files, and executables. It also provides features to manage
      alternate configurations, implement reusable libraries of
      specifications, and parameterize processes with user-defined macros. In
      short, <em class="command">make</em> can be considered the
      center of the development process by providing a roadmap of an
      application's components and how they fit together.</p><p><em class="command">åˆ¶ä½œ</em>ä½¿ç”¨çš„è¯´æ˜Žä¹¦
      ä¸€èˆ¬ä¿å­˜<a id="OEBPS/ch01.html.make3-CHP-1-ITERM-789" class="indexterm"></a> <a id="OEBPS/ch01.html.make3-CHP-1-ITERM-790" class="indexterm"></a><em class="filename">åœ¨åä¸ºmakefile</em>çš„æ–‡ä»¶ä¸­ã€‚è¿™æ˜¯æž„å»ºä¼ ç»Ÿâ€œHello, Worldâ€ç¨‹åºçš„<em class="filename">makefile ï¼š</em></p><p>The specification that <em class="command">make</em>
      uses is generally saved <a class="indexterm"></a> <a class="indexterm"></a>in a file named <em class="filename">makefile</em>. Here is a <em class="filename">makefile</em> to build the traditional "Hello,
      World" program:</p><a id="OEBPS/ch01.html.I_1_tt3"></a><pre class="programlisting">ä½ å¥½ï¼šä½ å¥½.c
        gcc hello.c -o ä½ å¥½</pre><pre class="programlisting">hello: hello.c
        gcc hello.c -o hello</pre><p>è¦æž„å»ºç¨‹åºï¼Œè¯·è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œ<em class="command">make ï¼š</em></p><p>To build the program execute <em class="command">make</em> by typing:</p><a id="OEBPS/ch01.html.I_1_tt4"></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong></pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong></pre><p>åœ¨æ‚¨æœ€å–œæ¬¢çš„ shell çš„å‘½ä»¤æç¤ºç¬¦å¤„ã€‚è¿™å°†å¯¼è‡´
      <em class="command">make</em>ç¨‹åºè¯»å–<em class="filename">makefile</em>å¹¶æž„å»ºå®ƒåœ¨é‚£é‡Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªç›®æ ‡ï¼š</p><p>at the command prompt of your favorite shell. This will cause the
      <em class="command">make</em> program to read the <em class="filename">makefile</em> and build the first target it finds
      there:</p><a id="OEBPS/ch01.html.I_1_tt5"></a><pre class="programlisting">$ <strong class="userinput"><code>make</code></strong>
gcc hello.c -o ä½ å¥½</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
gcc hello.c -o hello</pre><p>å¦‚æžœç›®æ ‡åŒ…å«ä¸º ac<a id="OEBPS/ch01.html.make3-CHP-1-ITERM-791" class="indexterm"></a> <a id="OEBPS/ch01.html.make3-CHP-1-ITERM-792" class="indexterm"></a> <a id="OEBPS/ch01.html.make3-CHP-1-ITERM-793" class="indexterm"></a>å‘½ä»¤è¡Œå‚æ•°ï¼Œè¯¥ç›®æ ‡å·²æ›´æ–°ã€‚å¦‚æžœæœªç»™å‡ºå‘½ä»¤è¡Œç›®æ ‡ï¼Œåˆ™ä½¿ç”¨æ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªç›®æ ‡ï¼Œç§°ä¸º<em class="firstterm">é»˜è®¤ç›®æ ‡</em>ã€‚</p><p>If a target is included as a c<a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>ommand-line argument, that target is updated. If no
      command-line targets are given, then the first target in the file is
      used, called the <em class="firstterm">default goal</em>.</p><p><em class="filename">é€šå¸¸ï¼Œå¤§å¤šæ•°makefile çš„</em>é»˜è®¤ç›®æ ‡æ˜¯æž„å»ºç¨‹åºã€‚è¿™é€šå¸¸æ¶‰åŠè®¸å¤šæ­¥éª¤ã€‚é€šå¸¸ï¼Œç¨‹åºçš„æºä»£ç æ˜¯ä¸å®Œæ•´çš„ï¼Œå¿…é¡»ä½¿ç”¨<em class="command">flex</em>æˆ–<em class="command">bison</em>ç­‰å®žç”¨ç¨‹åºç”Ÿæˆæºä»£ç ã€‚æŽ¥ä¸‹æ¥ï¼Œæºä»£ç è¢«ç¼–è¯‘æˆäºŒè¿›åˆ¶ç›®æ ‡æ–‡ä»¶ï¼ˆC/C++ çš„
      <em class="filename">.oæ–‡ä»¶ã€Java çš„</em><em class="filename">.class</em>æ–‡ä»¶ç­‰ï¼‰ã€‚ç„¶åŽï¼Œå¯¹äºŽ C/C++ï¼Œç›®æ ‡æ–‡ä»¶ç”±é“¾æŽ¥å™¨ï¼ˆé€šå¸¸é€šè¿‡ç¼–è¯‘å™¨<em class="command">gcc</em>è°ƒç”¨ï¼‰ç»‘å®šåœ¨ä¸€èµ·ä»¥å½¢æˆå¯æ‰§è¡Œç¨‹åºã€‚</p><p>Typically the default goal in most <em class="filename">makefile</em>s is to build a program. This usually
      involves many steps. Often the source code for the program is incomplete
      and the source must be generated using utilities such as <em class="command">flex</em> or <em class="command">bison</em>. Next the source is compiled into binary
      object files (<em class="filename">.o</em> files for C/C++,
      <em class="filename">.class</em> files for Java, etc.). Then,
      for C/C++, the object files are bound together by a linker (usually
      invoked through the compiler, <em class="command">gcc</em>) to
      form an executable program.</p><p>ä¿®æ”¹ä»»ä½•æºæ–‡ä»¶å¹¶é‡æ–°è°ƒç”¨<em class="command">make</em>å°†å¯¼è‡´é‡å¤è¿™äº›å‘½ä»¤ä¸­çš„ä¸€äº›ï¼ˆä½†é€šå¸¸ä¸æ˜¯å…¨éƒ¨ï¼‰ï¼Œä»¥ä¾¿å°†æºä»£ç æ›´æ”¹æ­£ç¡®åœ°åˆå¹¶åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚è§„èŒƒæ–‡ä»¶æˆ–<em class="filename">makefile</em>æè¿°æºç¨‹åºæ–‡ä»¶ã€ä¸­é—´ç¨‹åºæ–‡ä»¶å’Œå¯æ‰§è¡Œç¨‹åºæ–‡ä»¶ä¹‹é—´çš„å…³ç³»ï¼Œä»¥ä¾¿<em class="command">make</em>å¯ä»¥æ‰§è¡Œæ›´æ–°å¯æ‰§è¡Œç¨‹åºæ‰€éœ€çš„æœ€å°‘å·¥ä½œé‡ã€‚</p><p>Modifying any of the source files and reinvoking <em class="command">make</em> will cause some, but usually not all, of
      these commands to be repeated so the source code changes are properly
      incorporated into the executable. The specification file, or <em class="filename">makefile</em>, describes the relationship between
      the source, intermediate, and executable program files so that <em class="command">make</em> can perform the minimum amount of work
      necessary to update the executable.</p><p><em class="command">å› æ­¤ï¼Œ make</em>çš„ä¸»è¦ä»·å€¼
      æ¥è‡ªäºŽå®ƒèƒ½å¤Ÿæ‰§è¡Œæž„å»ºåº”ç”¨ç¨‹åºæ‰€éœ€çš„ä¸€ç³»åˆ—å¤æ‚å‘½ä»¤ï¼Œå¹¶åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ä¼˜åŒ–è¿™äº›æ“ä½œï¼Œä»¥å‡å°‘ç¼–è¾‘-ç¼–è¯‘-è°ƒè¯•å‘¨æœŸæ‰€éœ€çš„æ—¶é—´ã€‚æ­¤å¤–ï¼Œ<em class="command">make</em>è¶³å¤Ÿçµæ´»ï¼Œå¯ä»¥åœ¨ä¸€ç§æ–‡ä»¶ä¾èµ–äºŽå¦ä¸€ç§æ–‡ä»¶çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼Œä»Žä¼ ç»Ÿçš„ C/C++ ç¼–ç¨‹åˆ° Javaã€TEXã€æ•°æ®åº“ç®¡ç†ç­‰ã€‚</p><p>So the principle value of <em class="command">make</em>
      comes from its ability to perform the complex series of commands
      necessary to build an application and to optimize these operations when
      possible to reduce the time taken by the edit-compile-debug cycle.
      Furthermore, <em class="command">make</em> is flexible enough
      to be used anywhere one kind of file depends on another from traditional
      programming in C/C++ to Java, TEX, database management, and more.</p><div class="sect1" title="ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch01.html.make3-CHP-1-SECT-1"></a>ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</h1><h1 class="title"><a></a>Targets and Prerequisites</h1></div></div></div><p>æœ¬è´¨ä¸Šä¸€ä¸ª<em class="filename">makefile</em>
        åŒ…å«ä¸€ä¸ª<a id="OEBPS/ch01.html.make3-CHP-1-ITERM-794" class="indexterm"></a> <a id="OEBPS/ch01.html.make3-CHP-1-ITERM-795" class="indexterm"></a> <a id="OEBPS/ch01.html.make3-CHP-1-ITERM-796" class="indexterm"></a> <a id="OEBPS/ch01.html.make3-CHP-1-ITERM-797" class="indexterm"></a> <a id="OEBPS/ch01.html.make3-CHP-1-ITERM-798" class="indexterm"></a>ç”¨äºŽæž„å»ºåº”ç”¨ç¨‹åºçš„è§„åˆ™é›†ã€‚<em class="command">make</em>çœ‹åˆ°çš„ç¬¬ä¸€æ¡è§„åˆ™è¢«ç”¨ä½œ
        <em class="firstterm">é»˜è®¤è§„åˆ™</em>ã€‚è§„åˆ™ç”±ä¸‰<em class="firstterm">éƒ¨åˆ†</em>
        ç»„æˆï¼šç›®æ ‡ã€å…ˆå†³æ¡ä»¶å’Œè¦æ‰§è¡Œçš„å‘½ä»¤ï¼š</p><p>Essentially a <em class="filename">makefile</em>
        contains a <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>set of rules used to build an application. The first
        rule seen by <em class="command">make</em> is used as the
        <em class="firstterm">default rule</em>. A <em class="firstterm">rule</em>
        consists of three parts: the target, its prerequisites, and the
        command(s) to perform:</p><a id="OEBPS/ch01.html.I_1_tt6"></a><pre class="programlisting"><em class="replaceable"><code>target</code></em>: <sub>1 </sub><sub>2</sub><em class="replaceable"><code>prereq</code></em>
               <sub></sub> 
               <em class="replaceable"><code>prereq</code></em>
               <sub></sub>
               <em class="replaceable"><code>commands</code></em></pre><pre class="programlisting"><em class="replaceable"><code>target</code></em>: <em class="replaceable"><code>prereq</code></em>
               <sub>1</sub> 
               <em class="replaceable"><code>prereq</code></em>
               <sub>2</sub>
               <em class="replaceable"><code>commands</code></em></pre><p>ç›®æ ‡<em class="firstterm">æ˜¯</em>å¿…é¡»çš„æ–‡ä»¶æˆ–äº‹ç‰©
        <a id="OEBPS/ch01.html.make3-CHP-1-ITERM-799" class="indexterm"></a> <a id="OEBPS/ch01.html.make3-CHP-1-ITERM-800" class="indexterm"></a>è¢«åˆ¶ä½œã€‚å…ˆå†³<em class="firstterm">æ¡ä»¶</em>æˆ–
        <em class="firstterm">ä¾èµ–é¡¹</em>æ˜¯æˆåŠŸåˆ›å»ºç›®æ ‡ä¹‹å‰å¿…é¡»å­˜åœ¨çš„æ–‡ä»¶ã€‚è¿™äº›
        <em class="firstterm">å‘½ä»¤</em>æ˜¯å°†æ ¹æ®å…ˆå†³æ¡ä»¶åˆ›å»ºç›®æ ‡çš„ shell å‘½ä»¤ã€‚</p><p>The <em class="firstterm">target</em> is the file or thing that must
        <a class="indexterm"></a> <a class="indexterm"></a>be made. The <em class="firstterm">prerequisites</em> or
        <em class="firstterm">dependents</em> are those files that must exist
        before the target can be successfully created. And the
        <em class="firstterm">commands</em> are those shell commands that will
        create the target from the prerequisites.</p><p><em class="filename">ä»¥ä¸‹æ˜¯å°† C æ–‡ä»¶foo.c</em>ç¼–è¯‘ä¸ºç›®æ ‡æ–‡ä»¶<em class="filename">foo.o çš„</em>è§„åˆ™ï¼š</p><p>Here is a rule for compiling a C file, <em class="filename">foo.c</em>, into an object file, <em class="filename">foo.o</em>:</p><a id="OEBPS/ch01.html.I_1_tt7"></a><pre class="programlisting">foo.o: foo.c foo.h
        gcc -c foo.c</pre><pre class="programlisting">foo.o: foo.c foo.h
        gcc -c foo.c</pre><p>ç›®æ ‡æ–‡ä»¶<em class="filename">foo.o</em>
        å‡ºçŽ°åœ¨å†’å·ä¹‹å‰ã€‚å…ˆå†³æ¡ä»¶<em class="filename">foo.c</em>å’Œ<em class="filename">foo.h</em>å‡ºçŽ°åœ¨å†’å·ä¹‹åŽã€‚å‘½ä»¤è„šæœ¬é€šå¸¸å‡ºçŽ°åœ¨ä»¥ä¸‹å‡ è¡Œä¸­ï¼Œå‰é¢æœ‰ä¸€ä¸ªåˆ¶è¡¨ç¬¦ã€‚</p><p>The target file <em class="filename">foo.o</em>
        appears before the colon. The prerequisites <em class="filename">foo.c</em> and <em class="filename">foo.h</em> appear after the colon. The command
        script usually appears on the following lines and is preceded by a tab
        character.</p><p>å½“è¦æ±‚<em class="command">make</em>è¯„ä¼°è§„åˆ™æ—¶ï¼Œå®ƒé¦–å…ˆæŸ¥æ‰¾å…ˆå†³æ¡ä»¶å’Œç›®æ ‡æŒ‡ç¤ºçš„æ–‡ä»¶ã€‚å¦‚æžœä»»ä½•å…ˆå†³æ¡ä»¶å…·æœ‰å…³è”è§„åˆ™ï¼Œ<em class="command">è¯·</em>é¦–å…ˆå°è¯•æ›´æ–°è¿™äº›è§„åˆ™ã€‚æŽ¥ä¸‹æ¥ï¼Œè€ƒè™‘ç›®æ ‡æ–‡ä»¶ã€‚å¦‚æžœä»»ä½•å…ˆå†³æ¡ä»¶æ¯”ç›®æ ‡æ–°ï¼Œåˆ™é€šè¿‡æ‰§è¡Œå‘½ä»¤é‡æ–°åˆ›å»ºç›®æ ‡ã€‚æ¯ä¸ªå‘½ä»¤è¡Œéƒ½ä¼šä¼ é€’åˆ° shell å¹¶åœ¨å…¶è‡ªå·±çš„å­ shell ä¸­æ‰§è¡Œã€‚å¦‚æžœä»»ä½•å‘½ä»¤ç”Ÿæˆé”™è¯¯ï¼Œåˆ™ç›®æ ‡çš„æž„å»ºå°†ç»ˆæ­¢å¹¶<em class="command">é€€å‡º</em>ã€‚å¦‚æžœä¸€ä¸ªæ–‡ä»¶æœ€è¿‘ä¿®æ”¹è¿‡ï¼Œåˆ™è¯¥æ–‡ä»¶è¢«è®¤ä¸ºæ¯”å¦ä¸€ä¸ªæ–‡ä»¶æ–°ã€‚</p><p>When <em class="command">make</em> is asked to
        evaluate a rule, it begins by finding the files indicated by the
        prerequisites and target. If any of the prerequisites has an
        associated rule, <em class="command">make</em> attempts to
        update those first. Next, the target file is considered. If any
        prerequisite is newer than the target, the target is remade by
        executing the commands. Each command line is passed to the shell and
        is executed in its own subshell. If any of the commands generates an
        error, the building of the target is terminated and <em class="command">make</em> exits. One file is considered newer
        than another if it has been modified more recently.</p><p>è¿™æ˜¯ä¸€ä¸ªè®¡ç®—è¾“å…¥ä¸­â€œfeeâ€ã€â€œfieâ€ã€â€œfoeâ€å’Œâ€œfumâ€å•è¯å‡ºçŽ°æ¬¡æ•°çš„ç¨‹åºã€‚å®ƒä½¿ç”¨ç”±ç®€å•çš„ä¸»é©±åŠ¨é©±åŠ¨çš„<em class="command">æŸ”æ€§æ‰«æä»ªï¼š</em></p><p>Here is a program to count the number of occurrences of the
        words "fee," "fie," "foe," and "fum" in its input. It uses a <em class="command">flex</em> scanner driven by a simple main:</p><a id="OEBPS/ch01.html.I_1_tt8"></a><pre class="programlisting">#include &lt;stdio.h&gt;

extern int Fee_countã€fie_countã€foe_countã€fum_countï¼›
å¤–éƒ¨ int yylex( æ— æ•ˆ );

int main( int argc, char ** argv )
{
    yylex();
    printf( "%d %d %d %d\n", Fee_count, fie_count, foe_count, fum_count );
    é€€å‡ºï¼ˆ0ï¼‰ï¼›
}</pre><pre class="programlisting">#include &lt;stdio.h&gt;

extern int fee_count, fie_count, foe_count, fum_count;
extern int yylex( void );

int main( int argc, char ** argv )
{
    yylex( );
    printf( "%d %d %d %d\n", fee_count, fie_count, foe_count, fum_count );
    exit( 0 );
}</pre><p>æ‰«æä»ªéžå¸¸ç®€å•ï¼š</p><p>The scanner is very simple:</p><a id="OEBPS/ch01.html.I_1_tt9"></a><pre class="programlisting">        int è´¹ç”¨è®¡æ•° = 0;
        int fie_count = 0;
        int æ•Œäººè®¡æ•° = 0;
        int fum_count = 0;
%%
è´¹ç”¨fee_count++ï¼›
fie fie_count++ï¼›
æ•Œäººfoe_count++ï¼›
ç¦å§†ç¦å§†_è®¡æ•°++ï¼›</pre><pre class="programlisting">        int fee_count = 0;
        int fie_count = 0;
        int foe_count = 0;
        int fum_count = 0;
%%
fee     fee_count++;
fie     fie_count++;
foe     foe_count++;
fum     fum_count++;</pre><p><em class="filename">è¯¥ç¨‹åºçš„ makefile</em>ä¹Ÿéžå¸¸ç®€å•ï¼š</p><p>The <em class="filename">makefile</em> for this
        program is also quite simple:</p><a id="OEBPS/ch01.html.I_1_tt10"></a><pre class="programlisting">count_words: count_words.o lexer.o -lfl
        gcc count_words.o lexer.o -lfl -o count_words

count_words.o: count_words.c
        gcc -c count_words.c

è¯æ³•åˆ†æžå™¨.o: è¯æ³•åˆ†æžå™¨.c
        gcc -c è¯æ³•åˆ†æžå™¨.c

è¯æ³•åˆ†æžå™¨.c: è¯æ³•åˆ†æžå™¨.l
        flex -t lexer.l &gt; lexer.c</pre><pre class="programlisting">count_words: count_words.o lexer.o -lfl
        gcc count_words.o lexer.o -lfl -o count_words

count_words.o: count_words.c
        gcc -c count_words.c

lexer.o: lexer.c
        gcc -c lexer.c

lexer.c: lexer.l
        flex -t lexer.l &gt; lexer.c</pre><p>å½“ç¬¬ä¸€æ¬¡æ‰§è¡Œè¿™ä¸ª<em class="filename">makefileæ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼š</em></p><p>When this <em class="filename">makefile</em> is
        executed for the first time, we see:</p><a id="OEBPS/ch01.html.I_1_tt11"></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
gcc -c count_words.c
flex -t lexer.l &gt; lexer.c
gcc -c è¯æ³•åˆ†æžå™¨.c
gcc count_words.o lexer.o -lfl -o count_words</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
gcc -c count_words.c
flex -t lexer.l &gt; lexer.c
gcc -c lexer.c
gcc count_words.o lexer.o -lfl -o count_words</pre><p>æˆ‘ä»¬çŽ°åœ¨æœ‰äº†ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºã€‚å½“ç„¶ï¼ŒçœŸå®žçš„ç¨‹åºé€šå¸¸åŒ…å«æ¯”è¿™æ›´å¤šçš„æ¨¡å—ã€‚å¦å¤–ï¼Œæ­£å¦‚æ‚¨ç¨åŽå°†çœ‹åˆ°çš„ï¼Œè¿™ä¸ª<em class="filename">makefileæ²¡æœ‰ä½¿ç”¨</em><em class="command">make</em>çš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œå› æ­¤å®ƒæ¯”å¿…è¦çš„æ›´åŠ å†—é•¿ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™æ˜¯ä¸€ä¸ªå®žç”¨ä¸”æœ‰ç”¨çš„<em class="filename">makefile</em>ã€‚ä¾‹å¦‚ï¼Œåœ¨ç¼–å†™è¿™ä¸ªä¾‹å­çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘åœ¨è¯•éªŒç¨‹åºæ—¶æ‰§è¡Œäº†å‡ åæ¬¡<em class="filename">makefile ã€‚</em></p><p>We now have an executable program. Of course, real programs
        typically consist of more modules than this. Also, as you will see
        later, this <em class="filename">makefile</em> does not use
        most of the features of <em class="command">make</em> so
        it's more verbose than necessary. Nevertheless, this is a functional
        and useful <em class="filename">makefile</em>. For
        instance, during the writing of this example, I executed the <em class="filename">makefile</em> several dozen times while
        experimenting with the program.</p><p>å½“æ‚¨æŸ¥çœ‹<em class="filename">makefile</em>
        å’Œç¤ºä¾‹æ—¶<a id="OEBPS/ch01.html.make3-CHP-1-ITERM-801" class="indexterm"></a> <a id="OEBPS/ch01.html.make3-CHP-1-ITERM-802" class="indexterm"></a> <a id="OEBPS/ch01.html.make3-CHP-1-ITERM-803" class="indexterm"></a> <a id="OEBPS/ch01.html.make3-CHP-1-ITERM-804" class="indexterm"></a><em class="command">æ‰§è¡Œæ—¶ï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°make</em>æ‰§è¡Œå‘½ä»¤çš„é¡ºåºå‡ ä¹Žä¸Žå®ƒä»¬åœ¨<em class="filename">makefile</em>ä¸­å‡ºçŽ°çš„é¡ºåºç›¸åã€‚è¿™ç§
        <span class="emphasis"><em>è‡ªä¸Šè€Œä¸‹çš„</em></span>é£Žæ ¼å¾ˆå¸¸è§<a id="OEBPS/ch01.html.make3-CHP-1-ITERM-805" class="indexterm"></a> <a id="OEBPS/ch01.html.make3-CHP-1-ITERM-806" class="indexterm"></a>åœ¨<em class="filename">makefile</em>ä¸­ã€‚é€šå¸¸ï¼Œæœ€é€šç”¨çš„ç›®æ ‡å½¢å¼é¦–å…ˆåœ¨ makefile ä¸­æŒ‡å®š
        <em class="filename">ï¼Œ</em>è¯¦ç»†ä¿¡æ¯ç•™åˆ°ä»¥åŽå†è¯´ã€‚<em class="command">make</em>ç¨‹åºä»¥å¤šç§æ–¹å¼æ”¯æŒè¿™ç§é£Žæ ¼ã€‚å…¶ä¸­æœ€ä¸»è¦çš„æ˜¯<em class="command">make</em>çš„ä¸¤é˜¶æ®µæ‰§è¡Œæ¨¡åž‹å’Œé€’å½’å˜é‡ã€‚æˆ‘ä»¬å°†åœ¨åŽé¢çš„ç« èŠ‚ä¸­è¯¦ç»†è®¨è®ºè¿™äº›å†…å®¹ã€‚</p><p>As you look at the <em class="filename">makefile</em>
        and sample <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>execution, you may notice that the order in which
        commands are executed by <em class="command">make</em> are
        nearly the opposite to the order they occur in the <em class="filename">makefile</em>. This
        <span class="emphasis"><em>top-down</em></span> style is common <a class="indexterm"></a> <a class="indexterm"></a>in <em class="filename">makefile</em>s.
        Usually the most general form of target is specified first in the
        <em class="filename">makefile</em> and the details are left
        for later. The <em class="command">make</em> program
        supports this style in many ways. Chief among these is <em class="command">make</em>'s two-phase execution model and
        recursive variables. We will discuss these in great detail in later
        chapters.</p></div></div></div></div>
<div id="OEBPS/ch01s02.html"><div>
<div class="sect1" title="ä¾èµ–æ€§æ£€æŸ¥"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch01s02.html.make3-CHP-1-SECT-2"></a>ä¾èµ–æ€§æ£€æŸ¥</h1><h1 class="title"><a></a>Dependency Checking</h1></div></div></div><p><em class="command">make æ˜¯</em>å¦‚ä½•å†³å®šè¦åšä»€ä¹ˆçš„ï¼Ÿè®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°å›žé¡¾ä¸€ä¸‹ä¹‹å‰çš„æ‰§è¡Œä»¥æ‰¾å‡ºç­”æ¡ˆã€‚</p><p>How did <em class="command">make</em> decide what to
        do? Let's go over the previous execution in more detail to find
        out.</p><p>é¦–å…ˆ<em class="command">è¦</em>æ³¨æ„çš„æ˜¯
        <a id="OEBPS/ch01s02.html.make3-CHP-1-ITERM-807" class="indexterm"></a> <a id="OEBPS/ch01s02.html.make3-CHP-1-ITERM-808" class="indexterm"></a>å‘½ä»¤è¡Œä¸åŒ…å«ç›®æ ‡ï¼Œå› æ­¤å®ƒå†³å®šè®¾ç½®é»˜è®¤ç›®æ ‡<em class="filename">count_words</em>ã€‚å®ƒæ£€æŸ¥<a id="OEBPS/ch01s02.html.make3-CHP-1-ITERM-809" class="indexterm"></a> <a id="OEBPS/ch01s02.html.make3-CHP-1-ITERM-810" class="indexterm"></a>å…ˆå†³æ¡ä»¶å¹¶çœ‹åˆ°ä¸‰ä¸ªï¼š<em class="filename">count_words.o</em>ã€<em class="filename">lexer.o</em>å’Œ<code class="option">-lfl</code>ã€‚
         <em class="command">make</em>çŽ°åœ¨è€ƒè™‘å¦‚ä½•æž„å»º
        <em class="filename">count_words.o</em>å¹¶æŸ¥çœ‹å®ƒçš„è§„åˆ™ã€‚å†æ¬¡ï¼Œå®ƒæ£€æŸ¥å…ˆå†³æ¡ä»¶ï¼Œæ³¨æ„åˆ°<em class="filename">count_words.c</em>æ²¡æœ‰è§„åˆ™ï¼Œä½†è¯¥æ–‡ä»¶å­˜åœ¨ï¼Œå› æ­¤<em class="command">makeé€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ‰§è¡Œå°†</em><em class="filename">count_words.c</em>è½¬æ¢ä¸º<em class="filename">count_words.o çš„</em>å‘½ä»¤ï¼š</p><p>First <em class="command">make</em> notices that the
        <a class="indexterm"></a> <a class="indexterm"></a>command line contains no targets so it decides to make
        the default goal, <em class="filename">count_words</em>. It
        checks for <a class="indexterm"></a> <a class="indexterm"></a>prerequisites and sees three: <em class="filename">count_words.o</em>, <em class="filename">lexer.o</em>, and <code class="option">-lfl</code>.
        <em class="command">make</em> now considers how to build
        <em class="filename">count_words.o</em> and sees a rule for
        it. Again, it checks the prerequisites, notices that <em class="filename">count_words.c</em> has no rules but that the
        file exists, so <em class="command">make</em> executes the
        commands to transform <em class="filename">count_words.c</em> into <em class="filename">count_words.o</em> by executing the
        command:</p><a id="OEBPS/ch01s02.html.I_1_tt12"></a><pre class="programlisting">gcc -c count_words.c</pre><pre class="programlisting">gcc -c count_words.c</pre><p>è¿™ç§ç›®æ ‡åˆ°å…ˆå†³æ¡ä»¶ã€ç›®æ ‡åˆ°å…ˆå†³æ¡ä»¶çš„â€œé“¾æŽ¥â€æ˜¯<em class="command">make</em>åˆ†æž<em class="filename">makefile</em>ä»¥ç¡®å®šè¦æ‰§è¡Œçš„å‘½ä»¤çš„å…¸åž‹æ–¹å¼ã€‚</p><p>This "chaining" of targets to prerequisites to targets to
        prerequisites is typical of how <em class="command">make</em> analyzes a <em class="filename">makefile</em> to decide the commands to be
        performed.</p><p><em class="command">make</em>è€ƒè™‘çš„ä¸‹ä¸€ä¸ªå…ˆå†³æ¡ä»¶
        æ˜¯<em class="filename">lexer.o</em>ã€‚è§„åˆ™é“¾å†æ¬¡æŒ‡å‘<em class="filename">lexer.c</em> 
        ï¼Œä½†è¿™æ¬¡è¯¥æ–‡ä»¶ä¸å­˜åœ¨ã€‚<em class="command">make</em>æ‰¾åˆ°ä»Ž<em class="filename">lexer.lç”Ÿæˆ</em><em class="filename">lexer.c çš„</em>è§„åˆ™ï¼Œå› æ­¤å®ƒè¿è¡Œ<em class="command">flex</em>ç¨‹åºã€‚çŽ°åœ¨<em class="filename">lexer.c</em>å·²å­˜åœ¨ï¼Œå®ƒå¯ä»¥è¿è¡Œ<em class="command">gcc</em>å‘½ä»¤ã€‚<em class="filename"></em><em class="command"></em><em class="filename"></em><em class="command"></em></p><p>The next prerequisite <em class="command">make</em>
        considers is <em class="filename">lexer.o</em>. Again the
        chain of rules leads to <em class="filename">lexer.c</em>
        but this time the file does not exist. <em class="command">make</em> finds the rule for generating <em class="filename">lexer.c</em> from <em class="filename">lexer.l</em> so it runs the <em class="command">flex</em> program. Now that <em class="filename">lexer.c</em> exists it can run the <em class="command">gcc</em> command.</p><p>æœ€åŽ<em class="command">è¿›è¡Œ</em>æ£€æŸ¥
        <code class="option">-lfl</code>ã€‚<em class="command">gcc</em><code class="option">-l</code>çš„é€‰é¡¹æŒ‡ç¤ºå¿…é¡»é“¾æŽ¥åˆ°åº”ç”¨ç¨‹åºä¸­çš„ç³»ç»Ÿåº“ã€‚ â€œflâ€æŒ‡ç¤ºçš„å®žé™…åº“åç§°æ˜¯<em class="filename">libfl.a</em>ã€‚
         <acronym class="acronym">GNU </acronym><em class="command">make</em>
        åŒ…å«å¯¹æ­¤è¯­æ³•çš„ç‰¹æ®Šæ”¯æŒã€‚å½“çœ‹åˆ°è¯¥å½¢å¼çš„å…ˆå†³æ¡ä»¶æ—¶ï¼Œ <em class="command">makeæœç´¢</em><em class="filename">libNAME.so</em>å½¢å¼çš„æ–‡ä»¶
        ï¼›å¦‚æžœæœªæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œåˆ™ä¼šæœç´¢<em class="filename">libNAME.a</em>ã€‚è¿™é‡Œ<em class="command">make</em>æ‰¾åˆ°<em class="filename">/usr/lib/libfl.a</em>å¹¶ç»§ç»­æœ€åŽçš„æ“ä½œï¼Œé“¾æŽ¥ã€‚<em class="command"></em><em class="filename"></em><acronym class="acronym"></acronym> <em class="command"></em><code class="option">-l&lt;NAME&gt;</code><em class="command"></em><em class="filename"></em><em class="filename"></em><em class="command"></em><em class="filename"></em></p><p>Finally, <em class="command">make</em> examines
        <code class="option">-lfl</code>. The <code class="option">-l</code> option to <em class="command">gcc</em> indicates a system library that must be
        linked into the application. The actual library name indicated by "fl"
        is <em class="filename">libfl.a</em>.
        <acronym class="acronym">GNU</acronym> <em class="command">make</em>
        includes special support for this syntax. When a prerequisite of the
        form<code class="option">-l&lt;NAME&gt;</code> is seen, <em class="command">make</em> searches for a file of the form
        <em class="filename">libNAME.so</em>; if no match is found,
        it then searches for <em class="filename">libNAME.a</em>.
        Here <em class="command">make</em> finds <em class="filename">/usr/lib/libfl.a</em> and proceeds with the
        final action, linking.</p></div></div></div>
<div id="OEBPS/ch01s03.html"><div>
<div class="sect1" title="æœ€å¤§é™åº¦åœ°å‡å°‘é‡å»º"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch01s03.html.make3-CHP-1-SECT-3"></a>æœ€å¤§é™åº¦åœ°å‡å°‘é‡å»º</h1><h1 class="title"><a></a>Minimizing Rebuilds</h1></div></div></div><p>å½“æˆ‘ä»¬è¿è¡Œæˆ‘ä»¬çš„ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬<a id="OEBPS/ch01s03.html.make3-CHP-1-ITERM-811" class="indexterm"></a> <a id="OEBPS/ch01s03.html.make3-CHP-1-ITERM-812" class="indexterm"></a> <a id="OEBPS/ch01s03.html.make3-CHP-1-ITERM-813" class="indexterm"></a> <a id="OEBPS/ch01s03.html.make3-CHP-1-ITERM-814" class="indexterm"></a> <a id="OEBPS/ch01s03.html.make3-CHP-1-ITERM-815" class="indexterm"></a> <a id="OEBPS/ch01s03.html.make3-CHP-1-ITERM-816" class="indexterm"></a>å‘çŽ°é™¤äº†æ‰“å°è´¹ç”¨ã€fiesã€foes å’Œ fums ä¹‹å¤–ï¼Œå®ƒè¿˜æ‰“å°è¾“å…¥æ–‡ä»¶ä¸­çš„æ–‡æœ¬ã€‚è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚é—®é¢˜æ˜¯æˆ‘ä»¬å¿˜è®°äº†è¯æ³•åˆ†æžå™¨ä¸­çš„ä¸€äº›è§„åˆ™ï¼Œè€Œ<em class="command">Flex</em>æ­£åœ¨å°†è¿™äº›æ— æ³•è¯†åˆ«çš„æ–‡æœ¬ä¼ é€’åˆ°å…¶è¾“å‡ºã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åªéœ€æ·»åŠ ä¸€ä¸ªâ€œä»»æ„å­—ç¬¦â€è§„åˆ™å’Œä¸€ä¸ªæ¢è¡Œè§„åˆ™ï¼š</p><p>When we run our program, we <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>discover that aside from printing fees, fies, foes, and
        fums, it also prints text from the input file. This is not what we
        want. The problem is that we have forgotten some rules in our lexical
        analyzer and <em class="command">flex</em> is passing this
        unrecognized text to its output. To solve this problem we simply add
        an "any character" rule and a newline rule:</p><a id="OEBPS/ch01s03.html.I_1_tt13"></a><pre class="programlisting">        int è´¹ç”¨è®¡æ•° = 0;
        int fie_count = 0;
        int æ•Œäººè®¡æ•° = 0;
        int fum_count = 0;
%%
è´¹ç”¨fee_count++ï¼›
fie fie_count++ï¼›
æ•Œäººfoe_count++ï¼›
ç¦å§†ç¦å§†_è®¡æ•°++ï¼›
ã€‚
\n</pre><pre class="programlisting">        int fee_count = 0;
        int fie_count = 0;
        int foe_count = 0;
        int fum_count = 0;
%%
fee     fee_count++;
fie     fie_count++;
foe     foe_count++;
fum     fum_count++;
.
\n</pre><p>ç¼–è¾‘æ­¤æ–‡ä»¶åŽï¼Œæˆ‘ä»¬éœ€è¦é‡å»ºåº”ç”¨ç¨‹åºæ¥æµ‹è¯•æˆ‘ä»¬çš„ä¿®å¤ï¼š</p><p>After editing this file we need to rebuild the application to
        test our fix:</p><a id="OEBPS/ch01s03.html.I_1_tt14"></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
flex -t lexer.l &gt; lexer.c
gcc -c è¯æ³•åˆ†æžå™¨.c
gcc count_words.o lexer.o -lfl -ocount_words</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
flex -t lexer.l &gt; lexer.c
gcc -c lexer.c
gcc count_words.o lexer.o -lfl -ocount_words</pre><p>è¯·æ³¨æ„ï¼Œè¿™æ¬¡æ–‡ä»¶<em class="filename">count_words.c</em>æ²¡æœ‰é‡æ–°ç¼–è¯‘ã€‚å½“
        <em class="command">make</em>åˆ†æžè§„åˆ™æ—¶ï¼Œå®ƒå‘çŽ°<em class="filename">count_words.oå­˜åœ¨ï¼Œå¹¶ä¸”æ¯”å…¶å…ˆå†³æ¡ä»¶</em><em class="filename">count_words.c</em>
        æ›´æ–°ï¼Œå› æ­¤æ— éœ€æ‰§è¡Œä»»ä½•æ“ä½œå³å¯ä½¿æ–‡ä»¶æ›´æ–°ã€‚ç„¶è€Œï¼Œåœ¨åˆ†æž<em class="filename">lexer.cæ—¶ï¼Œ </em><em class="command">make</em>å‘çŽ°å…ˆå†³æ¡ä»¶<em class="filename">lexer.læ¯”å…¶ç›®æ ‡</em><em class="filename">lexer.c</em>æ–°ï¼Œå› æ­¤<em class="command">make</em>å¿…é¡»æ›´æ–°<em class="filename">lexer.c</em>ã€‚è¿™åè¿‡æ¥åˆå¯¼è‡´äº†<em class="filename">lexer.o</em>å’Œ<em class="filename">count_words</em>çš„æ›´æ–°ã€‚çŽ°åœ¨æˆ‘ä»¬çš„å­—æ•°ç»Ÿè®¡ç¨‹åºå·²ç»ä¿®å¤äº†ï¼š</p><p>Notice this time the file <em class="filename">count_words.c</em> was not recompiled. When
        <em class="command">make</em> analyzed the rule, it
        discovered that <em class="filename">count_words.o</em>
        existed and was newer than its prerequisite <em class="filename">count_words.c</em> so no action was necessary to
        bring the file up to date. While analyzing <em class="filename">lexer.c</em>, however, <em class="command">make</em> saw that the prerequisite <em class="filename">lexer.l</em> was newer than its target <em class="filename">lexer.c</em> so <em class="command">make</em> must update <em class="filename">lexer.c</em>. This, in turn, caused the update
        of <em class="filename">lexer.o</em> and then <em class="filename">count_words</em>. Now our word counting program
        is fixed:</p><a id="OEBPS/ch01s03.html.I_1_tt15"></a><pre class="programlisting">$ <strong class="userinput"><code>count_words &lt; lexer.l</code></strong>
3 3 3 3</pre><pre class="programlisting">$<strong class="userinput"><code>count_words &lt; lexer.l</code></strong>
3 3 3 3</pre></div></div></div>
<div id="OEBPS/ch01s04.html"><div>
<div class="sect1" title="è°ƒç”¨make"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch01s04.html.make3-CHP-1-SECT-4"></a>è°ƒç”¨make</h1><h1 class="title"><a></a>Invoking make</h1></div></div></div><p>å‰é¢çš„ä¾‹å­<a id="OEBPS/ch01s04.html.make3-CHP-1-ITERM-817" class="indexterm"></a> <a id="OEBPS/ch01s04.html.make3-CHP-1-ITERM-818" class="indexterm"></a>å‡ä½¿ï¼Œå‡è®¾ï¼š</p><p>The previous examples <a class="indexterm"></a> <a class="indexterm"></a>assume that:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>æ‰€æœ‰é¡¹ç›®æºä»£ç å’Œ<em class="command">make</em>æè¿°æ–‡ä»¶éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªç›®å½•ä¸­ã€‚</p></li><li class="listitem"><p>All the project source code and the <em class="command">make</em> description file are stored in a
            single directory.</p></li><li class="listitem"><p>make<em class="command">æè¿°</em>æ–‡ä»¶ç§°ä¸º<em class="filename">makefile</em>ã€<em class="filename">Makefile</em>æˆ–<em class="filename">GNUMakefile</em>ã€‚</p></li><li class="listitem"><p>The <em class="command">make</em> description file
            is called <em class="filename">makefile</em>, <em class="filename">Makefile</em>, or <em class="filename">GNUMakefile</em>.</p></li><li class="listitem"><p><em class="command">æ‰§è¡Œmakeå‘½ä»¤æ—¶</em><em class="filename">ï¼Œmakefile</em>é©»ç•™åœ¨ç”¨æˆ·çš„å½“å‰ç›®å½•ä¸­ã€‚<em class="command"></em></p></li><li class="listitem"><p>The <em class="filename">makefile</em> resides in
            the user's current directory when executing the <em class="command">make</em> command.</p></li></ul></div><p>å½“åœ¨è¿™äº›æ¡ä»¶ä¸‹è°ƒç”¨<em class="command">make</em>æ—¶ï¼Œå®ƒâ€‹â€‹ä¼šè‡ªåŠ¨åˆ›å»ºå®ƒçœ‹åˆ°çš„ç¬¬ä¸€ä¸ªç›®æ ‡ã€‚è¦æ›´æ–°ä¸åŒçš„ç›®æ ‡ï¼ˆæˆ–æ›´æ–°å¤šä¸ªç›®æ ‡ï¼‰ï¼Œè¯·åœ¨å‘½ä»¤è¡Œä¸­åŒ…å«ç›®æ ‡åç§°ï¼š</p><p>When <em class="command">make</em> is invoked under
        these conditions, it automatically creates the first target it sees.
        To update a different target (or to update more than one target)
        include the target name on the command line:</p><a id="OEBPS/ch01s04.html.I_1_tt16"></a><pre class="programlisting">$<strong class="userinput"><code>make lexer.c</code></strong></pre><pre class="programlisting">$<strong class="userinput"><code>make lexer.c</code></strong></pre><p>å½“æ‰§è¡Œ<em class="command">make</em>æ—¶ï¼Œå®ƒä¼šè¯»å–æè¿°æ–‡ä»¶å¹¶è¯†åˆ«è¦æ›´æ–°çš„ç›®æ ‡ã€‚å¦‚æžœç›®æ ‡æˆ–å…¶ä»»ä½•å¿…å¤‡æ–‡ä»¶å·²è¿‡æœŸï¼ˆæˆ–ä¸¢å¤±ï¼‰ï¼Œåˆ™è§„åˆ™å‘½ä»¤è„šæœ¬ä¸­çš„ shell å‘½ä»¤å°†ä¸€æ¬¡æ‰§è¡Œä¸€ä¸ªã€‚è¿è¡Œå‘½ä»¤åŽï¼Œ<em class="command">make</em>å‡å®šç›®æ ‡æ˜¯æœ€æ–°çš„å¹¶ç§»è‡³ä¸‹ä¸€ä¸ªç›®æ ‡æˆ–é€€å‡ºã€‚</p><p>When <em class="command">make</em> is executed, it
        will read the description file and identify the target to be updated.
        If the target or any of its prerequisite files are out of date (or
        missing) the shell commands in the rule's command script will be
        executed one at a time. After the commands are run <em class="command">make</em> assumes the target is up to date and
        moves on to the next target or exits.</p><p>å¦‚æžœæ‚¨æŒ‡å®šçš„ç›®æ ‡å·²ç»æ˜¯æœ€æ–°çš„ï¼Œ<em class="command">make</em>ä¼šè¿™ä¹ˆè¯´å¹¶ç«‹å³é€€å‡ºï¼Œä¸æ‰§è¡Œä»»ä½•å…¶ä»–æ“ä½œï¼š</p><p>If the target you specify is already up to date, <em class="command">make</em> will say so and immediately exit, doing
        nothing else:</p><a id="OEBPS/ch01s04.html.I_1_tt17"></a><pre class="programlisting">$ <strong class="userinput"><code>make lexer.c</code></strong>
make: `lexer.c' æ˜¯æœ€æ–°çš„ã€‚</pre><pre class="programlisting">$<strong class="userinput"><code>make lexer.c</code></strong>
make: `lexer.c' is up to date.</pre><p>å¦‚æžœæ‚¨æŒ‡å®šçš„ç›®æ ‡ä¸åœ¨ makefile ä¸­<em class="filename">å¹¶ä¸”</em>æ²¡æœ‰éšå¼è§„åˆ™ï¼ˆåœ¨<a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™">ç¬¬ 2 ç« </a>ä¸­è®¨è®ºï¼‰ï¼Œ
        <code class="literal">make</code>åˆ™ä¼šå“åº”ï¼š</p><p>If you specify a target that is not in the <em class="filename">makefile</em> and for which there is no implicit
        rule (discussed in <a class="link" href="#OEBPS/ch02.html" title="Chapter&nbsp;2.&nbsp;Rules">Chapter 2</a>),
        <code class="literal">make</code> will respond with:</p><a id="OEBPS/ch01s04.html.I_1_tt18"></a><pre class="programlisting">$ <strong class="userinput"><code>make non-existent-target</code></strong>
make: *** æ²¡æœ‰è§„åˆ™ä½¿ç›®æ ‡æˆä¸ºâ€œä¸å­˜åœ¨çš„ç›®æ ‡â€ã€‚åœæ­¢ã€‚</pre><pre class="programlisting">$<strong class="userinput"><code>make non-existent-target</code></strong>
make: *** No rule to make target `non-existent-target'.  Stop.</pre><p><em class="command">make</em>æœ‰è®¸å¤šå‘½ä»¤è¡Œé€‰é¡¹ã€‚æœ€æœ‰ç”¨çš„ä¹‹ä¸€æ˜¯<code class="option">â€”just-print</code>(æˆ–
        <code class="option">-n</code>)ï¼Œå®ƒå‘Šè¯‰<em class="command">make</em>æ˜¾ç¤ºå°†ä¸ºç‰¹å®šç›®æ ‡æ‰§è¡Œçš„å‘½ä»¤ï¼Œè€Œä¸å®žé™…æ‰§è¡Œå®ƒä»¬ã€‚è¿™åœ¨ç¼–å†™<em class="filename">makefile</em>æ—¶ç‰¹åˆ«â€‹â€‹æœ‰ä»·å€¼ã€‚è¿˜å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šè®¾ç½®å‡ ä¹Žæ‰€æœ‰<em class="filename">makefileå˜é‡æ¥è¦†ç›–é»˜è®¤å€¼æˆ–</em><em class="filename">makefile</em>ä¸­è®¾ç½®çš„å€¼
        ã€‚</p><p><em class="command">make</em> has many command-line
        options. One of the most useful is <code class="option">â€”just-print</code> (or
        <code class="option">-n</code>) which tells <em class="command">make</em> to display the commands it would
        execute for a particular target without actually executing them. This
        is particularly valuable while writing <em class="filename">makefile</em>s. It is also possible to set
        almost any <em class="filename">makefile</em> variable on
        the command line to override the default value or the value set in the
        <em class="filename">makefile</em>.</p></div></div></div>
<div id="OEBPS/ch01s05.html"><div>
<div class="sect1" title="åŸºæœ¬ Makefile è¯­æ³•"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch01s05.html.make3-CHP-1-SECT-5"></a>åŸºæœ¬ Makefile è¯­æ³•</h1><h1 class="title"><a></a>Basic Makefile Syntax</h1></div></div></div><p>çŽ°åœ¨ä½ å·²ç»æœ‰äº†åŸºæœ¬çš„<a id="OEBPS/ch01s05.html.make3-CHP-1-ITERM-819" class="indexterm"></a> <a id="OEBPS/ch01s05.html.make3-CHP-1-ITERM-820" class="indexterm"></a>äº†è§£äº†<em class="command">make</em>
        ä½ å‡ ä¹Žå¯ä»¥ç¼–å†™è‡ªå·±çš„<em class="filename">makefile</em>äº†ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä»‹ç»<em class="filename">makefile</em>çš„è¶³å¤Ÿè¯­æ³•å’Œç»“æž„ï¼Œä»¥ä¾¿æ‚¨å¼€å§‹ä½¿ç”¨<em class="command">make</em>ã€‚</p><p>Now that you have a basic <a class="indexterm"></a> <a class="indexterm"></a>understanding of <em class="command">make</em>
        you can almost write your own <em class="filename">makefile</em>s. Here we'll cover enough of the
        syntax and structure of a <em class="filename">makefile</em> for you to start using <em class="command">make</em>.</p><p><em class="filename">Makefile</em>é€šå¸¸æ˜¯è‡ªä¸Šè€Œä¸‹æž„å»ºçš„ï¼Œå› æ­¤
        <code class="literal">all</code>é»˜è®¤æƒ…å†µä¸‹ä¼šæ›´æ–°æœ€é€šç”¨çš„ç›®æ ‡ï¼ˆé€šå¸¸ç§°ä¸º ï¼‰ã€‚è¶Šæ¥è¶Šè¯¦ç»†çš„ç›®æ ‡éšä¹‹è€Œæ¥çš„æ˜¯ç¨‹åºç»´æŠ¤çš„ç›®æ ‡ï¼Œä¾‹å¦‚<code class="literal">clean</code>åˆ é™¤ä¸éœ€è¦çš„ä¸´æ—¶æ–‡ä»¶çš„ç›®æ ‡ï¼Œæœ€åŽå‡ºçŽ°ã€‚æ­£å¦‚æ‚¨å¯ä»¥ä»Žè¿™äº›ç›®æ ‡åç§°ä¸­çŒœæµ‹åˆ°çš„é‚£æ ·ï¼Œç›®æ ‡ä¸å¿…æ˜¯å®žé™…æ–‡ä»¶ï¼Œä»»ä½•åç§°éƒ½å¯ä»¥ã€‚</p><p><em class="filename">Makefile</em>s are usually
        structured top-down so that the most general target, often called
        <code class="literal">all</code>, is updated by default. More
        and more detailed targets follow with targets for program maintenance,
        such as a <code class="literal">clean</code> target to delete
        unwanted temporary files, coming last. As you can guess from these
        target names, targets do not have to be actual files, any name will
        do.</p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†è§„åˆ™çš„ç®€åŒ–å½¢å¼ã€‚è§„åˆ™çš„æ›´å®Œæ•´ï¼ˆä½†ä»ä¸å®Œå…¨å®Œæ•´ï¼‰çš„å½¢å¼æ˜¯ï¼š</p><p>In the example above we saw a simplified form of a rule. The
        more complete (but still not quite complete) form of a rule is:</p><a id="OEBPS/ch01s05.html.I_1_tt19"></a><pre class="programlisting"><em class="replaceable"><code>target</code></em>
               <sub>1 </sub> 
               <sub>2 </sub><sub>3</sub> : <sub>1 </sub><sub>2 </sub><sub>1 </sub><sub>2 </sub><sub>3</sub><em class="replaceable"><code>target</code></em>
               <sub></sub> 
               <em class="replaceable"><code>target</code></em>
               <sub></sub><em class="replaceable"><code>prerequisite</code></em>
               <sub></sub> 
               <em class="replaceable"><code>prerequisite</code></em>
               <sub></sub>
               <em class="replaceable"><code>command</code></em>
               <sub></sub>
               <em class="replaceable"><code>command</code></em>
               <sub></sub>
               <em class="replaceable"><code>command</code></em>
               <sub></sub></pre><pre class="programlisting"><em class="replaceable"><code>target</code></em>
               <sub>1</sub> 
               <em class="replaceable"><code>target</code></em>
               <sub>2</sub> 
               <em class="replaceable"><code>target</code></em>
               <sub>3</sub> : <em class="replaceable"><code>prerequisite</code></em>
               <sub>1</sub> 
               <em class="replaceable"><code>prerequisite</code></em>
               <sub>2</sub>
               <em class="replaceable"><code>command</code></em>
               <sub>1</sub>
               <em class="replaceable"><code>command</code></em>
               <sub>2</sub>
               <em class="replaceable"><code>command</code></em>
               <sub>3</sub></pre><p>ä¸€ä¸ªæˆ–å¤šä¸ªç›®æ ‡å‡ºçŽ°åœ¨å†’å·å·¦ä¾§ï¼Œé›¶ä¸ªæˆ–å¤šä¸ªå…ˆå†³æ¡ä»¶å¯ä»¥å‡ºçŽ°åœ¨å†’å·å³ä¾§ã€‚å¦‚æžœå³ä¾§æ²¡æœ‰åˆ—å‡ºå…ˆå†³æ¡ä»¶ï¼Œåˆ™ä»…æ›´æ–°ä¸å­˜åœ¨çš„ç›®æ ‡ã€‚æ›´æ–°ç›®æ ‡æ‰€æ‰§è¡Œçš„å‘½ä»¤é›†æ˜¯<a id="OEBPS/ch01s05.html.make3-CHP-1-ITERM-821" class="indexterm"></a> <a id="OEBPS/ch01s05.html.make3-CHP-1-ITERM-822" class="indexterm"></a>æœ‰æ—¶ç§°ä¸º<em class="firstterm">å‘½ä»¤è„šæœ¬</em>ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹åªæ˜¯
        <span class="emphasis"><em>å‘½ä»¤</em></span>ã€‚</p><p>One or more targets appear to the left of the colon and zero or
        more prerequisites can appear to the right of the colon. If no
        prerequisites are listed to the right, then only the target(s) that do
        not exist are updated. The set of commands executed to update a target
        are <a class="indexterm"></a> <a class="indexterm"></a>sometimes called the <em class="firstterm">command
        script</em>, but most often just the
        <span class="emphasis"><em>commands</em></span>.</p><p>æ¯ä¸ªå‘½ä»¤<span class="emphasis"><em>å¿…é¡»</em></span>ä»¥åˆ¶è¡¨ç¬¦å¼€å¤´ã€‚è¿™ä¸ªï¼ˆæ¨¡ç³Šçš„ï¼‰è¯­æ³•å‘Šè¯‰<em class="command">make</em>åˆ¶è¡¨ç¬¦åŽé¢çš„å­—ç¬¦å°†è¢«ä¼ é€’åˆ°å­ shell ä¸­æ‰§è¡Œã€‚å¦‚æžœæ‚¨ä¸å°å¿ƒæ’å…¥åˆ¶è¡¨ç¬¦ä½œä¸ºéžå‘½ä»¤è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œåˆ™åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹<em class="command">make</em>ä¼šå°†ä»¥ä¸‹æ–‡æœ¬è§£é‡Šä¸ºå‘½ä»¤ã€‚å¦‚æžœæ‚¨å¾ˆå¹¸è¿å¹¶ä¸”é”™è¯¯çš„åˆ¶è¡¨ç¬¦è¢«è¯†åˆ«ä¸ºè¯­æ³•é”™è¯¯ï¼Œæ‚¨å°†æ”¶åˆ°ä»¥ä¸‹æ¶ˆæ¯ï¼š</p><p>Each command <span class="emphasis"><em>must</em></span> begin with a tab
        character. This (obscure) syntax tells <em class="command">make</em> that the characters that follow the tab
        are to be passed to a subshell for execution. If you accidentally
        insert a tab as the first character of a noncommand line, <em class="command">make</em> will interpret the following text as a
        command under most circumstances. If you're lucky and your errant tab
        character is recognized as a syntax error you will receive the
        message:</p><a id="OEBPS/ch01s05.html.I_1_tt20"></a><pre class="programlisting">$ <strong class="userinput"><code>make</code></strong>
Makefile:6: *** å‘½ä»¤åœ¨ç¬¬ä¸€ä¸ªç›®æ ‡ä¹‹å‰å¼€å§‹ã€‚åœæ­¢ã€‚</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
Makefile:6: *** commands commence before first target.  Stop.</pre><p><a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™">æˆ‘ä»¬å°†åœ¨ç¬¬ 2 ç« </a>ä¸­è®¨è®ºåˆ¶è¡¨ç¬¦çš„å¤æ‚æ€§ã€‚</p><p>We'll discuss the complexities of the tab character in <a class="link" href="#OEBPS/ch02.html" title="Chapter&nbsp;2.&nbsp;Rules">Chapter 2</a>.</p><p>è¯„è®ºå­—ç¬¦<a id="OEBPS/ch01s05.html.make3-CHP-1-ITERM-823" class="indexterm"></a> <a id="OEBPS/ch01s05.html.make3-CHP-1-ITERM-824" class="indexterm"></a>å¯¹äºŽ<em class="command">make</em>æ¥è¯´æ˜¯å“ˆå¸Œå€¼æˆ–äº•å·ï¼Œ.ä»Žäº•å·åˆ°è¡Œå°¾çš„æ‰€æœ‰æ–‡æœ¬éƒ½å°†è¢«å¿½ç•¥ã€‚æ³¨é‡Šå¯ä»¥ç¼©è¿›ï¼Œå¹¶ä¸”å¿½ç•¥å‰å¯¼ç©ºæ ¼ã€‚æ³¨é‡Šå­—ç¬¦ä¸ä¼šåœ¨å‘½ä»¤æ–‡æœ¬ä¸­å¼•å…¥<em class="command">make</em>æ³¨é‡Šã€‚æ•´è¡Œï¼ˆåŒ…æ‹¬ å’ŒåŽç»­å­—ç¬¦ï¼‰å°†ä¼ é€’ç»™ shell æ‰§è¡Œã€‚å¦‚ä½•å¤„ç†å–å†³äºŽä½ çš„ shellã€‚</p><p>The comment character <a class="indexterm"></a> <a class="indexterm"></a>for <em class="command">make</em> is the hash
        or pound sign, . All text from the pound sign to the end of line is
        ignored. Comments can be indented and leading whitespace is ignored.
        The comment character does not introduce a <em class="command">make</em> comment in the text of commands. The
        entire line, including the and subsequent characters, is passed to the
        shell for execution. How it is handled there depends on your
        shell.</p><p>é•¿é˜Ÿå¯ä»¥ç»§ç»­<a id="OEBPS/ch01s05.html.make3-CHP-1-ITERM-825" class="indexterm"></a>ä½¿ç”¨æ ‡å‡† Unix è½¬ä¹‰å­—ç¬¦åæ–œæ  (\)ã€‚ä»¥è¿™ç§æ–¹å¼ç»§ç»­å‘½ä»¤æ˜¯å¾ˆå¸¸è§çš„ã€‚å…ˆå†³æ¡ä»¶åˆ—è¡¨ç”¨åæ–œæ ç»§ç»­ä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ã€‚ç¨åŽæˆ‘ä»¬å°†ä»‹ç»å¤„ç†é•¿å…ˆå†³æ¡ä»¶åˆ—è¡¨çš„å…¶ä»–æ–¹æ³•ã€‚</p><p>Long lines can be continued <a class="indexterm"></a>using the standard Unix escape character backslash (\).
        It is common for commands to be continued in this way. It is also
        common for lists of prerequisites to be continued with backslash.
        Later we'll cover other ways of handling long prerequisite
        lists.</p><p>æ‚¨çŽ°åœ¨å·²ç»æœ‰äº†è¶³å¤Ÿçš„èƒŒæ™¯æ¥ç¼–å†™ç®€å•çš„<em class="filename">makefile</em>ã€‚<a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™">ç¬¬ 2 ç« </a>å°†è¯¦ç»†ä»‹ç»è§„åˆ™ï¼Œç„¶åŽæ˜¯<a class="link" href="#OEBPS/ch03.html" title="Chapter&nbsp;3.&nbsp;Variables and Macros">ç¬¬ 3 ç« ä¸­çš„</a><em class="command">make</em>å˜é‡å’Œ<a class="link" href="#OEBPS/ch05.html" title="Chapter&nbsp;5.&nbsp;Commands">ç¬¬ 5 ç« </a>ä¸­çš„å‘½ä»¤ã€‚çŽ°åœ¨æ‚¨åº”è¯¥é¿å…ä½¿ç”¨å˜é‡ã€å®å’Œå¤šè¡Œå‘½ä»¤åºåˆ—ã€‚<a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®"></a><a class="link" href="#OEBPS/ch05.html" title="ç¬¬ 5 ç« å‘½ä»¤"></a></p><p>You now have enough background to write simple <em class="filename">makefile</em>s. <a class="link" href="#OEBPS/ch02.html" title="Chapter&nbsp;2.&nbsp;Rules">Chapter 2</a> will cover rules in detail,
        followed by <em class="command">make</em> variables in <a class="link" href="#OEBPS/ch03.html" title="Chapter&nbsp;3.&nbsp;Variables and Macros">Chapter 3</a> and commands in <a class="link" href="#OEBPS/ch05.html" title="Chapter&nbsp;5.&nbsp;Commands">Chapter 5</a>. For now you should avoid the
        use of variables, macros, and multiline command sequences.</p></div></div></div>
<div id="OEBPS/ch02.html"><div>
<div class="chapter" title="ç¬¬ 2 ç«  è§„åˆ™"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch02.html.make3-CHP-2"></a>ç¬¬ 2 ç«  è§„åˆ™</h1><h1 class="title"><a></a>Chapter&nbsp;2.&nbsp;Rules</h1></div></div></div><p>åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€äº›è§„åˆ™æ¥ç¼–è¯‘å’Œé“¾æŽ¥æˆ‘ä»¬çš„å­—æ•°ç»Ÿè®¡ç¨‹åºã€‚è¿™äº›è§„åˆ™ä¸­çš„æ¯ä¸€ä¸ªéƒ½å®šä¹‰ä¸€ä¸ªç›®æ ‡ï¼Œå³è¦æ›´æ–°çš„æ–‡ä»¶ã€‚æ¯ä¸ªç›®æ ‡æ–‡ä»¶éƒ½ä¾èµ–äºŽä¸€ç»„å…ˆå†³æ¡ä»¶ï¼Œè¿™äº›å…ˆå†³æ¡ä»¶ä¹Ÿæ˜¯æ–‡ä»¶ã€‚å½“è¦æ±‚æ›´æ–°ç›®æ ‡æ—¶ï¼Œå¦‚æžœä»»ä½•å…ˆå†³æ¡ä»¶æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´æ¯”ç›®æ ‡æ›´æ–°ï¼Œ<em class="command">åˆ™ make</em>å°†æ‰§è¡Œè§„åˆ™çš„å‘½ä»¤è„šæœ¬ã€‚ç”±äºŽä¸€ä¸ªè§„åˆ™çš„ç›®æ ‡å¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªè§„åˆ™çš„å…ˆå†³æ¡ä»¶è¿›è¡Œå¼•ç”¨ï¼Œå› æ­¤ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶é›†å½¢æˆ<em class="firstterm">ä¾èµ–å…³ç³»</em>é“¾æˆ–ä¾èµ–å…³ç³»å›¾ï¼ˆâ€œä¾èµ–å…³ç³»å›¾â€çš„ç¼©å†™ï¼‰ã€‚æž„å»ºå’Œå¤„ç†æ­¤ä¾èµ–å…³ç³»å›¾ä»¥æ›´æ–°è¯·æ±‚çš„ç›®æ ‡å°±æ˜¯<em class="command">make çš„</em>å…¨éƒ¨å†…å®¹ã€‚</p><p>In the last chapter, we wrote some rules to compile and link our
      word-counting program. Each of those rules defines a target, that is, a
      file to be updated. Each target file depends on a set of prerequisites,
      which are also files. When asked to update a target, <em class="command">make</em> will execute the command script of the
      rule if any of the prerequisite files has been modified more recently
      than the target. Since the target of one rule can be referenced as a
      prerequisite in another rule, the set of targets and prerequisites form
      a chain or graph of <em class="firstterm">dependencies</em> (short for
      "dependency graph"). Building and processing this dependency graph to
      update the requested target is what <em class="command">make</em> is all about.</p><p><em class="command">ç”±äºŽè§„åˆ™åœ¨make</em>ä¸­éžå¸¸é‡è¦ï¼Œå› æ­¤æœ‰è®¸å¤šä¸åŒç±»åž‹çš„è§„åˆ™ã€‚<em class="firstterm">æ˜Žç¡®çš„è§„åˆ™</em>ï¼Œå°±åƒé‚£äº›<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-826" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-827" class="indexterm"></a>åœ¨é‡Œé¢<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-828" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-829" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-830" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-831" class="indexterm"></a>å‰ä¸€ç« æŒ‡å‡ºäº†è¦æ›´æ–°çš„å…·ä½“ç›®æ ‡ï¼ˆå¦‚æžœå…¶ä»»ä½•å…ˆå†³æ¡ä»¶å·²è¿‡æ—¶ï¼‰ã€‚è¿™æ˜¯æ‚¨å°†è¦ç¼–å†™çš„æœ€å¸¸è§çš„è§„åˆ™ç±»åž‹ã€‚<em class="firstterm">æ¨¡å¼è§„åˆ™</em>ä½¿ç”¨<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-832" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-833" class="indexterm"></a>é€šé…ç¬¦è€Œä¸æ˜¯æ˜Žç¡®çš„æ–‡ä»¶åã€‚è¿™å…è®¸
      <em class="command">make</em>åœ¨ä»»ä½•éœ€è¦æ›´æ–°ä¸Žæ¨¡å¼åŒ¹é…çš„ç›®æ ‡æ–‡ä»¶æ—¶åº”ç”¨è¯¥è§„åˆ™ã€‚<em class="firstterm">éšå«è§„åˆ™</em> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-834" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-835" class="indexterm"></a><em class="command">æ˜¯åœ¨make</em>å†…ç½®çš„è§„åˆ™æ•°æ®åº“ä¸­æ‰¾åˆ°çš„æ¨¡å¼è§„åˆ™æˆ–åŽç¼€è§„åˆ™ã€‚æ‹¥æœ‰å†…ç½®çš„è§„åˆ™æ•°æ®åº“ä½¿ç¼–å†™<em class="filename">makefile</em>å˜å¾—æ›´åŠ å®¹æ˜“ï¼Œå› ä¸ºå¯¹äºŽè®¸å¤šå¸¸è§ä»»åŠ¡ï¼Œ
       <em class="command">make</em>å·²ç»çŸ¥é“æ–‡ä»¶ç±»åž‹ã€åŽç¼€å’Œç”¨äºŽæ›´æ–°ç›®æ ‡çš„ç¨‹åºã€‚<em class="firstterm">é™æ€æ¨¡å¼è§„åˆ™</em>æ˜¯<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-836" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-837" class="indexterm"></a>ä¸Žå¸¸è§„æ¨¡å¼è§„åˆ™ç±»ä¼¼ï¼Œåªä¸è¿‡å®ƒä»¬ä»…é€‚ç”¨äºŽç‰¹å®šçš„ç›®æ ‡æ–‡ä»¶åˆ—è¡¨ã€‚</p><p>Since rules are so important in <em class="command">make</em>, there are a number of different kinds of
      rules. <em class="firstterm">Explicit rules</em>, like the ones <a class="indexterm"></a> <a class="indexterm"></a>in the <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>previous chapter, indicate a specific target to be updated
      if it is out of date with respect to any of its prerequisites. This is
      the most common type of rule you will be writing. <em class="firstterm">Pattern
      rules</em> use <a class="indexterm"></a> <a class="indexterm"></a>wildcards instead of explicit filenames. This allows
      <em class="command">make</em> to apply the rule any time a
      target file matching the pattern needs to updated. <em class="firstterm">Implicit
      rules</em> <a class="indexterm"></a> <a class="indexterm"></a>are either pattern rules or suffix rules found in the
      rules database built-in to <em class="command">make</em>.
      Having a built-in database of rules makes writing <em class="filename">makefile</em>s easier since for many common tasks
      <em class="command">make</em> already knows the file types,
      suffixes, and programs for updating targets. <em class="firstterm">Static pattern
      rules</em> are <a class="indexterm"></a> <a class="indexterm"></a>like regular pattern rules except they apply only to a
      specific list of target files.</p><p><acronym class="acronym">GNU </acronym> <em class="command">make</em>å¯ä»¥ç”¨ä½œè®¸å¤šå…¶ä»–ç‰ˆæœ¬çš„<em class="command">make</em>çš„â€œç›´æŽ¥â€æ›¿ä»£å“ï¼Œå¹¶åŒ…å«ä¸€äº›ä¸“é—¨ç”¨äºŽ<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-838" class="indexterm"></a>å…¼å®¹æ€§ã€‚<em class="firstterm">åŽç¼€è§„åˆ™</em>æ˜¯
      <em class="command">make</em>ç¼–å†™é€šç”¨è§„åˆ™çš„åŽŸå§‹æ–¹æ³•ã€‚<acronym class="acronym">GNU </acronym> <em class="command">make</em>åŒ…å«å¯¹åŽç¼€è§„åˆ™çš„æ”¯æŒï¼Œä½†å®ƒä»¬è¢«è®¤ä¸ºå·²è¿‡æ—¶ï¼Œå·²è¢«æ›´æ¸…æ™°ã€æ›´é€šç”¨çš„æ¨¡å¼è§„åˆ™æ‰€å–ä»£ã€‚</p><p><acronym class="acronym">GNU</acronym> <em class="command">make</em> can
      be used as a "drop in" replacement for many other versions of <em class="command">make</em> and includes several features
      specifically for <a class="indexterm"></a>compatibility. <em class="firstterm">Suffix rules</em> were
      <em class="command">make</em>'s original means for writing
      general rules. <acronym class="acronym">GNU</acronym> <em class="command">make</em> includes support for suffix rules, but
      they are considered obsolete having been replaced by pattern rules that
      are clearer and more general.</p><div class="sect1" title="æ˜Žç¡®çš„è§„åˆ™"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch02.html.make3-CHP-2-SECT-1"></a>æ˜Žç¡®çš„è§„åˆ™</h1><h1 class="title"><a></a>Explicit Rules</h1></div></div></div><p>æ‚¨å°†ç¼–å†™çš„å¤§å¤šæ•°è§„åˆ™éƒ½æ˜¯æ˜¾å¼è§„åˆ™<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-839" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-840" class="indexterm"></a>æŒ‡å®šç‰¹å®šæ–‡ä»¶ä½œä¸ºç›®æ ‡å’Œå…ˆå†³æ¡ä»¶ã€‚ä¸€é¡¹è§„åˆ™å¯ä»¥æœ‰å¤šä¸ªç›®æ ‡ã€‚è¿™æ„å‘³ç€
        <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-841" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-842" class="indexterm"></a>æ¯ä¸ªç›®æ ‡éƒ½ä¸Žå…¶ä»–ç›®æ ‡å…·æœ‰ç›¸åŒçš„å…ˆå†³æ¡ä»¶ã€‚å¦‚æžœç›®æ ‡å·²è¿‡æœŸï¼Œå°†æ‰§è¡Œç›¸åŒçš„ä¸€ç»„æ“ä½œæ¥æ›´æ–°æ¯ä¸ªç›®æ ‡ã€‚ä¾‹å¦‚ï¼š</p><p>Most rules you will write are explicit rules <a class="indexterm"></a> <a class="indexterm"></a>that specify particular files as targets and
        prerequisites. A rule can have more than one target. This means
        <a class="indexterm"></a> <a class="indexterm"></a>that each target has the same set of prerequisites as
        the others. If the targets are out of date, the same set of actions
        will be performed to update each one. For instance:</p><a id="OEBPS/ch02.html.I_2_tt21"></a><pre class="programlisting">vpath.o å˜é‡.o: make.h config.h getopt.h gettext.h dep.h</pre><pre class="programlisting">vpath.o variable.o: make.h config.h getopt.h gettext.h dep.h</pre><p>è¿™è¡¨æ˜Ž<em class="filename">vpath.o</em>å’Œ<em class="filename">variable.o</em>éƒ½ä¾èµ–äºŽåŒä¸€ç»„Cå¤´æ–‡ä»¶ã€‚è¯¥è¡Œå…·æœ‰ä¸Žä»¥ä¸‹ç›¸åŒçš„æ•ˆæžœï¼š</p><p>This indicates that both <em class="filename">vpath.o</em> and <em class="filename">variable.o</em> depend on the same set of C
        header files. This line has the same effect as:</p><a id="OEBPS/ch02.html.I_2_tt22"></a><pre class="programlisting">vpath.o: make.h config.h getopt.h gettext.h dep.h
å˜é‡.oï¼šmake.h config.h getopt.h gettext.h dep.h</pre><pre class="programlisting">vpath.o: make.h config.h getopt.h gettext.h dep.h
variable.o: make.h config.h getopt.h gettext.h dep.h</pre><p>è¿™ä¸¤ä¸ªç›®æ ‡æ˜¯ç‹¬ç«‹å¤„ç†çš„ã€‚å¦‚æžœä»»ä¸€ç›®æ ‡æ–‡ä»¶ç›¸å¯¹äºŽå…¶ä»»ä½•å…ˆå†³æ¡ä»¶è€Œè¨€å·²ç»è¿‡æ—¶ï¼ˆå³ä»»ä½•å¤´æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´éƒ½æ¯”ç›®æ ‡æ–‡ä»¶æ›´æ–°ï¼‰ï¼Œ
        <em class="command">åˆ™ make</em>å°†é€šè¿‡æ‰§è¡Œä¸Žè§„åˆ™å…³è”çš„å‘½ä»¤æ¥æ›´æ–°ç›®æ ‡æ–‡ä»¶ã€‚</p><p>The two targets are handled independently. If either object file
        is out of date with respect to any of its prerequisites (that is, any
        header file has a newer modification time than the object file),
        <em class="command">make</em> will update the object file by
        executing the commands associated with the rule.</p><p>è§„åˆ™ä¸å¿…â€œä¸€æ¬¡æ€§â€å®šä¹‰ã€‚æ¯æ¬¡
        <em class="command">make</em>çœ‹åˆ°ç›®æ ‡æ–‡ä»¶æ—¶ï¼Œå®ƒéƒ½ä¼šå°†ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶æ·»åŠ åˆ°ä¾èµ–å…³ç³»å›¾ä¸­ã€‚å¦‚æžœç›®æ ‡å·²è¢«å‘çŽ°å¹¶å­˜åœ¨äºŽå›¾ä¸­ï¼Œåˆ™ä»»ä½•å…¶ä»–å…ˆå†³æ¡ä»¶éƒ½ä¼šé™„åŠ åˆ°<em class="command">make</em>çš„ä¾èµ–å…³ç³»å›¾ä¸­çš„ç›®æ ‡æ–‡ä»¶æ¡ç›®ã€‚åœ¨ç®€å•çš„æƒ…å†µä¸‹ï¼Œè¿™å¯¹äºŽè‡ªç„¶åœ°æ‰“ç ´é•¿è¡Œä»¥æé«˜<em class="filename">makefile</em>çš„å¯è¯»æ€§å¾ˆæœ‰ç”¨ï¼š</p><p>A rule does not have to be defined "all at once." Each time
        <em class="command">make</em> sees a target file it adds the
        target and prerequisites to the dependency graph. If a target has
        already been seen and exists in the graph, any additional
        prerequisites are appended to the target file entry in <em class="command">make</em>'s dependency graph. In the simple case,
        this is useful for breaking long lines naturally to improve the
        readability of the <em class="filename">makefile</em>:</p><a id="OEBPS/ch02.html.I_2_tt23"></a><pre class="programlisting">vpath.o: vpath.c make.h config.h getopt.h gettext.h dep.h
vpath.o: filedef.h hash.h job.h å‘½ä»¤.h å˜é‡.h vpath.h</pre><pre class="programlisting">vpath.o: vpath.c make.h config.h getopt.h gettext.h dep.h
vpath.o: filedef.h hash.h job.h commands.h variable.h vpath.h</pre><p>åœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹ï¼Œå…ˆå†³æ¡ä»¶åˆ—è¡¨å¯ä»¥ç”±ç®¡ç†æ–¹å¼æˆªç„¶ä¸åŒçš„æ–‡ä»¶ç»„æˆï¼š</p><p>In more complex cases, the prerequisite list can be composed of
        files that are managed very differently:</p><a id="OEBPS/ch02.html.I_2_tt24"></a><pre class="programlisting"># ç¡®ä¿åœ¨ç¼–è¯‘ vpath.c ä¹‹å‰åˆ›å»º lexer.cã€‚
vpath.o: è¯æ³•åˆ†æžå™¨.c
...
# ä½¿ç”¨ç‰¹æ®Šæ ‡å¿—ç¼–è¯‘ vpath.cã€‚
vpath.o: vpath.c
        $(COMPILE.c) $(RULE_FLAGS) $(OUTPUT_OPTION) $&lt;
...
# åŒ…å«ç¨‹åºç”Ÿæˆçš„ä¾èµ–é¡¹ã€‚
åŒ…æ‹¬è‡ªåŠ¨ç”Ÿæˆçš„ä¾èµ–é¡¹.d</pre><pre class="programlisting"># Make sure lexer.c is created before vpath.c is compiled.
vpath.o: lexer.c
...
# Compile vpath.c with special flags.
vpath.o: vpath.c
        $(COMPILE.c) $(RULE_FLAGS) $(OUTPUT_OPTION) $&lt;
...
# Include dependencies generated by a program.
include auto-generated-dependencies.d</pre><p>ç¬¬ä¸€æ¡è§„åˆ™è¡¨ç¤ºï¼Œæ¯å½“æ›´æ–°<em class="filename">lexer.c</em>æ—¶ï¼Œéƒ½å¿…é¡»æ›´æ–°
        <em class="filename">vpath.oç›®æ ‡ï¼ˆå¯èƒ½æ˜¯å› ä¸ºç”Ÿæˆ</em><em class="filename">lexer.c</em>å…·æœ‰å…¶ä»–å‰¯ä½œç”¨ï¼‰ã€‚è¯¥è§„åˆ™è¿˜å¯ä»¥ç¡®ä¿å…ˆå†³æ¡ä»¶å§‹ç»ˆåœ¨ç›®æ ‡æ›´æ–°ä¹‹å‰æ›´æ–°ã€‚ ï¼ˆæ³¨æ„è§„åˆ™çš„åŒå‘æ€§è´¨ã€‚åœ¨â€œå‘å‰â€æ–¹å‘ï¼Œè§„åˆ™è¡¨ç¤ºå¦‚æžœ lexer.c<em class="filename">å·²</em>æ›´æ–°ï¼Œåˆ™æ‰§è¡Œæ›´æ–°<em class="filename">vpath.o</em>çš„æ“ä½œã€‚åœ¨â€œå‘åŽâ€æ–¹å‘ï¼Œè§„åˆ™è¡¨ç¤ºå¦‚æžœæˆ‘ä»¬éœ€è¦åˆ¶ä½œæˆ–ä½¿ç”¨<em class="filename">vpath.o</em>ç¡®ä¿<em class="filename">lexer.c</em>é¦–å…ˆæ˜¯æœ€æ–°çš„ã€‚ï¼‰æ­¤è§„åˆ™å¯èƒ½ä¼šæ”¾ç½®åœ¨ç®¡ç†<em class="filename">lexer.c</em>çš„è§„åˆ™é™„è¿‘ï¼Œä»¥ä¾¿æé†’å¼€å‘äººå‘˜è¿™ç§å¾®å¦™çš„å…³ç³»ã€‚éšåŽï¼Œ <em class="filename">vpath.o</em>çš„ç¼–è¯‘è§„åˆ™è¢«æ”¾ç½®åœ¨å…¶ä»–ç¼–è¯‘è§„åˆ™ä¸­ã€‚æ­¤è§„åˆ™çš„å‘½ä»¤ä½¿ç”¨ä¸‰ä¸ª<em class="command">make</em>å˜é‡ã€‚æ‚¨å°†çœ‹åˆ°å¾ˆå¤šè¿™æ ·çš„å˜é‡ï¼Œä½†çŽ°åœ¨æ‚¨åªéœ€è¦çŸ¥é“å˜é‡æ˜¯ç¾Žå…ƒç¬¦å·åŽè·Ÿå•ä¸ªå­—ç¬¦æˆ–ç¾Žå…ƒç¬¦å·åŽè·Ÿæ‹¬å·ä¸­çš„å•è¯ã€‚ ï¼ˆæˆ‘å°†åœ¨æœ¬ç« åŽé¢è§£é‡Šæ›´å¤šå†…å®¹ï¼Œå¹¶åœ¨<a class="link" href="#OEBPS/ch03.html" title="Chapter&nbsp;3.&nbsp;Variables and Macros">ç¬¬ 3 ç« </a>ä¸­è§£é‡Šæ›´å¤šå†…å®¹ã€‚ï¼‰æœ€åŽï¼Œ<em class="filename">.o</em> / <em class="filename">.h</em>ä¾èµ–é¡¹åŒ…å«åœ¨
        ç”±å¤–éƒ¨ç¨‹åºç®¡ç†çš„å•ç‹¬æ–‡ä»¶çš„<em class="filename">makefileä¸­ã€‚</em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="command"></em><a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®"></a><em class="filename"></em><em class="filename"></em><em class="filename"></em></p><p>The first rule says that the <em class="filename">vpath.o</em> target must be updated whenever
        <em class="filename">lexer.c</em> is updated (perhaps
        because generating <em class="filename">lexer.c</em> has
        other side effects). The rule also works to ensure that a prerequisite
        is always updated before the target is updated. (Notice the
        bidirectional nature of rules. In the "forward" direction the rule
        says that if the <em class="filename">lexer.c</em> has been
        updated, perform the action to update <em class="filename">vpath.o</em>. In the "backward" direction, the
        rule says that if we need to make or use <em class="filename">vpath.o</em> ensure that <em class="filename">lexer.c</em> is up to date first.) This rule
        might be placed near the rules for managing <em class="filename">lexer.c</em> so developers are reminded of this
        subtle relationship. Later, the compilation rule for <em class="filename">vpath.o</em> is placed among other compilation
        rules. The command for this rule uses three <em class="command">make</em> variables. You'll be seeing a lot of
        these, but for now you just need to know that a variable is either a
        dollar sign followed by a single character or a dollar sign followed
        by a word in parentheses. (I will explain more later in this chapter
        and a lot more in <a class="link" href="#OEBPS/ch03.html" title="Chapter&nbsp;3.&nbsp;Variables and Macros">Chapter 3</a>.)
        Finally, the <em class="filename">.o</em>/<em class="filename">.h</em> dependencies are included in the
        <em class="filename">makefile</em> from a separate file
        managed by an external program.</p><div class="sect2" title="é€šé…ç¬¦"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch02.html.make3-CHP-2-SECT-1.1"></a>é€šé…ç¬¦</h2><h2 class="title"><a></a>Wildcards</h2></div></div></div><p>ä¸€ä¸ª<em class="filename">makefile</em>é€šå¸¸åŒ…å«<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-843" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-844" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-845" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-846" class="indexterm"></a>é•¿çš„<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-847" class="indexterm"></a>æ–‡ä»¶åˆ—è¡¨ã€‚ä¸ºäº†ç®€åŒ–æ­¤è¿‡ç¨‹ï¼Œ<em class="command">make</em>æ”¯æŒé€šé…ç¬¦ï¼ˆä¹Ÿç§°ä¸º
          <em class="firstterm">globbing</em>ï¼‰ã€‚<em class="command">make</em>çš„é€šé…ç¬¦ä¸Ž Bourne shell çš„é€šé…ç¬¦ç›¸åŒï¼š<code class="literal">~</code>ã€<code class="literal">*</code>ã€<code class="literal">?</code>ã€
          <code class="literal">[...]</code>å’Œ<code class="literal">[^...]</code>ã€‚ä¾‹å¦‚ï¼Œ<code class="literal">*.*</code>æ‰©å±•åˆ°åŒ…å«å¥ç‚¹çš„æ‰€æœ‰æ–‡ä»¶ã€‚ä¸€ä¸ªé—®å·<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-848" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-849" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-850" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-851" class="indexterm"></a>ä»£è¡¨ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œ<code class="literal">[...]</code>ä»£è¡¨ä¸€ä¸ª<em class="firstterm">å­—ç¬¦ç±»</em>ã€‚è¦é€‰æ‹©â€œç›¸åâ€ï¼ˆå¦å®šï¼‰å­—ç¬¦ç±»ï¼Œè¯·ä½¿ç”¨<code class="literal">[^...]</code>ã€‚</p><p>A <em class="filename">makefile</em> often
          contains<a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> long <a class="indexterm"></a>lists of files. To simplify this process <em class="command">make</em> supports wildcards (also known as
          <em class="firstterm">globbing</em>). <em class="command">make</em>'s wildcards are identical to the
          Bourne shell's: <code class="literal">~</code>, <code class="literal">*</code>, <code class="literal">?</code>,
          <code class="literal">[...]</code>, and <code class="literal">[^...]</code>. For instance, <code class="literal">*.*</code> expands to all the files containing a
          period. A question mark <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>represents any single character, and <code class="literal">[...]</code> represents a <em class="firstterm">character
          class</em>. To select the "opposite" (negated) character
          class use <code class="literal">[^...]</code>.</p><p>æ­¤å¤–ï¼Œæ³¢å½¢ç¬¦ ( <code class="literal">~</code>) å­—ç¬¦<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-852" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-853" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-854" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-855" class="indexterm"></a>å¯ä»¥ç”¨æ¥è¡¨ç¤ºå½“å‰ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚æ³¢æµªå·åŽè·Ÿç”¨æˆ·åä»£è¡¨è¯¥ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚</p><p>In addition, the tilde (<code class="literal">~</code>)
          character <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>can be used to represent the current user's home
          directory. A tilde followed by a user name represents that user's
          home directory.</p><p>åªè¦é€šé…ç¬¦å‡ºçŽ°åœ¨ç›®æ ‡ã€å…ˆå†³æ¡ä»¶æˆ–å‘½ä»¤è„šæœ¬ä¸Šä¸‹æ–‡ä¸­ï¼Œ<em class="command">make</em>å°±ä¼šè‡ªåŠ¨æ‰©å±•é€šé…ç¬¦ã€‚å…¶ä»–<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-856" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-857" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-858" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-859" class="indexterm"></a>åœ¨ä¸Šä¸‹æ–‡ä¸­ï¼Œé€šé…ç¬¦å¯ä»¥é€šè¿‡è°ƒç”¨å‡½æ•°æ¥æ˜¾å¼æ‰©å±•ã€‚é€šé…ç¬¦å¯¹äºŽåˆ›å»ºé€‚åº”æ€§æ›´å¼ºçš„<em class="filename">makefile</em>éžå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼Œè€Œä¸æ˜¯æ˜¾å¼åˆ—å‡ºç¨‹åºä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼š<sup>[ <a id="OEBPS/ch02.html.make3-CHP-2-FNOTE-1" href="#OEBPS/ch02.html.ftn.make3-CHP-2-FNOTE-1" class="footnote">1</a> ]</sup></p><p>Wildcards are automatically expanded by <em class="command">make</em> whenever a wildcard appears in a
          target, prerequisite, or command script context. In other <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>contexts, wildcards can be expanded explicitly by
          calling a function. Wildcards can be very useful for creating more
          adaptable <em class="filename">makefile</em>s. For
          instance, instead of listing all the files in a program explicitly,
          you can use wildcards:<sup>[<a href="#OEBPS/ch02.html.ftn.make3-CHP-2-FNOTE-1" class="footnote">1</a>]</sup></p><a id="OEBPS/ch02.html.I_2_tt25"></a><pre class="programlisting">ç¨‹åºï¼š*.c
        $(CC) -o $@ $^</pre><pre class="programlisting">prog: *.c
        $(CC) -o $@ $^</pre><p>å°å¿ƒä½¿ç”¨é€šé…ç¬¦å¾ˆé‡è¦ï¼Œ<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-860" class="indexterm"></a>ç„¶è€Œã€‚å®ƒä»¬å¾ˆå®¹æ˜“è¢«è¯¯ç”¨ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><p>It is important to be careful with wildcards, <a class="indexterm"></a>however. It is easy to misuse them as the following
          example shows:</p><a id="OEBPS/ch02.html.I_2_tt26"></a><pre class="programlisting">*.oï¼šå¸¸é‡.h</pre><pre class="programlisting">*.o: constants.h</pre><p>æ„å›¾å¾ˆæ˜Žç¡®ï¼šæ‰€æœ‰ç›®æ ‡æ–‡ä»¶éƒ½ä¾èµ–äºŽå¤´æ–‡ä»¶<em class="filename">constant.h</em>ï¼Œä½†è¯·è€ƒè™‘å®ƒå¦‚ä½•åœ¨æ²¡æœ‰ä»»ä½•ç›®æ ‡æ–‡ä»¶çš„å¹²å‡€ç›®å½•ä¸Šæ‰©å±•ï¼š</p><p>The intent is clear: all object files depend on the header
          file <em class="filename">constants.h</em>, but consider
          how this expands on a clean directory without any object
          files:</p><a id="OEBPS/ch02.html.I_2_tt27"></a><pre class="programlisting">ï¼šå¸¸é‡.h</pre><pre class="programlisting">: constants.h</pre><p>è¿™æ˜¯ä¸€ä¸ªåˆæ³•çš„<em class="command">make</em>
          è¡¨è¾¾å¼ï¼Œæœ¬èº«ä¸ä¼šäº§ç”Ÿé”™è¯¯ï¼Œä½†å®ƒä¹Ÿä¸ä¼šæä¾›ç”¨æˆ·æƒ³è¦çš„ä¾èµ–é¡¹ã€‚å®žçŽ°æ­¤è§„åˆ™çš„æ­£ç¡®æ–¹æ³•æ˜¯å¯¹æºæ–‡ä»¶æ‰§è¡Œé€šé…ç¬¦ï¼ˆå› ä¸ºå®ƒä»¬å§‹ç»ˆå­˜åœ¨ï¼‰å¹¶å°†å…¶è½¬æ¢ä¸ºç›®æ ‡æ–‡ä»¶åˆ—è¡¨ã€‚å½“æˆ‘ä»¬åœ¨<a class="link" href="#OEBPS/ch04.html" title="Chapter&nbsp;4.&nbsp;Functions">ç¬¬ 4 ç« è®¨è®º</a><em class="command">make</em>å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å°†ä»‹ç»è¿™é¡¹æŠ€æœ¯ã€‚<a class="link" href="#OEBPS/ch04.html" title="ç¬¬ 4 ç« å‡½æ•°"></a></p><p>This is a legal <em class="command">make</em>
          expression and will not produce an error by itself, but it will also
          not provide the dependency the user wants. The proper way to
          implement this rule is to perform a wildcard on the source files
          (since they are always present) and transform that into a list of
          object files. We will cover this technique when we discuss <em class="command">make</em> functions in <a class="link" href="#OEBPS/ch04.html" title="Chapter&nbsp;4.&nbsp;Functions">Chapter 4</a>.</p><p>å½“ mp_make æ‰©å±•é€šé…ç¬¦æ—¶ï¼ˆæˆ–è€…å®žé™…ä¸Šå½“ mp_make æŸ¥æ‰¾ä»»ä½•æ–‡ä»¶æ—¶ï¼‰ï¼Œå®ƒä¼šè¯»å–å¹¶ç¼“å­˜ç›®å½•å†…å®¹ã€‚è¿™ç§ç¼“å­˜æ˜¾ç€æé«˜äº† mp_make çš„æ€§èƒ½ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦ mp_make è¯»å–å¹¶ç¼“å­˜äº†ç›®å½•å†…å®¹ï¼Œmp_make å°†ä¸ä¼šâ€œçœ‹åˆ°â€å¯¹è¯¥ç›®å½•æ‰€åšçš„ä»»ä½•æ›´æ”¹ã€‚è¿™å¯èƒ½æ˜¯ mp_makefile ä¸­ç¥žç§˜çš„é”™è¯¯æ¥æºã€‚æœ‰æ—¶å¯ä»¥é€šè¿‡ä½¿ç”¨å­ shell å’Œé€šé…ç¬¦ï¼ˆä¾‹å¦‚ shell é€šé…ç¬¦ï¼‰è€Œä¸æ˜¯ mp_make è‡ªå·±çš„é€šé…ç¬¦æ¥è§£å†³è¯¥é—®é¢˜ï¼Œä½†æœ‰æ—¶è¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œæˆ‘ä»¬å¿…é¡»è¯‰è¯¸å¥‡æ€ªçš„æŠ€å·§ã€‚</p><p>When mp_make expands a wildcard (or indeed when mp_make looks
          for any file), it reads and caches the directory contents. This
          caching improves mp_make's performance considerably. However, once
          mp_make has read and cached the directory contents, mp_make will not
          "see" any changes made to the directory. This can be a mysterious
          source of errors in a mp_makefile. The issue can sometimes be
          resolved by using a sub-shell and globbing (e.g., shell wildcards)
          rather than mp_make's own wildcards, but occasionally, this is not
          possible and we must resort to bizarre hacks. </p><p>æœ€åŽï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“æ¨¡å¼ä½œä¸ºç›®æ ‡æˆ–å…ˆå†³æ¡ä»¶å‡ºçŽ°æ—¶ï¼Œ<em class="command">make</em>ä¼šæ‰§è¡Œé€šé…ç¬¦æ‰©å±•ã€‚ä½†æ˜¯ï¼Œå½“è¯¥æ¨¡å¼å‡ºçŽ°åœ¨å‘½ä»¤ä¸­æ—¶ï¼Œæ‰©å±•ç”±å­ shell æ‰§è¡Œã€‚æœ‰æ—¶è¿™å¯èƒ½å¾ˆé‡è¦ï¼Œå› ä¸º<em class="command">makeä¼šåœ¨è¯»å–</em><em class="filename">makefile</em>åŽç«‹å³æ‰©å±•é€šé…ç¬¦ï¼Œä½† shell ä¼šåœ¨æ‰§è¡Œå‘½ä»¤æ—¶å¾ˆæ™šæ‰æ‰©å±•å‘½ä»¤ä¸­çš„é€šé…ç¬¦ã€‚å½“è¿›è¡Œå¤§é‡å¤æ‚çš„æ–‡ä»¶æ“ä½œæ—¶ï¼Œä¸¤ä¸ªé€šé…ç¬¦æ‰©å±•å¯èƒ½ä¼šæœ‰å¾ˆå¤§ä¸åŒã€‚</p><p>Finally, it is worth noting that wildcard expansion is
          performed by <em class="command">make</em> when the
          pattern appears as a target or prerequisite. However, when the
          pattern appears in a command, the expansion is performed by the
          subshell. This can occasionally be important because <em class="command">make</em> will expand the wildcards immediately
          upon reading the <em class="filename">makefile</em>, but
          the shell will expand the wildcards in commands much later when the
          command is executed. When a lot of complex file manipulation is
          being done, the two wildcard expansions can be quite
          different.</p></div><div class="sect2" title="è™šå‡ç›®æ ‡"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch02.html.make3-CHP-2-SECT-1.2"></a>è™šå‡ç›®æ ‡</h2><h2 class="title"><a></a>Phony Targets</h2></div></div></div><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‰€æœ‰ç›®æ ‡å’Œ<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-861" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-862" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-863" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-864" class="indexterm"></a>å…ˆå†³æ¡ä»¶æ˜¯è¦åˆ›å»ºæˆ–æ›´æ–°çš„æ–‡ä»¶ã€‚è¿™æ˜¯å…¸åž‹çš„æƒ…å†µï¼Œä½†å¯¹äºŽä»…ä»£è¡¨å‘½ä»¤è„šæœ¬çš„æ ‡ç­¾æ¥è¯´ï¼Œç›®æ ‡é€šå¸¸å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œä¹‹å‰æˆ‘ä»¬æ³¨æ„åˆ°è®¸å¤š
          <em class="filename">makefile</em>ä¸­çš„æ ‡å‡†ç¬¬ä¸€ä¸ªç›®æ ‡ç§°ä¸º<code class="literal">all</code>ã€‚ä¸ä»£è¡¨æ–‡ä»¶çš„ç›®æ ‡ç§°ä¸º<em class="firstterm">è™šå‡ç›®æ ‡</em>ã€‚å¦ä¸€ä¸ªæ ‡å‡†çš„è™šå‡ç›®æ ‡æ˜¯<code class="literal">clean</code>ï¼š</p><p>Until now all targets and <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>prerequisites have been files to be created or
          updated. This is typically the case, but it is often useful for a
          target to be just a label representing a command script. For
          instance, earlier we noted that a standard first target in many
          <em class="filename">makefile</em>s is called <code class="literal">all</code>. Targets that do not represent files
          are known as <em class="firstterm">phony targets</em>. Another standard
          phony target is <code class="literal">clean</code>:</p><a id="OEBPS/ch02.html.I_2_tt28"></a><pre class="programlisting">å¹²å‡€çš„ï¼š
        rm -f *.o è¯æ³•åˆ†æžå™¨.c</pre><pre class="programlisting">clean:
        rm -f *.o lexer.c</pre><p>é€šå¸¸ï¼Œè™šå‡ç›®æ ‡å°†å§‹ç»ˆè¢«æ‰§è¡Œï¼Œå› ä¸ºä¸Žè§„åˆ™å…³è”çš„å‘½ä»¤ä¸ä¼šåˆ›å»ºç›®æ ‡åç§°ã€‚</p><p>Normally, phony targets will always be executed because the
          commands associated with the rule do not create the target
          name.</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<em class="command">make</em>æ— æ³•åŒºåˆ†æ–‡ä»¶ç›®æ ‡å’Œè™šå‡ç›®æ ‡ã€‚å¦‚æžœå‡å†’ç›®æ ‡çš„åç§°å¶ç„¶ä»¥æ–‡ä»¶å½¢å¼å­˜åœ¨ï¼Œåˆ™<em class="command">make</em>ä¼šå°†è¯¥æ–‡ä»¶ä¸Žå…¶ä¾èµ–å…³ç³»å›¾ä¸­çš„å‡å†’ç›®æ ‡åç§°å…³è”èµ·æ¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœè¿è¡Œ<em class="command">make </em><em class="command">clean</em>ç¢°å·§åˆ›å»ºäº†
          <em class="filename">clean</em>æ–‡ä»¶ï¼Œåˆ™ä¼šäº§ç”Ÿä»¤äººå›°æƒ‘çš„æ¶ˆæ¯ï¼š<em class="command"></em> <em class="command"></em></p><p>It is important to note that <em class="command">make</em> cannot distinguish between a file
          target and phony target. If by chance the name of a phony target
          exists as a file, <em class="command">make</em> will
          associate the file with the phony target name in its dependency
          graph. If, for example, the file <em class="filename">clean</em> happened to be created running
          <em class="command">make</em> <em class="command">clean</em> would yield the confusing
          message:</p><a id="OEBPS/ch02.html.I_2_tt29"></a><pre class="programlisting">$ æ¸…ç†å¹²å‡€
makeï¼šâ€œcleanâ€æ˜¯æœ€æ–°çš„ã€‚</pre><pre class="programlisting">$ make clean
make: `clean' is up to date.</pre><p>ç”±äºŽå¤§å¤šæ•°è™šå‡ç›®æ ‡ä¸<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-865" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-866" class="indexterm"></a>å¦‚æžœæœ‰å…ˆå†³æ¡ä»¶ï¼Œ<code class="literal">clean</code>ç›®æ ‡å°†å§‹ç»ˆè¢«è®¤ä¸ºæ˜¯æœ€æ–°çš„å¹¶ä¸”æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚</p><p>Since most phony targets do not <a class="indexterm"></a> <a class="indexterm"></a>have prerequisites, the <code class="literal">clean</code> target would always be considered up
          to date and would never execute.</p><p>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œ<acronym class="acronym">GNU </acronym> <em class="command">make</em>åŒ…å«ä¸€ä¸ªç‰¹æ®Šçš„ç›®æ ‡ ï¼Œ<code class="literal">.PHONY</code>æ¥å‘Šè¯‰<em class="command">make</em>ç›®æ ‡ä¸æ˜¯çœŸæ­£çš„æ–‡ä»¶ã€‚ä»»ä½•ç›®æ ‡éƒ½å¯ä»¥é€šè¿‡å°†å…¶ä½œä¸ºä»¥ä¸‹å…ˆå†³æ¡ä»¶æ¥å£°æ˜Žä¸ºè™šå‡ç›®æ ‡
          <code class="literal">.PHONY</code>ï¼š</p><p>To avoid this problem, <acronym class="acronym">GNU</acronym> <em class="command">make</em> includes a special target, <code class="literal">.PHONY</code>, to tell <em class="command">make</em> that a target is not a real file. Any
          target can be declared phony by including it as a prerequisite of
          <code class="literal">.PHONY</code>:</p><a id="OEBPS/ch02.html.I_2_tt30"></a><pre class="programlisting">.PHONYï¼šå¹²å‡€
å¹²å‡€çš„ï¼š
        rm -f *.o è¯æ³•åˆ†æžå™¨.c</pre><pre class="programlisting">.PHONY: clean
clean:
        rm -f *.o lexer.c</pre><p>çŽ°åœ¨ï¼Œå³ä½¿å­˜åœ¨åä¸º<em class="filename">clean çš„æ–‡ä»¶ï¼Œ </em><em class="command">make</em>ä¹Ÿå°†å§‹ç»ˆæ‰§è¡Œå…³è”çš„å‘½ä»¤ã€‚é™¤äº†å°†ç›®æ ‡æ ‡è®°ä¸ºå§‹ç»ˆè¿‡æœŸä¹‹å¤–ï¼ŒæŒ‡å®šç›®æ ‡æ˜¯è™šå‡çš„è¿˜å¯ä»¥å‘Šè¯‰<em class="command">make</em>è¯¥æ–‡ä»¶ä¸éµå¾ªä»Žæºæ–‡ä»¶åˆ›å»ºç›®æ ‡æ–‡ä»¶çš„æ­£å¸¸è§„åˆ™ã€‚å› æ­¤ï¼Œ<em class="command">make</em>å¯ä»¥ä¼˜åŒ–å…¶æ­£å¸¸çš„è§„åˆ™æœç´¢ä»¥æé«˜æ€§èƒ½ã€‚<code class="literal">clean</code><em class="filename"></em><em class="command"></em><em class="command"></em></p><p>Now <em class="command">make</em> will always
          execute the commands associated with <code class="literal">clean</code> even if a file named <em class="filename">clean</em> exists. In addition to marking a
          target as always out of date, specifying that a target is phony
          tells <em class="command">make</em> that this file does
          not follow the normal rules for making a target file from a source
          file. Therefore, <em class="command">make</em> can
          optimize its normal rule search to improve performance.</p><p>ä½¿ç”¨è™šå‡ç›®æ ‡ä½œä¸ºçœŸå®žæ–‡ä»¶çš„å…ˆå†³æ¡ä»¶å‡ ä¹Žæ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºè™šå‡ç›®æ ‡æ€»æ˜¯è¿‡æ—¶çš„ï¼Œå¹¶ä¸”æ€»æ˜¯ä¼šå¯¼è‡´ç›®æ ‡æ–‡ä»¶è¢«é‡æ–°åˆ¶ä½œã€‚ç„¶è€Œï¼Œä¸ºè™šå‡ç›®æ ‡æä¾›å…ˆå†³æ¡ä»¶é€šå¸¸å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œ<code class="literal">all</code>ç›®æ ‡é€šå¸¸ä¼šç»™å‡ºè¦æž„å»ºçš„ç¨‹åºåˆ—è¡¨ï¼š</p><p>It rarely makes sense to use a phony target as a prerequisite
          of a real file since the phony is always out of date and will always
          cause the target file to be remade. However, it is often useful to
          give phony targets prerequisites. For instance, the <code class="literal">all</code> target is usually given the list of
          programs to be built:</p><a id="OEBPS/ch02.html.I_2_tt31"></a><pre class="programlisting">.PHONYï¼šå…¨éƒ¨
å…¨éƒ¨ï¼š bash bashbug</pre><pre class="programlisting">.PHONY: all
all: bash bashbug</pre><p>è¿™é‡Œ<code class="literal">all</code>ç›®æ ‡åˆ›å»º<em class="command">bash</em> shell ç¨‹åºå’Œ
          <em class="command">bashbug</em>é”™è¯¯æŠ¥å‘Šå·¥å…·ã€‚</p><p>Here the <code class="literal">all</code> target creates
          the <em class="command">bash</em> shell program and the
          <em class="command">bashbug</em> error reporting
          tool.</p><p>è™šå‡ç›®æ ‡ä¹Ÿå¯ä»¥è¢«è§†ä¸ºåµŒå…¥<em class="filename">makefile</em>ä¸­çš„ shell è„šæœ¬ã€‚å°†è™šå‡ç›®æ ‡è®¾ç½®ä¸ºå¦ä¸€ä¸ªç›®æ ‡çš„å…ˆå†³æ¡ä»¶å°†åœ¨åˆ›å»ºå®žé™…ç›®æ ‡ä¹‹å‰è°ƒç”¨è™šå‡ç›®æ ‡è„šæœ¬ã€‚å‡è®¾æˆ‘ä»¬çš„ç£ç›˜ç©ºé—´ç´§å¼ ï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œç£ç›˜å¯†é›†åž‹ä»»åŠ¡ä¹‹å‰æˆ‘ä»¬æƒ³è¦æ˜¾ç¤ºå¯ç”¨çš„ç£ç›˜ç©ºé—´ã€‚æˆ‘ä»¬å¯ä»¥å†™ï¼š</p><p>Phony targets can also be thought of as shell scripts embedded
          in a <em class="filename">makefile</em>. Making a phony
          target a prerequisite of another target will invoke the phony target
          script before making the actual target. Suppose we are tight on disk
          space and before executing a disk-intensive task we want to display
          available disk space. We could write:</p><a id="OEBPS/ch02.html.I_2_tt32"></a><pre class="programlisting">.PHONYï¼šåˆ¶ä½œæ–‡æ¡£
åˆ¶ä½œæ–‡æ¡£ï¼š
        df -k ã€‚ | awk 'NR == 2 { printf("%d ä¸ªå¯ç”¨\n", $$4 ) }'
        javadoc ...</pre><pre class="programlisting">.PHONY: make-documentation
make-documentation:
        df -k . | awk 'NR =  = 2 { printf( "%d available\n", $$4 ) }'
        javadoc ...</pre><p>è¿™é‡Œçš„é—®é¢˜æ˜¯æˆ‘ä»¬å¯èƒ½<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-867" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-868" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-869" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-870" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-871" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-872" class="indexterm"></a>æœ€ç»ˆåœ¨ä¸åŒçš„ç›®æ ‡ä¸‹å¤šæ¬¡æŒ‡å®š<em class="command">df</em>å’Œ<em class="command">awk</em>å‘½ä»¤ï¼Œè¿™æ˜¯ä¸€ä¸ªç»´æŠ¤é—®é¢˜ï¼Œå› ä¸ºå¦‚æžœæˆ‘ä»¬åœ¨å¦ä¸€ä¸ªç³»ç»Ÿä¸Šé‡åˆ°å…·æœ‰ä¸åŒæ ¼å¼çš„<em class="command">df</em>ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸æ›´æ”¹æ¯ä¸ªå®žä¾‹ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥å°†<em class="command">df</em>çº¿æ”¾ç½®åœ¨å®ƒè‡ªå·±çš„è™šå‡ç›®æ ‡ä¸­ï¼š</p><p>The problem here is that we may <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>end up specifying the <em class="command">df</em> and <em class="command">awk</em> commands many times under different
          targets, which is a maintenance problem since we'll have to change
          every instance if we encounter a <em class="command">df</em> on another system with a different
          format. Instead, we can place the <em class="command">df</em> line in its own phony target:</p><a id="OEBPS/ch02.html.I_2_tt33"></a><pre class="programlisting">.PHONYï¼šåˆ¶ä½œæ–‡æ¡£
åˆ¶ä½œæ–‡æ¡£ï¼šdf
        javadoc ...

.PHONY: df
dfï¼š
        df -k ã€‚ | awk 'NR == 2 { printf("%d ä¸ªå¯ç”¨\n", $$4 ) }'</pre><pre class="programlisting">.PHONY: make-documentation
make-documentation: df
        javadoc ...

.PHONY: df
df:
        df -k . | awk 'NR =  = 2 { printf( "%d available\n", $$4 ) }'</pre><p><em class="command">é€šè¿‡å°†df</em>ä½œä¸º çš„å…ˆå†³æ¡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿<em class="command">make</em>åœ¨ç”Ÿæˆæ–‡æ¡£ä¹‹å‰è°ƒç”¨<em class="command">df</em>ç›®æ ‡ã€‚è¿™å¾ˆæœ‰æ•ˆï¼Œå› ä¸ºå®ƒä¹Ÿæ˜¯ä¸€ä¸ªè™šå‡ç›®æ ‡ã€‚çŽ°åœ¨æˆ‘å¯ä»¥è½»æ¾åœ°åœ¨å…¶ä»–ç›®æ ‡ä¸­é‡ç”¨<em class="command">df ã€‚</em><em class="command"></em><code class="literal">make-documentation</code><code class="literal">make-documentation</code><em class="command"></em></p><p>We can cause <em class="command">make</em> to invoke
          our <em class="command">df</em> target before generating
          the documentation by making <em class="command">df</em> a
          prerequisite of <code class="literal">make-documentation</code>. This works well
          because <code class="literal">make-documentation</code> is
          also a phony target. Now I can easily reuse <em class="command">df</em> in other targets.</p><p>è™šå‡ç›®æ ‡è¿˜æœ‰è®¸å¤šå…¶ä»–å¥½çš„ç”¨é€”ã€‚</p><p>There are a number of other good uses for phony
          targets.</p><p><em class="command">make</em>çš„è¾“å‡ºå¯èƒ½ä¼šè®©äººéš¾ä»¥é˜…è¯»<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-873" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-874" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-875" class="indexterm"></a>å¹¶è°ƒè¯•ã€‚é€ æˆè¿™ç§æƒ…å†µçš„åŽŸå› æœ‰å‡ ä¸ªï¼š
           <em class="filename">makefile</em>æ˜¯è‡ªä¸Šè€Œä¸‹ç¼–å†™çš„ï¼Œè€Œ<em class="command">make</em>å‘½ä»¤æ˜¯è‡ªä¸‹è€Œä¸Šæ‰§è¡Œçš„ï¼›æ­¤å¤–ï¼Œæ²¡æœ‰è¿¹è±¡è¡¨æ˜Žå½“å‰æ­£åœ¨è¯„ä¼°å“ªæ¡è§„åˆ™ã€‚å¦‚æžœåœ¨<em class="command">makeè¾“å‡ºä¸­æ³¨é‡Šäº†ä¸»è¦ç›®æ ‡ï¼Œåˆ™</em><em class="command">make</em>çš„è¾“å‡º
          ä¼šæ›´å®¹æ˜“é˜…è¯»ã€‚è™šå‡ç›®æ ‡æ˜¯å®žçŽ°è¿™ä¸€ç›®æ ‡çš„æœ‰æ•ˆæ–¹æ³•ã€‚ä»¥ä¸‹æ˜¯å–è‡ª<em class="command">bash </em><em class="filename">makefile</em>çš„ç¤ºä¾‹ï¼š<em class="command"></em><em class="command"></em> <em class="filename"></em></p><p>The output of <em class="command">make</em> can be
          confusing to read <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>and debug. There are several reasons for this:
          <em class="filename">makefile</em>s are written top-down
          but the commands are executed by <em class="command">make</em> bottom-up; also, there is no
          indication which rule is currently being evaluated. The output of
          <em class="command">make</em> can be made much easier to
          read if major targets are commented in the <em class="command">make</em> output. Phony targets are a useful
          way to accomplish this. Here is an example taken from the <em class="command">bash</em> <em class="filename">makefile</em>:</p><a id="OEBPS/ch02.html.I_2_tt34"></a><pre class="programlisting">$ï¼ˆç¨‹åºï¼‰ï¼šbuild_msg $ï¼ˆå¯¹è±¡ï¼‰$ï¼ˆBUILTINS_DEPï¼‰$ï¼ˆLIBDEPï¼‰
        $(RM) $@
        $(CC) $(LDFLAGS) -o $(ç¨‹åº) $(å¯¹è±¡) $(LIBS)
        ls -l $(ç¨‹åº)
        å¤§å°$(ç¨‹åº)

.PHONYï¼šbuild_msg
æž„å»ºæ¶ˆæ¯ï¼š
        @printfâ€œ#\n# æž„å»º $(ç¨‹åº)\n#\nâ€</pre><pre class="programlisting">$(Program): build_msg $(OBJECTS) $(BUILTINS_DEP) $(LIBDEP)
        $(RM) $@
        $(CC) $(LDFLAGS) -o $(Program) $(OBJECTS) $(LIBS)
        ls -l $(Program)
        size $(Program)

.PHONY: build_msg
build_msg:
        @printf "#\n# Building $(Program)\n#\n"</pre><p>ç”±äºŽ<em class="command">printf</em>ä½äºŽè™šå‡ç›®æ ‡ä¸­ï¼Œå› æ­¤ä¼šåœ¨æ›´æ–°ä»»ä½•å…ˆå†³æ¡ä»¶ä¹‹å‰ç«‹å³æ‰“å°è¯¥æ¶ˆæ¯ã€‚å¦‚æžœæž„å»ºæ¶ˆæ¯è¢«æ”¾ç½®ä¸º<code class="literal">$(Program)</code>å‘½ä»¤è„šæœ¬çš„ç¬¬ä¸€ä¸ªå‘½ä»¤ï¼Œé‚£ä¹ˆå®ƒå°†åœ¨æ‰€æœ‰ç¼–è¯‘å’Œä¾èµ–é¡¹ç”Ÿæˆä¹‹åŽæ‰§è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºŽå‡ç›®æ ‡æ€»æ˜¯è¿‡æ—¶çš„ï¼Œå› æ­¤å³ä½¿å‡<code class="literal">build_msg</code>ç›®æ ‡
          <code class="literal">$(Program)</code>æ²¡æœ‰è¿‡æ—¶ï¼Œä¹Ÿä¼šå¯¼è‡´é‡æ–°ç”Ÿæˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¼¼ä¹Žæ˜¯ä¸€ä¸ªåˆç†çš„é€‰æ‹©ï¼Œå› ä¸ºå¤§éƒ¨åˆ†è®¡ç®—æ˜¯åœ¨ç¼–è¯‘ç›®æ ‡æ–‡ä»¶æ—¶æ‰§è¡Œçš„ï¼Œå› æ­¤å§‹ç»ˆåªæ‰§è¡Œæœ€ç»ˆé“¾æŽ¥ã€‚</p><p>Because the <em class="command">printf</em> is in a
          phony target, the message is printed immediately before any
          prerequisites are updated. If the build message were instead placed
          as the first command of the <code class="literal">$(Program)</code> command script, then it would
          be executed after all compilation and dependency generation. It is
          important to note that because phony targets are always out of date,
          the phony <code class="literal">build_msg</code> target causes
          <code class="literal">$(Program)</code> to be regenerated even
          when it is not out of date. In this case, it seems a reasonable
          choice since most of the computation is performed while compiling
          the object files so only the final link will always be
          performed.</p><p>è™šå‡ç›®æ ‡ä¹Ÿå¯ç”¨äºŽ<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-876" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-877" class="indexterm"></a><em class="filename">æ”¹è¿›makefile</em>çš„â€œç”¨æˆ·ç•Œé¢â€ ã€‚é€šå¸¸ç›®æ ‡æ˜¯åŒ…å«ç›®å½•è·¯å¾„å…ƒç´ ã€é™„åŠ æ–‡ä»¶åç»„ä»¶ï¼ˆä¾‹å¦‚ç‰ˆæœ¬å·ï¼‰å’Œæ ‡å‡†åŽç¼€çš„å¤æ‚å­—ç¬¦ä¸²ã€‚è¿™å¯èƒ½ä¼šä½¿åœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šç›®æ ‡æ–‡ä»¶åæˆä¸ºä¸€é¡¹æŒ‘æˆ˜ã€‚å¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ªç®€å•çš„è™šå‡ç›®æ ‡æ¥é¿å…è¯¥é—®é¢˜ï¼Œå…¶å…ˆå†³æ¡ä»¶æ˜¯å®žé™…çš„ç›®æ ‡æ–‡ä»¶ã€‚</p><p>Phony targets can also be used to <a class="indexterm"></a> <a class="indexterm"></a>improve the "user interface" of a <em class="filename">makefile</em>. Often targets are complex
          strings containing directory path elements, additional filename
          components (such as version numbers) and standard suffixes. This can
          make specifying a target filename on the command line a challenge.
          The problem can be avoided by adding a simple phony target whose
          prerequisite is the actual target file.</p><p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œæœ‰ä¸€ç»„<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-878" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-879" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-880" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-881" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-882" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-883" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-884" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-885" class="indexterm"></a><em class="filename">è®¸å¤šmakefile</em>æˆ–å¤šæˆ–å°‘éƒ½
          åŒ…å«æ ‡å‡†çš„è™šå‡ç›®æ ‡ã€‚<a class="link" href="#OEBPS/ch02.html.make3-CHP-2-TABLE-1" title="è¡¨ 2-1ã€‚æ ‡å‡†è™šå‡ç›®æ ‡">è¡¨ 2-1</a>åˆ—å‡ºäº†è¿™äº›æ ‡å‡†ç›®æ ‡ã€‚</p><p>By convention there are a set of <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>more or less standard phony targets that many
          <em class="filename">makefile</em>s include. <a class="link" href="#OEBPS/ch02.html.make3-CHP-2-TABLE-1" title="Table&nbsp;2-1.&nbsp;Standard phony targets">Table 2-1</a> lists these standard
          targets.</p><div class="table"><a id="OEBPS/ch02.html.make3-CHP-2-TABLE-1"></a><p class="title">è¡¨ 2-1ã€‚æ ‡å‡†è™šå‡ç›®æ ‡</p><p class="title">Table&nbsp;2-1.&nbsp;Standard phony targets</p><div class="table-contents"><table summary="Standard phony targets" style="border-collapse:collapse;border-top:0.5pt solid;border-bottom:0.5pt solid;border-left:0.5pt solid;border-right:0.5pt solid"><colgroup><col><col></colgroup><thead><tr><th style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>ç›®æ ‡</p><p>Target</p></th><th style="border-bottom:0.5pt solid"><p>åŠŸèƒ½</p><p>Function</p></th></tr></thead><tbody><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <code class="literal">all</code>
                  </p><p> <code class="literal">all</code>
                  </p></td><td style="border-bottom:0.5pt solid"><p>æ‰§è¡Œæž„å»ºåº”ç”¨ç¨‹åºçš„æ‰€æœ‰ä»»åŠ¡</p><p>Perform all tasks to build the
                  application</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <code class="literal">install</code>
                  </p><p> <code class="literal">install</code>
                  </p></td><td style="border-bottom:0.5pt solid"><p>ä»Žç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶åˆ›å»ºåº”ç”¨ç¨‹åºçš„å®‰è£…</p><p>Create an installation of the application from
                  the compiled binaries</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <code class="literal">clean</code>
                  </p><p> <code class="literal">clean</code>
                  </p></td><td style="border-bottom:0.5pt solid"><p>åˆ é™¤ä»Žæºç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶</p><p>Delete the binary files generated from
                  sources</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <code class="literal">distclean</code>
                  </p><p> <code class="literal">distclean</code>
                  </p></td><td style="border-bottom:0.5pt solid"><p>åˆ é™¤åŽŸå§‹æºå‘è¡Œç‰ˆä¸­ä¸å­˜åœ¨çš„æ‰€æœ‰ç”Ÿæˆæ–‡ä»¶</p><p>Delete all the generated files that were not in
                  the original source distribution</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <code class="literal">TAGS</code>
                  </p><p> <code class="literal">TAGS</code>
                  </p></td><td style="border-bottom:0.5pt solid"><p>åˆ›å»ºä¸€ä¸ªæ ‡ç­¾è¡¨ä¾›ç¼–è¾‘è€…ä½¿ç”¨</p><p>Create a tags table for use by
                  editors</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <code class="literal">info</code>
                  </p><p> <code class="literal">info</code>
                  </p></td><td style="border-bottom:0.5pt solid"><p>ä»Ž Texinfo æºåˆ›å»º<acronym class="acronym">GNUä¿¡æ¯æ–‡ä»¶</acronym></p><p>Create <acronym class="acronym">GNU</acronym> info files from
                  their Texinfo sources</p></td></tr><tr><td style="border-right:0.5pt solid"><p> <code class="literal">check</code>
                  </p><p> <code class="literal">check</code>
                  </p></td><td style=""><p>è¿è¡Œä¸Žæ­¤åº”ç”¨ç¨‹åºç›¸å…³çš„ä»»ä½•æµ‹è¯•</p><p>Run any tests associated with this
                  application</p></td></tr></tbody></table></div></div><p>è¯¥ç›®æ ‡<code class="literal">TAGS</code>å¹¶ä¸æ˜¯çœŸæ­£çš„å‡ç›®æ ‡ï¼Œå› ä¸º<em class="command">ctags</em>å’Œ<em class="command">etags</em>ç¨‹åºçš„è¾“å‡ºæ˜¯ä¸€ä¸ªåä¸º<em class="filename">TAGS</em>çš„æ–‡ä»¶ã€‚ä¹‹æ‰€ä»¥å°†å…¶åŒ…å«åœ¨æ­¤å¤„ï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯æˆ‘ä»¬æ‰€çŸ¥çš„å”¯ä¸€æ ‡å‡†éžè™šå‡ç›®æ ‡ã€‚</p><p>The target <code class="literal">TAGS</code> is not
          really a phony since the output of the <em class="command">ctags</em> and <em class="command">etags</em> programs is a file named <em class="filename">TAGS</em>. It is included here because it is
          the only standard nonphony target we know of.</p></div><div class="sect2" title="ç©ºç›®æ ‡"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch02.html.make3-CHP-2-SECT-1.3"></a>ç©ºç›®æ ‡</h2><h2 class="title"><a></a>Empty Targets</h2></div></div></div><p>ç©ºç›®æ ‡ç±»ä¼¼äºŽ<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-886" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-887" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-888" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-889" class="indexterm"></a><em class="command">è™šå‡ç›®æ ‡ï¼Œå› ä¸ºç›®æ ‡æœ¬èº«è¢«ç”¨ä½œåˆ©ç”¨make</em>åŠŸèƒ½çš„è®¾å¤‡ã€‚è™šå‡ç›®æ ‡æ€»æ˜¯è¿‡æ—¶çš„ï¼Œå› æ­¤å®ƒä»¬æ€»æ˜¯æ‰§è¡Œï¼Œå¹¶ä¸”æ€»æ˜¯å¯¼è‡´å…¶
          <em class="firstterm">ä¾èµ–é¡¹</em>ï¼ˆä¸Žå…ˆå†³æ¡ä»¶å…³è”çš„ç›®æ ‡ï¼‰è¢«é‡æ–°åˆ›å»ºã€‚ä½†æ˜¯å‡è®¾æˆ‘ä»¬æœ‰ä¸€äº›å‘½ä»¤ï¼Œæ²¡æœ‰è¾“å‡ºæ–‡ä»¶ï¼Œåªéœ€è¦å¶å°”æ‰§è¡Œï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸å¸Œæœ›æ›´æ–°æˆ‘ä»¬çš„ä¾èµ–é¡¹ï¼Ÿä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¶å®šä¸€ä¸ªè§„åˆ™ï¼Œå…¶ç›®æ ‡<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-890" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-891" class="indexterm"></a>æ˜¯ä¸€ä¸ªç©ºæ–‡ä»¶ï¼ˆæœ‰æ—¶ç§°ä¸º cookieï¼‰ï¼š</p><p>Empty targets are similar to <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>phony targets in that the target itself is used as a
          device to leverage the capabilities of <em class="command">make</em>. Phony targets are always out of
          date, so they always execute and they always cause their
          <em class="firstterm">dependent</em> (the target associated with the
          prerequisite) to be remade. But suppose we have some command, with
          no output file, that needs to be performed only occasionally and we
          don't want our dependents updated? For this, we can make a rule
          whose target <a class="indexterm"></a> <a class="indexterm"></a>is an empty file (sometimes referred to as a
          cookie):</p><a id="OEBPS/ch02.html.I_2_tt35"></a><pre class="programlisting">prog: å¤§å° prog.o
        $(CC) $(LDFLAGS) -o $@ $^

å°ºå¯¸ï¼šprog.o
        å°ºå¯¸$^
        è§¦æ‘¸å°ºå¯¸</pre><pre class="programlisting">prog: size prog.o
        $(CC) $(LDFLAGS) -o $@ $^

size: prog.o
        size $^
        touch size</pre><p>è¯·æ³¨æ„ï¼Œè¯¥<code class="literal">size</code>è§„åˆ™åœ¨å®ŒæˆåŽä½¿ç”¨<em class="command">touch</em>åˆ›å»ºä¸€ä¸ªåä¸º<em class="filename">size çš„</em>ç©ºæ–‡ä»¶ã€‚è¯¥ç©ºæ–‡ä»¶ç”¨äºŽå…¶<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-892" class="indexterm"></a>æ—¶é—´æˆ³ï¼Œä»¥ä¾¿<em class="command">make</em><code class="literal">size</code>ä»…å½“<em class="filename">prog.o</em>æ›´æ–°æ—¶æ‰æ‰§è¡Œè§„åˆ™ã€‚æ­¤å¤–ï¼Œ
           <em class="filename">prog</em><code class="literal">size</code>çš„å…ˆå†³æ¡ä»¶ä¸ä¼šå¼ºåˆ¶æ›´æ–°
          <em class="filename">prog</em>ï¼Œé™¤éžå…¶ç›®æ ‡æ–‡ä»¶ä¹Ÿè¾ƒæ–°ã€‚<em class="filename"></em><em class="filename"></em></p><p>Notice that the <code class="literal">size</code> rule
          uses <em class="command">touch</em> to create an empty
          file named <em class="filename">size</em> after it
          completes. This empty file is used for its <a class="indexterm"></a>timestamp so that <em class="command">make</em> will execute the <code class="literal">size</code> rule only when <em class="filename">prog.o</em> has been updated. Furthermore, the
          <code class="literal">size</code> prerequisite to <em class="filename">prog</em> will not force an update of
          <em class="filename">prog</em> unless its object file is
          also newer.</p><p>ç©ºæ–‡ä»¶ç‰¹åˆ«æœ‰ç”¨<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-893" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-894" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-895" class="indexterm"></a>ä¸Žè‡ªåŠ¨å˜é‡ç»“åˆä½¿ç”¨æ—¶<code class="literal">$?</code>ã€‚æˆ‘ä»¬åœ¨<a class="link" href="#OEBPS/ch02s02.html.make3-CHP-2-SECT-2.1" title="è‡ªåŠ¨å˜é‡">ç¬¬ 2.2.1 èŠ‚</a>ä¸­è®¨è®ºè‡ªåŠ¨å˜é‡
          ï¼Œä½†é¢„è§ˆè¯¥å˜é‡ä¸ä¼šæœ‰ä»€ä¹ˆåå¤„ã€‚åœ¨è§„åˆ™çš„å‘½ä»¤è„šæœ¬éƒ¨åˆ†ä¸­ï¼Œ<em class="command">make</em>å°†å˜é‡å®šä¹‰<code class="literal">$?</code>ä¸ºæ¯”ç›®æ ‡æ›´æ–°çš„å…ˆå†³æ¡ä»¶é›†ã€‚ä¸‹é¢æ˜¯æ‰“å°è‡ªä¸Šæ¬¡æ‰§è¡Œ<em class="command">make printä»¥æ¥å·²æ›´æ”¹çš„æ‰€æœ‰æ–‡ä»¶çš„è§„åˆ™ï¼š</em></p><p>Empty files are particularly useful <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>when combined with the automatic variable <code class="literal">$?</code>. We discuss automatic variables in
          <a class="link" href="#OEBPS/ch02s02.html.make3-CHP-2-SECT-2.1" title="Automatic Variables">Section 2.2.1</a>, but a
          preview of this variable won't hurt. Within the command script part
          of a rule, <em class="command">make</em> defines the
          variable <code class="literal">$?</code> to be the set of
          prerequisites that are newer than the target. Here is a rule to
          print all the files that have changed since the last time <em class="command">make print</em> was executed:</p><a id="OEBPS/ch02.html.I_2_tt36"></a><pre class="programlisting">æ‰“å°ï¼š*.[hc]
        lpr$ï¼Ÿ
        è§¦æ‘¸$@</pre><pre class="programlisting">print: *.[hc]
        lpr $?
        touch $@</pre><p>ä¸€èˆ¬æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ç©ºæ–‡ä»¶<a id="OEBPS/ch02.html.make3-CHP-2-ITERM-896" class="indexterm"></a> <a id="OEBPS/ch02.html.make3-CHP-2-ITERM-897" class="indexterm"></a>æ ‡è®°æœ€åŽä¸€æ¬¡å‘ç”Ÿç‰¹å®šäº‹ä»¶çš„æ—¶é—´ã€‚</p><p>Generally, empty files can be used <a class="indexterm"></a> <a class="indexterm"></a>to mark the last time a
          particular event has taken place.</p></div></div><div class="footnotes"><br><br><hr><div class="footnote"><p><sup>[ <a id="OEBPS/ch02.html.ftn.make3-CHP-2-FNOTE-1" href="#OEBPS/ch02.html.make3-CHP-2-FNOTE-1" class="para">1</a> ]</sup>åœ¨æ›´å—æŽ§åˆ¶çš„çŽ¯å¢ƒä¸­ï¼Œä½¿ç”¨é€šé…ç¬¦é€‰æ‹©ç¨‹åºä¸­çš„æ–‡ä»¶è¢«è®¤ä¸ºæ˜¯ä¸å¥½çš„åšæ³•ï¼Œå› ä¸ºæ¶æ„æºæ–‡ä»¶å¯èƒ½ä¼šæ„å¤–é“¾æŽ¥åˆ°ç¨‹åºä¸­ã€‚</p><p><sup>[<a href="#OEBPS/ch02.html.make3-CHP-2-FNOTE-1" class="para">1</a>] </sup>In more controlled environments using wildcards to select
              the files in a program is considered bad practice because a
              rogue source file might be accidentally linked into a
              program.</p></div></div></div></div></div>
<div id="OEBPS/ch02s02.html"><div>
<div class="sect1" title="å˜é‡"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch02s02.html.make3-CHP-2-SECT-2"></a>å˜é‡</h1><h1 class="title"><a></a>Variables</h1></div></div></div><p>è®©æˆ‘ä»¬çœ‹çœ‹ä¸€äº›å˜é‡<a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-898" class="indexterm"></a>æˆ‘ä»¬ä¸€ç›´åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ä½¿ç”¨ã€‚æœ€ç®€å•çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><p>Let's look at some of the variables <a class="indexterm"></a>we have been using in our examples. The simplest ones
        have the syntax:</p><a id="OEBPS/ch02s02.html.I_2_tt37"></a><pre class="programlisting">$( <em class="replaceable"><code>variable-name</code></em>)</pre><pre class="programlisting">$(<em class="replaceable"><code>variable-name</code></em>)</pre><p>è¿™è¡¨æ˜Žæˆ‘ä»¬è¦<em class="firstterm">æ‰©å±•</em>åä¸º çš„å˜é‡<em class="replaceable"><code>variable-name</code></em>ã€‚å˜é‡å¯ä»¥åŒ…å«å‡ ä¹Žä»»ä½•æ–‡æœ¬ï¼Œå˜é‡åç§°å¯ä»¥åŒ…å«å¤§å¤šæ•°å­—ç¬¦ï¼ŒåŒ…æ‹¬æ ‡ç‚¹ç¬¦å·ã€‚<code class="literal">COMPILE.c</code>ä¾‹å¦‚ï¼ŒåŒ…å« C ç¼–è¯‘å‘½ä»¤çš„å˜é‡æ˜¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå˜é‡åå¿…é¡»è¢« make åŒ…å›´<code class="literal">$( )</code>æˆ–è¢«<em class="command">make</em><code class="literal">${ }
        </code>è¯†åˆ«ã€‚ä½œä¸ºç‰¹æ®Šæƒ…å†µï¼Œå•å­—ç¬¦å˜é‡åä¸éœ€è¦æ‹¬å·ã€‚<em class="command"></em></p><p>This indicates that we want to <em class="firstterm">expand</em> the
        variable whose name is <em class="replaceable"><code>variable-name</code></em>.
        Variables can contain almost any text, and variable names can contain
        most characters including punctuation. The variable containing the C
        compile command is <code class="literal">COMPILE.c</code>, for
        example. In general, a variable name must be surrounded by <code class="literal">$( )</code> or <code class="literal">${ }
        </code>to be recognized by <em class="command">make</em>.
        As a special case, a single character variable name does not require
        the parentheses.</p><p>makefileé€šå¸¸ä¼šå®šä¹‰è®¸å¤šå˜é‡ï¼Œä½†ä¹Ÿæœ‰è®¸å¤šç”±<em class="command">makeè‡ªåŠ¨å®šä¹‰</em><em class="filename">çš„</em>ç‰¹æ®Šå˜é‡ã€‚æœ‰äº›å¯ä»¥ç”±ç”¨æˆ·è®¾ç½®æ¥æŽ§åˆ¶<em class="command">make</em>çš„è¡Œä¸ºï¼Œè€Œå¦ä¸€äº›åˆ™å¯ä»¥ç”±
        <em class="command">make</em>è®¾ç½®æ¥ä¸Žç”¨æˆ·çš„
        <em class="filename">makefile</em>è¿›è¡Œé€šä¿¡ã€‚<em class="command"></em><em class="command"></em><em class="command"></em><em class="filename"></em></p><p>A <em class="filename">makefile</em> will typically
        define many variables, but there are also many special variables
        defined automatically by <em class="command">make</em>. Some
        can be set by the user to control <em class="command">make</em>'s behavior while others are set by
        <em class="command">make</em> to communicate with the user's
        <em class="filename">makefile</em>.</p><div class="sect2" title="è‡ªåŠ¨å˜é‡"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch02s02.html.make3-CHP-2-SECT-2.1"></a>è‡ªåŠ¨å˜é‡</h2><h2 class="title"><a></a>Automatic Variables</h2></div></div></div><p><em class="firstterm">è‡ªåŠ¨å˜é‡ç”±</em><em class="command">make</em>è®¾ç½®<em class="command"></em> <a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-899" class="indexterm"></a> <a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-900" class="indexterm"></a>è§„åˆ™ä¹‹åŽ<a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-901" class="indexterm"></a> <a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-902" class="indexterm"></a>å·²åŒ¹é…ã€‚å®ƒä»¬æä¾›å¯¹ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶åˆ—è¡¨ä¸­çš„å…ƒç´ çš„è®¿é—®ï¼Œå› æ­¤æ‚¨ä¸å¿…æ˜¾å¼æŒ‡å®šä»»ä½•æ–‡ä»¶åã€‚å®ƒä»¬å¯¹äºŽé¿å…ä»£ç é‡å¤éžå¸¸æœ‰ç”¨ï¼Œä½†åœ¨å®šä¹‰æ›´é€šç”¨çš„æ¨¡å¼è§„åˆ™ï¼ˆç¨åŽè®¨è®ºï¼‰æ—¶è‡³å…³é‡è¦ã€‚</p><p><em class="firstterm">Automatic variables</em> are set by <em class="command">make</em> <a class="indexterm"></a> <a class="indexterm"></a>after a rule <a class="indexterm"></a> <a class="indexterm"></a>is matched. They provide access to elements from the
          target and prerequisite lists so you don't have to explicitly
          specify any filenames. They are very useful for avoiding code
          duplication, but are critical when defining more general pattern
          rules (discussed later).</p><p>æœ‰ä¸ƒä¸ªâ€œæ ¸å¿ƒâ€è‡ªåŠ¨<a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-903" class="indexterm"></a> <a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-904" class="indexterm"></a> <a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-905" class="indexterm"></a> <a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-906" class="indexterm"></a> <a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-907" class="indexterm"></a> <a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-908" class="indexterm"></a>å˜é‡ï¼š</p><p>There are seven "core" automatic <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>variables:</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">$@</code></span></dt><dt><span class="term"><code class="literal">$@</code></span></dt><dd><p>æ–‡ä»¶åä»£è¡¨<a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-909" class="indexterm"></a>ç›®æ ‡ã€‚</p></dd><dd><p>The filename representing <a class="indexterm"></a>the target.</p></dd><dt><span class="term"><code class="literal">$%</code></span></dt><dt><span class="term"><code class="literal">$%</code></span></dt><dd><p>çš„æ–‡ä»¶åå…ƒç´ <a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-910" class="indexterm"></a>å­˜æ¡£æˆå‘˜è§„èŒƒã€‚</p></dd><dd><p>The filename element of an <a class="indexterm"></a>archive member specification.</p></dd><dt><span class="term"><code class="literal">$&lt;</code></span></dt><dt><span class="term"><code class="literal">$&lt;</code></span></dt><dd><p>ç¬¬ä¸€ä¸ªçš„æ–‡ä»¶å<a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-911" class="indexterm"></a>å‰ææ¡ä»¶ã€‚</p></dd><dd><p>The filename of the first <a class="indexterm"></a>prerequisite.</p></dd><dt><span class="term"><code class="literal">$?</code></span></dt><dt><span class="term"><code class="literal">$?</code></span></dt><dd><p>æ‰€æœ‰äººçš„åå­—<a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-912" class="indexterm"></a>æ¯”ç›®æ ‡æ–°çš„å…ˆå†³æ¡ä»¶ï¼Œä»¥ç©ºæ ¼åˆ†éš”ã€‚</p></dd><dd><p>The names of all <a class="indexterm"></a>prerequisites that are newer than the target,
                separated by spaces.</p></dd><dt><span class="term"><code class="literal">$^</code></span></dt><dt><span class="term"><code class="literal">$^</code></span></dt><dd><p>æ‰€æœ‰çš„æ–‡ä»¶å<a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-913" class="indexterm"></a>å…ˆå†³æ¡ä»¶ï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚è¯¥åˆ—è¡¨åˆ é™¤äº†é‡å¤çš„æ–‡ä»¶åï¼Œå› ä¸ºå¯¹äºŽå¤§å¤šæ•°ç”¨é€”ï¼Œä¾‹å¦‚ç¼–è¯‘ã€å¤åˆ¶ç­‰ï¼Œä¸éœ€è¦é‡å¤çš„æ–‡ä»¶åã€‚</p></dd><dd><p>The filenames of all the <a class="indexterm"></a>prerequisites, separated by spaces. This list
                has duplicate filenames removed since for most uses, such as
                compiling, copying, etc., duplicates are not wanted.</p></dd><dt><span class="term"><code class="literal">$+</code></span></dt><dt><span class="term"><code class="literal">$+</code></span></dt><dd><p>ç±»ä¼¼äºŽ<code class="literal">$^</code>ï¼Œè¿™æ˜¯çš„åç§°<a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-914" class="indexterm"></a>æ‰€æœ‰å…ˆå†³æ¡ä»¶å‡ä»¥ç©ºæ ¼åˆ†éš”ï¼Œä½†<code class="literal">$+</code>åŒ…å«é‡å¤é¡¹é™¤å¤–ã€‚è¯¥å˜é‡æ˜¯ä¸ºç‰¹å®šæƒ…å†µåˆ›å»ºçš„ï¼Œä¾‹å¦‚é‡å¤å€¼æœ‰æ„ä¹‰çš„é“¾æŽ¥å™¨å‚æ•°ã€‚</p></dd><dd><p>Similar to <code class="literal">$^</code>, this
                is the names of <a class="indexterm"></a>all the prerequisites separated by spaces,
                except that <code class="literal">$+</code> includes
                duplicates. This variable was created for specific situations
                such as arguments to linkers where duplicate values have
                meaning.</p></dd><dt><span class="term"><code class="literal">$*</code></span></dt><dt><span class="term"><code class="literal">$*</code></span></dt><dd><p>ç›®æ ‡æ–‡ä»¶åçš„ä¸»å¹²ã€‚ A<a id="OEBPS/ch02s02.html.make3-CHP-2-ITERM-915" class="indexterm"></a>Stem é€šå¸¸æ˜¯ä¸å¸¦åŽç¼€çš„æ–‡ä»¶åã€‚ ï¼ˆæˆ‘ä»¬å°†åœ¨<a class="link" href="#OEBPS/ch02s04.html" title="æ¨¡å¼è§„åˆ™">ç¬¬ 2.4 èŠ‚</a>ç¨åŽè®¨è®ºå¦‚ä½•è®¡ç®—è¯å¹²ã€‚ï¼‰ä¸é¼“åŠ±åœ¨æ¨¡å¼è§„åˆ™ä¹‹å¤–ä½¿ç”¨å®ƒã€‚</p></dd><dd><p>The stem of the target filename. A <a class="indexterm"></a>stem is typically a filename without its suffix.
                (We'll discuss how stems are computed later in <a class="link" href="#OEBPS/ch02s04.html" title="Pattern Rules">Section 2.4</a>.) Its use
                outside of pattern rules is discouraged.</p></dd></dl></div><p>å¦å¤–ï¼Œä¸Šé¢çš„æ¯ä¸ªå˜é‡éƒ½æœ‰ä¸¤ä¸ªå˜ä½“ï¼Œä»¥ä¾¿ä¸Žå…¶ä»–<em class="command">make</em>å…¼å®¹ã€‚ä¸€ç§å˜ä½“ä»…è¿”å›žå€¼çš„ç›®å½•éƒ¨åˆ†ã€‚è¿™é€šè¿‡åœ¨ç¬¦å· ã€ ç­‰åŽé¢é™„åŠ â€œDâ€æ¥æŒ‡ç¤ºã€‚<code class="literal">$(@D)</code>å¦ä¸€ä¸ª<code class="literal">$(&lt;D)</code>å˜ä½“ä»…è¿”å›žå€¼çš„æ–‡ä»¶éƒ¨åˆ†ã€‚è¿™æ˜¯é€šè¿‡åœ¨ç¬¦å·ã€ ã€ ç­‰åŽé¢é™„åŠ ä¸€ä¸ª F æ¥è¡¨ç¤ºçš„ã€‚<code class="literal">$(@F)</code>è¯·
          <code class="literal">$(&lt;F)</code>æ³¨æ„ï¼Œè¿™äº›å˜ä½“åç§°çš„é•¿åº¦è¶…è¿‡ä¸€ä¸ªå­—ç¬¦ï¼Œå› æ­¤å¿…é¡»ç”¨æ‹¬å·æ‹¬èµ·æ¥ã€‚<acronym class="acronym">GNU </acronym> <em class="command">make</em><code class="function">dir</code>é€šè¿‡å’Œå‡½æ•°æä¾›äº†æ›´å…·å¯è¯»æ€§çš„æ›¿ä»£æ–¹æ¡ˆ<code class="function">notdir</code>ã€‚æˆ‘ä»¬å°†åœ¨<a class="link" href="#OEBPS/ch04.html" title="ç¬¬ 4 ç« å‡½æ•°">ç¬¬ 4 ç« </a>ä¸­è®¨è®ºå‡½æ•°ã€‚</p><p>In addition, each of the above variables has two variants for
          compatibility with other <em class="command">make</em>s.
          One variant returns only the directory portion of the value. This is
          indicated by appending a "D" to the symbol, <code class="literal">$(@D)</code>, <code class="literal">$(&lt;D)</code>, etc. The other variant returns
          only the file portion of the value. This is indicated by appending
          an F to the symbol, <code class="literal">$(@F)</code>,
          <code class="literal">$(&lt;F)</code>, etc. Note that these
          variant names are more than one character long and so must be
          enclosed in parentheses. <acronym class="acronym">GNU</acronym> <em class="command">make</em> provides a more readable alternative
          with the <code class="function">dir</code> and <code class="function">notdir</code> functions. We will discuss
          functions in <a class="link" href="#OEBPS/ch04.html" title="Chapter&nbsp;4.&nbsp;Functions">Chapter 4</a>.</p><p>è‡ªåŠ¨å˜é‡æ˜¯åœ¨è§„åˆ™ä¸Žå…¶ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶åŒ¹é…åŽç”±<em class="command">makeè®¾ç½®çš„ï¼Œå› æ­¤è¿™äº›å˜é‡ä»…åœ¨è§„åˆ™çš„å‘½ä»¤è„šæœ¬ä¸­å¯ç”¨ã€‚</em></p><p>Automatic variables are set by <em class="command">make</em> after a rule has been matched with
          its target and prerequisites so the variables are only available in
          the command script of a rule.</p><p>è¿™æ˜¯æˆ‘ä»¬çš„<em class="filename">makefile</em>ï¼Œå…¶ä¸­æ˜¾å¼æ–‡ä»¶åè¢«é€‚å½“çš„è‡ªåŠ¨å˜é‡æ›¿æ¢ã€‚</p><p>Here is our <em class="filename">makefile</em> with
          explicit filenames replaced by the appropriate automatic
          variable.</p><a id="OEBPS/ch02s02.html.I_2_tt38"></a><pre class="programlisting">count_words: count_words.o counter.o lexer.o -lfl
        æµ·æ¹¾åˆä½œå§”å‘˜ä¼š $^ -o $@

count_words.o: count_words.c
        æµ·æ¹¾åˆä½œå§”å‘˜ä¼š -c $&lt;

è®¡æ•°å™¨.o: è®¡æ•°å™¨.c
        æµ·æ¹¾åˆä½œå§”å‘˜ä¼š -c $&lt;

è¯æ³•åˆ†æžå™¨.o: è¯æ³•åˆ†æžå™¨.c
        æµ·æ¹¾åˆä½œå§”å‘˜ä¼š -c $&lt;

è¯æ³•åˆ†æžå™¨.c: è¯æ³•åˆ†æžå™¨.l
        å¼¹æ€§ -t $&lt; &gt; $@</pre><pre class="programlisting">count_words: count_words.o counter.o lexer.o -lfl
        gcc $^ -o $@

count_words.o: count_words.c
        gcc -c $&lt;

counter.o: counter.c
        gcc -c $&lt;

lexer.o: lexer.c
        gcc -c $&lt;

lexer.c: lexer.l
        flex -t $&lt; &gt; $@</pre></div></div></div></div>
<div id="OEBPS/ch02s03.html"><div>
<div class="sect1" title="ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch02s03.html.make3-CHP-2-SECT-3"></a>ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</h1><h1 class="title"><a></a>Finding Files with VPATH and vpath</h1></div></div></div><p>åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬çš„ä¾‹å­æ˜¯<a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-917" class="indexterm"></a> <a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-918" class="indexterm"></a> <a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-919" class="indexterm"></a> <a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-920" class="indexterm"></a>å¾ˆç®€å•ï¼Œ<em class="filename">makefile</em>å’Œæºä»£ç éƒ½ä½äºŽä¸€ä¸ªç›®å½•ä¸­ã€‚çŽ°å®žä¸–ç•Œçš„ç¨‹åºæ›´åŠ å¤æ‚ï¼ˆæ‚¨æœ€åŽä¸€æ¬¡å¤„ç†å•ä¸ªç›®å½•é¡¹ç›®æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿï¼‰ã€‚è®©æˆ‘ä»¬é‡æž„æˆ‘ä»¬çš„ç¤ºä¾‹å¹¶åˆ›å»ºæ›´çœŸå®žçš„æ–‡ä»¶å¸ƒå±€ã€‚æˆ‘ä»¬å¯ä»¥ä¿®æ”¹æˆ‘ä»¬çš„<a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-921" class="indexterm"></a> <a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-922" class="indexterm"></a><code class="function">main</code>é€šè¿‡é‡æž„ä¸ºä¸€ä¸ªåä¸º çš„å‡½æ•°æ¥å®žçŽ°å­—æ•°ç»Ÿè®¡ç¨‹åº<code class="function">counter</code>ã€‚</p><p>Our examples so far have been <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>simple enough that the <em class="filename">makefile</em> and sources all lived in a single
        directory. Real world programs are more complex (when's the last time
        you worked on a single directory project?). Let's refactor our example
        and create a more realistic file layout. We can modify our <a class="indexterm"></a> <a class="indexterm"></a>word counting program by refactoring <code class="function">main</code> into a function called <code class="function">counter</code>.</p><a id="OEBPS/ch02s03.html.I_2_tt39"></a><pre class="programlisting">#include &lt;lexer.h&gt;
#include &lt;è®¡æ•°å™¨.h&gt;

æ— æ•ˆè®¡æ•°å™¨ï¼ˆ int counts[4] ï¼‰
{
    è€Œ ( yylex( ) )
        ;

    è®¡æ•°[0] = è´¹ç”¨è®¡æ•°ï¼›
    è®¡æ•°[1] = fie_count;
    è®¡æ•°[2] = æ•Œäººè®¡æ•°ï¼›
    è®¡æ•°[3] = fum_count;
}</pre><pre class="programlisting">#include &lt;lexer.h&gt;
#include &lt;counter.h&gt;

void counter( int counts[4] )
{
    while ( yylex( ) )
        ;

    counts[0] = fee_count;
    counts[1] = fie_count;
    counts[2] = foe_count;
    counts[3] = fum_count;
}</pre><p>å¯é‡ç”¨çš„åº“å‡½æ•°åº”è¯¥<a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-923" class="indexterm"></a> <a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-924" class="indexterm"></a> <a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-925" class="indexterm"></a> <a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-926" class="indexterm"></a>å¤´æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªå£°æ˜Žï¼Œå› æ­¤è®©æˆ‘ä»¬åˆ›å»º
        åŒ…å«å£°æ˜Žçš„<em class="filename">counter.h ï¼š</em></p><p>A reusable library function should <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>have a declaration in a header file, so let's create
        <em class="filename">counter.h</em> containing our
        declaration:</p><a id="OEBPS/ch02s03.html.I_2_tt40"></a><pre class="programlisting">#ifndef COUNTER_H_
#å®šä¹‰COUNTER_H_

å¤–éƒ¨æ— æ•ˆ
è®¡æ•°å™¨( iâ€‹â€‹nt counts[4] );

ï¼ƒä¸‡ä¸€</pre><pre class="programlisting">#ifndef COUNTER_H_
#define COUNTER_H_

extern void
counter( int counts[4] );

#endif</pre><p><em class="filename">æˆ‘ä»¬è¿˜å¯ä»¥å°†lexer.l</em>ç¬¦å·çš„å£°æ˜Žæ”¾åœ¨<em class="filename">lexer.h</em>ä¸­ï¼š</p><p>We can also place the declarations for our <em class="filename">lexer.l</em> symbols in <em class="filename">lexer.h</em>:</p><a id="OEBPS/ch02s03.html.I_2_tt41"></a><pre class="programlisting">#ifndef LEXER_H_
#å®šä¹‰LEXER_H_

extern int Fee_countã€fie_countã€foe_countã€fum_countï¼›
å¤–éƒ¨ int yylex( æ— æ•ˆ );

ï¼ƒä¸‡ä¸€</pre><pre class="programlisting">#ifndef LEXER_H_
#define LEXER_H_

extern int fee_count, fie_count, foe_count, fum_count;
extern int yylex( void );

#endif</pre><p>åœ¨ä¼ ç»Ÿçš„æºä»£ç æ ‘å¸ƒå±€ä¸­ï¼Œå¤´æ–‡ä»¶è¢«æ”¾ç½®
        <a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-927" class="indexterm"></a> <a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-928" class="indexterm"></a> <a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-929" class="indexterm"></a> <a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-930" class="indexterm"></a><em class="filename">ä½äºŽinclude</em>ç›®å½•ä¸­
        ï¼Œæºä»£ç ä½äºŽ<em class="filename">src</em>ç›®å½•ä¸­ã€‚æˆ‘ä»¬å°†è¿™æ ·åšå¹¶å°†æˆ‘ä»¬çš„
        <em class="filename">makefile</em>æ”¾åœ¨çˆ¶ç›®å½•ä¸­ã€‚æˆ‘ä»¬çš„ç¤ºä¾‹ç¨‹åºçŽ°åœ¨å…·æœ‰<a class="link" href="#OEBPS/ch02s03.html.make3-CHP-2-FIG-1" title="å›¾ 2-1ã€‚æºæ ‘å¸ƒå±€ç¤ºä¾‹">å¦‚å›¾ 2-1</a>æ‰€ç¤ºçš„å¸ƒå±€ã€‚</p><p>In a traditional source tree layout the header files are placed
        <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>in an <em class="filename">include</em>
        directory and the source is placed in a <em class="filename">src</em> directory. We'll do this and put our
        <em class="filename">makefile</em> in the parent directory.
        Our example program now has the layout shown in <a class="link" href="#OEBPS/ch02s03.html.make3-CHP-2-FIG-1" title="Figure&nbsp;2-1.&nbsp;Example source tree layout">Figure 2-1</a>.</p><div class="figure"><a id="OEBPS/ch02s03.html.make3-CHP-2-FIG-1"></a><div class="figure-contents"><div class="mediaobject"><a id="OEBPS/ch02s03.html.I_2_tt42"></a><img src="data:image/png;base64,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" width="152" alt="æºæ ‘å¸ƒå±€ç¤ºä¾‹"></div></div><p class="title">å›¾ 2-1ã€‚æºæ ‘å¸ƒå±€ç¤ºä¾‹</p><p class="title">Figure&nbsp;2-1.&nbsp;Example source tree layout</p></div><p>ç”±äºŽæˆ‘ä»¬çš„æºæ–‡ä»¶çŽ°åœ¨åŒ…å«å¤´æ–‡ä»¶ï¼Œå› æ­¤è¿™äº›æ–°çš„ä¾èµ–é¡¹åº”è¯¥è®°å½•åœ¨æˆ‘ä»¬çš„<em class="filename">makefile</em>ä¸­ï¼Œä»¥ä¾¿å½“å¤´æ–‡ä»¶è¢«ä¿®æ”¹æ—¶ï¼Œç›¸åº”çš„ç›®æ ‡æ–‡ä»¶å°†è¢«æ›´æ–°ã€‚</p><p>Since our source files now include header files, these new
        dependencies should be recorded in our <em class="filename">makefile</em> so that when a header file is
        modified, the corresponding object file will be updated.</p><a id="OEBPS/ch02s03.html.I_2_tt43"></a><pre class="programlisting">count_words: count_words.o counter.o lexer.o -lfl
        æµ·æ¹¾åˆä½œå§”å‘˜ä¼š $^ -o $@

count_words.o: count_words.c include/counter.h
        æµ·æ¹¾åˆä½œå§”å‘˜ä¼š -c $&lt;

counter.o: counter.c include/counter.h include/lexer.h
        æµ·æ¹¾åˆä½œå§”å‘˜ä¼š -c $&lt;

lexer.o: lexer.c include/lexer.h
        æµ·æ¹¾åˆä½œå§”å‘˜ä¼š -c $&lt;

è¯æ³•åˆ†æžå™¨.c: è¯æ³•åˆ†æžå™¨.l
        å¼¹æ€§ -t $&lt; &gt; $@</pre><pre class="programlisting">count_words: count_words.o counter.o lexer.o -lfl
        gcc $^ -o $@

count_words.o: count_words.c include/counter.h
        gcc -c $&lt;

counter.o: counter.c include/counter.h include/lexer.h
        gcc -c $&lt;

lexer.o: lexer.c include/lexer.h
        gcc -c $&lt;

lexer.c: lexer.l
        flex -t $&lt; &gt; $@</pre><p>çŽ°åœ¨ï¼Œå½“æˆ‘ä»¬è¿è¡Œ<em class="filename">makefile</em>æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š</p><p>Now when we run our <em class="filename">makefile</em>, we get:</p><a id="OEBPS/ch02s03.html.I_2_tt44"></a><pre class="programlisting">$ <strong class="userinput"><code>make</code></strong>
make: *** æ²¡æœ‰è§„åˆ™å¯ä»¥åˆ›å»ºâ€œcount_words.oâ€æ‰€éœ€çš„ç›®æ ‡â€œcount_words.câ€ã€‚åœæ­¢ã€‚</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
make: *** No rule to make target `count_words.c', needed by `count_words.o'.  Stop.</pre><p>å“Žå‘€ï¼Œå‘ç”Ÿä»€ä¹ˆäº‹äº†ï¼Ÿ makefile<em class="filename">æ­£åœ¨</em>å°è¯•æ›´æ–°<em class="filename">count_words.c</em>ï¼Œä½†é‚£æ˜¯æºæ–‡ä»¶ï¼è®©æˆ‘ä»¬â€œçŽ©<em class="command">make</em> â€å§ã€‚æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå…ˆå†³æ¡ä»¶æ˜¯<em class="filename">count_words.o</em>ã€‚æˆ‘ä»¬å‘çŽ°è¯¥æ–‡ä»¶ä¸¢å¤±å¹¶å¯»æ‰¾åˆ›å»ºè¯¥æ–‡ä»¶çš„è§„åˆ™ã€‚åˆ›å»º<em class="filename">count_words.o</em>çš„æ˜¾å¼è§„åˆ™
        å¼•ç”¨<em class="filename">count_words.c</em>ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆ<em class="command">make</em>æ‰¾ä¸åˆ°æºæ–‡ä»¶å‘¢ï¼Ÿå› ä¸ºæºæ–‡ä»¶ä½äºŽ<em class="filename">src</em>ç›®å½•è€Œä¸æ˜¯å½“å‰ç›®å½•ä¸­ã€‚é™¤éžæ‚¨å¦æœ‰æŒ‡ç¤ºï¼Œå¦åˆ™<em class="command">make</em>å°†ä»…åœ¨å½“å‰ç›®å½•ä¸­æŸ¥æ‰¾å…¶ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶ã€‚æˆ‘ä»¬å¦‚ä½•è®©<em class="command">makeåœ¨</em><em class="filename">src</em>ç›®å½•ä¸­æŸ¥æ‰¾æºæ–‡ä»¶ï¼Ÿæˆ–è€…ï¼Œæ›´ä¸€èˆ¬åœ°è¯´ï¼Œæˆ‘ä»¬å¦‚ä½•å‘Šè¯‰<em class="command">make</em>
        æˆ‘ä»¬çš„æºä»£ç åœ¨å“ªé‡Œï¼Ÿ</p><p>Oops, what happened? The <em class="filename">makefile</em> is trying to update <em class="filename">count_words.c</em>, but that's a source file!
        Let's "play <em class="command">make</em>." Our first
        prerequisite is <em class="filename">count_words.o</em>. We
        see the file is missing and look for a rule to create it. The explicit
        rule for creating <em class="filename">count_words.o</em>
        references <em class="filename">count_words.c</em>. But why
        can't <em class="command">make</em> find the source file?
        Because the source file is in the <em class="filename">src</em> directory not the current directory.
        Unless you direct it otherwise, <em class="command">make</em> will look only in the current directory
        for its targets and prerequisites. How do we get <em class="command">make</em> to look in the <em class="filename">src</em> directory for source files? Or, more
        generally, how do we tell <em class="command">make</em>
        where our source code is?</p><p>æ‚¨å¯ä»¥ä½¿ç”¨å’ŒåŠŸèƒ½å‘Šè¯‰<em class="command">make</em>åœ¨ä¸åŒçš„ç›®å½•ä¸­æŸ¥æ‰¾å…¶æºæ–‡ä»¶ã€‚ä¸ºäº†è§£å†³çœ¼å‰çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å‘<em class="filename">makefile</em>æ·»åŠ ä¸€ä¸ª
        èµ‹å€¼ï¼š<code class="literal">VPATH</code><code class="literal">vpath</code><code class="literal">VPATH</code><em class="filename"></em></p><p>You can tell <em class="command">make</em> to look in
        different directories for its source files using the <code class="literal">VPATH</code> and <code class="literal">vpath</code> features. To fix our immediate
        problem, we can add a <code class="literal">VPATH</code>
        assignment to the <em class="filename">makefile</em>:</p><a id="OEBPS/ch02s03.html.I_2_tt45"></a><pre class="programlisting">VPATH = æº</pre><pre class="programlisting">VPATH = src</pre><p>è¿™è¡¨æ˜Ž
        å¦‚æžœ make æƒ³è¦çš„æ–‡ä»¶ä¸åœ¨å½“å‰ç›®å½•ä¸­ï¼Œåˆ™<em class="command">å®ƒ</em>
        åº”è¯¥åœ¨ç›®å½•<em class="filename">src</em>ä¸­æŸ¥æ‰¾ã€‚çŽ°åœ¨ï¼Œå½“æˆ‘ä»¬è¿è¡Œ<em class="filename">makefile</em>æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š</p><p>This indicates that <em class="command">make</em>
        should look in the directory <em class="filename">src</em>
        if the files it wants are not in the current directory. Now when we
        run our <em class="filename">makefile</em>, we get:</p><a id="OEBPS/ch02s03.html.I_2_tt46"></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
gcc -c src/count_words.c -o count_words.o
src/count_words.c:2:21: counter.h: æ²¡æœ‰è¿™æ ·çš„æ–‡ä»¶æˆ–ç›®å½•
make: *** [count_words.o] é”™è¯¯ 1</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
gcc -c src/count_words.c -o count_words.o
src/count_words.c:2:21: counter.h: No such file or directory
make: *** [count_words.o] Error 1</pre><p>è¯·æ³¨æ„ï¼Œ<em class="command">make</em>çŽ°åœ¨æˆåŠŸå°è¯•ç¼–è¯‘ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶æ­£ç¡®å¡«å†™æºçš„ç›¸å¯¹è·¯å¾„ã€‚è¿™æ˜¯ä½¿ç”¨çš„å¦ä¸€ä¸ªåŽŸå› <a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-931" class="indexterm"></a> <a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-932" class="indexterm"></a>è‡ªåŠ¨å˜é‡ï¼šå¦‚æžœç¡¬ç¼–ç æ–‡ä»¶åï¼Œåˆ™<em class="command">make</em>æ— æ³•ä½¿ç”¨é€‚å½“çš„æºè·¯å¾„ã€‚ä¸å¹¸çš„æ˜¯ï¼Œç¼–è¯‘å¤±è´¥äº†ï¼Œå› ä¸º<em class="command">gcc</em>æ‰¾ä¸åˆ°åŒ…å«æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨é€‚å½“çš„é€‰é¡¹â€œå®šåˆ¶â€éšå¼ç¼–è¯‘è§„åˆ™æ¥è§£å†³è¿™ä¸ªæœ€æ–°é—®é¢˜<code class="option">-I</code>
        ï¼š</p><p>Notice that <em class="command">make</em> now
        successfully tries to compile the first file, filling in correctly the
        relative path to the source. This is another reason to use <a class="indexterm"></a> <a class="indexterm"></a>automatic variables: <em class="command">make</em> cannot use the appropriate path to the
        source if you hardcode the filename. Unfortunately, the compilation
        dies because <em class="command">gcc</em> can't find the
        include file. We can fix this latest problem by "customizing" the
        implicit compilation rule with the appropriate <code class="option">-I</code>
        option:</p><a id="OEBPS/ch02s03.html.I_2_tt47"></a><pre class="programlisting">CPPFLAGS = -æˆ‘åŒ…æ‹¬</pre><pre class="programlisting">CPPFLAGS = -I include</pre><p><em class="command">å¹¶å°†gcc</em>çš„å‡ºçŽ°æ›´æ”¹ä¸º
        <code class="literal">gcc$(CPPFLAGS)</code>.çŽ°åœ¨æž„å»ºæˆåŠŸäº†ï¼š</p><p>and changing occurrences of <em class="command">gcc</em> to
        <code class="literal">gcc$(CPPFLAGS)</code>. Now the build succeeds:</p><a id="OEBPS/ch02s03.html.I_2_tt48"></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
gcc -I include -c src/count_words.c -o count_words.o
gcc -I include -c src/counter.c -o counter.o
flex -t src/lexer.l &gt; lexer.c
gcc -I include -c lexer.c -o lexer.o
gcc count_words.o counter.o lexer.o /lib/libfl.a -o count_words</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
gcc -I include -c src/count_words.c -o count_words.o
gcc -I include -c src/counter.c -o counter.o
flex -t src/lexer.l &gt; lexer.c
gcc -I include -c lexer.c -o lexer.o
gcc count_words.o counter.o lexer.o /lib/libfl.a -o count_words</pre><p>å˜é‡<code class="literal">VPATH</code>â€‹<a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-933" class="indexterm"></a><em class="command">åŒ…å«å½“make</em>éœ€è¦æ–‡ä»¶æ—¶è¦æœç´¢çš„ç›®å½•åˆ—è¡¨
        ã€‚å°†åœ¨åˆ—è¡¨ä¸­æœç´¢ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶ï¼Œä½†ä¸ä¼šæœç´¢å‘½ä»¤è„šæœ¬ä¸­æåˆ°çš„æ–‡ä»¶ã€‚åœ¨ Unix ä¸Šç›®å½•åˆ—è¡¨å¯ä»¥ç”¨ç©ºæ ¼æˆ–å†’å·åˆ†éš”ï¼Œåœ¨ Windows ä¸Šå¯ä»¥ç”¨ç©ºæ ¼æˆ–åˆ†å·åˆ†éš”ã€‚æˆ‘æ›´å–œæ¬¢ä½¿ç”¨ç©ºæ ¼ï¼Œå› ä¸ºå®ƒé€‚ç”¨äºŽæ‰€æœ‰ç³»ç»Ÿï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥é¿å…æ•´ä¸ªå†’å·/åˆ†å·çš„æ··ä¹±ã€‚æ­¤å¤–ï¼Œç”¨ç©ºæ ¼åˆ†éš”çš„ç›®å½•æ›´å®¹æ˜“é˜…è¯»ã€‚</p><p>The <code class="literal">VPATH</code> variable<a class="indexterm"></a> consists of a list of directories to search when
        <em class="command">make</em> needs a file. The list will be
        searched for targets as well as prerequisites, but not for files
        mentioned in command scripts. The list of directories can be separated
        by spaces or colons on Unix and separated by spaces or semicolons on
        Windows. I prefer to use spaces since that works on all systems and we
        can avoid the whole colon/semicolon imbroglio. Also, the directories
        are easier to read when separated by spaces.</p><p>è¿™ä¸ª<code class="literal">VPATH</code>å˜é‡å¾ˆå¥½ï¼Œå› ä¸ºå®ƒè§£å†³äº†æˆ‘ä»¬ä¸Šé¢çš„æœç´¢é—®é¢˜ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„é”¤å­ã€‚<em class="command">make</em>å°†åœ¨æ¯ä¸ªç›®å½•ä¸­æœç´¢å®ƒéœ€è¦çš„<span class="emphasis"><em>ä»»ä½•</em></span>æ–‡ä»¶ã€‚å¦‚æžœåˆ—è¡¨ä¸­çš„å¤šä¸ªä½ç½®å­˜åœ¨åŒåæ–‡ä»¶<code class="literal">VPATH</code>ï¼Œ<em class="command">åˆ™ make</em>èŽ·å–ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚æœ‰æ—¶è¿™å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</p><p>The <code class="literal">VPATH</code> variable is good
        because it solved our searching problem above, but it is a rather
        large hammer. <em class="command">make</em> will search each
        directory for <span class="emphasis"><em>any</em></span> file it needs. If a file of the
        same name exists in multiple places in the <code class="literal">VPATH</code> list, <em class="command">make</em> grabs the first one. Sometimes this can
        be a problem.</p><p>è¯¥<code class="literal">vpath</code>æŒ‡ä»¤
        <a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-934" class="indexterm"></a> <a id="OEBPS/ch02s03.html.make3-CHP-2-ITERM-935" class="indexterm"></a>æ˜¯å®žçŽ°æˆ‘ä»¬ç›®æ ‡çš„æ›´ç²¾ç¡®çš„æ–¹æ³•ã€‚è¯¥æŒ‡ä»¤çš„è¯­æ³•æ˜¯ï¼š</p><p>The <code class="literal">vpath</code> directive
        <a class="indexterm"></a> <a class="indexterm"></a>is a more precise way to achieve our goals. The syntax
        of this directive is:</p><a id="OEBPS/ch02s03.html.I_2_tt49"></a><pre class="programlisting">è™šæ‹Ÿè·¯å¾„<em class="replaceable"><code>pattern directory-list</code></em></pre><pre class="programlisting">vpath<em class="replaceable"><code>pattern directory-list</code></em></pre><p>æ‰€ä»¥æˆ‘ä»¬ä¹‹å‰çš„<code class="literal">VPATH</code>ç”¨æ³•å¯ä»¥æ”¹å†™ä¸ºï¼š</p><p>So our previous <code class="literal">VPATH</code> use can
        be rewritten as:</p><a id="OEBPS/ch02s03.html.I_2_tt50"></a><pre class="programlisting">vpath %.c src
vpath %.l src
vpath %.h åŒ…å«</pre><pre class="programlisting">vpath %.c src
vpath %.l src
vpath %.h include</pre><p>çŽ°åœ¨æˆ‘ä»¬å·²ç»å‘Šè¯‰<em class="command">make</em>å®ƒåº”è¯¥åœ¨<em class="filename">srcç›®å½•ä¸­æœç´¢</em><em class="filename">.c</em>æ–‡ä»¶
        ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜æ·»åŠ äº†ä¸€è¡Œæ¥åœ¨<em class="filename">includeç›®å½•ä¸­æœç´¢</em><em class="filename">.h</em>
        æ–‡ä»¶ï¼ˆè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥
        ä»Žå¤´æ–‡ä»¶å…ˆå†³æ¡ä»¶ä¸­åˆ é™¤<em class="filename">include/</em> ï¼‰ ã€‚åœ¨æ›´å¤æ‚çš„åº”ç”¨ç¨‹åºä¸­ï¼Œè¿™ç§æŽ§åˆ¶å¯ä»¥èŠ‚çœå¤§é‡ä»¤äººå¤´ç—›çš„äº‹æƒ…å’Œè°ƒè¯•æ—¶é—´ã€‚<em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em></p><p>Now we've told <em class="command">make</em> that it
        should search for <em class="filename">.c</em> files in the
        <em class="filename">src</em> directory and we've also
        added a line to search for <em class="filename">.h</em>
        files in the <em class="filename">include</em> directory
        (so we can remove the <em class="filename">include/</em>
        from our header file prerequisites). In more complex applications,
        this control can save a lot of headache and debugging time.</p><p>è¿™é‡Œæˆ‘ä»¬ç”¨æ¥<code class="literal">vpath</code>å¤„ç†æŸ¥æ‰¾åˆ†å¸ƒåœ¨å¤šä¸ªç›®å½•ä¸­çš„æºçš„é—®é¢˜ã€‚æœ‰ä¸€ä¸ªç›¸å…³ä½†ä¸åŒçš„é—®é¢˜ï¼Œå³å¦‚ä½•æž„å»ºåº”ç”¨ç¨‹åºï¼Œä»¥ä¾¿å°†ç›®æ ‡æ–‡ä»¶å†™å…¥â€œäºŒè¿›åˆ¶æ ‘â€ï¼Œè€Œæºæ–‡ä»¶ä½äºŽå•ç‹¬çš„â€œæºæ ‘â€ä¸­ã€‚æ­£ç¡®ä½¿ç”¨<code class="literal">vpath</code>ä¹Ÿå¯ä»¥å¸®åŠ©è§£å†³è¿™ä¸ªæ–°é—®é¢˜ï¼Œä½†ä»»åŠ¡å¾ˆå¿«å°±ä¼šå˜å¾—å¤æ‚ï¼Œ<code class="literal">vpath</code>ä»…é å®ƒæ˜¯ä¸å¤Ÿçš„ã€‚æˆ‘ä»¬å°†åœ¨åŽé¢çš„ç« èŠ‚ä¸­è¯¦ç»†è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚</p><p>Here we used <code class="literal">vpath</code> to handle
        the problem of finding source that is distributed among several
        directories. There is a related but different problem of how to build
        an application so that the object files are written into a "binary
        tree" while the source files live in a separate "source tree." Proper
        use of <code class="literal">vpath</code> can also help to solve
        this new problem, but the task quickly becomes complex and <code class="literal">vpath</code> alone is not sufficient. We'll discuss
        this problem in detail in later sections.</p></div></div></div>
<div id="OEBPS/ch02s04.html"><div>
<div class="sect1" title="æ¨¡å¼è§„åˆ™"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch02s04.html.make3-CHP-2-SECT-4"></a>æ¨¡å¼è§„åˆ™</h1><h1 class="title"><a></a>Pattern Rules</h1></div></div></div><p>æˆ‘ä»¬çš„
        <em class="filename">makefile</em>ç¤ºä¾‹<a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-936" class="indexterm"></a> <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-937" class="indexterm"></a>ä¸€ç›´åœ¨çœ‹æœ‰ç‚¹å†—é•¿ã€‚å¯¹äºŽä¸€ä¸ªåªæœ‰åå‡ ä¸ªæ–‡ä»¶æˆ–æ›´å°‘çš„å°ç¨‹åºï¼Œæˆ‘ä»¬å¯èƒ½ä¸åœ¨ä¹Žï¼Œä½†å¯¹äºŽå…·æœ‰æ•°ç™¾æˆ–æ•°åƒä¸ªæ–‡ä»¶çš„ç¨‹åºï¼ŒæŒ‡å®šæ¯ä¸ªç›®æ ‡ã€å…ˆå†³æ¡ä»¶å’Œå‘½ä»¤è„šæœ¬å°±å˜å¾—è¡Œä¸é€šäº†ã€‚æ­¤å¤–ï¼Œè¿™äº›å‘½ä»¤æœ¬èº«ä»£è¡¨äº†æˆ‘ä»¬çš„<em class="filename">makefile</em>ä¸­çš„é‡å¤ä»£ç ã€‚å¦‚æžœå‘½ä»¤åŒ…å«é”™è¯¯æˆ–å‘ç”Ÿæ›´æ”¹ï¼Œæˆ‘ä»¬å°†å¿…é¡»æ›´æ–°æ‰€æœ‰è¿™äº›è§„åˆ™ã€‚è¿™å¯èƒ½æ˜¯ä¸€ä¸ªä¸»è¦çš„ç»´æŠ¤é—®é¢˜å’Œé”™è¯¯æ¥æºã€‚</p><p>The <em class="filename">makefile</em> examples we've
        <a class="indexterm"></a> <a class="indexterm"></a>been looking at are a bit verbose. For a small program
        of a dozen files or less we may not care, but for programs with
        hundreds or thousands of files, specifying each target, prerequisite,
        and command script becomes unworkable. Furthermore, the commands
        themselves represent duplicate code in our <em class="filename">makefile</em>. If the commands contain a bug or
        ever change, we would have to update all these rules. This can be a
        major maintenance problem and source of bugs.</p><p>è®¸å¤šè¯»å–ä¸€ç§æ–‡ä»¶ç±»åž‹å¹¶è¾“å‡ºå¦ä¸€ç§æ–‡ä»¶ç±»åž‹çš„ç¨‹åºéƒ½ç¬¦åˆæ ‡å‡†çº¦å®šã€‚ä¾‹å¦‚ï¼Œæ‰€æœ‰ C ç¼–è¯‘å™¨éƒ½å‡å®šå…·æœ‰<em class="filename">.cåŽç¼€çš„æ–‡ä»¶åŒ…å« C æºä»£ç ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å°†</em><em class="filename">.c</em>åŽç¼€æ›¿æ¢ä¸º
        <em class="filename">.o</em>ï¼ˆæˆ–æŸäº› Windows ç¼–è¯‘å™¨çš„<em class="filename">.obj</em> ï¼‰æ¥æ´¾ç”Ÿå¯¹è±¡æ–‡ä»¶åã€‚åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°<em class="command">Flex</em>è¾“å…¥æ–‡ä»¶ä½¿ç”¨<em class="filename">.l</em>åŽç¼€ï¼Œå¹¶ä¸”<em class="command">Flex</em>ç”Ÿæˆ<em class="filename">.c</em>æ–‡ä»¶ã€‚</p><p>Many programs that read one file type and output another conform
        to standard conventions. For instance, all C compilers assume that
        files that have a <em class="filename">.c</em> suffix
        contain C source code and that the object filename can be derived by
        replacing the <em class="filename">.c</em> suffix with
        <em class="filename">.o</em> (or <em class="filename">.obj</em> for some Windows compilers). In the
        previous chapter, we noticed that <em class="command">flex</em> input files use the <em class="filename">.l</em> suffix and that <em class="command">flex</em> generates <em class="filename">.c</em> files.</p><p>è¿™äº›çº¦å®šå…è®¸<em class="command">make</em>
        é€šè¿‡è¯†åˆ«å¸¸è§çš„æ–‡ä»¶åæ¨¡å¼æ¥ç®€åŒ–è§„åˆ™åˆ›å»º
        <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-938" class="indexterm"></a>æä¾›å¤„ç†å®ƒä»¬çš„å†…ç½®è§„åˆ™ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ä½¿ç”¨è¿™äº›å†…ç½®è§„åˆ™ï¼Œæˆ‘ä»¬çš„ 17 è¡Œ<em class="filename">makefile</em>å¯ä»¥å‡å°‘ä¸ºï¼š</p><p>These conventions allow <em class="command">make</em>
        to simplify rule creation by recognizing common filename patterns and
        <a class="indexterm"></a>providing built-in rules for processing them. For
        example, by using these built-in rules our 17-line <em class="filename">makefile</em> can be reduced to:</p><a id="OEBPS/ch02s04.html.I_2_tt51"></a><pre class="programlisting">VPATH = src åŒ…å«
CPPFLAGS = -æˆ‘åŒ…æ‹¬

count_words: counter.o lexer.o -lfl
count_words.oï¼šè®¡æ•°å™¨.h
counter.o: counter.h lexer.h
è¯æ³•åˆ†æžå™¨.o: è¯æ³•åˆ†æžå™¨.h</pre><pre class="programlisting">VPATH    = src include
CPPFLAGS = -I include

count_words: counter.o lexer.o -lfl
count_words.o: counter.h
counter.o: counter.h lexer.h
lexer.o: lexer.h</pre><p>å†…ç½®è§„åˆ™éƒ½æ˜¯æ¨¡å¼è§„åˆ™çš„å®žä¾‹ã€‚æ¨¡å¼
        <em class="firstterm">è§„åˆ™</em>çœ‹èµ·æ¥ä¸Žæ‚¨å·²ç»è§è¿‡çš„æ™®é€šè§„åˆ™ç±»ä¼¼ï¼Œåªæ˜¯æ–‡ä»¶çš„<em class="firstterm">ä¸»å¹²</em>ï¼ˆåŽç¼€ä¹‹å‰çš„éƒ¨åˆ†ï¼‰ç”±å­—ç¬¦è¡¨ç¤º<code class="literal">%</code>ã€‚è¯¥<em class="filename">makefile</em>ä¹‹æ‰€ä»¥æœ‰æ•ˆï¼Œæ˜¯å› ä¸ºä¸‰ä¸ªå†…ç½®è§„åˆ™ã€‚ç¬¬ä¸€ä¸ªæŒ‡å®šå¦‚ä½•ä»Ž<em class="filename">.cæ–‡ä»¶ç¼–è¯‘</em><em class="filename">.o</em>æ–‡ä»¶ï¼š<em class="filename"></em></p><p>The built-in rules are all instances of pattern rules. A
        <em class="firstterm">pattern rule</em> looks like the normal rules you
        have already seen except the <em class="firstterm">stem</em> of the file
        (the portion before the suffix) is represented by a <code class="literal">%</code> character. This <em class="filename">makefile</em> works because of three built-in
        rules. The first specifies how to compile a <em class="filename">.o</em> file from a <em class="filename">.c</em> file:</p><a id="OEBPS/ch02s04.html.I_2_tt52"></a><pre class="programlisting">%.o: %.c
        $(COMPILE.c) $(OUTPUT_OPTION) $&lt;</pre><pre class="programlisting">%.o: %.c
        $(COMPILE.c) $(OUTPUT_OPTION) $&lt;</pre><p>ç¬¬äºŒä¸ªæŒ‡å®šå¦‚ä½•ä»Ž<em class="filename">.læ–‡ä»¶åˆ›å»º</em><em class="filename">.c</em>æ–‡ä»¶ï¼š<em class="filename"></em></p><p>The second specifies how to make a <em class="filename">.c</em> file from a <em class="filename">.l</em> file:</p><a id="OEBPS/ch02s04.html.I_2_tt53"></a><pre class="programlisting">%.c: %.l
        @$(RM)$@
        $(LEX.l) $&lt; &gt; $@</pre><pre class="programlisting">%.c: %.l
        @$(RM) $@
        $(LEX.l) $&lt; &gt; $@</pre><p>æœ€åŽï¼Œæœ‰ä¸€ä¸ªç‰¹æ®Šçš„è§„åˆ™å¯ä»¥ä»Ž<em class="filename">.c</em>æ–‡ä»¶ç”Ÿæˆæ²¡æœ‰åŽç¼€çš„æ–‡ä»¶ï¼ˆå§‹ç»ˆæ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼‰ï¼š</p><p>Finally, there is a special rule to generate a file with no
        suffix (always an executable) from a <em class="filename">.c</em> file:</p><a id="OEBPS/ch02s04.html.I_2_tt54"></a><pre class="programlisting">%ï¼š%.o
        $(LINK.o) $^ $(LOADLIBES) $(LDLIBS) -o $@</pre><pre class="programlisting">%: %.o
        $(LINK.o) $^ $(LOADLIBES) $(LDLIBS) -o $@</pre><p>æˆ‘ä»¬å°†ç¨åŽè¯¦ç»†ä»‹ç»æ­¤è¯­æ³•ï¼Œä½†é¦–å…ˆè®©æˆ‘ä»¬ä»”ç»†æ£€æŸ¥<em class="command">make</em>çš„è¾“å‡ºï¼Œçœ‹çœ‹<em class="command">make</em>å¦‚ä½•åº”ç”¨è¿™äº›å†…ç½®è§„åˆ™ã€‚</p><p>We'll go into the details of this syntax in a bit, but first
        let's go over <em class="command">make</em>'s output
        carefully and see how <em class="command">make</em> applies
        these built-in rules.</p><p>å½“æˆ‘ä»¬åœ¨ä¸ƒè¡Œ<em class="filename">makefile</em>ä¸Šè¿è¡Œ<em class="command">make</em>æ—¶ï¼Œè¾“å‡ºä¸ºï¼š<em class="filename"></em></p><p>When we run <em class="command">make</em> on our
        seven-line <em class="filename">makefile</em>, the output
        is:</p><a id="OEBPS/ch02s04.html.I_2_tt55"></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
gcc -I include -c -o count_words.o src/count_words.c
gcc -I include -c -o counter.o src/counter.c
flex -t src/lexer.l &gt; lexer.c
gcc -I include -c -o lexer.o lexer.c
gcc count_words.o counter.o lexer.o /lib/libfl.a -o count_words
rm è¯æ³•åˆ†æžå™¨.c</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
gcc  -I include  -c -o count_words.o src/count_words.c
gcc  -I include  -c -o counter.o src/counter.c
flex  -t src/lexer.l &gt; lexer.c
gcc  -I include  -c -o lexer.o lexer.c
gcc   count_words.o counter.o lexer.o /lib/libfl.a   -o count_words
rm lexer.c</pre><p>é¦–å…ˆï¼Œ<em class="command">make</em>è¯»å–
        <em class="filename">makefile</em>å¹¶å°†é»˜è®¤ç›®æ ‡è®¾ç½®ä¸º<em class="filename">count_words</em>ï¼Œå› ä¸ºæ²¡æœ‰æŒ‡å®šå‘½ä»¤è¡Œç›®æ ‡ã€‚æŸ¥çœ‹é»˜è®¤ç›®æ ‡ï¼Œ
         <em class="command">make</em>ç¡®å®šäº†å››ä¸ªå…ˆå†³æ¡ä»¶ï¼š
         <em class="filename">count_words.o ï¼ˆ </em><em class="filename">makefile</em>ä¸­ç¼ºå°‘æ­¤å…ˆå†³æ¡ä»¶ï¼Œä½†ç”±éšå¼è§„åˆ™æä¾›ï¼‰ã€<em class="filename">counter.o</em>ã€<em class="filename">lexer.o</em>å’Œ<code class="option">-lfl</code>ã€‚ç„¶åŽå®ƒå°è¯•ä¾æ¬¡æ›´æ–°æ¯ä¸ªå…ˆå†³æ¡ä»¶ã€‚</p><p>First, <em class="command">make</em> reads the
        <em class="filename">makefile</em> and sets the default
        goal to <em class="filename">count_words</em> since there
        are no command-line targets specified. Looking at the default goal,
        <em class="command">make</em> identifies four prerequisites:
        <em class="filename">count_words.o</em> (this prerequisite
        is missing from the <em class="filename">makefile</em>, but
        is provided by the implicit rule), <em class="filename">counter.o</em>, <em class="filename">lexer.o</em>, and <code class="option">-lfl</code>. It then
        tries to update each prerequisite in turn.</p><p>å½“<em class="command">make</em>æ£€æŸ¥ç¬¬ä¸€ä¸ªå…ˆå†³æ¡ä»¶<em class="filename">count_words.o</em>æ—¶ï¼Œ
         <em class="command">make</em>æ²¡æœ‰æ‰¾åˆ°å®ƒçš„æ˜¾å¼è§„åˆ™ï¼Œä½†å‘çŽ°äº†éšå¼è§„åˆ™ã€‚åœ¨æœ¬åœ°ç›®å½•ä¸­æŸ¥æ‰¾ï¼Œ
         <em class="command">make</em>æ‰¾ä¸åˆ°æºæ–‡ä»¶ï¼Œå› æ­¤å®ƒå¼€å§‹æœç´¢å¹¶åœ¨<em class="filename">src</em><code class="literal">VPATH</code>ä¸­æ‰¾åˆ°åŒ¹é…çš„æºæ–‡ä»¶ã€‚ç”±äºŽ<em class="filename">src/count_words.c</em>æ²¡æœ‰å…ˆå†³æ¡ä»¶ï¼Œ
        <em class="command">å› æ­¤ make</em>å¯ä»¥è‡ªç”±æ›´æ–°<em class="filename">count_words.o</em>ï¼Œä»¥ä¾¿å®ƒè¿è¡Œéšå¼è§„åˆ™çš„å‘½ä»¤ã€‚<em class="filename">counter.o</em>ç±»ä¼¼ã€‚å½“<em class="command">make</em>è€ƒè™‘
        <em class="filename">lexer.o</em>æ—¶ï¼Œå®ƒæ— æ³•æ‰¾åˆ°ç›¸åº”çš„æºæ–‡ä»¶ï¼ˆå³ä½¿åœ¨<em class="filename">src</em>ä¸­ï¼‰ï¼Œå› æ­¤å®ƒå‡è®¾æ­¤ï¼ˆä¸å­˜åœ¨çš„æºï¼‰æ˜¯ä¸€ä¸ªä¸­é—´æ–‡ä»¶ï¼Œå¹¶å¯»æ‰¾ä¸€ç§ä»Žå…¶ä»–æºæ–‡ä»¶ç”Ÿæˆ<em class="filename">lexer.c</em>çš„æ–¹æ³•ã€‚å®ƒå‘çŽ°ä¸€æ¡
        ä»Ž<em class="filename">.l</em>æ–‡ä»¶åˆ›å»º<em class="filename">.c</em>æ–‡ä»¶çš„è§„åˆ™ï¼Œå¹¶æ³¨æ„åˆ°<em class="filename">lexer.l</em>å­˜åœ¨ã€‚æ›´æ–°<em class="filename">lexer.l</em>ä¸éœ€è¦æ‰§è¡Œä»»ä½•æ“ä½œï¼Œå› æ­¤å®ƒä¼šç»§ç»­æ‰§è¡Œæ›´æ–°<em class="filename">lexer.c çš„</em>å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ä¼šç”Ÿæˆ<em class="command">flex</em>å‘½ä»¤è¡Œã€‚æŽ¥ä¸‹æ¥
        <em class="command">make</em>ä»Ž C æºä»£ç æ›´æ–°ç›®æ ‡æ–‡ä»¶ã€‚ä½¿ç”¨<em class="filename"></em><em class="filename"></em><em class="command"></em><em class="filename"></em><em class="filename"></em><em class="command"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="command"></em><em class="command"></em><a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-939" class="indexterm"></a> <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-940" class="indexterm"></a> <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-941" class="indexterm"></a> <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-942" class="indexterm"></a>åƒè¿™æ ·æ›´æ–°ç›®æ ‡çš„è§„åˆ™åºåˆ—ç§°ä¸º<em class="firstterm">è§„åˆ™é“¾æŽ¥</em>ã€‚</p><p>When <em class="command">make</em> examines the first
        prerequisite, <em class="filename">count_words.o</em>,
        <em class="command">make</em> finds no explicit rule for it
        but discovers the implicit rule. Looking in the local directory,
        <em class="command">make</em> cannot find the source, so it
        begins searching the <code class="literal">VPATH</code> and
        finds a matching source file in <em class="filename">src</em>. Since <em class="filename">src/count_words.c</em> has no prerequisites,
        <em class="command">make</em> is free to update <em class="filename">count_words.o</em> so it runs the commands for
        the implicit rule. <em class="filename">counter.o</em> is
        similar. When <em class="command">make</em> considers
        <em class="filename">lexer.o</em>, it cannot find a
        corresponding source file (even in <em class="filename">src</em>) so it assumes this (nonexistent
        source) is an intermediate file and looks for a way to make <em class="filename">lexer.c</em> from some other source file. It
        discovers a rule to create a <em class="filename">.c</em>
        file from a <em class="filename">.l</em> file and notices
        that <em class="filename">lexer.l</em> exists. There is no
        action required to update <em class="filename">lexer.l</em>, so it moves on to the command for
        updating <em class="filename">lexer.c</em>, which yields
        the <em class="command">flex</em> command line. Next
        <em class="command">make</em> updates the object file from
        the C source. Using <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>sequences of rules like this to update a target is
        called <em class="firstterm">rule chaining</em>.</p><p>æŽ¥ä¸‹æ¥ï¼Œ<em class="command">make</em>æ£€æŸ¥åº“è§„èŒƒ<code class="option">-lfl</code>ã€‚å®ƒæœç´¢ç³»ç»Ÿçš„æ ‡å‡†åº“ç›®å½•å¹¶å‘çŽ°<em class="filename">/lib/libfl.a</em>ã€‚</p><p>Next, <em class="command">make</em> examines the
        library specification <code class="option">-lfl</code>. It searches the standard
        library directories for the system and discovers <em class="filename">/lib/libfl.a</em>.</p><p>çŽ°åœ¨<em class="command">makeå·²ç»å…·å¤‡äº†æ›´æ–°</em><em class="filename">count_words</em>çš„æ‰€æœ‰å…ˆå†³æ¡ä»¶ï¼Œå› æ­¤å®ƒæ‰§è¡Œæœ€ç»ˆçš„
        <em class="command">gcc</em>å‘½ä»¤ã€‚æœ€åŽï¼Œ<em class="command">make</em>æ„è¯†åˆ°å®ƒåˆ›å»ºäº†ä¸€ä¸ªä¸éœ€è¦ä¿ç•™çš„ä¸­é—´æ–‡ä»¶ï¼Œå› æ­¤å°†å…¶æ¸…é™¤ã€‚</p><p>Now <em class="command">make</em> has all the
        prerequisites for updating <em class="filename">count_words</em>, so it executes the final
        <em class="command">gcc</em> command. Lastly, <em class="command">make</em> realizes it created an intermediate
        file that is not necessary to keep so it cleans it up.</p><p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œåœ¨<em class="filename">makefile</em>ä¸­ä½¿ç”¨è§„åˆ™å¯ä»¥è®©æ‚¨çœç•¥å¾ˆå¤šç»†èŠ‚ã€‚è§„åˆ™å¯ä»¥å…·æœ‰å¤æ‚çš„äº¤äº’ï¼Œä»Žè€Œäº§ç”Ÿéžå¸¸å¼ºå¤§çš„è¡Œä¸ºã€‚ç‰¹åˆ«æ˜¯ï¼Œæ‹¥æœ‰é€šç”¨è§„åˆ™çš„å†…ç½®æ•°æ®åº“ä½¿å¾—è®¸å¤šç±»åž‹çš„<em class="filename">makefile</em>
        è§„èŒƒå˜å¾—éžå¸¸ç®€å•ã€‚</p><p>As you can see, using rules in <em class="filename">makefile</em>s allows you to omit a lot of
        detail. Rules can have complex interactions that yield very powerful
        behaviors. In particular, having a built-in database of common rules
        makes many types of <em class="filename">makefile</em>
        specifications very simple.</p><p>è¿™<a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-943" class="indexterm"></a>å†…ç½®è§„åˆ™å¯ä»¥æ˜¯<a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-944" class="indexterm"></a>é€šè¿‡æ›´æ”¹å‘½ä»¤è„šæœ¬ä¸­å˜é‡çš„å€¼è¿›è¡Œè‡ªå®šä¹‰ã€‚å…¸åž‹çš„è§„åˆ™æœ‰è®¸å¤šå˜é‡ï¼Œä»Žè¦æ‰§è¡Œçš„ç¨‹åºå¼€å§‹ï¼ŒåŒ…æ‹¬ç”¨äºŽè®¾ç½®å‘½ä»¤è¡Œé€‰é¡¹ä¸»è¦åˆ†ç»„çš„å˜é‡ï¼Œä¾‹å¦‚è¾“å‡ºæ–‡ä»¶ã€ä¼˜åŒ–ã€è°ƒè¯•ç­‰ã€‚æ‚¨å¯ä»¥æŸ¥çœ‹<em class="command">make</em>çš„é»˜è®¤è®¾ç½®é€šè¿‡è¿è¡Œ<em class="command">make</em>
        æ¥åˆ›å»ºè§„åˆ™ï¼ˆå’Œå˜é‡ï¼‰<code class="option">â€”print-data-base</code>ã€‚</p><p>The <a class="indexterm"></a>built-in rules can be <a class="indexterm"></a>customized by changing the values of the variables in
        the command scripts. A typical rule has a host of variables, beginning
        with the program to execute, and including variables to set major
        groupings of command-line options, such as the output file,
        optimization, debugging, etc. You can look at <em class="command">make</em>'s default set of rules (and variables)
        by running <em class="command">make</em>
        <code class="option">â€”print-data-base</code>.</p><div class="sect2" title="æ¨¡å¼"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch02s04.html.make3-CHP-2-SECT-4.1"></a>æ¨¡å¼</h2><h2 class="title"><a></a>The Patterns</h2></div></div></div><p>a ä¸­çš„ç™¾åˆ†å·å­—ç¬¦<a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-945" class="indexterm"></a> <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-946" class="indexterm"></a> <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-947" class="indexterm"></a>æ¨¡å¼è§„åˆ™å¤§è‡´ç›¸å½“äºŽ<code class="literal">*</code>Unix shell ä¸­çš„è§„åˆ™ã€‚å®ƒä»£è¡¨ä»»æ„æ•°é‡çš„ä»»æ„å­—ç¬¦ã€‚ç™¾åˆ†æ¯”å­—ç¬¦å¯ä»¥æ”¾ç½®åœ¨æ¨¡å¼å†…çš„ä»»ä½•ä½ç½®ï¼Œä½†åªèƒ½å‡ºçŽ°ä¸€æ¬¡ã€‚ä»¥ä¸‹æ˜¯ç™¾åˆ†æ¯”çš„ä¸€äº›æœ‰æ•ˆç”¨æ³•ï¼š</p><p>The percent character in a <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>pattern rule is roughly equivalent to <code class="literal">*</code> in a Unix shell. It represents any
          number of any characters. The percent character can be placed
          anywhere within the pattern but can occur only once. Here are some
          valid uses of percent:</p><a id="OEBPS/ch02s04.html.I_2_tt56"></a><pre class="programlisting">%,v
æ‰€ä»¥
åŒ…è£…_%</pre><pre class="programlisting">%,v
s%.o
wrapper_%</pre><p>æ–‡ä»¶åä¸­é™¤ç™¾åˆ†æ¯”ä»¥å¤–çš„å­—ç¬¦æŒ‰å­—é¢æ„æ€åŒ¹é…ã€‚æ¨¡å¼å¯ä»¥åŒ…å«å‰ç¼€æˆ–åŽç¼€æˆ–<a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-948" class="indexterm"></a> <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-949" class="indexterm"></a> <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-950" class="indexterm"></a> <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-951" class="indexterm"></a>ä¸¤ä¸ªéƒ½ã€‚å½“<em class="command">make</em>
          æœç´¢è¦åº”ç”¨çš„æ¨¡å¼è§„åˆ™æ—¶ï¼Œå®ƒé¦–å…ˆæŸ¥æ‰¾åŒ¹é…çš„æ¨¡å¼è§„åˆ™ç›®æ ‡ã€‚æ¨¡å¼è§„åˆ™ç›®æ ‡å¿…é¡»ä»¥å‰ç¼€å¼€å¤´å¹¶ä»¥åŽç¼€ç»“å°¾ï¼ˆå¦‚æžœå­˜åœ¨ï¼‰ã€‚å¦‚æžœæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œåˆ™å°†å‰ç¼€å’ŒåŽç¼€ä¹‹é—´çš„å­—ç¬¦ä½œä¸ºåç§°çš„è¯å¹²ã€‚æŽ¥ä¸‹æ¥<em class="command">make</em>é€šè¿‡å°†è¯å¹²æ›¿æ¢ä¸ºå…ˆå†³æ¡ä»¶æ¨¡å¼æ¥æŸ¥çœ‹æ¨¡å¼è§„åˆ™çš„å…ˆå†³æ¡ä»¶ã€‚å¦‚æžœç”Ÿæˆçš„æ–‡ä»¶åå­˜åœ¨æˆ–è€…å¯ä»¥é€šè¿‡åº”ç”¨å¦ä¸€ä¸ªè§„åˆ™æ¥ç”Ÿæˆï¼Œåˆ™è¿›è¡ŒåŒ¹é…å¹¶åº”ç”¨è¯¥è§„åˆ™ã€‚è¯å¹²å¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ªå­—ç¬¦ã€‚</p><p>Characters other than percent match literally within a
          filename. A pattern can contain a prefix or a suffix or <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>both. When <em class="command">make</em>
          searches for a pattern rule to apply, it first looks for a matching
          pattern rule target. The pattern rule target must start with the
          prefix and end with the suffix (if they exist). If a match is found,
          the characters between the prefix and suffix are taken as the stem
          of the name. Next <em class="command">make</em> looks at
          the prerequisites of the pattern rule by substituting the stem into
          the prerequisite pattern. If the resulting filename exists or can be
          made by applying another rule, a match is made and the rule is
          applied. The stem word must contain at least one character.</p><p>ä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ªä»…åŒ…å«ç™¾åˆ†æ¯”å­—ç¬¦çš„æ¨¡å¼ã€‚æ­¤æ¨¡å¼æœ€å¸¸è§çš„ç”¨é€”æ˜¯æž„å»º Unix å¯æ‰§è¡Œç¨‹åºã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯<acronym class="acronym">GNU</acronym> 
          ä¸ºæž„å»ºç¨‹åºè€ŒåŒ…å«çš„<em class="command">å‡ ä¸ªæ¨¡å¼è§„åˆ™ï¼š</em></p><p>It is also possible to have a pattern containing only a
          percent character. The most common use of this pattern is to build a
          Unix executable program. For instance, here are several pattern
          rules <acronym class="acronym">GNU</acronym> <em class="command">make</em>
          includes for building programs:</p><a id="OEBPS/ch02s04.html.I_2_tt57"></a><pre class="programlisting">%: %.mod
        $(COMPILE.mod) -o $@ -e $@ $^

%: %.cpp
        $(LINK.cpp) $^ $(LOADLIBES) $(LDLIBS) -o $@

%ï¼š%.sh
        çŒ«$&lt;&gt;$@
        chmod a+x $@</pre><pre class="programlisting">%: %.mod
        $(COMPILE.mod) -o $@ -e $@ $^

%: %.cpp
        $(LINK.cpp) $^ $(LOADLIBES) $(LDLIBS) -o $@

%: %.sh
        cat $&lt; &gt;$@
        chmod a+x $@</pre><p>è¿™äº›æ¨¡å¼å°†åˆ†åˆ«ç”¨äºŽä»Ž Modula æºæ–‡ä»¶ã€é¢„å¤„ç†çš„ C æºæ–‡ä»¶å’Œ Bourne shell è„šæœ¬ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚æˆ‘ä»¬å°†åœ¨<a class="link" href="#OEBPS/ch02s05.html" title="éšå¼è§„åˆ™æ•°æ®åº“">2.5 èŠ‚</a>ä¸­çœ‹åˆ°æ›´å¤šéšå«è§„åˆ™ã€‚</p><p>These patterns will be used to generate an executable from a
          Modula source file, a preprocessed C source file, and a Bourne shell
          script, respectively. We will see many more implicit rules in <a class="link" href="#OEBPS/ch02s05.html" title="The Implicit Rules Database">Section 2.5</a>.</p></div><div class="sect2" title="é™æ€æ¨¡å¼è§„åˆ™"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch02s04.html.make3-CHP-2-SECT-4.2"></a>é™æ€æ¨¡å¼è§„åˆ™</h2><h2 class="title"><a></a>Static Pattern Rules</h2></div></div></div><p>é™æ€æ¨¡å¼è§„åˆ™æ˜¯å…¶ä¸­ä¹‹ä¸€<a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-952" class="indexterm"></a> <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-953" class="indexterm"></a> <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-954" class="indexterm"></a> <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-955" class="indexterm"></a>ä»…é€‚ç”¨äºŽç‰¹å®šç›®æ ‡åˆ—è¡¨ã€‚</p><p>A static pattern rule is one<a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> that applies only to a specific list of
          targets.</p><a id="OEBPS/ch02s04.html.I_2_tt58"></a><pre class="programlisting">$(å¯¹è±¡): %.o: %.c
        $(CC) -c $(CFLAGS) $&lt; -o $@</pre><pre class="programlisting">$(OBJECTS): %.o: %.c
        $(CC) -c $(CFLAGS) $&lt; -o $@</pre><p>æ­¤è§„åˆ™ä¸Žæ™®é€šæ¨¡å¼è§„åˆ™ä¹‹é—´çš„å”¯ä¸€åŒºåˆ«æ˜¯åˆå§‹<code class="literal">$(OBJECTS)</code>: è§„èŒƒã€‚è¿™å°†è§„åˆ™é™åˆ¶ä¸º
          <code class="literal">$(OBJECTS)</code>å˜é‡ä¸­åˆ—å‡ºçš„æ–‡ä»¶ã€‚</p><p>The only difference between this rule and an ordinary pattern
          rule is the initial <code class="literal">$(OBJECTS)</code>:
          specification. This limits the rule to the files listed in the
          <code class="literal">$(OBJECTS)</code> variable.</p><p>è¿™ä¸Žæ¨¡å¼è§„åˆ™éžå¸¸ç›¸ä¼¼ã€‚æ¯ä¸ªå¯¹è±¡<a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-956" class="indexterm"></a> <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-957" class="indexterm"></a>file in<code class="literal">$(OBJECTS)</code>
          ä¸Žæ¨¡å¼è¿›è¡ŒåŒ¹é…<code class="literal">%.o</code>å¹¶æå–å…¶è¯å¹²ã€‚ç„¶åŽå°†ä¸»å¹²æ›¿æ¢åˆ°æ¨¡å¼ä¸­<code class="literal">%.c</code>ä»¥äº§ç”Ÿç›®æ ‡çš„å…ˆå†³æ¡ä»¶ã€‚å¦‚æžœç›®æ ‡æ¨¡å¼ä¸å­˜åœ¨ï¼Œ<em class="command">make</em>ä¼šå‘å‡ºè­¦å‘Šã€‚</p><p>This is very similar to a pattern rule. Each object <a class="indexterm"></a> <a class="indexterm"></a>file in <code class="literal">$(OBJECTS)</code>
          is matched against the pattern <code class="literal">%.o</code> and its stem is extracted. The stem is
          then substituted into the pattern <code class="literal">%.c</code> to yield the target's prerequisite. If
          the target pattern does not exist, <em class="command">make</em> issues a warning.</p><p>åªè¦æ˜¾å¼åˆ—å‡ºç›®æ ‡æ–‡ä»¶æ¯”é€šè¿‡åŽç¼€æˆ–å…¶ä»–æ¨¡å¼è¯†åˆ«ç›®æ ‡æ–‡ä»¶æ›´å®¹æ˜“ï¼Œå°±ä½¿ç”¨é™æ€æ¨¡å¼è§„åˆ™ã€‚</p><p>Use static pattern rules whenever it is easier to list the
          target files explicitly than to identify them by a suffix or other
          pattern.</p></div><div class="sect2" title="åŽç¼€è§„åˆ™"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch02s04.html.make3-CHP-2-SECT-4.3"></a>åŽç¼€è§„åˆ™</h2><h2 class="title"><a></a>Suffix Rules</h2></div></div></div><p>åŽç¼€è§„åˆ™æ˜¯<a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-958" class="indexterm"></a> <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-959" class="indexterm"></a> <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-960" class="indexterm"></a>å®šä¹‰éšå¼è§„åˆ™çš„åŽŸå§‹ï¼ˆå’Œè¿‡æ—¶ï¼‰æ–¹å¼ã€‚å› ä¸ºå…¶ä»–ç‰ˆæœ¬çš„<em class="command">make</em>å¯èƒ½ä¸æ”¯æŒ
          <acronym class="acronym">GNU </acronym> <em class="command">make</em>çš„æ¨¡å¼è§„åˆ™è¯­æ³•ï¼Œæ‰€ä»¥æ‚¨ä»ç„¶ä¼šåœ¨ç”¨äºŽå¹¿æ³›åˆ†å‘çš„<em class="filename">makefile</em>ä¸­çœ‹åˆ°åŽç¼€è§„åˆ™ï¼Œå› æ­¤èƒ½å¤Ÿé˜…è¯»å’Œç†è§£è¯­æ³•éžå¸¸é‡è¦ã€‚å› æ­¤ï¼Œå°½ç®¡ä¸ºç›®æ ‡ç³»ç»Ÿç¼–è¯‘<acronym class="acronym">GNU </acronym> <em class="command">makeæ˜¯</em><em class="filename">makefile</em>
          å¯ç§»æ¤æ€§çš„é¦–é€‰æ–¹æ³•ï¼Œä½†åœ¨æžå°‘æ•°æƒ…å†µä¸‹æ‚¨å¯èƒ½ä»ç„¶éœ€è¦ç¼–å†™åŽç¼€è§„åˆ™ã€‚</p><p>Suffix rules are the <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>original (and obsolete) way of defining implicit
          rules. Because other versions of <em class="command">make</em> may not support
          <acronym class="acronym">GNU</acronym> <em class="command">make</em>'s
          pattern rule syntax, you will still see suffix rules in <em class="filename">makefile</em>s intended for a wide
          distribution so it is important to be able to read and understand
          the syntax. So, although compiling <acronym class="acronym">GNU</acronym> <em class="command">make</em> for the target system is the
          preferred method for <em class="filename">makefile</em>
          portability, you may still need to write suffix rules in rare
          circumstances.</p><p>åŽç¼€è§„åˆ™ç”±ä¸€ä¸ªæˆ–ä¸¤ä¸ªè¿žæŽ¥åŽç”¨ä½œç›®æ ‡çš„åŽç¼€ç»„æˆï¼š</p><p>Suffix rules consist of one or two suffixes concatenated and
          used as a target:</p><a id="OEBPS/ch02s04.html.I_2_tt59"></a><pre class="programlisting">.co:
        $(COMPILE.c) $(OUTPUT_OPTION) $&lt;</pre><pre class="programlisting">.c.o:
        $(COMPILE.c) $(OUTPUT_OPTION) $&lt;</pre><p>è¿™æœ‰ç‚¹ä»¤äººå›°æƒ‘ï¼Œå› ä¸ºå…ˆå†³æ¡ä»¶åŽç¼€åœ¨å‰ï¼Œç›®æ ‡åŽç¼€åœ¨åŽã€‚æ­¤è§„åˆ™ä¸Žä»¥ä¸‹ä¸€ç»„ç›¸åŒçš„ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶åŒ¹é…ï¼š</p><p>This is a little confusing because the prerequisite suffix
          comes first and the target suffix second. This rule matches the same
          set of targets and prerequisites as:</p><a id="OEBPS/ch02s04.html.I_2_tt60"></a><pre class="programlisting">%.o: %.c
        $(COMPILE.c) $(OUTPUT_OPTION) $&lt;</pre><pre class="programlisting">%.o: %.c
        $(COMPILE.c) $(OUTPUT_OPTION) $&lt;</pre><p>åŽç¼€è§„åˆ™é€šè¿‡åˆ é™¤ç›®æ ‡æ¥å½¢æˆæ–‡ä»¶çš„ä¸»å¹²<a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-961" class="indexterm"></a> <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-962" class="indexterm"></a>åŽç¼€ã€‚å®ƒé€šè¿‡å°†ç›®æ ‡åŽç¼€æ›¿æ¢ä¸ºå…ˆå†³æ¡ä»¶åŽç¼€æ¥å½¢æˆå…ˆå†³æ¡ä»¶ã€‚ä»…å½“ä¸¤ä¸ªåŽç¼€ä½äºŽå·²çŸ¥åŽç¼€åˆ—è¡¨ä¸­æ—¶ï¼Œ<em class="command">make</em>æ‰ä¼šè¯†åˆ«åŽç¼€è§„åˆ™ã€‚</p><p>The suffix rule forms the stem of the file by removing the
          target <a class="indexterm"></a> <a class="indexterm"></a>suffix. It forms the prerequisite by replacing the
          target suffix with the prerequisite suffix. The suffix rule is
          recognized by <em class="command">make</em> only if the
          two suffixes are in a list of known suffixes.</p><p>ä¸Šè¿°åŽç¼€è§„åˆ™ç§°ä¸ºåŒåŽç¼€è§„åˆ™ï¼Œå› ä¸ºå®ƒåŒ…å«ä¸¤ä¸ªåŽç¼€ã€‚è¿˜æœ‰å•åŽç¼€è§„åˆ™ã€‚æ­£å¦‚æ‚¨å¯èƒ½æƒ³è±¡çš„é‚£æ ·ï¼Œå•åŽç¼€è§„åˆ™ä»…åŒ…å«ä¸€ä¸ªåŽç¼€ï¼Œå³æºæ–‡ä»¶çš„åŽç¼€ã€‚è¿™äº›è§„åˆ™ç”¨äºŽåˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå› ä¸º Unix å¯æ‰§è¡Œæ–‡ä»¶æ²¡æœ‰åŽç¼€ï¼š</p><p>The above suffix rule is known as a double-suffix rule since
          it contains two suffixes. There are also single-suffix rules. As you
          might imagine a single-suffix rule contains only one suffix, the
          suffix of the source file. These rules are used to create
          executables since Unix executables do not have a suffix:</p><a id="OEBPS/ch02s04.html.I_2_tt61"></a><pre class="programlisting">.p:
        $(LINK.p) $^ $(LOADLIBES) $(LDLIBS) -o $@</pre><pre class="programlisting">.p:
        $(LINK.p) $^ $(LOADLIBES) $(LDLIBS) -o $@</pre><p>è¯¥è§„åˆ™ä»Ž Pascal æºæ–‡ä»¶ç”Ÿæˆå¯æ‰§è¡Œæ˜ åƒã€‚è¿™ä¸Žæ¨¡å¼è§„åˆ™å®Œå…¨ç›¸ä¼¼ï¼š</p><p>This rule produces an executable image from a Pascal source
          file. This is completely analogous to the pattern rule:</p><a id="OEBPS/ch02s04.html.I_2_tt62"></a><pre class="programlisting">%ï¼š%.p
        $(LINK.p) $^ $(LOADLIBES) $(LDLIBS) -o $@</pre><pre class="programlisting">%: %.p
        $(LINK.p) $^ $(LOADLIBES) $(LDLIBS) -o $@</pre><p>å·²çŸ¥åŽç¼€åˆ—è¡¨æ˜¯è¯­æ³•ä¸­æœ€å¥‡æ€ªçš„éƒ¨åˆ†ã€‚ç‰¹æ®Šç›®æ ‡<code class="literal">.SUFFIXES</code>ï¼Œç”¨äºŽè®¾ç½®å·²çŸ¥åŽç¼€åˆ—è¡¨ã€‚è¿™æ˜¯é»˜è®¤å®šä¹‰çš„ç¬¬ä¸€éƒ¨åˆ†<code class="literal">.SUFFIXES</code>
          ï¼š</p><p>The known suffix list is the strangest part of the syntax. A
          special target, <code class="literal">.SUFFIXES</code>, is
          used to set the list of known suffixes. Here is the first part of
          the default <code class="literal">.SUFFIXES</code>
          definition:</p><a id="OEBPS/ch02s04.html.I_2_tt63"></a><pre class="programlisting">.åŽç¼€ï¼š.out .a .ln .o .c .cc .C .cpp .p .f .F .r .y .l</pre><pre class="programlisting">.SUFFIXES: .out .a .ln .o .c .cc .C .cpp .p .f .F .r .y .l</pre><p>æ‚¨åªéœ€åœ¨<em class="filename">makefile</em><code class="literal">.SUFFIXES</code>ä¸­æ·»åŠ è§„åˆ™å³å¯æ·»åŠ è‡ªå·±çš„åŽç¼€ï¼š<em class="filename"></em></p><p>You can add your own suffixes by simply adding a <code class="literal">.SUFFIXES</code> rule to your <em class="filename">makefile</em>:</p><a id="OEBPS/ch02s04.html.I_2_tt64"></a><pre class="programlisting">.åŽç¼€ï¼š.pdf .fo .html .xml</pre><pre class="programlisting">.SUFFIXES: .pdf .fo .html .xml</pre><p>å¦‚æžœä½ æƒ³åˆ é™¤æ‰€æœ‰<a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-963" class="indexterm"></a> <a id="OEBPS/ch02s04.html.make3-CHP-2-ITERM-964" class="indexterm"></a>å·²çŸ¥åŽç¼€ï¼ˆå› ä¸ºå®ƒä»¬ä¼šå¹²æ‰°æ‚¨çš„ç‰¹æ®ŠåŽç¼€ï¼‰åªéœ€æŒ‡å®šä»»ä½•å…ˆå†³æ¡ä»¶ï¼š</p><p>If you want to delete all the <a class="indexterm"></a> <a class="indexterm"></a>known suffixes (because they are interfering with your
          special suffixes) simply specify no prerequisites:</p><a id="OEBPS/ch02s04.html.I_2_tt65"></a><pre class="programlisting">.åŽç¼€ï¼š</pre><pre class="programlisting">.SUFFIXES:</pre><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œé€‰é¡¹
          <code class="option">â€”no-builtin-rules</code>ï¼ˆæˆ–<code class="option">-r</code>ï¼‰ã€‚</p><p>You can also use the command-line option
          <code class="option">â€”no-builtin-rules</code> (or <code class="option">-r</code>).</p><p>åœ¨æœ¬ä¹¦çš„å…¶ä½™éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šä½¿ç”¨è¿™ç§æ—§è¯­æ³•ï¼Œå› ä¸º<acronym class="acronym">GNU </acronym> <em class="command">make</em>çš„æ¨¡å¼è§„åˆ™æ›´æ¸…æ™°ã€æ›´é€šç”¨ã€‚</p><p>We will not use this old syntax in the rest of this book
          because <acronym class="acronym">GNU</acronym> <em class="command">make</em>'s pattern rules are clearer and more
          general.</p></div></div></div></div>
<div id="OEBPS/ch02s05.html"><div>
<div class="sect1" title="éšå¼è§„åˆ™æ•°æ®åº“"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch02s05.html.make3-CHP-2-SECT-5"></a>éšå¼è§„åˆ™æ•°æ®åº“</h1><h1 class="title"><a></a>The Implicit Rules Database</h1></div></div></div><p><acronym class="acronym">GNU </acronym> <em class="command">make</em> 
        3.80 å†…ç½®äº†å¤§çº¦ 90 ä¸ª<a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-965" class="indexterm"></a> <a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-966" class="indexterm"></a>éšå«è§„åˆ™ã€‚éšå¼è§„åˆ™æ˜¯æ¨¡å¼è§„åˆ™æˆ–åŽç¼€è§„åˆ™ã€‚ Cã€C++ã€Pascalã€FORTRANã€ratforã€Modulaã€Texinfoã€ <sub>TEX</sub>ï¼ˆåŒ…æ‹¬ Tangle å’Œ Weaveï¼‰ã€Emacs Lispã€RCS å’Œ SCCSéƒ½æœ‰å†…ç½®æ¨¡å¼è§„åˆ™ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰æ”¯æŒè¿™äº›è¯­è¨€çš„ç¨‹åºçš„è§„åˆ™ï¼Œä¾‹å¦‚
        <em class="command">cpp</em>ã€<em class="command">as</em>ã€<em class="command">yacc</em>ã€
         <em class="command">lex</em>ã€<em class="command">tangle</em>ã€<em class="command">weave</em>å’Œ dvi å·¥å…·ã€‚</p><p><acronym class="acronym">GNU</acronym> <em class="command">make</em>
        3.80 has about 90 built-in <a class="indexterm"></a> <a class="indexterm"></a>implicit rules. An implicit rule is either a pattern
        rule or a suffix rule. There are built-in pattern rules for C, C++,
        Pascal, FORTRAN, ratfor, Modula, Texinfo, T<sub>E</sub>X
        (including Tangle and Weave), Emacs Lisp, RCS, and SCCS. In addition,
        there are rules for supporting programs for these languages, such as
        <em class="command">cpp</em>, <em class="command">as</em>, <em class="command">yacc</em>,
        <em class="command">lex</em>, <em class="command">tangle</em>, <em class="command">weave</em> and dvi tools.</p><p>å¦‚æžœæ‚¨æ­£åœ¨ä½¿ç”¨è¿™äº›å·¥å…·ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œæ‚¨å¯èƒ½ä¼šåœ¨å†…ç½®è§„åˆ™ä¸­æ‰¾åˆ°æ‚¨éœ€è¦çš„å¤§éƒ¨åˆ†å†…å®¹ã€‚å¦‚æžœæ‚¨ä½¿ç”¨ä¸€äº›ä¸å—æ”¯æŒçš„è¯­è¨€ï¼Œä¾‹å¦‚ Java æˆ– XMLï¼Œåˆ™å¿…é¡»ç¼–å†™è‡ªå·±çš„è§„åˆ™ã€‚ä½†ä¸ç”¨æ‹…å¿ƒï¼Œæ‚¨é€šå¸¸åªéœ€è¦ä¸€äº›è§„åˆ™æ¥æ”¯æŒä¸€ç§è¯­è¨€ï¼Œè€Œä¸”å®ƒä»¬å¾ˆå®¹æ˜“ç¼–å†™ã€‚</p><p>If you are using any of these tools, you'll probably find most
        of what you need in the built-in rules. If you're using some
        unsupported languages such as Java or XML, you will have to write
        rules of your own. But don't worry, you typically need only a few
        rules to support a language and they are quite easy to write.</p><p><em class="command">è¦æ£€æŸ¥make</em>ä¸­å†…ç½®çš„è§„åˆ™æ•°æ®åº“ï¼Œè¯·ä½¿ç”¨
        <code class="option">â€”print-data-base</code>å‘½ä»¤è¡Œé€‰é¡¹ï¼ˆ<code class="option">-p</code>ç®€ç§°ï¼‰ã€‚è¿™å°†ç”Ÿæˆå¤§çº¦ä¸€åƒè¡Œè¾“å‡ºã€‚åœ¨ç‰ˆæœ¬å’Œç‰ˆæƒä¿¡æ¯ä¹‹åŽï¼Œ<em class="command">make</em>æ‰“å°å…¶å˜é‡å®šä¹‰ï¼Œæ¯ä¸ªå˜é‡å®šä¹‰å‰é¢éƒ½æœ‰ä¸€ä¸ªæ³¨é‡Šï¼ŒæŒ‡ç¤ºå®šä¹‰çš„â€œèµ·æºâ€ã€‚ä¾‹å¦‚ï¼Œå˜é‡å¯ä»¥æ˜¯çŽ¯å¢ƒå˜é‡ã€é»˜è®¤å€¼ã€è‡ªåŠ¨å˜é‡ç­‰ã€‚å˜é‡ä¹‹åŽæ˜¯è§„åˆ™ã€‚<acronym class="acronym">GNU </acronym> <em class="command">make</em>ä½¿ç”¨çš„å®žé™…æ ¼å¼æ˜¯ï¼š</p><p>To examine the rules database built into <em class="command">make</em>, use the
        <code class="option">â€”print-data-base</code> command-line option
        (<code class="option">-p</code> for short). This will generate about a thousand
        lines of output. After version and copyright information, <em class="command">make</em> prints its variable definitions each
        one preceded by a comment indicating the "origin" of the definition.
        For instance, variables can be environment variables, default values,
        automatic variables, etc. After the variables, come the rules. The
        actual format used by <acronym class="acronym">GNU</acronym> <em class="command">make</em> is:</p><a id="OEBPS/ch02s05.html.I_2_tt66"></a><pre class="programlisting">ï¼…ï¼š ï¼…ã€‚C
# è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆå†…ç½®ï¼‰ï¼š
        $(LINK.C) $^ $(LOADLIBES) $(LDLIBS) -o $@</pre><pre class="programlisting">%: %.C
#  commands to execute (built-in):
        $(LINK.C) $^ $(LOADLIBES) $(LDLIBS) -o $@</pre><p><em class="filename">å¯¹äºŽmakefile</em>å®šä¹‰çš„è§„åˆ™ï¼Œæ³¨é‡Šå°†åŒ…æ‹¬å®šä¹‰è§„åˆ™çš„æ–‡ä»¶å’Œè¡Œï¼š</p><p>For rules defined by the <em class="filename">makefile</em>, the comment will include the file
        and line where the rule was defined:</p><a id="OEBPS/ch02s05.html.I_2_tt67"></a><pre class="programlisting">%.html: %.xml
# è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆæ¥è‡ªâ€œMakefileâ€ï¼Œç¬¬ 168 è¡Œï¼‰ï¼š
        $(XMLTO) $(XMLTO_FLAGS) html-nochunks $&lt;</pre><pre class="programlisting">%.html: %.xml
#  commands to execute (from `Makefile', line 168):
        $(XMLTO) $(XMLTO_FLAGS) html-nochunks $&lt;</pre><div class="sect2" title="ä½¿ç”¨éšå¼è§„åˆ™"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch02s05.html.make3-CHP-2-SECT-5.1"></a>ä½¿ç”¨éšå¼è§„åˆ™</h2><h2 class="title"><a></a>Working with Implicit Rules</h2></div></div></div><p>å†…ç½®éšå¼è§„åˆ™<a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-967" class="indexterm"></a> <a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-968" class="indexterm"></a> <a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-969" class="indexterm"></a>æ¯å½“è€ƒè™‘ç›®æ ‡å¹¶ä¸”æ²¡æœ‰æ˜Žç¡®çš„è§„åˆ™æ¥æ›´æ–°å®ƒæ—¶å°±ä¼šåº”ç”¨ã€‚å› æ­¤ï¼Œä½¿ç”¨éšå¼è§„åˆ™å¾ˆç®€å•ï¼šåªéœ€åœ¨å°†ç›®æ ‡æ·»åŠ åˆ°<em class="filename">makefile</em>æ—¶ä¸æŒ‡å®šå‘½ä»¤è„šæœ¬å³å¯ã€‚è¿™ä¼šå¯¼è‡´
          <em class="command">make</em>æœç´¢å…¶å†…ç½®æ•°æ®åº“ä»¥æ»¡è¶³ç›®æ ‡ã€‚é€šå¸¸è¿™æ­£æ˜¯æ‚¨æƒ³è¦çš„ï¼Œä½†åœ¨æžå°‘æ•°æƒ…å†µä¸‹æ‚¨çš„å¼€å‘çŽ¯å¢ƒå¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æœ‰ä¸€ä¸ªç”± Lisp å’Œ C æºä»£ç ç»„æˆçš„æ··åˆè¯­è¨€çŽ¯å¢ƒã€‚å¦‚æžœæ–‡ä»¶
          <em class="filename">editor.l</em>å’Œ<em class="filename">editor.c</em>éƒ½å­˜åœ¨äºŽåŒä¸€ç›®å½•ä¸­ï¼ˆå‡è®¾å…¶ä¸­ä¸€ä¸ªæ˜¯å¦ä¸€ä¸ªè¢«å¦ä¸€ä¸ªè®¿é—®çš„ä½Žçº§å®žçŽ°ï¼‰ï¼Œé‚£ä¹ˆ
          <em class="command">make</em>å°†è®¤ä¸º Lisp æ–‡ä»¶å®žé™…ä¸Šæ˜¯ä¸€ä¸ª<em class="command">Flex</em>æ–‡ä»¶ï¼ˆå›žæƒ³ä¸€ä¸‹ï¼Œ<em class="command">flex</em>æ–‡ä»¶ä½¿ç”¨
          <em class="filename">.låŽç¼€ï¼‰å¹¶ä¸” C æºä»£ç æ˜¯</em><em class="command">flex</em>å‘½ä»¤çš„è¾“å‡º
          ã€‚å¦‚æžœ<em class="filename">editor.o</em>æ˜¯ç›®æ ‡ï¼Œå¹¶ä¸”<em class="filename">editor.l</em>æ¯”<em class="filename">editor.c</em>æ–°ï¼Œ<em class="command">makeå°†å°è¯•ä½¿ç”¨</em><em class="command">flex</em>çš„
          è¾“å‡ºè¦†ç›–æºä»£ç æ¥â€œæ›´æ–°â€C æ–‡ä»¶ã€‚å˜Žå…‹ã€‚</p><p>The built-in implicit rules <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>are applied whenever a target is being considered and
          there is no explicit rule to update it. So using an implicit rule is
          easy: simply do not specify a command script when adding your target
          to the <em class="filename">makefile</em>. This causes
          <em class="command">make</em> to search its built-in
          database to satisfy the target. Usually this does just what you
          want, but in rare cases your development environment can cause
          problems. For instance, suppose you have a mixed language
          environment consisting of Lisp and C source code. If the file
          <em class="filename">editor.l</em> and <em class="filename">editor.c</em> both exist in the same directory
          (say one is a low-level implementation accessed by the other)
          <em class="command">make</em> will believe that the Lisp
          file is really a <em class="command">flex</em> file
          (recall <em class="command">flex</em> files use the
          <em class="filename">.l</em> suffix) and that the C
          source is the output of the <em class="command">flex</em>
          command. If <em class="filename">editor.o</em> is a
          target and <em class="filename">editor.l</em> is newer
          than <em class="filename">editor.c</em>, <em class="command">make</em> will attempt to "update" the C file
          with the output of <em class="command">flex</em>
          overwriting your source code. Gack.</p><p>è¦è§£å†³è¿™ä¸ªç‰¹å®šé—®é¢˜ï¼Œæ‚¨å¯ä»¥ä»Žå†…ç½®è§„åˆ™åº“ä¸­åˆ é™¤æœ‰å…³<em class="command">flex</em>çš„ä¸¤æ¡è§„åˆ™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>To work around this particular problem you can delete the two
          rules concerning <em class="command">flex</em> from the
          built-in rule base like this:</p><a id="OEBPS/ch02s05.html.I_2_tt68"></a><pre class="programlisting">%.o: %.l
%.c: %.l</pre><pre class="programlisting">%.o: %.l
%.c: %.l</pre><p><em class="command">æ²¡æœ‰å‘½ä»¤è„šæœ¬çš„æ¨¡å¼å°†ä»Žmake</em>çš„æ•°æ®åº“ä¸­åˆ é™¤è§„åˆ™
          ã€‚åœ¨å®žè·µä¸­ï¼Œè¿™æ ·çš„æƒ…å†µéžå¸¸ç½•è§ã€‚ç„¶è€Œï¼Œé‡è¦çš„æ˜¯è¦è®°ä½å†…ç½®è§„åˆ™æ•°æ®åº“åŒ…å«çš„è§„åˆ™å°†ä»¥æ‚¨å¯èƒ½æ²¡æœ‰é¢„æ–™åˆ°çš„æ–¹å¼ä¸Žæ‚¨è‡ªå·±çš„<em class="filename">makefileè¿›è¡Œäº¤äº’ã€‚</em></p><p>A pattern with no command script will remove the rule from
          <em class="command">make</em>'s database. In practice,
          situations such as this are very rare. However, it is important to
          remember the built-in rules database contains rules that will
          interact with your own <em class="filename">makefile</em>s in ways you may not have
          anticipated.</p><p>æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å‡ ä¸ªç¤ºä¾‹ï¼Œè¯´æ˜Ž<em class="command">make</em>å¦‚ä½•åœ¨å°è¯•æ›´æ–°ç›®æ ‡æ—¶å°†è§„åˆ™â€œé“¾æŽ¥â€åœ¨ä¸€èµ·ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›å¤æ‚æ€§ï¼Œæˆ‘ä»¬å°†åœ¨è¿™é‡Œè¿›è¡Œç ”ç©¶ã€‚å½“<em class="command">make</em>
          è€ƒè™‘å¦‚ä½•æ›´æ–°ç›®æ ‡æ—¶ï¼Œå®ƒä¼šåœ¨éšå¼è§„åˆ™ä¸­æœç´¢ä¸Žå½“å‰ç›®æ ‡åŒ¹é…çš„ç›®æ ‡æ¨¡å¼ã€‚å¯¹äºŽä¸Žç›®æ ‡æ–‡ä»¶åŒ¹é…çš„æ¯ä¸ªç›®æ ‡æ¨¡å¼ï¼Œ<em class="command">make</em>å°†æŸ¥æ‰¾çŽ°æœ‰çš„åŒ¹é…å…ˆå†³æ¡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨åŒ¹é…ç›®æ ‡æ¨¡å¼åŽï¼Œ<em class="command">make</em>ç«‹å³æŸ¥æ‰¾å…ˆå†³æ¡ä»¶â€œæºâ€æ–‡ä»¶ã€‚å¦‚æžœæ‰¾åˆ°å…ˆå†³æ¡ä»¶ï¼Œåˆ™ä½¿ç”¨è¯¥è§„åˆ™ã€‚å¯¹äºŽæŸäº›ç›®æ ‡æ¨¡å¼ï¼Œæœ‰è®¸å¤šå¯èƒ½çš„æºæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œ<em class="filename">.oæ–‡ä»¶å¯ä»¥ç”±</em><em class="filename">.c</em>ã€<em class="filename">.cc</em>ã€<em class="filename">.cpp</em>ã€<em class="filename">.p</em>ã€<em class="filename">.f</em>ã€<em class="filename">.r</em>ã€<em class="filename">.s</em>å’Œ<em class="filename">.mod</em>æ–‡ä»¶åˆ›å»ºã€‚ä½†æ˜¯å¦‚æžœæœç´¢å®Œæ‰€æœ‰å¯èƒ½çš„è§„åˆ™åŽéƒ½æ²¡æœ‰æ‰¾åˆ°æ¥æºæ€Žä¹ˆåŠžï¼Ÿåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<em class="command">make</em>å°†å†æ¬¡æœç´¢è§„åˆ™ï¼Œè¿™æ¬¡å‡è®¾åŒ¹é…çš„æºæ–‡ä»¶åº”è¢«è§†ä¸ºæ–°çš„æ›´æ–°ç›®æ ‡ã€‚é€šè¿‡é€’å½’åœ°æ‰§è¡Œæ­¤æœç´¢ï¼Œ
           <em class="command">make</em>å¯ä»¥æ‰¾åˆ°å…è®¸æ›´æ–°ç›®æ ‡çš„è§„åˆ™â€œé“¾â€ã€‚æˆ‘ä»¬åœ¨<em class="filename">lexer.o</em>ç¤ºä¾‹ä¸­çœ‹åˆ°äº†è¿™ä¸€ç‚¹ã€‚å³ä½¿
          é€šè¿‡è°ƒç”¨<em class="filename">.l</em>åˆ°<em class="filename">.c</em>è§„åˆ™ï¼Œç„¶åŽè°ƒç”¨<em class="filename">.c</em>åˆ°<em class="filename">.o</em>è§„åˆ™ç¼ºå°‘ä¸­é—´<em class="filename">.cæ–‡ä»¶ï¼Œ </em><em class="command">make</em>ä¹Ÿèƒ½å¤Ÿä»Ž<em class="filename">lexer.læ›´æ–°</em><em class="filename">lexer.o</em>ç›®æ ‡ã€‚<em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em></p><p>We have seen several examples of how <em class="command">make</em> will "chain" rules together while
          trying to update a target. This can lead to some complexity, which
          we'll examine here. When <em class="command">make</em>
          considers how to update a target, it searches the implicit rules for
          a target pattern that matches the target in hand. For each target
          pattern that matches the target file, <em class="command">make</em> will look for an existing matching
          prerequisite. That is, after matching the target pattern, <em class="command">make</em> immediately looks for the
          prerequisite "source" file. If the prerequisite is found, the rule
          is used. For some target patterns, there are many possible source
          files. For instance, a <em class="filename">.o</em> file
          can be made from <em class="filename">.c</em>, <em class="filename">.cc</em>, <em class="filename">.cpp</em>, <em class="filename">.p</em>, <em class="filename">.f</em>, <em class="filename">.r</em>, <em class="filename">.s</em>, and <em class="filename">.mod</em> files. But what if the source is not
          found after searching all possible rules? In this case, <em class="command">make</em> will search the rules again, this
          time assuming that the matching source file should be considered as
          a new target for updating. By performing this search recursively,
          <em class="command">make</em> can find a "chain" of rules
          that allows updating a target. We saw this in our <em class="filename">lexer.o</em> example. <em class="command">make</em> was able to update the <em class="filename">lexer.o</em> target from <em class="filename">lexer.l</em> even though the intermediate
          <em class="filename">.c</em> file was missing by invoking
          the <em class="filename">.l</em> to <em class="filename">.c</em> rule, then the <em class="filename">.c</em> to <em class="filename">.o</em> rule.</p><p><em class="command">è¿™é‡Œæ˜¾ç¤ºäº†make</em>å¯ä»¥ä»Žå…¶æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆçš„æ›´ä»¤äººå°è±¡æ·±åˆ»çš„åºåˆ—ä¹‹ä¸€ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡åˆ›å»ºä¸€ä¸ªç©ºçš„<em class="command">yacc</em>æºæ–‡ä»¶å¹¶ä½¿ç”¨<em class="command">ci</em>å‘ RCS æ³¨å†Œæ¥è®¾ç½®æˆ‘ä»¬çš„å®žéªŒ
          ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç‰ˆæœ¬æŽ§åˆ¶çš„<em class="command">yacc</em>æºæ–‡ä»¶ï¼‰ï¼š</p><p>One of the more impressive sequences that <em class="command">make</em> can produce automatically from its
          database is shown here. First, we setup our experiment by creating
          an empty <em class="command">yacc</em> source file and
          registering with RCS using <em class="command">ci</em>
          (that is, we want a version-controlled <em class="command">yacc</em> source file):</p><a id="OEBPS/ch02s05.html.I_2_tt69"></a><pre class="programlisting">$$<strong class="userinput"><code>touch foo.y</code></strong>
â€‹<strong class="userinput"><code>ci foo.y</code></strong>
foo.y,v &lt;-- foo.y
ã€‚
åˆæ­¥ä¿®è®¢ï¼š1.1
å®Œæ¯•</pre><pre class="programlisting">$<strong class="userinput"><code>touch foo.y</code></strong>
$ <strong class="userinput"><code>ci foo.y</code></strong>
foo.y,v  &lt;--  foo.y
.
initial revision: 1.1
done</pre><p>çŽ°åœ¨ï¼Œæˆ‘ä»¬è¯¢é—®<em class="command">make</em>å¦‚ä½•åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶<em class="filename">foo</em>ã€‚<code class="option">â€”just-print</code>(æˆ–
          <code class="option">-n</code>) é€‰é¡¹å‘Šè¯‰make<em class="command">æŠ¥å‘Š</em>å®ƒå°†æ‰§è¡Œå“ªäº›æ“ä½œï¼Œè€Œæ— éœ€å®žé™…è¿è¡Œå®ƒä»¬ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ²¡æœ‰
          <em class="filename">makefile</em>ï¼Œä¹Ÿæ²¡æœ‰â€œæºâ€ä»£ç ï¼Œåªæœ‰ä¸€ä¸ª RCS æ–‡ä»¶ï¼š</p><p>Now, we ask <em class="command">make</em> how it
          would create the executable <em class="filename">foo</em>. The <code class="option">â€”just-print</code> (or
          <code class="option">-n</code>) option tells <em class="command">make</em> to report what actions it would
          perform without actually running them. Notice that we have no
          <em class="filename">makefile</em> and no "source" code,
          only an RCS file:</p><a id="OEBPS/ch02s05.html.I_2_tt70"></a><pre class="programlisting">$<strong class="userinput"><code>make -n foo</code></strong>
co foo.y,v foo.y
foo.y,v --&gt; foo.y
ä¿®è®¢ç‰ˆ1.1
å®Œæ¯•
é‡Žç‰› -y foo.y
mv -f y.tab.c foo.c
gcc -c -o foo.o foo.c
gcc foo.o -o foo
rm foo.c foo.o foo.y</pre><pre class="programlisting">$<strong class="userinput"><code>make -n foo</code></strong>
co  foo.y,v foo.y
foo.y,v  --&gt;  foo.y
revision 1.1
done
bison -y  foo.y
mv -f y.tab.c foo.c
gcc    -c -o foo.o foo.c
gcc   foo.o   -o foo
rm foo.c foo.o foo.y</pre><p>éµå¾ªéšå¼è§„åˆ™å’Œå…ˆå†³æ¡ä»¶é“¾ï¼Œ
           <em class="command">make</em>ç¡®å®šå®ƒå¯ä»¥åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶<em class="filename">foo</em>ï¼Œå¦‚æžœå®ƒå…·æœ‰ç›®æ ‡æ–‡ä»¶<em class="filename">foo.o</em>ã€‚å¦‚æžœå®ƒæœ‰ C æºæ–‡ä»¶<em class="filename">foo.c</em> ï¼Œå®ƒå¯ä»¥åˆ›å»º<em class="filename">foo.o</em>ã€‚å¦‚æžœå®ƒæœ‰ yacc æºæ–‡ä»¶<em class="filename">foo.y</em> ï¼Œå®ƒå¯ä»¥åˆ›å»º<em class="filename">foo.c</em>ã€‚æœ€åŽï¼Œå®ƒæ„è¯†åˆ°å¯ä»¥é€šè¿‡ä»Žå®ƒå®žé™…æ‹¥æœ‰çš„RCS æ–‡ä»¶<em class="filename">foo.y,v</em>
          ä¸­æ£€å‡ºè¯¥æ–‡ä»¶æ¥åˆ›å»º<em class="filename">foo.y</em> ã€‚ä¸€æ—¦
          <em class="command">make</em>åˆ¶å®šäº†è¿™ä¸ªè®¡åˆ’ï¼Œå®ƒå°±ä¼šé€šè¿‡ç”¨<em class="command">co</em>æ£€æŸ¥<em class="filename">foo.y</em>ï¼Œç”¨<em class="command">bisonå°†å…¶è½¬æ¢ä¸º</em><em class="filename">foo.c</em>ï¼Œç”¨<em class="command">gccå°†å…¶ç¼–è¯‘ä¸º</em><em class="filename">foo.o ï¼Œå¹¶ç”¨</em><em class="command">gcc</em>å°†å…¶å†æ¬¡é“¾æŽ¥å½¢æˆ<em class="filename">foo</em>æ¥æ‰§è¡Œå®ƒã€‚æ‰€æœ‰è¿™äº›éƒ½æ¥è‡ªéšå¼è§„åˆ™æ•°æ®åº“ã€‚å¾ˆé…·ã€‚<em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="command"></em><em class="filename"></em><em class="command"></em><em class="filename"></em><em class="command"></em><em class="filename"></em><em class="command"></em><em class="filename"></em><em class="command"></em></p><p>Following the chain of implicit rules and prerequisites,
          <em class="command">make</em> determined it could create
          the executable, <em class="filename">foo</em>, if it had
          the object file <em class="filename">foo.o</em>. It could
          create <em class="filename">foo.o</em> if it had the C
          source file <em class="filename">foo.c</em>. It could
          create <em class="filename">foo.c</em> if it had the yacc
          source file <em class="filename">foo.y</em>. Finally, it
          realized it could create <em class="filename">foo.y</em>
          by checking out the file from the RCS file <em class="filename">foo.y,v</em>, which it actually has. Once
          <em class="command">make</em> has formulated this plan, it
          executes it by checking out <em class="filename">foo.y</em> with <em class="command">co</em>, transforming it into <em class="filename">foo.c</em> with <em class="command">bison</em>, compiling it into <em class="filename">foo.o</em> with <em class="command">gcc</em>, and linking it to form <em class="filename">foo</em> again with <em class="command">gcc</em>. All this from the implicit rules
          database. Pretty cool.</p><p>ç”Ÿæˆçš„æ–‡ä»¶<a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-970" class="indexterm"></a> <a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-971" class="indexterm"></a> <a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-972" class="indexterm"></a>é€šè¿‡é“¾æŽ¥è§„åˆ™ç§°ä¸º
          <em class="firstterm">ä¸­é—´æ–‡ä»¶ï¼Œå¹¶ç”±</em><em class="command">make</em>ç‰¹æ®Šå¤„ç†ã€‚é¦–å…ˆï¼Œç”±äºŽä¸­é—´æ–‡ä»¶ä¸ä¼šå‡ºçŽ°åœ¨ç›®æ ‡ä¸­ï¼ˆå¦åˆ™å®ƒä»¬å°±ä¸ä¼šæ˜¯ä¸­é—´æ–‡ä»¶ï¼‰ï¼Œå› æ­¤<em class="command">make</em>æ°¸è¿œä¸ä¼šç®€å•åœ°æ›´æ–°ä¸­é—´æ–‡ä»¶ã€‚å…¶æ¬¡ï¼Œå› ä¸º<em class="command">make</em>æœ¬èº«ä¼šåˆ›å»ºä¸­é—´æ–‡ä»¶ä½œä¸ºæ›´æ–°ç›®æ ‡çš„å‰¯ä½œç”¨ï¼Œæ‰€ä»¥<em class="command">make</em>å°†åœ¨é€€å‡ºä¹‹å‰åˆ é™¤ä¸­é—´æ–‡ä»¶ã€‚æ‚¨å¯ä»¥åœ¨ç¤ºä¾‹çš„æœ€åŽä¸€è¡Œçœ‹åˆ°è¿™ä¸€ç‚¹ã€‚</p><p>The files generated <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>by chaining rules are called
          <em class="firstterm">intermediate</em> files and are treated specially
          by <em class="command">make</em>. First, since
          intermediate files do not occur in targets (otherwise they would not
          be intermediate), <em class="command">make</em> will never
          simply update an intermediate file. Second, because <em class="command">make</em> creates intermediate files itself as
          a side effect of updating a target, <em class="command">make</em> will delete the intermediates before
          exiting. You can see this in the last line of the example.</p><p>éšå¼è§„åˆ™æ•°æ®åº“åŒ…å«å¤§é‡è§„åˆ™ï¼Œå³ä½¿éžå¸¸å¤§çš„é¡¹ç›®ä¹Ÿå¾ˆå°‘ä½¿ç”¨å…¶ä¸­çš„å¤§éƒ¨åˆ†è§„åˆ™ã€‚å› ä¸ºå®ƒåŒ…å«å¦‚æ­¤å¹¿æ³›çš„ç§ç±»ï¼Œæ‰€ä»¥ make å¯èƒ½ä¼šä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼ä½¿ç”¨æ‚¨æ²¡æœ‰é¢„æ–™åˆ°çš„è§„åˆ™ã€‚ä½œä¸ºé¢„é˜²æŽªæ–½ï¼Œä¸€äº›å¤§åž‹é¡¹ç›®é€‰æ‹©å®Œå…¨æ”¾å¼ƒéšå«è§„åˆ™ï¼Œè½¬è€Œé‡‡ç”¨è‡ªå·±æ‰‹å·¥åˆ¶å®šçš„è§„åˆ™ã€‚æ‚¨å¯ä»¥ä½¿ç”¨
          <code class="literal">--no-builtin-rules</code>(æˆ–<code class="literal">-r</code>) é€‰é¡¹è½»æ¾å®Œæˆæ­¤æ“ä½œã€‚ ï¼ˆå³ä½¿åœ¨æœ€å¤§çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä¹Ÿä»Žæœªä½¿ç”¨è¿‡æ­¤é€‰é¡¹ã€‚ï¼‰å¦‚æžœæ‚¨ä½¿ç”¨æ­¤é€‰é¡¹ï¼Œæ‚¨å¯èƒ½è¿˜éœ€è¦è€ƒè™‘ä½¿ç”¨<code class="literal">--no-builtin-variables</code>(æˆ–
          <code class="literal">-R</code>)ã€‚</p><p>The implicit rules database contains a lot of rules and even
          very large projects rarely use most of it. Because it contains such
          a wide variety, rules you didn't expect to fire may be used by make
          in unexpected ways. As a preventative measure, some large projects
          choose to discard the implicit rules entirely in favor of their own
          hand-crafted rules. You can do this easily with the
          <code class="literal">--no-builtin-rules</code> (or <code class="literal">-r</code>)
          option. (I have never had to use this option even on the largest
          projects.) If you use this option, you may also want to consider
          using <code class="literal">--no-builtin-variables</code> (or
          <code class="literal">-R</code>). </p></div><div class="sect2" title="è§„åˆ™ç»“æž„"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch02s05.html.make3-CHP-2-SECT-5.2"></a>è§„åˆ™ç»“æž„</h2><h2 class="title"><a></a>Rule Structure</h2></div></div></div><p>å†…ç½®è§„åˆ™æœ‰æ ‡å‡†<a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-973" class="indexterm"></a> <a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-974" class="indexterm"></a>æ—¨åœ¨ä½¿å®ƒä»¬æ˜“äºŽå®šåˆ¶çš„ç»“æž„ã€‚è®©æˆ‘ä»¬ç®€å•å›žé¡¾ä¸€ä¸‹ç»“æž„ï¼Œç„¶åŽè®¨è®ºå®šåˆ¶ã€‚è¿™æ˜¯ï¼ˆçŽ°åœ¨ç†Ÿæ‚‰çš„ï¼‰æ›´æ–°è§„åˆ™<a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-975" class="indexterm"></a> <a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-976" class="indexterm"></a>æ¥è‡ªå…¶ C æºä»£ç çš„ç›®æ ‡æ–‡ä»¶ï¼š</p><p>The built-in rules have a standard <a class="indexterm"></a> <a class="indexterm"></a>structure intended to make them easily customizable.
          Let's go over the structure briefly then talk about customization.
          Here is the (by now familiar) rule for updating an <a class="indexterm"></a> <a class="indexterm"></a>object file from its C source:</p><a id="OEBPS/ch02s05.html.I_2_tt71"></a><pre class="programlisting">%.o: %.c
        $(COMPILE.c) $(OUTPUT_OPTION) $&lt;</pre><pre class="programlisting">%.o: %.c
        $(COMPILE.c) $(OUTPUT_OPTION) $&lt;</pre><p>è¯¥è§„åˆ™çš„å®šåˆ¶æ˜¯å®Œå…¨å—æŽ§çš„
          <a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-977" class="indexterm"></a> <a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-978" class="indexterm"></a>é€šè¿‡å®ƒä½¿ç”¨çš„å˜é‡é›†ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°ä¸¤ä¸ªå˜é‡ï¼Œä½†<code class="literal">COMPILE.c</code>ç‰¹åˆ«æ˜¯æ ¹æ®å…¶ä»–å‡ ä¸ªå˜é‡å®šä¹‰çš„ï¼š</p><p>The customization of this rule is controlled entirely
          <a class="indexterm"></a> <a class="indexterm"></a>by the set of variables it uses. We see two variables
          here, but <code class="literal">COMPILE.c</code> in particular
          is defined in terms of several other variables:</p><a id="OEBPS/ch02s05.html.I_2_tt72"></a><pre class="programlisting">ç¼–è¯‘.c = $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c
CC = æµ·æ¹¾åˆä½œå§”å‘˜ä¼š
è¾“å‡ºé€‰é¡¹ = -o $@</pre><pre class="programlisting">COMPILE.c = $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c
CC = gcc
OUTPUT_OPTION = -o $@</pre><p>C ç¼–è¯‘å™¨æœ¬èº«å¯ä»¥é€šè¿‡æ”¹å˜å˜é‡çš„å€¼æ¥æ”¹å˜<code class="literal">CC</code>ã€‚å…¶ä»–å˜é‡ç”¨äºŽè®¾ç½®ç¼–è¯‘é€‰é¡¹ ( <code class="literal">CFLAGS</code>)ã€é¢„å¤„ç†å™¨é€‰é¡¹ ( <code class="literal">CPPFLAGS</code>) å’Œç‰¹å®šäºŽä½“ç³»ç»“æž„çš„é€‰é¡¹ ( <code class="literal">TARGET_ARCH</code>)ã€‚</p><p>The C compiler itself can be changed by altering the value of
          the <code class="literal">CC</code> variable. The other
          variables are used for setting compilation options (<code class="literal">CFLAGS</code>), preprocessor options (<code class="literal">CPPFLAGS</code>), and architecture-specific
          options (<code class="literal">TARGET_ARCH</code>).</p><p>å†…ç½®è§„åˆ™ä¸­çš„å˜é‡<a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-979" class="indexterm"></a> <a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-980" class="indexterm"></a>æ—¨åœ¨ä½¿è‡ªå®šä¹‰è§„åˆ™å°½å¯èƒ½å®¹æ˜“ã€‚å› æ­¤ï¼Œåœ¨ makefile ä¸­è®¾ç½®è¿™äº›å˜é‡æ—¶åŠ¡å¿…è¦éžå¸¸<em class="filename">å°å¿ƒ</em>ã€‚å¦‚æžœæ‚¨ä»¥å¹¼ç¨šçš„æ–¹å¼è®¾ç½®è¿™äº›å˜é‡ï¼Œåˆ™ä¼šç ´åæœ€ç»ˆç”¨æˆ·è‡ªå®šä¹‰å®ƒä»¬çš„èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œåœ¨<em class="filename">makefile</em>ä¸­ç»™å‡ºæ­¤åˆ†é…ï¼š</p><p>The variables in a built-in rule <a class="indexterm"></a> <a class="indexterm"></a>are intended to make customizing the rule as easy as
          possible. For that reason, it is important to be very careful when
          setting these variables in your <em class="filename">makefile</em>. If you set these variables in a
          naive way, you destroy the end user's ability to customize them. For
          instance, given this assignment in a <em class="filename">makefile</em>:</p><a id="OEBPS/ch02s05.html.I_2_tt73"></a><pre class="programlisting">CPPFLAGS = -I é¡¹ç›®/åŒ…å«</pre><pre class="programlisting">CPPFLAGS = -I project/include</pre><p>å¦‚æžœç”¨æˆ·æƒ³è¦å°† CPP å®šä¹‰æ·»åŠ åˆ°å‘½ä»¤è¡Œï¼Œä»–ä»¬é€šå¸¸ä¼šè°ƒç”¨<em class="command">make</em> 
          ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>If the user wanted to add a CPP define to the command line,
          they would normally invoke <em class="command">make</em>
          like:</p><a id="OEBPS/ch02s05.html.I_2_tt74"></a><pre class="programlisting">$ ä½¿ CPPFLAGS=-DDEBUG</pre><pre class="programlisting">$ make CPPFLAGS=-DDEBUG</pre><p>ä½†è¿™æ ·åšæ—¶ï¼Œä»–ä»¬ä¼šæ„å¤–åœ°åˆ é™¤
          <code class="option">-I</code>ï¼ˆå¤§æ¦‚ï¼‰ç¼–è¯‘æ‰€éœ€çš„é€‰é¡¹ã€‚åœ¨å‘½ä»¤è¡Œä¸Šè®¾ç½®çš„å˜é‡ä¼šè¦†ç›–å¯¹è¯¥å˜é‡çš„æ‰€æœ‰å…¶ä»–åˆ†é…ã€‚ ï¼ˆæœ‰å…³å‘½ä»¤è¡Œåˆ†é…çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®">ç¬¬ 3 ç« </a>ä¸­çš„<a class="link" href="#OEBPS/ch03s06.html" title="å˜é‡ä»Žä½•è€Œæ¥">3.6 èŠ‚</a>ï¼‰ã€‚å› æ­¤ï¼Œåœ¨<em class="filename">makefile</em>ä¸­è®¾ç½®ä¸å½“ä¼šâ€œç ´åâ€å¤§å¤šæ•°ç”¨æˆ·å¸Œæœ›ä½¿ç”¨çš„è‡ªå®šä¹‰åŠŸèƒ½ã€‚ä¸è¦ä½¿ç”¨ç®€å•çš„èµ‹å€¼ï¼Œè€Œæ˜¯è€ƒè™‘é‡æ–°å®šä¹‰ç¼–è¯‘å˜é‡ä»¥åŒ…å«æ‚¨è‡ªå·±çš„å˜é‡ï¼š<a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®"></a><code class="literal">CPPFLAGS</code><em class="filename"></em></p><p>But in so doing they would accidentally remove the
          <code class="option">-I</code> option that is (presumably) required for
          compiling. Variables set on the command line override all other
          assignments to the variable. (See the <a class="link" href="#OEBPS/ch03s06.html" title="Where Variables Come From">Section 3.6</a> in <a class="link" href="#OEBPS/ch03.html" title="Chapter&nbsp;3.&nbsp;Variables and Macros">Chapter 3</a> for more details on
          command-line assignments). So, setting <code class="literal">CPPFLAGS</code> inappropriately in the <em class="filename">makefile</em> "broke" a customization feature
          that most users would expect to work. Instead of using simple
          assignment, consider redefining the compilation variable to include
          your own variables:</p><a id="OEBPS/ch02s05.html.I_2_tt75"></a><pre class="programlisting">COMPILE.c = $(CC) $(CFLAGS) $(INCLUDES) $(CPPFLAGS) $(TARGET_ARCH) -c
åŒ…æ‹¬ = -I é¡¹ç›®/åŒ…æ‹¬</pre><pre class="programlisting">COMPILE.c = $(CC) $(CFLAGS) $(INCLUDES) $(CPPFLAGS) $(TARGET_ARCH) -c
INCLUDES = -I project/include</pre><p>æˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨è¿½åŠ å¼èµ‹å€¼ï¼Œè¿™å°†åœ¨<a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®">ç¬¬ 3 ç« çš„</a><a class="link" href="#OEBPS/ch03s02.html.make3-CHP-3-SECT-2.1" title="å…¶ä»–ç±»åž‹çš„ä½œä¸š">3.2.1 èŠ‚</a>ä¸­
          è®¨è®ºã€‚<a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®"></a></p><p>Or you can use append-style assignment, which is discussed in
          the <a class="link" href="#OEBPS/ch03s02.html.make3-CHP-3-SECT-2.1" title="Other Types of Assignment">Section 3.2.1</a> in
          <a class="link" href="#OEBPS/ch03.html" title="Chapter&nbsp;3.&nbsp;Variables and Macros">Chapter 3</a>.</p></div><div class="sect2" title="æºä»£ç æŽ§åˆ¶çš„éšå¼è§„åˆ™"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch02s05.html.make3-CHP-2-SECT-5.3"></a>æºä»£ç æŽ§åˆ¶çš„éšå¼è§„åˆ™</h2><h2 class="title"><a></a>Implicit Rules for Source Control</h2></div></div></div><p><em class="command">è®©</em>çŸ¥é“<a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-981" class="indexterm"></a> <a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-982" class="indexterm"></a> <a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-983" class="indexterm"></a> <a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-984" class="indexterm"></a>ä¸¤ä¸ªæºä»£ç æŽ§åˆ¶ç³»ç»Ÿ RCS å’Œ SCCSï¼Œå¹¶æ”¯æŒå®ƒä»¬ä¸Žå†…ç½®éšå¼è§„åˆ™çš„ä½¿ç”¨ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæºä»£ç æŽ§åˆ¶å’ŒçŽ°ä»£è½¯ä»¶å·¥ç¨‹çš„æœ€å…ˆè¿›æ°´å¹³ä¼¼ä¹Žå·²ç»è½åŽäºŽ<em class="command">make</em>ã€‚æˆ‘ä»Žæœªåœ¨<em class="command">make</em>ä¸­å‘çŽ°æºä»£ç æŽ§åˆ¶æ”¯æŒçš„ç”¨é€”ï¼Œä¹Ÿæ²¡æœ‰çœ‹åˆ°å®ƒåœ¨å…¶ä»–ç”Ÿäº§è½¯ä»¶ä¸­ä½¿ç”¨ã€‚æˆ‘ä¸å»ºè®®ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚æœ‰è®¸å¤šçš„åŽŸå› ã€‚</p><p><em class="command">make</em> knows about <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>two source code control systems, RCS and SCCS, and
          supports their use with built-in implicit rules. Unfortunately, it
          seems the state of the art in source code control and modern
          software engineering have left <em class="command">make</em> behind. I've never found a use for
          the source control support in <em class="command">make</em>, nor have I seen it used in other
          production software. I do not recommend the use of this feature.
          There are a number of reasons for this.</p><p><em class="command">é¦–å…ˆï¼Œ make</em> ã€RCS å’Œ SCCSæ”¯æŒçš„æºä»£ç æŽ§åˆ¶å·¥å…·è™½ç„¶åœ¨å½“æ—¶æ˜¯æœ‰ä»·å€¼ä¸”å—äººå°Šæ•¬çš„å·¥å…·ï¼Œä½†åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå·²ç»è¢«<a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-985" class="indexterm"></a> <a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-986" class="indexterm"></a>è¢« CVSã€å¹¶å‘ç‰ˆæœ¬ç³»ç»Ÿæˆ–ä¸“æœ‰å·¥å…·å–ä»£ã€‚äº‹å®žä¸Šï¼ŒCVS ä½¿ç”¨ RCS åœ¨å†…éƒ¨ç®¡ç†å„ä¸ªæ–‡ä»¶ã€‚ç„¶è€Œï¼Œå½“ä¸€ä¸ªé¡¹ç›®è·¨è¶Šå¤šä¸ªç›®å½•æˆ–å¤šä¸ªå¼€å‘äººå‘˜æ—¶ï¼Œç›´æŽ¥ä½¿ç”¨ RCS è¢«è¯æ˜Žæ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„é—®é¢˜ã€‚ç‰¹åˆ«æ˜¯ CVS çš„å®žæ–½æ˜¯ä¸ºäº†å¡«è¡¥ RCS åœ¨è¿™äº›é¢†åŸŸçš„åŠŸèƒ½ç©ºç™½ã€‚<em class="command">make</em>ä»Žæœªæ·»åŠ å¯¹ CVS çš„æ”¯æŒï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä»¶å¥½äº‹ã€‚<sup>[ <a id="OEBPS/ch02s05.html.make3-CHP-2-FNOTE-2" href="#OEBPS/ch02s05.html.ftn.make3-CHP-2-FNOTE-2" class="footnote">2</a> ]</sup></p><p>First, the source control tools supported by <em class="command">make</em>, RCS and SCCS, although valuable and
          venerable tools in their day, have largely been <a class="indexterm"></a> <a class="indexterm"></a>supplanted by CVS, the Concurrent Version System, or
          proprietary tools. In fact, CVS uses RCS to manage individual files
          internally. However, using RCS directly proved to be a considerable
          problem when a project spanned more than one directory or more than
          one developer. CVS, in particular, was implemented to fill the gaps
          in RCS's functionality in precisely these areas. Support for CVS has
          never been added to <em class="command">make</em>, which
          is probably a good thing.<sup>[<a href="#OEBPS/ch02s05.html.ftn.make3-CHP-2-FNOTE-2" class="footnote">2</a>]</sup></p><p>çŽ°åœ¨äººä»¬æ™®éè®¤è¯†åˆ°è½¯ä»¶çš„ç”Ÿå‘½å‘¨æœŸå˜å¾—å¤æ‚ã€‚åº”ç”¨ç¨‹åºå¾ˆå°‘èƒ½é¡ºåˆ©åœ°ä»Žä¸€ä¸ªç‰ˆæœ¬è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªç‰ˆæœ¬ã€‚æ›´å…¸åž‹çš„æ˜¯ï¼Œåº”ç”¨ç¨‹åºçš„ä¸€ä¸ªæˆ–å¤šä¸ªä¸åŒç‰ˆæœ¬æ­£åœ¨çŽ°åœºä½¿ç”¨ï¼ˆå¹¶ä¸”éœ€è¦é”™è¯¯ä¿®å¤æ”¯æŒï¼‰ï¼Œè€Œä¸€ä¸ªæˆ–å¤šä¸ªç‰ˆæœ¬æ­£åœ¨ç§¯æžå¼€å‘ä¸­ã€‚ CVS æä¾›äº†å¼ºå¤§çš„åŠŸèƒ½æ¥å¸®åŠ©ç®¡ç†è½¯ä»¶çš„è¿™äº›å¹¶è¡Œç‰ˆæœ¬ã€‚ä½†è¿™ä¹Ÿæ„å‘³ç€å¼€å‘äººå‘˜å¿…é¡»éžå¸¸äº†è§£å¥¹æ­£åœ¨å¤„ç†çš„ä»£ç çš„ç‰¹å®šç‰ˆæœ¬ã€‚è®©
          <em class="filename">makefile</em>åœ¨ç¼–è¯‘æœŸé—´è‡ªåŠ¨ç­¾å‡ºæºä»£ç ä¼šå¼•å‘ä»¥ä¸‹é—®é¢˜ï¼šæ­£åœ¨ç­¾å‡ºä»€ä¹ˆæºä»£ç ä»¥åŠæ–°ç­¾å‡ºçš„æºä»£ç æ˜¯å¦ä¸Žå¼€å‘äººå‘˜å·¥ä½œç›®å½•ä¸­å·²å­˜åœ¨çš„æºä»£ç å…¼å®¹ã€‚åœ¨è®¸å¤šç”Ÿäº§çŽ¯å¢ƒä¸­ï¼Œå¼€å‘äººå‘˜åœ¨ä¸€å¤©å†…å¼€å‘åŒä¸€åº”ç”¨ç¨‹åºçš„ä¸‰ä¸ªæˆ–æ›´å¤šä¸åŒç‰ˆæœ¬ã€‚å¦‚æžœæ²¡æœ‰è½¯ä»¶æ‚„æ‚„åœ°ä¸ºæ‚¨æ›´æ–°æºä»£ç æ ‘ï¼ŒæŽ§åˆ¶è¿™ç§å¤æ‚æ€§å°±å·²ç»å¤Ÿå›°éš¾çš„äº†ã€‚</p><p>It is now well recognized that the life cycle of software
          becomes complex. Applications rarely move smoothly from one release
          to the next. More typically, one or more distinct releases of an
          application are being used in the field (and require bug fix
          support), while one or more versions are in active development. CVS
          provides powerful features to help manage these parallel versions of
          the software. But it also means that a developer must be very aware
          of the specific version of the code she is working on. Having the
          <em class="filename">makefile</em> automatically check
          out source during a compilation begs the question of what source is
          being checked out and whether the newly checked out source is
          compatible with the source already existing in the developer's
          working directories. In many production environments, developers are
          working on three or more distinct versions of the same application
          in a single day. Keeping this complexity in check is hard enough
          without having software quietly updating your source tree for
          you.</p><p>æ­¤å¤–ï¼ŒCVS æ›´å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯å®ƒå…è®¸è®¿é—®è¿œç¨‹å­˜å‚¨åº“ã€‚åœ¨å¤§å¤šæ•°ç”Ÿäº§çŽ¯å¢ƒä¸­ï¼ŒCVS å­˜å‚¨åº“ï¼ˆå—æŽ§æ–‡ä»¶çš„æ•°æ®åº“ï¼‰å¹¶ä¸ä½äºŽå¼€å‘äººå‘˜è‡ªå·±çš„è®¡ç®—æœºä¸Šï¼Œè€Œæ˜¯ä½äºŽæœåŠ¡å™¨ä¸Šã€‚å°½ç®¡çŽ°åœ¨ç½‘ç»œè®¿é—®é€Ÿåº¦ç›¸å½“å¿«ï¼ˆç‰¹åˆ«æ˜¯åœ¨å±€åŸŸç½‘ä¸Šï¼‰ï¼Œä½†é€šè¿‡æŽ¢æµ‹ç½‘ç»œæœåŠ¡å™¨æ¥æœç´¢æºæ–‡ä»¶å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½<em class="command">ä¸»æ„</em>ã€‚æ€§èƒ½å½±å“å°†æ˜¯ç¾éš¾æ€§çš„ã€‚</p><p>Also, one of the more powerful features of CVS is that it
          allows access to remote repositories. In most production
          environments, the CVS repository (the database of controlled files)
          is not located on the developer's own machine, but on a server.
          Although network access is now quite fast (particularly on a local
          area network) it is not a good idea to have <em class="command">make</em> probing the network server in search
          of source files. The performance impact would be disastrous.</p><p>å› æ­¤ï¼Œå°½ç®¡å¯ä»¥ä½¿ç”¨å†…ç½®çš„éšå¼è§„åˆ™æˆ–å¤šæˆ–å°‘å¹²å‡€åœ°ä¸Ž RCS å’Œ SCCS æŽ¥å£ï¼Œä½†æ²¡æœ‰è§„åˆ™å¯ä»¥è®¿é—® CVS æ¥æ”¶é›†æºæ–‡ä»¶æˆ–<em class="filename">makefile</em>ã€‚æˆ‘ä¹Ÿä¸è®¤ä¸ºè¿™æ ·åšæœ‰å¤šå¤§æ„ä¹‰ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨<em class="filename">makefile</em>ä¸­ä½¿ç”¨ CVS æ˜¯ç›¸å½“åˆç†çš„ã€‚ä¾‹å¦‚ï¼Œç¡®ä¿æ­£ç¡®ç­¾å…¥å½“å‰æºã€æ­£ç¡®ç®¡ç†ç‰ˆæœ¬å·ä¿¡æ¯æˆ–æµ‹è¯•ç»“æžœæ­£ç¡®ã€‚è¿™äº›æ˜¯<em class="filename">makefile</em>ä½œè€…å¯¹ CVS çš„ä½¿ç”¨ï¼Œè€Œä¸æ˜¯ CVS ä¸Ž<em class="command">make</em>é›†æˆçš„é—®é¢˜ã€‚</p><p>So, although it is possible to use the built-in implicit rules
          to interface more or less cleanly with RCS and SCCS, there are no
          rules to access CVS for gathering source files or <em class="filename">makefile</em>. Nor do I think it makes much
          sense to do so. On the other hand, it is quite reasonable to use CVS
          in <em class="filename">makefile</em>s. For instance, to
          ensure that the current source is properly checked in, that the
          release number information is managed properly, or that test results
          are correct. These are uses of CVS by <em class="filename">makefile</em> authors rather than issues of
          CVS integration with <em class="command">make</em>.</p></div><div class="sect2" title="ä¸€ä¸ªç®€å•çš„å¸®åŠ©å‘½ä»¤"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch02s05.html.make3-CHP-2-SECT-5.4"></a>ä¸€ä¸ªç®€å•çš„å¸®åŠ©å‘½ä»¤</h2><h2 class="title"><a></a>A Simple Help Command</h2></div></div></div><p>å¤§åž‹<em class="filename">makefile</em>å¯ä»¥æœ‰å¾ˆå¤š<a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-987" class="indexterm"></a> <a id="OEBPS/ch02s05.html.make3-CHP-2-ITERM-988" class="indexterm"></a>ç”¨æˆ·éš¾ä»¥è®°ä½çš„ç›®æ ‡ã€‚å‡å°‘æ­¤é—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿é»˜è®¤ç›®æ ‡æˆä¸ºç®€çŸ­çš„å¸®åŠ©å‘½ä»¤ã€‚ç„¶è€Œï¼Œæ‰‹åŠ¨ç»´æŠ¤å¸®åŠ©æ–‡æœ¬å§‹ç»ˆæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæ‚¨å¯ä»¥ç›´æŽ¥ä»Ž<em class="command">make</em>çš„è§„åˆ™æ•°æ®åº“æ”¶é›†å¯ç”¨å‘½ä»¤ã€‚ä»¥ä¸‹ç›®æ ‡å°†æ˜¾ç¤ºå¯ç”¨<em class="command">make</em>ç›®æ ‡çš„æŽ’åºå››åˆ—åˆ—è¡¨
          ï¼š</p><p>Large <em class="filename">makefile</em>s can have
          many <a class="indexterm"></a> <a class="indexterm"></a>targets that are difficult for users to remember. One
          way to reduce this problem is to make the default target a brief
          help command. However, maintaining the help text by hand is always a
          problem. To avoid this, you can gather the available commands
          directly from <em class="command">make</em>'s rules
          database. The following target will present a sorted four column
          listing of the available <em class="command">make</em>
          targets:</p><a id="OEBPS/ch02s05.html.I_2_tt76"></a><pre class="programlisting"># help - é»˜è®¤ç›®æ ‡
.PHONYï¼šå¸®åŠ©
å¸®åŠ©ï¼š
        @$(MAKE) --print-data-base --question no-such-target | @$(MAKE) --print-data-base --question no-such-target |
        $(GREP) -v -e '^no-such-target' -e '^makefile' | $(GREP) -v -e '^no-such-target' -e '^makefile' |
        $(AWK) '/^[^.%][-A-Za-z0-9_]*:/
               { æ‰“å° substr($$1, 1, é•¿åº¦($$1)-1) }' |
        $ï¼ˆæŽ’åºï¼‰|
        $(PR) --çœç•¥åˆ†é¡µ --width=80 --columns=4</pre><pre class="programlisting"># help - The default goal
.PHONY: help
help:
        @$(MAKE) --print-data-base --question no-such-target |
        $(GREP) -v -e '^no-such-target' -e '^makefile' |
        $(AWK) '/^[^.%][-A-Za-z0-9_]*:/
               { print substr($$1, 1, length($$1)-1) }' |
        $(SORT) |
        $(PR) --omit-pagination --width=80 --columns=4</pre><p>å‘½ä»¤è„šæœ¬ç”±å•ä¸ªç®¡é“ç»„æˆã€‚ä½¿ç”¨è¯¥å‘½ä»¤è½¬å‚¨
          make
          <em class="command">è§„åˆ™</em><code class="option">--print-data-base</code>æ•°æ®åº“ã€‚æŒ‡å®š no-such-target çš„ç›®æ ‡ï¼ˆè€Œä¸æ˜¯é»˜è®¤ç›®æ ‡ï¼‰å¯ç¡®ä¿é€’å½’è¿è¡Œ makefile ä¸ä¼šè§¦å‘æ— é™é€’å½’ã€‚è¯¥
          <code class="literal">grep</code>å‘½ä»¤è¿‡æ»¤æŽ‰ä¼ªé€ çš„ç›®æ ‡å’Œ makefile æœ¬èº«ï¼ˆé€šå¸¸åœ¨æ•°æ®åº“è½¬å‚¨ä¸­æ˜¾ç¤ºï¼‰ã€‚ä½¿ç”¨è¯¥<code class="option">â€”question</code>é€‰é¡¹å¯é˜²æ­¢<em class="command">make</em>è¿è¡Œä»»ä½•å®žé™…å‘½ä»¤ã€‚ç„¶åŽæ•°æ®åº“é€šè¿‡ä¸€ä¸ªç®€å•çš„<em class="command">awk</em>è¿‡æ»¤å™¨ï¼Œè¯¥è¿‡æ»¤å™¨æŠ“å–è¡¨ç¤ºä¸ä»¥ç™¾åˆ†æ¯”æˆ–å¥ç‚¹ï¼ˆåˆ†åˆ«ä¸ºæ¨¡å¼è§„åˆ™å’ŒåŽç¼€è§„åˆ™ï¼‰å¼€å¤´çš„ç›®æ ‡çš„æ¯ä¸€è¡Œï¼Œå¹¶ä¸¢å¼ƒè¯¥è¡Œä¸Šçš„é¢å¤–ä¿¡æ¯ã€‚æœ€åŽï¼Œç›®æ ‡åˆ—è¡¨è¢«æŽ’åºå¹¶æ‰“å°åœ¨ä¸€ä¸ªç®€å•çš„å››åˆ—åˆ—è¡¨ä¸­ã€‚</p><p>The command script consists of a single pipeline. The
          <em class="command">make</em> rule database is dumped using the
          <code class="option">--print-data-base</code> command. Specifying a target of
          no-such-target (instead of the default target) ensures that running
          the makefile recursively does not trigger infinite recursion. The
          <code class="literal">grep</code> command filters out the bogus target and the
          makefile itself (which appears as a rule in the database dump).
          Using the <code class="option">â€”question</code> option prevents <em class="command">make</em> from running any actual commands. The
          database is then passed through a simple <em class="command">awk</em> filter that grabs every line
          representing a target that does not begin with percent or period
          (pattern rules and suffix rules, respectively) and discards extra
          information on the line. Finally, the target list is sorted and
          printed in a simple four-column listing.</p><p>åŒä¸€å‘½ä»¤çš„å¦ä¸€ç§æ–¹æ³•ï¼ˆæˆ‘çš„ç¬¬ä¸€æ¬¡å°è¯•ï¼‰æ˜¯åœ¨<em class="filename">makefileæœ¬èº«ä¸Šä½¿ç”¨</em><em class="command">awk</em>å‘½ä»¤ã€‚è¿™éœ€è¦å¯¹åŒ…å«çš„<em class="filename">makefile</em>è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼ˆåœ¨<a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®">ç¬¬ 3 ç« </a>çš„<a class="link" href="#OEBPS/ch03s07.html.make3-CHP-3-SECT-7.1" title="åŒ…å«æŒ‡ä»¤">3.7.1 èŠ‚</a>ä¸­ä»‹ç»ï¼‰ï¼Œå¹¶ä¸”æ ¹æœ¬æ— æ³•å¤„ç†ç”Ÿæˆçš„è§„åˆ™ã€‚è¿™é‡Œæä¾›çš„ç‰ˆæœ¬é€šè¿‡å…è®¸<em class="command">make</em>å¤„ç†è¿™äº›å…ƒç´ å¹¶æŠ¥å‘Šç»“æžœè§„åˆ™é›†æ¥è‡ªåŠ¨å¤„ç†æ‰€æœ‰è¿™äº›ã€‚<em class="filename"></em><em class="filename"></em><a class="link" href="#OEBPS/ch03s07.html.make3-CHP-3-SECT-7.1" title="åŒ…å«æŒ‡ä»¤"></a><a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®"></a><em class="command"></em></p><p>Another approach to the same command (my first attempt), used
          the <em class="command">awk</em> command on the <em class="filename">makefile</em> itself. This required special
          handling for included <em class="filename">makefile</em>s
          (covered in <a class="link" href="#OEBPS/ch03s07.html.make3-CHP-3-SECT-7.1" title="The include Directive">Section
          3.7.1</a> in <a class="link" href="#OEBPS/ch03.html" title="Chapter&nbsp;3.&nbsp;Variables and Macros">Chapter 3</a>) and
          could not handle generated rules at all. The version presented here
          handles all that automatically by allowing <em class="command">make</em> to process these elements and report
          the resulting rule set.</p></div><div class="footnotes"><br><br><hr><div class="footnote"><p><sup>[ <a id="OEBPS/ch02s05.html.ftn.make3-CHP-2-FNOTE-2" href="#OEBPS/ch02s05.html.make3-CHP-2-FNOTE-2" class="para">2</a> ]</sup>åè¿‡æ¥ï¼ŒCVS æ­£åœ¨è¢«æ›´æ–°çš„å·¥å…·æ‰€å–ä»£ã€‚è™½ç„¶ Subversion ( <a class="ulink" href="http://subversion.tigris.org/">http://subversion.tigris.org</a> )æ˜¯ç›®å‰æœ€æ™®éçš„æºä»£ç æŽ§åˆ¶ç³»ç»Ÿï¼Œä½†å®ƒçœ‹èµ·æ¥å°†æˆä¸ºæ–°æµªæ½®ã€‚</p><p><sup>[<a href="#OEBPS/ch02s05.html.make3-CHP-2-FNOTE-2" class="para">2</a>] </sup>CVS is, in turn, becoming supplanted by newer tools. While
              it is currently the most ubiquitous source control system,
              subversion (<a class="ulink" href="http://subversion.tigris.org">http://subversion.tigris.org</a>)
              looks to be the new wave.</p></div></div></div></div></div>
<div id="OEBPS/ch02s06.html"><div>
<div class="sect1" title="ç‰¹æ®Šç›®æ ‡"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch02s06.html.make3-CHP-2-SECT-6"></a>ç‰¹æ®Šç›®æ ‡</h1><h1 class="title"><a></a>Special Targets</h1></div></div></div><p>ç‰¹æ®Š<em class="firstterm">ç›®æ ‡</em>æ˜¯å†…ç½®çš„å‡ç›®æ ‡<a id="OEBPS/ch02s06.html.make3-CHP-2-ITERM-989" class="indexterm"></a> <a id="OEBPS/ch02s06.html.make3-CHP-2-ITERM-990" class="indexterm"></a> <a id="OEBPS/ch02s06.html.make3-CHP-2-ITERM-991" class="indexterm"></a> <a id="OEBPS/ch02s06.html.make3-CHP-2-ITERM-992" class="indexterm"></a>target ç”¨äºŽæ›´æ”¹<em class="command">make</em>çš„é»˜è®¤è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œ
        <code class="literal">.PHONY</code>æˆ‘ä»¬å·²ç»çœ‹åˆ°çš„ä¸€ä¸ªç‰¹æ®Šç›®æ ‡ï¼Œå£°æ˜Žå…¶å…ˆå†³æ¡ä»¶å¹¶ä¸å¼•ç”¨å®žé™…æ–‡ä»¶ï¼Œå¹¶ä¸”åº”å§‹ç»ˆè¢«è§†ä¸ºå·²è¿‡æ—¶ã€‚è¯¥
        <code class="literal">.PHONY</code>ç›®æ ‡æ˜¯æ‚¨å°†çœ‹åˆ°çš„æœ€å¸¸è§çš„ç‰¹æ®Šç›®æ ‡ï¼Œä½†ä¹Ÿæœ‰å…¶ä»–ç›®æ ‡ã€‚</p><p>A <em class="firstterm">special target</em> is a built-in
        phony<a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> target used to change <em class="command">make</em>'s default behavior. For instance,
        <code class="literal">.PHONY</code>, a special target, which
        we've already seen, declares that its prerequisite does not refer to
        an actual file and should always be considered out of date. The
        <code class="literal">.PHONY</code> target is the most common
        special target you will see, but there are others as well.</p><p>è¿™äº›ç‰¹æ®Šç›®æ ‡éµå¾ªæ™®é€šç›®æ ‡çš„è¯­æ³•ï¼Œå³<em class="replaceable"><code>target</code></em>:
         <em class="replaceable"><code>prerequisite</code></em>ï¼Œä½†
        <em class="replaceable"><code>target</code></em>ä¸æ˜¯æ–‡ä»¶ï¼Œç”šè‡³ä¸æ˜¯æ™®é€šçš„è™šå‡ç›®æ ‡ã€‚å®ƒä»¬å®žé™…ä¸Šæ›´åƒæ˜¯ä¿®æ”¹<em class="command">make</em>å†…éƒ¨ç®—æ³•çš„æŒ‡ä»¤ã€‚</p><p>These special targets follow the syntax of normal targets, that
        is <em class="replaceable"><code>target</code></em>:
        <em class="replaceable"><code>prerequisite</code></em>, but the
        <em class="replaceable"><code>target</code></em> is not a file or even a normal
        phony. They are really more like directives for modifying <em class="command">make</em>'s internal algorithms.</p><p>æœ‰åäºŒä¸ªç‰¹æ®Šç›®æ ‡ã€‚å®ƒä»¬åˆ†ä¸ºä¸‰ç±»ï¼šæ­£å¦‚æˆ‘ä»¬åˆšæ‰æ‰€è¯´ï¼Œè®¸å¤šç”¨äºŽ
        åœ¨æ›´æ–°ç›®æ ‡æ—¶æ›´æ”¹<em class="command">makeçš„è¡Œä¸ºï¼Œå¦ä¸€ç»„ä»…å……å½“å…¨å±€æ ‡å¿—æ¥</em><em class="command">ç”Ÿæˆ</em>å’Œå¿½ç•¥å…¶ç›®æ ‡ï¼Œæœ€åŽ
        <code class="literal">.SUFFIXES</code>åœ¨æŒ‡å®šæ—§ç›®æ ‡æ—¶ä½¿ç”¨ç‰¹æ®Šç›®æ ‡ -åˆ¶å®šçš„åŽç¼€è§„åˆ™ï¼ˆåœ¨æœ¬ç« å‰é¢çš„<a class="link" href="#OEBPS/ch02s04.html.make3-CHP-2-SECT-4.3" title="åŽç¼€è§„åˆ™">2.4.3 èŠ‚ä¸­è®¨è®ºï¼‰ã€‚</a></p><p>There are twelve special targets. They fall into three
        categories: as we've just said many are used to alter the behavior of
        <em class="command">make</em> when updating a target,
        another set act simply as global flags to <em class="command">make</em> and ignore their targets, finally the
        <code class="literal">.SUFFIXES</code> special target is used
        when specifying old-fashioned suffix rules (discussed in the <a class="link" href="#OEBPS/ch02s04.html.make3-CHP-2-SECT-4.3" title="Suffix Rules">Section 2.4.3</a> earlier in this
        chapter).</p><p>æœ€æœ‰ç”¨çš„ç›®æ ‡<a id="OEBPS/ch02s06.html.make3-CHP-2-ITERM-993" class="indexterm"></a>ä¿®é¥°ç¬¦ï¼ˆé™¤äº†<code class="literal">.PHONY</code>ï¼‰æœ‰ï¼š</p><p>The most useful target<a class="indexterm"></a> modifiers (aside from <code class="literal">.PHONY</code>) are:</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">.INTERMEDIATE</code></span></dt><dt><span class="term"><code class="literal">.INTERMEDIATE</code></span></dt><dd><p>è¿™æ ·åšçš„å…ˆå†³æ¡ä»¶<a id="OEBPS/ch02s06.html.make3-CHP-2-ITERM-995" class="indexterm"></a> <a id="OEBPS/ch02s06.html.make3-CHP-2-ITERM-996" class="indexterm"></a>ç‰¹æ®Šç›®æ ‡<a id="OEBPS/ch02s06.html.make3-CHP-2-ITERM-997" class="indexterm"></a>è¢«è§†ä¸ºä¸­é—´æ–‡ä»¶ã€‚å¦‚æžœ<em class="command">makeåœ¨æ›´æ–°å¦ä¸€ä¸ªç›®æ ‡æ—¶åˆ›å»ºè¯¥æ–‡ä»¶ï¼Œåˆ™å½“</em><em class="command">make</em>é€€å‡ºæ—¶è¯¥æ–‡ä»¶å°†è¢«è‡ªåŠ¨åˆ é™¤
              ã€‚å¦‚æžœ<em class="command">make</em>
              è€ƒè™‘æ›´æ–°æ–‡ä»¶æ—¶è¯¥æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸ä¼šåˆ é™¤è¯¥æ–‡ä»¶ã€‚</p></dd><dd><p>Prerequisites of this <a class="indexterm"></a> <a class="indexterm"></a>special target <a class="indexterm"></a>are treated as intermediate files. If <em class="command">make</em> creates the file while updating
              another target, the file will be deleted automatically when
              <em class="command">make</em> exits. If the file
              already exists when <em class="command">make</em>
              considers updating the file, the file will not be
              deleted.</p></dd><dt><span class="term">&nbsp;</span></dt><dt><span class="term">&nbsp;</span></dt><dd><p>è¿™åœ¨æž„å»ºè‡ªå®šä¹‰è§„åˆ™é“¾æ—¶éžå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå¤§å¤šæ•° Java å·¥å…·éƒ½æŽ¥å—ç±»ä¼¼ Windows çš„æ–‡ä»¶åˆ—è¡¨ã€‚åˆ›å»ºè§„åˆ™æ¥æž„å»ºæ–‡ä»¶åˆ—è¡¨å¹¶å°†å…¶è¾“å‡ºæ–‡ä»¶æ ‡è®°ä¸ºä¸­é—´æ–‡ä»¶å…è®¸<em class="command">make</em>æ¸…ç†è®¸å¤šä¸´æ—¶æ–‡ä»¶ã€‚</p></dd><dd><p>This can be very useful when building custom rule chains.
              For instance, most Java tools accept Windows-like file lists.
              Creating rules to build the file lists and marking their output
              files as intermediate allows <em class="command">make</em> to clean up many temporary
              files.</p></dd><dt><span class="term"><code class="literal">.SECONDARY</code></span></dt><dt><span class="term"><code class="literal">.SECONDARY</code></span></dt><dd><p>è¿™æ ·åšçš„å…ˆå†³æ¡ä»¶<a id="OEBPS/ch02s06.html.make3-CHP-2-ITERM-999" class="indexterm"></a> <a id="OEBPS/ch02s06.html.make3-CHP-2-ITERM-1000" class="indexterm"></a> <a id="OEBPS/ch02s06.html.make3-CHP-2-ITERM-1001" class="indexterm"></a>ç‰¹æ®Šç›®æ ‡è¢«è§†ä¸ºä¸­é—´æ–‡ä»¶ï¼Œä½†æ°¸è¿œä¸ä¼šè‡ªåŠ¨åˆ é™¤ã€‚æœ€å¸¸è§çš„ç”¨é€”
              <code class="literal">.SECONDARY</code>æ˜¯æ ‡è®°å­˜å‚¨åœ¨<a id="OEBPS/ch02s06.html.make3-CHP-2-ITERM-1002" class="indexterm"></a>å›¾ä¹¦é¦†ã€‚é€šå¸¸ï¼Œè¿™äº›ç›®æ ‡æ–‡ä»¶ä¸€æ—¦æ·»åŠ åˆ°å­˜æ¡£ä¸­å°±ä¼šè¢«åˆ é™¤ã€‚æœ‰æ—¶ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¿ç•™è¿™äº›ç›®æ ‡æ–‡ä»¶ä¼šæ›´æ–¹ä¾¿ï¼Œä½†ä»ä½¿ç”¨<em class="command">make</em>
              æ”¯æŒæ¥æ›´æ–°å­˜æ¡£ã€‚</p></dd><dd><p>Prerequisites of this <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>special target are treated as intermediate files
              but are never automatically deleted. The most common use of
              <code class="literal">.SECONDARY</code> is to mark object
              files stored in <a class="indexterm"></a>libraries. Normally these object files will be
              deleted as soon as they are added to an archive. Sometimes it is
              more convenient during development to keep these object files,
              but still use the <em class="command">make</em>
              support for updating archives.</p></dd><dt><span class="term"><code class="literal">.PRECIOUS</code></span></dt><dt><span class="term"><code class="literal">.PRECIOUS</code></span></dt><dd><p>å½“<em class="command">make</em>ä¸­æ–­æ—¶<a id="OEBPS/ch02s06.html.make3-CHP-2-ITERM-1004" class="indexterm"></a> <a id="OEBPS/ch02s06.html.make3-CHP-2-ITERM-1005" class="indexterm"></a><em class="command">åœ¨æ‰§è¡ŒæœŸé—´ï¼Œå¦‚æžœè‡ªmake</em>å¯åŠ¨ä»¥æ¥æ–‡ä»¶è¢«ä¿®æ”¹ï¼Œå®ƒå¯èƒ½ä¼šåˆ é™¤æ­£åœ¨æ›´æ–°çš„ç›®æ ‡æ–‡ä»¶ã€‚è¿™æ ·<em class="command">make</em>å°±ä¸ä¼šåœ¨æž„å»ºæ ‘ä¸­ç•™ä¸‹éƒ¨åˆ†æž„å»ºçš„ï¼ˆå¯èƒ½å·²æŸåçš„ï¼‰æ–‡ä»¶ã€‚æœ‰æ—¶æ‚¨ä¸å¸Œæœ›å‡ºçŽ°è¿™ç§è¡Œä¸ºï¼Œç‰¹åˆ«æ˜¯å½“æ–‡ä»¶å¾ˆå¤§å¹¶ä¸”åˆ›å»ºçš„è®¡ç®—æˆæœ¬å¾ˆé«˜æ—¶ã€‚å¦‚æžœæ‚¨å°†æ–‡ä»¶æ ‡è®°ä¸ºçè´µï¼Œåˆ™å³ä½¿ä¸­æ–­ï¼Œ <em class="command">make</em>ä¹Ÿæ°¸è¿œä¸ä¼šåˆ é™¤è¯¥æ–‡ä»¶ã€‚</p></dd><dd><p>When <em class="command">make</em> is
              interrupted <a class="indexterm"></a> <a class="indexterm"></a>during execution, it may delete the target file it
              is updating if the file was modified since <em class="command">make</em> started. This is so <em class="command">make</em> doesn't leave a partially
              constructed (possibly corrupt) file laying around in the build
              tree. There are times when you don't want this behavior,
              particularly if the file is large and computationally expensive
              to create. If you mark the file as precious, <em class="command">make</em> will never delete the file if
              interrupted.</p></dd><dt><span class="term">&nbsp;</span></dt><dt><span class="term">&nbsp;</span></dt><dd><p>ä½¿ç”¨çš„<code class="literal">.PRECIOUS</code>æƒ…å†µç›¸å¯¹è¾ƒå°‘ï¼Œä½†å½“éœ€è¦æ—¶å®ƒé€šå¸¸å¯ä»¥æˆä¸ºæ•‘æ˜Ÿã€‚è¯·æ³¨æ„ï¼Œå¦‚æžœè§„åˆ™çš„å‘½ä»¤ç”Ÿæˆé”™è¯¯ï¼Œ<em class="command">make</em>å°†ä¸ä¼šæ‰§è¡Œè‡ªåŠ¨åˆ é™¤ã€‚ä»…å½“è¢«ä¿¡å·ä¸­æ–­æ—¶å®ƒæ‰ä¼šè¿™æ ·åšã€‚</p></dd><dd><p>Use of <code class="literal">.PRECIOUS</code> is
              relatively rare, but when it is needed it is often a life saver.
              Note that <em class="command">make</em> will not
              perform an automatic delete if the commands of a rule generate
              an error. It does so only when interrupted by a signal.</p></dd><dt><span class="term"><code class="literal">.DELETE_ON_ERROR</code></span></dt><dt><span class="term"><code class="literal">.DELETE_ON_ERROR</code></span></dt><dd><p>è¿™æœ‰ç‚¹åƒ<a id="OEBPS/ch02s06.html.make3-CHP-2-ITERM-1007" class="indexterm"></a> <a id="OEBPS/ch02s06.html.make3-CHP-2-ITERM-1008" class="indexterm"></a>çš„åé¢<code class="literal">.PRECIOUS</code>ã€‚å°†ç›®æ ‡æ ‡è®°ä¸º
              <code class="literal">.DELETE_ON_ERROR</code>è¡¨ç¤º
              å¦‚æžœä¸Žè§„åˆ™å…³è”çš„ä»»ä½•å‘½ä»¤ç”Ÿæˆé”™è¯¯ï¼Œåˆ™<em class="command">make</em>
              <span class="emphasis"><em>åº”</em></span><em class="command">åˆ é™¤è¯¥ç›®æ ‡ã€‚ make</em>é€šå¸¸ä»…åœ¨è¢«ä¿¡å·ä¸­æ–­æ—¶æ‰åˆ é™¤ç›®æ ‡ã€‚</p></dd><dd><p>This is sort of the <a class="indexterm"></a> <a class="indexterm"></a>opposite of <code class="literal">.PRECIOUS</code>. Marking a target as
              <code class="literal">.DELETE_ON_ERROR</code> says that
              <em class="command">make</em>
              <span class="emphasis"><em>should</em></span> delete the target if any of the
              commands associated with the rule generates an error. <em class="command">make</em> normally only deletes the target
              if it is interrupted by a signal.</p></dd></dl></div><p>å…¶ä»–ç‰¹æ®Šç›®æ ‡å°†åœ¨å…¶ç”¨é€”æ›´ç›¸å…³æ—¶è¿›è¡Œä»‹ç»ã€‚æˆ‘ä»¬å°†<code class="literal">.EXPORT_ALL_VARIABLES</code>åœ¨<a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®">ç¬¬ 3 ç« ä¸­è®¨è®ºå¹¶åœ¨</a><a class="link" href="#OEBPS/ch10.html" title="ç¬¬ 10 ç« æé«˜ make çš„æ€§èƒ½">ç¬¬ 10 ç« </a>ä¸­è®¨è®ºä¸Žå¹¶è¡Œæ‰§è¡Œç›¸å…³çš„ç›®æ ‡ã€‚</p><p>The other special targets will be covered later when their use
        is more relevant. We'll discuss <code class="literal">.EXPORT_ALL_VARIABLES</code> in <a class="link" href="#OEBPS/ch03.html" title="Chapter&nbsp;3.&nbsp;Variables and Macros">Chapter 3</a> and the targets relating to
        parallel execution in <a class="link" href="#OEBPS/ch10.html" title="Chapter&nbsp;10.&nbsp;Improving the Performance of make">Chapter
        10</a>.</p></div></div></div>
<div id="OEBPS/ch02s07.html"><div>
<div class="sect1" title="è‡ªåŠ¨ä¾èµ–ç”Ÿæˆ"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch02s07.html.make3-CHP-2-SECT-7"></a>è‡ªåŠ¨ä¾èµ–ç”Ÿæˆ</h1><h1 class="title"><a></a>Automatic Dependency Generation</h1></div></div></div><p>å½“æˆ‘ä»¬é‡æž„æˆ‘ä»¬çš„å•è¯æ—¶<a id="OEBPS/ch02s07.html.make3-CHP-2-ITERM-1009" class="indexterm"></a>è®¡ç®—ç¨‹åºä½¿ç”¨å¤´æ–‡ä»¶çš„æ•°é‡æ—¶ï¼Œä¸€ä¸ªæ£˜æ‰‹çš„å°é—®é¢˜æ‚„ç„¶è€Œè‡³ã€‚æˆ‘ä»¬æ‰‹åŠ¨å°†ç›®æ ‡æ–‡ä»¶å’Œ C å¤´æ–‡ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»æ·»åŠ åˆ°<em class="filename">makefile</em>ä¸­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹å¾ˆå®¹æ˜“åšåˆ°ï¼Œä½†åœ¨æ­£å¸¸ç¨‹åºï¼ˆä¸æ˜¯çŽ©å…·ç¤ºä¾‹ï¼‰ä¸­ï¼Œè¿™å¯èƒ½å¾ˆä¹å‘³ä¸”å®¹æ˜“å‡ºé”™ã€‚äº‹å®žä¸Šï¼Œåœ¨å¤§å¤šæ•°ç¨‹åºä¸­è¿™å‡ ä¹Žæ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºå¤§å¤šæ•°å¤´æ–‡ä»¶éƒ½åŒ…å«å…¶ä»–å¤´æ–‡ä»¶ï¼Œå½¢æˆå¤æ‚çš„æ ‘ã€‚ä¾‹å¦‚ï¼Œåœ¨æˆ‘çš„ç³»ç»Ÿä¸Šï¼Œå•ä¸ªå¤´æ–‡ä»¶<em class="filename">stdio.h</em>ï¼ˆC ä¸­æœ€å¸¸å¼•ç”¨çš„å¤´æ–‡ä»¶ï¼‰æ‰©å±•ä¸ºåŒ…å« 15 ä¸ªå…¶ä»–å¤´æ–‡ä»¶ã€‚æ‰‹åŠ¨è§£å†³è¿™äº›å…³ç³»æ˜¯ä¸€é¡¹æ— æœ›çš„ä»»åŠ¡ã€‚ä½†æœªèƒ½é‡æ–°ç¼–è¯‘æ–‡ä»¶å¯èƒ½ä¼šå¯¼è‡´æ•°å°æ—¶çš„è°ƒè¯•éº»çƒ¦ï¼Œæˆ–æ›´ç³Ÿç³•çš„æ˜¯ï¼Œç”Ÿæˆçš„ç¨‹åºä¸­ä¼šå‡ºçŽ°é”™è¯¯ã€‚é‚£ä¹ˆæˆ‘ä»¬è¯¥æ€Žä¹ˆåŠžï¼Ÿ</p><p>When we refactored our word <a class="indexterm"></a>counting program to use header files, a thorny little
        problem snuck up on us. We added the dependency between the object
        files and the C header files to the <em class="filename">makefile</em> by hand. It was easy to do in this
        case, but in normal programs (not toy examples) this can be tedious
        and error-prone. In fact, in most programs it is virtually impossible
        because most header files include other header files forming a complex
        tree. For instance, on my system, the single header file <em class="filename">stdio.h</em> (the most commonly referenced
        header file in C) expands to include 15 other header files. Resolving
        these relationships by hand is a hopeless task. But failing to
        recompile files can lead to hours of debugging headaches or worse,
        bugs in the resulting program. So what do we do?</p><p>å—¯ï¼Œè®¡ç®—æœºéžå¸¸æ“…é•¿æœç´¢å’Œæ¨¡å¼åŒ¹é…ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç¨‹åºæ¥è¯†åˆ«æ–‡ä»¶ä¹‹é—´çš„å…³ç³»ï¼Œç”šè‡³å¯ä»¥è®©è¯¥ç¨‹åºä»¥<em class="filename">makefile</em>è¯­æ³•å†™å‡ºè¿™äº›ä¾èµ–å…³ç³»
        ã€‚æ‚¨å¯èƒ½å·²ç»çŒœåˆ°ï¼Œè¿™æ ·çš„ç¨‹åºå·²ç»å­˜åœ¨â€”â€”è‡³å°‘å¯¹äºŽ C/C++ æ¥è¯´æ˜¯è¿™æ ·ã€‚<em class="command">gcc</em>å’Œè®¸å¤šå…¶ä»– C/C++ ç¼–è¯‘å™¨æœ‰ä¸€ä¸ªé€‰é¡¹å¯ä»¥è¯»å–æºä»£ç å¹¶ç¼–å†™<em class="filename">makefile</em>ä¾èµ–é¡¹ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯æˆ‘æ‰¾åˆ°<em class="filename">stdio.h</em>ä¾èµ–é¡¹çš„æ–¹æ³•ï¼š</p><p>Well, computers are pretty good at searching and pattern
        matching. Let's use a program to identify the relationships between
        files and maybe even have this program write out these dependencies in
        <em class="filename">makefile</em> syntax. As you have
        probably guessed, such a program already existsâ€”at least for C/C++.
        There is a option to <em class="command">gcc</em> and many
        other C/C++ compilers that will read the source and write <em class="filename">makefile</em> dependencies. For instance, here
        is how I found the dependencies for <em class="filename">stdio.h</em>:</p><a id="OEBPS/ch02s07.html.I_2_tt77"></a><pre class="programlisting">$$<strong class="userinput"><code>echo "#include &lt;stdio.h&gt;" &gt; stdio.c</code></strong>
â€‹<strong class="userinput"><code>gcc -M stdio.c</code></strong>
stdio.oï¼šstdio.c /usr/include/stdio.h /usr/include/_ansi.h \
  /usr/include/newlib.h /usr/include/sys/config.h \
  /usr/include/machine/ieeefp.h /usr/include/cygwin/config.h \
  /usr/lib/gcc-lib/i686-pc-cygwin/3.2/include/stddef.h \
  /usr/lib/gcc-lib/i686-pc-cygwin/3.2/include/stdarg.h \
  /usr/include/sys/reent.h /usr/include/sys/_types.h \
  /usr/include/sys/types.h /usr/include/machine/types.h \
  /usr/include/sys/features.h /usr/include/cygwin/types.h \
  /usr/include/sys/sysmacros.h /usr/include/stdint.h \
  /usr/include/sys/stdio.h</pre><pre class="programlisting">$<strong class="userinput"><code>echo "#include &lt;stdio.h&gt;" &gt; stdio.c</code></strong>
$ <strong class="userinput"><code>gcc -M stdio.c</code></strong>
stdio.o: stdio.c /usr/include/stdio.h /usr/include/_ansi.h \
  /usr/include/newlib.h /usr/include/sys/config.h \
  /usr/include/machine/ieeefp.h /usr/include/cygwin/config.h \
  /usr/lib/gcc-lib/i686-pc-cygwin/3.2/include/stddef.h \
  /usr/lib/gcc-lib/i686-pc-cygwin/3.2/include/stdarg.h \
  /usr/include/sys/reent.h /usr/include/sys/_types.h \
  /usr/include/sys/types.h /usr/include/machine/types.h \
  /usr/include/sys/features.h /usr/include/cygwin/types.h \
  /usr/include/sys/sysmacros.h /usr/include/stdint.h \
  /usr/include/sys/stdio.h</pre><p>â€œç¾Žå¥½çš„ã€‚â€æˆ‘å¬åˆ°ä½ å“­äº†ï¼Œâ€œçŽ°åœ¨æˆ‘éœ€è¦è¿è¡Œ<code class="literal">gcc</code>å¹¶ä½¿ç”¨ç¼–è¾‘å™¨å°†ç»“æžœç²˜è´´<code class="literal">-M</code>åˆ°æˆ‘çš„<em class="filename">makefile</em>ä¸­ã€‚å¤šç—›è‹¦å•Šã€‚â€å¦‚æžœè¿™å°±æ˜¯å…¨éƒ¨ç­”æ¡ˆï¼Œé‚£ä½ å°±æ˜¯å¯¹çš„ã€‚æœ‰ä¸¤ç§ä¼ ç»Ÿæ–¹æ³•å¯ä»¥å°†è‡ªåŠ¨ç”Ÿæˆçš„ä¾èµ–é¡¹åŒ…å«åˆ°<em class="filename">makefile</em>ä¸­ã€‚ç¬¬ä¸€ä¸ªä¹Ÿæ˜¯æœ€å¤è€çš„æ–¹æ³•æ˜¯æ·»åŠ ä¸€è¡Œï¼Œä¾‹å¦‚ï¼š</p><p>"Fine." I hear you cry, "Now I need to run <code class="literal">gcc</code> and use an editor to paste the results
        of <code class="literal">-M</code> into my <em class="filename">makefile</em>s. What a pain." And you'd be right
        if this was the whole answer. There are two traditional methods for
        including automatically generated dependencies into <em class="filename">makefile</em>s. The first and oldest is to add a
        line such as:</p><a id="OEBPS/ch02s07.html.I_2_tt78"></a><pre class="programlisting"># è‡ªåŠ¨ç”Ÿæˆä¾èµ–é¡¹ - è¯·å‹¿ç¼–è¾‘</pre><pre class="programlisting"># Automatically generated dependencies follow - Do Not Edit</pre><p><em class="filename">åˆ°makefile</em>çš„æœ«å°¾
        ï¼Œç„¶åŽç¼–å†™ shell è„šæœ¬æ¥æ›´æ–°è¿™äº›ç”Ÿæˆçš„è¡Œã€‚è¿™å½“ç„¶æ¯”æ‰‹åŠ¨æ›´æ–°å®ƒä»¬è¦å¥½ï¼Œä½†ä¹Ÿéžå¸¸éš¾çœ‹ã€‚ç¬¬äºŒç§æ–¹æ³•æ˜¯åœ¨<em class="command">make</em><code class="literal">include</code>ç¨‹åºä¸­æ·»åŠ æŒ‡ä»¤ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¤§å¤šæ•°ç‰ˆæœ¬çš„
        <em class="command">make</em>éƒ½æœ‰è¯¥æŒ‡ä»¤ï¼Œ<acronym class="acronym">GNU </acronym><em class="command">make</em>è‚¯å®šä¹Ÿæœ‰ã€‚<em class="command"></em><em class="command"></em><code class="literal">include</code><acronym class="acronym"></acronym>
        <em class="command"></em></p><p>to the end of the <em class="filename">makefile</em>
        and then write a shell script to update these generated lines. This is
        certainly better than updating them by hand, but it's also very ugly.
        The second method is to add an <code class="literal">include</code> directive to the <em class="command">make</em> program. By now most versions of
        <em class="command">make</em> have the <code class="literal">include</code> directive and <acronym class="acronym">GNU</acronym>
        <em class="command">make</em> most certainly does.</p><p>å› æ­¤ï¼ŒæŠ€å·§æ˜¯ç¼–å†™ä¸€ä¸ª<em class="filename">makefile</em>ç›®æ ‡ï¼Œå…¶æ“ä½œä½¿ç”¨é€‰é¡¹å¯¹æ‰€æœ‰æº
        è¿è¡Œ<em class="command">gcc</em><code class="option">-M</code>ï¼Œå°†ç»“æžœä¿å­˜åœ¨ä¾èµ–æ–‡ä»¶ä¸­ï¼Œç„¶åŽé‡æ–°è¿è¡Œ<em class="command">make</em>ï¼Œå°†ç”Ÿæˆçš„ä¾èµ–æ–‡ä»¶åŒ…å«åœ¨<em class="filename">makefile</em>ä¸­ï¼Œä»¥ä¾¿å®ƒå¯ä»¥è§¦å‘æ›´æ–°æˆ‘ä»¬éœ€è¦ã€‚åœ¨<acronym class="acronym">GNU </acronym> <em class="command">make</em>ä¹‹å‰ï¼Œè¿™æ­£æ˜¯æ‰€åšçš„äº‹æƒ…ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p><p>So, the trick is to write a <em class="filename">makefile</em> target whose action runs <em class="command">gcc</em> over all your source with the
        <code class="option">-M</code> option, saves the results in a dependency file,
        and then re-runs <em class="command">make</em> including the
        generated dependency file in the <em class="filename">makefile</em> so it can trigger the updates we
        need. Before <acronym class="acronym">GNU</acronym> <em class="command">make</em>, this is exactly what was done and the
        rule looked like:</p><a id="OEBPS/ch02s07.html.I_2_tt79"></a><pre class="programlisting">ä¾èµ–ï¼šcount_words.c lexer.c counter.c
        $(CC) -M $(CPPFLAGS) $^ &gt; $@

åŒ…æ‹¬ä¾èµ–</pre><pre class="programlisting">depend: count_words.c lexer.c counter.c
        $(CC) -M $(CPPFLAGS) $^ &gt; $@

include depend</pre><p>åœ¨è¿è¡Œ<em class="command">make</em>æž„å»ºç¨‹åºä¹‹å‰ï¼Œæ‚¨é¦–å…ˆéœ€è¦æ‰§è¡Œ<em class="command">make dependent</em>æ¥ç”Ÿæˆä¾èµ–é¡¹ã€‚å°±ç›®å‰è€Œè¨€ï¼Œè¿™å¾ˆå¥½ï¼Œä½†äººä»¬é€šå¸¸ä¼šåœ¨æºä¸­æ·»åŠ æˆ–åˆ é™¤ä¾èµ–é¡¹ï¼Œè€Œä¸é‡æ–°ç”Ÿæˆ<em class="filename">ä¾èµ–</em>æ–‡ä»¶ã€‚ç„¶åŽæºä»£ç å°±ä¸ä¼šè¢«é‡æ–°ç¼–è¯‘ï¼Œæ•´ä¸ªæ··ä¹±åˆå¼€å§‹äº†ã€‚</p><p>Before running <em class="command">make</em> to build
        the program, you would first execute <em class="command">make
        depend</em> to generate the dependencies. This was good as far as
        it went, but often people would add or remove dependencies from their
        source without regenerating the <em class="filename">depend</em> file. Then source wouldn't get
        recompiled and the whole mess started again.</p><p><acronym class="acronym">GNU </acronym> <em class="command">make</em>
        é€šè¿‡ä¸€ä¸ªå¾ˆé…·çš„åŠŸèƒ½å’Œä¸€ä¸ªç®€å•çš„ç®—æ³•è§£å†³äº†æœ€åŽä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ã€‚é¦–å…ˆï¼Œç®—æ³•ã€‚å¦‚æžœæˆ‘ä»¬å°†æ¯ä¸ªæºæ–‡ä»¶çš„ä¾èµ–é¡¹ç”Ÿæˆåˆ°å…¶è‡ªå·±çš„ä¾èµ–é¡¹æ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚ï¼Œå¸¦æœ‰<em class="filename">.d</em>åŽç¼€ï¼Œå¹¶å°†<em class="filename">.d</em>æ–‡ä»¶æœ¬èº«ä½œä¸ºç›®æ ‡æ·»åŠ åˆ°æ­¤ä¾èµ–é¡¹è§„åˆ™ä¸­ï¼Œé‚£ä¹ˆ<em class="command">make</em>å¯ä»¥çŸ¥é“<em class="filename">.d</em>éœ€è¦æ›´æ–°ï¼ˆä»¥åŠç›®æ ‡æ–‡ä»¶ï¼‰å½“æºæ–‡ä»¶æ›´æ”¹æ—¶ï¼š</p><p><acronym class="acronym">GNU</acronym> <em class="command">make</em>
        solved this last niggling problem with a cool feature and a simple
        algorithm. First, the algorithm. If we generated each source file's
        dependencies into its own dependency file with, say, a <em class="filename">.d</em> suffix and added the <em class="filename">.d</em> file itself as a target to this
        dependency rule, then <em class="command">make</em> could
        know that the <em class="filename">.d</em> needed to be
        updated (along with the object file) when the source file
        changed:</p><a id="OEBPS/ch02s07.html.I_2_tt80"></a><pre class="programlisting">counter.o counter.d: src/counter.c include/counter.h include/lexer.h</pre><pre class="programlisting">counter.o counter.d: src/counter.c include/counter.h include/lexer.h</pre><p>ç”Ÿæˆæ­¤è§„åˆ™å¯ä»¥ä½¿ç”¨æ¨¡å¼è§„åˆ™å’Œï¼ˆç›¸å½“ä¸‘é™‹çš„ï¼‰å‘½ä»¤è„šæœ¬æ¥å®Œæˆï¼ˆè¿™ç›´æŽ¥å–è‡ª
        <acronym class="acronym">GNU </acronym> <em class="command">make</em>
        æ‰‹å†Œï¼‰ï¼š<sup>[ <a id="OEBPS/ch02s07.html.make3-CHP-2-FNOTE-3" href="#OEBPS/ch02s07.html.ftn.make3-CHP-2-FNOTE-3" class="footnote">3</a> ]</sup></p><p>Generating this rule can be accomplished with a pattern rule and
        a (fairly ugly) command script (this is taken directly from the
        <acronym class="acronym">GNU</acronym> <em class="command">make</em>
        manual):<sup>[<a href="#OEBPS/ch02s07.html.ftn.make3-CHP-2-FNOTE-3" class="footnote">3</a>]</sup></p><a id="OEBPS/ch02s07.html.I_2_tt81"></a><pre class="programlisting">%.d: %.c
        $(CC) -M $(CPPFLAGS) $&lt; &gt; $@.$$$$; \
        sed 's,\($*\)\.o[ :]*,\1.o $@ : ,g' &lt; $@.$$$$ &gt; $@; \
        rm -f $@.$$$$</pre><pre class="programlisting">%.d: %.c
        $(CC) -M $(CPPFLAGS) $&lt; &gt; $@.$$$$;                  \
        sed 's,\($*\)\.o[ :]*,\1.o $@ : ,g' &lt; $@.$$$$ &gt; $@; \
        rm -f $@.$$$$</pre><p>çŽ°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªå¾ˆé…·çš„åŠŸèƒ½ã€‚<em class="command">make</em>ä¼šå°†æŒ‡ä»¤ä¸­æŒ‡å®šçš„ä»»ä½•æ–‡ä»¶
        <code class="literal">include</code>è§†ä¸ºè¦æ›´æ–°çš„ç›®æ ‡ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬æåˆ°è¦åŒ…å«çš„<em class="filename">.dæ–‡ä»¶æ—¶ï¼Œ </em><em class="command">makeå°†åœ¨è¯»å–</em><em class="filename">makefile</em>æ—¶è‡ªåŠ¨å°è¯•åˆ›å»ºè¿™äº›æ–‡ä»¶ã€‚è¿™æ˜¯æˆ‘ä»¬çš„<em class="filename">makefile</em>ï¼Œæ·»åŠ äº†è‡ªåŠ¨ä¾èµ–é¡¹ç”Ÿæˆï¼š</p><p>Now, for the cool feature. <em class="command">make</em> will treat any file named in an
        <code class="literal">include</code> directive as a target to be
        updated. So, when we mention the <em class="filename">.d</em> files we want to include, <em class="command">make</em> will automatically try to create these
        files as it reads the <em class="filename">makefile</em>.
        Here is our <em class="filename">makefile</em> with the
        addition of automatic dependency generation:</p><a id="OEBPS/ch02s07.html.I_2_tt82"></a><pre class="programlisting">VPATH = src åŒ…å«
CPPFLAGS = -æˆ‘åŒ…æ‹¬

æ¥æº= count_words.c \
           è¯æ³•åˆ†æžå™¨.c \
           è®¡æ•°å™¨.c

count_words: counter.o lexer.o -lfl
count_words.oï¼šè®¡æ•°å™¨.h
counter.o: counter.h lexer.h
è¯æ³•åˆ†æžå™¨.o: è¯æ³•åˆ†æžå™¨.h

åŒ…æ‹¬ $(subst .c,.d,$(æ¥æº))

%.d: %.c
        $(CC) -M $(CPPFLAGS) $&lt; &gt; $@.$$$$; \
        sed 's,\($*\)\.o[ :]*,\1.o $@ : ,g' &lt; $@.$$$$ &gt; $@; \
        rm -f $@.$$$$</pre><pre class="programlisting">VPATH    = src include
CPPFLAGS = -I include

SOURCES  = count_words.c \
           lexer.c       \
           counter.c

count_words: counter.o lexer.o -lfl
count_words.o: counter.h
counter.o: counter.h lexer.h
lexer.o: lexer.h

include $(subst .c,.d,$(SOURCES))

%.d: %.c
        $(CC) -M $(CPPFLAGS) $&lt; &gt; $@.$$$$;                      \
        sed 's,\($*\)\.o[ :]*,\1.o $@ : ,g' &lt; $@.$$$$ &gt; $@;     \
        rm -f $@.$$$$</pre><p>è¯¥<code class="literal">include</code>æŒ‡ä»¤åº”å§‹ç»ˆæ”¾ç½®åœ¨æ‰‹å†™ä¾èµ–é¡¹ä¹‹åŽï¼Œä»¥ä¾¿é»˜è®¤ç›®æ ‡ä¸ä¼šè¢«æŸäº›ä¾èµ–é¡¹æ–‡ä»¶åŠ«æŒã€‚è¯¥<code class="literal">include</code>æŒ‡ä»¤é‡‡ç”¨æ–‡ä»¶åˆ—è¡¨ï¼ˆå…¶åç§°å¯ä»¥åŒ…å«é€šé…ç¬¦ï¼‰ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<em class="command">make</em>å‡½æ•°<code class="function">subst</code>ï¼Œå°†æºæ–‡ä»¶åˆ—è¡¨è½¬æ¢ä¸ºä¾èµ–æ–‡ä»¶ååˆ—è¡¨ã€‚ ï¼ˆæˆ‘ä»¬å°†åœ¨<a class="link" href="#OEBPS/ch04.html" title="ç¬¬ 4 ç« å‡½æ•°">ç¬¬ 4 ç« </a>çš„<a class="link" href="#OEBPS/ch04s02.html.make3-CHP-4-SECT-2.1" title="å­—ç¬¦ä¸²å‡½æ•°">4.2.1 èŠ‚</a><code class="function">subst</code>ä¸­è¯¦ç»†è®¨è®ºã€‚ï¼‰çŽ°åœ¨ï¼Œåªéœ€æ³¨æ„æ­¤ç”¨æ³•å°†ä¸­æ¯ä¸ªå•è¯ä¸­çš„
        å­—ç¬¦ä¸²<em class="filename">.c</em>æ›¿æ¢ä¸º
        <em class="filename">.d</em>ã€‚<a class="link" href="#OEBPS/ch04s02.html.make3-CHP-4-SECT-2.1" title="å­—ç¬¦ä¸²å‡½æ•°"></a><a class="link" href="#OEBPS/ch04.html" title="ç¬¬ 4 ç« å‡½æ•°"></a><em class="filename"></em><em class="filename"></em><code class="literal">$(SOURCES)</code></p><p>The <code class="literal">include</code> directive should
        always be placed after the hand-written dependencies so that the
        default goal is not hijacked by some dependency file. The <code class="literal">include</code> directive takes a list of files
        (whose names can include wildcards). Here we use a <em class="command">make</em> function, <code class="function">subst</code>, to transform the list of source
        files into a list of dependency filenames. (We'll discuss <code class="function">subst</code> in detail in <a class="link" href="#OEBPS/ch04s02.html.make3-CHP-4-SECT-2.1" title="String Functions">Section 4.2.1</a> in <a class="link" href="#OEBPS/ch04.html" title="Chapter&nbsp;4.&nbsp;Functions">Chapter 4</a>.) For now, just note that this
        use replaces the string <em class="filename">.c</em> with
        <em class="filename">.d</em> in each of the words in
        <code class="literal">$(SOURCES)</code>.</p><p>å½“æˆ‘ä»¬
        ä½¿ç”¨è¯¥é€‰é¡¹è¿è¡Œæ­¤<em class="filename">makefile</em><code class="option">â€”just-print</code>æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š</p><p>When we run this <em class="filename">makefile</em>
        with the <code class="option">â€”just-print</code> option, we get:</p><a id="OEBPS/ch02s07.html.I_2_tt83"></a><pre class="programlisting">$<strong class="userinput"><code>make --just-print</code></strong>
Makefile:13: count_words.d: æ²¡æœ‰è¿™æ ·çš„æ–‡ä»¶æˆ–ç›®å½•
Makefile:13: lexer.d: æ²¡æœ‰è¿™æ ·çš„æ–‡ä»¶æˆ–ç›®å½•
Makefile:13: counter.d: æ²¡æœ‰è¿™æ ·çš„æ–‡ä»¶æˆ–ç›®å½•
gcc -M -I include src/counter.c &gt; counter.d.$$; \
sed 's,\(counter\)\.o[ :]*,\1.o counter.d : ,g' &lt; counter.d.$$ &gt;
è®¡æ•°å™¨.d; \
rm -f counter.d.$$
flex -t src/lexer.l &gt; lexer.c
gcc -M -I åŒ…æ‹¬ lexer.c &gt; lexer.d.$$; \
sed 's,\(lexer\)\.o[ :]*,\1.o lexer.d : ,g' &lt; lexer.d.$$ &gt; lexer.d;   
\
rm -f è¯æ³•åˆ†æžå™¨.d.$$
gcc -M -I include src/count_words.c &gt; count_words.d.$$;         
\
sed 's,\(count_words\)\.o[ :]*,\1.o count_words.d : ,g' &lt; count_words.dã€‚
$$
count_words.dï¼› \
rm -f count_words.d.$$
rm è¯æ³•åˆ†æžå™¨.c
gcc -I include -c -o count_words.o src/count_words.c
gcc -I include -c -o counter.o src/counter.c
gcc -I include -c -o lexer.o lexer.c
gcc count_words.o counter.o lexer.o /lib/libfl.a -o count_words</pre><pre class="programlisting">$<strong class="userinput"><code>make --just-print</code></strong>
Makefile:13: count_words.d: No such file or directory
Makefile:13: lexer.d: No such file or directory
Makefile:13: counter.d: No such file or directory
gcc -M -I include src/counter.c &gt; counter.d.$$;         \
sed 's,\(counter\)\.o[ :]*,\1.o counter.d : ,g' &lt; counter.d.$$ &gt; 
counter.d; \
rm -f counter.d.$$
flex -t src/lexer.l &gt; lexer.c
gcc -M -I include lexer.c &gt; lexer.d.$$;         \
sed 's,\(lexer\)\.o[ :]*,\1.o lexer.d : ,g' &lt; lexer.d.$$ &gt; lexer.d;   
\
rm -f lexer.d.$$
gcc -M -I include src/count_words.c &gt; count_words.d.$$;         
\
sed 's,\(count_words\)\.o[ :]*,\1.o count_words.d : ,g' &lt; count_words.d.
$$ 
count_words.d;   \
rm -f count_words.d.$$
rm lexer.c
gcc -I include -c -o count_words.o src/count_words.c
gcc -I include -c -o counter.o src/counter.c
gcc -I include -c -o lexer.o lexer.c
gcc  count_words.o counter.o lexer.o /lib/libfl.a  -o count_words</pre><p><em class="command">èµ·åˆï¼Œ make</em>çš„å“åº”
        æœ‰ç‚¹ä»¤äººéœ‡æƒŠâ€”â€”å®ƒçœ‹èµ·æ¥åƒä¸€æ¡<em class="command">make</em>é”™è¯¯æ¶ˆæ¯ã€‚ä½†ä¸ç”¨æ‹…å¿ƒï¼Œè¿™åªæ˜¯ä¸€ä¸ªè­¦å‘Šã€‚<em class="command">make</em>æŸ¥æ‰¾åŒ…å«æ–‡ä»¶ä½†æ²¡æœ‰æ‰¾åˆ°å®ƒä»¬ï¼Œå› æ­¤å®ƒä¼š<code class="literal">No such file or directory</code>åœ¨æœç´¢è§„åˆ™æ¥åˆ›å»ºè¿™äº›æ–‡ä»¶ä¹‹å‰å‘å‡ºè­¦å‘Šã€‚å¯ä»¥é€šè¿‡åœ¨<code class="literal">include</code>
        æŒ‡ä»¤å‰æ·»åŠ è¿žå­—ç¬¦ ( )æ¥æŠ‘åˆ¶æ­¤è­¦å‘Š<code class="literal">-</code>ã€‚è­¦å‘ŠåŽé¢çš„è¡Œæ˜¾ç¤º<em class="command">make</em>ä½¿ç”¨é€‰é¡¹è°ƒç”¨<em class="command">gcc</em><code class="option">-M</code>ï¼Œç„¶åŽè¿è¡Œ<em class="command">â€‹â€‹sed</em>å‘½ä»¤ã€‚è¯·æ³¨æ„ï¼Œ<em class="command">make</em>å¿…é¡»è°ƒç”¨
        <em class="command">flex</em>æ¥åˆ›å»º<em class="filename">lexer.c</em> ï¼Œç„¶åŽåœ¨å¼€å§‹æ»¡è¶³é»˜è®¤ç›®æ ‡ä¹‹å‰åˆ é™¤ä¸´æ—¶
        <em class="filename">lexer.c ã€‚</em></p><p>At first the response by <em class="command">make</em>
        is a little alarmingâ€”it looks like a <em class="command">make</em> error message. But not to worry, this
        is just a warning. <em class="command">make</em> looks for
        the include files and doesn't find them, so it issues the <code class="literal">No such file or directory</code> warning before
        searching for a rule to create these files. This warning can be
        suppressed by preceding the <code class="literal">include</code>
        directive with a hyphen (<code class="literal">-</code>). The
        lines following the warnings show <em class="command">make</em> invoking <em class="command">gcc</em> with the <code class="option">-M</code> option,
        then running the <em class="command">sed</em> command.
        Notice that <em class="command">make</em> must invoke
        <em class="command">flex</em> to create <em class="filename">lexer.c</em>, then it deletes the temporary
        <em class="filename">lexer.c</em> before beginning to
        satisfy the default goal.</p><p>è¿™è®©æ‚¨ä½“éªŒä¸€ä¸‹è‡ªåŠ¨ä¾èµ–å…³ç³»ç”Ÿæˆã€‚è¿˜æœ‰å¾ˆå¤šä¸œè¥¿è¦è¯´ï¼Œä¾‹å¦‚å¦‚ä½•ç”Ÿæˆå…¶ä»–è¯­è¨€çš„ä¾èµ–é¡¹æˆ–æž„å»ºæ ‘å¸ƒå±€ã€‚æˆ‘ä»¬å°†åœ¨æœ¬ä¹¦çš„ç¬¬äºŒéƒ¨åˆ†ä¸­æ›´æ·±å…¥åœ°è®¨è®ºè¿™ä¸ªä¸»é¢˜ã€‚</p><p>This gives you a taste of automatic dependency generation.
        There's lots more to say, such as how do you generate dependencies for
        other languages or build tree layouts. We'll return to this topic in
        more depth in Part II of this book.</p><div class="footnotes"><br><br><hr><div class="footnote"><p><sup>[ <a id="OEBPS/ch02s07.html.ftn.make3-CHP-2-FNOTE-3" href="#OEBPS/ch02s07.html.make3-CHP-2-FNOTE-3" class="para">3</a> ]</sup>è¿™æ˜¯ä¸€ä¸ªä»¤äººå°è±¡æ·±åˆ»çš„å°å‘½ä»¤è„šæœ¬ï¼Œä½†æˆ‘è®¤ä¸ºå®ƒéœ€è¦ä¸€äº›è§£é‡Šã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨ C ç¼–è¯‘å™¨æ¥
            <code class="option">-M</code>åˆ›å»ºä¸€ä¸ªåŒ…å«è¯¥ç›®æ ‡ä¾èµ–é¡¹çš„ä¸´æ—¶æ–‡ä»¶ã€‚ä¸´æ—¶æ–‡ä»¶åæ˜¯ä»Žç›®æ ‡ ä¸­åˆ›å»ºçš„ï¼Œ<code class="literal">$@</code>å¹¶æ·»åŠ äº†å”¯ä¸€çš„æ•°å­—åŽç¼€<code class="literal">$$$$</code>.åœ¨ shell ä¸­ï¼Œè¯¥å˜é‡
            <code class="literal">$$</code>è¿”å›žå½“å‰è¿è¡Œçš„ shell çš„è¿›ç¨‹å·ã€‚ç”±äºŽè¿›ç¨‹å·æ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤ä¼šäº§ç”Ÿå”¯ä¸€çš„æ–‡ä»¶åã€‚ç„¶åŽï¼Œæˆ‘ä»¬ä½¿ç”¨<em class="command">sedå°†</em><em class="filename">.d</em>æ–‡ä»¶ä½œä¸ºç›®æ ‡æ·»åŠ åˆ°è§„åˆ™ä¸­ã€‚<em class="command">sed</em>è¡¨è¾¾å¼
            ç”±æœç´¢éƒ¨åˆ†<code class="literal">\($*\)\.o[ :]*</code>å’Œæ›¿æ¢éƒ¨åˆ† :ç»„æˆ<code class="literal">\1.o $@
            </code>ï¼Œä»¥é€—å·åˆ†éš”ã€‚æœç´¢è¡¨è¾¾å¼ä»¥ç›®æ ‡è¯å¹² å¼€å§‹ï¼Œ<code class="literal">$*</code>æ‹¬åœ¨æ­£åˆ™è¡¨è¾¾å¼ (RE) ç»„ ä¸­ï¼Œ<code class="literal">\(\)</code>åŽè·Ÿæ–‡ä»¶åŽç¼€
            <code class="literal">\.o</code>.åœ¨ç›®æ ‡æ–‡ä»¶åä¹‹åŽï¼Œæœ‰é›¶ä¸ªæˆ–å¤šä¸ªç©ºæ ¼æˆ–å†’å·ï¼Œ<code class="literal">[ :]*</code>.æ›¿æ¢éƒ¨åˆ†é€šè¿‡å¼•ç”¨ç¬¬ä¸€ä¸ª RE ç»„å¹¶é™„åŠ åŽç¼€ æ¥æ¢å¤åŽŸå§‹ç›®æ ‡ï¼Œ<code class="literal">\1.o</code>ç„¶åŽæ·»åŠ ä¾èµ–æ–‡ä»¶ç›®æ ‡<code class="literal">$@</code>.</p><p><sup>[<a href="#OEBPS/ch02s07.html.make3-CHP-2-FNOTE-3" class="para">3</a>] </sup>This is an impressive little command script, but I think it
            requires some explanation. First, we use the C compiler with the
            <code class="option">-M</code> option to create a temporary file containing
            the dependencies for this target. The temporary filename is
            created from the target, <code class="literal">$@</code>,
            with a unique numeric suffix added, <code class="literal">$$$$</code>. In the shell, the variable
            <code class="literal">$$</code> returns the process number
            of the currently running shell. Since process numbers are unique,
            this produces a unique filename. We then use <em class="command">sed</em> to add the <em class="filename">.d</em> file as a target to the rule. The
            <em class="command">sed</em> expression consists of a
            search part, <code class="literal">\($*\)\.o[ :]*</code>,
            and a replacement part, <code class="literal">\1.o $@
            </code>:, separated by commas. The search expression begins
            with the target stem, <code class="literal">$*</code>,
            enclosed in a regular expression (RE) group, <code class="literal">\(\)</code>, followed by the file suffix,
            <code class="literal">\.o</code>. After the target filename,
            there come zero or more spaces or colons, <code class="literal">[ :]*</code>. The replacement portion restores
            the original target by referencing the first RE group and
            appending the suffix, <code class="literal">\1.o</code>,
            then adding the dependency file target, <code class="literal">$@</code>.</p></div></div></div></div></div>
<div id="OEBPS/ch02s08.html"><div>
<div class="sect1" title="ç®¡ç†å›¾ä¹¦é¦†"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch02s08.html.make3-CHP-2-SECT-8"></a>ç®¡ç†å›¾ä¹¦é¦†</h1><h1 class="title"><a></a>Managing Libraries</h1></div></div></div><p>æ¡£æ¡ˆ<em class="firstterm">åº“</em>ï¼Œé€šå¸¸<a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1010" class="indexterm"></a> <a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1011" class="indexterm"></a> <a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1012" class="indexterm"></a> <a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1013" class="indexterm"></a>ç®€ç§°ä¸ºåº“æˆ–å­˜æ¡£ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šç±»åž‹çš„æ–‡ä»¶ï¼ŒåŒ…å«ç§°ä¸º<em class="firstterm">membersçš„</em>å…¶ä»–æ–‡ä»¶ã€‚å½’æ¡£ç”¨äºŽå°†ç›¸å…³å¯¹è±¡æ–‡ä»¶åˆ†ç»„ä¸ºæ›´æ˜“äºŽç®¡ç†çš„å•å…ƒã€‚ä¾‹å¦‚ï¼ŒC æ ‡å‡†åº“<em class="filename">libc.a</em>åŒ…å«ä½Žçº§ C å‡½æ•°ã€‚åº“éžå¸¸å¸¸è§ï¼Œå› æ­¤<em class="command">make</em>
        å¯¹åˆ›å»ºã€ç»´æŠ¤å’Œå¼•ç”¨å®ƒä»¬æœ‰ç‰¹æ®Šæ”¯æŒã€‚æ¡£æ¡ˆæ˜¯ä½¿ç”¨<em class="command">ar</em>ç¨‹åºåˆ›å»ºå’Œä¿®æ”¹çš„ã€‚</p><p>An <em class="firstterm">archive</em> library, usually <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>called simply a library or archive, is a special type of
        file containing other files called <em class="firstterm">members</em>.
        Archives are used to group related object files into more manageable
        units. For example, the C standard library <em class="filename">libc.a</em> contains low-level C functions.
        Libraries are very common so <em class="command">make</em>
        has special support for creating, maintaining, and referencing them.
        Archives are created and modified with the <em class="command">ar</em> program.</p><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å¯é‡ç”¨éƒ¨åˆ†é‡æž„ä¸ºå¯é‡ç”¨åº“æ¥ä¿®æ”¹æˆ‘ä»¬çš„å­—æ•°ç»Ÿè®¡ç¨‹åºã€‚æˆ‘ä»¬çš„åº“å°†åŒ…å«ä¸¤ä¸ªæ–‡ä»¶<em class="filename">counter.o</em>å’Œ<em class="filename">lexer.o</em>ã€‚ arå‘½ä»¤<em class="command">â€‹</em><a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1014" class="indexterm"></a> <a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1015" class="indexterm"></a>åˆ›å»ºè¿™ä¸ªåº“æ˜¯ï¼š</p><p>Let's look at an example. We can modify our word counting
        program by refactoring the reusable parts into a reusable library. Our
        library will consist of the two files <em class="filename">counter.o</em> and <em class="filename">lexer.o</em>. The <em class="command">ar</em> command to<a class="indexterm"></a> <a class="indexterm"></a> create this library is:</p><a id="OEBPS/ch02s08.html.I_2_tt84"></a><pre class="programlisting">$<strong class="userinput"><code>ar rv libcounter.a counter.o lexer.o</code></strong>
a - è®¡æ•°å™¨.o
a - è¯æ³•åˆ†æžå™¨.o</pre><pre class="programlisting">$<strong class="userinput"><code>ar rv libcounter.a counter.o lexer.o</code></strong>
a - counter.o
a - lexer.o</pre><p>è¿™äº›é€‰é¡¹<code class="option">rv</code>è¡¨æ˜Žæˆ‘ä»¬æƒ³è¦
        ç”¨åˆ—å‡ºçš„ç›®æ ‡æ–‡ä»¶<span class="emphasis"><em>æ›¿æ¢</em></span>å­˜æ¡£çš„æˆå‘˜ï¼Œå¹¶ä¸”<em class="command">ar</em>åº”è¯¥
        <span class="emphasis"><em>è¯¦ç»†</em></span>åœ°å›žæ˜¾å…¶æ“ä½œã€‚å³ä½¿å­˜æ¡£ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æ›¿æ¢é€‰é¡¹ã€‚é€‰é¡¹åŽé¢çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­˜æ¡£åç§°ï¼ŒåŽè·Ÿç›®æ ‡æ–‡ä»¶åˆ—è¡¨ã€‚ ï¼ˆå¦‚æžœå­˜æ¡£ä¸å­˜åœ¨ä½†<acronym class="acronym">GNU </acronym><em class="command">ar</em>ä¸å­˜åœ¨ï¼Œ
        æŸäº›ç‰ˆæœ¬çš„<em class="command">ar</em>
        è¿˜éœ€è¦â€œcâ€é€‰é¡¹æ¥<span class="emphasis"><em>åˆ›å»º</em></span><em class="command">ã€‚ï¼‰ ar</em>å‘½ä»¤åŽé¢çš„ä¸¤è¡Œæ˜¯å…¶è¯¦ç»†è¾“å‡ºï¼ŒæŒ‡ç¤ºå·²æ·»åŠ ç›®æ ‡æ–‡ä»¶ã€‚<acronym class="acronym"></acronym> <em class="command"></em><em class="command"></em></p><p>The options <code class="option">rv</code> indicate that we want to
        <span class="emphasis"><em>r</em></span>eplace members of the archive with the object
        files listed and that <em class="command">ar</em> should
        <span class="emphasis"><em>v</em></span>erbosely echo its actions. We can use the
        replace option even though the archive doesn't exist. The first
        argument after the options is the archive name followed by a list of
        object files. (Some versions of <em class="command">ar</em>
        also require the "c" option, for <span class="emphasis"><em>c</em></span>reate, if the
        archive does not exist but <acronym class="acronym">GNU</acronym> <em class="command">ar</em> does not.) The two lines following the
        <em class="command">ar</em> command are its verbose output
        indicating the object files were added.</p><p><em class="command">ä½¿ç”¨ar</em>çš„æ›¿æ¢é€‰é¡¹å…è®¸æˆ‘ä»¬å¢žé‡åˆ›å»ºæˆ–æ›´æ–°å­˜æ¡£ï¼š</p><p>Using the replace option to <em class="command">ar</em> allows us to create or update an archive
        incrementally:</p><a id="OEBPS/ch02s08.html.I_2_tt85"></a><pre class="programlisting">$<strong class="userinput"><code>ar rv libcounter.a counter.o</code></strong>
r - è®¡æ•°å™¨.o
$ <strong class="userinput"><code>ar rv libcounter.a lexer.o</code></strong>
r - lexer.o</pre><pre class="programlisting">$<strong class="userinput"><code>ar rv libcounter.a counter.o</code></strong>
r - counter.o
$ <strong class="userinput"><code>ar rv libcounter.a lexer.o</code></strong>
r - lexer.o</pre><p>è¿™é‡Œ<em class="command">ar</em>ç”¨â€œrâ€å›žæ˜¾æ¯ä¸ªæ“ä½œï¼Œè¡¨ç¤ºæ–‡ä»¶å·²åœ¨å­˜æ¡£ä¸­è¢«æ›¿æ¢ã€‚</p><p>Here <em class="command">ar</em> echoed each action
        with "r" to indicate the file was replaced in the archive.</p><p>å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å°†åº“é“¾æŽ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ã€‚æœ€ç›´æŽ¥çš„æ–¹æ³•æ˜¯ç®€å•åœ°åœ¨å‘½ä»¤è¡Œä¸Šåˆ—å‡ºåº“æ–‡ä»¶ã€‚ç¼–è¯‘å™¨æˆ–é“¾æŽ¥å™¨å°†ä½¿ç”¨æ–‡ä»¶åŽç¼€æ¥ç¡®å®šå‘½ä»¤è¡Œä¸Šç‰¹å®šæ–‡ä»¶çš„ç±»åž‹å¹¶æ‰§è¡Œæ­£ç¡®çš„æ“ä½œÂ©ï¼š</p><p>A library can be linked into an executable in several ways. The
        most straightforward way is to simply list the library file on the
        command line. The compiler or linker will use the file suffix to
        determine the type of a particular file on the command line and do the
        Right ThingÂ©:</p><a id="OEBPS/ch02s08.html.I_2_tt86"></a><pre class="programlisting">cc count_words.o libcounter.a /lib/libfl.a -o count_words</pre><pre class="programlisting">cc count_words.o libcounter.a /lib/libfl.a -o count_words</pre><p>è¿™é‡Œ<em class="command">ccä¼šå°†</em><em class="filename">libcounter.a</em>å’Œ
        <em class="filename">/lib/libfl.a</em>è¿™ä¸¤ä¸ªæ–‡ä»¶è¯†åˆ«ä¸ºåº“ï¼Œå¹¶åœ¨å®ƒä»¬ä¸­æœç´¢æœªå®šä¹‰çš„ç¬¦å·ã€‚åœ¨å‘½ä»¤è¡Œä¸Šå¼•ç”¨åº“çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ä»¥ä¸‹<code class="option">-l</code>
        é€‰é¡¹ï¼š</p><p>Here <em class="command">cc</em> will recognize the
        two files <em class="filename">libcounter.a</em> and
        <em class="filename">/lib/libfl.a</em> as libraries and
        search them for undefined symbols. The other way to reference
        libraries on the command line is with the <code class="option">-l</code>
        option:</p><a id="OEBPS/ch02s08.html.I_2_tt87"></a><pre class="programlisting">cc count_words.o -lcounter -lfl -o count_words</pre><pre class="programlisting">cc count_words.o -lcounter -lfl -o count_words</pre><p>å¦‚æ‚¨æ‰€è§ï¼Œä½¿ç”¨æ­¤é€‰é¡¹å¯ä»¥çœç•¥åº“æ–‡ä»¶åçš„å‰ç¼€å’ŒåŽç¼€ã€‚è¯¥<code class="option">-l</code>é€‰é¡¹ä½¿å‘½ä»¤è¡Œæ›´åŠ ç´§å‡‘ä¸”æ›´æ˜“äºŽé˜…è¯»ï¼Œä½†å®ƒå…·æœ‰æ›´æœ‰ç”¨çš„åŠŸèƒ½ã€‚å½“<em class="command">cc</em>çœ‹åˆ°è¯¥
        <code class="option">-l</code>é€‰é¡¹æ—¶ï¼Œå®ƒä¼šåœ¨ç³»ç»Ÿçš„æ ‡å‡†åº“ç›®å½•ä¸­<span class="emphasis"><em>æœç´¢</em></span>è¯¥åº“ã€‚è¿™ä½¿ç¨‹åºå‘˜ä¸å¿…çŸ¥é“åº“çš„ç²¾ç¡®ä½ç½®ï¼Œå¹¶ä½¿å‘½ä»¤è¡Œæ›´åŠ å¯ç§»æ¤ã€‚æ­¤å¤–ï¼Œåœ¨æ”¯æŒå…±äº«åº“ï¼ˆUnix ç³»ç»Ÿä¸Šæ‰©å±•åä¸º<em class="filename">.so</em>çš„åº“ï¼‰çš„ç³»ç»Ÿä¸Šï¼Œé“¾æŽ¥å™¨å°†é¦–å…ˆæœç´¢å…±äº«åº“ï¼Œç„¶åŽå†æœç´¢å­˜æ¡£åº“ã€‚è¿™ä½¿å¾—ç¨‹åºå¯ä»¥ä»Žå…±äº«åº“ä¸­å—ç›Šï¼Œè€Œæ— éœ€ä¸“é—¨è¦æ±‚å®ƒä»¬ã€‚è¿™æ˜¯<acronym class="acronym">GNU</acronym>é“¾æŽ¥å™¨/ç¼–è¯‘å™¨çš„é»˜è®¤è¡Œä¸º
        ã€‚è¾ƒæ—§çš„é“¾æŽ¥å™¨/ç¼–è¯‘å™¨å¯èƒ½æ— æ³•æ‰§è¡Œæ­¤ä¼˜åŒ–ã€‚</p><p>As you can see, with this option you omit the prefix and suffix
        of the library filename. The <code class="option">-l</code> option makes the
        command line more compact and easier to read, but it has a far more
        useful function. When <em class="command">cc</em> sees the
        <code class="option">-l</code> option it <span class="emphasis"><em>searches</em></span> for the
        library in the system's standard library directories. This relieves
        the programmer from having to know the precise location of a library
        and makes the command line more portable. Also, on systems that
        support shared libraries (libraries with the extension <em class="filename">.so</em> on Unix systems), the linker will
        search for a shared library first, before searching for an archive
        library. This allows programs to benefit from shared libraries without
        specifically requiring them. This is the default behavior of
        <acronym class="acronym">GNU</acronym>'s linker/compiler. Older linker/compilers may
        not perform this optimization.</p><p><code class="option">-L</code>å¯ä»¥é€šè¿‡æ·»åŠ æŒ‡ç¤ºè¦æœç´¢çš„ç›®å½•ä»¥åŠæœç´¢é¡ºåºçš„é€‰é¡¹æ¥æ›´æ”¹ç¼–è¯‘å™¨ä½¿ç”¨çš„æœç´¢è·¯å¾„
        ã€‚è¿™äº›ç›®å½•æ·»åŠ åœ¨ç³»ç»Ÿåº“ä¹‹å‰ï¼Œç”¨äºŽ<code class="option">-l</code>å‘½ä»¤è¡Œä¸Šçš„æ‰€æœ‰é€‰é¡¹ã€‚äº‹å®žä¸Šï¼Œæœ€åŽä¸€ä¸ªç¤ºä¾‹æ— æ³•é“¾æŽ¥ï¼Œå› ä¸ºå½“å‰ç›®å½•ä¸åœ¨<em class="command">cc</em>çš„åº“æœç´¢è·¯å¾„ä¸­ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ å½“å‰ç›®å½•æ¥ä¿®å¤æ­¤é”™è¯¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>The search path used by the compiler can be changed by adding
        <code class="option">-L</code> options indicating the directories to search and
        in what order. These directories are added before the system libraries
        and are used for all <code class="option">-l</code> options on the command line.
        In fact, the last example fails to link because the current directory
        is not in <em class="command">cc</em>'s library search path.
        We can fix this error by adding the current directory like
        this:</p><a id="OEBPS/ch02s08.html.I_2_tt88"></a><pre class="programlisting">æŠ„é€ count_words.o -Lã€‚ -lcounter -lfl -o å­—æ•°</pre><pre class="programlisting">cc count_words.o -L. -lcounter -lfl -o count_words</pre><p>åº“ç»™æž„å»ºç¨‹åºçš„è¿‡ç¨‹å¢žåŠ äº†ä¸€äº›å¤æ‚æ€§ã€‚å¦‚ä½•æ‰èƒ½<em class="command">å¸®åŠ©</em>ç®€åŒ–æƒ…å†µï¼Ÿ<acronym class="acronym">GNU </acronym> <em class="command">make</em>åŒ…å«æ”¯æŒåº“çš„åˆ›å»ºåŠå…¶åœ¨é“¾æŽ¥ç¨‹åºä¸­çš„ä½¿ç”¨çš„ç‰¹æ®ŠåŠŸèƒ½ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><p>Libraries add a bit of complication to the process of building a
        program. How can <em class="command">make</em> help to
        simplify the situation? <acronym class="acronym">GNU</acronym> <em class="command">make</em> includes special features to support
        both the creation of libraries and their use in linking programs.
        Let's see how they work.</p><div class="sect2" title="åˆ›å»ºå’Œæ›´æ–°åº“"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch02s08.html.make3-CHP-2-SECT-8.1"></a>åˆ›å»ºå’Œæ›´æ–°åº“</h2><h2 class="title"><a></a>Creating and Updating Libraries</h2></div></div></div><p>åœ¨<em class="filename">makefile</em>ä¸­ï¼Œåº“æ–‡ä»¶æ˜¯<a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1016" class="indexterm"></a> <a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1017" class="indexterm"></a> <a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1018" class="indexterm"></a> <a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1019" class="indexterm"></a> <a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1020" class="indexterm"></a>å°±åƒä»»ä½•å…¶ä»–æ–‡ä»¶ä¸€æ ·ç”¨å…¶åç§°æŒ‡å®šã€‚åˆ›å»ºæˆ‘ä»¬çš„åº“çš„ä¸€ä¸ªç®€å•è§„åˆ™æ˜¯ï¼š</p><p>Within a <em class="filename">makefile</em>, a
          library file is <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>specified with its name just like any other file. A
          simple rule to create our library is:</p><a id="OEBPS/ch02s08.html.I_2_tt89"></a><pre class="programlisting">libcounter.a: counter.o lexer.o
        $(AR) $(ARFLAGS) $@ $^</pre><pre class="programlisting">libcounter.a: counter.o lexer.o
        $(AR) $(ARFLAGS) $@ $^</pre><p><em class="command">è¿™ä½¿ç”¨ar</em>ç¨‹åºçš„å†…ç½®å®šä¹‰å’Œä¸­çš„<code class="literal">AR</code>æ ‡å‡†é€‰é¡¹
          ã€‚å½’æ¡£è¾“å‡ºæ–‡ä»¶è‡ªåŠ¨è®¾ç½®åœ¨ ä¸­ï¼Œå…ˆå†³æ¡ä»¶åœ¨ ä¸­è®¾ç½®
          ã€‚<code class="option">rv</code><code class="literal">ARFLAGS</code><code class="literal">$@</code><code class="literal">$^</code></p><p>This uses the built-in definition for the <em class="command">ar</em> program in <code class="literal">AR</code> and the standard options
          <code class="option">rv</code> in <code class="literal">ARFLAGS</code>.
          The archive output file is automatically set in <code class="literal">$@</code> and the prerequisites are set in
          <code class="literal">$^</code>.</p><p>çŽ°åœ¨ï¼Œå¦‚æžœæ‚¨å°†<em class="filename">libcounter.aä½œä¸º</em><em class="filename">count_words</em> çš„å…ˆå†³æ¡ä»¶ï¼Œ<em class="command">é‚£ä¹ˆ make</em>å°†åœ¨é“¾æŽ¥å¯æ‰§è¡Œæ–‡ä»¶ä¹‹å‰æ›´æ–°æˆ‘ä»¬çš„åº“ã€‚ä¸è¿‡ï¼Œè¯·æ³¨æ„ä¸€ç‚¹å°åˆºæ¿€ã€‚å­˜æ¡£çš„æ‰€æœ‰æˆå‘˜éƒ½ä¼šè¢«æ›¿æ¢ï¼Œå³ä½¿å®ƒä»¬æ²¡æœ‰è¢«ä¿®æ”¹ã€‚è¿™æ˜¯æµªè´¹æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ï¼š</p><p>Now, if you make <em class="filename">libcounter.a</em> a prerequisite of <em class="filename">count_words</em> <em class="command">make</em> will update our library before
          linking the executable. Notice one small irritation, however. All
          members of the archive are replaced even if they have not been
          modified. This is a waste of time and we can do better:</p><a id="OEBPS/ch02s08.html.I_2_tt90"></a><pre class="programlisting">libcounter.a: counter.o lexer.o
        $(AR) $(ARFLAGS) $@ $?</pre><pre class="programlisting">libcounter.a: counter.o lexer.o
        $(AR) $(ARFLAGS) $@ $?</pre><p>å¦‚æžœæ‚¨ä½¿ç”¨<code class="literal">$?</code>è€Œä¸æ˜¯
          <code class="literal">$^</code>ï¼Œ<em class="command">make</em>å°†ä»…å°†é‚£äº›æ¯”ç›®æ ‡æ–‡ä»¶æ›´æ–°çš„å¯¹è±¡æ–‡ä»¶ä¼ é€’ç»™<em class="command">ar</em>ã€‚</p><p>If you use <code class="literal">$?</code> instead of
          <code class="literal">$^</code>, <em class="command">make</em> will pass only those objects files
          that are newer than the target to <em class="command">ar</em>.</p><p>æˆ‘ä»¬è¿˜èƒ½åšå¾—æ›´å¥½å—ï¼Ÿä¹Ÿè®¸ï¼Œä½†ä¹Ÿè®¸ä¸æ˜¯ã€‚<em class="command">make</em>æ”¯æŒæ›´æ–°å­˜æ¡£ä¸­çš„å•ä¸ªæ–‡ä»¶ï¼Œä¸ºæ¯ä¸ªç›®æ ‡æ–‡ä»¶æˆå‘˜æ‰§è¡Œä¸€ä¸ª<em class="command">ar</em>å‘½ä»¤ï¼Œä½†åœ¨æˆ‘ä»¬æ·±å…¥ç ”ç©¶è¿™äº›ç»†èŠ‚ä¹‹å‰ï¼Œå…³äºŽè¿™ç§æž„å»ºåº“çš„é£Žæ ¼æœ‰å‡ ç‚¹å€¼å¾—æ³¨æ„ã€‚<em class="command">make</em>çš„ä¸»è¦ç›®æ ‡ä¹‹ä¸€æ˜¯é€šè¿‡ä»…æ›´æ–°é‚£äº›è¿‡æ—¶çš„æ–‡ä»¶æ¥æœ‰æ•ˆåœ°ä½¿ç”¨å¤„ç†å™¨ã€‚ä¸å¹¸çš„æ˜¯ï¼Œä¸ºæ¯ä¸ªè¿‡æ—¶æˆå‘˜è°ƒç”¨ä¸€æ¬¡<em class="command">ar</em>çš„æ–¹å¼å¾ˆå¿«å°±ä¼šé™·å…¥å›°å¢ƒã€‚å¦‚æžœå­˜æ¡£åŒ…å«è¶…è¿‡å‡ åä¸ªæ–‡ä»¶ï¼Œåˆ™ä¸ºæ¯æ¬¡æ›´æ–°è°ƒç”¨<em class="command">ar</em>çš„è´¹ç”¨
          å¼€å§‹è¶…è¿‡ä½¿ç”¨æˆ‘ä»¬å³å°†ä»‹ç»çš„è¯­æ³•çš„â€œä¼˜é›…â€å› ç´ ã€‚é€šè¿‡ä½¿ç”¨ä¸Šé¢çš„ç®€å•æ–¹æ³•å¹¶åœ¨æ˜¾å¼è§„åˆ™ä¸­è°ƒç”¨<em class="command">ar ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ‰€æœ‰æ–‡ä»¶æ‰§è¡Œä¸€æ¬¡</em><em class="command">ar</em>
          å¹¶èŠ‚çœè®¸å¤š fork/exec è°ƒç”¨ã€‚æ­¤å¤–ï¼Œåœ¨è®¸å¤šç³»ç»Ÿä¸Šä½¿ç”¨<code class="option">r</code>to <em class="command">ar</em>æ•ˆçŽ‡éžå¸¸ä½Žã€‚åœ¨æˆ‘çš„ 1.9 GHz Pentium 4 ä¸Šï¼Œä»Žå¤´å¼€å§‹æž„å»ºä¸€ä¸ªå¤§åž‹å­˜æ¡£ï¼ˆåŒ…å« 14,216 ä¸ªæˆå‘˜ï¼Œæ€»è®¡ 55 MBï¼‰éœ€è¦ 4 åˆ† 24 ç§’ã€‚ä½†æ˜¯ï¼Œåœ¨ç”Ÿæˆçš„å­˜æ¡£ä¸Šä½¿ç”¨<em class="command">a r</em>æ›´æ–°å•ä¸ªç›®æ ‡æ–‡ä»¶éœ€è¦ 28 ç§’ã€‚å› æ­¤ï¼Œå¦‚æžœæˆ‘éœ€è¦æ›¿æ¢è¶…è¿‡ 10 ä¸ªæ–‡ä»¶ï¼ˆæ€»å…± 14,216 ä¸ªæ–‡ä»¶ï¼ï¼‰ï¼Œä»Žå¤´å¼€å§‹æž„å»ºå­˜æ¡£ä¼šæ›´å¿«ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨è‡ªåŠ¨å˜é‡å¯¹æ‰€æœ‰å·²ä¿®æ”¹çš„ç›®æ ‡æ–‡ä»¶æ‰§è¡Œä¸€æ¬¡å­˜æ¡£æ›´æ–°å¯èƒ½æ›´ä¸ºè°¨æ…Ž<code class="literal">$?</code>
          ã€‚å¯¹äºŽè¾ƒå°çš„åº“å’Œæ›´å¿«çš„å¤„ç†å™¨ï¼Œæ²¡æœ‰ä»»ä½•æ€§èƒ½åŽŸå› ä¼šæ›´å–œæ¬¢ä¸Šé¢çš„ç®€å•æ–¹æ³•è€Œä¸æ˜¯ä¸‹é¢æ›´ä¼˜é›…çš„æ–¹æ³•ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä¸‹é¢çš„ç‰¹æ®Šåº“æ”¯æŒæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•ã€‚</p><p>Can we do better still? Maybe, but maybe not. <em class="command">make</em> has support for updating individual
          files within an archive, executing one <em class="command">ar</em> command for each object file member,
          but before we go delving into those details there are several points
          worth noting about this style of building libraries. One of the
          primary goals of <em class="command">make</em> is to use
          the processor efficiently by updating only those files that are out
          of date. Unfortunately, the style of invoking <em class="command">ar</em> once for each out-of-date member
          quickly bogs down. If the archive contains more than a few dozen
          files, the expense of invoking <em class="command">ar</em>
          for each update begins to outweigh the "elegance" factor of using
          the syntax we are about to introduce. By using the simple method
          above and invoking <em class="command">ar</em> in an
          explicit rule, we can execute <em class="command">ar</em>
          once for all files and save ourselves many fork/exec calls. In
          addition, on many systems using the <code class="option">r</code> to <em class="command">ar</em> is very inefficient. On my 1.9 GHz
          Pentium 4, building a large archive from scratch (with 14,216
          members totaling 55 MB) takes 4 minutes 24 seconds. However,
          updating a single object file with <em class="command">ar
          r</em> on the resulting archive takes 28 seconds. So building
          the archive from scratch is faster if I need to replace more than 10
          files (out of 14,216!). In such situations it is probably more
          prudent to perform a single update of the archive with all modified
          object files using the <code class="literal">$?</code>
          automatic variable. For smaller libraries and faster processors
          there is no performance reason to prefer the simple approach above
          to the more elegant one below. In those situations, using the
          special library support that follows is a fine approach.</p><p>åœ¨<acronym class="acronym">GNU </acronym> <em class="command">make</em>ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç¬¦å·å¼•ç”¨å­˜æ¡£çš„æˆå‘˜ï¼š</p><p>In <acronym class="acronym">GNU</acronym> <em class="command">make</em>, a member of an archive can be
          referenced using the notation:</p><a id="OEBPS/ch02s08.html.I_2_tt91"></a><pre class="programlisting">libgraphics.a(bitblt.o): bitblt.o
        $(AR) $(ARFLAGS) $@ $&lt;</pre><pre class="programlisting">libgraphics.a(bitblt.o): bitblt.o
        $(AR) $(ARFLAGS) $@ $&lt;</pre><p>è¿™é‡Œåº“åç§°æ˜¯<em class="filename">libgraphics.a</em>ï¼Œæˆå‘˜åç§°æ˜¯
          <em class="filename">bitblt.o</em>ï¼ˆç”¨äºŽ<span class="emphasis"><em>ä½å—ä¼ è¾“</em></span>ï¼‰ã€‚è¯­æ³•<em class="filename">lib</em>
          <em class="replaceable"><code>name</code></em> .a <code class="literal">(</code>
          <em class="replaceable"><code>module</code></em>.o<code class="literal">)</code>æŒ‡çš„æ˜¯åº“ä¸­åŒ…å«çš„æ¨¡å—ã€‚æ­¤ç›®æ ‡çš„å…ˆå†³æ¡ä»¶åªæ˜¯ç›®æ ‡æ–‡ä»¶æœ¬èº«ï¼Œå¹¶ä¸”è¯¥å‘½ä»¤å°†ç›®æ ‡æ–‡ä»¶æ·»åŠ åˆ°å­˜æ¡£ä¸­ã€‚<code class="literal">$&lt;</code>å‘½ä»¤ä¸­ä½¿ç”¨è‡ªåŠ¨å˜é‡ä»…èŽ·å–ç¬¬ä¸€ä¸ªå…ˆå†³æ¡ä»¶ã€‚äº‹å®žä¸Šï¼Œæœ‰ä¸€ä¸ªå†…ç½®çš„æ¨¡å¼è§„åˆ™å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><p>Here the library name is <em class="filename">libgraphics.a</em> and the member name is
          <em class="filename">bitblt.o</em> (for <span class="emphasis"><em>bit
          block transfer</em></span>). The syntax <em class="filename">lib</em>
          <em class="replaceable"><code>name</code></em>.a<code class="literal">(</code>
          <em class="replaceable"><code>module</code></em>.o<code class="literal">)</code> refers to the module contained within
          the library. The prerequisite for this target is simply the object
          file itself and the command adds the object file to the archive. The
          automatic variable <code class="literal">$&lt;</code> is used
          in the command to get only the first prerequisite. In fact, there is
          a built-in pattern rule that does exactly this.</p><p>å½“æˆ‘ä»¬æŠŠè¿™äº›æ”¾åœ¨ä¸€èµ·æ—¶ï¼Œæˆ‘ä»¬çš„<em class="filename">makefile</em>çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><p>When we put this all together, our <em class="filename">makefile</em> looks like this:</p><a id="OEBPS/ch02s08.html.I_2_tt92"></a><pre class="programlisting">VPATH = src åŒ…å«
CPPFLAGS = -æˆ‘åŒ…æ‹¬

count_wordsï¼šlibcounter.a /lib/libfl.a

libcounter.a: libcounter.a(lexer.o) libcounter.a(counter.o)

libcounter.a(lexer.o): lexer.o
        $(AR) $(ARFLAGS) $@ $&lt;

libcounter.a(counter.o): è®¡æ•°å™¨.o
        $(AR) $(ARFLAGS) $@ $&lt;

count_words.oï¼šè®¡æ•°å™¨.h
counter.o: counter.h lexer.h
è¯æ³•åˆ†æžå™¨.o: è¯æ³•åˆ†æžå™¨.h</pre><pre class="programlisting">VPATH    = src include
CPPFLAGS = -I include

count_words: libcounter.a /lib/libfl.a

libcounter.a: libcounter.a(lexer.o) libcounter.a(counter.o)

libcounter.a(lexer.o): lexer.o
        $(AR) $(ARFLAGS) $@ $&lt;

libcounter.a(counter.o): counter.o
        $(AR) $(ARFLAGS) $@ $&lt;

count_words.o: counter.h
counter.o: counter.h lexer.h
lexer.o: lexer.h</pre><p>æ‰§è¡Œæ—¶ï¼Œ<em class="command">make</em>
          ä¼šäº§ç”Ÿä»¥ä¸‹è¾“å‡ºï¼š</p><p>When executed, <em class="command">make</em>
          produces this output:</p><a id="OEBPS/ch02s08.html.I_2_tt93"></a><pre class="programlisting">$ åˆ¶ä½œ
gcc -I include -c -o count_words.o src/count_words.c
flex -t src/lexer.l&gt; lexer.c
gcc -I include -c -o lexer.o lexer.c
ar rv libcounter.a lexer.o
arï¼šåˆ›å»º libcounter.a
a - è¯æ³•åˆ†æžå™¨.o
gcc -I include -c -o counter.o src/counter.c
ar rv libcounter.a counter.o
a - è®¡æ•°å™¨.o
gcc count_words.o libcounter.a /lib/libfl.a -o count_words
rm è¯æ³•åˆ†æžå™¨.c</pre><pre class="programlisting">$ make
gcc  -I include  -c -o count_words.o src/count_words.c
flex  -t src/lexer.l&gt; lexer.c
gcc  -I include  -c -o lexer.o lexer.c
ar rv libcounter.a lexer.o
ar: creating libcounter.a
a - lexer.o
gcc  -I include  -c -o counter.o src/counter.c
ar rv libcounter.a counter.o
a - counter.o
gcc   count_words.o libcounter.a /lib/libfl.a   -o count_words
rm lexer.c</pre><p>æ³¨æ„å­˜æ¡£æ›´æ–°è§„åˆ™ã€‚<code class="literal">$@</code>å³ä½¿ makefile ä¸­çš„ç›®æ ‡<em class="filename">æ˜¯</em>libcounter.a <em class="filename">(lexer.o)</em> ï¼Œè‡ªåŠ¨å˜é‡
          ä¹Ÿä¼šæ‰©å±•ä¸ºåº“åç§°ã€‚</p><p>Notice the archive updating rule. The automatic variable
          <code class="literal">$@</code> is expanded to the library
          name even though the target in the <em class="filename">makefile</em> is <em class="filename">libcounter.a(lexer.o)</em>.</p><p>æœ€åŽï¼Œåº”è¯¥æåˆ°çš„æ˜¯ï¼Œå­˜æ¡£åº“åŒ…å«å…¶æ‰€åŒ…å«ç¬¦å·çš„ç´¢å¼•ã€‚
          å½“æ–°æ¨¡å—æ·»åŠ åˆ°å­˜æ¡£æ—¶ï¼Œè¾ƒæ–°çš„å­˜æ¡£ç¨‹åºï¼ˆä¾‹å¦‚<acronym class="acronym">GNU </acronym> <em class="command">arï¼‰</em>ä¼šè‡ªåŠ¨ç®¡ç†æ­¤ç´¢å¼•ã€‚ç„¶è€Œï¼Œè®¸å¤šæ—§ç‰ˆæœ¬çš„<em class="command">ar</em>å´æ²¡æœ‰ã€‚è¦åˆ›å»ºæˆ–æ›´æ–°å­˜æ¡£çš„ç´¢å¼•ï¼Œéœ€è¦ä½¿ç”¨å¦ä¸€ä¸ªç¨‹åº<em class="command">ranlib</em> ã€‚åœ¨è¿™äº›ç³»ç»Ÿä¸Šï¼Œç”¨äºŽæ›´æ–°æ¡£æ¡ˆçš„å†…ç½®éšå¼è§„åˆ™æ˜¯ä¸å¤Ÿçš„ã€‚å¯¹äºŽè¿™äº›ç³»ç»Ÿï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p><p>Finally, it should be mentioned that an archive library
          contains an index of the symbols it contains. Newer archive programs
          such as <acronym class="acronym">GNU</acronym> <em class="command">ar</em>
          manage this index automatically when a new module is added to the
          archive. However, many older versions of <em class="command">ar</em> do not. To create or update the index
          of an archive another program <em class="command">ranlib</em> is used. On these systems, the
          built-in implicit rule for updating archives is insufficient. For
          these systems, a rule such as:</p><a id="OEBPS/ch02s08.html.I_2_tt94"></a><pre class="programlisting">libcounter.a: libcounter.a(lexer.o) libcounter.a(counter.o)
        $(RANLIB) $@</pre><pre class="programlisting">libcounter.a: libcounter.a(lexer.o) libcounter.a(counter.o)
        $(RANLIB) $@</pre><p>å¿…é¡»ä½¿ç”¨ã€‚æˆ–è€…ï¼Œå¦‚æžœæ‚¨é€‰æ‹©å¯¹å¤§åž‹æ¡£æ¡ˆä½¿ç”¨æ›¿ä»£æ–¹æ³•ï¼š</p><p>must be used. Or if you choose to use the alternate approach
          for large archives:</p><a id="OEBPS/ch02s08.html.I_2_tt95"></a><pre class="programlisting">libcounter.a: counter.o lexer.o
        $(RM) $@
        $(AR) $(ARFLGS) $@ $^
        $(RANLIB) $@</pre><pre class="programlisting">libcounter.a: counter.o lexer.o
        $(RM) $@
        $(AR) $(ARFLGS) $@ $^
        $(RANLIB) $@</pre><p>å½“ç„¶ï¼Œè¿™ç§ç”¨äºŽç®¡ç†å­˜æ¡£æˆå‘˜çš„è¯­æ³•ä¹Ÿå¯ä»¥ä¸Žå†…ç½®çš„éšå¼è§„åˆ™ä¸€èµ·ä½¿ç”¨ã€‚
           <acronym class="acronym">GNU </acronym> <em class="command">make</em>å¸¦æœ‰ä¸€ä¸ªç”¨äºŽæ›´æ–°å­˜æ¡£çš„å†…ç½®è§„åˆ™ã€‚å½“æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªè§„åˆ™æ—¶ï¼Œæˆ‘ä»¬çš„<em class="filename">makefile</em>å˜æˆï¼š</p><p>Of course, this syntax for managing the members of an archive
          can be used with the built-in implicit rules as well.
          <acronym class="acronym">GNU</acronym> <em class="command">make</em> comes
          with a built-in rule for updating an archive. When we use this rule,
          our <em class="filename">makefile</em> becomes:</p><a id="OEBPS/ch02s08.html.I_2_tt96"></a><pre class="programlisting">VPATH = src åŒ…å«
CPPFLAGS = -æˆ‘åŒ…æ‹¬

count_wordsï¼šlibcounter.a -lfl
libcounter.a: libcounter.a(lexer.o) libcounter.a(counter.o)
count_words.oï¼šè®¡æ•°å™¨.h
counter.o: counter.h lexer.h
è¯æ³•åˆ†æžå™¨.o: è¯æ³•åˆ†æžå™¨.h</pre><pre class="programlisting">VPATH    = src include
CPPFLAGS = -I include

count_words: libcounter.a -lfl
libcounter.a: libcounter.a(lexer.o) libcounter.a(counter.o)
count_words.o: counter.h
counter.o: counter.h lexer.h
lexer.o: lexer.h</pre></div><div class="sect2" title="ä½¿ç”¨åº“ä½œä¸ºå…ˆå†³æ¡ä»¶"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch02s08.html.make3-CHP-2-SECT-8.2"></a>ä½¿ç”¨åº“ä½œä¸ºå…ˆå†³æ¡ä»¶</h2><h2 class="title"><a></a>Using Libraries as Prerequisites</h2></div></div></div><p>å½“åº“æ˜¾ç¤ºä¸º<a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1021" class="indexterm"></a> <a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1022" class="indexterm"></a>å¦‚æžœæ»¡è¶³å…ˆå†³æ¡ä»¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ ‡å‡†æ–‡ä»¶åæˆ–è¯­æ³•æ¥å¼•ç”¨å®ƒä»¬<code class="option">-l</code>ã€‚å½“ä½¿ç”¨æ–‡ä»¶åè¯­æ³•æ—¶ï¼š</p><p>When libraries appear as <a class="indexterm"></a> <a class="indexterm"></a>prerequisites, they can be referenced using either a
          standard filename or with the <code class="option">-l</code> syntax. When
          filename syntax is used:</p><a id="OEBPS/ch02s08.html.I_2_tt97"></a><pre class="programlisting">xpongï¼š$ï¼ˆå¯¹è±¡ï¼‰/lib/X11/libX11.a/lib/X11/libXaw.a
        $(é“¾æŽ¥)$^-o $@</pre><pre class="programlisting">xpong: $(OBJECTS) /lib/X11/libX11.a /lib/X11/libXaw.a
        $(LINK) $^ -o $@</pre><p>é“¾æŽ¥å™¨å°†ç®€å•åœ°è¯»å–å‘½ä»¤è¡Œä¸Šåˆ—å‡ºçš„åº“æ–‡ä»¶å¹¶æ­£å¸¸å¤„ç†å®ƒä»¬ã€‚ä½¿ç”¨è¯¥è¯­æ³•æ—¶<code class="option">-l</code>
          ï¼Œå…ˆå†³æ¡ä»¶æ ¹æœ¬ä¸æ˜¯æ­£ç¡®çš„æ–‡ä»¶ï¼š</p><p>the linker will simply read the library files listed on the
          command line and process them normally. When the <code class="option">-l</code>
          syntax is used, the prerequisites aren't proper files at all:</p><a id="OEBPS/ch02s08.html.I_2_tt98"></a><pre class="programlisting">xpongï¼š$ï¼ˆå¯¹è±¡ï¼‰-lX11 -lXaw
        $(é“¾æŽ¥)$^-o $@</pre><pre class="programlisting">xpong: $(OBJECTS) -lX11 -lXaw
        $(LINK) $^ -o $@</pre><p><code class="option">-l</code>å½“åœ¨å…ˆå†³æ¡ä»¶ä¸­ä½¿ç”¨
          è¯¥å½¢å¼æ—¶ï¼Œ <em class="command">make</em>å°†æœç´¢åº“ï¼ˆé¦–é€‰å…±äº«åº“ï¼‰å¹¶å°†å…¶å€¼ä½œä¸ºç»å¯¹è·¯å¾„æ›¿æ¢åˆ°<code class="literal">$^</code>å’Œ
          <code class="literal">$?</code>å˜é‡ä¸­ã€‚ç¬¬äºŒç§å½¢å¼çš„ä¸€å¤§ä¼˜ç‚¹æ˜¯ï¼Œå³ä½¿ç³»ç»Ÿçš„é“¾æŽ¥å™¨æ— æ³•æ‰§è¡Œè¿™äº›èŒè´£ï¼Œå®ƒä¹Ÿå…è®¸æ‚¨ä½¿ç”¨æœç´¢å’Œå…±äº«åº“é¦–é€‰é¡¹åŠŸèƒ½ã€‚å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯æ‚¨å¯ä»¥è‡ªå®šä¹‰<em class="command">make</em>çš„æœç´¢è·¯å¾„ï¼Œä»¥ä¾¿å®ƒå¯ä»¥æ‰¾åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºçš„åº“ä»¥åŠç³»ç»Ÿåº“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ç§å½¢å¼å°†å¿½ç•¥å…±äº«åº“å¹¶ä½¿ç”¨å­˜æ¡£åº“ï¼Œå› ä¸ºè¿™æ˜¯åœ¨é“¾æŽ¥è¡Œä¸ŠæŒ‡å®šçš„ã€‚åœ¨ç¬¬äºŒç§å½¢å¼ä¸­ï¼Œ<em class="command">make</em>çŸ¥é“å…±äº«åº“æ˜¯é¦–é€‰ï¼Œå¹¶ä¸”å°†é¦–å…ˆæœç´¢<em class="filename">X11</em>çš„å…±äº«ç‰ˆæœ¬ï¼Œç„¶åŽå†é€‰æ‹©å­˜æ¡£ç‰ˆæœ¬ã€‚ç”¨äºŽæ ¹æ®æ ¼å¼è¯†åˆ«åº“çš„æ¨¡å¼
          <code class="option">-l</code>å­˜å‚¨åœ¨å…¶ä»–åº“æ–‡ä»¶åæ ¼å¼ä¸­<code class="literal">.LIBPATTERNS</code>ï¼Œå¹¶ä¸”å¯ä»¥é’ˆå¯¹å…¶ä»–åº“æ–‡ä»¶åæ ¼å¼è¿›è¡Œå®šåˆ¶ã€‚</p><p>When the <code class="option">-l</code> form is used in a prerequisite,
          <em class="command">make</em> will search for the library
          (preferring a shared library) and substitute its value, as an
          absolute path, into the <code class="literal">$^</code> and
          <code class="literal">$?</code> variables. One great advantage
          of the second form is that it allows you to use the search and
          shared library preference feature even when the system's linker
          cannot perform these duties. Another advantage is that you can
          customize <em class="command">make</em>'s search path so
          it can find your application's libraries as well as system
          libraries. In this case, the first form would ignore the shared
          library and use the archive library since that is what was specified
          on the link line. In the second form, <em class="command">make</em> knows that shared libraries are
          preferred and will search first for a shared version of <em class="filename">X11</em> before settling for the archive
          version. The pattern for recognizing libraries from the
          <code class="option">-l</code> format is stored in <code class="literal">.LIBPATTERNS</code> and can be customized for
          other library filename formats.</p><p>ä¸å¹¸çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªå°çš±çº¹ã€‚å¦‚æžœ<em class="filename">makefile</em>æŒ‡å®šäº†åº“æ–‡ä»¶ç›®æ ‡ï¼Œåˆ™å®ƒæ— æ³•<code class="option">-l</code>åœ¨å…ˆå†³æ¡ä»¶ä¸­ä½¿ç”¨è¯¥æ–‡ä»¶çš„é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹<em class="filename">makefile</em>ï¼š</p><p>Unfortunately, there is a small wrinkle. If a <em class="filename">makefile</em> specifies a library file target,
          it cannot use the <code class="option">-l</code> option for that file in a
          prerequisite. For instance, the following <em class="filename">makefile</em>:</p><a id="OEBPS/ch02s08.html.I_2_tt99"></a><pre class="programlisting">count_words: count_words.o -lcounter -lfl
        $(CC) $^ -o $@

libcounter.a: libcounter.a(lexer.o) libcounter.a(counter.o)</pre><pre class="programlisting">count_words: count_words.o -lcounter -lfl
        $(CC) $^ -o $@

libcounter.a: libcounter.a(lexer.o) libcounter.a(counter.o)</pre><p>å¤±è´¥å¹¶å‡ºçŽ°é”™è¯¯ï¼š</p><p>fails with the error:</p><a id="OEBPS/ch02s08.html.I_2_tt100"></a><pre class="programlisting">æ²¡æœ‰è§„åˆ™æ¥åˆ›å»ºâ€œcount_wordsâ€æ‰€éœ€çš„ç›®æ ‡â€œ-lcounterâ€</pre><pre class="programlisting">No rule to make target `-lcounter', needed by `count_words'</pre><p>å‡ºçŽ°æ­¤é”™è¯¯çš„åŽŸå› ä¼¼ä¹Žæ˜¯<em class="command">make</em>æ²¡æœ‰æ‰©å±•
          <code class="option">-lcounter</code>åˆ°<em class="filename">libcounter.a</em>å¹¶æœç´¢ç›®æ ‡ï¼Œè€Œæ˜¯ç›´æŽ¥è¿›è¡Œåº“æœç´¢ã€‚å› æ­¤ï¼Œå¯¹äºŽåœ¨<em class="filename">makefile</em>ä¸­æž„å»ºçš„åº“ï¼Œå¿…é¡»ä½¿ç”¨æ–‡ä»¶åå½¢å¼ã€‚</p><p>It appears that this error occurs because <em class="command">make</em> does not expand
          <code class="option">-lcounter</code> to <em class="filename">libcounter.a</em> and search for a target, but
          instead does a straight library search. So for libraries built
          within the <em class="filename">makefile</em>, the
          filename form must be used.</p><p>è®©å¤æ‚çš„ç¨‹åºæ— é”™è¯¯åœ°é“¾æŽ¥å¯èƒ½æœ‰ç‚¹åƒé­”æœ¯ã€‚é“¾æŽ¥å™¨å°†æŒ‰ç…§åº“åœ¨å‘½ä»¤è¡Œä¸Šåˆ—å‡ºçš„é¡ºåºæœç´¢åº“ã€‚å› æ­¤ï¼Œå¦‚æžœlibrary
          <em class="replaceable"><code>A</code></em>åŒ…å«æœªå®šä¹‰çš„ç¬¦å·ï¼Œä¾‹å¦‚
          <code class="function">open</code>åœ¨libraryä¸­å®šä¹‰çš„<em class="replaceable"><code>B</code></em>ï¼Œåˆ™é“¾æŽ¥å‘½ä»¤è¡Œå¿…é¡»åˆ—<em class="replaceable"><code>A</code></em>åœ¨å‰é¢
          <em class="replaceable"><code>B</code></em>ï¼ˆå³<em class="replaceable"><code>A</code></em>
          requires <em class="replaceable"><code>B</code></em>ï¼‰ã€‚å¦åˆ™ï¼Œå½“é“¾æŽ¥å™¨è¯»å–<em class="replaceable"><code>A</code></em>å¹¶çœ‹åˆ°æœªå®šä¹‰çš„ç¬¦å·
          æ—¶<code class="function">open</code>ï¼Œå†è¿”å›žåˆ°å°±ä¸ºæ—¶å·²æ™šäº†<em class="replaceable"><code>B</code></em>ã€‚é“¾æŽ¥å™¨æ°¸è¿œä¸ä¼šè¿”å›žã€‚æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œå‘½ä»¤è¡Œä¸Šåº“çš„é¡ºåºè‡³å…³é‡è¦ã€‚</p><p>Getting complex programs to link without error can be somewhat
          of a black art. The linker will search libraries in the order in
          which they are listed on the command line. So if library
          <em class="replaceable"><code>A</code></em> includes an undefined symbol, say
          <code class="function">open</code>, that is defined in
          library <em class="replaceable"><code>B</code></em>, the link command line must
          list <em class="replaceable"><code>A</code></em> before
          <em class="replaceable"><code>B</code></em> (that is, <em class="replaceable"><code>A</code></em>
          requires <em class="replaceable"><code>B</code></em>). Otherwise, when the linker
          reads <em class="replaceable"><code>A</code></em> and sees the undefined symbol
          <code class="function">open</code>, it's too late to go back
          to <em class="replaceable"><code>B</code></em>. The linker doesn't ever go back. As
          you can see, the order of libraries on the command line is of
          fundamental importance.</p><p>å½“açš„å…ˆå†³æ¡ä»¶<a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1023" class="indexterm"></a> <a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1024" class="indexterm"></a>ç›®æ ‡ä¿å­˜åœ¨<code class="literal">$^</code>å’Œ<code class="literal">$?</code>å˜é‡ä¸­ï¼Œå®ƒä»¬çš„é¡ºåºè¢«ä¿ç•™ã€‚å› æ­¤ï¼Œå¦‚ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­æ‰€ç¤ºï¼Œä½¿ç”¨<code class="literal">$^</code>ä¸Žå…ˆå†³æ¡ä»¶åˆ—è¡¨ç›¸åŒçš„é¡ºåºæ‰©å±•ä¸ºç›¸åŒçš„æ–‡ä»¶ã€‚å³ä½¿å…ˆå†³æ¡ä»¶åˆ†æ•£åœ¨å¤šä¸ªè§„åˆ™ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªè§„åˆ™çš„å…ˆå†³æ¡ä»¶éƒ½ä¼šæŒ‰ç…§å‡ºçŽ°çš„é¡ºåºé™„åŠ åˆ°ç›®æ ‡å…ˆå†³æ¡ä»¶åˆ—è¡¨ä¸­ã€‚</p><p>When the prerequisites of a <a class="indexterm"></a> <a class="indexterm"></a>target are saved in the <code class="literal">$^</code> and <code class="literal">$?</code> variables, their order is preserved. So
          using <code class="literal">$^</code> as in the previous
          example expands to the same files in the same order as the
          prerequisites list. This is true even when the prerequisites are
          split across multiple rules. In that case, the prerequisites of each
          rule are appended to the target prerequisite list in the order they
          are seen.</p><p>ä¸€ä¸ªå¯†åˆ‡ç›¸å…³çš„é—®é¢˜æ˜¯åº“ä¹‹é—´çš„ç›¸äº’å¼•ç”¨ï¼Œé€šå¸¸ç§°ä¸º<em class="firstterm">å¾ªçŽ¯å¼•ç”¨</em>æˆ–<em class="firstterm">å¾ªçŽ¯</em>ã€‚è®¤ä¸º<a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1025" class="indexterm"></a> <a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1026" class="indexterm"></a> <a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1027" class="indexterm"></a>è¿›è¡Œäº†æ›´æ”¹ï¼Œåº“
          <em class="replaceable"><code>B</code></em>çŽ°åœ¨å¼•ç”¨åº“ä¸­å®šä¹‰çš„ç¬¦å·<em class="replaceable"><code>A</code></em>ã€‚æˆ‘ä»¬çŸ¥é“
          <em class="replaceable"><code>A</code></em>å¿…é¡»å…ˆæ¥
          <em class="replaceable"><code>B</code></em>ï¼Œä½†çŽ°åœ¨<em class="replaceable"><code>B</code></em>
          å¿…é¡»å…ˆæ¥<em class="replaceable"><code>A</code></em>ã€‚å—¯ï¼Œæœ‰é—®é¢˜ã€‚è§£å†³åŠžæ³•æ˜¯<em class="replaceable"><code>A</code></em>åœ¨ä¹‹å‰å’Œ<span class="emphasis"><em>ä¹‹åŽ</em></span> éƒ½å¼•ç”¨<em class="replaceable"><code>B</code></em>ï¼š
           <code class="option">-l</code> <em class="replaceable"><code>A</code></em>- <code class="literal">l</code> <em class="replaceable"><code>B</code></em>- <code class="literal">l</code> <em class="replaceable"><code>A</code></em>ã€‚åœ¨å¤§åž‹ã€å¤æ‚çš„ç¨‹åºä¸­ï¼Œåº“é€šå¸¸éœ€è¦ä»¥è¿™ç§æ–¹å¼é‡å¤ï¼Œæœ‰æ—¶ç”šè‡³ä¸¤æ¬¡ä»¥ä¸Šã€‚</p><p>A closely related problem is mutual reference between
          libraries, often referred to as <em class="firstterm">circular
          references</em> or <em class="firstterm">circularities</em>.
          Suppose <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>a change is made and library
          <em class="replaceable"><code>B</code></em> now references a symbol defined in
          library <em class="replaceable"><code>A</code></em>. We know
          <em class="replaceable"><code>A</code></em> must come before
          <em class="replaceable"><code>B</code></em>, but now <em class="replaceable"><code>B</code></em>
          must come before <em class="replaceable"><code>A</code></em>. Hmm, a problem. The
          solution is to reference <em class="replaceable"><code>A</code></em> both before
          and <span class="emphasis"><em>after</em></span> <em class="replaceable"><code>B</code></em>:
          <code class="option">-l</code> <em class="replaceable"><code>A</code></em> -<code class="literal">l</code> <em class="replaceable"><code>B</code></em> -<code class="literal">l</code> <em class="replaceable"><code>A</code></em>. In large,
          complex programs, libraries often need to be repeated in this way,
          sometimes more than twice.</p><p>è¿™ç§æƒ…å†µç»™<em class="command">make</em>å¸¦æ¥äº†ä¸€ä¸ªå°é—®é¢˜ï¼Œå› ä¸ºè‡ªåŠ¨å˜é‡é€šå¸¸ä¼šä¸¢å¼ƒé‡å¤é¡¹ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦é‡å¤ä¸€ä¸ªåº“å…ˆå†³æ¡ä»¶æ¥æ»¡è¶³åº“å¾ªçŽ¯æ€§ï¼š</p><p>This situation poses a minor problem for <em class="command">make</em> because the automatic variables
          normally discard duplicates. For example, suppose we need to repeat
          a library prerequisite to satisfy a library circularity:</p><a id="OEBPS/ch02s08.html.I_2_tt101"></a><pre class="programlisting">xpong: xpong.o libui.a libdynamics.a libui.a -lX11
        $(CC) $^ -o $@</pre><pre class="programlisting">xpong: xpong.o libui.a libdynamics.a libui.a -lX11
        $(CC) $^ -o $@</pre><p>è¯¥å…ˆå†³æ¡ä»¶åˆ—è¡¨å°†è¢«å¤„ç†ä¸ºä»¥ä¸‹é“¾æŽ¥å‘½ä»¤ï¼š</p><p>This prerequisite list will be processed into the following
          link command:</p><a id="OEBPS/ch02s08.html.I_2_tt102"></a><pre class="programlisting">gcc xpong.o libui.a libdynamics.a /usr/lib/X11R6/libX11.a -o xpong</pre><pre class="programlisting">gcc xpong.o libui.a libdynamics.a /usr/lib/X11R6/libX11.a -o xpong</pre><p>å“Žå‘€ã€‚ä¸ºäº†å…‹æœè¿™ç§è¡Œä¸ºï¼Œå¯ä»¥åœ¨<em class="command">make</em><code class="literal">$^</code>ä¸­ä½¿ç”¨é™„åŠ å˜é‡
          ã€‚è¯¥å˜é‡ä¸Ž ç›¸åŒï¼Œåªæ˜¯ä¿ç•™äº†é‡å¤çš„å…ˆå†³æ¡ä»¶ã€‚ä½¿ç”¨ï¼š<em class="command"></em><code class="literal">$+</code><code class="literal">$^</code><code class="literal">$+</code></p><p>Oops. To overcome this behavior of <code class="literal">$^</code> an additional variable is available in
          <em class="command">make</em>, <code class="literal">$+</code>. This variable is identical to <code class="literal">$^</code> with the exception that duplicate
          prerequisites are preserved. Using <code class="literal">$+</code>:</p><a id="OEBPS/ch02s08.html.I_2_tt103"></a><pre class="programlisting">xpong: xpong.o libui.a libdynamics.a libui.a -lX11
        $(CC) $+ -o $@</pre><pre class="programlisting">xpong: xpong.o libui.a libdynamics.a libui.a -lX11
        $(CC) $+ -o $@</pre><p>è¯¥å…ˆå†³æ¡ä»¶åˆ—è¡¨å°†è¢«å¤„ç†ä¸ºä»¥ä¸‹é“¾æŽ¥å‘½ä»¤ï¼š</p><p>This prerequisite list will be processed into the following
          link command:</p><a id="OEBPS/ch02s08.html.I_2_tt104"></a><pre class="programlisting">gcc xpong.o libui.a libdynamics.a libui.a /usr/lib/X11R6/libX11.a -o xpong</pre><pre class="programlisting">gcc xpong.o libui.a libdynamics.a libui.a /usr/lib/X11R6/libX11.a -o xpong</pre></div><div class="sect2" title="åŒå†’å·è§„åˆ™"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch02s08.html.make3-CHP-2-SECT-8.3"></a>åŒå†’å·è§„åˆ™</h2><h2 class="title"><a></a>Double-Colon Rules</h2></div></div></div><p>åŒå†’å·è§„åˆ™æ˜¯<a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1028" class="indexterm"></a> <a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1029" class="indexterm"></a> <a id="OEBPS/ch02s08.html.make3-CHP-2-ITERM-1030" class="indexterm"></a>æ¨¡ç³Šçš„åŠŸèƒ½ï¼Œå…è®¸ä½¿ç”¨ä¸åŒçš„å‘½ä»¤æ›´æ–°ç›¸åŒçš„ç›®æ ‡ï¼Œå…·ä½“å–å†³äºŽå“ªç»„å…ˆå†³æ¡ä»¶æ¯”ç›®æ ‡æ–°ã€‚é€šå¸¸ï¼Œå½“ç›®æ ‡å‡ºçŽ°å¤šæ¬¡æ—¶ï¼Œæ‰€æœ‰å…ˆå†³æ¡ä»¶éƒ½ä¼šé™„åŠ åˆ°ä¸€é•¿ä¸²åˆ—è¡¨ä¸­ï¼Œåªæœ‰ä¸€ä¸ªå‘½ä»¤è„šæœ¬æ¥æ‰§è¡Œæ›´æ–°ã€‚ç„¶è€Œï¼Œä½¿ç”¨åŒå†’å·è§„åˆ™æ—¶ï¼Œæ¯æ¬¡å‡ºçŽ°çš„ç›®æ ‡éƒ½è¢«è§†ä¸ºå®Œå…¨ç‹¬ç«‹çš„å®žä½“å¹¶å•ç‹¬å¤„ç†ã€‚è¿™æ„å‘³ç€å¯¹äºŽç‰¹å®šç›®æ ‡ï¼Œæ‰€æœ‰è§„åˆ™å¿…é¡»å±žäºŽåŒä¸€ç±»åž‹ï¼Œè¦ä¹ˆéƒ½æ˜¯åŒå†’å·è§„åˆ™ï¼Œè¦ä¹ˆéƒ½æ˜¯å•å†’å·è§„åˆ™ã€‚</p><p>Double-colon rules are an <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>obscure feature that allows the same target to be
          updated with different commands depending on which set of
          prerequisites are newer than the target. Normally, when a target
          appears more than once all the prerequisites are appended in a long
          list with only one command script to perform the update. With
          double-colon rules, however, each occurrence of the target is
          considered a completely separate entity and is handled individually.
          This means that for a particular target, all the rules must be of
          the same type, either they are all double-colon rules or all
          single-colon rules.</p><p>æ­¤åŠŸèƒ½çš„çŽ°å®žã€æœ‰ç”¨çš„ç¤ºä¾‹å¾ˆéš¾èŽ·å¾—ï¼ˆè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒæ˜¯ä¸€ä¸ªæ™¦æ¶©çš„åŠŸèƒ½ï¼‰ï¼Œä½†è¿™é‡Œæœ‰ä¸€ä¸ªäººä¸ºçš„ç¤ºä¾‹ï¼š</p><p>Realistic, useful examples of this feature are difficult to
          come by (which is why it is an obscure feature), but here is an
          artificial example:</p><a id="OEBPS/ch02s08.html.I_2_tt105"></a><pre class="programlisting">æ–‡ä»¶åˆ—è¡¨:: ç”Ÿæˆåˆ—è¡¨è„šæœ¬
        chmod +x $&lt;
        ç”Ÿæˆåˆ—è¡¨è„šæœ¬ $(files) &gt; æ–‡ä»¶åˆ—è¡¨

æ–‡ä»¶åˆ—è¡¨:: $(æ–‡ä»¶)
        ç”Ÿæˆåˆ—è¡¨è„šæœ¬ $(files) &gt; æ–‡ä»¶åˆ—è¡¨</pre><pre class="programlisting">file-list:: generate-list-script
        chmod +x $&lt;
        generate-list-script $(files) &gt; file-list

file-list:: $(files)
        generate-list-script $(files) &gt; file-list</pre><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼é‡æ–°ç”Ÿæˆ<em class="filename">æ–‡ä»¶åˆ—è¡¨</em>ç›®æ ‡ã€‚å¦‚æžœç”Ÿæˆè„šæœ¬å·²æ›´æ–°ï¼Œæˆ‘ä»¬ä½¿è„šæœ¬å¯æ‰§è¡Œï¼Œç„¶åŽè¿è¡Œå®ƒã€‚å¦‚æžœæºæ–‡ä»¶å·²æ›´æ”¹ï¼Œæˆ‘ä»¬åªéœ€è¿è¡Œè„šæœ¬å³å¯ã€‚è™½ç„¶æœ‰ç‚¹ç‰µå¼ºï¼Œä½†è¿™å¯ä»¥è®©æ‚¨äº†è§£å¦‚ä½•ä½¿ç”¨è¯¥åŠŸèƒ½ã€‚</p><p>We can regenerate the <em class="filename">file-list</em> target two ways. If the
          generating script has been updated, we make the script executable,
          then run it. If the source files have changed, we simply run the
          script. Although a bit far-fetched, this gives you a feel for how
          the feature might be used.</p><p><em class="command">æˆ‘ä»¬å·²ç»ä»‹ç»äº†make</em>è§„åˆ™çš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œä»¥åŠå˜é‡å’Œå‘½ä»¤ï¼Œè¿™å°±æ˜¯<em class="command">make</em>çš„æœ¬è´¨ã€‚æˆ‘ä»¬ä¸»è¦å…³æ³¨è¿™äº›åŠŸèƒ½çš„å…·ä½“è¯­æ³•å’Œè¡Œä¸ºï¼Œè€Œæ²¡æœ‰è¿‡å¤šè®¨è®ºå¦‚ä½•åœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹åº”ç”¨å®ƒä»¬ã€‚è¿™å°±æ˜¯<a class="link" href="#OEBPS/pt02.html" title="ç¬¬äºŒéƒ¨åˆ†ã€‚é«˜çº§å’Œä¸“ä¸šä¸»é¢˜">ç¬¬äºŒéƒ¨åˆ†</a>çš„ä¸»é¢˜
          ã€‚çŽ°åœ¨ï¼Œæˆ‘ä»¬å°†ç»§ç»­è®¨è®ºå˜é‡ï¼Œç„¶åŽæ˜¯å‘½ä»¤ã€‚</p><p>We've covered most of the features of <em class="command">make</em> rules and, along with variables and
          commands, this is the essence of <em class="command">make</em>. We've focused largely on the
          specific syntax and behavior of the features without going much into
          how to apply them in more complex situations. That is the subject of
          <a class="link" href="#OEBPS/pt02.html" title="Part&nbsp;II.&nbsp;Advanced and Specialized Topics">Part II</a>. For now, we will
          continue our discussion with variables and then commands.</p></div></div></div></div>
<div id="OEBPS/ch03.html"><div>
<div class="chapter" title="ç¬¬ 3 ç« å˜é‡å’Œå®"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch03.html.make3-CHP-3"></a>ç¬¬ 3 ç« å˜é‡å’Œå®</h1><h1 class="title"><a></a>Chapter&nbsp;3.&nbsp;Variables and Macros</h1></div></div></div><p>æˆ‘ä»¬ç ”ç©¶<em class="filename">makefile</em>å˜é‡å·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œå¹¶ä¸”å·²ç»çœ‹åˆ°äº†è®¸å¤šå¦‚ä½•åœ¨å†…ç½®è§„åˆ™å’Œç”¨æˆ·å®šä¹‰è§„åˆ™ä¸­ä½¿ç”¨å®ƒä»¬çš„ç¤ºä¾‹ã€‚ä½†æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ä¾‹å­ä»…ä»…è§¦åŠäº†è¡¨é¢ã€‚å˜é‡å’Œå®å˜å¾—æ›´åŠ å¤æ‚ï¼Œ
       <acronym class="acronym">GNU</acronym> æ›´åŠ 
      <em class="command">é‡è§†</em><a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1031" class="indexterm"></a>å…¶ä¸å¯æ€è®®çš„åŠ›é‡ã€‚</p><p>We've been looking at <em class="filename">makefile</em> variables for a while now and we've
      seen many examples of how they're used in both the built-in and
      user-defined rules. But the examples we've seen have only scratched the
      surface. Variables and macros get much more complicated and give
      <acronym class="acronym">GNU</acronym> <em class="command">make</em> much of
      <a class="indexterm"></a>its incredible power.</p><p>åœ¨æˆ‘ä»¬è¿›ä¸€æ­¥è®¨è®ºä¹‹å‰ï¼Œäº†è§£
      <em class="command">make</em>æ˜¯ä¸¤ç§è¯­è¨€åˆäºŒä¸ºä¸€æ˜¯å¾ˆé‡è¦çš„ã€‚ç¬¬ä¸€ç§è¯­è¨€æè¿°ç”±ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶ç»„æˆçš„ä¾èµ–å…³ç³»å›¾ã€‚ ï¼ˆè¯¥è¯­è¨€å·²åœ¨<a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™">ç¬¬ 2 ç« </a>ä¸­ä»‹ç»è¿‡ã€‚ï¼‰ç¬¬äºŒç§è¯­è¨€æ˜¯ç”¨äºŽæ‰§è¡Œæ–‡æœ¬æ›¿æ¢çš„å®è¯­è¨€ã€‚æ‚¨å¯èƒ½ç†Ÿæ‚‰çš„å…¶ä»–å®è¯­è¨€åŒ…æ‹¬ C é¢„å¤„ç†å™¨ã€<em class="command">m4</em>ã€TEX å’Œå®æ±‡ç¼–å™¨ã€‚ä¸Žå…¶ä»–å®è¯­è¨€ä¸€æ ·ï¼Œ<em class="command">make</em>å…è®¸æ‚¨ä¸ºè¾ƒé•¿çš„å­—ç¬¦åºåˆ—å®šä¹‰é€Ÿè®°æœ¯è¯­å¹¶åœ¨ç¨‹åºä¸­ä½¿ç”¨è¯¥é€Ÿè®°æœ¯è¯­ã€‚å®å¤„ç†å™¨å°†è¯†åˆ«æ‚¨çš„é€Ÿè®°æœ¯è¯­å¹¶å°†å…¶æ›¿æ¢ä¸ºå…¶æ‰©å±•å½¢å¼ã€‚è™½ç„¶å¾ˆå®¹æ˜“å°†<em class="filename">makefile</em>
      å˜é‡è§†ä¸ºä¼ ç»Ÿç¼–ç¨‹è¯­è¨€å˜é‡ï¼Œä½†å®â€œå˜é‡â€å’Œâ€œä¼ ç»Ÿâ€å˜é‡ä¹‹é—´å­˜åœ¨åŒºåˆ«ã€‚å®å˜é‡â€œå°±åœ°â€æ‰©å±•ä»¥ç”Ÿæˆæ–‡æœ¬å­—ç¬¦ä¸²ï¼Œç„¶åŽå¯ä»¥è¿›ä¸€æ­¥æ‰©å±•è¯¥æ–‡æœ¬å­—ç¬¦ä¸²ã€‚éšç€æˆ‘ä»¬çš„ç»§ç»­ï¼Œè¿™ç§åŒºåˆ«å°†å˜å¾—æ›´åŠ æ¸…æ™°ã€‚</p><p>Before we go any further, it is important to understand that
      <em class="command">make</em> is sort of two languages in one.
      The first language describes dependency graphs consisting of targets and
      prerequisites. (This language was covered in <a class="link" href="#OEBPS/ch02.html" title="Chapter&nbsp;2.&nbsp;Rules">Chapter 2</a>.) The second language is a macro
      language for performing textual substitution. Other macro languages you
      may be familiar with are the C preprocessor, <em class="command">m4</em>, TEX, and macro assemblers. Like these
      other macro languages, <em class="command">make</em> allows
      you to define a shorthand term for a longer sequence of characters and
      use the shorthand in your program. The macro processor will recognize
      your shorthand terms and replace them with their expanded form. Although
      it is easy to think of <em class="filename">makefile</em>
      variables as traditional programming language variables, there is a
      distinction between a macro "variable" and a "traditional" variable. A
      macro variable is expanded "in place" to yield a text string that may
      then be expanded further. This distinction will become more clear as we
      proceed.</p><p>å˜é‡åå¯ä»¥åŒ…å«<a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1032" class="indexterm"></a> <a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1033" class="indexterm"></a>å‡ ä¹Žæ‰€æœ‰å­—ç¬¦ï¼ŒåŒ…æ‹¬å¤§å¤šæ•°æ ‡ç‚¹ç¬¦å·ã€‚å³ä½¿æœ‰ç©ºæ ¼ä¹Ÿæ˜¯å…è®¸çš„ï¼Œä½†å¦‚æžœä½ é‡è§†ä½ çš„ç†æ™ºï¼Œä½ åº”è¯¥é¿å…å®ƒä»¬ã€‚å˜é‡åä¸­å®žé™…ä¸Šä¸å…è®¸ä½¿ç”¨çš„å­—ç¬¦åªæœ‰:ã€# å’Œ =ã€‚</p><p>A variable name can contain <a class="indexterm"></a> <a class="indexterm"></a>almost any characters including most punctuation. Even
      spaces are allowed, but if you value your sanity you should avoid them.
      The only characters actually disallowed in a variable name are :, #, and
      =.</p><p>å˜é‡æ˜¯<a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1034" class="indexterm"></a> <a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1035" class="indexterm"></a>åŒºåˆ†å¤§å°å†™ï¼Œå› æ­¤<code class="literal">cc</code>
      å’Œ<code class="literal">CC</code>å¼•ç”¨ä¸åŒçš„å˜é‡ã€‚è¦èŽ·å–å˜é‡çš„å€¼ï¼Œè¯·å°†å˜é‡åç§°æ‹¬åœ¨ ä¸­<code class="literal">$( )</code>ã€‚ä½œä¸ºä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå•å­—æ¯å˜é‡åå¯ä»¥çœç•¥<a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1036" class="indexterm"></a> <a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1037" class="indexterm"></a>æ‹¬å·å¹¶ç®€å•åœ°ä½¿ç”¨<code class="literal">$</code> <em class="replaceable"><code>letter</code></em>.è¿™å°±æ˜¯è‡ªåŠ¨å˜é‡å¯ä»¥ä¸å†™æ‹¬å·çš„åŽŸå› ã€‚ä½œä¸ºä¸€èˆ¬è§„åˆ™ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨æ‹¬å·å½¢å¼å¹¶é¿å…ä½¿ç”¨å•å­—æ¯å˜é‡åç§°ã€‚</p><p>Variables are <a class="indexterm"></a> <a class="indexterm"></a>case-sensitive, so <code class="literal">cc</code>
      and <code class="literal">CC</code> refer to different variables.
      To get the value of a variable, enclose the variable name in <code class="literal">$( )</code>. As a special case, single-letter
      variable names can omit the <a class="indexterm"></a> <a class="indexterm"></a>parentheses and simply use <code class="literal">$</code> <em class="replaceable"><code>letter</code></em>. This is
      why the automatic variables can be written without the parentheses. As a
      general rule you should use the parenthetical form and avoid single
      letter variable names.</p><p>å˜é‡ä¹Ÿå¯ä»¥ä½¿ç”¨curlyæ¥æ‰©å±•<a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1038" class="indexterm"></a> <a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1039" class="indexterm"></a> <a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1040" class="indexterm"></a> <a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1041" class="indexterm"></a>ä¸­çš„å¤§æ‹¬å·<code class="literal">${CC}</code>ï¼Œæ‚¨ä¼šç»å¸¸çœ‹åˆ°è¿™ç§å½¢å¼ï¼Œç‰¹åˆ«æ˜¯åœ¨è¾ƒæ—§çš„<em class="filename">makefile</em>ä¸­ã€‚ä½¿ç”¨å…¶ä¸­ä¸€ç§å¾ˆå°‘æ¯”å¦ä¸€ç§æ›´æœ‰ä¼˜åŠ¿ï¼Œå› æ­¤åªéœ€é€‰æ‹©ä¸€ç§å¹¶åšæŒä½¿ç”¨å³å¯ã€‚æœ‰äº›äººä½¿ç”¨èŠ±æ‹¬å·è¿›è¡Œå˜é‡å¼•ç”¨ï¼Œä½¿ç”¨æ‹¬å·è¿›è¡Œå‡½æ•°è°ƒç”¨ï¼Œç±»ä¼¼äºŽ shell ä½¿ç”¨å®ƒä»¬çš„æ–¹å¼ã€‚å¤§å¤šæ•°çŽ°ä»£
      <em class="filename">makefile</em>ä½¿ç”¨æ‹¬å·ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨æœ¬ä¹¦ä¸­å°†ä½¿ç”¨çš„å†…å®¹ã€‚</p><p>Variables can also be expanded using curly <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>braces as in <code class="literal">${CC}</code> and
      you will often see this form, particularly in older <em class="filename">makefile</em>s. There is seldom an advantage to
      using one over the other, so just pick one and stick with it. Some
      people use curly braces for variable reference and parentheses for
      function call, similar to the way the shell uses them. Most modern
      <em class="filename">makefile</em>s use parentheses and
      that's what we'll use throughout this book.</p><p>ä»£è¡¨ç”¨æˆ·å¸¸é‡çš„å˜é‡<a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1042" class="indexterm"></a> <a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1043" class="indexterm"></a>å¯èƒ½æƒ³åœ¨å‘½ä»¤è¡Œæˆ–çŽ¯å¢ƒä¸­è¿›è¡Œè‡ªå®šä¹‰ï¼ŒæŒ‰ç…§çº¦å®šå…¨éƒ¨ç”¨å¤§å†™å­—æ¯ä¹¦å†™ã€‚å•è¯ä¹‹é—´ç”¨ä¸‹åˆ’çº¿åˆ†éš”ã€‚ä»…å‡ºçŽ°åœ¨<em class="filename">makefile</em>ä¸­çš„å˜é‡å…¨éƒ¨å°å†™ï¼Œå•è¯ä¹‹é—´ç”¨ä¸‹åˆ’çº¿åˆ†éš”ã€‚æœ€åŽï¼Œåœ¨æœ¬ä¹¦ä¸­ï¼Œå˜é‡ä¸­çš„ç”¨æˆ·å®šä¹‰å‡½æ•°<a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1044" class="indexterm"></a> <a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1045" class="indexterm"></a> <a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1046" class="indexterm"></a>å®ä½¿ç”¨å°å†™å•è¯ï¼Œå¹¶ç”¨ç ´æŠ˜å·åˆ†éš”ã€‚å…¶ä»–å‘½åçº¦å®šå°†åœ¨å‡ºçŽ°çš„åœ°æ–¹è¿›è¡Œè§£é‡Šã€‚ ï¼ˆä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨äº†æˆ‘ä»¬å°šæœªè®¨è®ºçš„åŠŸèƒ½ã€‚æˆ‘ä½¿ç”¨å®ƒä»¬æ¥è¯´æ˜Žå˜é‡å‘½åçº¦å®šï¼ŒçŽ°åœ¨ä¸è¦å¤ªå…³å¿ƒå³ä¾§ã€‚ï¼‰</p><p>Variables representing constants a user <a class="indexterm"></a> <a class="indexterm"></a>might want to customize on the command line or in the
      environment are written in all uppercase, by convention. Words are
      separated by underscores. Variables that appear only in the <em class="filename">makefile</em> are all lowercase with words
      separated by underscores. Finally, in this book, user-defined functions
      in variables <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>and macros use lowercase words separated by dashes. Other
      naming conventions will be explained where they occur. (The following
      example uses features we haven't discussed yet. I'm using them to
      illustrate the variable naming conventions, don't be too concerned about
      the righthand side for now.)</p><a id="OEBPS/ch03.html.I_3_tt106"></a><pre class="programlisting"># ä¸€äº›ç®€å•çš„å¸¸é‡ã€‚
CC := æµ·æ¹¾åˆä½œå§”å‘˜ä¼š
MKDIR := mkdir -p

# å†…éƒ¨å˜é‡ã€‚
æ¥æº= *.c
å¯¹è±¡ = $(subst .c,.o,$(æ¥æº))

# ä¸€ä¸ªæˆ–ä¸¤ä¸ªå‡½æ•°ã€‚
ä¹Ÿè®¸-make-dir = $(å¦‚æžœ$(é€šé…ç¬¦$1),,$(MKDIR) $1)
æ–­è¨€-not-null = $(if $1,,$(é”™è¯¯éžæ³•ç©ºå€¼ã€‚))</pre><pre class="programlisting"># Some simple constants.
CC    := gcc
MKDIR := mkdir -p

# Internal variables.
sources = *.c
objects = $(subst .c,.o,$(sources))

# A function or two.
maybe-make-dir  = $(if $(wildcard $1),,$(MKDIR) $1)
assert-not-null = $(if $1,,$(error Illegal null value.))</pre><p>å˜é‡çš„å€¼åŒ…æ‹¬<a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1047" class="indexterm"></a>èµ‹å€¼ç¬¦å·å³ä¾§çš„æ‰€æœ‰å•è¯ï¼Œå‰å¯¼ç©ºæ ¼è¢«ä¿®å‰ªã€‚å°¾éšç©ºæ ¼ä¸ä¼šè¢«ä¿®å‰ªã€‚è¿™æœ‰æ—¶ä¼šå¯¼è‡´é—®é¢˜ï¼Œä¾‹å¦‚ï¼Œå¦‚æžœå˜é‡ä¸­åŒ…å«å°¾éšç©ºæ ¼å¹¶éšåŽåœ¨å‘½ä»¤è„šæœ¬ä¸­ä½¿ç”¨ï¼š</p><p>The value of a variable consists of <a class="indexterm"></a>all the words to the right of the assignment symbol with
      leading space trimmed. Trailing spaces are not trimmed. This can
      occasionally cause trouble, for instance, if the trailing whitespace is
      included in the variable and subsequently used in a command
      script:</p><a id="OEBPS/ch03.html.I_3_tt107"></a><pre class="programlisting">LIBRARY = libio.a # LIBRARY æœ‰ä¸€ä¸ªå°¾éšç©ºæ ¼ã€‚
ç¼ºå¤±æ–‡ä»¶ï¼š
        è§¦æ‘¸$(å›¾ä¹¦é¦†)
        ls -l | grep '$(åº“)'</pre><pre class="programlisting">LIBRARY = libio.a # LIBRARY has a trailing space.
missing_file:
        touch $(LIBRARY)
        ls -l | grep '$(LIBRARY)'</pre><p>å˜é‡èµ‹å€¼åŒ…å«ä¸€ä¸ªå°¾éšç©ºæ ¼ï¼Œè¯¥ç©ºæ ¼é€šè¿‡æ³¨é‡Šå˜å¾—æ›´åŠ æ˜Žæ˜¾ï¼ˆä½†å°¾éšç©ºæ ¼ä¹Ÿå¯ä»¥åœ¨æ²¡æœ‰å°¾éšæ³¨é‡Šçš„æƒ…å†µä¸‹å‡ºçŽ°ï¼‰ã€‚å½“è¿™ä¸ª<em class="filename">makefile</em>è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š</p><p>The variable assignment contains a trailing space that is made
      more apparent by the comment (but a trailing space can also be present
      without a trailing comment). When this <em class="filename">makefile</em> is run, we get:</p><a id="OEBPS/ch03.html.I_3_tt108"></a><pre class="programlisting">$ åˆ¶ä½œ
è§¦æ‘¸libio.a
ls -l | grep 'libio.a'
make: *** [missing_file] é”™è¯¯ 1</pre><pre class="programlisting">$ make
touch libio.a 
ls -l | grep 'libio.a '
make: *** [missing_file] Error 1</pre><p>ç³Ÿç³•ï¼Œ<em class="command">grep</em>æœç´¢å­—ç¬¦ä¸²è¿˜åŒ…å«å°¾éšç©ºæ ¼ï¼Œæ— æ³•åœ¨<em class="command">ls</em>çš„è¾“å‡ºä¸­æ‰¾åˆ°è¯¥æ–‡ä»¶ã€‚ç¨åŽæˆ‘ä»¬å°†æ›´è¯¦ç»†åœ°è®¨è®ºç©ºç™½é—®é¢˜ã€‚çŽ°åœ¨ï¼Œè®©æˆ‘ä»¬æ›´ä»”ç»†åœ°çœ‹çœ‹å˜é‡ã€‚</p><p>Oops, the <em class="command">grep</em> search string
      also included the trailing space and failed to find the file in <em class="command">ls</em>'s output. We'll discuss whitespace issues
      in more detail later. For now, let's look more closely at
      variables.</p><div class="sect1" title="å˜é‡çš„ç”¨é€”"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch03.html.make3-CHP-3-SECT-1"></a>å˜é‡çš„ç”¨é€”</h1><h1 class="title"><a></a>What Variables Are Used For</h1></div></div></div><p>ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨<a id="OEBPS/ch03.html.make3-CHP-3-ITERM-1048" class="indexterm"></a>ä»£è¡¨å¤–éƒ¨ç¨‹åºçš„å˜é‡ã€‚è¿™ä½¿å¾—<em class="filename">makefile</em>çš„ç”¨æˆ·å¯ä»¥æ›´è½»æ¾åœ°ä½¿<em class="filename">makefile</em>é€‚åº”å…¶ç‰¹å®šçŽ¯å¢ƒã€‚ä¾‹å¦‚ï¼Œç³»ç»Ÿä¸Š
        é€šå¸¸æœ‰å¤šä¸ªç‰ˆæœ¬çš„<em class="command">awk ï¼š </em><em class="command">awk</em>ã€<em class="command">nawk</em>ã€<em class="command">gawk</em>ã€‚é€šè¿‡åˆ›å»ºå˜é‡æ¥ä¿å­˜<em class="command">awk</em><code class="literal">AWK</code>ç¨‹åºçš„åç§°ï¼Œå¯ä»¥è®©å…¶ä»–ç”¨æˆ·æ›´è½»æ¾åœ°ä½¿ç”¨<em class="filename">makefile</em>ã€‚æ­¤å¤–ï¼Œå¦‚æžœæ‚¨çš„çŽ¯å¢ƒä¸­å­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œæœ€å¥½çš„åšæ³•æ˜¯ä½¿ç”¨ç»å¯¹è·¯å¾„è®¿é—®å¤–éƒ¨ç¨‹åºï¼Œä»¥é¿å…ç”¨æˆ·è·¯å¾„å‡ºçŽ°é—®é¢˜ã€‚å¦‚æžœç³»ç»Ÿç¨‹åºçš„ç‰¹æ´›ä¼Šæœ¨é©¬ç‰ˆæœ¬å·²å®‰è£…åœ¨ç”¨æˆ·è·¯å¾„ä¸­çš„æŸä¸ªä½ç½®ï¼Œç»å¯¹è·¯å¾„è¿˜å¯ä»¥å‡å°‘å‡ºçŽ°é—®é¢˜çš„å¯èƒ½æ€§ã€‚å½“ç„¶ï¼Œç»å¯¹è·¯å¾„ä¹Ÿä½¿å¾—<em class="filename">makefile</em>ä¸æ˜“ç§»æ¤åˆ°å…¶ä»–ç³»ç»Ÿã€‚æ‚¨è‡ªå·±çš„è¦æ±‚åº”è¯¥æŒ‡å¯¼æ‚¨çš„é€‰æ‹©ã€‚<em class="command"></em><em class="filename"></em><em class="filename"></em></p><p>In general it is a good idea to use <a class="indexterm"></a>variables to represent external programs. This allows
        users of the <em class="filename">makefile</em> to more
        easily adapt the <em class="filename">makefile</em> to
        their specific environment. For instance, there are often several
        versions of <em class="command">awk</em> on a system:
        <em class="command">awk</em>, <em class="command">nawk</em>, <em class="command">gawk</em>. By creating a variable, <code class="literal">AWK</code>, to hold the name of the <em class="command">awk</em> program you make it easier for other
        users of your <em class="filename">makefile</em>. Also, if
        security is an issue in your environment, a good practice is to access
        external programs with absolute paths to avoid problems with user's
        paths. Absolute paths also reduce the likelihood of issues if trojan
        horse versions of system programs have been installed somewhere in a
        user's path. Of course, absolute paths also make <em class="filename">makefile</em>s less portable to other systems.
        Your own requirements should guide your choice.</p><p>è™½ç„¶å˜é‡çš„ç¬¬ä¸€æ¬¡ä½¿ç”¨åº”è¯¥æ˜¯ä¿å­˜ç®€å•çš„å¸¸é‡ï¼Œä½†å®ƒä»¬ä¹Ÿå¯ä»¥å­˜å‚¨ç”¨æˆ·å®šä¹‰çš„å‘½ä»¤åºåˆ—ï¼Œä¾‹å¦‚ï¼š<sup>[ <a id="OEBPS/ch03.html.make3-CHP-3-FNOTE-1" href="#OEBPS/ch03.html.ftn.make3-CHP-3-FNOTE-1" class="footnote">1</a> ]</sup></p><p>Though your first use of variables should be to hold simple
        constants, they can also store user-defined command sequences such
        as:<sup>[<a href="#OEBPS/ch03.html.ftn.make3-CHP-3-FNOTE-1" class="footnote">1</a>]</sup></p><a id="OEBPS/ch03.html.I_3_tt109"></a><pre class="programlisting">DF=DF
AWK = awk
è‡ªç”±ç©ºé—´ := $(DF) ã€‚ | $(AWK) 'NR == 2 { æ‰“å° $$4 }'</pre><pre class="programlisting">DF  = df
AWK = awk
free-space := $(DF) . | $(AWK) 'NR =  = 2 { print $$4 }'</pre><p>ç”¨äºŽæŠ¥å‘Šå¯ç”¨ç£ç›˜ç©ºé—´ã€‚æ­£å¦‚æˆ‘ä»¬å°†çœ‹åˆ°çš„ï¼Œå˜é‡ç”¨äºŽè¿™äº›ç›®çš„ä»¥åŠæ›´å¤šç›®çš„ã€‚</p><p>for reporting on free disk space. Variables are used for both
        these purposes and more, as we will see.</p></div><div class="footnotes"><br><br><hr><div class="footnote"><p><sup>[ <a id="OEBPS/ch03.html.ftn.make3-CHP-3-FNOTE-1" href="#OEBPS/ch03.html.make3-CHP-3-FNOTE-1" class="para">1</a> ] </sup><em class="command">df</em>å‘½ä»¤è¿”å›žæ¯ä¸ªå·²å®‰è£…æ–‡ä»¶ç³»ç»Ÿçš„åˆ—è¡¨ä»¥åŠæ–‡ä»¶ç³»ç»Ÿå®¹é‡å’Œä½¿ç”¨æƒ…å†µçš„ç»Ÿè®¡ä¿¡æ¯ã€‚é€šè¿‡å‚æ•°ï¼Œå®ƒå¯ä»¥æ‰“å°æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿçš„ç»Ÿè®¡ä¿¡æ¯ã€‚è¾“å‡ºçš„ç¬¬ä¸€è¡Œæ˜¯åˆ—æ ‡é¢˜çš„åˆ—è¡¨ã€‚æ­¤è¾“å‡ºç”±<em class="command">awk</em>è¯»å–ï¼Œå®ƒæ£€æŸ¥ç¬¬äºŒè¡Œå¹¶å¿½ç•¥æ‰€æœ‰å…¶ä»–è¡Œã€‚<em class="command">df</em>è¾“å‡ºçš„ç¬¬å››åˆ—æ˜¯å—ä¸­çš„å‰©ä½™å¯ç”¨ç©ºé—´ã€‚</p><p><sup>[<a href="#OEBPS/ch03.html.make3-CHP-3-FNOTE-1" class="para">1</a>] </sup>The <em class="command">df</em> command returns a
            list of each mounted filesystem and statistics on the filesystem's
            capacity and usage. With an argument, it prints statistics for the
            specified filesystem. The first line of the output is a list of
            column titles. This output is read by <em class="command">awk</em> which examines the second line and
            ignores all others. Column four of <em class="command">df</em>'s output is the remaining free space
            in blocks.</p></div></div></div></div></div>
<div id="OEBPS/ch03s02.html"><div>
<div class="sect1" title="å˜é‡ç±»åž‹"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch03s02.html.make3-CHP-3-SECT-2"></a>å˜é‡ç±»åž‹</h1><h1 class="title"><a></a>Variable Types</h1></div></div></div><p>æœ‰ä¸¤ç§ç±»åž‹<a id="OEBPS/ch03s02.html.make3-CHP-3-ITERM-1049" class="indexterm"></a> <a id="OEBPS/ch03s02.html.make3-CHP-3-ITERM-1050" class="indexterm"></a> <a id="OEBPS/ch03s02.html.make3-CHP-3-ITERM-1051" class="indexterm"></a> <a id="OEBPS/ch03s02.html.make3-CHP-3-ITERM-1052" class="indexterm"></a><em class="command">make</em>ä¸­çš„å˜é‡ï¼šç®€å•æ‰©å±•å˜é‡å’Œé€’å½’æ‰©å±•å˜é‡ã€‚ä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦å®šä¹‰<em class="firstterm">ç®€å•æ‰©å±•</em>å˜é‡
        ï¼ˆæˆ–ç®€å•å˜é‡ï¼‰<code class="literal">:=</code>ï¼š</p><p>There are two types of <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>variables in <em class="command">make</em>:
        simply expanded variables and recursively expanded variables. A
        <em class="firstterm">simply expanded</em> variable (or a simple variable)
        is defined using the <code class="literal">:=</code> assignment
        operator:</p><a id="OEBPS/ch03s02.html.I_3_tt110"></a><pre class="programlisting">MAKE_DEPEND := $(CC) -M</pre><pre class="programlisting">MAKE_DEPEND := $(CC) -M</pre><p>å®ƒè¢«ç§°ä¸ºâ€œç®€å•æ‰©å±•â€ï¼Œå› ä¸ºå®ƒçš„å³ä¾§åœ¨ä»Ž<em class="filename">makefile</em>è¯»å–è¯¥è¡ŒåŽç«‹å³æ‰©å±•ã€‚å³ä¾§çš„ä»»ä½•<em class="command">make</em>å˜é‡å¼•ç”¨éƒ½ä¼šå±•å¼€ï¼Œå¹¶å°†ç”Ÿæˆçš„æ–‡æœ¬ä¿å­˜ä¸ºå˜é‡çš„å€¼ã€‚æ­¤è¡Œä¸ºä¸Žå¤§å¤šæ•°ç¼–ç¨‹å’Œè„šæœ¬è¯­è¨€ç›¸åŒã€‚ä¾‹å¦‚ï¼Œè¯¥å˜é‡çš„æ­£å¸¸æ‰©å±•å°†äº§ç”Ÿï¼š</p><p>It is called "simply expanded" because its righthand side is
        expanded immediately upon reading the line from the <em class="filename">makefile</em>. Any <em class="command">make</em> variable references in the righthand
        side are expanded and the resulting text saved as the value of the
        variable. This behavior is identical to most programming and scripting
        languages. For instance, the normal expansion of this variable would
        yield:</p><a id="OEBPS/ch03s02.html.I_3_tt111"></a><pre class="programlisting">æµ·æ¹¾åˆä½œå§”å‘˜ä¼š-M</pre><pre class="programlisting">gcc -M</pre><p>ä½†æ˜¯ï¼Œå¦‚æžœ<code class="literal">CC</code>å°šæœªè®¾ç½®ä¸Šè¿°å†…å®¹ï¼Œåˆ™ä¸Šè¿°èµ‹å€¼çš„å€¼ä¸ºï¼š</p><p>However, if <code class="literal">CC</code> above had not
        yet been set, then the value of the above assignment would be:</p><a id="OEBPS/ch03s02.html.I_3_tt112"></a><pre class="programlisting">&lt;ç©ºæ ¼&gt;-M</pre><pre class="programlisting">&lt;space&gt;-M</pre><p><code class="literal">$(CC)</code>æ‰©å±•ä¸ºå…¶å€¼ï¼ˆä¸åŒ…å«å­—ç¬¦ï¼‰ï¼Œç„¶åŽæŠ˜å ä¸ºç©ºã€‚å˜é‡æ²¡æœ‰å®šä¹‰å¹¶ä¸æ˜¯é”™è¯¯ã€‚äº‹å®žä¸Šï¼Œè¿™æ˜¯éžå¸¸æœ‰ç”¨çš„ã€‚å¤§å¤šæ•°éšå¼å‘½ä»¤éƒ½åŒ…å«æœªå®šä¹‰çš„å˜é‡ï¼Œè¿™äº›å˜é‡å……å½“ç”¨æˆ·è‡ªå®šä¹‰çš„å ä½ç¬¦ã€‚å¦‚æžœç”¨æˆ·ä¸è‡ªå®šä¹‰å˜é‡ï¼Œå®ƒå°±ä¼šå´©æºƒã€‚çŽ°åœ¨æ³¨æ„å‰å¯¼ç©ºæ ¼ã€‚é¦–å…ˆç”±<em class="command">make</em>è§£æžå³ä¾§ä»¥ç”Ÿæˆå­—ç¬¦ä¸²<code class="literal">$(CC) -M</code>ã€‚å½“å˜é‡å¼•ç”¨æŠ˜å ä¸ºç©ºæ—¶ï¼Œ<em class="command">make</em>ä¸ä¼šé‡æ–°æ‰«æè¯¥å€¼å¹¶ä¿®å‰ªç©ºç™½ã€‚ç©ºç™½ä¿æŒåŽŸæ ·ã€‚</p><p><code class="literal">$(CC)</code> is expanded to its
        value (which contains no characters), and collapses to nothing. It is
        not an error for a variable to have no definition. In fact, this is
        extremely useful. Most of the implicit commands include undefined
        variables that serve as place holders for user customizations. If the
        user does not customize a variable it collapses to nothing. Now notice
        the leading space. The righthand side is first parsed by <em class="command">make</em> to yield the string <code class="literal">$(CC) -M</code>. When the variable reference is
        collapsed to nothing, <em class="command">make</em> does not
        rescan the value and trim blanks. The blanks are left intact.</p><p>ç¬¬äºŒç§ç±»åž‹çš„å˜é‡ç§°ä¸ºé€’å½’æ‰©å±•å˜é‡ã€‚<em class="firstterm">é€’å½’æ‰©å±•</em>å˜é‡ï¼ˆæˆ–é€’å½’å˜é‡ï¼‰æ˜¯ä½¿ç”¨<code class="literal">=</code>èµ‹å€¼è¿ç®—ç¬¦å®šä¹‰çš„ï¼š</p><p>The second type of variable is called a recursively expanded
        variable. A <em class="firstterm">recursively expanded</em> variable (or a
        recursive variable) is defined using the <code class="literal">=</code> assignment operator:</p><a id="OEBPS/ch03s02.html.I_3_tt113"></a><pre class="programlisting">MAKE_DEPEND = $(CC) -M</pre><pre class="programlisting">MAKE_DEPEND = $(CC) -M</pre><p><em class="command">å®ƒè¢«ç§°ä¸ºâ€œé€’å½’æ‰©å±•â€ï¼Œå› ä¸ºå®ƒçš„å³ä¾§åªæ˜¯è¢«make</em>å¸æ”¶å¹¶å­˜å‚¨ä¸ºå˜é‡çš„å€¼ï¼Œè€Œä¸ä»¥ä»»ä½•æ–¹å¼è¯„ä¼°æˆ–æ‰©å±•å®ƒã€‚ç›¸åï¼Œæ‰©å±•æ˜¯åœ¨
        <span class="emphasis"><em>ä½¿ç”¨</em></span>å˜é‡æ—¶æ‰§è¡Œçš„ã€‚è¯¥å˜é‡çš„æ›´å¥½æœ¯è¯­å¯èƒ½æ˜¯
        <span class="emphasis"><em>å»¶è¿Ÿæ‰©å±•</em></span>å˜é‡ï¼Œå› ä¸ºè¯„ä¼°è¢«æŽ¨è¿Ÿåˆ°å®žé™…ä½¿ç”¨æ—¶ã€‚è¿™ç§æ‰©å±•æ–¹å¼çš„ä¸€ä¸ªä»¤äººæƒŠè®¶çš„æ•ˆæžœæ˜¯èµ‹å€¼å¯ä»¥â€œä¹±åºâ€æ‰§è¡Œï¼š</p><p>It is called "recursively expanded" because its righthand side
        is simply slurped up by <em class="command">make</em> and
        stored as the value of the variable without evaluating or expanding it
        in any way. Instead, the expansion is performed when the variable is
        <span class="emphasis"><em>used</em></span>. A better term for this variable might be
        <span class="emphasis"><em>lazily expanded</em></span> variable, since the evaluation is
        deferred until it is actually used. One surprising effect of this
        style of expansion is that assignments can be performed "out of
        order":</p><a id="OEBPS/ch03s02.html.I_3_tt114"></a><pre class="programlisting">MAKE_DEPEND = $(CC) -M
...
ï¼ƒ ä¸€æ®µæ—¶é—´ä¹‹åŽ
CC = æµ·æ¹¾åˆä½œå§”å‘˜ä¼š</pre><pre class="programlisting">MAKE_DEPEND = $(CC) -M
...
# Some time later
CC = gcc</pre><p><code class="literal">MAKE_DEPEND</code>
        è¿™é‡Œå‘½ä»¤è„šæœ¬ä¸­çš„å€¼æ˜¯<em class="command">gcc -Mï¼Œ</em>
        å³ä½¿åœ¨åˆ†é…<code class="literal">CC</code>æ—¶æœªå®šä¹‰
        ã€‚<code class="literal">MAKE_DEPEND</code></p><p>Here the value of <code class="literal">MAKE_DEPEND</code>
        within a command script is <em class="command">gcc -M</em>
        even though <code class="literal">CC</code> was undefined when
        <code class="literal">MAKE_DEPEND</code> was assigned.</p><p>äº‹å®žä¸Šï¼Œé€’å½’å˜é‡å®žé™…ä¸Šä¸ä»…ä»…æ˜¯ä¸€ä¸ªæƒ°æ€§èµ‹å€¼ï¼ˆè‡³å°‘ä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„æƒ°æ€§èµ‹å€¼ï¼‰ã€‚æ¯æ¬¡ä½¿ç”¨é€’å½’å˜é‡æ—¶ï¼Œéƒ½ä¼šé‡æ–°è¯„ä¼°å…¶å³ä¾§ã€‚å¯¹äºŽåƒä¸Šé¢è¿™æ ·çš„ç®€å•å¸¸é‡å®šä¹‰çš„å˜é‡
        <code class="literal">MAKE_DEPEND</code>ï¼Œè¿™ç§åŒºåˆ«æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºå³ä¾§çš„æ‰€æœ‰å˜é‡ä¹Ÿæ˜¯ç®€å•å¸¸é‡ã€‚ä½†æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æžœå³ä¾§çš„å˜é‡ä»£è¡¨ç¨‹åºçš„æ‰§è¡Œï¼Œä¾‹å¦‚<em class="command">date</em>ã€‚æ¯æ¬¡æ‰©å±•é€’å½’å˜é‡æ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œ<em class="command">æ—¥æœŸ</em>ç¨‹åºï¼Œå¹¶ä¸”æ¯ä¸ªå˜é‡æ‰©å±•å°†å…·æœ‰ä¸åŒçš„å€¼ï¼ˆå‡è®¾å®ƒä»¬è‡³å°‘ç›¸éš”ä¸€ç§’æ‰§è¡Œï¼‰ã€‚æœ‰æ—¶è¿™éžå¸¸æœ‰ç”¨ã€‚å…¶ä»–æ—¶å€™ä¹Ÿå¾ˆçƒ¦äººï¼</p><p>In fact, recursive variables aren't really just a lazy
        assignment (at least not a normal lazy assignment). Each time the
        recursive variable is used, its righthand side is re-evaluated. For
        variables that are defined in terms of simple constants such as
        <code class="literal">MAKE_DEPEND</code> above, this distinction
        is pointless since all the variables on the righthand side are also
        simple constants. But imagine if a variable in the righthand side
        represented the execution of a program, say <em class="command">date</em>. Each time the recursive variable was
        expanded the <em class="command">date</em> program would be
        executed and each variable expansion would have a different value
        (assuming they were executed at least one second apart). At times this
        is very useful. At other times it is very annoying!</p><div class="sect2" title="å…¶ä»–ç±»åž‹çš„ä½œä¸š"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch03s02.html.make3-CHP-3-SECT-2.1"></a>å…¶ä»–ç±»åž‹çš„ä½œä¸š</h2><h2 class="title"><a></a>Other Types of Assignment</h2></div></div></div><p>ä»Žå‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸¤ç§ç±»åž‹çš„èµ‹å€¼ï¼š
          <code class="literal">=</code>ç”¨äºŽåˆ›å»ºé€’å½’å˜é‡å’Œ<code class="literal">:=</code>ç”¨äºŽåˆ›å»ºç®€å•å˜é‡ã€‚<em class="command">make</em>è¿˜æä¾›äº†å¦å¤–ä¸¤ä¸ªèµ‹å€¼è¿ç®—ç¬¦ã€‚</p><p>From previous examples we've seen two types of assignment:
          <code class="literal">=</code> for creating recursive
          variables and <code class="literal">:=</code> for creating
          simple variables. There are two other assignment operators provided
          by <em class="command">make</em>.</p><p>è¿è¥<code class="literal">?=</code>å•†æ˜¯
          <a id="OEBPS/ch03s02.html.make3-CHP-3-ITERM-1053" class="indexterm"></a> <a id="OEBPS/ch03s02.html.make3-CHP-3-ITERM-1054" class="indexterm"></a> <a id="OEBPS/ch03s02.html.make3-CHP-3-ITERM-1055" class="indexterm"></a>ç§°ä¸º<em class="firstterm">æ¡ä»¶å˜é‡èµ‹å€¼è¿ç®—ç¬¦</em>ã€‚è¿™å®žåœ¨æ˜¯å¤ªç»•å£äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç§°ä¹‹ä¸ºæ¡ä»¶èµ‹å€¼ã€‚ä»…å½“å˜é‡å°šæ— å€¼æ—¶ï¼Œè¯¥è¿ç®—ç¬¦æ‰ä¼šæ‰§è¡Œè¯·æ±‚çš„å˜é‡èµ‹å€¼ã€‚</p><p>The <code class="literal">?=</code> operator is
          <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>called the <em class="firstterm">conditional variable assignment
          operator</em>. That's quite a mouth-full so we'll just call
          it conditional assignment. This operator will perform the requested
          variable assignment only if the variable does not yet have a
          value.</p><a id="OEBPS/ch03s02.html.I_3_tt115"></a><pre class="programlisting"># å°†æ‰€æœ‰ç”Ÿæˆçš„æ–‡ä»¶æ”¾å…¥ç›®å½•$(PROJECT_DIR)/outä¸­ã€‚
OUTPUT_DIR ?= $(PROJECT_DIR)/out</pre><pre class="programlisting"># Put all generated files in the directory $(PROJECT_DIR)/out.
OUTPUT_DIR ?= $(PROJECT_DIR)/out</pre><p>è¿™é‡Œæˆ‘ä»¬è®¾ç½®è¾“å‡ºç›®å½•å˜é‡ ï¼Œ<code class="literal">OUTPUT_DIR</code>ä»…å½“å®ƒä¹‹å‰æ²¡æœ‰è®¾ç½®è¿‡æ—¶ã€‚æ­¤åŠŸèƒ½ä¸ŽçŽ¯å¢ƒå˜é‡å¯ä»¥å¾ˆå¥½åœ°äº¤äº’ã€‚æˆ‘ä»¬å°†åœ¨æœ¬ç« åŽé¢çš„<a class="link" href="#OEBPS/ch03s06.html" title="å˜é‡ä»Žä½•è€Œæ¥">3.6 èŠ‚</a>ä¸­è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚</p><p>Here we set the output directory variable, <code class="literal">OUTPUT_DIR</code>, only if it hasn't been set
          earlier. This feature interacts nicely with environment variables.
          We'll discuss this in <a class="link" href="#OEBPS/ch03s06.html" title="Where Variables Come From">Section
          3.6</a> later in this chapter.</p><p>å¦ä¸€ä¸ªèµ‹å€¼è¿ç®—ç¬¦ï¼Œ<code class="literal">+=</code> <a id="OEBPS/ch03s02.html.make3-CHP-3-ITERM-1056" class="indexterm"></a> <a id="OEBPS/ch03s02.html.make3-CHP-3-ITERM-1057" class="indexterm"></a> <a id="OEBPS/ch03s02.html.make3-CHP-3-ITERM-1058" class="indexterm"></a>ï¼Œé€šå¸¸ç§°ä¸º
          <em class="firstterm">è¿½åŠ </em>ã€‚é¡¾åæ€ä¹‰ï¼Œè¯¥è¿ç®—ç¬¦å°†æ–‡æœ¬é™„åŠ åˆ°å˜é‡ä¸­ã€‚è¿™å¯èƒ½çœ‹èµ·æ¥ä¸èµ·çœ¼ï¼Œä½†åœ¨ä½¿ç”¨é€’å½’å˜é‡æ—¶è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„ç‰¹æ€§ã€‚å…·ä½“æ¥è¯´ï¼Œèµ‹å€¼å³ä¾§çš„å€¼å°†é™„åŠ åˆ°å˜é‡ä¸­<span class="emphasis"><em>ï¼Œè€Œä¸æ›´æ”¹å˜é‡ä¸­çš„åŽŸå§‹å€¼</em></span>ã€‚ â€œæœ‰ä»€ä¹ˆå¤§ä¸äº†çš„ï¼Œappend ä¸å°±æ˜¯è¿™ä¹ˆåšçš„å—ï¼Ÿâ€æˆ‘å¬åˆ°ä½ è¯´ã€‚æ˜¯çš„ï¼Œä½†æ˜¯ç­‰ç­‰ï¼Œè¿™æœ‰ç‚¹æ£˜æ‰‹ã€‚</p><p>The other assignment operator, <code class="literal">+=</code> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>, is usually referred to as
          <em class="firstterm">append</em>. As its name suggests, this operator
          appends text to a variable. This may seem unremarkable, but it is an
          important feature when recursive variables are used. Specifically,
          values on the righthand side of the assignment are appended to the
          variable <span class="emphasis"><em>without changing the original values in the
          variable</em></span>. "Big deal, isn't that what append always does?"
          I hear you say. Yes, but hold on, this is a little tricky.</p><p>é™„åŠ åˆ°ä¸€ä¸ªç®€å•çš„å˜é‡æ˜¯éžå¸¸æ˜Žæ˜¾çš„ã€‚è¯¥<code class="literal">+=</code>è¿ç®—ç¬¦å¯ä»¥è¿™æ ·å®žçŽ°ï¼š</p><p>Appending to a simple variable is pretty obvious. The <code class="literal">+=</code> operator might be implemented like
          this:</p><a id="OEBPS/ch03s02.html.I_3_tt116"></a><pre class="programlisting">ç®€å• := $(ç®€å•) æ–°ä¸œè¥¿</pre><pre class="programlisting">simple := $(simple) new stuff</pre><p>ç”±äºŽç®€å•å˜é‡ä¸­çš„å€¼å·²ç»è¿›è¡Œäº†æ‰©å±•ï¼Œ<em class="command">å› æ­¤ make</em>å¯ä»¥æ‰©å±•
          <code class="literal">$(simple)</code>ã€è¿½åŠ æ–‡æœ¬å¹¶å®Œæˆèµ‹å€¼ã€‚ä½†é€’å½’å˜é‡ä¼šå¸¦æ¥é—®é¢˜ã€‚ä¸å…è®¸åƒä¸‹é¢è¿™æ ·çš„å®žçŽ°ã€‚</p><p>Since the value in the simple variable has already undergone
          expansion, <em class="command">make</em> can expand
          <code class="literal">$(simple)</code>, append the text, and
          finish the assignment. But recursive variables pose a problem. An
          implementation like the following isn't allowed.</p><a id="OEBPS/ch03s02.html.I_3_tt117"></a><pre class="programlisting">é€’å½’ = $(é€’å½’) æ–°ä¸œè¥¿</pre><pre class="programlisting">recursive = $(recursive) new stuff</pre><p><em class="command">è¿™æ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸ºmake</em>æ²¡æœ‰å¥½çš„æ–¹æ³•æ¥å¤„ç†å®ƒã€‚å¦‚æžœ<em class="command">make</em><code class="literal">recursive</code>å­˜å‚¨äº†plusçš„å½“å‰å®šä¹‰
          <code class="literal">new stuff</code>ï¼Œ<em class="command">åˆ™ make</em>æ— æ³•åœ¨è¿è¡Œæ—¶å†æ¬¡æ‰©å±•å®ƒã€‚æ­¤å¤–ï¼Œå°è¯•æ‰©å±•åŒ…å«å¯¹å…¶è‡ªèº«çš„å¼•ç”¨çš„é€’å½’å˜é‡ä¼šäº§ç”Ÿæ— é™å¾ªçŽ¯ã€‚</p><p>This is an error because there's no good way for <em class="command">make</em> to handle it. If <em class="command">make</em> stores the current definition of
          <code class="literal">recursive</code> plus <code class="literal">new stuff</code>, <em class="command">make</em> can't expand it again at runtime.
          Furthermore, attempting to expand a recursive variable containing a
          reference to itself yields an infinite loop.</p><a id="OEBPS/ch03s02.html.I_3_tt118"></a><pre class="programlisting">$ <strong class="userinput"><code>make</code></strong>
makefile:2: *** é€’å½’å˜é‡â€œrecursiveâ€å¼•ç”¨è‡ªèº«ï¼ˆæœ€ç»ˆï¼‰ã€‚åœæ­¢ã€‚</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
makefile:2: *** Recursive variable `recursive' references itself (eventually).  Stop.</pre><p>å› æ­¤ï¼Œ<code class="literal">+=</code>ä¸“é—¨å®žçŽ°äº†å…è®¸å°†æ–‡æœ¬æ·»åŠ åˆ°é€’å½’å˜é‡å¹¶æ‰§è¡Œæ­£ç¡®çš„æ“ä½œÂ©ã€‚è¯¥è¿ç®—ç¬¦å¯¹äºŽä»¥å¢žé‡æ–¹å¼å°†å€¼æ”¶é›†åˆ°å˜é‡ä¸­ç‰¹åˆ«æœ‰ç”¨ã€‚</p><p>So, <code class="literal">+=</code> was implemented
          specifically to allow adding text to a recursive variable and does
          the Right ThingÂ©. This operator is particularly useful for
          collecting values into a variable incrementally.</p></div></div></div></div>
<div id="OEBPS/ch03s03.html"><div>
<div class="sect1" title="å®"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch03s03.html.make3-CHP-3-SECT-3"></a>å®</h1><h1 class="title"><a></a>Macros</h1></div></div></div><p>å˜é‡é€‚åˆ<a id="OEBPS/ch03s03.html.make3-CHP-3-ITERM-1059" class="indexterm"></a>å°†å€¼å­˜å‚¨ä¸ºå•è¡Œæ–‡æœ¬ï¼Œä½†æ˜¯å¦‚æžœæˆ‘ä»¬æœ‰ä¸€ä¸ªå¤šè¡Œå€¼ï¼ˆä¾‹å¦‚æˆ‘ä»¬æƒ³è¦åœ¨å¤šä¸ªä½ç½®æ‰§è¡Œçš„å‘½ä»¤è„šæœ¬ï¼‰æ€Žä¹ˆåŠžï¼Ÿä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åºåˆ—
        ä»Ž Java ç±»æ–‡ä»¶åˆ›å»º Java å½’æ¡£æ–‡ä»¶ï¼ˆæˆ–<em class="firstterm">jar ï¼‰ï¼š</em></p><p>Variables are fine for <a class="indexterm"></a>storing values as a single line of text, but what if we
        have a multiline value such as a command script we would like to
        execute in several places? For instance, the following sequence of
        commands might be used to create a Java archive (or
        <em class="firstterm">jar</em>) from Java class files:</p><a id="OEBPS/ch03s03.html.I_3_tt119"></a><pre class="programlisting">å›žå£°æ­£åœ¨åˆ›å»º$@...
$(RM) $(TMP_JAR_DIR)
$(MKDIR) $(TMP_JAR_DIR)
$(CP) -r $^ $(TMP_JAR_DIR)
cd $(TMP_JAR_DIR) &amp;&amp; $(JAR) $(JARFLAGS) $@ .
$(JAR) -ufm $@ $(æ¸…å•)
$(RM) $(TMP_JAR_DIR)</pre><pre class="programlisting">echo Creating $@...
$(RM) $(TMP_JAR_DIR)
$(MKDIR) $(TMP_JAR_DIR)
$(CP) -r $^ $(TMP_JAR_DIR)
cd $(TMP_JAR_DIR) &amp;&amp; $(JAR) $(JARFLAGS) $@ .
$(JAR) -ufm $@ $(MANIFEST)
$(RM) $(TMP_JAR_DIR)</pre><p>åœ¨è¿™æ ·çš„é•¿åºåˆ—çš„å¼€å¤´ï¼Œæˆ‘å–œæ¬¢æ‰“å°ä¸€æ¡ç®€çŸ­çš„æ¶ˆæ¯ã€‚å®ƒå¯ä»¥ä½¿é˜…è¯»<em class="command">make</em>çš„è¾“å‡ºå˜å¾—æ›´åŠ å®¹æ˜“ã€‚æ”¶åˆ°æ¶ˆæ¯åŽï¼Œæˆ‘ä»¬å°†ç±»æ–‡ä»¶æ”¶é›†åˆ°ä¸€ä¸ªå¹²å‡€çš„ä¸´æ—¶ç›®å½•ä¸­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åˆ é™¤ä¸´æ—¶<span class="emphasis"><em>jar</em></span>ç›®å½•ï¼Œä»¥é˜²æ—§çš„ jar ç›®å½•è¢«é—å¼ƒï¼Œ<sup>[ <a id="OEBPS/ch03s03.html.make3-CHP-3-FNOTE-2" href="#OEBPS/ch03s03.html.ftn.make3-CHP-3-FNOTE-2" class="footnote">2</a> ]</sup>ç„¶åŽæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸´æ—¶ç›®å½•ã€‚æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å¿…å¤‡æ–‡ä»¶ï¼ˆåŠå…¶æ‰€æœ‰å­ç›®å½•ï¼‰å¤åˆ¶åˆ°ä¸´æ—¶ç›®å½•ä¸­ã€‚ç„¶åŽæˆ‘ä»¬åˆ‡æ¢åˆ°ä¸´æ—¶ç›®å½•å¹¶ä½¿ç”¨ç›®æ ‡æ–‡ä»¶ååˆ›å»º jarã€‚æˆ‘ä»¬å°†æ¸…å•æ–‡ä»¶æ·»åŠ åˆ° jar ä¸­ï¼Œæœ€åŽè¿›è¡Œæ¸…ç†ã€‚æ˜¾ç„¶ï¼Œæˆ‘ä»¬ä¸æƒ³åœ¨<em class="filename">makefile</em>ä¸­é‡å¤è¿™ä¸€ç³»åˆ—å‘½ä»¤ï¼Œå› ä¸ºè¿™å°†æˆä¸ºå°†æ¥çš„ç»´æŠ¤é—®é¢˜ã€‚æˆ‘ä»¬å¯èƒ½ä¼šè€ƒè™‘å°†æ‰€æœ‰è¿™äº›å‘½ä»¤æ‰“åŒ…åˆ°ä¸€ä¸ªé€’å½’å˜é‡ä¸­ï¼Œä½†æ˜¯å½“<em class="command">make</em>å›žæ˜¾å‘½ä»¤è¡Œæ—¶ï¼Œç»´æŠ¤èµ·æ¥å¾ˆå›°éš¾å¹¶ä¸”éš¾ä»¥é˜…è¯»ï¼ˆæ•´ä¸ªåºåˆ—ä½œä¸ºä¸€å¤§è¡Œæ–‡æœ¬å›žæ˜¾ï¼‰ã€‚</p><p>At the beginning of long sequences such as this, I like to print
        a brief message. It can make reading <em class="command">make</em>'s output much easier. After the
        message, we collect our class files into a clean temporary directory.
        So we delete the temporary <span class="emphasis"><em>jar</em></span> directory in case
        an old one is left lying about,<sup>[<a href="#OEBPS/ch03s03.html.ftn.make3-CHP-3-FNOTE-2" class="footnote">2</a>]</sup> then we create a fresh temporary directory. Next we copy
        our prerequisite files (and all their subdirectories) into the
        temporary directory. Then we switch to our temporary directory and
        create the jar with the target filename. We add the manifest file to
        the jar and finally clean up. Clearly, we do not want to duplicate
        this sequence of commands in our <em class="filename">makefile</em> since that would be a maintenance
        problem in the future. We might consider packing all these commands
        into a recursive variable, but that is ugly to maintain and difficult
        to read when <em class="command">make</em> echoes the
        command line (the whole sequence is echoed as one enormous line of
        text).</p><p>ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a id="OEBPS/ch03s03.html.make3-CHP-3-ITERM-1060" class="indexterm"></a>ç”±æŒ‡ä»¤åˆ›å»ºçš„
        <em class="command">GNU make</em> â€œ<acronym class="acronym">å›ºå®š</acronym> åºåˆ—â€ ã€‚ â€œå›ºå®šåºåˆ—â€è¿™ä¸ªæœ¯è¯­æœ‰ç‚¹å°´å°¬ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å…¶ç§°ä¸º
        <em class="firstterm">å®</em>ã€‚å®åªæ˜¯å®šä¹‰çš„å¦ä¸€ç§æ–¹å¼
        <em class="command"></em><code class="literal">define</code><em class="firstterm"></em><a id="OEBPS/ch03s03.html.make3-CHP-3-ITERM-1061" class="indexterm"></a><em class="command">make</em>ä¸­çš„ä¸€ä¸ªå˜é‡ï¼Œä»¥åŠä¸€ä¸ªå¯ä»¥åŒ…å«åµŒå…¥æ¢è¡Œç¬¦çš„å˜é‡ï¼ GNU <em class="command">make</em>æ‰‹å†Œä¼¼ä¹Žå¯ä»¥äº’æ¢ä½¿ç”¨
        <acronym class="acronym">å˜é‡</acronym>
        <span class="emphasis"><em>å’Œ</em></span>å®<span class="emphasis"><em>è¿™</em></span>ä¸¤ä¸ªè¯
        ã€‚åœ¨æœ¬ä¹¦ä¸­ï¼Œæˆ‘ä»¬å°†ä¸“é—¨ä½¿ç”¨
        <span class="emphasis"><em>â€œå®â€</em></span>ä¸€è¯æ¥è¡¨ç¤ºä½¿ç”¨æŒ‡ä»¤å®šä¹‰çš„å˜é‡ï¼Œå¹¶ä¸”
        ä»…åœ¨ä½¿ç”¨èµ‹å€¼æ—¶æ‰<span class="emphasis"><em>ä½¿ç”¨å˜é‡ã€‚</em></span><em class="command"></em><span class="emphasis"><em></em></span><span class="emphasis"><em></em></span><span class="emphasis"><em></em></span><code class="literal">define</code><span class="emphasis"><em></em></span></p><p>Instead, we can use <a class="indexterm"></a>a <acronym class="acronym">GNU</acronym> <em class="command">make</em> "canned sequence" as created by the
        <code class="literal">define</code> directive. The term "canned
        sequence" is a bit awkward, so we'll call this a
        <em class="firstterm">macro</em>. A macro is just another way of defining
        <a class="indexterm"></a>a variable in <em class="command">make</em>,
        and one that can contain embedded newlines! The <acronym class="acronym">GNU</acronym>
        <em class="command">make</em> manual seems to use the words
        <span class="emphasis"><em>variable</em></span> and <span class="emphasis"><em>macro</em></span>
        interchangeably. In this book, we'll use the word
        <span class="emphasis"><em>macro</em></span> specifically to mean variables defined
        using the <code class="literal">define</code> directive and
        <span class="emphasis"><em>variable</em></span> only when assignment is used.</p><a id="OEBPS/ch03s03.html.I_3_tt120"></a><pre class="programlisting">å®šä¹‰åˆ›å»ºjar
 @echo åˆ›å»º$@...
 $(RM) $(TMP_JAR_DIR)
 $(MKDIR) $(TMP_JAR_DIR)
 $(CP) -r $^ $(TMP_JAR_DIR)
 cd $(TMP_JAR_DIR) &amp;&amp; $(JAR) $(JARFLAGS) $@ .
 $(JAR) -ufm $@ $(æ¸…å•)
 $(RM) $(TMP_JAR_DIR)
æ©å¾·å¤«</pre><pre class="programlisting">define create-jar
 @echo Creating $@...
 $(RM) $(TMP_JAR_DIR)
 $(MKDIR) $(TMP_JAR_DIR)
 $(CP) -r $^ $(TMP_JAR_DIR)
 cd $(TMP_JAR_DIR) &amp;&amp; $(JAR) $(JARFLAGS) $@ .
 $(JAR) -ufm $@ $(MANIFEST)
 $(RM) $(TMP_JAR_DIR)
endef</pre><p>è¯¥<code class="literal">define</code>æŒ‡ä»¤
        <a id="OEBPS/ch03s03.html.make3-CHP-3-ITERM-1062" class="indexterm"></a> <a id="OEBPS/ch03s03.html.make3-CHP-3-ITERM-1063" class="indexterm"></a> <a id="OEBPS/ch03s03.html.make3-CHP-3-ITERM-1064" class="indexterm"></a>åŽé¢è·Ÿç€å®åç§°å’Œæ¢è¡Œç¬¦ã€‚å®çš„ä¸»ä½“åŒ…æ‹¬ç›´åˆ°<a id="OEBPS/ch03s03.html.make3-CHP-3-ITERM-1065" class="indexterm"></a>å…³é”®å­—<code class="literal">endef</code>ï¼Œå¿…é¡»å•ç‹¬å‡ºçŽ°åœ¨ä¸€è¡Œä¸Šã€‚ç”¨åˆ›å»ºçš„å®çš„<code class="literal">define</code>æ‰©å±•æ–¹å¼ä¸Žä»»ä½•å…¶ä»–å˜é‡éžå¸¸ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºŽå½“å®ƒåœ¨å‘½ä»¤è„šæœ¬çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨æ—¶ï¼Œå®çš„æ¯ä¸€è¡Œå‰é¢éƒ½æœ‰ä¸€ä¸ªåˆ¶è¡¨ç¬¦ã€‚ä¸€ä¸ªä½¿ç”¨ç¤ºä¾‹æ˜¯ï¼š</p><p>The <code class="literal">define</code> directive
        <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>is followed by the macro name and a newline. The body of
        the macro includes all the text up to <a class="indexterm"></a>the <code class="literal">endef</code> keyword,
        which must appear on a line by itself. A macro created with <code class="literal">define</code> is expanded pretty much like any
        other variable, except that when it is used in the context of a
        command script, each line of the macro has a tab prepended to the
        line. An example use is:</p><a id="OEBPS/ch03s03.html.I_3_tt121"></a><pre class="programlisting">$(UI_JAR): $(UI_CLASSES)
        $(åˆ›å»ºjar)</pre><pre class="programlisting">$(UI_JAR): $(UI_CLASSES)
        $(create-jar)</pre><p><em class="command">è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨echo</em><code class="literal">@</code>å‘½ä»¤
        å‰é¢æ·»åŠ äº†ä¸€ä¸ªå­—ç¬¦
        ã€‚æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œ<em class="command">make</em>ä¸ä¼šå›žæ˜¾ä»¥å­—ç¬¦ä¸ºå‰ç¼€çš„å‘½ä»¤è¡Œã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬è¿è¡Œ<em class="command">make</em>æ—¶ï¼Œå®ƒâ€‹â€‹ä¸ä¼šæ‰“å°<em class="command">echo</em>å‘½ä»¤ï¼Œè€Œåªä¼šæ‰“å°è¯¥å‘½ä»¤çš„è¾“å‡ºã€‚å¦‚æžœ
        åœ¨å®ä¸­ä½¿ç”¨å‰ç¼€ï¼Œåˆ™å‰ç¼€å­—ç¬¦é€‚ç”¨äºŽä½¿ç”¨å®ƒçš„å„ä¸ªè¡Œã€‚ä½†æ˜¯ï¼Œå¦‚æžœåœ¨å®å¼•ç”¨ä¸Šä½¿ç”¨å‰ç¼€å­—ç¬¦ï¼Œåˆ™æ•´ä¸ªå®ä½“å°†è¢«éšè—ï¼š<em class="command"></em><code class="literal">@</code><em class="command"></em><em class="command"></em><em class="command"></em><code class="literal">@</code></p><p>Notice we've added an <code class="literal">@</code>
        character in front of our <em class="command">echo</em>
        command. Command lines prefixed with an <code class="literal">@</code> character are not echoed by <em class="command">make</em> when the command is executed. When we
        run <em class="command">make</em>, therefore, it doesn't
        print the <em class="command">echo</em> command, just the
        output of that command. If the <code class="literal">@</code>
        prefix is used within a macro, the prefix character applies to the
        individual lines on which it is used. However, if the prefix character
        is used on the macro reference, the entire macro body is
        hidden:</p><a id="OEBPS/ch03s03.html.I_3_tt122"></a><pre class="programlisting">$(UI_JAR): $(UI_CLASSES)
        @$(åˆ›å»ºjar)</pre><pre class="programlisting">$(UI_JAR): $(UI_CLASSES)
        @$(create-jar)</pre><p>è¿™ä»…æ˜¾ç¤ºï¼š</p><p>This displays only:</p><a id="OEBPS/ch03s03.html.I_3_tt123"></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
æ­£åœ¨åˆ›å»º ui.jar...</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
Creating ui.jar...</pre><p><a class="link" href="#OEBPS/ch05.html" title="ç¬¬ 5 ç« å‘½ä»¤">ç¬¬ 5 ç« ç¬¬</a>5.1.2<a class="link" href="#OEBPS/ch05.html.make3-CHP-5-SECT-1.2" title="å‘½ä»¤ä¿®é¥°ç¬¦">èŠ‚</a><code class="literal">@</code>æ›´è¯¦ç»†åœ°ä»‹ç»äº†çš„ä½¿ç”¨ã€‚<a class="link" href="#OEBPS/ch05.html.make3-CHP-5-SECT-1.2" title="å‘½ä»¤ä¿®é¥°ç¬¦"></a><a class="link" href="#OEBPS/ch05.html" title="ç¬¬ 5 ç« å‘½ä»¤"></a></p><p>The use of <code class="literal">@</code> is covered in
        more detail in the <a class="link" href="#OEBPS/ch05.html.make3-CHP-5-SECT-1.2" title="Command Modifiers">Section
        5.1.2</a> in <a class="link" href="#OEBPS/ch05.html" title="Chapter&nbsp;5.&nbsp;Commands">Chapter 5</a>.</p><div class="footnotes"><br><br><hr><div class="footnote"><p><sup>[ <a id="OEBPS/ch03s03.html.ftn.make3-CHP-3-FNOTE-2" href="#OEBPS/ch03s03.html.make3-CHP-3-FNOTE-2" class="para">2</a> ]</sup>ä¸ºäº†èŽ·å¾—æœ€ä½³æ•ˆæžœï¼Œ<code class="literal">RM</code>åº”å°†å˜é‡å®šä¹‰ä¸ºä¿å­˜
            <em class="command">rm -rf</em>ã€‚äº‹å®žä¸Šï¼Œå®ƒçš„é»˜è®¤å€¼æ˜¯<em class="command">rm -f</em>ï¼Œæ›´å®‰å…¨ï¼Œä½†ä¸å¤ªæœ‰ç”¨ã€‚æ­¤å¤–ï¼Œ<code class="literal">MKDIR</code>
            åº”å®šä¹‰ä¸º<em class="command">mkdir -p</em>ç­‰ã€‚</p><p><sup>[<a href="#OEBPS/ch03s03.html.make3-CHP-3-FNOTE-2" class="para">2</a>] </sup>For best effect here, the <code class="literal">RM</code> variable should be defined to hold
            <em class="command">rm -rf</em>. In fact, its default
            value is <em class="command">rm -f</em>, safer but not
            quite as useful. Further, <code class="literal">MKDIR</code>
            should be defined as <em class="command">mkdir -p</em>,
            and so on.</p></div></div></div></div></div>
<div id="OEBPS/ch03s04.html"><div>
<div class="sect1" title="å½“å˜é‡å±•å¼€æ—¶"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch03s04.html.make3-CHP-3-SECT-4"></a>å½“å˜é‡å±•å¼€æ—¶</h1><h1 class="title"><a></a>When Variables Are Expanded</h1></div></div></div><p>åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬<a id="OEBPS/ch03s04.html.make3-CHP-3-ITERM-1066" class="indexterm"></a> <a id="OEBPS/ch03s04.html.make3-CHP-3-ITERM-1067" class="indexterm"></a>å¼€å§‹é¢†ç•¥å˜é‡æ‰©å±•çš„ä¸€äº›å¾®å¦™ä¹‹å¤„ã€‚ç»“æžœåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºŽå…ˆå‰å®šä¹‰çš„å†…å®¹å’Œä½ç½®ã€‚å³ä½¿<em class="command">make</em>æœªèƒ½å‘çŽ°ä»»ä½•é”™è¯¯ï¼Œæ‚¨ä¹Ÿå¯èƒ½å¾ˆå®¹æ˜“å¾—åˆ°æ‚¨ä¸æƒ³è¦çš„ç»“æžœã€‚é‚£ä¹ˆå˜é‡æ‰©å±•çš„è§„åˆ™æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™åˆ°åº•æ˜¯å¦‚ä½•è¿ä½œçš„ï¼Ÿ</p><p>In the previous sections, we <a class="indexterm"></a> <a class="indexterm"></a>began to get a taste of some of the subtleties of
        variable expansion. Results depend a lot on what was previously
        defined, and where. You could easily get results you don't want, even
        if <em class="command">make</em> fails to find any error. So
        what are the rules for expanding variables? How does this really
        work?</p><p>å½“<em class="command">make</em>è¿è¡Œæ—¶ï¼Œå®ƒåˆ†ä¸¤ä¸ªé˜¶æ®µæ‰§è¡Œå…¶å·¥ä½œã€‚åœ¨ç¬¬ä¸€é˜¶æ®µï¼Œ<em class="command">make</em>è¯»å–<em class="filename">makefile</em>å’Œä»»ä½•åŒ…å«çš„<em class="filename">makefile</em>ã€‚æ­¤æ—¶ï¼Œå˜é‡å’Œè§„åˆ™è¢«åŠ è½½åˆ°<em class="command">make</em>çš„å†…éƒ¨æ•°æ®åº“ä¸­ï¼Œå¹¶åˆ›å»ºä¾èµ–å›¾ã€‚åœ¨ç¬¬äºŒé˜¶æ®µï¼Œ<em class="command">make</em>åˆ†æžä¾èµ–å›¾å¹¶ç¡®å®šéœ€è¦æ›´æ–°çš„ç›®æ ‡ï¼Œç„¶åŽæ‰§è¡Œå‘½ä»¤è„šæœ¬æ¥æ‰§è¡Œæ‰€éœ€çš„æ›´æ–°ã€‚</p><p>When <em class="command">make</em> runs, it performs
        its job in two phases. In the first phase, <em class="command">make</em> reads the <em class="filename">makefile</em> and any included <em class="filename">makefile</em>s. At this time, variables and
        rules are loaded into <em class="command">make</em>'s
        internal database and the dependency graph is created. In the second
        phase, <em class="command">make</em> analyzes the dependency
        graph and determines the targets that need to be updated, then
        executes command scripts to perform the required updates.</p><p><em class="command">å½“make</em><code class="literal">define</code>å¤„ç†é€’å½’å˜é‡æˆ–æŒ‡ä»¤æ—¶ï¼Œå˜é‡æˆ–å®ä¸»ä½“ä¸­çš„è¡Œå°†è¢«å­˜å‚¨ï¼ŒåŒ…æ‹¬ä¸æ‰©å±•çš„æ¢è¡Œç¬¦ã€‚å®å®šä¹‰çš„æœ€åŽä¸€ä¸ªæ¢è¡Œç¬¦ä¸å­˜å‚¨ä¸ºå®çš„ä¸€éƒ¨åˆ†ã€‚å¦åˆ™ï¼Œå½“å®å±•å¼€æ—¶ï¼Œ<em class="command">make</em>å°†è¯»å–é¢å¤–çš„æ¢è¡Œç¬¦ã€‚<em class="command"></em><em class="command"></em></p><p>When a recursive variable or <code class="literal">define</code> directive is processed by <em class="command">make</em>, the lines in the variable or body of
        the macro are stored, including the newlines without being expanded.
        The very last newline of a macro definition is not stored as part of
        the macro. Otherwise, when the macro was expanded an extra newline
        would be read by <em class="command">make</em>.</p><p>å½“å®å±•å¼€æ—¶ï¼Œ<a id="OEBPS/ch03s04.html.make3-CHP-3-ITERM-1068" class="indexterm"></a> <a id="OEBPS/ch03s04.html.make3-CHP-3-ITERM-1069" class="indexterm"></a>ç„¶åŽç«‹å³æ‰«ææ‰©å±•çš„æ–‡æœ¬ä»¥èŽ·å–è¿›ä¸€æ­¥çš„å®æˆ–å˜é‡å¼•ç”¨ï¼Œå¹¶é€’å½’åœ°æ‰©å±•è¿™äº›æ–‡æœ¬ï¼Œä¾æ­¤ç±»æŽ¨ã€‚å¦‚æžœå®åœ¨æ“ä½œä¸Šä¸‹æ–‡ä¸­å±•å¼€ï¼Œåˆ™å®çš„æ¯ä¸€è¡Œéƒ½ä¼šæ’å…¥ä¸€ä¸ªå‰å¯¼åˆ¶è¡¨ç¬¦ã€‚</p><p>When a macro is expanded, the <a class="indexterm"></a> <a class="indexterm"></a>expanded text is then immediately scanned for further
        macro or variable references and those are expanded and so on,
        recursively. If the macro is expanded in the context of an action,
        each line of the macro is inserted with a leading tab
        character.</p><p>æ€»è€Œè¨€ä¹‹ï¼Œä»¥ä¸‹æ˜¯æ‰©å±•<em class="filename">makefile</em>å…ƒç´ çš„è§„åˆ™
        ï¼š</p><p>To summarize, here are the rules for when elements of a
        <em class="filename">makefile</em> are expanded:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><em class="command">å¯¹äºŽå˜é‡èµ‹å€¼ï¼Œå½“make</em>åœ¨ç¬¬ä¸€é˜¶æ®µè¯»å–è¯¥è¡Œæ—¶ï¼Œèµ‹å€¼çš„å·¦ä¾§æ€»æ˜¯ç«‹å³å±•å¼€ã€‚</p></li><li class="listitem"><p>For variable assignments, the lefthand side of the
            assignment is always expanded immediately when <em class="command">make</em> reads the line during its first
            phase.</p></li><li class="listitem"><p><code class="literal">=</code>
            å’Œçš„å³ä¾§<code class="literal">?=</code>è¢«æŽ¨è¿Ÿåˆ°ç¬¬äºŒé˜¶æ®µä½¿ç”¨ã€‚</p></li><li class="listitem"><p>The righthand side of <code class="literal">=</code>
            and <code class="literal">?=</code> are deferred until they
            are used in the second phase.</p></li><li class="listitem"><p>çš„å³ä¾§<code class="literal">:=</code>
            ç«‹å³å±•å¼€ã€‚</p></li><li class="listitem"><p>The righthand side of <code class="literal">:=</code>
            is expanded immediately.</p></li><li class="listitem"><p><code class="literal">+=</code>
            å¦‚æžœå·¦ä¾§æœ€åˆå®šä¹‰ä¸ºç®€å•å˜é‡ï¼Œåˆ™å³ä¾§ä¼šç«‹å³æ‰©å±•ã€‚å¦åˆ™ï¼Œå…¶è¯„ä¼°å°†è¢«æŽ¨è¿Ÿã€‚</p></li><li class="listitem"><p>The righthand side of <code class="literal">+=</code>
            is expanded immediately if the lefthand side was originally
            defined as a simple variable. Otherwise, its evaluation is
            deferred.</p></li><li class="listitem"><p>å¯¹äºŽå®å®šä¹‰ï¼ˆä½¿ç”¨ çš„å®å®šä¹‰<code class="literal">define</code>ï¼‰ï¼Œå®å˜é‡åç§°ä¼šç«‹å³å±•å¼€ï¼Œè€Œå®çš„ä¸»ä½“ä¼šå»¶è¿Ÿåˆ°ä½¿ç”¨ä¸ºæ­¢ã€‚</p></li><li class="listitem"><p>For macro definitions (those using <code class="literal">define</code>), the macro variable name is
            immediately expanded and the body of the macro is deferred until
            used.</p></li><li class="listitem"><p>å¯¹äºŽè§„åˆ™ï¼Œç›®æ ‡å’Œå…ˆå†³æ¡ä»¶æ€»æ˜¯ç«‹å³æ‰©å±•ï¼Œè€Œå‘½ä»¤æ€»æ˜¯å»¶è¿Ÿã€‚</p></li><li class="listitem"><p>For rules, the targets and prerequisites are always
            immediately expanded while the commands are always
            deferred.</p></li></ul></div><p><a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®">ç¬¬ 3 ç« </a>æ€»ç»“äº†å˜é‡æ‰©å±•æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><p><a class="link" href="#OEBPS/ch03.html" title="Chapter&nbsp;3.&nbsp;Variables and Macros">Chapter 3</a> summarizes what
        occurs when variables are expanded.</p><div class="table"><a id="OEBPS/ch03s04.html.make3-CHP-3-TABLE-1"></a><p class="title">è¡¨ 3-1ã€‚ç«‹å³å’Œå»¶è¿Ÿæ‰©å±•çš„è§„åˆ™</p><p class="title">Table&nbsp;3-1.&nbsp;Rules for immediate and deferred expansion</p><div class="table-contents"><table summary="Rules for immediate and deferred expansion" style="border-collapse:collapse;border-top:0.5pt solid;border-bottom:0.5pt solid;border-left:0.5pt solid;border-right:0.5pt solid"><colgroup><col><col><col></colgroup><thead><tr><th style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>å®šä¹‰</p><p>Definition</p></th><th style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>æ‰©å±•ä¸€ä¸ª</p><p>Expansion of a</p></th><th style="border-bottom:0.5pt solid"><p>b çš„æ‰©å±•</p><p>Expansion of b</p></th></tr></thead><tbody><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><a id="OEBPS/ch03s04.html.I_3_tt124"></a><pre class="programlisting"><span class="emphasis"><em>a</em></span> =<span class="emphasis"><em> b</em></span></pre><pre class="programlisting"><span class="emphasis"><em>a</em></span> = <span class="emphasis"><em>b</em></span></pre></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>å³æ—¶</p><p>Immediate</p></td><td style="border-bottom:0.5pt solid"><p>å»¶æœŸ</p><p>Deferred</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><a id="OEBPS/ch03s04.html.I_3_tt125"></a><pre class="programlisting"><span class="emphasis"><em>a</em></span> ? =<span class="emphasis"><em> b</em></span></pre><pre class="programlisting"><span class="emphasis"><em>a</em></span> ?= <span class="emphasis"><em>b</em></span></pre></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>å³æ—¶</p><p>Immediate</p></td><td style="border-bottom:0.5pt solid"><p>å»¶æœŸ</p><p>Deferred</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><a id="OEBPS/ch03s04.html.I_3_tt126"></a><pre class="programlisting"><span class="emphasis"><em>ä¸€ä¸ª</em></span>ï¼š=<span class="emphasis"><em>ä¹™</em></span></pre><pre class="programlisting"><span class="emphasis"><em>a</em></span> := <span class="emphasis"><em>b</em></span></pre></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>å³æ—¶</p><p>Immediate</p></td><td style="border-bottom:0.5pt solid"><p>å³æ—¶</p><p>Immediate</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><a id="OEBPS/ch03s04.html.I_3_tt127"></a><pre class="programlisting"><span class="emphasis"><em>a</em></span> +=<span class="emphasis"><em> b</em></span></pre><pre class="programlisting"><span class="emphasis"><em>a</em></span> += <span class="emphasis"><em>b</em></span></pre></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>å³æ—¶</p><p>Immediate</p></td><td style="border-bottom:0.5pt solid"><p>å»¶æœŸæˆ–ç«‹å³</p><p>Deferred or immediate</p></td></tr><tr><td style="border-right:0.5pt solid"><a id="OEBPS/ch03s04.html.I_3_tt128"></a><pre class="programlisting">å®šä¹‰<span class="emphasis"><em>ab</em></span>ã€‚ ã€‚ ã€‚ 
 <span class="emphasis"><em>b</em></span> . ã€‚ ã€‚ 
 <span class="emphasis"><em>b</em></span> . ã€‚ ã€‚
æ©å¾·å¤«</pre><pre class="programlisting">define<span class="emphasis"><em>ab</em></span> . . . 
<span class="emphasis"><em>b</em></span> . . . 
<span class="emphasis"><em>b</em></span> . . . 
endef</pre></td><td style="border-right:0.5pt solid"><p>å³æ—¶</p><p>Immediate</p></td><td style=""><p>å»¶æœŸ</p><p>Deferred</p></td></tr></tbody></table></div></div><p>ä½œä¸ºä¸€èˆ¬è§„åˆ™ï¼Œå§‹ç»ˆå®šä¹‰å˜é‡å’Œ<a id="OEBPS/ch03s04.html.make3-CHP-3-ITERM-1070" class="indexterm"></a> <a id="OEBPS/ch03s04.html.make3-CHP-3-ITERM-1071" class="indexterm"></a> <a id="OEBPS/ch03s04.html.make3-CHP-3-ITERM-1072" class="indexterm"></a> <a id="OEBPS/ch03s04.html.make3-CHP-3-ITERM-1073" class="indexterm"></a> <a id="OEBPS/ch03s04.html.make3-CHP-3-ITERM-1074" class="indexterm"></a> <a id="OEBPS/ch03s04.html.make3-CHP-3-ITERM-1075" class="indexterm"></a>åœ¨ä½¿ç”¨å®ä¹‹å‰ã€‚ç‰¹åˆ«æ˜¯ï¼Œéœ€è¦åœ¨ä½¿ç”¨ç›®æ ‡æˆ–å…ˆå†³æ¡ä»¶ä¸­ä½¿ç”¨çš„å˜é‡ä¹‹å‰å¯¹å…¶è¿›è¡Œå®šä¹‰ã€‚</p><p>As a general rule, always define variables and <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>macros before they are used. In particular, it is
        required that a variable used in a target or prerequisite be defined
        before its use.</p><p>ä¸€ä¸ªä¾‹å­ä¼šè®©è¿™ä¸€åˆ‡å˜å¾—æ›´æ¸…æ¥šã€‚å‡è®¾æˆ‘ä»¬é‡æ–°å®žçŽ°æˆ‘ä»¬çš„<code class="function">free-space</code>å®ã€‚æˆ‘ä»¬å°†ä¸€æ¬¡æµè§ˆè¯¥ç¤ºä¾‹çš„ä¸€éƒ¨åˆ†ï¼Œç„¶åŽæœ€åŽå°†å®ƒä»¬å…¨éƒ¨æ”¾åœ¨ä¸€èµ·ã€‚</p><p>An example will make all this clearer. Suppose we reimplement
        our <code class="function">free-space</code> macro. We'll go
        over the example a piece at a time, then put them all together at the
        end.</p><a id="OEBPS/ch03s04.html.I_3_tt129"></a><pre class="programlisting">BIN := /usr/bin
PRINTF := $(BIN)/printf
DF := $(BIN)/df
AWK := $(BIN)/awk</pre><pre class="programlisting">BIN    := /usr/bin
PRINTF := $(BIN)/printf
DF     := $(BIN)/df
AWK    := $(BIN)/awk</pre><p>æˆ‘ä»¬å®šä¹‰ä¸‰ä¸ªå˜é‡æ¥ä¿å­˜æˆ‘ä»¬åœ¨å®ä¸­ä½¿ç”¨çš„ç¨‹åºçš„åç§°ã€‚ä¸ºäº†é¿å…ä»£ç é‡å¤ï¼Œæˆ‘ä»¬å°†<em class="filename">bin</em>ç›®å½•åˆ†è§£
        ä¸ºç¬¬å››ä¸ªå˜é‡ã€‚è¯»å–å››ä¸ªå˜é‡å®šä¹‰å¹¶ç«‹å³å±•å¼€å®ƒä»¬çš„å³ä¾§ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç®€å•å˜é‡ã€‚å› ä¸º<code class="literal">BIN</code>æ˜¯åœ¨å…¶ä»–ä¹‹å‰å®šä¹‰çš„ï¼Œæ‰€ä»¥å®ƒçš„å€¼å¯ä»¥æ’å…¥åˆ°å®ƒä»¬çš„å€¼ä¸­<a id="OEBPS/ch03s04.html.make3-CHP-3-ITERM-1076" class="indexterm"></a>ä»·å€¼è§‚ã€‚</p><p>We define three variables to hold the names of the programs we
        use in our macro. To avoid code duplication we factor out the
        <em class="filename">bin</em> directory into a fourth
        variable. The four variable definitions are read and their righthand
        sides are immediately expanded because they are simple variables.
        Because <code class="literal">BIN</code> is defined before the
        others, its value can be plugged into their <a class="indexterm"></a>values.</p><p>æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰<code class="function">free-space</code>å®ã€‚</p><p>Next, we define the <code class="function">free-space</code> macro.</p><a id="OEBPS/ch03s04.html.I_3_tt130"></a><pre class="programlisting">å®šä¹‰è‡ªç”±ç©ºé—´
  $(PRINTF)â€œå¯ç”¨ç£ç›˜ç©ºé—´â€
  $(DF) ã€‚ | $(AWK) 'NR == 2 { æ‰“å° $$4 }'
æ©å¾·å¤«</pre><pre class="programlisting">define free-space
  $(PRINTF) "Free disk space "
  $(DF) . | $(AWK) 'NR =  = 2 { print $$4 }'
endef</pre><p>è¯¥<code class="literal">define</code>æŒ‡ä»¤åŽé¢è·Ÿç€ä¸€ä¸ªç«‹å³å±•å¼€çš„å˜é‡åã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸éœ€è¦æ‰©å±•ã€‚å®çš„ä¸»ä½“åœ¨æœªå±•å¼€çš„æƒ…å†µä¸‹è¢«è¯»å–å’Œå­˜å‚¨ã€‚</p><p>The <code class="literal">define</code> directive is
        followed by a variable name that is immediately expanded. In this
        case, no expansion is necessary. The body of the macro is read and
        stored unexpanded.</p><p>æœ€åŽï¼Œæˆ‘ä»¬åœ¨è§„åˆ™ä¸­ä½¿ç”¨æˆ‘ä»¬çš„å®ã€‚</p><p>Finally, we use our macro in a rule.</p><a id="OEBPS/ch03s04.html.I_3_tt131"></a><pre class="programlisting">è¾“å‡ºç›®å½•ï¼š= /tmp

$(OUTPUT_DIR)/very_big_file:
        $ï¼ˆå¯ç”¨ç©ºé—´ï¼‰</pre><pre class="programlisting">OUTPUT_DIR := /tmp

$(OUTPUT_DIR)/very_big_file:
        $(free-space)</pre><p>è¯»å–<em class="filename">$(OUTPUT_DIR)/very_big_file</em>æ—¶ï¼Œç›®æ ‡å’Œå…ˆå†³æ¡ä»¶ä¸­ä½¿ç”¨çš„ä»»ä½•å˜é‡éƒ½ä¼šç«‹å³å±•å¼€ã€‚æ­¤å¤„ï¼Œ<code class="literal">$(OUTPUT_DIR)</code>æ‰©å±•ä¸º<em class="filename">/tmp</em>ä»¥å½¢æˆ
        <em class="filename">/tmp/very_big_file</em>ç›®æ ‡ã€‚æŽ¥ä¸‹æ¥ï¼Œè¯»å–è¯¥ç›®æ ‡çš„å‘½ä»¤è„šæœ¬ã€‚å‘½ä»¤è¡Œç”±å‰å¯¼åˆ¶è¡¨ç¬¦è¯†åˆ«å¹¶è¯»å–å’Œå­˜å‚¨ï¼Œä½†ä¸æ‰©å±•ã€‚</p><p>When <em class="filename">$(OUTPUT_DIR)/very_big_file</em> is read, any
        variables used in the targets and prerequisites are immediately
        expanded. Here, <code class="literal">$(OUTPUT_DIR)</code> is
        expanded to <em class="filename">/tmp</em> to form the
        <em class="filename">/tmp/very_big_file</em> target. Next,
        the command script for this target is read. Command lines are
        recognized by the leading tab character and are read and stored, but
        not expanded.</p><p>è¿™æ˜¯æ•´ä¸ªç¤ºä¾‹<em class="filename">makefile</em>ã€‚æ–‡ä»¶ä¸­å…ƒç´ çš„é¡ºåºå·²è¢«æ•…æ„æ‰“ä¹±ï¼Œä»¥è¯´æ˜Ž<em class="command">make</em>çš„è¯„ä¼°ç®—æ³•ã€‚</p><p>Here is the entire example <em class="filename">makefile</em>. The order of elements in the file
        has been scrambled intentionally to illustrate <em class="command">make</em>'s evaluation algorithm.</p><a id="OEBPS/ch03s04.html.I_3_tt132"></a><pre class="programlisting">è¾“å‡ºç›®å½•ï¼š= /tmp

$(OUTPUT_DIR)/very_big_file:
        $ï¼ˆå¯ç”¨ç©ºé—´ï¼‰

å®šä¹‰è‡ªç”±ç©ºé—´
  $(PRINTF)â€œå¯ç”¨ç£ç›˜ç©ºé—´â€
  $(DF) ã€‚ | $(AWK) 'NR == 2 { æ‰“å° $$4 }'
æ©å¾·å¤«

BIN := /usr/bin
PRINTF := $(BIN)/printf
DF := $(BIN)/df
AWK := $(BIN)/awk</pre><pre class="programlisting">OUTPUT_DIR := /tmp

$(OUTPUT_DIR)/very_big_file:
        $(free-space)

define free-space
  $(PRINTF) "Free disk space "
  $(DF) . | $(AWK) 'NR =  = 2 { print $$4 }'
endef

BIN    := /usr/bin
PRINTF := $(BIN)/printf
DF     := $(BIN)/df
AWK    := $(BIN)/awk</pre><p><em class="filename">è¯·æ³¨æ„ï¼Œè™½ç„¶makefile</em>ä¸­çš„è¡Œé¡ºåºçœ‹èµ·æ¥æ˜¯å‘åŽçš„ï¼Œä½†å®ƒæ‰§è¡Œå¾—å¾ˆå¥½ã€‚è¿™æ˜¯é€’å½’å˜é‡çš„ä»¤äººæƒŠè®¶çš„æ•ˆæžœä¹‹ä¸€ã€‚å®ƒå¯èƒ½éžå¸¸æœ‰ç”¨ï¼Œä½†åŒæ—¶åˆä»¤äººå›°æƒ‘ã€‚è¯¥<em class="filename">makefile</em>èµ·ä½œç”¨çš„åŽŸå› æ˜¯å‘½ä»¤è„šæœ¬å’Œå®ä¸»ä½“çš„æ‰©å±•è¢«æŽ¨è¿Ÿåˆ°å®žé™…ä½¿ç”¨æ—¶ã€‚å› æ­¤ï¼Œå®ƒä»¬å‡ºçŽ°çš„ç›¸å¯¹é¡ºåºå¯¹äºŽ<em class="filename">makefile</em>çš„æ‰§è¡Œå¹¶ä¸é‡è¦ã€‚</p><p>Notice that although the order of lines in the <em class="filename">makefile</em> seems backward, it executes just
        fine. This is one of the surprising effects of recursive variables. It
        can be immensely useful and confusing at the same time. The reason
        this <em class="filename">makefile</em> works is that
        expansion of the command script and the body of the macro are deferred
        until they are actually used. Therefore, the relative order in which
        they occur is immaterial to the execution of the <em class="filename">makefile</em>.</p><p>åœ¨å¤„ç†çš„ç¬¬äºŒé˜¶æ®µï¼Œè¯»å–<em class="filename">makefileåŽï¼Œ </em><em class="command">make</em>è¯†åˆ«ç›®æ ‡ï¼Œæ‰§è¡Œä¾èµ–æ€§åˆ†æžï¼Œå¹¶æ‰§è¡Œæ¯ä¸ªè§„åˆ™çš„æ“ä½œã€‚è¿™é‡Œå”¯ä¸€çš„ç›®æ ‡<code class="literal">$(OUTPUT_DIR)/very_big_file</code>æ²¡æœ‰ä»»ä½•å…ˆå†³æ¡ä»¶ï¼Œå› æ­¤<em class="command">make</em>å°†ç®€å•åœ°æ‰§è¡Œæ“ä½œï¼ˆå‡è®¾è¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼‰ã€‚å‘½ä»¤æ˜¯
        <code class="function">$(free-space)</code>ã€‚æ‰€ä»¥<em class="command">make</em>æ‰©å±•äº†å®ƒï¼Œå°±å¥½åƒç¨‹åºå‘˜å·²ç»å†™äº†ï¼š</p><p>In the second phase of processing, after the <em class="filename">makefile</em> is read, <em class="command">make</em> identifies the targets, performs
        dependency analysis, and executes the actions for each rule. Here the
        only target, <code class="literal">$(OUTPUT_DIR)/very_big_file</code>, has no
        prerequisites, so <em class="command">make</em> will simply
        execute the actions (assuming the file doesn't exist). The command is
        <code class="function">$(free-space)</code>. So <em class="command">make</em> expands this as if the programmer had
        written:</p><a id="OEBPS/ch03s04.html.I_3_tt133"></a><pre class="programlisting">/tmp/very_big_file:
        /usr/bin/printf â€œå¯ç”¨ç£ç›˜ç©ºé—´â€
        /usr/bin/df ã€‚ | /usr/bin/awk 'NR == 2 { æ‰“å° $$4 }'</pre><pre class="programlisting">/tmp/very_big_file:
        /usr/bin/printf "Free disk space "
        /usr/bin/df . | /usr/bin/awk 'NR =  = 2 { print $$4 }'</pre><p>ä¸€æ—¦æ‰€æœ‰å˜é‡éƒ½å±•å¼€ï¼Œå®ƒå°±å¼€å§‹æ‰§è¡Œ<a id="OEBPS/ch03s04.html.make3-CHP-3-ITERM-1077" class="indexterm"></a>ä¸€æ¬¡å‘½ä»¤ä¸€ä¸ªã€‚</p><p>Once all variables are expanded, it begins executing <a class="indexterm"></a>commands one at a time.</p><p>è®©æˆ‘ä»¬çœ‹çœ‹ makefile ä¸­é¡ºåºå¾ˆé‡è¦çš„ä¸¤ä¸ªéƒ¨åˆ†ã€‚å¦‚å‰æ‰€è¿°ï¼Œç›®æ ‡<em class="filename">â€‹â€‹$(OUTPUT_DIR)/very_big_file</em>ç«‹å³å±•å¼€ã€‚å¦‚æžœå˜é‡çš„å®šä¹‰<code class="literal">OUTPUT_DIR</code>éµâ€‹â€‹å¾ªè§„åˆ™ï¼Œåˆ™ç›®æ ‡çš„æ‰©å±•å°†äº§ç”Ÿ<em class="filename">/very_big_file</em>ã€‚å¯èƒ½ä¸æ˜¯ç”¨æˆ·æƒ³è¦çš„ã€‚åŒæ ·ï¼Œå¦‚æžœ çš„å®šä¹‰<code class="literal">BIN</code>å·²ç§»è‡³ åŽ<code class="literal">AWK</code>ï¼Œåˆ™è¿™ä¸‰ä¸ªå˜é‡å°†æ‰©å±•ä¸º<em class="filename">/printf</em>ã€<em class="filename">/df</em>å’Œ<em class="filename">/awk ï¼Œ</em>å› ä¸ºä½¿ç”¨<code class="literal">:=</code>ä¼šå¯¼è‡´ç«‹å³è¯„ä¼°èµ‹å€¼çš„å³ä¾§ã€‚ç„¶è€Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´æ”¹ä¸ºï¼Œä½¿å®ƒä»¬æˆä¸ºé€’å½’å˜é‡æ¥é¿å…<code class="literal">PRINTF</code>ã€
        <code class="literal">DF</code>å’Œçš„é—®é¢˜ã€‚<code class="literal">AWK</code><code class="literal">:=</code><code class="literal">=</code></p><p>Let's look at the two parts of the makefile where the order is
        important. As explained earlier, the target <em class="filename">$(OUTPUT_DIR)/very_big_file</em> is expanded
        immediately. If the definition of the variable <code class="literal">OUTPUT_DIR</code> had followed the rule, the
        expansion of the target would have yielded <em class="filename">/very_big_file</em>. Probably not what the user
        wanted. Similarly, if the definition of <code class="literal">BIN</code> had been moved after <code class="literal">AWK</code>, those three variables would have
        expanded to <em class="filename">/printf</em>, <em class="filename">/df</em>, and <em class="filename">/awk</em> because the use of <code class="literal">:=</code> causes immediate evaluation of the
        righthand side of the assignment. However, in this case, we could
        avoid the problem for <code class="literal">PRINTF</code>,
        <code class="literal">DF</code>, and <code class="literal">AWK</code> by changing <code class="literal">:=</code> to <code class="literal">=</code>,
        making them recursive variables.</p><p>æœ€åŽä¸€ä¸ªç»†èŠ‚ã€‚è¯·æ³¨æ„ï¼Œæ›´æ”¹<code class="literal">OUTPUT_DIR</code>å’Œçš„é€’å½’å˜é‡çš„å®šä¹‰
        <code class="literal">BIN</code>ä¸ä¼šæ”¹å˜å…ˆå‰æŽ’åºé—®é¢˜çš„å½±å“ã€‚é‡è¦çš„é—®é¢˜æ˜¯ï¼Œå½“<em class="filename">$(OUTPUT_DIR)/very_big_file</em><code class="literal">PRINTF</code>ä»¥åŠã€<code class="literal">DF</code>ã€ å’Œçš„å³ä¾§<code class="literal">AWK</code>å±•å¼€æ—¶ï¼Œå®ƒä»¬çš„å±•å¼€ä¼šç«‹å³å‘ç”Ÿï¼Œå› æ­¤å®ƒä»¬å¼•ç”¨çš„å˜é‡å¿…é¡»å·²ç»å®šä¹‰ã€‚</p><p>One last detail. Notice that changing the definitions of
        <code class="literal">OUTPUT_DIR</code> and <code class="literal">BIN</code> to recursive variables would not change
        the effect of the previous ordering problems. The important issue is
        that when <em class="filename">$(OUTPUT_DIR)/very_big_file</em> and the
        righthand sides of <code class="literal">PRINTF</code>, <code class="literal">DF</code>, and <code class="literal">AWK</code> are expanded, their expansion happens
        immediately, so the variables they refer to must be already
        defined.</p></div></div></div>
<div id="OEBPS/ch03s05.html"><div>
<div class="sect1" title="ç‰¹å®šäºŽç›®æ ‡å’Œæ¨¡å¼çš„å˜é‡"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch03s05.html.make3-CHP-3-SECT-5"></a>ç‰¹å®šäºŽç›®æ ‡å’Œæ¨¡å¼çš„å˜é‡</h1><h1 class="title"><a></a>Target- and Pattern-Specific Variables</h1></div></div></div><p>å˜é‡é€šå¸¸æœ‰<a id="OEBPS/ch03s05.html.make3-CHP-3-ITERM-1078" class="indexterm"></a> <a id="OEBPS/ch03s05.html.make3-CHP-3-ITERM-1079" class="indexterm"></a> <a id="OEBPS/ch03s05.html.make3-CHP-3-ITERM-1080" class="indexterm"></a> <a id="OEBPS/ch03s05.html.make3-CHP-3-ITERM-1081" class="indexterm"></a>æ‰§è¡Œ makefile æœŸé—´åªæœ‰ä¸€ä¸ª<em class="filename">å€¼</em>ã€‚è¿™æ˜¯ç”±<em class="filename">makefile</em>å¤„ç†çš„ä¸¤é˜¶æ®µæ€§è´¨ä¿è¯çš„ã€‚åœ¨ç¬¬ä¸€é˜¶æ®µï¼Œè¯»å–<em class="filename">makefile</em>ï¼Œåˆ†é…å’Œæ‰©å±•å˜é‡ï¼Œå¹¶æž„å»ºä¾èµ–å…³ç³»å›¾ã€‚åœ¨ç¬¬äºŒé˜¶æ®µï¼Œåˆ†æžå¹¶éåŽ†ä¾èµ–å›¾ã€‚å› æ­¤ï¼Œå½“å‘½ä»¤è„šæœ¬æ‰§è¡Œæ—¶ï¼Œæ‰€æœ‰å˜é‡å¤„ç†å·²ç»å®Œæˆã€‚ä½†æ˜¯å‡è®¾æˆ‘ä»¬åªæƒ³ä¸ºå•ä¸ªè§„åˆ™æˆ–æ¨¡å¼é‡æ–°å®šä¹‰å˜é‡ã€‚</p><p>Variables usually have <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>only one value during the execution of a <em class="filename">makefile</em>. This is ensured by the two-phase
        nature of <em class="filename">makefile</em> processing. In
        phase one, the <em class="filename">makefile</em> is read,
        variables are assigned and expanded, and the dependency graph is
        built. In phase two, the dependency graph is analyzed and traversed.
        So when command scripts are being executed, all variable processing
        has already completed. But suppose we wanted to redefine a variable
        for just a single rule or pattern.</p><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨ç¼–è¯‘çš„ç‰¹å®šæ–‡ä»¶éœ€è¦ä¸€ä¸ªé¢å¤–çš„å‘½ä»¤è¡Œé€‰é¡¹ ï¼Œ<code class="literal">-DUSE_NEW_MALLOC=1</code>è¯¥é€‰é¡¹ä¸åº”æä¾›ç»™å…¶ä»–ç¼–è¯‘ï¼š</p><p>In this example, the particular file we are compiling needs an
        extra command-line option, <code class="literal">-DUSE_NEW_MALLOC=1</code>, that should not be
        provided to other compiles:</p><a id="OEBPS/ch03s05.html.I_3_tt134"></a><pre class="programlisting">gui.oï¼šgui.h
        $(COMPILE.c) -DUSE_NEW_MALLOC=1 $(OUTPUT_OPTION) $&lt;</pre><pre class="programlisting">gui.o: gui.h
        $(COMPILE.c) -DUSE_NEW_MALLOC=1 $(OUTPUT_OPTION) $&lt;</pre><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡å¤åˆ¶ç¼–è¯‘å‘½ä»¤è„šæœ¬å¹¶æ·»åŠ æ–°çš„å¿…éœ€é€‰é¡¹æ¥è§£å†³é—®é¢˜ã€‚è¿™ç§æ–¹æ³•åœ¨å‡ ä¸ªæ–¹é¢éƒ½ä¸èƒ½ä»¤äººæ»¡æ„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¤åˆ¶ä»£ç ã€‚å¦‚æžœè§„åˆ™å‘ç”Ÿå˜åŒ–æˆ–è€…æˆ‘ä»¬é€‰æ‹©ç”¨è‡ªå®šä¹‰æ¨¡å¼è§„åˆ™æ›¿æ¢å†…ç½®è§„åˆ™ï¼Œåˆ™éœ€è¦æ›´æ–°æ­¤ä»£ç ï¼Œè€Œæˆ‘ä»¬å¯èƒ½ä¼šå¿˜è®°ã€‚å…¶æ¬¡ï¼Œå¦‚æžœè®¸å¤šæ–‡ä»¶éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œåˆ™ç²˜è´´æ­¤ä»£ç çš„ä»»åŠ¡å¾ˆå¿«å°±ä¼šå˜å¾—éžå¸¸ä¹å‘³ä¸”å®¹æ˜“å‡ºé”™ï¼ˆæƒ³è±¡ä¸€ä¸‹ä¸€ç™¾ä¸ªè¿™æ ·çš„æ–‡ä»¶ï¼‰ã€‚</p><p>Here, we've solved the problem by duplicating the compilation
        command script and adding the new required option. This approach is
        unsatisfactory in several respects. First, we are duplicating code. If
        the rule ever changes or if we choose to replace the built-in rule
        with a custom pattern rule, this code would need to be updated and we
        might forget. Second, if many files require special treatment, the
        task of pasting in this code will quickly become very tedious and
        error-prone (imagine a hundred files like this).</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å’Œå…¶ä»–é—®é¢˜ï¼Œ<em class="command">make</em>æä¾›äº†<em class="firstterm">ç‰¹å®šäºŽç›®æ ‡çš„å˜é‡</em>ã€‚è¿™äº›æ˜¯é™„åŠ åˆ°ç›®æ ‡çš„å˜é‡å®šä¹‰ï¼Œä»…åœ¨å¤„ç†è¯¥ç›®æ ‡åŠå…¶ä»»ä½•å…ˆå†³æ¡ä»¶æœŸé—´æœ‰æ•ˆã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½é‡å†™ä¹‹å‰çš„ç¤ºä¾‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>To address this issue and others, <em class="command">make</em> provides <em class="firstterm">target-specific
        variables</em>. These are variable definitions attached to a
        target that are valid only during the processing of that target and
        any of its prerequisites. We can rewrite our previous example using
        this feature like this:</p><a id="OEBPS/ch03s05.html.I_3_tt135"></a><pre class="programlisting">gui.o: CPPFLAGS += -DUSE_NEW_MALLOC=1
gui.oï¼šgui.h
        $(COMPILE.c) $(OUTPUT_OPTION) $&lt;</pre><pre class="programlisting">gui.o: CPPFLAGS += -DUSE_NEW_MALLOC=1
gui.o: gui.h
        $(COMPILE.c) $(OUTPUT_OPTION) $&lt;</pre><p>å˜é‡<code class="literal">CPPFLAGS</code>
        <a id="OEBPS/ch03s05.html.make3-CHP-3-ITERM-1082" class="indexterm"></a> <a id="OEBPS/ch03s05.html.make3-CHP-3-ITERM-1083" class="indexterm"></a>å†…ç½®äºŽé»˜è®¤çš„ C ç¼–è¯‘è§„åˆ™ä¸­ï¼Œæ—¨åœ¨åŒ…å« C é¢„å¤„ç†å™¨çš„é€‰é¡¹ã€‚é€šè¿‡ä½¿ç”¨<code class="literal">+=</code>èµ‹å€¼çš„å½¢å¼ï¼Œæˆ‘ä»¬å°†æ–°é€‰é¡¹é™„åŠ åˆ°ä»»ä½•å·²ç»å­˜åœ¨çš„çŽ°æœ‰å€¼ä¸Šã€‚çŽ°åœ¨å¯ä»¥å®Œå…¨åˆ é™¤ç¼–è¯‘å‘½ä»¤è„šæœ¬ï¼š</p><p>The variable <code class="literal">CPPFLAGS</code>
        <a class="indexterm"></a> <a class="indexterm"></a> is built in to the default C compilation rule and is
        meant to contain options for the C preprocessor. By using the <code class="literal">+=</code> form of assignment, we append our new
        option to any existing value already present. Now the compile command
        script can be removed entirely:</p><a id="OEBPS/ch03s05.html.I_3_tt136"></a><pre class="programlisting">gui.o: CPPFLAGS += -DUSE_NEW_MALLOC=1
gui.oï¼šgui.h</pre><pre class="programlisting">gui.o: CPPFLAGS += -DUSE_NEW_MALLOC=1
gui.o: gui.h</pre><p>åœ¨å¤„ç†<em class="filename">gui.o</em>ç›®æ ‡æ—¶ï¼Œé™¤äº†å…¶åŽŸå§‹å†…å®¹ä¹‹å¤–ï¼Œ<code class="literal">CPPFLAGS</code>è¿˜å°†åŒ…å«
        çš„å€¼ã€‚<code class="option">-DUSE_NEW_MALLOC=1</code>å½“<em class="filename">gui.o</em>ç›®æ ‡å®Œæˆæ—¶ï¼Œ<code class="literal">CPPFLAGS</code>å°†æ¢å¤åˆ°å…¶åŽŸå§‹å€¼ã€‚å½“<em class="filename">gui.o</em>ç›®æ ‡å®Œæˆæ—¶ï¼Œ<code class="literal">CPPFLAGS</code>å°†æ¢å¤åˆ°å…¶åŽŸå§‹å€¼ã€‚ç‰¹å®šäºŽæ¨¡å¼çš„å˜é‡ç±»ä¼¼ï¼Œåªæ˜¯å®ƒä»¬åœ¨æ¨¡å¼è§„åˆ™ä¸­æŒ‡å®šï¼ˆè¯·å‚è§ç¬¬ 21 é¡µï¼‰ã€‚</p><p>While the <em class="filename">gui.o</em> target is
        being processed, the value of <code class="literal">CPPFLAGS</code> will contain
        <code class="option">-DUSE_NEW_MALLOC=1</code> in addition to its original
        contents. When the <em class="filename">gui.o</em> target
        is finished, <code class="literal">CPPFLAGS</code> will revert
        to its original value. When the <em class="filename">gui.o</em> target is
        finished, <code class="literal">CPPFLAGS</code> will revert to its original
        value. Pattern-specific variables are similar, only they are specified
        in a pattern rule (see page 21).</p><p>ä¸€èˆ¬è¯­æ³•ä¸º<a id="OEBPS/ch03s05.html.make3-CHP-3-ITERM-1084" class="indexterm"></a> <a id="OEBPS/ch03s05.html.make3-CHP-3-ITERM-1085" class="indexterm"></a>ç›®æ ‡ç‰¹å®šå˜é‡æ˜¯ï¼š</p><p>The general syntax for <a class="indexterm"></a> <a class="indexterm"></a>target-specific variables is:</p><a id="OEBPS/ch03s05.html.I_3_tt137"></a><pre class="programlisting"><em class="replaceable"><code>target</code></em>â€¦â€¦ï¼šâ€¦â€¦ï¼šâ€¦â€¦ï¼šâ€¦â€¦ï¼š<em class="replaceable"><code>variable = value</code></em>
               <em class="replaceable"><code>target</code></em><em class="replaceable"><code>variable := value</code></em>
               <em class="replaceable"><code>target</code></em><em class="replaceable"><code>variable += value</code></em>
               <em class="replaceable"><code>target</code></em><em class="replaceable"><code>variable ?= value</code></em></pre><pre class="programlisting"><em class="replaceable"><code>target</code></em>...: <em class="replaceable"><code>variable = value</code></em>
               <em class="replaceable"><code>target</code></em>...: <em class="replaceable"><code>variable := value</code></em>
               <em class="replaceable"><code>target</code></em>...: <em class="replaceable"><code>variable += value</code></em>
               <em class="replaceable"><code>target</code></em>...: <em class="replaceable"><code>variable ?= value</code></em></pre><p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œæ‰€æœ‰å„ç§å½¢å¼çš„èµ‹å€¼å¯¹äºŽç‰¹å®šäºŽç›®æ ‡çš„å˜é‡éƒ½æœ‰æ•ˆã€‚è¯¥å˜é‡åœ¨èµ‹å€¼ä¹‹å‰ä¸éœ€è¦å­˜åœ¨ã€‚</p><p>As you can see, all the various forms of assignment are valid
        for a target-specific variable. The variable does not need to exist
        before the assignment.</p><p>æ­¤å¤–ï¼Œç›´åˆ°ç›®æ ‡å¤„ç†å¼€å§‹åŽæ‰çœŸæ­£æ‰§è¡Œå˜é‡èµ‹å€¼ã€‚å› æ­¤ï¼Œèµ‹å€¼çš„å³ä¾§æœ¬èº«å¯ä»¥æ˜¯å¦ä¸€ä¸ªç‰¹å®šäºŽç›®æ ‡çš„å˜é‡ä¸­è®¾ç½®çš„å€¼ã€‚è¯¥å˜é‡åœ¨å¤„ç†æ‰€æœ‰å…ˆå†³æ¡ä»¶æœŸé—´ä¹Ÿæœ‰æ•ˆã€‚</p><p>Furthermore, the variable assignment is not actually performed
        until the processing of the target begins. So the righthand side of
        the assignment can itself be a value set in another target-specific
        variable. The variable is valid during the processing of all
        prerequisites as well.</p></div></div></div>
<div id="OEBPS/ch03s06.html"><div>
<div class="sect1" title="å˜é‡ä»Žä½•è€Œæ¥"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch03s06.html.make3-CHP-3-SECT-6"></a>å˜é‡ä»Žä½•è€Œæ¥</h1><h1 class="title"><a></a>Where Variables Come From</h1></div></div></div><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¤§å¤šæ•°å˜é‡å·²ç»åœ¨æˆ‘ä»¬è‡ªå·±çš„
        <em class="filename">makefile</em>ä¸­æ˜¾å¼å®šä¹‰ï¼Œä½†å˜é‡å¯ä»¥æœ‰æ›´å¤æ‚çš„<a id="OEBPS/ch03s06.html.make3-CHP-3-ITERM-1086" class="indexterm"></a> <a id="OEBPS/ch03s06.html.make3-CHP-3-ITERM-1087" class="indexterm"></a>ç¥–å…ˆã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°å¯ä»¥åœ¨<em class="command">make</em>å‘½ä»¤è¡Œä¸Šå®šä¹‰å˜é‡ã€‚äº‹å®žä¸Šï¼Œ<em class="command">make</em>å˜é‡å¯ä»¥æ¥è‡ªä»¥ä¸‹æ¥æºï¼š</p><p>So far, most variables have been defined explicitly in our own
        <em class="filename">makefile</em>s, but variables can have
        a more complex <a class="indexterm"></a> <a class="indexterm"></a>ancestry. For instance, we have seen that variables can
        be defined on the <em class="command">make</em> command
        line. In fact, <em class="command">make</em> variables can
        come from these sources:</p><div class="variablelist"><dl><dt><span class="term">æ–‡ä»¶</span></dt><dt><span class="term">File</span></dt><dd><p>å½“ç„¶ï¼Œå˜é‡å¯ä»¥æ˜¯<a id="OEBPS/ch03s06.html.make3-CHP-3-ITERM-1088" class="indexterm"></a><em class="filename">åœ¨makefileæˆ–</em><em class="filename">makefile</em>åŒ…å«çš„æ–‡ä»¶
              ä¸­å®šä¹‰ï¼ˆæˆ‘ä»¬å°†
              <code class="literal">include</code>å¾ˆå¿«ä»‹ç»è¯¥æŒ‡ä»¤ï¼‰ã€‚</p></dd><dd><p>Of course, variables can be <a class="indexterm"></a>defined in the <em class="filename">makefile</em> or a file included by the
              <em class="filename">makefile</em> (we'll cover the
              <code class="literal">include</code> directive
              shortly).</p></dd><dt><span class="term">å‘½ä»¤è¡Œ</span></dt><dt><span class="term">Command line</span></dt><dd><p>å˜é‡å¯ä»¥è¢«å®šä¹‰æˆ–é‡æ–°å®šä¹‰<a id="OEBPS/ch03s06.html.make3-CHP-3-ITERM-1089" class="indexterm"></a>ç›´æŽ¥ä»Ž<em class="command">make</em>å‘½ä»¤è¡Œï¼š</p><a id="OEBPS/ch03s06.html.I_3_tt138"></a><pre class="programlisting">$ make CFLAGS=-g CPPFLAGS='-DBSD -DDEBUG'</pre><p>åŒ…å« an çš„å‘½ä»¤è¡Œå‚æ•°<code class="literal">=</code>æ˜¯å˜é‡èµ‹å€¼ã€‚å‘½ä»¤è¡Œä¸Šçš„æ¯ä¸ªå˜é‡åˆ†é…å¿…é¡»æ˜¯å•ä¸ª shell å‚æ•°ã€‚å¦‚æžœå˜é‡çš„å€¼ï¼ˆæˆ–è€…å¤©å ‚ç¦æ­¢å˜é‡æœ¬èº«ï¼‰åŒ…å«ç©ºæ ¼ï¼Œåˆ™å‚æ•°å¿…é¡»ç”¨å¼•å·æ‹¬èµ·æ¥ï¼Œæˆ–è€…å¿…é¡»å¯¹ç©ºæ ¼è¿›è¡Œè½¬ä¹‰ã€‚</p><p>å‘½ä»¤è¡Œä¸Šçš„å˜é‡èµ‹å€¼ä¼šè¦†ç›–çŽ¯å¢ƒä¸­çš„ä»»ä½•å€¼ä»¥åŠ
              <em class="filename">makefile</em>ä¸­çš„ä»»ä½•èµ‹å€¼ã€‚å‘½ä»¤è¡Œèµ‹å€¼å¯ä»¥åˆ†åˆ«ä½¿ç”¨<code class="literal">:=</code>æˆ–æ¥è®¾ç½®ç®€å•å˜é‡æˆ–é€’å½’å˜é‡<code class="literal">=</code>ã€‚å¯ä»¥ä½¿ç”¨è¯¥<code class="function">override</code>æŒ‡ä»¤æ¥å…è®¸ä½¿ç”¨<em class="filename">makefile</em>åˆ†é…è€Œä¸æ˜¯å‘½ä»¤è¡Œåˆ†é…ã€‚</p><a id="OEBPS/ch03s06.html.I_3_tt139"></a><pre class="programlisting"># ä½¿ç”¨big-endianå¯¹è±¡ï¼Œå¦åˆ™ç¨‹åºå´©æºƒï¼
è¦†ç›– LDFLAGS = -EB</pre><p>å½“ç„¶ï¼Œåªæœ‰åœ¨æœ€ç´§æ€¥çš„æƒ…å†µä¸‹æ‰åº”è¯¥å¿½ç•¥ç”¨æˆ·çš„æ˜¾å¼åˆ†é…è¯·æ±‚ï¼ˆé™¤éžæ‚¨åªæ˜¯æƒ³æ¿€æ€’ç”¨æˆ·ï¼‰ã€‚</p></dd><dd><p>Variables can be defined or redefined <a class="indexterm"></a>directly from the <em class="command">make</em> command line:</p><a></a><pre class="programlisting">$ make CFLAGS=-g CPPFLAGS='-DBSD -DDEBUG'</pre><p>A command-line argument containing an <code class="literal">=</code> is a variable assignment. Each
              variable assignment on the command line must be a single shell
              argument. If the value of the variable (or heaven forbid, the
              variable itself) contains spaces, the argument must be
              surrounded by quotes or the spaces must be escaped.</p><p>An assignment of a variable on the command line overrides
              any value from the environment and any assignment in the
              <em class="filename">makefile</em>. Command-line
              assignments can set either simple or recursive variables by
              using <code class="literal">:=</code> or <code class="literal">=</code>, respectively. It is possible using
              the <code class="function">override</code> directive to
              allow a <em class="filename">makefile</em> assignment
              to be used instead of a command-line assignment.</p><a></a><pre class="programlisting"># Use big-endian objects or the program crashes!
override LDFLAGS = -EB</pre><p>Of course, you should ignore a user's explicit assignment
              request only under the most urgent circumstances (unless you
              just want to irritate your users).</p></dd><dt><span class="term">çŽ¯å¢ƒ</span></dt><dt><span class="term">Environment</span></dt><dd><p>æ‚¨çš„æ‰€æœ‰å˜é‡<a id="OEBPS/ch03s06.html.make3-CHP-3-ITERM-1090" class="indexterm"></a><em class="command">make</em>å¯åŠ¨æ—¶çŽ¯å¢ƒä¼šè‡ªåŠ¨å®šä¹‰ä¸º<em class="command">make</em>å˜é‡ã€‚è¿™äº›å˜é‡çš„ä¼˜å…ˆçº§éžå¸¸ä½Žï¼Œå› æ­¤<em class="filename">makefile</em>æˆ–å‘½ä»¤è¡Œå‚æ•°ä¸­çš„èµ‹å€¼å°†è¦†ç›–çŽ¯å¢ƒå˜é‡çš„å€¼ã€‚æ‚¨å¯ä»¥ä½¿ç”¨(æˆ–) å‘½ä»¤è¡Œé€‰é¡¹ä½¿çŽ¯å¢ƒå˜é‡è¦†ç›–<em class="filename">makefile</em>å˜é‡
              ã€‚<em class="command"></em><em class="filename"></em><em class="filename"></em><code class="option">â€”environment-overrides</code><code class="option">-e</code></p><p>å½“é€’å½’è°ƒç”¨<em class="command">makeæ—¶ï¼Œçˆ¶</em><em class="command">make</em>ä¸­çš„ä¸€äº›å˜é‡å°†é€šè¿‡çŽ¯å¢ƒä¼ é€’ç»™å­<em class="command">make</em>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰é‚£äº›æœ€åˆæ¥è‡ªçŽ¯å¢ƒçš„å˜é‡ä¼šå¯¼å‡ºåˆ°å­çŽ¯å¢ƒä¸­ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤å°†ä»»ä½•å˜é‡å¯¼å‡ºåˆ°çŽ¯å¢ƒä¸­<code class="function">export</code>ï¼š</p><a id="OEBPS/ch03s06.html.I_3_tt140"></a><pre class="programlisting">å¯¼å‡º CLASSPATH := $(HOME)/classes:$(PROJECT)/classes
è´å£³ = -x
å‡ºå£è´ç±»</pre><p>æ‚¨å¯ä»¥ä½¿æ‰€æœ‰å˜é‡<a id="OEBPS/ch03s06.html.make3-CHP-3-ITERM-1091" class="indexterm"></a> <a id="OEBPS/ch03s06.html.make3-CHP-3-ITERM-1092" class="indexterm"></a>å¯¼å‡ºä¸ºï¼š</p><a id="OEBPS/ch03s06.html.I_3_tt141"></a><pre class="programlisting">å‡ºå£</pre><p>è¯·æ³¨æ„ï¼Œ<em class="command">make</em>ç”šè‡³ä¼šå¯¼å‡ºé‚£äº›åç§°åŒ…å«æ— æ•ˆ shell å˜é‡å­—ç¬¦çš„å˜é‡ã€‚ä¾‹å¦‚ï¼š</p><a id="OEBPS/ch03s06.html.I_3_tt142"></a><pre class="programlisting">å¯¼å‡º make ä¸­çš„æœ‰æ•ˆå˜é‡ = æ•´æ´ï¼
æ˜¾ç¤ºå˜é‡ï¼š
        çŽ¯å¢ƒ| grep '^æœ‰æ•ˆ-'
        valid_variable_in_shell=å¾ˆå¥½
        shell ä¸­çš„æ— æ•ˆå˜é‡=æŠ±æ­‰


$ åˆ¶ä½œ
çŽ¯å¢ƒ| grep '^æœ‰æ•ˆ-'
valid-variable-in-make=æ•´æ´ï¼
valid_variable_in_shell=å¾ˆå¥½
shell ä¸­çš„æ— æ•ˆå˜é‡=æŠ±æ­‰
/bin/sh: ç¬¬ 1 è¡Œï¼šshell ä¸­çš„æ— æ•ˆå˜é‡=æŠ±æ­‰ï¼šæ‰¾ä¸åˆ°å‘½ä»¤
make: *** [æ˜¾ç¤ºå˜é‡] é”™è¯¯ 127</pre><p>é€šè¿‡å¯¼å‡ºåˆ›å»ºäº†â€œæ— æ•ˆâ€shell å˜é‡
              <code class="literal">valid-variable-in-make</code>ã€‚è¯¥å˜é‡æ— æ³•é€šè¿‡æ­£å¸¸çš„ shell è¯­æ³•è®¿é—®ï¼Œåªèƒ½é€šè¿‡è¯¸å¦‚åœ¨çŽ¯å¢ƒä¸­è¿è¡Œ<em class="command">grep</em>ä¹‹ç±»çš„æŠ€å·§æ¥è®¿é—®ã€‚ç„¶è€Œï¼Œè¯¥å˜é‡å¯ä»¥è¢«ä»»ä½•æœ‰æ•ˆä¸”å¯è®¿é—®çš„å­<em class="command">å“ç‰Œ</em>ç»§æ‰¿ã€‚æˆ‘ä»¬å°†åœ¨<a class="link" href="#OEBPS/pt02.html" title="ç¬¬äºŒéƒ¨åˆ†ã€‚é«˜çº§å’Œä¸“ä¸šä¸»é¢˜">ç¬¬äºŒéƒ¨åˆ†ä»‹ç»â€œé€’å½’â€ </a><em class="command">make</em>çš„ä½¿ç”¨ã€‚<a class="link" href="#OEBPS/pt02.html" title="ç¬¬äºŒéƒ¨åˆ†ã€‚é«˜çº§å’Œä¸“ä¸šä¸»é¢˜"></a></p><p>æ‚¨è¿˜å¯ä»¥é˜»æ­¢å°†çŽ¯å¢ƒå˜é‡å¯¼å‡ºåˆ°å­æµç¨‹ï¼š</p><a id="OEBPS/ch03s06.html.I_3_tt143"></a><pre class="programlisting">å–æ¶ˆå¯¼å‡ºæ˜¾ç¤º</pre><p>å’ŒæŒ‡ä»¤<code class="function">mp_export</code>çš„
              <code class="function">mp_unexport</code>å·¥ä½œæ–¹å¼ä¸Ž<em class="command">mp_sh</em>å‘½ä»¤
              <code class="function">mp_export</code>å’Œ<code class="function">mp_unset</code>
              å·¥ä½œæ–¹å¼ç›¸åŒã€‚</p><p>æ¡ä»¶èµ‹å€¼<a id="OEBPS/ch03s06.html.make3-CHP-3-ITERM-1093" class="indexterm"></a> <a id="OEBPS/ch03s06.html.make3-CHP-3-ITERM-1094" class="indexterm"></a>è¿ç®—ç¬¦ä¸ŽçŽ¯å¢ƒå˜é‡çš„äº¤äº’éžå¸¸å¥½ã€‚å‡è®¾æ‚¨åœ¨<em class="filename">makefile</em>ä¸­è®¾ç½®äº†é»˜è®¤è¾“å‡ºç›®å½•ï¼Œä½†æ‚¨å¸Œæœ›ç”¨æˆ·èƒ½å¤Ÿè½»æ¾è¦†ç›–é»˜è®¤å€¼ã€‚æ¡ä»¶èµ‹å€¼éžå¸¸é€‚åˆè¿™ç§æƒ…å†µï¼š</p><a id="OEBPS/ch03s06.html.I_3_tt144"></a><pre class="programlisting"># å‡è®¾è¾“å‡ºç›®å½•ä¸º$(PROJECT_DIR)/outã€‚
OUTPUT_DIR ?= $(PROJECT_DIR)/out</pre><p><code class="literal">OUTPUT_DIR</code>è¿™é‡Œä»…å½“ä»Žæœªè®¾ç½®è¿‡æ—¶æ‰æ‰§è¡Œåˆ†é…ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´è¯¦ç»†åœ°èŽ·å¾—å‡ ä¹Žç›¸åŒçš„æ•ˆæžœï¼š</p><a id="OEBPS/ch03s06.html.I_3_tt145"></a><pre class="programlisting">ifndef è¾“å‡ºç›®å½•
  # å‡è®¾è¾“å‡ºç›®å½•ä¸º$(PROJECT_DIR)/outã€‚
  OUTPUT_DIR = $(PROJECT_DIR)/è¾“å‡º
ä¸‡ä¸€</pre><p>ä¸åŒä¹‹å¤„åœ¨äºŽï¼Œå¦‚æžœå˜é‡å·²ä»¥ä»»ä½•æ–¹å¼è®¾ç½®ï¼ˆç”šè‡³è®¾ç½®ä¸ºç©ºå€¼ï¼‰ï¼Œæ¡ä»¶èµ‹å€¼è¿ç®—ç¬¦å°†è·³è¿‡èµ‹å€¼ï¼Œè€Œ and<code class="literal">ifdef</code>è¿ç®—<code class="literal">ifndef</code>ç¬¦åˆ™æµ‹è¯•éžç©ºå€¼ã€‚å› æ­¤ï¼Œ<code class="literal">OUTPUT_DIR=</code>è¢«è®¤ä¸ºæ˜¯ç”±æ¡ä»¶è¿ç®—ç¬¦è®¾ç½®çš„ï¼Œä½†ä¸æ˜¯ç”± å®šä¹‰çš„
              <code class="literal">ifdef</code>ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿‡åº¦ä½¿ç”¨çŽ¯å¢ƒå˜é‡ä¼šä½¿<em class="filename">makefile</em>çš„å¯ç§»æ¤æ€§å¤§å¤§é™ä½Žï¼Œå› ä¸ºå…¶ä»–ç”¨æˆ·ä¸å¤ªå¯èƒ½æ‹¥æœ‰ç›¸åŒçš„çŽ¯å¢ƒå˜é‡é›†ã€‚äº‹å®žä¸Šï¼Œæ­£æ˜¯å› ä¸ºè¿™ä¸ªåŽŸå› ï¼Œæˆ‘å¾ˆå°‘ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ã€‚</p></dd><dd><p>All the variables from your <a class="indexterm"></a>environment are automatically defined as <em class="command">make</em> variables when <em class="command">make</em> starts. These variables have very
              low precedence, so assignments within the <em class="filename">makefile</em> or command-line arguments
              will override the value of an environment variable. You can
              cause environment variables to override <em class="filename">makefile</em> variables using the
              <code class="option">â€”environment-overrides</code> (or <code class="option">-e</code>)
              command-line option.</p><p>When <em class="command">make</em> is invoked
              recursively, some variables from the parent <em class="command">make</em> are passed through the
              environment to the child <em class="command">make</em>. By default, only those variables
              that originally came from the environment are exported to the
              child's environment, but any variable can be exported to the
              environment by using the <code class="function">export</code> directive:</p><a></a><pre class="programlisting">export CLASSPATH := $(HOME)/classes:$(PROJECT)/classes
SHELLOPTS = -x
export SHELLOPTS</pre><p>You can cause all variables to <a class="indexterm"></a> <a class="indexterm"></a>be exported with:</p><a></a><pre class="programlisting">export</pre><p>Note that <em class="command">make</em> will
              export even those variables whose names contain invalid shell
              variable characters. For example:</p><a></a><pre class="programlisting">export valid-variable-in-make = Neat!
show-vars:
        env | grep '^valid-'
        valid_variable_in_shell=Great
        invalid-variable-in-shell=Sorry


$ make
env | grep '^valid-'
valid-variable-in-make=Neat!
valid_variable_in_shell=Great
invalid-variable-in-shell=Sorry
/bin/sh: line 1: invalid-variable-in-shell=Sorry: command not found
make: *** [show-vars] Error 127</pre><p>An "invalid" shell variable was created by exporting
              <code class="literal">valid-variable-in-make</code>. This
              variable is not accessible through normal shell syntax, only
              through trickery such as running <em class="command">grep</em> over the environment.
              Nevertheless, this variable is inherited by any sub-<em class="command">make</em> where it is valid and accessible.
              We will cover use of "recursive" <em class="command">make</em> in <a class="link" href="#OEBPS/pt02.html" title="Part&nbsp;II.&nbsp;Advanced and Specialized Topics">Part II</a>.</p><p>You can also prevent an environment variable from being
              exported to the sub-process:</p><a></a><pre class="programlisting">unexport DISPLAY</pre><p>The <code class="function">mp_export</code> and
              <code class="function">mp_unexport</code> directives work
              the same way the <em class="command">mp_sh</em> commands
              <code class="function">mp_export</code> and <code class="function">mp_unset</code>
              work. </p><p>The conditional assignment <a class="indexterm"></a> <a class="indexterm"></a>operator interacts very nicely with environment
              variables. Suppose you have a default output directory set in
              your <em class="filename">makefile</em>, but you want
              users to be able to override the default easily. Conditional
              assignment is perfect for this situation:</p><a></a><pre class="programlisting"># Assume the output directory $(PROJECT_DIR)/out.
OUTPUT_DIR ?= $(PROJECT_DIR)/out</pre><p>Here the assignment is performed only if <code class="literal">OUTPUT_DIR</code> has never been set. We can
              get nearly the same effect more verbosely with:</p><a></a><pre class="programlisting">ifndef OUTPUT_DIR
  # Assume the output directory $(PROJECT_DIR)/out.
  OUTPUT_DIR = $(PROJECT_DIR)/out
endif</pre><p>The difference is that the conditional assignment operator
              will skip the assignment if the variable has been set in any
              way, even to the empty value, while the <code class="literal">ifdef</code> and <code class="literal">ifndef</code> operators test for a nonempty
              value. Thus, <code class="literal">OUTPUT_DIR=</code> is
              considered set by the conditional operator but not defined by
              <code class="literal">ifdef</code>.</p><p>It is important to note that excessive use of environment
              variables makes your <em class="filename">makefile</em>s much less portable, since
              other users are not likely to have the same set of environment
              variables. In fact, I rarely use this feature for precisely that
              reason.</p></dd><dt><span class="term">è‡ªåŠ¨çš„</span></dt><dt><span class="term">Automatic</span></dt><dd><p>æœ€åŽï¼Œ<em class="command">make</em>åˆ›å»º
              <a id="OEBPS/ch03s06.html.make3-CHP-3-ITERM-1095" class="indexterm"></a> <a id="OEBPS/ch03s06.html.make3-CHP-3-ITERM-1096" class="indexterm"></a>åœ¨æ‰§è¡Œè§„åˆ™çš„å‘½ä»¤è„šæœ¬ä¹‹å‰ç«‹å³ä½¿ç”¨è‡ªåŠ¨å˜é‡ã€‚</p></dd><dd><p>Finally, <em class="command">make</em> creates
              <a class="indexterm"></a> <a class="indexterm"></a>automatic variables immediately before executing
              the command script of a rule.</p></dd></dl></div><p>ä¼ ç»Ÿä¸Šï¼ŒçŽ¯å¢ƒå˜é‡ç”¨äºŽå¸®åŠ©ç®¡ç†å¼€å‘äººå‘˜è®¡ç®—æœºä¹‹é—´çš„å·®å¼‚ã€‚ä¾‹å¦‚ï¼Œå¸¸è§çš„æ˜¯
        <a id="OEBPS/ch03s06.html.make3-CHP-3-ITERM-1097" class="indexterm"></a> <a id="OEBPS/ch03s06.html.make3-CHP-3-ITERM-1098" class="indexterm"></a>æ ¹æ® makefile ä¸­å¼•ç”¨çš„çŽ¯å¢ƒå˜é‡åˆ›å»ºå¼€å‘çŽ¯å¢ƒï¼ˆæºä»£ç ã€ç¼–è¯‘çš„è¾“å‡ºæ ‘å’Œå·¥å…·<em class="filename">ï¼‰</em>ã€‚ makefile
        å°†å¼•ç”¨æ¯æ£µæ ‘çš„æ ¹çš„ä¸€ä¸ªçŽ¯å¢ƒå˜é‡<em class="filename">ã€‚</em>å¦‚æžœæºæ–‡ä»¶æ ‘æ˜¯ä»Žå˜é‡<code class="literal">PROJECT_SRC</code>ã€äºŒè¿›åˆ¶è¾“å‡ºæ–‡ä»¶
        <code class="literal">PROJECT_BIN</code>å’Œåº“å¼•ç”¨çš„
        <code class="literal">PROJECT_LIB</code>ï¼Œé‚£ä¹ˆå¼€å‘äººå‘˜å¯ä»¥è‡ªç”±åœ°å°†è¿™äº›æ ‘æ”¾ç½®åœ¨é€‚å½“çš„ä½ç½®ã€‚</p><p>Traditionally, environment variables are used to help manage the
        differences between developer machines. For instance, it is common
        <a class="indexterm"></a> <a class="indexterm"></a>to create a development environment (source code,
        compiled output tree, and tools) based on environment variables
        referenced in the <em class="filename">makefile</em>. The
        <em class="filename">makefile</em> would refer to one
        environment variable for the root of each tree. If the source file
        tree is referenced from a variable <code class="literal">PROJECT_SRC</code>, binary output files from
        <code class="literal">PROJECT_BIN</code>, and libraries from
        <code class="literal">PROJECT_LIB</code>, then developers are
        free to place these trees wherever is appropriate.</p><p>å½“æœªè®¾ç½®è¿™äº›â€œæ ¹â€å˜é‡æ—¶ï¼Œæ­¤æ–¹æ³•ï¼ˆä»¥åŠé€šå¸¸ä½¿ç”¨çŽ¯å¢ƒå˜é‡ï¼‰ä¼šå‡ºçŽ°æ½œåœ¨é—®é¢˜ã€‚ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨èµ‹å€¼å½¢å¼åœ¨<em class="filename">makefile</em>ä¸­æä¾›é»˜è®¤å€¼
        ï¼š<code class="literal">?=</code></p><p>A potential problem with this approach (and with the use of
        environment variables in general) occurs when these "root" variables
        are not set. One solution is to provide default values in the
        <em class="filename">makefile</em> using the <code class="literal">?=</code> form of assignment:</p><a id="OEBPS/ch03s06.html.I_3_tt146"></a><pre class="programlisting">PROJECT_SRC ?= /dev/$(USER)/src
PROJECT_BIN ?= $(patsubst %/src,%/bin,$(PROJECT_SRC))
PROJECT_LIB ?= /net/server/project/lib</pre><pre class="programlisting">PROJECT_SRC ?= /dev/$(USER)/src
PROJECT_BIN ?= $(patsubst %/src,%/bin,$(PROJECT_SRC))
PROJECT_LIB ?= /net/server/project/lib</pre><p>é€šè¿‡ä½¿ç”¨è¿™äº›å˜é‡è®¿é—®é¡¹ç›®ç»„ä»¶ï¼Œæ‚¨å¯ä»¥åˆ›å»ºé€‚åº”ä¸åŒæœºå™¨å¸ƒå±€çš„å¼€å‘çŽ¯å¢ƒã€‚ ï¼ˆæˆ‘ä»¬å°†åœ¨<a class="link" href="#OEBPS/pt02.html" title="ç¬¬äºŒéƒ¨åˆ†ã€‚é«˜çº§å’Œä¸“ä¸šä¸»é¢˜">ç¬¬äºŒéƒ¨åˆ†</a>ä¸­çœ‹åˆ°æ›´å…¨é¢çš„ç¤ºä¾‹ã€‚ï¼‰ä½†æ˜¯ï¼Œè¯·æ³¨æ„è¿‡åº¦ä¾èµ–çŽ¯å¢ƒå˜é‡ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ<em class="filename">makefile</em>åº”è¯¥èƒ½å¤Ÿåœ¨å¼€å‘äººå‘˜çŽ¯å¢ƒçš„æœ€ä½Žæ”¯æŒä¸‹è¿è¡Œï¼Œå› æ­¤è¯·åŠ¡å¿…æä¾›åˆç†çš„é»˜è®¤å€¼å¹¶æ£€æŸ¥å…³é”®ç»„ä»¶æ˜¯å¦å­˜åœ¨ã€‚</p><p>By using these variables to access project components, you can
        create a development environment that is adaptable to varying machine
        layouts. (We will see more comprehensive examples of this in <a class="link" href="#OEBPS/pt02.html" title="Part&nbsp;II.&nbsp;Advanced and Specialized Topics">Part II</a>.) Beware of overreliance on
        environment variables, however. Generally, a <em class="filename">makefile</em> should be able to run with a
        minimum of support from the developer's environment so be sure to
        provide reasonable defaults and check for the existence of critical
        components.</p></div></div></div>
<div id="OEBPS/ch03s07.html"><div>
<div class="sect1" title="æœ‰æ¡ä»¶å¹¶åŒ…æ‹¬å¤„ç†"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch03s07.html.make3-CHP-3-SECT-7"></a>æœ‰æ¡ä»¶å¹¶åŒ…æ‹¬å¤„ç†</h1><h1 class="title"><a></a>Conditional and include Processing</h1></div></div></div><p><em class="filename">makefile</em>çš„æŸäº›éƒ¨åˆ†å¯ä»¥çœç•¥<a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1099" class="indexterm"></a> <a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1100" class="indexterm"></a> <a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1101" class="indexterm"></a> <a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1102" class="indexterm"></a> <a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1103" class="indexterm"></a><em class="firstterm">æˆ–åœ¨ä½¿ç”¨æ¡ä»¶å¤„ç†</em>æŒ‡ä»¤è¯»å–
        <em class="filename">makefile</em>æ—¶é€‰æ‹©ã€‚æŽ§åˆ¶é€‰æ‹©çš„æ¡ä»¶å¯ä»¥æœ‰å¤šç§å½¢å¼ï¼Œä¾‹å¦‚â€œå·²å®šä¹‰â€æˆ–â€œç­‰äºŽâ€ã€‚ä¾‹å¦‚ï¼š<em class="firstterm"></em></p><p>Parts of a <em class="filename">makefile</em> can be
        omitted <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>or selected while the <em class="filename">makefile</em> is being read using
        <em class="firstterm">conditional processing</em> directives. The
        condition that controls the selection can have several forms such as
        "is defined" or "is equal to." For example:</p><a id="OEBPS/ch03s07.html.I_3_tt147"></a><pre class="programlisting"># COMSPEC ä»…åœ¨ Windows ä¸Šå®šä¹‰ã€‚
ifdef è®¡ç®—æœºè§„èŒƒ
  è·¯å¾„_SEP := ;
  EXE_EXT := .exe
åˆ«çš„
  è·¯å¾„_SEP := :
  EXE_EXT :=
ä¸‡ä¸€</pre><pre class="programlisting"># COMSPEC is defined only on Windows.
ifdef COMSPEC
  PATH_SEP := ;
  EXE_EXT  := .exe
else
  PATH_SEP := :
  EXE_EXT  :=
endif</pre><p><code class="literal">COMSPEC</code>å¦‚æžœå®šä¹‰äº†å˜é‡ï¼Œåˆ™é€‰æ‹©æ¡ä»¶çš„ç¬¬ä¸€ä¸ªåˆ†æ”¯
        ã€‚</p><p>This selects the first branch of the conditional if the variable
        <code class="literal">COMSPEC</code> is defined.</p><p>æ¡ä»¶è¯­å¥çš„åŸºæœ¬è¯­æ³•<a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1104" class="indexterm"></a> <a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1105" class="indexterm"></a> <a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1106" class="indexterm"></a>æŒ‡ä»¤æ˜¯ï¼š</p><p>The basic syntax of the conditional<a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> directive is:</p><a id="OEBPS/ch03s07.html.I_3_tt148"></a><pre class="programlisting"><em class="replaceable"><code>if-condition</code></em>
               <em class="replaceable"><code>text if the condition is true</code></em>
ä¸‡ä¸€</pre><pre class="programlisting"><em class="replaceable"><code>if-condition</code></em>
               <em class="replaceable"><code>text if the condition is true</code></em>
endif</pre><p>æˆ–è€…ï¼š</p><p>or:</p><a id="OEBPS/ch03s07.html.I_3_tt149"></a><pre class="programlisting"><em class="replaceable"><code>if-condition</code></em>
               <em class="replaceable"><code>text if the condition is true</code></em>
åˆ«çš„
  <em class="replaceable"><code>text if the condition is false</code></em>
ä¸‡ä¸€</pre><pre class="programlisting"><em class="replaceable"><code>if-condition</code></em>
               <em class="replaceable"><code>text if the condition is true</code></em>
else
  <em class="replaceable"><code>text if the condition is false</code></em>
endif</pre><p>å¯ä»¥<em class="replaceable"><code>if-condition</code></em>æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š</p><p>The <em class="replaceable"><code>if-condition</code></em> can be one
        of:</p><a id="OEBPS/ch03s07.html.I_3_tt150"></a><pre class="programlisting">ifdef <em class="replaceable"><code>variable-name</code></em>
ifndef <em class="replaceable"><code>variable-name</code></em>
ifeq   <em class="replaceable"><code>test</code></em>
ifneq<em class="replaceable"><code>test</code></em></pre><pre class="programlisting">ifdef<em class="replaceable"><code>variable-name</code></em>
ifndef <em class="replaceable"><code>variable-name</code></em>
ifeq  <em class="replaceable"><code>test</code></em>
ifneq <em class="replaceable"><code>test</code></em></pre><p>ä¸åº”è¢«/æµ‹è¯•<em class="replaceable"><code>variable-name</code></em>åŒ…å›´ã€‚æœ€åŽï¼Œ
        å¯ä»¥è¡¨ç¤ºä¸ºï¼š<code class="literal">$( )</code><code class="literal">ifdef</code><code class="literal">ifndef</code><em class="replaceable"><code>test</code></em></p><p>The <em class="replaceable"><code>variable-name</code></em> should not be
        surrounded by <code class="literal">$( )</code> for the <code class="literal">ifdef</code>/<code class="literal">ifndef</code> test. Finally, the
        <em class="replaceable"><code>test</code></em> can be expressed as either of:</p><a id="OEBPS/ch03s07.html.I_3_tt151"></a><pre class="programlisting">â€ <em class="replaceable"><code>a</code></em>â€œâ€ <em class="replaceable"><code>b</code></em>â€œ
( <em class="replaceable"><code>a</code></em>, <em class="replaceable"><code>b</code></em>)</pre><pre class="programlisting">"<em class="replaceable"><code>a</code></em>" "<em class="replaceable"><code>b</code></em>"
(<em class="replaceable"><code>a</code></em>,<em class="replaceable"><code>b</code></em>)</pre><p>å…¶ä¸­å•å¼•å·æˆ–åŒå¼•å·å¯ä»¥äº’æ¢ä½¿ç”¨ï¼ˆä½†æ‚¨ä½¿ç”¨çš„å¼•å·å¿…é¡»åŒ¹é…ï¼‰ã€‚</p><p>in which single or double quotes can be used interchangeably
        (but the quotes you use must match).</p><p><em class="filename">æ¡ä»¶å¤„ç†æŒ‡ä»¤å¯ä»¥åœ¨å®å®šä¹‰å’Œå‘½ä»¤è„šæœ¬ä¸­ä»¥åŠmakefile</em>çš„é¡¶å±‚ä½¿ç”¨
        ï¼š</p><p>The conditional processing directives can be used within macro
        definitions and command scripts as well as at the top level of
        <em class="filename">makefile</em>s:</p><a id="OEBPS/ch03s07.html.I_3_tt152"></a><pre class="programlisting">libGui.a: $(gui_objects)
        $(AR) $(ARFLAGS) $@ $&lt;
    ifdef RANLIB
        $(RANLIB) $@
    ä¸‡ä¸€</pre><pre class="programlisting">libGui.a: $(gui_objects)
        $(AR) $(ARFLAGS) $@ $&lt;
    ifdef RANLIB
        $(RANLIB) $@
    endif</pre><p>æˆ‘å–œæ¬¢ç¼©è¿›æ¡ä»¶è¯­å¥ï¼Œä½†ç²—å¿ƒçš„ç¼©è¿›å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯ã€‚åœ¨å‰é¢çš„è¡Œä¸­ï¼Œæ¡ä»¶æŒ‡ä»¤ç¼©è¿›å››ä¸ªç©ºæ ¼ï¼Œè€ŒåŒ…å«çš„å‘½ä»¤æœ‰ä¸€ä¸ªå‰å¯¼åˆ¶è¡¨ç¬¦ã€‚å¦‚æžœåŒ…å«çš„å‘½ä»¤ä¸ä»¥åˆ¶è¡¨ç¬¦å¼€å¤´ï¼Œåˆ™<em class="command">make</em>ä¸ä¼šå°†å®ƒä»¬è¯†åˆ«ä¸ºå‘½ä»¤ã€‚å¦‚æžœæ¡ä»¶æŒ‡ä»¤æœ‰ä¸€ä¸ªå‰å¯¼é€‰é¡¹å¡ï¼Œå®ƒä»¬å°†è¢«é”™è¯¯åœ°è¯†åˆ«ä¸ºå‘½ä»¤å¹¶ä¼ é€’åˆ°å­ shellã€‚</p><p>I like to indent my conditionals, but careless indentation can
        lead to errors. In the preceding lines, the conditional directives are
        indented four spaces while the enclosed commands have a leading tab.
        If the enclosed commands didn't begin with a tab, they would not be
        recognized as commands by <em class="command">make</em>. If
        the conditional directives had a leading tab, they would be
        misidentified as commands and passed to the subshell.</p><p>å’Œæ¡ä»¶<code class="literal">ifeq</code>å¥<code class="literal">ifneq</code><a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1107" class="indexterm"></a> <a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1108" class="indexterm"></a> <a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1109" class="indexterm"></a> <a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1110" class="indexterm"></a>æµ‹è¯•ä»–ä»¬çš„å‚æ•°æ˜¯å¦ç›¸ç­‰ã€‚æ¡ä»¶å¤„ç†ä¸­çš„ç©ºç™½å¯èƒ½å¾ˆéš¾å¤„ç†ã€‚ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨æµ‹è¯•çš„æ‹¬å·å½¢å¼æ—¶ï¼Œé€—å·åŽé¢çš„ç©ºæ ¼å°†è¢«å¿½ç•¥ï¼Œä½†æ‰€æœ‰å…¶ä»–ç©ºæ ¼éƒ½å¾ˆé‡è¦ï¼š</p><p>The <code class="literal">ifeq</code> and <code class="literal">ifneq</code> conditionals <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>test if their arguments are equal or not equal.
        Whitespace in conditional processing can be tricky to handle. For
        instance, when using the parenthesis form of the test, whitespace
        after the comma is ignored, but all other whitespace is
        significant:</p><a id="OEBPS/ch03s07.html.I_3_tt153"></a><pre class="programlisting">ifeq (a, a)
  # è¿™äº›æ˜¯ç›¸ç­‰çš„
ä¸‡ä¸€

ifeq ( b, b )
  # è¿™äº›ä¸ç›¸ç­‰ - ' b' != 'b '
ä¸‡ä¸€</pre><pre class="programlisting">ifeq (a, a)
  # These are equal
endif

ifeq ( b, b )
  # These are not equal - ' b' != 'b '
endif</pre><p>å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘åšæŒå¼•ç”¨çš„å¹³ç­‰å½¢å¼ï¼š</p><p>Personally, I stick with the quoted forms of equality:</p><a id="OEBPS/ch03s07.html.I_3_tt154"></a><pre class="programlisting">ifeq â€œä¸€â€ â€œä¸€â€
  # è¿™äº›æ˜¯ç›¸ç­‰çš„
ä¸‡ä¸€

ifeq 'b' 'b'
  # è¿™äº›ä¹Ÿæ˜¯
ä¸‡ä¸€</pre><pre class="programlisting">ifeq "a" "a"
  # These are equal
endif

ifeq 'b' 'b'
  # So are these
endif</pre><p>å³ä¾¿å¦‚æ­¤ï¼Œå˜é‡æ‰©å±•ä¸­ç»å¸¸ä¼šåŒ…å«æ„å¤–çš„ç©ºæ ¼ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜<a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1111" class="indexterm"></a> <a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1112" class="indexterm"></a> <a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1113" class="indexterm"></a>å› ä¸ºæ¯”è¾ƒåŒ…æ‹¬æ‰€æœ‰å­—ç¬¦ã€‚è¦åˆ›å»ºæ›´å¥å£®çš„<em class="filename">makefile</em>ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹
        <code class="function">strip</code>å‡½æ•°ï¼š</p><p>Even so, it often occurs that a variable expansion contains
        unexpected whitespace. This can cause problems <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>since the comparison includes all characters. To create
        more robust <em class="filename">makefile</em>s, use the
        <code class="function">strip</code> function:</p><a id="OEBPS/ch03s07.html.I_3_tt155"></a><pre class="programlisting">ifeq "$(strip $(OPTIONS))" "-d"
  ç¼–è¯‘æ ‡å¿— += -DDEBUG
ä¸‡ä¸€</pre><pre class="programlisting">ifeq "$(strip $(OPTIONS))" "-d"
  COMPILATION_FLAGS += -DDEBUG
endif</pre><div class="sect2" title="åŒ…å«æŒ‡ä»¤"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch03s07.html.make3-CHP-3-SECT-7.1"></a>åŒ…å«æŒ‡ä»¤</h2><h2 class="title"><a></a>The include Directive</h2></div></div></div><p>æˆ‘ä»¬é¦–å…ˆçœ‹åˆ°çš„æ˜¯<code class="literal">include</code>
          <a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1114" class="indexterm"></a> <a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1115" class="indexterm"></a>æŒ‡ä»¤<a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™">ç¬¬ 2 ç« </a>ç¬¬<a class="link" href="#OEBPS/ch02s07.html" title="è‡ªåŠ¨ä¾èµ–ç”Ÿæˆ">2.7 èŠ‚</a>ã€‚çŽ°åœ¨è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°è®¨è®ºä¸€ä¸‹ã€‚</p><p>We first saw the <code class="literal">include</code>
          <a class="indexterm"></a> <a class="indexterm"></a>directive in <a class="link" href="#OEBPS/ch02.html" title="Chapter&nbsp;2.&nbsp;Rules">Chapter
          2</a>, in <a class="link" href="#OEBPS/ch02s07.html" title="Automatic Dependency Generation">Section 2.7</a>.
          Now let's go over it in more detail.</p><p><em class="filename">ç”Ÿæˆæ–‡ä»¶</em>å¯ä»¥åŒ…å«å…¶ä»–æ–‡ä»¶ã€‚æœ€å¸¸è§çš„åšæ³•æ˜¯å°†é€šç”¨<em class="command">make</em>å®šä¹‰æ”¾å…¥<em class="command">make</em>å¤´æ–‡ä»¶ä¸­æˆ–åŒ…å«è‡ªåŠ¨ç”Ÿæˆçš„ä¾èµ–å…³ç³»ä¿¡æ¯ã€‚è¯¥<code class="literal">include</code>æŒ‡ä»¤çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><p>A <em class="filename">makefile</em> can include
          other files. This is most commonly done to place common <em class="command">make</em> definitions in a <em class="command">make</em> header file or to include
          automatically generated dependency information. The <code class="literal">include</code> directive is used like
          this:</p><a id="OEBPS/ch03s07.html.I_3_tt156"></a><pre class="programlisting">åŒ…æ‹¬å®šä¹‰.mk</pre><pre class="programlisting">include definitions.mk</pre><p>è¯¥æŒ‡ä»¤å¯ä»¥ç»™å®šä»»æ„æ•°é‡çš„æ–‡ä»¶å’Œ shell é€šé…ç¬¦ï¼Œå¹¶ä¸”ä¹Ÿå…è®¸ä½¿ç”¨<em class="command">makeå˜é‡ã€‚</em></p><p>The directive can be given any number of files and shell
          wildcards and <em class="command">make</em> variables are
          also allowed.</p></div><div class="sect2" title="åŒ…å«å’Œä¾èµ–å…³ç³»"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch03s07.html.make3-CHP-3-SECT-7.2"></a>åŒ…å«å’Œä¾èµ–å…³ç³»</h2><h2 class="title"><a></a>include and Dependencies</h2></div></div></div><p>å½“<em class="command">é‡åˆ°</em>ä¸€ä¸ª
          <code class="literal">include</code> <a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1116" class="indexterm"></a> <a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1117" class="indexterm"></a> <a id="OEBPS/ch03s07.html.make3-CHP-3-ITERM-1118" class="indexterm"></a>æŒ‡ä»¤ï¼Œå®ƒæ‰©å±•é€šé…ç¬¦å’Œå˜é‡å¼•ç”¨ï¼Œç„¶åŽå°è¯•è¯»å–åŒ…å«æ–‡ä»¶ã€‚å¦‚æžœè¯¥æ–‡ä»¶å­˜åœ¨ï¼Œæˆ‘ä»¬å°†æ­£å¸¸ç»§ç»­ã€‚ä½†æ˜¯ï¼Œå¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œ<em class="command">makeä¼šæŠ¥å‘Šè¯¥é—®é¢˜å¹¶ç»§ç»­è¯»å–</em><em class="filename">makefile</em>çš„å…¶ä½™éƒ¨åˆ†ã€‚å½“æ‰€æœ‰è¯»å–å®ŒæˆåŽï¼Œ
           <em class="command">make</em>åœ¨è§„åˆ™æ•°æ®åº“ä¸­æŸ¥æ‰¾ä»»ä½•è§„åˆ™æ¥æ›´æ–°åŒ…å«æ–‡ä»¶ã€‚å¦‚æžœæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œ
           <em class="command">make</em>å°†éµå¾ªæ›´æ–°ç›®æ ‡çš„æ­£å¸¸è¿‡ç¨‹ã€‚å¦‚æžœä»»ä½•åŒ…å«æ–‡ä»¶è¢«è§„åˆ™æ›´æ–°ï¼Œåˆ™<em class="command">make</em>ä¼šæ¸…é™¤å…¶å†…éƒ¨æ•°æ®åº“å¹¶é‡æ–°è¯»å–æ•´ä¸ª<em class="filename">makefile</em>ã€‚å¦‚æžœåœ¨å®Œæˆè¯»å–ã€æ›´æ–°å’Œé‡è¯»è¿‡ç¨‹åŽï¼Œä»ç„¶æœ‰
          <code class="literal">include</code>æŒ‡ä»¤å› ä¸¢å¤±æ–‡ä»¶è€Œå¤±è´¥ï¼Œ<em class="command">åˆ™ make</em>
          å°†ç»ˆæ­¢å¹¶æ˜¾ç¤ºé”™è¯¯çŠ¶æ€ã€‚</p><p>When <em class="command">make</em> encounters an
          <code class="literal">include</code> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> directive, it expands the wildcards and variable
          references, then tries to read the include file. If the file exists,
          we continue normally. If the file does not exist, however, <em class="command">make</em> reports the problem and continues
          reading the rest of the <em class="filename">makefile</em>. When all reading is complete,
          <em class="command">make</em> looks in the rules database
          for any rule to update the include files. If a match is found,
          <em class="command">make</em> follows the normal process
          for updating a target. If any of the include files is updated by a
          rule, <em class="command">make</em> then clears its
          internal database and rereads the entire <em class="filename">makefile</em>. If, after completing the
          process of reading, updating, and rereading, there are still
          <code class="literal">include</code> directives that have
          failed due to missing files, <em class="command">make</em>
          terminates with an error status.</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶çš„ç¤ºä¾‹æ¥æŸ¥çœ‹æ­¤è¿‡ç¨‹çš„å®žé™…æƒ…å†µã€‚æˆ‘ä»¬ä½¿ç”¨<code class="function">warning</code>
          å†…ç½®å‡½æ•°ä»Ž<em class="command">make</em>æ‰“å°ä¸€æ¡ç®€å•çš„æ¶ˆæ¯ã€‚ ï¼ˆè¿™ä¸ªå‡½æ•°å’Œå…¶ä»–å‡½æ•°å°†åœ¨<a class="link" href="#OEBPS/ch04.html" title="ç¬¬ 4 ç« å‡½æ•°">ç¬¬ 4 ç« </a>ä¸­è¯¦ç»†ä»‹ç»ã€‚ï¼‰è¿™æ˜¯<em class="filename">makefile</em>ï¼š</p><p>We can see this process in action with the following two-file
          example. We use the <code class="function">warning</code>
          built-in function to print a simple message from <em class="command">make</em>. (This and other functions are
          covered in detail in <a class="link" href="#OEBPS/ch04.html" title="Chapter&nbsp;4.&nbsp;Functions">Chapter 4</a>.)
          Here is the <em class="filename">makefile</em>:</p><a id="OEBPS/ch03s07.html.I_3_tt157"></a><pre class="programlisting"># ç®€å•çš„ makefile åŒ…æ‹¬ç”Ÿæˆçš„æ–‡ä»¶ã€‚
åŒ…æ‹¬ foo.mk
$(è­¦å‘Šå·²å®ŒæˆåŒ…æ‹¬)

foo.mk: é…’å§.mk
        m4 --define=FILENAME=$@ bar.mk &gt; $@</pre><pre class="programlisting"># Simple makefile including a generated file.
include foo.mk
$(warning Finished include)

foo.mk: bar.mk
        m4 --define=FILENAME=$@ bar.mk &gt; $@</pre><p>è¿™æ˜¯<em class="filename">bar.mk</em>ï¼ŒåŒ…å«æ–‡ä»¶çš„æºä»£ç ï¼š</p><p>and here is <em class="filename">bar.mk</em>, the
          source for the included file:</p><a id="OEBPS/ch03s07.html.I_3_tt158"></a><pre class="programlisting"># bar.mk - å½“æˆ‘è¢«é˜…è¯»æ—¶æŠ¥å‘Šã€‚
$(è­¦å‘Šè¯»å–æ–‡ä»¶å)</pre><pre class="programlisting"># bar.mk - Report when I am being read.
$(warning Reading FILENAME)</pre><p>è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼š</p><p>When run, we see:</p><a id="OEBPS/ch03s07.html.I_3_tt159"></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
Makefile:2: foo.mk: æ²¡æœ‰è¿™æ ·çš„æ–‡ä»¶æˆ–ç›®å½•
Makefile:3: å®ŒæˆåŒ…å«
m4 --define=FILENAME=foo.mk bar.mk &gt; foo.mk
foo.mk:2: è¯»å– foo.mk
Makefile:3: å®ŒæˆåŒ…å«
make: `foo.mk' æ˜¯æœ€æ–°çš„ã€‚</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
Makefile:2: foo.mk: No such file or directory
Makefile:3: Finished include
m4 --define=FILENAME=foo.mk bar.mk &gt; foo.mk
foo.mk:2: Reading foo.mk
Makefile:3: Finished include
make: `foo.mk' is up to date.</pre><p>ç¬¬ä¸€è¡Œæ˜¾ç¤º<em class="command">make</em>æ‰¾ä¸åˆ°åŒ…å«æ–‡ä»¶ï¼Œä½†ç¬¬äºŒè¡Œæ˜¾ç¤º<em class="command">make</em>ä¸æ–­è¯»å–å¹¶æ‰§è¡Œ<em class="filename">makefile</em>ã€‚å®Œæˆè¯»å–åŽï¼Œ
           <em class="command">make</em>å‘çŽ°åˆ›å»ºåŒ…å«æ–‡ä»¶<em class="filename">foo.mk çš„</em>è§„åˆ™ï¼Œå¹¶æ‰§è¡Œæ­¤æ“ä½œã€‚ç„¶åŽ<em class="command">make</em>å†æ¬¡å¼€å§‹æ•´ä¸ªè¿‡ç¨‹â€‹â€‹ï¼Œè¿™æ¬¡è¯»å–åŒ…å«æ–‡ä»¶ä¸ä¼šé‡åˆ°ä»»ä½•å›°éš¾ã€‚</p><p>The first line shows that <em class="command">make</em> cannot find the include file, but the
          second line shows that <em class="command">make</em> keeps
          reading and executing the <em class="filename">makefile</em>. After completing the read,
          <em class="command">make</em> discovers a rule to create
          the include file, <em class="filename">foo.mk</em>, and
          it does so. Then <em class="command">make</em> starts the
          whole process again, this time without encountering any difficulty
          reading the include file.</p><p>çŽ°åœ¨æ˜¯æ—¶å€™æåŠ<em class="command">make</em>è¿˜å°†æŠŠ<em class="filename">makefile</em>æœ¬èº«è§†ä¸ºå¯èƒ½çš„ç›®æ ‡ã€‚è¯»å–æ•´ä¸ª<em class="filename">makefileåŽï¼Œ </em><em class="command">make</em>å°†æŸ¥æ‰¾è§„åˆ™æ¥é‡æ–°ç”Ÿæˆå½“å‰æ­£åœ¨æ‰§è¡Œçš„<em class="filename">makefile</em>ã€‚å¦‚æžœæ‰¾åˆ°ï¼Œ<em class="command">make</em>å°†å¤„ç†è¯¥è§„åˆ™ï¼Œç„¶åŽæ£€æŸ¥<em class="filename">makefile</em>æ˜¯å¦å·²æ›´æ–°ã€‚å¦‚æžœæ˜¯è¿™æ ·ï¼Œ<em class="command">make</em>å°†æ¸…é™¤å…¶å†…éƒ¨çŠ¶æ€å¹¶é‡æ–°è¯»å–<em class="filename">makefile</em>ï¼Œé‡æ–°æ‰§è¡Œæ•´ä¸ªåˆ†æžã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäºŽè¿™ç§è¡Œä¸ºçš„æ— é™å¾ªçŽ¯çš„æ„šè ¢ç¤ºä¾‹ï¼š</p><p>Now is a good time to mention that <em class="command">make</em> will also treat the <em class="filename">makefile</em> itself as a possible target.
          After the entire <em class="filename">makefile</em> has
          been read, <em class="command">make</em> will look for a
          rule to remake the currently executing <em class="filename">makefile</em>. If it finds one, <em class="command">make</em> will process the rule, then check if
          the <em class="filename">makefile</em> has been updated.
          If so, <em class="command">make</em> will clear its
          internal state and reread the <em class="filename">makefile</em>, performing the whole analysis
          over again. Here is a silly example of an infinite loop based on
          this behavior:</p><a id="OEBPS/ch03s07.html.I_3_tt160"></a><pre class="programlisting">.PHONYï¼šå‡äºº
makefileï¼šè™šæ‹Ÿ
        è§¦æ‘¸$@</pre><pre class="programlisting">.PHONY: dummy
makefile: dummy
        touch $@</pre><p>å½“<em class="command">make</em>æ‰§è¡Œæ­¤
          <em class="filename">makefile</em>æ—¶ï¼Œå®ƒâ€‹â€‹å‘çŽ°
          <em class="filename">makefile</em>å·²è¿‡æœŸï¼ˆå› ä¸º<code class="literal">.PHONY</code>ç›®æ ‡
          <em class="filename">dummy</em>å·²è¿‡æœŸï¼‰ï¼Œå› æ­¤å®ƒæ‰§è¡Œ<em class="command">touchå‘½ä»¤ï¼Œè¯¥å‘½ä»¤æ›´æ–°</em><em class="filename">makefile</em>çš„æ—¶é—´æˆ³ã€‚ç„¶åŽ<em class="command">make</em>é‡æ–°è¯»å–è¯¥æ–‡ä»¶ï¼Œå‘çŽ°<em class="filename">makefile</em>å·²ç»è¿‡æœŸã€‚ ã€‚ ã€‚ ã€‚åæ­£ä½ æ‡‚è¿™ä¸ªæ„æ€ã€‚</p><p>When <em class="command">make</em> executes this
          <em class="filename">makefile</em>, it sees that the
          <em class="filename">makefile</em> is out of date
          (because the <code class="literal">.PHONY</code> target,
          <em class="filename">dummy</em>, is out of date) so it
          executes the <em class="command">touch</em> command, which
          updates the timestamp of the <em class="filename">makefile</em>. Then <em class="command">make</em> rereads the file and discovers that
          the <em class="filename">makefile</em> is out of date. .
          . . Well, you get the idea.</p><p><em class="command">make</em>åœ¨å“ªé‡ŒæŸ¥æ‰¾åŒ…å«çš„æ–‡ä»¶ï¼Ÿæ˜¾ç„¶ï¼Œå¦‚æžœ çš„å‚æ•°<code class="literal">include</code>æ˜¯ç»å¯¹æ–‡ä»¶å¼•ç”¨ï¼Œ
          <em class="command">åˆ™ make</em>è¯»å–è¯¥æ–‡ä»¶ã€‚å¦‚æžœæ–‡ä»¶å¼•ç”¨æ˜¯ç›¸å¯¹çš„ï¼Œåˆ™<em class="command">make</em>é¦–å…ˆæŸ¥æ‰¾å…¶å½“å‰å·¥ä½œç›®å½•ã€‚å¦‚æžœ<em class="command">make</em>æ‰¾ä¸åˆ°è¯¥æ–‡ä»¶ï¼Œå®ƒå°†ç»§ç»­æœç´¢æ‚¨ä½¿ç”¨<code class="option">â€”include-dir</code>(æˆ–
          <code class="option">-I</code>) é€‰é¡¹åœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šçš„ä»»ä½•ç›®å½•ã€‚ä¹‹åŽï¼Œ<em class="command">make</em>æœç´¢ç±»ä¼¼äºŽä»¥ä¸‹çš„å·²ç¼–è¯‘æœç´¢è·¯å¾„ï¼š<em class="filename">/usr/local/include</em>ã€
           <em class="filename">/usr/gnu/include</em>ã€<em class="filename">/usr/include</em>ã€‚ç”±äºŽ<em class="command">make çš„</em>ç¼–è¯‘æ–¹å¼ä¸åŒï¼Œè¯¥è·¯å¾„å¯èƒ½ä¼šç•¥æœ‰ä¸åŒã€‚</p><p>Where does <em class="command">make</em> look for
          included files? Clearly, if the argument to <code class="literal">include</code> is an absolute file reference,
          <em class="command">make</em> reads that file. If the file
          reference is relative, <em class="command">make</em> first
          looks in its current working directory. If <em class="command">make</em> cannot find the file, it then
          proceeds to search through any directories you have specified on the
          command line using the <code class="option">â€”include-dir</code> (or
          <code class="option">-I</code>) option. After that, <em class="command">make</em> searches a compiled search path
          similar to: <em class="filename">/usr/local/include</em>,
          <em class="filename">/usr/gnu/include</em>, <em class="filename">/usr/include</em>. There may be slight
          variations of this path due to the way <em class="command">make</em> was compiled.</p><p>å¦‚æžœ<em class="command">make</em>æ‰¾ä¸åˆ°åŒ…å«æ–‡ä»¶å¹¶ä¸”æ— æ³•ä½¿ç”¨è§„åˆ™åˆ›å»ºå®ƒï¼Œ<em class="command">åˆ™ make</em>å°†é€€å‡ºå¹¶å‡ºçŽ°é”™è¯¯ã€‚å¦‚æžœæ‚¨å¸Œæœ›
          <em class="command">make</em>å¿½ç•¥å®ƒæ— æ³•åŠ è½½çš„åŒ…å«æ–‡ä»¶ï¼Œè¯·åœ¨<code class="literal">include</code>æŒ‡ä»¤ä¸­æ·»åŠ ä¸€ä¸ªå‰å¯¼ç ´æŠ˜å·ï¼š</p><p>If <em class="command">make</em> cannot find the
          include file and it cannot create it using a rule, <em class="command">make</em> exits with an error. If you want
          <em class="command">make</em> to ignore include files it
          cannot load, add a leading dash to the <code class="literal">include</code> directive:</p><a id="OEBPS/ch03s07.html.I_3_tt161"></a><pre class="programlisting">-åŒ…æ‹¬æˆ‘å¯èƒ½ä¸å­˜åœ¨.mk</pre><pre class="programlisting">-include i-may-not-exist.mk</pre><p>ä¸ºäº†ä¸Žå…¶ä»–<em class="command">make</em>å…¼å®¹ï¼Œè¯¥è¯<code class="literal">sinclude</code>æ˜¯ çš„åˆ«å<code class="literal">-include</code>ã€‚</p><p>For compatibility with other <em class="command">make</em>s, the word <code class="literal">sinclude</code> is an alias for <code class="literal">-include</code>.</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ makefile ä¸­çš„ç¬¬ä¸€ä¸ªç›®æ ‡ä¹‹å‰ä½¿ç”¨ include æŒ‡ä»¤å¯èƒ½ä¼šæ›´æ”¹é»˜è®¤ç›®æ ‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœåŒ…å«æ–‡ä»¶åŒ…å«ä»»ä½•ç›®æ ‡ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªç›®æ ‡å°†æˆä¸º makefile çš„é»˜è®¤ç›®æ ‡ã€‚åªéœ€å°†æ‰€éœ€çš„é»˜è®¤ç›®æ ‡æ”¾åœ¨åŒ…å«ä¹‹å‰å³å¯é¿å…è¿™ç§æƒ…å†µï¼ˆå³ä½¿æ²¡æœ‰å…ˆå†³æ¡ä»¶æˆ–ç›®æ ‡ï¼‰ï¼š</p><p>It is worth noting that using an include directive before the
          first target in a makefile might change the default goal. That is,
          if the include file contains any targets at all the first of those
          targets will become the default goal for the makefile. This can be
          avoided by simply placing the desired default goal before the
          include (even without prerequisites or targets): </p><a id="OEBPS/ch03s07.html.I_programlisting3_d1e7699"></a><pre class="programlisting"># ç¡®ä¿å…¨éƒ¨æ˜¯é»˜è®¤ç›®æ ‡ã€‚
å…¨éƒ¨ï¼š
åŒ…æ‹¬æ”¯æŒ.mk
# çŽ°åœ¨æˆ‘ä»¬å·²ç»å®šä¹‰äº†å˜é‡ï¼Œå®Œæˆ all ç›®æ ‡ã€‚
å…¨éƒ¨ï¼š$ï¼ˆç¨‹åºï¼‰</pre><pre class="programlisting"># Ensure all is the default goal.
all:
include support.mk
# Now that we have our variables defined, complete the all target.
all: $(programs)</pre></div></div></div></div>
<div id="OEBPS/ch03s08.html"><div>
<div class="sect1" title="æ ‡å‡† make å˜é‡"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch03s08.html.make3-CHP-3-SECT-8"></a>æ ‡å‡† make å˜é‡</h1><h1 class="title"><a></a>Standard make Variables</h1></div></div></div><p>é™¤äº†è‡ªåŠ¨å˜é‡ä¹‹å¤–ï¼Œ<em class="command">make</em>è¿˜ç»´æŠ¤ä¸€äº›æ­ç¤ºå…¶è‡ªèº«çŠ¶æ€çš„å˜é‡ä»¥åŠç”¨äºŽå®šåˆ¶å†…ç½®è§„åˆ™çš„å˜é‡ï¼š</p><p>In addition to automatic variables, <em class="command">make</em> maintains variables revealing bits and
        pieces of its own state as well as variables for customizing built-in
        rules:</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">MAKE_VERSION</code> <a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1119" class="indexterm"></a> <a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1120" class="indexterm"></a></span></dt><dt><span class="term"><code class="literal">MAKE_VERSION</code> <a class="indexterm"></a> <a class="indexterm"></a></span></dt><dd><p>è¿™æ˜¯ç‰ˆæœ¬<a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1121" class="indexterm"></a> <a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1122" class="indexterm"></a><acronym class="acronym">GNU </acronym> <em class="command">make</em>çš„æ•°é‡ã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œå…¶å€¼ä¸º<code class="literal">3.80</code>ï¼ŒCVS å­˜å‚¨åº“ä¸­çš„å€¼ä¸º<code class="literal">3.81rc1</code>ã€‚</p><p>ä¹‹å‰ç‰ˆæœ¬çš„<em class="command">make</em> 3.79.1 ä¸æ”¯æŒ
              <code class="function">eval</code>å’Œ<code class="function">value</code>å‡½æ•°ï¼ˆä»¥åŠå…¶ä»–æ›´æ”¹ï¼‰ï¼Œä½†å®ƒä»ç„¶å¾ˆå¸¸è§ã€‚å› æ­¤ï¼Œå½“æˆ‘ç¼–å†™éœ€è¦è¿™äº›åŠŸèƒ½çš„<em class="filename">makefile</em>æ—¶ï¼Œæˆ‘ä½¿ç”¨æ­¤å˜é‡æ¥æµ‹è¯•æˆ‘æ­£åœ¨è¿è¡Œçš„<em class="command">make</em>ç‰ˆæœ¬ã€‚æˆ‘ä»¬å°†åœ¨<a class="link" href="#OEBPS/ch04.html" title="ç¬¬ 4 ç« å‡½æ•°">ç¬¬ 4 ç« </a>çš„<a class="link" href="#OEBPS/ch04s02.html.make3-CHP-4-SECT-2.4" title="æµé‡æŽ§åˆ¶">4.2.4 èŠ‚</a>ä¸­çœ‹åˆ°ä¸€ä¸ªä¾‹å­ã€‚<a class="link" href="#OEBPS/ch04.html" title="ç¬¬ 4 ç« å‡½æ•°"></a></p></dd><dd><p>This is the version <a class="indexterm"></a> <a class="indexterm"></a>number of <acronym class="acronym">GNU</acronym> <em class="command">make</em>. At the time of this writing, its
              value is <code class="literal">3.80</code>, and the value
              in the CVS repository is <code class="literal">3.81rc1</code>.</p><p>The previous version of <em class="command">make</em>, 3.79.1, did not support the
              <code class="function">eval</code> and <code class="function">value</code> functions (among other changes)
              and it is still very common. So when I write <em class="filename">makefile</em>s that require these
              features, I use this variable to test the version of <em class="command">make</em> I'm running. We'll see an example
              of that in <a class="link" href="#OEBPS/ch04s02.html.make3-CHP-4-SECT-2.4" title="Flow Control">Section
              4.2.4</a> in <a class="link" href="#OEBPS/ch04.html" title="Chapter&nbsp;4.&nbsp;Functions">Chapter
              4</a>.</p></dd><dt><span class="term"><code class="literal">CURDIR</code> <a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1123" class="indexterm"></a> <a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1124" class="indexterm"></a></span></dt><dt><span class="term"><code class="literal">CURDIR</code> <a class="indexterm"></a> <a class="indexterm"></a></span></dt><dd><p>è¯¥å˜é‡åŒ…å«å½“å‰<a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1125" class="indexterm"></a> <a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1126" class="indexterm"></a> <a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1127" class="indexterm"></a><em class="command">æ‰§è¡Œmake</em>è¿›ç¨‹çš„å·¥ä½œç›®å½• (cwd) ã€‚è¿™å°†ä¸Žæ‰§è¡Œ<em class="command">make</em>ç¨‹åºçš„ç›®å½•ç›¸åŒï¼ˆå¹¶ä¸”ä¸Ž shell å˜é‡ç›¸åŒ
              <code class="literal">PWD</code>ï¼‰ï¼Œé™¤éž
              ä½¿ç”¨<code class="option">â€”directory</code>( ) é€‰é¡¹ã€‚<code class="option">-C</code>è¯¥<code class="option">â€”directory</code>é€‰é¡¹æŒ‡ç¤º<em class="command">make</em>åœ¨æœç´¢ä»»ä½•<em class="filename">makefile</em>ä¹‹å‰æ›´æ”¹åˆ°ä¸åŒçš„ç›®å½•ã€‚è¯¥é€‰é¡¹çš„å®Œæ•´å½¢å¼æ˜¯<code class="option">â€”directory=</code>
              <em class="replaceable"><code>directory-name</code></em>or <code class="option">-C
              </code> <em class="replaceable"><code>directory-name</code></em>ã€‚å¦‚æžœ
              <code class="option">â€”directory</code>ä½¿ç”¨ï¼Œ<code class="literal">CURDIR</code>å°†åŒ…å« çš„ç›®å½•å‚æ•°<code class="option">â€”include-dir</code>ã€‚</p><p>æˆ‘é€šå¸¸åœ¨ç¼–ç æ—¶
              ä»Ž<em class="command">emacsè°ƒç”¨</em><em class="command">make</em> ã€‚ä¾‹å¦‚ï¼Œæˆ‘å½“å‰çš„é¡¹ç›®æ˜¯ç”¨ Java ç¼–å†™çš„ï¼Œå¹¶
              åœ¨é¡¶çº§ç›®å½•ï¼ˆä¸ä¸€å®šæ˜¯åŒ…å«ä»£ç çš„ç›®å½•ï¼‰ä¸­ä½¿ç”¨å•ä¸ª<em class="filename">makefile</em> ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨è¯¥é€‰é¡¹å…è®¸æˆ‘ä»Žæºæ ‘ä¸­çš„ä»»ä½•ç›®å½•è°ƒç”¨<em class="command">makeå¹¶ä»ç„¶è®¿é—®</em><em class="filename">makefile</em>ã€‚åœ¨<em class="filename">makefile</em>ä¸­ï¼Œæ‰€æœ‰è·¯å¾„éƒ½ç›¸å¯¹äºŽ<em class="filename">makefile</em>ç›®å½•ã€‚æœ‰æ—¶éœ€è¦ç»å¯¹è·¯å¾„ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨.<em class="command"></em><em class="filename"></em><code class="option">â€”directory</code><em class="command"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><code class="literal">CURDIR</code></p></dd><dd><p>This variable contains the current <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>working directory (cwd) of the executing <em class="command">make</em> process. This will be the same
              directory the <em class="command">make</em> program
              was executed from (and it will be the same as the shell variable
              <code class="literal">PWD</code>), unless the
              <code class="option">â€”directory</code> (<code class="option">-C</code>) option is
              used. The <code class="option">â€”directory</code> option instructs <em class="command">make</em> to change to a different
              directory before searching for any <em class="filename">makefile</em>. The complete form of the
              option is <code class="option">â€”directory=</code>
              <em class="replaceable"><code>directory-name</code></em> or <code class="option">-C
              </code> <em class="replaceable"><code>directory-name</code></em>. If
              <code class="option">â€”directory</code> is used, <code class="literal">CURDIR</code> will contain the directory
              argument to <code class="option">â€”include-dir</code>.</p><p>I typically invoke <em class="command">make</em>
              from <em class="command">emacs</em> while coding. For
              instance, my current project is in Java and uses a single
              <em class="filename">makefile</em> in a top-level
              directory (not necessarily the directory containing the code).
              In this case, using the <code class="option">â€”directory</code> option
              allows me to invoke <em class="command">make</em> from
              any directory in the source tree and still access the <em class="filename">makefile</em>. Within the <em class="filename">makefile</em>, all paths are relative to
              the <em class="filename">makefile</em> directory.
              Absolute paths are occasionally required and these are accessed
              using <code class="literal">CURDIR</code>.</p></dd><dt><span class="term"><code class="literal">MAKEFILE_LIST</code> <a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1128" class="indexterm"></a> <a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1129" class="indexterm"></a></span></dt><dt><span class="term"><code class="literal">MAKEFILE_LIST</code> <a class="indexterm"></a> <a class="indexterm"></a></span></dt><dd><p>è¯¥å˜é‡åŒ…å«<a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1130" class="indexterm"></a> <a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1131" class="indexterm"></a><em class="command">make</em>å·²è¯»å–çš„æ¯ä¸ªæ–‡ä»¶çš„åˆ—è¡¨ï¼ŒåŒ…æ‹¬é»˜è®¤
              <em class="filename">makefile</em>å’Œåœ¨å‘½ä»¤è¡Œæˆ–é€šè¿‡æŒ‡ä»¤æŒ‡å®šçš„<em class="filename">makefile</em><code class="literal">include</code> 
              ã€‚åœ¨è¯»å–æ¯ä¸ªæ–‡ä»¶ä¹‹å‰ï¼Œåç§°ä¼šé™„åŠ åˆ°<code class="literal">MAKEFILE_LIST</code>
              å˜é‡ä¸­ã€‚å› æ­¤ï¼Œ<em class="filename">makefile</em>å§‹ç»ˆå¯ä»¥é€šè¿‡æ£€æŸ¥åˆ—è¡¨çš„æœ€åŽä¸€ä¸ªå•è¯æ¥ç¡®å®šè‡ªå·±çš„åç§°ã€‚</p></dd><dd><p>This variable contains <a class="indexterm"></a> <a class="indexterm"></a>a list of each file <em class="command">make</em> has read including the default
              <em class="filename">makefile</em> and <em class="filename">makefile</em>s specified on the command
              line or through <code class="literal">include</code>
              directives. Just before each file is read, the name is appended
              to the <code class="literal">MAKEFILE_LIST</code>
              variable. So a <em class="filename">makefile</em> can
              always determine its own name by examining the last word of the
              list.</p></dd><dt><span class="term"><code class="literal">MAKECMDGOALS</code> <a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1132" class="indexterm"></a> <a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1133" class="indexterm"></a></span></dt><dt><span class="term"><code class="literal">MAKECMDGOALS</code> <a class="indexterm"></a> <a class="indexterm"></a></span></dt><dd><p>å˜é‡<code class="literal">MAKECMDGOALS</code>
              â€‹<a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1134" class="indexterm"></a> <a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1135" class="indexterm"></a><em class="command">åŒ…å«åœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šçš„å½“å‰æ‰§è¡Œmake</em>çš„æ‰€æœ‰ç›®æ ‡çš„åˆ—è¡¨ã€‚å®ƒä¸åŒ…æ‹¬å‘½ä»¤è¡Œé€‰é¡¹æˆ–å˜é‡åˆ†é…ã€‚ä¾‹å¦‚ï¼š</p><a id="OEBPS/ch03s08.html.I_3_tt162"></a><pre class="programlisting">$ make -f- FOO=bar -k goal &lt;&lt;&lt; 'ç›®æ ‡:;# $(MAKECMDGOALS)'
ï¼ƒ ç›®æ ‡</pre><p>è¯¥ç¤ºä¾‹ä½¿ç”¨â€œæŠ€å·§â€å‘Šè¯‰<em class="command">make</em>ä½¿ç”¨
              (æˆ–)é€‰é¡¹ä»Ž<em class="filename">æ ‡å‡†è¾“å…¥</em>è¯»å–<em class="filename">makefile</em>ã€‚ä½¿ç”¨<em class="command">bash</em>çš„<em class="firstterm">æ­¤å¤„å­—ç¬¦ä¸²</em>â€œ&lt;&lt;&lt;â€è¯­æ³•ä»Žå‘½ä»¤è¡Œå­—ç¬¦ä¸²é‡å®šå‘<em class="filename">æ ‡å‡†</em>è¾“å…¥ã€‚ <sup>[ </sup><sup><a id="OEBPS/ch03s08.html.make3-CHP-3-FNOTE-3" href="#OEBPS/ch03s08.html.ftn.make3-CHP-3-FNOTE-3" class="footnote">3</a></sup><sup> ]</sup> makefile
              æœ¬èº«åŒ…å«é»˜è®¤ç›®æ ‡ï¼Œè€Œå‘½ä»¤è„šæœ¬åˆ™åœ¨åŒä¸€è¡Œç»™å‡º<em class="filename">ï¼Œ</em>ç”¨åˆ†å·åˆ†éš”ç›®æ ‡å’Œå‘½ä»¤ã€‚å‘½ä»¤è„šæœ¬åŒ…å«ä¸€è¡Œï¼š<em class="filename"></em><code class="option">-f-</code><code class="option">â€”file</code><em class="filename"></em><em class="command"></em><em class="firstterm"></em><sup><a id="OEBPS/ch03s08.html.make3-CHP-3-FNOTE-3" href="#OEBPS/ch03s08.html.ftn.make3-CHP-3-FNOTE-3" class="footnote"></a></sup><em class="filename"></em><code class="literal">goal</code></p><a id="OEBPS/ch03s08.html.I_3_tt163"></a><pre class="programlisting"># $(MAKECMDç›®æ ‡)</pre><p><code class="literal">MAKECMDGOALS</code>é€šå¸¸åœ¨ç›®æ ‡éœ€è¦ç‰¹æ®Šå¤„ç†æ—¶ä½¿ç”¨ã€‚ä¸»è¦çš„ä¾‹å­æ˜¯â€œå¹²å‡€â€ç›®æ ‡ã€‚å½“è°ƒç”¨â€œcleanâ€æ—¶ï¼Œ
               <em class="command">make</em>ä¸åº”æ‰§è¡Œé€šå¸¸è§¦å‘çš„ä¾èµ–æ–‡ä»¶ç”Ÿæˆ<code class="literal">include</code>ï¼ˆåœ¨ç¬¬<a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™">2 ç« çš„</a><a class="link" href="#OEBPS/ch02s07.html" title="è‡ªåŠ¨ä¾èµ–ç”Ÿæˆ">2.7 èŠ‚</a>ä¸­è®¨è®ºï¼‰ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§ä½¿ç”¨
              ï¼Œå¹¶ä¸”ï¼š<a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™"></a><code class="literal">ifneq</code><code class="literal">MAKECMDGOALS</code></p><a id="OEBPS/ch03s08.html.I_3_tt164"></a><pre class="programlisting">ifneq "$(MAKECMDGOALS)" "å¹²å‡€"
  -åŒ…æ‹¬ $(subst .xml,.d,$(xml_src))
ä¸‡ä¸€</pre></dd><dd><p>The <code class="literal">MAKECMDGOALS</code>
              variable <a class="indexterm"></a> <a class="indexterm"></a>contains a list of all the targets specified on
              the command line for the current execution of <em class="command">make</em>. It does not include command-line
              options or variable assignments. For instance:</p><a></a><pre class="programlisting">$ make -f- FOO=bar -k goal &lt;&lt;&lt; 'goal:;# $(MAKECMDGOALS)'
# goal</pre><p>The example uses the "trick" of telling <em class="command">make</em> to read the <em class="filename">makefile</em> from the <em class="filename">stdin</em> with the <code class="option">-f-</code>
              (or <code class="option">â€”file</code>) option. The <em class="filename">stdin</em> is redirected from a
              command-line string using <em class="command">bash</em>'s <em class="firstterm">here
              string</em>, "&lt;&lt;&lt;", syntax.<sup>[<a href="#OEBPS/ch03s08.html.ftn.make3-CHP-3-FNOTE-3" class="footnote">3</a>]</sup> The <em class="filename">makefile</em>
              itself consists of the default goal <code class="literal">goal</code>, while the command script is
              given on the same line by separating the target from the command
              with a semicolon. The command script contains the single
              line:</p><a></a><pre class="programlisting"># $(MAKECMDGOALS)</pre><p><code class="literal">MAKECMDGOALS</code> is
              typically used when a target requires special handling. The
              primary example is the "clean" target. When invoking "clean,"
              <em class="command">make</em> should not perform the
              usual dependency file generation triggered by <code class="literal">include</code> (discussed in <a class="link" href="#OEBPS/ch02s07.html" title="Automatic Dependency Generation">Section 2.7</a> in <a class="link" href="#OEBPS/ch02.html" title="Chapter&nbsp;2.&nbsp;Rules">Chapter 2</a>). To prevent this use
              <code class="literal">ifneq</code> and <code class="literal">MAKECMDGOALS</code>:</p><a></a><pre class="programlisting">ifneq "$(MAKECMDGOALS)" "clean"
  -include $(subst .xml,.d,$(xml_src))
endif</pre></dd><dt><span class="term"><code class="literal">.VARIABLES</code> <a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1136" class="indexterm"></a> <a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1137" class="indexterm"></a></span></dt><dt><span class="term"><code class="literal">.VARIABLES</code> <a class="indexterm"></a> <a class="indexterm"></a></span></dt><dd><p>è¿™åŒ…å«ä¸€ä¸ªåˆ—è¡¨<a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1138" class="indexterm"></a> <a id="OEBPS/ch03s08.html.make3-CHP-3-ITERM-1139" class="indexterm"></a><em class="filename">åˆ°ç›®å‰ä¸ºæ­¢è¯»å–çš„makefile</em>ä¸­å®šä¹‰çš„æ‰€æœ‰å˜é‡çš„åç§°
              ï¼Œç‰¹å®šäºŽç›®æ ‡çš„å˜é‡é™¤å¤–ã€‚è¯¥å˜é‡æ˜¯åªè¯»çš„ï¼Œå¯¹å…¶è¿›è¡Œçš„ä»»ä½•èµ‹å€¼éƒ½å°†è¢«å¿½ç•¥ã€‚</p><a id="OEBPS/ch03s08.html.I_3_tt165"></a><pre class="programlisting">åˆ—è¡¨ï¼š
        @echo "$(.VARIABLES)" | tr ' ' '\015' | grep MAKEF
$ åˆ¶ä½œ
åˆ¶ä½œæ ‡å¿—
MAKEFILE_åˆ—è¡¨
ç”Ÿæˆæ–‡ä»¶</pre></dd><dd><p>This contains a list <a class="indexterm"></a> <a class="indexterm"></a>of the names of all the variables defined in
              <em class="filename">makefile</em>s read so far, with
              the exception of target-specific variables. The variable is
              read-only and any assignment to it is ignored.</p><a></a><pre class="programlisting">list:
        @echo "$(.VARIABLES)" | tr ' ' '\015' | grep MAKEF
$ make
MAKEFLAGS
MAKEFILE_LIST
MAKEFILES</pre></dd></dl></div><p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œå˜é‡è¿˜ç”¨äºŽè‡ªå®šä¹‰<em class="command">make</em>å†…ç½®çš„éšå¼è§„åˆ™ã€‚ C/C++ çš„è§„åˆ™æ˜¯æ‰€æœ‰ç¼–ç¨‹è¯­è¨€ä¸­è¿™äº›å˜é‡æ‰€é‡‡ç”¨çš„å…¸åž‹å½¢å¼ã€‚<a class="link" href="#OEBPS/ch03s08.html.make3-CHP-3-FIG-1" title="å›¾ 3-1ã€‚ C/C++ ç¼–è¯‘çš„å˜é‡">å›¾ 3-1</a>æ˜¾ç¤ºäº†æŽ§åˆ¶ä»Žä¸€ç§æ–‡ä»¶ç±»åž‹åˆ°å¦ä¸€ç§æ–‡ä»¶ç±»åž‹çš„è½¬æ¢çš„å˜é‡ã€‚</p><p>As you've seen, variables are also used to customize the
        implicit rules built in to <em class="command">make</em>.
        The rules for C/C++ are typical of the form these variables take for
        all programming languages. <a class="link" href="#OEBPS/ch03s08.html.make3-CHP-3-FIG-1" title="Figure&nbsp;3-1.&nbsp;Variables for C/C++ compilation">Figure
        3-1</a> shows the variables controlling translation from one file
        type to another.</p><div class="figure"><a id="OEBPS/ch03s08.html.make3-CHP-3-FIG-1"></a><div class="figure-contents"><div class="mediaobject"><a id="OEBPS/ch03s08.html.I_3_tt166"></a><img src="data:image/png;base64,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" height="256" alt="C/C++ ç¼–è¯‘çš„å˜é‡"></div></div><p class="title">å›¾ 3-1ã€‚ C/C++ ç¼–è¯‘çš„å˜é‡</p><p class="title">Figure&nbsp;3-1.&nbsp;Variables for C/C++ compilation</p></div><p>å˜é‡å…·æœ‰åŸºæœ¬å½¢å¼ï¼š
         <em class="replaceable"><code>ACTION</code></em>ã€‚<em class="replaceable"><code>suffix</code></em>ã€‚ç”¨äºŽåˆ›å»ºç›®æ ‡æ–‡ä»¶ã€
        åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶æˆ–<em class="replaceable"><code>ACTION</code></em>â€œç‰¹æ®Šâ€æ“ä½œã€ã€åˆ†åˆ«
        ç”¨äºŽè¿è¡Œ C é¢„å¤„ç†å™¨<em class="command">yacc</em>æˆ–<em class="command">lex</em>ã€‚æŒ‡ç¤º
        æºæ–‡ä»¶ç±»åž‹ã€‚<code class="literal">COMPILE</code><code class="literal">LINK</code><code class="literal">PREPROCESS</code><code class="literal">YACC</code><code class="literal">LEX</code><em class="command"></em><em class="command"></em><em class="replaceable"><code>suffix</code></em></p><p>The variables have the basic form:
        <em class="replaceable"><code>ACTION</code></em>.<em class="replaceable"><code>suffix</code></em>.
        The <em class="replaceable"><code>ACTION</code></em> is <code class="literal">COMPILE</code> for creating an object file,
        <code class="literal">LINK</code> for creating an executable, or
        the "special" operations <code class="literal">PREPROCESS</code>, <code class="literal">YACC</code>, <code class="literal">LEX</code>
        for running the C preprocessor, <em class="command">yacc</em>, or <em class="command">lex</em>, respectively. The
        <em class="replaceable"><code>suffix</code></em> indicates the source file
        type.</p><p>ä¾‹å¦‚ï¼ŒC++ ä¸­é€šè¿‡è¿™äº›å˜é‡çš„æ ‡å‡†â€œè·¯å¾„â€ä½¿ç”¨ä¸¤ä¸ªè§„åˆ™ã€‚é¦–å…ˆï¼Œå°† C++ æºæ–‡ä»¶ç¼–è¯‘ä¸ºç›®æ ‡æ–‡ä»¶ã€‚ç„¶åŽå°†ç›®æ ‡æ–‡ä»¶é“¾æŽ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚</p><p>The standard "path" through these variables for, say, C++, uses
        two rules. First, compile C++ source files to object files. Then link
        the object files into an executable.</p><a id="OEBPS/ch03s08.html.I_3_tt167"></a><pre class="programlisting">%.o: %.C
        $(COMPILE.C) $(OUTPUT_OPTION) $&lt;

%ï¼š%.o
        $(LINK.o) $^ $(LOADLIBES) $(LDLIBS) -o $@</pre><pre class="programlisting">%.o: %.C
        $(COMPILE.C) $(OUTPUT_OPTION) $&lt;

%: %.o
        $(LINK.o) $^ $(LOADLIBES) $(LDLIBS) -o $@</pre><p>ç¬¬ä¸€æ¡è§„åˆ™ä½¿ç”¨è¿™äº›å˜é‡å®šä¹‰ï¼š</p><p>The first rule uses these variable definitions:</p><a id="OEBPS/ch03s08.html.I_3_tt168"></a><pre class="programlisting">ç¼–è¯‘.C = $(ç¼–è¯‘.cc)
COMPILE.cc = $(CXX) $(CXXFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c
CXX = g++
è¾“å‡ºé€‰é¡¹ = -o $@</pre><pre class="programlisting">COMPILE.C     = $(COMPILE.cc)
COMPILE.cc    = $(CXX) $(CXXFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c
CXX           = g++
OUTPUT_OPTION = -o $@</pre><p><acronym class="acronym">GNU </acronym> <em class="command">make</em>
        æ”¯æŒåŽç¼€<em class="filename">.C</em>æˆ–<em class="filename">.cc</em>æ¥è¡¨ç¤º C++ æºæ–‡ä»¶ã€‚è¯¥
        <code class="literal">CXX</code>å˜é‡æŒ‡ç¤ºè¦ä½¿ç”¨çš„ C++ ç¼–è¯‘å™¨ï¼Œé»˜è®¤ä¸º<em class="command">g++</em>ã€‚å˜é‡<code class="literal">CXXFLAGS</code>ã€<code class="literal">CPPFLAGS</code>å’Œ<code class="literal">TARGET_ARCH</code>æ²¡æœ‰é»˜è®¤å€¼ã€‚å®ƒä»¬æ—¨åœ¨ä¾›æœ€ç»ˆç”¨æˆ·ç”¨æ¥è‡ªå®šä¹‰æž„å»ºè¿‡ç¨‹ã€‚è¿™ä¸‰ä¸ªå˜é‡åˆ†åˆ«ä¿å­˜ C++ ç¼–è¯‘å™¨æ ‡å¿—ã€C é¢„å¤„ç†å™¨æ ‡å¿—å’Œç‰¹å®šäºŽä½“ç³»ç»“æž„çš„ç¼–è¯‘é€‰é¡¹ã€‚åŒ…å«<code class="literal">OUTPUT_OPTION</code>è¾“å‡ºæ–‡ä»¶é€‰é¡¹ã€‚</p><p><acronym class="acronym">GNU</acronym> <em class="command">make</em>
        supports either of the suffixes <em class="filename">.C</em> or <em class="filename">.cc</em> for denoting C++ source files. The
        <code class="literal">CXX</code> variable indicates the C++
        compiler to use and defaults to <em class="command">g++</em>. The variables <code class="literal">CXXFLAGS</code>, <code class="literal">CPPFLAGS</code>, and <code class="literal">TARGET_ARCH</code> have no default value. They are
        intended for use by end-users to customize the build process. The
        three variables hold the C++ compiler flags, C preprocessor flags, and
        architecture-specific compilation options, respectively. The <code class="literal">OUTPUT_OPTION</code> contains the output file
        option.</p><p>é“¾æŽ¥è§„åˆ™æœ‰ç‚¹ç®€å•ï¼š</p><p>The linking rule is a bit simpler:</p><a id="OEBPS/ch03s08.html.I_3_tt169"></a><pre class="programlisting">LINK.o = $(CC) $(LDFLAGS) $(TARGET_ARCH)
CC = æµ·æ¹¾åˆä½œå§”å‘˜ä¼š</pre><pre class="programlisting">LINK.o = $(CC) $(LDFLAGS) $(TARGET_ARCH)
CC     = gcc</pre><p>è¯¥è§„åˆ™ä½¿ç”¨ C ç¼–è¯‘å™¨å°†ç›®æ ‡æ–‡ä»¶ç»„åˆæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚ C ç¼–è¯‘å™¨çš„é»˜è®¤å€¼æ˜¯<em class="command">gcc</em>ã€‚<code class="literal">LDFLAGS</code>å¹¶ä¸”<code class="literal">TARGET_ARCH</code>æ²¡æœ‰é»˜è®¤å€¼ã€‚è¯¥
        <code class="literal">LDFLAGS</code>å˜é‡ä¿å­˜ç”¨äºŽé“¾æŽ¥çš„é€‰é¡¹ï¼Œä¾‹å¦‚<code class="option">-L</code>æ ‡å¿—ã€‚å’Œ<code class="literal">LOADLIBES</code>å˜é‡<code class="literal">LDLIBS</code>åŒ…å«è¦é“¾æŽ¥çš„åº“åˆ—è¡¨ã€‚åŒ…å«ä¸¤ä¸ªå˜é‡ä¸»è¦æ˜¯ä¸ºäº†å¯ç§»æ¤æ€§ã€‚</p><p>This rule uses the C compiler to combine object files into an
        executable. The default for the C compiler is <em class="command">gcc</em>. <code class="literal">LDFLAGS</code> and <code class="literal">TARGET_ARCH</code> have no default value. The
        <code class="literal">LDFLAGS</code> variable holds options for
        linking such as <code class="option">-L</code> flags. The <code class="literal">LOADLIBES</code> and <code class="literal">LDLIBS</code> variables contain lists of libraries
        to link against. Two variables are included mostly for
        portability.</p><p><em class="command">è¿™æ˜¯å¯¹make</em>å˜é‡çš„å¿«é€Ÿæµè§ˆã€‚è¿˜æœ‰æ›´å¤šï¼Œä½†è¿™è®©æ‚¨äº†è§£å˜é‡å¦‚ä½•ä¸Žè§„åˆ™é›†æˆã€‚å¦ä¸€ç»„å˜é‡ä¸Ž TEX ç›¸å…³å¹¶ä¸”æœ‰å®ƒè‡ªå·±çš„ä¸€ç»„è§„åˆ™ã€‚é€’å½’<em class="command">make</em>æ˜¯å˜é‡æ”¯æŒçš„å¦ä¸€ä¸ªåŠŸèƒ½ã€‚æˆ‘ä»¬å°†åœ¨<a class="link" href="#OEBPS/ch06.html" title="ç¬¬ 6 ç« ç®¡ç†å¤§åž‹é¡¹ç›®">ç¬¬ 6 ç« </a>è®¨è®ºè¿™ä¸ªä¸»é¢˜ã€‚</p><p>This was a quick tour through the <em class="command">make</em> variables. There are more, but this
        gives you the flavor of how variables are integrated with rules.
        Another group of variables deals with TEX and has its own set of
        rules. Recursive <em class="command">make</em> is another
        feature supported by variables. We'll discuss this topic in <a class="link" href="#OEBPS/ch06.html" title="Chapter&nbsp;6.&nbsp;Managing Large Projects">Chapter 6</a>.</p><div class="footnotes"><br><br><hr><div class="footnote"><p><sup>[ <a id="OEBPS/ch03s08.html.ftn.make3-CHP-3-FNOTE-3" href="#OEBPS/ch03s08.html.make3-CHP-3-FNOTE-3" class="para">3</a> ]</sup>å¯¹äºŽé‚£äº›æƒ³è¦åœ¨å¦ä¸€ä¸ª shell ä¸­è¿è¡Œæ­¤ç±»ç¤ºä¾‹çš„äººï¼Œè¯·ä½¿ç”¨ï¼š</p><p><sup>[<a href="#OEBPS/ch03s08.html.make3-CHP-3-FNOTE-3" class="para">3</a>] </sup>For those of you who want to run this type of example
                  in another shell, use:</p></div></div></div></div></div>
<div id="OEBPS/ch04.html"><div>
<div class="chapter" title="ç¬¬ 4 ç« å‡½æ•°"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch04.html.make3-CHP-4"></a>ç¬¬ 4 ç« å‡½æ•°</h1><h1 class="title"><a></a>Chapter&nbsp;4.&nbsp;Functions</h1></div></div></div><p><acronym class="acronym">GNU </acronym> <em class="command">make</em>
      æ”¯æŒå†…ç½®å‡½æ•°å’Œç”¨æˆ·å®šä¹‰å‡½æ•°ã€‚å‡½æ•°è°ƒç”¨çœ‹èµ·æ¥å¾ˆåƒå˜é‡å¼•ç”¨ï¼Œä½†åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç”¨é€—å·åˆ†éš”çš„å‚æ•°ã€‚å¤§å¤šæ•°å†…ç½®å‡½æ•°éƒ½ä¼šæ‰©å±•ä¸ºæŸä¸ªå€¼ï¼Œç„¶åŽå°†å…¶åˆ†é…ç»™å˜é‡æˆ–ä¼ é€’ç»™å­ shellã€‚ç”¨æˆ·å®šä¹‰çš„å‡½æ•°å­˜å‚¨åœ¨å˜é‡æˆ–å®ä¸­ï¼Œå¹¶æœŸæœ›è°ƒç”¨è€…ä¼ é€’ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ã€‚</p><p><acronym class="acronym">GNU</acronym> <em class="command">make</em>
      supports both built-in and user-defined functions. A function invocation
      looks much like a variable reference, but includes one or more
      parameters separated by commas. Most built-in functions expand to some
      value that is then assigned to a variable or passed to a subshell. A
      user-defined function is stored in a variable or macro and expects one
      or more parameters to be passed by the caller.</p><div class="sect1" title="ç”¨æˆ·å®šä¹‰å‡½æ•°"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch04.html.make3-CHP-4-SECT-1"></a>ç”¨æˆ·å®šä¹‰å‡½æ•°</h1><h1 class="title"><a></a>User-Defined Functions</h1></div></div></div><p>å°†å‘½ä»¤åºåˆ—å­˜å‚¨åœ¨<a id="OEBPS/ch04.html.make3-CHP-4-ITERM-1140" class="indexterm"></a> <a id="OEBPS/ch04.html.make3-CHP-4-ITERM-1141" class="indexterm"></a>å˜é‡æ‰“å¼€äº†å¹¿æ³›åº”ç”¨çš„å¤§é—¨ã€‚ä¾‹å¦‚ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å°å®æ¥ç»ˆæ­¢è¿›ç¨‹ï¼š<sup>[ <a id="OEBPS/ch04.html.make3-CHP-4-FNOTE-1" href="#OEBPS/ch04.html.ftn.make3-CHP-4-FNOTE-1" class="footnote">1</a> ]</sup></p><p>Storing command sequences in<a class="indexterm"></a> <a class="indexterm"></a> variables opens the door to a wide range of
        applications. For instance, here's a nice little macro to kill a
        process:<sup>[<a href="#OEBPS/ch04.html.ftn.make3-CHP-4-FNOTE-1" class="footnote">1</a>]</sup></p><a id="OEBPS/ch04.html.I_4_tt170"></a><pre class="programlisting">AWK := awk
æ€æ­» := æ€æ­»

# $(kill-acroread)
å®šä¹‰kill-acroread
  @ ps -W | \
  $(AWK) 'å¼€å§‹ { FieldWIDTHS = "9 47 100" } \
          /AcroRd32/ { \
                       æ‰“å°â€œæ€æ­»â€$$3ï¼› \
                       ç³»ç»Ÿ(â€œ$(KILL)-fâ€$$1)\
                     }'
æ©å¾·å¤«</pre><pre class="programlisting">AWK  := awk
KILL := kill

# $(kill-acroread)
define kill-acroread
  @ ps -W |                                           \
  $(AWK) 'BEGIN      { FIELDWIDTHS = "9 47 100" }     \
          /AcroRd32/ {                                \
                       print "Killing " $$3;          \
                       system( "$(KILL) -f " $$1 )    \
                     }'
endef</pre><p>ï¼ˆè¿™ä¸ªå®æ˜¯è¿™æ ·å†™çš„<a id="OEBPS/ch04.html.make3-CHP-4-ITERM-1142" class="indexterm"></a> <a id="OEBPS/ch04.html.make3-CHP-4-ITERM-1143" class="indexterm"></a>æ˜Žç¡®ä½¿ç”¨ Cygwin å·¥å…·ï¼Œ<sup>[ <a id="OEBPS/ch04.html.make3-CHP-4-FNOTE-2" href="#OEBPS/ch04.html.ftn.make3-CHP-4-FNOTE-2" class="footnote">2</a> ]å› æ­¤æˆ‘ä»¬æœç´¢çš„ç¨‹åºåç§°ä»¥åŠ</sup><em class="command">ps</em>å’Œ<em class="command">kill</em>çš„é€‰é¡¹
        ä¸æ˜¯æ ‡å‡† Unixã€‚ï¼‰ä¸ºäº†ç»ˆæ­¢è¿›ç¨‹ï¼Œæˆ‘ä»¬å°†<em class="command">ps</em>çš„è¾“å‡ºé€šè¿‡ç®¡é“ä¼ è¾“åˆ°
        <em class="command">awk</em>ã€‚ awkè„šæœ¬é€šè¿‡ Windows ç¨‹åºåç§°æŸ¥æ‰¾ Acrobat Readerï¼Œå¹¶åœ¨è¯¥è¿›ç¨‹æ­£åœ¨è¿è¡Œæ—¶ç»ˆæ­¢è¯¥è¿›ç¨‹<em class="command">ã€‚</em>æˆ‘ä»¬ä½¿ç”¨è¯¥<code class="literal">FIELDWIDTHS</code>åŠŸèƒ½å°†ç¨‹åºåç§°åŠå…¶æ‰€æœ‰å‚æ•°è§†ä¸ºå•ä¸ªå­—æ®µã€‚å³ä½¿å…¶ä¸­åŒ…å«åµŒå…¥çš„ç©ºæ ¼ï¼Œè¿™ä¹Ÿä¼šæ­£ç¡®æ‰“å°å®Œæ•´çš„ç¨‹åºåç§°å’Œå‚æ•°ã€‚<em class="command">awk</em>ä¸­çš„å­—æ®µå¼•ç”¨è¢«å†™ä¸º<code class="literal">$1</code>,ç­‰ã€‚
        å¦‚æžœæˆ‘ä»¬ä¸ä»¥æŸç§æ–¹å¼å¼•ç”¨å®ƒä»¬ï¼Œ<code class="literal">$2</code>å®ƒä»¬å°†è¢«è§†ä¸º<em class="command">make</em>å˜é‡ã€‚æˆ‘ä»¬å¯ä»¥å‘Šè¯‰<em class="command">make</em>å°†<code class="literal">$</code> <em class="replaceable"><code>n</code></em>å¼•ç”¨ä¼ é€’ç»™
        <em class="command">awkï¼Œ</em><code class="literal">$</code>
        <em class="replaceable"><code>n</code></em>è€Œä¸æ˜¯é€šè¿‡ä½¿ç”¨é¢å¤–çš„ç¾Žå…ƒç¬¦å· è½¬ä¹‰ç¾Žå…ƒç¬¦å·æ¥æ‰©å±•å®ƒæœ¬èº«<code class="literal">$$</code> <em class="replaceable"><code>n</code></em>ã€‚<em class="command">make</em>å°†çœ‹åˆ°åŒç¾Žå…ƒç¬¦å·ï¼Œå°†å…¶æŠ˜å ä¸ºå•ä¸ªç¾Žå…ƒç¬¦å·å¹¶å°†å…¶ä¼ é€’ç»™å­ shellã€‚</p><p>(This macro was written <a class="indexterm"></a> <a class="indexterm"></a>explicitly to use the Cygwin tools,<sup>[<a href="#OEBPS/ch04.html.ftn.make3-CHP-4-FNOTE-2" class="footnote">2</a>]</sup> so the program name we search for and the options to
        <em class="command">ps</em> and <em class="command">kill</em> are not standard Unix.) To kill a
        process we pipe the output of <em class="command">ps</em> to
        <em class="command">awk</em>. The <em class="command">awk</em> script looks for the Acrobat Reader by
        its Windows program name and kills the process if it is running. We
        use the <code class="literal">FIELDWIDTHS</code> feature to
        treat the program name and all its arguments as a single field. This
        correctly prints the complete program name and arguments even when it
        contains embedded blanks. Field references in <em class="command">awk</em> are written as <code class="literal">$1</code>, <code class="literal">$2</code>,
        etc. These would be treated as <em class="command">make</em>
        variables if we did not quote them in some way. We can tell <em class="command">make</em> to pass the <code class="literal">$</code> <em class="replaceable"><code>n</code></em> reference to
        <em class="command">awk</em> instead of expanding it itself
        by escaping the dollar sign in <code class="literal">$</code>
        <em class="replaceable"><code>n</code></em> with an additional dollar sign, <code class="literal">$$</code> <em class="replaceable"><code>n</code></em>. <em class="command">make</em> will see the double dollar sign,
        collapse it to a single dollar sign and pass it to the
        subshell.</p><p>ä¸é”™çš„å®è§‚ã€‚å¦‚æžœæˆ‘ä»¬æƒ³ç»å¸¸ä½¿ç”¨è¯¥æŒ‡ä»¤ï¼Œåˆ™<code class="literal">define</code>
        å¯ä»¥é¿å…é‡å¤ä»£ç ã€‚ä½†å®ƒå¹¶ä¸å®Œç¾Žã€‚å¦‚æžœæˆ‘ä»¬æƒ³ç»ˆæ­¢ Acrobat Reader ä»¥å¤–çš„è¿›ç¨‹æ€Žä¹ˆåŠžï¼Ÿæˆ‘ä»¬æ˜¯å¦å¿…é¡»å®šä¹‰å¦ä¸€ä¸ªå®å¹¶å¤åˆ¶è„šæœ¬ï¼Ÿä¸ï¼</p><p>Nice macro. And the <code class="literal">define</code>
        directive saves us from duplicating the code if we want to use it
        often. But it isn't perfect. What if we want to kill processes other
        than the Acrobat Reader? Do we have to define another macro and
        duplicate the script? No!</p><p>å¯ä»¥ä¼ é€’å˜é‡å’Œå®<a id="OEBPS/ch04.html.make3-CHP-4-ITERM-1145" class="indexterm"></a> <a id="OEBPS/ch04.html.make3-CHP-4-ITERM-1146" class="indexterm"></a> <a id="OEBPS/ch04.html.make3-CHP-4-ITERM-1147" class="indexterm"></a>å‚æ•°ï¼Œä»¥ä¾¿æ¯ä¸ªæ‰©å±•éƒ½å¯ä»¥ä¸åŒã€‚å®çš„å‚æ•°åœ¨å®å®šä¹‰ä½“å†…ç”¨ ã€ ç­‰å¼•ç”¨<code class="literal">$1</code>ã€‚<code class="literal">$2</code>è¦å‚æ•°åŒ–æˆ‘ä»¬çš„<code class="function">kill-acroread</code>å‡½æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ªæœç´¢å‚æ•°ï¼š</p><p>Variables and macros can be passed <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>arguments so that each expansion can be different. The
        parameters of the macro are referenced within the body of the macro
        definition with <code class="literal">$1</code>, <code class="literal">$2</code>, etc. To parameterize our <code class="function">kill-acroread</code> function, we only need to add
        a search parameter:</p><a id="OEBPS/ch04.html.I_4_tt171"></a><pre class="programlisting">AWK := awk
æ€æ­» := æ€æ­»
KILL_FLAGS := -f
PS := PS
PS_FLAGS := -W
PS_FIELDS := "9 47 100"

# $(è°ƒç”¨kill-program,awk-pattern)
å®šä¹‰ç»ˆæ­¢ç¨‹åº
  @ $(PS) $(PS_FLAGS) | \
  $(AWK) 'å¼€å§‹ { FieldWIDTHS = $(PS_FIELDS) } \
          /$1/ { \
                  æ‰“å°â€œæ€æ­»â€$$3ï¼› \
                  ç³»ç»Ÿ(â€œ$(KILL)$(KILL_FLAGS)â€$$1)\
                }'
æ©å¾·å¤«</pre><pre class="programlisting">AWK        := awk
KILL       := kill
KILL_FLAGS := -f
PS         := ps
PS_FLAGS   := -W
PS_FIELDS  := "9 47 100"

# $(call kill-program,awk-pattern)
define kill-program
  @ $(PS) $(PS_FLAGS) |                                  \
  $(AWK) 'BEGIN { FIELDWIDTHS = $(PS_FIELDS) }           \
          /$1/  {                                        \
                  print "Killing " $$3;                  \
                  system( "$(KILL) $(KILL_FLAGS) " $$1 ) \
                }'
endef</pre><p>æˆ‘ä»¬å·²å°†<em class="command">awk</em>æœç´¢æ¨¡å¼æ›¿æ¢<code class="literal">/AcroRd32/</code>ä¸ºå‚æ•°å¼•ç”¨<code class="literal">$1</code>ã€‚è¯·æ³¨æ„å®å‚æ•°<code class="literal">$1</code>å’Œ<em class="command">awk</em>å­—æ®µå¼•ç”¨ä¹‹é—´çš„ç»†å¾®åŒºåˆ«<code class="literal">$$1</code>ã€‚è®°ä½å“ªä¸ªç¨‹åºæ˜¯å˜é‡å¼•ç”¨çš„é¢„æœŸæŽ¥æ”¶è€…éžå¸¸é‡è¦ã€‚åªè¦æˆ‘ä»¬æ”¹è¿›è¯¥å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿä¼šå¯¹å…¶è¿›è¡Œé€‚å½“çš„é‡å‘½åï¼Œå¹¶ç”¨å˜é‡æ›¿æ¢ç‰¹å®šäºŽ Cygwin çš„ç¡¬ç¼–ç å€¼ã€‚çŽ°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªç›¸å½“å¯ç§»æ¤çš„å®æ¥ç»ˆæ­¢è¿›ç¨‹ã€‚</p><p>We've replaced the <em class="command">awk</em> search
        pattern, <code class="literal">/AcroRd32/</code>, with a
        parameter reference, <code class="literal">$1</code>. Note the
        subtle distinction between the macro parameter, <code class="literal">$1</code>, and the <em class="command">awk</em> field reference, <code class="literal">$$1</code>. It is very important to remember which
        program is the intended recipient for a variable reference. As long as
        we're improving the function, we have also renamed it appropriately
        and replaced the Cygwin-specific, hardcoded values with variables. Now
        we have a reasonably portable macro for terminating processes.</p><p>è®©æˆ‘ä»¬çœ‹çœ‹å®ƒçš„å®žé™…æ•ˆæžœï¼š</p><p>So let's see it in action:</p><a id="OEBPS/ch04.html.I_4_tt172"></a><pre class="programlisting">FOP := org.apache.fop.apps.Fop
FOP_FLAGS := -q
FOP_OUTPUT := &gt; /dev/null
%.pdf: %.fo
        $(è°ƒç”¨ç»ˆæ­¢ç¨‹åº,AcroRd32)
        $(JAVA) $(FOP) $(FOP_FLAGS) $&lt; $@ $(FOP_OUTPUT)</pre><pre class="programlisting">FOP        := org.apache.fop.apps.Fop
FOP_FLAGS  := -q
FOP_OUTPUT := &gt; /dev/null
%.pdf: %.fo
        $(call kill-program,AcroRd32)
        $(JAVA) $(FOP) $(FOP_FLAGS) $&lt; $@ $(FOP_OUTPUT)</pre><p>æ­¤æ¨¡å¼è§„åˆ™ä¼šç»ˆæ­¢<span class="emphasis"><em>Acrobat</em></span>
        è¿›ç¨‹ï¼ˆå¦‚æžœæ­£åœ¨è¿è¡Œï¼‰ï¼Œç„¶åŽé€šè¿‡è°ƒç”¨å¤„ç†å™¨ ( <a class="ulink" href="http://xml.apache.org/fop">http://xml.apache.org/fop ) å°†</a><em class="filename">fo</em>ï¼ˆæ ¼å¼åŒ–å¯¹è±¡ï¼‰æ–‡ä»¶è½¬æ¢ä¸º
        <em class="filename">pdf</em>æ–‡ä»¶ã€‚æ‰©å±•å˜é‡æˆ–å®çš„è¯­æ³•æ˜¯ï¼š<code class="literal">Fop</code><a class="ulink" href="http://xml.apache.org/fop"></a></p><p>This pattern rule kills the <span class="emphasis"><em>Acrobat</em></span>
        process, if one is running, and then converts an <em class="filename">fo</em> (Formatting Objects) file into a
        <em class="filename">pdf</em> file by invoking the <code class="literal">Fop</code> processor (<a class="ulink" href="http://xml.apache.org/fop">http://xml.apache.org/fop</a>). The syntax for expanding a
        variable or macro is:</p><a id="OEBPS/ch04.html.I_4_tt173"></a><pre class="programlisting">$(è°ƒç”¨å®åç§°[, å‚æ•°<sub>1</sub> . . . ])</pre><pre class="programlisting">$(call macro-name[, param<sub>1</sub> . . . ])</pre><p><code class="function">call</code>æ˜¯ä¸€ä¸ªå†…ç½®<em class="command">make</em>å‡½æ•°ï¼Œå®ƒæ‰©å±•å…¶ç¬¬ä¸€ä¸ªå‚æ•°å¹¶ç”¨ç»™å‡ºçš„å…¶ä½™å‚æ•°æ›¿æ¢å‡ºçŽ°çš„ ã€ ç­‰<code class="literal">$1</code>ã€‚<code class="literal">$2</code>ï¼ˆäº‹å®žä¸Šâ€‹â€‹ï¼Œä»ŽæŽ§åˆ¶è½¬ç§»çš„æ„ä¹‰ä¸Šæ¥è¯´ï¼Œå®ƒæ ¹æœ¬æ²¡æœ‰çœŸæ­£â€œè°ƒç”¨â€å®ƒçš„å®å‚æ•°ï¼Œè€Œæ˜¯æ‰§è¡Œä¸€ç§ç‰¹æ®Šç±»åž‹çš„å®æ‰©å±•ã€‚ï¼‰ æ˜¯
        <code class="option">macro-name</code>ä»»ä½•å®æˆ–å˜é‡çš„åç§°ï¼ˆè¯·è®°ä½ï¼Œå®æ˜¯åªæ˜¯å…è®¸åµŒå…¥æ¢è¡Œç¬¦çš„å˜é‡ï¼‰ã€‚å®æˆ–å˜é‡å€¼ç”šè‡³ä¸å¿…åŒ…å«
        å¼•ç”¨ï¼Œä½†ä½¿ç”¨èµ·æ¥æ ¹æœ¬<code class="literal">$</code> <em class="replaceable"><code>n</code></em>
        æ²¡æœ‰å¤šå¤§æ„ä¹‰ã€‚<code class="function">call</code>å®åŽé¢çš„å‚æ•°<code class="option">macro-name</code>ç”¨é€—å·åˆ†éš”ã€‚</p><p><code class="function">call</code> is a built-in <em class="command">make</em> function that expands its first
        argument and replaces occurrences of <code class="literal">$1</code>, <code class="literal">$2</code>,
        etc., with the remaining arguments it is given. (In fact, it doesn't
        really "call" its macro argument at all in the sense of transfer of
        control, rather it performs a special kind of macro expansion.) The
        <code class="option">macro-name</code> is the name of any macro or variable
        (remember that macros are just variables where embedded newlines are
        allowed). The macro or variable value doesn't even have to contain a
        <code class="literal">$</code> <em class="replaceable"><code>n</code></em>
        reference, but then there isn't much point in using <code class="function">call</code> at all. Arguments to the macro
        following <code class="option">macro-name</code> are separated by commas.</p><p>è¯·æ³¨æ„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°<code class="function">call</code>æ˜¯æœªæ‰©å±•çš„å˜é‡åç§°ï¼ˆå³ï¼Œå®ƒä¸ä»¥ç¾Žå…ƒç¬¦å·å¼€å¤´ï¼‰ã€‚è¿™æ˜¯ç›¸å½“ä¸å¯»å¸¸çš„ã€‚åªæœ‰å¦å¤–ä¸€ä¸ªå†…ç½®å‡½æ•°<code class="function">origin</code>æŽ¥å—æœªæ‰©å±•çš„å˜é‡ã€‚å¦‚æžœå°†ç¬¬ä¸€ä¸ªå‚æ•° æ‹¬<code class="literal">call</code>åœ¨ç¾Žå…ƒç¬¦å·å’Œæ‹¬å·ä¸­ï¼Œåˆ™è¯¥å‚æ•°å°†æ‰©å±•ä¸ºå˜é‡ï¼Œå¹¶å°†å…¶å€¼ä¼ é€’ç»™<code class="literal">call</code>ã€‚</p><p>Notice that the first argument to <code class="function">call</code> is an unexpanded variable name (that
        is, it does not begin with a dollar sign). That is fairly unusual.
        Only one other built-in function, <code class="function">origin</code>, accepts unexpanded variables. If
        you enclose the first argument to <code class="literal">call</code> in a dollar sign and parentheses, that
        argument is expanded as a variable and its value is passed to <code class="literal">call</code>.</p><p>ä½¿ç”¨ è¿›è¡Œå‚æ•°æ£€æŸ¥çš„æ–¹å¼å¾ˆå°‘
        <code class="function">call</code>ã€‚å¯ä»¥å‘ èµ‹äºˆä»»æ„æ•°é‡çš„å‚æ•°<code class="function">call</code>ã€‚å¦‚æžœå®å¼•ç”¨å‚æ•°<code class="literal">$</code>
        <em class="replaceable"><code>n</code></em>å¹¶ä¸”å®žä¾‹ä¸­æ²¡æœ‰ç›¸åº”çš„å‚æ•°<code class="function">call</code>ï¼Œåˆ™è¯¥å˜é‡å°†å´©æºƒä¸ºç©ºã€‚å¦‚æžœå®žä¾‹ä¸­çš„å‚æ•°å¤šäºŽ<code class="function">call</code>å¼•ç”¨<code class="literal">$</code> <em class="replaceable"><code>n</code></em>ï¼Œåˆ™å®ä¸­æ°¸è¿œä¸ä¼šæ‰©å±•é¢å¤–çš„å‚æ•°ã€‚</p><p>There is very little in the way of argument checking with
        <code class="function">call</code>. Any number of arguments can
        be given to <code class="function">call</code>. If a macro
        references a parameter <code class="literal">$</code>
        <em class="replaceable"><code>n</code></em> and there is no corresponding argument in
        the <code class="function">call</code> instance, the variable
        collapses to nothing. If there are more arguments in the <code class="function">call</code> instance than there are <code class="literal">$</code> <em class="replaceable"><code>n</code></em> references,
        the extra arguments are never expanded in the macro.</p><p>å¦‚æžœæ‚¨ä»Žå¦ä¸€ä¸ªå®è°ƒç”¨ä¸€ä¸ªå®ï¼Œæ‚¨åº”è¯¥æ³¨æ„åˆ°<em class="command">make</em> 
        3.80 ä¸­çš„ä¸€ç§æœ‰ç‚¹å¥‡æ€ªçš„è¡Œä¸ºã€‚è¯¥<code class="function">call</code>å‡½æ•°å°†å‚æ•°å®šä¹‰ä¸º
        æ‰©å±•æœŸé—´çš„æ­£å¸¸<em class="command">make</em>å˜é‡ã€‚æ‰€ä»¥å¦‚æžœä¸€ä¸ªå®
        <a id="OEBPS/ch04.html.make3-CHP-4-ITERM-1148" class="indexterm"></a> <a id="OEBPS/ch04.html.make3-CHP-4-ITERM-1149" class="indexterm"></a>è°ƒç”¨å¦ä¸€ä¸ªï¼Œçˆ¶å®çš„å‚æ•°å¯èƒ½åœ¨å­å®çš„æ‰©å±•ä¸­å¯è§ï¼š</p><p>If you invoke one macro from another, you should be aware of a
        somewhat strange behavior in <em class="command">make</em>
        3.80. The <code class="function">call</code> function defines
        the arguments as normal <em class="command">make</em>
        variables for the duration of the expansion. So if one macro
        <a class="indexterm"></a> <a class="indexterm"></a>invokes another, it is possible that the parent's
        arguments will be visible in the child macro's expansion:</p><a id="OEBPS/ch04.html.I_4_tt174"></a><pre class="programlisting">å®šä¹‰çˆ¶çº§
  echo "parent æœ‰ä¸¤ä¸ªå‚æ•°: $1, $2"
  $ï¼ˆå‘¼å«å­©å­ï¼Œ$1ï¼‰
æ©å¾·å¤«

å®šä¹‰å­©å­
  echo "å­è¿›ç¨‹æœ‰ä¸€ä¸ªå‚æ•°ï¼š$1"
  echo "ä½†æ˜¯å­è¿›ç¨‹ä¹Ÿå¯ä»¥çœ‹åˆ°çˆ¶è¿›ç¨‹çš„ç¬¬äºŒä¸ªå‚æ•°ï¼š$2!"
æ©å¾·å¤«

èŒƒå›´ç•Œå®šé—®é¢˜ï¼š
        @$ï¼ˆè°ƒç”¨çˆ¶çº§ï¼Œä¸€ï¼ŒäºŒï¼‰</pre><pre class="programlisting">define parent
  echo "parent has two parameters: $1, $2"
  $(call child,$1)
endef

define child
  echo "child has one parameter: $1"
  echo "but child can also see parent's second parameter: $2!"
endef

scoping_issue:
        @$(call parent,one,two)</pre><p>è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°å®å®žçŽ°æœ‰ä¸€ä¸ª<a id="OEBPS/ch04.html.make3-CHP-4-ITERM-1150" class="indexterm"></a> <a id="OEBPS/ch04.html.make3-CHP-4-ITERM-1151" class="indexterm"></a>èŒƒå›´ç•Œå®šé—®é¢˜ã€‚</p><p>When run, we see that the macro implementation has a <a class="indexterm"></a> <a class="indexterm"></a>scoping issue.</p><a id="OEBPS/ch04.html.I_4_tt175"></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
Parent æœ‰ä¸¤ä¸ªå‚æ•°ï¼šä¸€ã€äºŒ
child æœ‰ä¸€ä¸ªå‚æ•°ï¼šä¸€
ä½†å­©å­ä¹Ÿå¯ä»¥çœ‹åˆ°çˆ¶æ¯çš„ç¬¬äºŒä¸ªå‚æ•°ï¼šäºŒï¼</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
parent has two parameters: one, two
child has one parameter: one
but child can also see parent's second parameter: two!</pre><p>è¿™ä¸ªé—®é¢˜å·²åœ¨ 3.81 ä¸­å¾—åˆ°è§£å†³ï¼Œå› æ­¤<code class="literal">$2</code>ä¼š<code class="function">child</code>å´©æºƒã€‚</p><p>This has been resolved in 3.81 so that <code class="literal">$2</code> in <code class="function">child</code> collapses to nothing.</p><p>åœ¨æœ¬ä¹¦çš„å…¶ä½™éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†èŠ±è´¹æ›´å¤šçš„æ—¶é—´æ¥è®¨è®ºç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼Œä½†åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬éœ€è¦æ›´å¤šçš„èƒŒæ™¯çŸ¥è¯†
        <a id="OEBPS/ch04.html.make3-CHP-4-ITERM-1152" class="indexterm"></a>
        <a id="OEBPS/ch04.html.make3-CHP-4-ITERM-1153" class="indexterm"></a>æˆ‘ä»¬å¯ä»¥è¿›å…¥çœŸæ­£æœ‰è¶£çš„äº‹æƒ…ï¼</p><p>We'll spend a lot more time with user-defined functions
        throughout the rest of the book, but we need more background before
        <a class="indexterm"></a>
        <a class="indexterm"></a>we
        can get into the really fun stuff!</p></div><div class="footnotes"><br><br><hr><div class="footnote"><p><sup>[ <a id="OEBPS/ch04.html.ftn.make3-CHP-4-FNOTE-1" href="#OEBPS/ch04.html.make3-CHP-4-FNOTE-1" class="para">1</a> ]</sup> â€œä¸ºä»€ä¹ˆè¦åœ¨ makefile ä¸­æ‰§è¡Œæ­¤æ“ä½œ<em class="filename">ï¼Ÿ</em> â€ä½ é—®ã€‚é‚£ä¹ˆï¼Œåœ¨ Windows ä¸Šï¼Œæ‰“å¼€æ–‡ä»¶ä¼šé”å®šè¯¥æ–‡ä»¶ï¼Œé˜²æ­¢å…¶ä»–è¿›ç¨‹å†™å…¥ã€‚å½“æˆ‘å†™è¿™æœ¬ä¹¦æ—¶ï¼Œ<em class="filename">PDF</em>æ–‡ä»¶ç»å¸¸è¢« Acrobat Reader é”å®šå¹¶é˜»æ­¢æˆ‘çš„<em class="filename">makefile</em>æ›´æ–°<em class="filename">PDF</em>ã€‚å› æ­¤ï¼Œæˆ‘å°†æ­¤å‘½ä»¤æ·»åŠ åˆ°å¤šä¸ªç›®æ ‡ï¼Œä»¥åœ¨å°è¯•æ›´æ–°é”å®šæ–‡ä»¶ä¹‹å‰ç»ˆæ­¢ Acrobat Readerã€‚</p><p><sup>[<a href="#OEBPS/ch04.html.make3-CHP-4-FNOTE-1" class="para">1</a>] </sup>"Why would you want to do this in a <em class="filename">makefile</em>?" you ask. Well, on Windows,
            opening a file locks it against writing by other processes. While
            I was writing this book, the <em class="filename">PDF</em> file would often be locked by the
            Acrobat Reader and prevent my <em class="filename">makefile</em> from updating the <em class="filename">PDF</em>. So I added this command to several
            targets to terminate Acrobat Reader before attempting to update
            the locked file.</p></div><div class="footnote"><p><sup>[ <a id="OEBPS/ch04.html.ftn.make3-CHP-4-FNOTE-2" href="#OEBPS/ch04.html.make3-CHP-4-FNOTE-2" class="para">2</a> ]</sup>è¥¿æ ¼<span class="emphasis"><em>æ¸©</em></span> <a id="OEBPS/ch04.html.make3-CHP-4-ITERM-1144" class="indexterm"></a><acronym class="acronym">å·¥å…·æ˜¯è®¸å¤šæ ‡å‡†GNU</acronym>å’Œ Linux ç¨‹åºåˆ° Windowsçš„ç«¯å£
            ã€‚å®ƒåŒ…æ‹¬ç¼–è¯‘å™¨å¥—ä»¶ã€X11R6ã€<em class="command">ssh</em>ç”šè‡³<em class="command">inetd</em>ã€‚è¯¥ç«¯å£ä¾èµ–äºŽä¸€ä¸ªå…¼å®¹æ€§åº“ï¼Œè¯¥åº“æ ¹æ® Win32 API å‡½æ•°å®žçŽ° Unix ç³»ç»Ÿè°ƒç”¨ã€‚è¿™æ˜¯ä¸€é¡¹ä»¤äººéš¾ä»¥ç½®ä¿¡çš„å·¥ç¨‹å£®ä¸¾ï¼Œæˆ‘å¼ºçƒˆæŽ¨èå®ƒã€‚ä»Ž<a class="ulink" href="http://www.cygwin.com/">http://www.cygwin.com</a>ä¸‹è½½ã€‚</p><p><sup>[<a href="#OEBPS/ch04.html.make3-CHP-4-FNOTE-2" class="para">2</a>] </sup>The <span class="emphasis"><em>Cygwin</em></span> <a class="indexterm"></a> tools are a port of many of the standard
            <acronym class="acronym">GNU</acronym> and Linux programs to Windows. It includes
            the compiler suite, X11R6, <em class="command">ssh</em>,
            and even <em class="command">inetd</em>. The port relies
            on a compatibility library that implements Unix system calls in
            terms of Win32 API functions. It is an incredible feat of
            engineering and I highly recommend it. Download it from <a class="ulink" href="http://www.cygwin.com">http://www.cygwin.com</a>.</p></div></div></div></div></div>
<div id="OEBPS/ch04s02.html"><div>
<div class="sect1" title="å†…ç½®åŠŸèƒ½"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch04s02.html.make3-CHP-4-SECT-2"></a>å†…ç½®åŠŸèƒ½</h1><h1 class="title"><a></a>Built-in Functions</h1></div></div></div><p>ä¸€æ—¦ä½ å¼€å§‹ä¸Šè·¯<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1154" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1155" class="indexterm"></a>ä½¿ç”¨<em class="command">make</em>
        å˜é‡ä¸ä»…ä»…æ˜¯ç®€å•çš„å¸¸é‡ï¼Œæ‚¨ä¼šå‘çŽ°æ‚¨æƒ³è¦ä»¥è¶Šæ¥è¶Šå¤æ‚çš„æ–¹å¼æ“ä½œå˜é‡åŠå…¶å†…å®¹ã€‚å¥½å§ï¼Œä½ å¯ä»¥ã€‚<acronym class="acronym">GNU </acronym> <em class="command">make</em>æœ‰å‡ åä¸ªå†…ç½®å‡½æ•°ç”¨äºŽå¤„ç†å˜é‡åŠå…¶å†…å®¹ã€‚è¿™äº›å‡½æ•°åˆ†ä¸ºå‡ å¤§ç±»ï¼šå­—ç¬¦ä¸²æ“ä½œã€æ–‡ä»¶åæ“ä½œã€æµæŽ§åˆ¶ã€ç”¨æˆ·å®šä¹‰å‡½æ•°å’Œä¸€äº›ï¼ˆé‡è¦çš„ï¼‰æ‚é¡¹å‡½æ•°ã€‚</p><p>Once you start down the road <a class="indexterm"></a> <a class="indexterm"></a>of using <em class="command">make</em>
        variables for more than just simple constants you'll find that you
        want to manipulate the variables and their contents in more and more
        complex ways. Well, you can. <acronym class="acronym">GNU</acronym> <em class="command">make</em> has a couple dozen built-in functions
        for working with variables and their contents. The functions fall into
        several broad categories: string manipulation, filename manipulation,
        flow control, user-defined functions, and some (important)
        miscellaneous functions.</p><p>ä½†é¦–å…ˆï¼Œå¤šäº†è§£ä¸€ç‚¹<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1156" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1157" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1158" class="indexterm"></a>å‡½æ•°è¯­æ³•ã€‚æ‰€æœ‰å‡½æ•°çš„å½¢å¼å¦‚ä¸‹ï¼š</p><p>But first, a little more about <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>function syntax. All functions have the form:</p><a id="OEBPS/ch04s02.html.I_4_tt176"></a><pre class="programlisting">$(å‡½æ•°å arg <sub>1</sub> [, arg <sub>n</sub> ])</pre><pre class="programlisting">$(function-name arg<sub>1</sub>[, arg<sub>n</sub>])</pre><p>åŽé¢<code class="literal">$(</code>æ˜¯å†…ç½®å‡½æ•°åç§°ï¼Œç„¶åŽæ˜¯å‡½æ•°çš„å‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ä¸­çš„å‰å¯¼ç©ºæ ¼è¢«ä¿®å‰ªæŽ‰ï¼Œä½†æ‰€æœ‰åŽç»­å‚æ•°éƒ½åŒ…å«ä»»ä½•å‰å¯¼ï¼ˆå½“ç„¶è¿˜æœ‰åµŒå…¥çš„å’ŒåŽé¢çš„ï¼‰ç©ºæ ¼ã€‚</p><p>The <code class="literal">$(</code> is followed by
        built-in function name and then followed by the arguments to the
        function. Leading whitespace is trimmed from the first argument, but
        all subsequent arguments include any leading (and, of course, embedded
        and following) whitespace.</p><p>å‡½æ•°å‚æ•°ä»¥é€—å·åˆ†éš”ï¼Œå› æ­¤å…·æœ‰ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ä¸ä½¿ç”¨é€—å·ï¼Œå…·æœ‰ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°ä½¿ç”¨ä¸€ä¸ªé€—å·ï¼Œç­‰ç­‰ã€‚è®¸å¤šå‡½æ•°æŽ¥å—å•ä¸ªå‚æ•°ï¼Œå°†å…¶è§†ä¸ºç©ºæ ¼åˆ†éš”çš„å•è¯åˆ—è¡¨ã€‚å¯¹äºŽè¿™äº›å‡½æ•°ï¼Œå•è¯ä¹‹é—´çš„ç©ºæ ¼è¢«è§†ä¸ºå•å•è¯åˆ†éš”ç¬¦ï¼Œå¦åˆ™å°†è¢«å¿½ç•¥ã€‚</p><p>Function arguments are separated by commas, so a function with
        one argument uses no commas, a function with two arguments uses one
        comma, etc. Many functions accept a single argument, treating it as a
        list of space-separated words. For these functions, the whitespace
        between words is treated as a single-word separator and is otherwise
        ignored.</p><p>æˆ‘å–œæ¬¢<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1159" class="indexterm"></a>ç©ºç™½ã€‚å®ƒä½¿ä»£ç æ›´å…·å¯è¯»æ€§å¹¶ä¸”æ›´æ˜“äºŽç»´æŠ¤ã€‚æ‰€ä»¥æˆ‘ä¼šåœ¨ä»»ä½•å¯ä»¥â€œé€ƒè„±â€çš„åœ°æ–¹ä½¿ç”¨ç©ºç™½ã€‚ç„¶è€Œï¼Œæœ‰æ—¶ï¼Œå‚æ•°åˆ—è¡¨æˆ–å˜é‡å®šä¹‰ä¸­çš„ç©ºæ ¼å¯èƒ½ä¼šå¹²æ‰°ä»£ç çš„æ­£å¸¸è¿è¡Œã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œæ‚¨åˆ«æ— é€‰æ‹©ï¼Œåªèƒ½åˆ é™¤æœ‰é—®é¢˜çš„ç©ºç™½ã€‚æˆ‘ä»¬å·²ç»åœ¨æœ¬ç« å‰é¢çœ‹åˆ°è¿‡ä¸€ä¸ªç¤ºä¾‹ï¼Œå…¶ä¸­å°¾éšç©ºæ ¼è¢«æ„å¤–æ’å…¥åˆ°<em class="command">grep</em>å‘½ä»¤çš„æœç´¢æ¨¡å¼ä¸­ã€‚å½“æˆ‘ä»¬ç»§ç»­æä¾›æ›´å¤šç¤ºä¾‹æ—¶ï¼Œæˆ‘ä»¬å°†æŒ‡å‡ºå‡ºçŽ°ç©ºç™½é—®é¢˜çš„ä½ç½®ã€‚</p><p>I like <a class="indexterm"></a>whitespace. It makes the code more readable and easier
        to maintain. So I'll be using whitespace wherever I can "get away"
        with it. Sometimes, however, the whitespace in an argument list or
        variable definition can interfere with the proper functioning of the
        code. When this happens, you have little choice but to remove the
        problematic whitespace. We already saw one example earlier in the
        chapter where trailing whitespace was accidentally inserted into the
        search pattern of a <em class="command">grep</em> command.
        As we proceed with more examples, we'll point out where whitespace
        issues arise.</p><p>è®¸å¤š<em class="command">make</em>å‡½æ•°æŽ¥å—
        <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1160" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1161" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1162" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1163" class="indexterm"></a> <em class="firstterm">æ¨¡å¼</em>ä½œä¸ºå‚æ•°ã€‚è¯¥æ¨¡å¼ä½¿ç”¨ä¸Žæ¨¡å¼è§„åˆ™ä¸­ä½¿ç”¨çš„æ¨¡å¼ç›¸åŒçš„è¯­æ³•ï¼ˆè¯·å‚é˜…<a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™">ç¬¬ 2 ç« </a>ä¸­çš„
        <a class="link" href="#OEBPS/ch02s04.html" title="æ¨¡å¼è§„åˆ™">2.4 èŠ‚</a>ï¼‰ã€‚æ¨¡å¼åŒ…å«å…·æœ‰å‰å¯¼æˆ–å°¾éšå­—ç¬¦ï¼ˆæˆ–ä¸¤è€…ï¼‰çš„å•ä¸ªæ¨¡å¼ã€‚è¯¥
        å­—ç¬¦ä»£è¡¨é›¶ä¸ªæˆ–å¤šä¸ªä»»ä½•ç±»åž‹çš„å­—ç¬¦ã€‚è¦åŒ¹é…ç›®æ ‡å­—ç¬¦ä¸²ï¼Œæ¨¡å¼å¿…é¡»åŒ¹é…æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸ä»…ä»…æ˜¯å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦å­é›†ã€‚æˆ‘ä»¬å¾ˆå¿«å°±ä¼šç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜Žè¿™ä¸€ç‚¹ã€‚è¯¥å­—ç¬¦åœ¨æ¨¡å¼ä¸­æ˜¯å¯é€‰çš„ï¼Œå¹¶ä¸”é€šå¸¸åœ¨é€‚å½“çš„æ—¶å€™è¢«çœç•¥ã€‚<a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™"></a><code class="literal">%</code><code class="literal">%</code><code class="literal">%</code></p><p>Many <em class="command">make</em> functions accept a
        <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <em class="firstterm">pattern</em> as an argument. This
        pattern uses the same syntax as the patterns used in pattern rules
        (see the <a class="link" href="#OEBPS/ch02s04.html" title="Pattern Rules">Section 2.4</a> in
        <a class="link" href="#OEBPS/ch02.html" title="Chapter&nbsp;2.&nbsp;Rules">Chapter 2</a>). A pattern contains a
        single <code class="literal">%</code> with leading or trailing
        characters (or both). The <code class="literal">%</code>
        character represents zero or more characters of any kind. To match a
        target string, the pattern must match the entire string, not just a
        subset of characters within the string. We'll illustrate this with an
        example shortly. The <code class="literal">%</code> character is
        optional in a pattern and is commonly omitted when appropriate.</p><div class="sect2" title="å­—ç¬¦ä¸²å‡½æ•°"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch04s02.html.make3-CHP-4-SECT-2.1"></a>å­—ç¬¦ä¸²å‡½æ•°</h2><h2 class="title"><a></a>String Functions</h2></div></div></div><p>å¤§å¤šæ•°<em class="command">make</em>çš„å†…ç½®å‡½æ•°<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1164" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1165" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1166" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1167" class="indexterm"></a>ä»¥ä¸€ç§æˆ–å¦ä¸€ç§å½¢å¼æ“ä½œæ–‡æœ¬ï¼Œä½†æŸäº›å‡½æ•°åœ¨å­—ç¬¦ä¸²æ“ä½œæ–¹é¢ç‰¹åˆ«å¼ºå¤§ï¼Œè¿™äº›å°†åœ¨è¿™é‡Œè®¨è®ºã€‚</p><p>Most of <em class="command">make</em>'s built-in
          functions <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>manipulate text in one form or another, but certain
          functions are particularly strong at string manipulation, and these
          will be discussed here.</p><p><em class="command">make</em>ä¸­å¸¸è§çš„å­—ç¬¦ä¸²æ“ä½œæ˜¯ä»Žåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ç»„æ–‡ä»¶ã€‚è¿™å°±æ˜¯<em class="command">grep</em>åœ¨ shell è„šæœ¬ä¸­çš„å…¸åž‹ç”¨é€”ã€‚åœ¨<em class="command">make</em>ä¸­ï¼Œæˆ‘ä»¬æœ‰<code class="function">filter</code>ã€<code class="function">filter-out</code>ã€ å’Œ<code class="function">findstring</code>å‡½æ•°ã€‚</p><p>A common string operation in <em class="command">make</em> is to select a set of files from a
          list. This is what <em class="command">grep</em> is
          typically used for in shell scripts. In <em class="command">make</em> we have the <code class="function">filter</code>, <code class="function">filter-out</code>, and <code class="function">findstring</code> functions.</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">$(filter</code>
              <code class="option">pattern</code> <code class="literal">. .
              </code>ã€‚ ,<code class="option">text</code> <code class="literal">)</code></span></dt><dt><span class="term"><code class="literal">$(filter</code>
              <code class="option">pattern</code> <code class="literal">. .
              </code>. ,<code class="option">text</code> <code class="literal">)</code></span></dt><dd><p>è¯¥<code class="function">filter</code>å‡½æ•°å¤„ç†<code class="option">text</code> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1168" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1169" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1170" class="indexterm"></a>ä½œä¸ºç©ºæ ¼åˆ†éš”çš„å•è¯åºåˆ—å¹¶è¿”å›žåŒ¹é…çš„å•è¯çš„åˆ—è¡¨
                <code class="option">pattern</code>ã€‚ä¾‹å¦‚ï¼Œè¦æž„å»ºç”¨æˆ·ç•Œé¢ä»£ç çš„å­˜æ¡£ï¼Œæˆ‘ä»¬å¯èƒ½åªæƒ³é€‰æ‹©<em class="filename">ui</em>
                å­ç›®å½•ä¸­çš„ç›®æ ‡æ–‡ä»¶ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»Žæ–‡ä»¶ååˆ—è¡¨ä¸­æå–ä»¥<em class="filename">ui/å¼€å¤´å¹¶ä»¥</em><em class="filename">.o</em>ç»“å°¾çš„æ–‡ä»¶åã€‚è¯¥
                <code class="literal">%</code>å­—ç¬¦ä¸Žä¹‹é—´ä»»æ„æ•°é‡çš„å­—ç¬¦åŒ¹é…ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt177"></a><pre class="programlisting">$(ui_library): $(è¿‡æ»¤å™¨ ui/%.o,$(objects))
        $(AR) $(ARFLAGS) $@ $^</pre><p>ä¹Ÿå¯ä»¥<code class="function">filter</code>æŽ¥å—å¤šä¸ª
                <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1171" class="indexterm"></a>å›¾æ¡ˆï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œæ¨¡å¼å¿…é¡»ä¸Žæ•´ä¸ªå•è¯åŒ¹é…æ‰èƒ½å°†å•è¯åŒ…å«åœ¨è¾“å‡ºåˆ—è¡¨ä¸­ã€‚å› æ­¤ï¼Œä¾‹å¦‚ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt178"></a><pre class="programlisting">è¯ := ä»– æ¯é¸¡ å…¶ä»–%
å¾—åˆ°ï¼š
        @echo ä»–åŒ¹é…ï¼š$(filter he, $(words))
        @echo %he åŒ¹é…ï¼š$(filter %he, $(words))
        @echo he% åŒ¹é…ï¼š$(filter he%, $(words))
        @echo %he% åŒ¹é…ï¼š$(filter %he%, $(words))</pre><p>æ‰§è¡Œæ—¶ï¼Œ<em class="filename">makefile</em>ä¼šç”Ÿæˆè¾“å‡ºï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt179"></a><pre class="programlisting">$ åˆ¶ä½œ
ä»–åŒ¹é…ï¼š ä»–
%ä»–åŒ¹é…ï¼šä»–
he% åŒ¹é…ï¼š he hen
%he% åŒ¹é…ï¼š%</pre><p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œç¬¬ä¸€ä¸ªæ¨¡å¼ä»…åŒ¹é…å•è¯
                <code class="literal">he</code>ï¼Œå› ä¸ºè¯¥æ¨¡å¼å¿…é¡»åŒ¹é…æ•´ä¸ªå•è¯ï¼Œè€Œä¸ä»…ä»…æ˜¯å•è¯çš„ä¸€éƒ¨åˆ†ã€‚å…¶ä»–æ¨¡å¼åŒ¹é…åŠ ä¸ŠåŒ…å«åœ¨æ­£ç¡®ä½ç½®<code class="literal">he</code>çš„å•è¯ã€‚<code class="literal">he</code></p><p>ä¸€ä¸ªæ¨¡å¼åªèƒ½åŒ…å«ä¸€ä¸ª<code class="literal">%</code>ã€‚å¦‚æžœ<code class="literal">%</code>æ¨¡å¼ä¸­åŒ…å«å…¶ä»–å­—ç¬¦ï¼Œåˆ™é™¤ç¬¬ä¸€ä¸ªå­—ç¬¦å¤–çš„æ‰€æœ‰å­—ç¬¦éƒ½å°†è¢«è§†ä¸ºæ–‡å­—å­—ç¬¦ã€‚</p><p><code class="function">filter</code>æ— æ³•åŒ¹é…å•è¯ä¸­çš„å­å­—ç¬¦ä¸²æˆ–æŽ¥å—å¤šä¸ªé€šé…ç¬¦å¯èƒ½çœ‹èµ·æ¥å¾ˆå¥‡æ€ªã€‚æ‚¨ä¼šå‘çŽ°æœ‰æ—¶ä¼šéžå¸¸æ€€å¿µæ­¤åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¾ªçŽ¯å’Œæ¡ä»¶æµ‹è¯•æ¥å®žçŽ°ç±»ä¼¼çš„ä¸œè¥¿ã€‚ç¨åŽæˆ‘ä»¬ä¼šå‘æ‚¨å±•ç¤ºå¦‚ä½•æ“ä½œã€‚</p></dd><dd><p>The <code class="function">filter</code> function
                treats <code class="option">text</code> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>as a sequence of space separated words and
                returns a list of those words matching
                <code class="option">pattern</code>. For instance, to build an archive of
                user-interface code, we might want to select only the object
                files in the <em class="filename">ui</em>
                subdirectory. In the following example, we extract the
                filenames starting with <em class="filename">ui/</em> and ending in <em class="filename">.o</em> from a list of filenames. The
                <code class="literal">%</code> character matches any
                number of characters in between:</p><a></a><pre class="programlisting">$(ui_library): $(filter ui/%.o,$(objects))
        $(AR) $(ARFLAGS) $@ $^</pre><p>It is also possible for <code class="function">filter</code> to accept multiple
                <a class="indexterm"></a>patterns, separated by spaces. As noted above,
                the pattern must match an entire word for the word to be
                included in the output list. So, for instance:</p><a></a><pre class="programlisting">words := he the hen other the%
get-the:
        @echo he matches: $(filter he, $(words))
        @echo %he matches: $(filter %he, $(words))
        @echo he% matches: $(filter he%, $(words))
        @echo %he% matches: $(filter %he%, $(words))</pre><p>When executed the <em class="filename">makefile</em> generates the
                output:</p><a></a><pre class="programlisting">$ make
he matches: he
%he matches: he the
he% matches: he hen
%he% matches: the%</pre><p>As you can see, the first pattern matches only the word
                <code class="literal">he</code>, because the pattern
                must match the entire word, not just a part of it. The other
                patterns match <code class="literal">he</code> plus
                words that contain <code class="literal">he</code> in
                the right position.</p><p>A pattern can contain only one <code class="literal">%</code>. If additional <code class="literal">%</code> characters are included in the
                pattern, all but the first are treated as literal
                characters.</p><p>It may seem odd that <code class="function">filter</code> cannot match substrings
                within words or accept more than one wildcard character. You
                will find times when this functionality is sorely missed.
                However, you can implement something similar using looping and
                conditional testing. We'll show you how later.</p></dd><dt><span class="term"><code class="literal">$(filter-out</code>
              <code class="option">pattern</code> <code class="literal">. .
              </code>ã€‚ ,<code class="option">text</code> <code class="literal">)</code></span></dt><dt><span class="term"><code class="literal">$(filter-out</code>
              <code class="option">pattern</code> <code class="literal">. .
              </code>. ,<code class="option">text</code> <code class="literal">)</code></span></dt><dd><p>è¿™<code class="function">filter-out</code>
                <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1172" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1173" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1174" class="indexterm"></a>å‡½æ•°çš„ä½œç”¨ä¸Ž ç›¸å<code class="function">filter</code>ï¼Œé€‰æ‹©ä¸Žæ¨¡å¼ä¸åŒ¹é…çš„æ¯ä¸ªå•è¯ã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹©æ‰€æœ‰ä¸æ˜¯ C å¤´æ–‡ä»¶çš„æ–‡ä»¶ã€‚</p><a id="OEBPS/ch04s02.html.I_4_tt180"></a><pre class="programlisting">all_source := count_words.c counter.c lexer.l counter.h lexer.h
to_compile := $(è¿‡æ»¤å‡º%.h, $(all_source))</pre></dd><dd><p>The <code class="function">filter-out</code>
                <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>function does the opposite of <code class="function">filter</code>, selecting every word that
                does not match the pattern. Here we select all files that are
                not C headers.</p><a></a><pre class="programlisting">all_source := count_words.c counter.c lexer.l counter.h lexer.h
to_compile := $(filter-out %.h, $(all_source))</pre></dd><dt><span class="term"><code class="literal">$(findstring</code>
              <code class="option">string</code>,<code class="option">text</code> <code class="literal">)</code></span></dt><dt><span class="term"><code class="literal">$(findstring</code>
              <code class="option">string</code>,<code class="option">text</code> <code class="literal">)</code></span></dt><dd><p>è¿™ä¸ªåŠŸèƒ½<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1175" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1176" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1177" class="indexterm"></a>å¯»æ‰¾<code class="option">string</code>åœ¨
                <code class="option">text</code>.å¦‚æžœæ‰¾åˆ°è¯¥å­—ç¬¦ä¸²ï¼Œåˆ™è¯¥å‡½æ•°è¿”å›ž<code class="option">string</code>ï¼›å¦åˆ™ï¼Œå®ƒä¸ä¼šè¿”å›žä»»ä½•å†…å®¹ã€‚</p><p>ä¹ä¸€çœ‹ï¼Œè¿™ä¸ªå‡½æ•°å¯èƒ½çœ‹èµ·æ¥åƒæˆ‘ä»¬æƒ³è±¡çš„å­å­—ç¬¦ä¸²æœç´¢<em class="command">grep</em><code class="function">filter</code>å‡½æ•°ï¼Œä½†äº‹å®žå¹¶éžå¦‚æ­¤ã€‚é¦–å…ˆï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ï¼Œæ­¤å‡½æ•°ä»…è¿”å›žæœç´¢å­—ç¬¦ä¸²ï¼Œè€Œä¸è¿”å›žå®ƒæ‰¾åˆ°çš„åŒ…å«æœç´¢å­—ç¬¦ä¸²çš„å•è¯ã€‚å…¶æ¬¡ï¼Œæœç´¢å­—ç¬¦ä¸²ä¸èƒ½åŒ…å«é€šé…ç¬¦ï¼ˆæ¢å¥è¯è¯´ï¼Œ<code class="literal">%</code>æœç´¢å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦æŒ‰å­—é¢åŒ¹é…ï¼‰ã€‚</p><p><code class="function">if</code>è¯¥å‡½æ•°ä¸»è¦ä¸ŽåŽé¢è®¨è®ºçš„å‡½æ•°ç»“åˆä½¿ç”¨
                ã€‚ç„¶è€Œï¼Œæˆ‘å‘çŽ°åœ¨ä¸€ç§æƒ…å†µä¸‹
                <code class="function">findstring</code>å®ƒæœ¬èº«å¾ˆæœ‰ç”¨ã€‚</p><p>å‡è®¾æ‚¨æœ‰å¤šä¸ªå…·æœ‰å¹¶è¡Œç»“æž„çš„æ ‘ï¼Œä¾‹å¦‚å‚è€ƒæºã€æ²™ç®±æºã€è°ƒè¯•äºŒè¿›åˆ¶æ–‡ä»¶å’Œä¼˜åŒ–äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æ‚¨å¸Œæœ›èƒ½å¤Ÿä»Žå½“å‰ç›®å½•æ‰¾å‡ºæ‚¨æ‰€åœ¨çš„æ ‘ï¼ˆæ²¡æœ‰æ ¹ç›®å½•çš„å½“å‰ç›¸å¯¹è·¯å¾„ï¼‰ã€‚ä¸‹é¢æ˜¯ä¸€äº›ç¡®å®šè¿™ä¸€ç‚¹çš„æ¡†æž¶ä»£ç ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt181"></a><pre class="programlisting">æŸ¥æ‰¾æ ‘ï¼š
        # å¯†ç  = $(å¯†ç )
        # $(findstring /test/book/admin,$(PWD))
        # $(findstring /test/book/bin,$(PWD))
        # $(findstring /test/book/dblite_0.5,$(PWD))
        # $(findstring /test/book/examples,$(PWD))
        # $(findstring /test/book/out,$(PWD))
        # $(findstring /test/book/text,$(PWD))</pre><p>ï¼ˆæ¯è¡Œéƒ½ä»¥åˆ¶è¡¨ç¬¦å’Œ shell æ³¨é‡Šå­—ç¬¦å¼€å¤´ï¼Œå› æ­¤æ¯ä¸€è¡Œéƒ½åƒå…¶ä»–å‘½ä»¤ä¸€æ ·åœ¨è‡ªå·±çš„å­ shell ä¸­â€œæ‰§è¡Œâ€ã€‚Bourne Again Shellã€<em class="command">bash</em>å’Œè®¸å¤šå…¶ä»–ç±»ä¼¼ Bourne çš„ shell ä¼šå¿½ç•¥è¿™äº›è¡Œã€‚è¿™æ˜¯ä¸€ä¸ªæ›´æ‰“å°å‡ºç®€å•<em class="command">make</em>ç»“æž„çš„æ‰©å±•æ¯”é”®å…¥æ›´æ–¹ä¾¿ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ›´ä¾¿æºçš„ : shell æ“ä½œç¬¦å®žçŽ°å‡ ä¹Žç›¸åŒçš„æ•ˆæžœï¼Œä½†æ˜¯ : æ“ä½œç¬¦æ‰§è¡Œé‡å®šå‘ï¼Œå› æ­¤ï¼ŒåŒ…å«
                åˆ›å»ºæ–‡ä»¶<em class="filename">word çš„</em><code class="literal">@echo</code>å‘½ä»¤è¡Œä¼šäº§ç”Ÿå‰¯ä½œç”¨ã€‚ .) è¿è¡Œæ—¶ï¼Œå®ƒä¼šäº§ç”Ÿï¼š<code class="literal">&gt; word</code><em class="filename"></em></p><a id="OEBPS/ch04s02.html.I_4_tt182"></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
# PWD = /test/book/out/ch03-findstring-1
#
#
#
#
ï¼ƒ/æµ‹è¯•/ä¹¦/å‡º
#</pre><p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œæ¯æ¬¡æµ‹è¯•éƒ½ä¼š<code class="literal">$(PWD)</code>è¿”å›ž nullï¼Œç›´åˆ°æˆ‘ä»¬æµ‹è¯•çˆ¶ç›®å½•ã€‚ç„¶åŽè¿”å›žçˆ¶ç›®å½•æœ¬èº«ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œè¯¥ä»£ç ä»…ä½œä¸º çš„æ¼”ç¤º
                <code class="function">findstring</code>ã€‚è¿™å¯ç”¨äºŽç¼–å†™è¿”å›žå½“å‰æ ‘çš„æ ¹ç›®å½•çš„å‡½æ•°ã€‚</p></dd><dd><p>This function <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>looks for <code class="option">string</code> in
                <code class="option">text</code>. If the string is found, the function
                returns <code class="option">string</code>; otherwise, it returns
                nothing.</p><p>At first, this function might seem like the substring
                searching <em class="command">grep</em> function we
                thought <code class="function">filter</code> might be,
                but not so. First, and most important, this function returns
                just the search string, not the word it finds that contains
                the search string. Second, the search string cannot contain
                wildcard characters (putting it another way, <code class="literal">%</code> characters in the search string
                are matched literally).</p><p>This function is mostly useful in conjunction with the
                <code class="function">if</code> function discussed
                later. There is, however, one situation where I've found
                <code class="function">findstring</code> to be useful
                in its own right.</p><p>Suppose you have several trees with parallel structure
                such as reference source, sandbox source, debugging binary,
                and optimized binary. You'd like to be able to find out which
                tree you are in from your current directory (without the
                current relative path from the root). Here is some skeleton
                code to determine this:</p><a></a><pre class="programlisting">find-tree:
        # PWD = $(PWD)
        # $(findstring /test/book/admin,$(PWD))
        # $(findstring /test/book/bin,$(PWD))
        # $(findstring /test/book/dblite_0.5,$(PWD))
        # $(findstring /test/book/examples,$(PWD))
        # $(findstring /test/book/out,$(PWD))
        # $(findstring /test/book/text,$(PWD))</pre><p>(Each line begins with a tab and a shell comment
                character so each is "executed" in its own subshell just like
                other commands. The Bourne Again Shell, <em class="command">bash</em>, and many other Bourne-like
                shells simply ignore these lines. This is a more convenient
                way to print out the expansion of simple <em class="command">make</em> constructs than typing <code class="literal">@echo</code>. You can achieve almost the
                same effect using the more portable : shell operator, but the
                : operator performs redirections. Thus, a command line
                containing <code class="literal">&gt; word</code>
                creates the file <em class="filename">word</em> as
                a side effect.) When run, it produces:</p><a></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
# PWD = /test/book/out/ch03-findstring-1
# 
# 
# 
# 
# /test/book/out
#</pre><p>As you can see, each test against <code class="literal">$(PWD)</code> returns null until we test
                our parent directory. Then the parent directory itself is
                returned. As shown, the code is merely as a demonstration of
                <code class="function">findstring</code>. This can be
                used to write a function returning the current tree's root
                directory.</p></dd></dl></div><p>æœ‰ä¸¤ä¸ªæœç´¢å’Œ<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1178" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1179" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1180" class="indexterm"></a>æ›¿æ¢å‡½æ•°ï¼š</p><p>There are two search and <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>replace functions:</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">$(subst</code>
              <code class="option">search-string</code>, <code class="option">replace-string</code>,<code class="option">text</code>
              <code class="literal">)</code></span></dt><dt><span class="term"><code class="literal">$(subst</code>
              <code class="option">search-string</code>,<code class="option">replace-string</code>,<code class="option">text</code>
              <code class="literal">)</code></span></dt><dd><p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ã€<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1181" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1182" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1183" class="indexterm"></a>éžé€šé…ç¬¦ï¼Œæœç´¢å’Œæ›¿æ¢ã€‚å®ƒæœ€å¸¸è§çš„ç”¨é€”ä¹‹ä¸€æ˜¯å°†æ–‡ä»¶ååˆ—è¡¨ä¸­çš„ä¸€ä¸ªåŽç¼€æ›¿æ¢ä¸ºå¦ä¸€ä¸ªåŽç¼€ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt183"></a><pre class="programlisting">æ¥æº := count_words.c counter.c lexer.c
å¯¹è±¡ := $(subst .c,.o,$(æ¥æº))</pre><p>è¿™ä¼šå°†ä¸­ä»»ä½•ä½ç½®å‡ºçŽ°çš„æ‰€æœ‰â€œ <em class="filename">.c</em> â€æ›¿æ¢ä¸ºâ€œ <em class="filename">.o</em><code class="literal">$(sources)</code> â€ ï¼Œæˆ–è€…æ›´ä¸€èˆ¬åœ°è¯´ï¼Œå°†æœç´¢å­—ç¬¦ä¸²çš„æ‰€æœ‰å‡ºçŽ°æ›¿æ¢ä¸ºæ›¿æ¢å­—ç¬¦ä¸²ã€‚</p><p>æ­¤ç¤ºä¾‹æ˜¯ä¸€ä¸ªå¸¸è§çš„è¯´æ˜Žï¼Œè¯´æ˜Žç©ºæ ¼åœ¨å‡½æ•°è°ƒç”¨å‚æ•°ä¸­çš„é‡è¦æ€§ã€‚è¯·æ³¨æ„ï¼Œé€—å·åŽé¢æ²¡æœ‰ç©ºæ ¼ã€‚å¦‚æžœæˆ‘ä»¬æ”¹ä¸ºè¿™æ ·å†™ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt184"></a><pre class="programlisting">æ¥æº := count_words.c counter.c lexer.c
å¯¹è±¡ := $(subst .c, .o, $(æº))</pre><p>ï¼ˆæ³¨æ„æ¯ä¸ªé€—å·åŽé¢çš„ç©ºæ ¼ï¼‰ï¼Œ çš„å€¼
                <code class="literal">$(objects)</code>å°†æ˜¯ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt185"></a><pre class="programlisting">count_words .o è®¡æ•°å™¨ .o è¯æ³•åˆ†æžå™¨ .o</pre><p>æ ¹æœ¬ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚é—®é¢˜åœ¨äºŽå‚æ•°ä¹‹å‰çš„ç©ºæ ¼<code class="literal">.o</code>æ˜¯æ›¿æ¢æ–‡æœ¬çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶è¢«æ’å…¥åˆ°è¾“å‡ºå­—ç¬¦ä¸²ä¸­ã€‚ä¹‹å‰çš„ç©ºæ ¼æ²¡é—®é¢˜ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¹‹å‰çš„æ‰€æœ‰ç©ºæ ¼éƒ½è¢«<em class="command">make</em><code class="literal">.c</code>åŽ»æŽ‰äº†ã€‚äº‹å®žä¸Šï¼Œå‰é¢çš„ç©ºæ ¼
                ä¹Ÿå¯èƒ½æ˜¯è‰¯æ€§çš„ï¼Œå› ä¸ºå¾ˆå¯èƒ½è¢«ç”¨ä½œç®€å•çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œå…¶ä¸­å‰å¯¼ç©ºæ ¼ä¸æ˜¯é—®é¢˜ã€‚ä½†æ˜¯ï¼Œæˆ‘æ°¸è¿œä¸ä¼šåœ¨å‡½æ•°è°ƒç”¨ä¸­çš„é€—å·åŽæ··åˆä¸åŒçš„é—´è·ï¼Œå³ä½¿å®ƒäº§ç”Ÿæ­£ç¡®çš„ç»“æžœï¼š<em class="command"></em><code class="literal">$(sources)</code><code class="literal">$(objects)</code></p><a id="OEBPS/ch04s02.html.I_4_tt186"></a><pre class="programlisting"># æ˜¯çš„ï¼Œè¿™ä¸ªè°ƒç”¨ä¸­çš„é—´è·å¤ªå¾®å¦™äº†ã€‚
å¯¹è±¡ := $(subst .c,.o, $(æº))</pre><p>è¯·æ³¨æ„ï¼Œå®ƒ<code class="function">subst</code>
                ä¸ç†è§£æ–‡ä»¶åæˆ–æ–‡ä»¶åŽç¼€ï¼Œåªç†è§£å­—ç¬¦ä¸²ã€‚å¦‚æžœæˆ‘çš„æºæ–‡ä»¶ä¹‹ä¸€åŒ…å«<code class="literal">.c</code>å†…éƒ¨ï¼Œé‚£ä¹ˆå®ƒä¹Ÿå°†è¢«æ›¿æ¢ã€‚ä¾‹å¦‚ï¼Œæ–‡ä»¶å<em class="filename">car.cdr.c</em>å°†è½¬æ¢ä¸º
                <em class="filename">car.odr.o</em>ã€‚å¯èƒ½ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p><p><a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™">åœ¨ç¬¬ 2 ç« </a>
                çš„<a class="link" href="#OEBPS/ch02s07.html" title="è‡ªåŠ¨ä¾èµ–ç”Ÿæˆ">2.7 èŠ‚</a>ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä¾èµ–é¡¹ç”Ÿæˆã€‚è¯¥éƒ¨åˆ†çš„
                æœ€åŽä¸€ä¸ªç¤ºä¾‹<em class="filename">makefile</em>ä½¿ç”¨å¦‚ä¸‹ï¼š<a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™"></a><em class="filename"></em><code class="function">subst</code></p><a id="OEBPS/ch04s02.html.I_4_tt187"></a><pre class="programlisting">VPATH = src åŒ…å«
CPPFLAGS = -æˆ‘åŒ…æ‹¬
æ¥æº= count_words.c \
           è¯æ³•åˆ†æžå™¨.c \
           è®¡æ•°å™¨.c
count_words: counter.o lexer.o -lfl
count_words.oï¼šè®¡æ•°å™¨.h
counter.o: counter.h lexer.h
è¯æ³•åˆ†æžå™¨.o: è¯æ³•åˆ†æžå™¨.h
åŒ…æ‹¬ $(subst .c,.d,$(æ¥æº))
%.d: %.c
        $(CC) -M $(CPPFLAGS) $&lt; &gt; $@.$$$$; \
        sed 's,\($*\)\.o[ :]*,\1.o $@ : ,g' &lt; $@.$$$$ &gt; $@; \
        rm -f $@.$$$$</pre><p>è¯¥<code class="function">subst</code>å‡½æ•°ç”¨äºŽå°†æºæ–‡ä»¶åˆ—è¡¨è½¬æ¢ä¸ºä¾èµ–æ–‡ä»¶åˆ—è¡¨ã€‚ç”±äºŽä¾èµ–é¡¹æ–‡ä»¶ä½œä¸º çš„å‚æ•°å‡ºçŽ°
                ï¼Œå› æ­¤å®ƒä»¬è¢«è§†ä¸ºå…ˆå†³æ¡ä»¶å¹¶ä½¿ç”¨è¯¥è§„åˆ™<code class="literal">include</code>è¿›è¡Œæ›´æ–°ã€‚<code class="literal">%.d</code></p></dd><dd><p>This is a simple, <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>nonwildcard, search and replace. One of its most
                common uses is to replace one suffix with another in a list of
                filenames:</p><a></a><pre class="programlisting">sources := count_words.c counter.c lexer.c
objects := $(subst .c,.o,$(sources))</pre><p>This replaces all occurrences of "<em class="filename">.c</em>" with "<em class="filename">.o</em>" anywhere in <code class="literal">$(sources)</code>, or, more generally, all
                occurrences of the search string with the replacement
                string.</p><p>This example is a commonly found illustration of where
                spaces are significant in function call arguments. Note that
                there are no spaces after the commas. If we had instead
                written:</p><a></a><pre class="programlisting">sources := count_words.c counter.c lexer.c
objects := $(subst .c, .o, $(sources))</pre><p>(notice the space after each comma), the value of
                <code class="literal">$(objects)</code> would have
                been:</p><a></a><pre class="programlisting">count_words .o counter .o lexer .o</pre><p>Not at all what we want. The problem is that the space
                before the <code class="literal">.o</code> argument is
                part of the replacement text and was inserted into the output
                string. The space before the <code class="literal">.c</code> is fine because all whitespace
                before the first argument is stripped off by <em class="command">make</em>. In fact, the space before
                <code class="literal">$(sources)</code> is probably
                benign as well since <code class="literal">$(objects)</code> will most likely be used
                as a simple command-line argument where leading spaces aren't
                a problem. However, I would never mix different spacing after
                commas in a function call even if it yields the correct
                results:</p><a></a><pre class="programlisting"># Yech, the spacing in this call is too subtle.
objects := $(subst .c,.o, $(source))</pre><p>Note that <code class="function">subst</code>
                doesn't understand filenames or file suffixes, just strings of
                characters. If one of my source files contains a <code class="literal">.c</code> internally, that too will be
                substituted. For instance, the filename <em class="filename">car.cdr.c</em> would be transformed into
                <em class="filename">car.odr.o</em>. Probably not
                what we want.</p><p>In <a class="link" href="#OEBPS/ch02s07.html" title="Automatic Dependency Generation">Section 2.7</a>
                in <a class="link" href="#OEBPS/ch02.html" title="Chapter&nbsp;2.&nbsp;Rules">Chapter 2</a>, we talked
                about dependency generation. The last example <em class="filename">makefile</em> of that section used
                <code class="function">subst</code> like this:</p><a></a><pre class="programlisting">VPATH    = src include
CPPFLAGS = -I include
SOURCES  = count_words.c \
           lexer.c       \
           counter.c
count_words: counter.o lexer.o -lfl
count_words.o: counter.h
counter.o: counter.h lexer.h
lexer.o: lexer.h
include $(subst .c,.d,$(SOURCES))
%.d: %.c
        $(CC) -M $(CPPFLAGS) $&lt; &gt; $@.$$$$;                      \
        sed 's,\($*\)\.o[ :]*,\1.o $@ : ,g' &lt; $@.$$$$ &gt; $@;     \
        rm -f $@.$$$$</pre><p>The <code class="function">subst</code> function
                is used to transform the source file list into a dependency
                file list. Since the dependency files appear as an argument to
                <code class="literal">include</code>, they are
                considered prerequisites and are updated using the <code class="literal">%.d</code> rule.</p></dd><dt><span class="term"><code class="literal">$(patsubst</code>
              <code class="option">search-pattern</code>, <code class="option">replace-pattern</code>,<code class="option">text</code>
              <code class="literal">)</code></span></dt><dt><span class="term"><code class="literal">$(patsubst</code>
              <code class="option">search-pattern</code>,<code class="option">replace-pattern</code>,<code class="option">text</code>
              <code class="literal">)</code></span></dt><dd><p>è¿™æ˜¯æœç´¢å’Œæ›¿æ¢çš„é€šé…ç¬¦ç‰ˆæœ¬ã€‚åƒå¾€å¸¸ä¸€æ ·ï¼Œè¯¥æ¨¡å¼å¯ä»¥åŒ…å«å•ä¸ª<code class="literal">%</code>.ç™¾åˆ†ä¹‹ä¸€åœ¨
                <code class="option">replace-pattern</code> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1184" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1185" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1186" class="indexterm"></a>ä¸ŽåŒ¹é…çš„æ–‡æœ¬ä¸€èµ·æ‰©å±•ã€‚é‡è¦çš„æ˜¯è¦è®°ä½ å¿…é¡»<code class="option">search-pattern</code>
                åŒ¹é… çš„æ•´ä¸ªå€¼<code class="option">text</code>ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å°†åˆ é™¤ ä¸­çš„å°¾éƒ¨æ–œæ 
                <code class="option">text</code>ï¼Œè€Œä¸æ˜¯åˆ é™¤ ä¸­çš„æ¯ä¸ªæ–œæ 
                <code class="option">text</code>ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt188"></a><pre class="programlisting">æ¡å°¾æ–œæ  = $(patsubst %/,%,$(ç›®å½•è·¯å¾„))</pre><p><em class="firstterm">æ›¿ä»£å‚è€ƒ</em>æ˜¯
                <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1187" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1188" class="indexterm"></a>æ‰§è¡Œç›¸åŒæ›¿æ¢çš„ä¾¿æºå¼æ–¹å¼ã€‚æ›¿æ¢å¼•ç”¨çš„è¯­æ³•æ˜¯ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt189"></a><pre class="programlisting">$( <em class="replaceable"><code>variable</code></em>: <em class="replaceable"><code>search</code></em>= <em class="replaceable"><code>replace</code></em>)</pre><p>æ–‡æœ¬<em class="replaceable"><code>search</code></em>å¯ä»¥æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ï¼›åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<em class="replaceable"><code>replace</code></em>æ¯å½“å­—ç¬¦ä¸²å‡ºçŽ°åœ¨å•è¯æœ«å°¾æ—¶ï¼Œè¯¥å­—ç¬¦ä¸²å°±ä¼šè¢«æ›¿æ¢
                ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦åŽé¢è·Ÿç€ç©ºæ ¼æˆ–å˜é‡å€¼çš„æœ«å°¾ã€‚å¦å¤–ï¼Œ
                <em class="replaceable"><code>search</code></em>å¯ä»¥åŒ…å«<code class="literal">%</code>ä»£è¡¨é€šé…ç¬¦çš„aï¼›åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœç´¢å’Œæ›¿æ¢éµå¾ª çš„è§„åˆ™
                <code class="function">patsubst</code>ã€‚æˆ‘å‘çŽ°ä¸Ž
                <code class="function">patsubst</code>.</p><p>æ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œå˜é‡é€šå¸¸åŒ…å«å•è¯åˆ—è¡¨ã€‚ä»¥ä¸‹æ˜¯ä»Žåˆ—è¡¨ä¸­é€‰æ‹©å•è¯ã€è®¡ç®—åˆ—è¡¨é•¿åº¦ç­‰çš„å‡½æ•°ã€‚ä¸Žæ‰€æœ‰<em class="command">make</em>å‡½æ•°ä¸€æ ·ï¼Œå•è¯ä¹‹é—´ç”¨<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1189" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1190" class="indexterm"></a>ç©ºç™½ã€‚</p></dd><dd><p>This is the wildcard version of search and replace. As
                usual, the pattern can contain a single <code class="literal">%</code>. A percent in the
                <code class="option">replace-pattern</code> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> is expanded with the matching text. It is
                important to remember that the <code class="option">search-pattern</code>
                must match the entire value of <code class="option">text</code>. For
                instance, the following will delete a trailing slash in
                <code class="option">text</code>, not every slash in
                <code class="option">text</code>:</p><a></a><pre class="programlisting">strip-trailing-slash = $(patsubst %/,%,$(directory-path))</pre><p><em class="firstterm">Substitution references</em> are a
                <a class="indexterm"></a> <a class="indexterm"></a>portable way of performing the same
                substitution. The syntax of a substitution reference
                is:</p><a></a><pre class="programlisting">$(<em class="replaceable"><code>variable</code></em>:<em class="replaceable"><code>search</code></em>=<em class="replaceable"><code>replace</code></em>)</pre><p>The <em class="replaceable"><code>search</code></em> text can be a
                simple string; in which case, the string is replaced with
                <em class="replaceable"><code>replace</code></em> whenever it occurs at the
                end of a word. That is, whenever it is followed by whitespace
                or the end of the variable value. In addition,
                <em class="replaceable"><code>search</code></em> can contain a <code class="literal">%</code> representing a wildcard character;
                in which case, the search and replace follow the rules of
                <code class="function">patsubst</code>. I find this
                syntax to be obscure and difficult to read in comparison to
                <code class="function">patsubst</code>.</p><p>As we've seen, variables often contain lists of words.
                Here are functions to select words from a list, count the
                length of a list, etc. As with all <em class="command">make</em> functions, words are separated
                by <a class="indexterm"></a> <a class="indexterm"></a>whitespace.</p></dd><dt><span class="term"><code class="literal">$(words</code>
              <code class="option">text</code> <code class="literal">)</code></span></dt><dt><span class="term"><code class="literal">$(words</code>
              <code class="option">text</code> <code class="literal">)</code></span></dt><dd><p>è¿™å°†è¿”å›žæ•°é‡<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1191" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1192" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1193" class="indexterm"></a>ä¸­çš„è¯<code class="option">text</code>ã€‚</p><a id="OEBPS/ch04s02.html.I_4_tt190"></a><pre class="programlisting">CURRENT_PATH := $(æ›¿æ¢ /, ,$(HOME))
å­—ï¼š
        @echo æˆ‘çš„ä¸»è·¯å¾„æœ‰ $(words $(CURRENT_PATH)) ç›®å½•ã€‚</pre><p>è¿™ä¸ªå‡½æ•°æœ‰å¾ˆå¤šç”¨é€”ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±ä¼šçœ‹åˆ°ï¼Œä½†æˆ‘ä»¬éœ€è¦ä»‹ç»æ›´å¤šå‡½æ•°æ‰èƒ½æœ‰æ•ˆåœ°ä½¿ç”¨å®ƒã€‚</p></dd><dd><p>This returns the number of <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>words in <code class="option">text</code>.</p><a></a><pre class="programlisting">CURRENT_PATH := $(subst /, ,$(HOME))
words:
        @echo My HOME path has $(words $(CURRENT_PATH)) directories.</pre><p>This function has many uses, as we'll see shortly, but
                we need to cover a few more functions to use it
                effectively.</p></dd><dt><span class="term"><code class="literal">$(word</code>
              <code class="option">n</code>,<code class="option">text</code> <code class="literal">)</code></span></dt><dt><span class="term"><code class="literal">$(word</code>
              <code class="option">n</code>,<code class="option">text</code> <code class="literal">)</code></span></dt><dd><p>è¿™å°†è¿”å›žä¸­çš„<sup>ç¬¬ th ä¸ª</sup>å•è¯ã€‚ç¬¬ä¸€ä¸ªå­—çš„ç¼–å·ä¸º 1ã€‚å¦‚æžœ
                å¤§äºŽ ä¸­çš„å­—æ•°ï¼Œåˆ™è¯¥å‡½æ•°çš„å€¼ä¸ºç©ºã€‚<em class="replaceable"><code>n</code></em>
                <sup></sup><code class="option">text</code><em class="replaceable"><code>n</code></em><code class="option">text</code></p><a id="OEBPS/ch04s02.html.I_4_tt191"></a><pre class="programlisting">ç‰ˆæœ¬åˆ—è¡¨ := $(subst ., ,$(MAKE_VERSION))
æ¬¡è¦ç‰ˆæœ¬ := $(å•è¯ 2, $(version_list))</pre><p>è¯¥å˜é‡<code class="literal">MAKE_VERSION</code>æ˜¯å†…ç½®å˜é‡ã€‚ ï¼ˆå‚è§<a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®">ç¬¬ 3 ç« </a>
                ç¬¬<a class="link" href="#OEBPS/ch03s08.html" title="æ ‡å‡† make å˜é‡">3.8 èŠ‚</a>ã€‚ï¼‰<a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®"></a></p><p>æ‚¨å§‹ç»ˆå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼èŽ·å–åˆ—è¡¨ä¸­çš„æœ€åŽä¸€ä¸ªå•è¯ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt192"></a><pre class="programlisting">å½“å‰ := $(å•è¯ $(å•è¯ $(MAKEFILE_LIST)), $(MAKEFILE_LIST))</pre><p>è¿™å°†è¿”å›žæœ€è¿‘è¯»å–çš„
                <em class="filename">makefile</em>çš„åç§°ã€‚</p></dd><dd><p>This returns the <em class="replaceable"><code>n</code></em>
                <sup>th</sup> word in <code class="option">text</code>.
                The first word is numbered 1. If <em class="replaceable"><code>n</code></em>
                is larger than the number of words in <code class="option">text</code>,
                the value of the function is empty.</p><a></a><pre class="programlisting">version_list  := $(subst ., ,$(MAKE_VERSION))
minor_version := $(word 2, $(version_list))</pre><p>The variable <code class="literal">MAKE_VERSION</code> is a built-in variable.
                (See the <a class="link" href="#OEBPS/ch03s08.html" title="Standard make Variables">Section 3.8</a>
                in <a class="link" href="#OEBPS/ch03.html" title="Chapter&nbsp;3.&nbsp;Variables and Macros">Chapter 3</a>.)</p><p>You can always get the last word in a list with:</p><a></a><pre class="programlisting">current := $(word $(words $(MAKEFILE_LIST)), $(MAKEFILE_LIST))</pre><p>This returns the name of the most recently read
                <em class="filename">makefile</em>.</p></dd><dt><span class="term"><code class="literal">$(firstword</code>
              <code class="option">text</code> <code class="literal">)</code></span></dt><dt><span class="term"><code class="literal">$(firstword</code>
              <code class="option">text</code> <code class="literal">)</code></span></dt><dd><p>è¿™å°†è¿”å›ž<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1194" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1195" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1196" class="indexterm"></a>ä¸­çš„ç¬¬ä¸€ä¸ªè¯<code class="option">text</code>ã€‚è¿™ç›¸å½“äºŽ<code class="function">$(word 1,</code>
                <code class="option">text</code>ï¼‰ã€‚</p><a id="OEBPS/ch04s02.html.I_4_tt193"></a><pre class="programlisting">ç‰ˆæœ¬åˆ—è¡¨ := $(subst ., ,$(MAKE_VERSION))
ä¸»è¦ç‰ˆæœ¬ := $(ç¬¬ä¸€ä¸ªå•è¯ $(version_list))</pre></dd><dd><p>This returns the<a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> first word in <code class="option">text</code>. This is
                equivalent to <code class="function">$(word 1,</code>
                <code class="option">text</code>).</p><a></a><pre class="programlisting">version_list := $(subst ., ,$(MAKE_VERSION))
major_version := $(firstword $(version_list))</pre></dd><dt><span class="term"><code class="literal">$(wordlist</code>
              <code class="option">start</code>, <code class="option">end</code>,<code class="option">text</code>
              <code class="literal">)</code></span></dt><dt><span class="term"><code class="literal">$(wordlist</code>
              <code class="option">start</code>,<code class="option">end</code>,<code class="option">text</code>
              <code class="literal">)</code></span></dt><dd><p>è¿™å°†è¿”å›ž<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1197" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1198" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1199" class="indexterm"></a><code class="option">text</code>ä»Ž
                <code class="option">start</code>åˆ°ä¸­çš„å•è¯<code class="option">end</code>ï¼ŒåŒ…å«åœ¨å†…ã€‚ä¸Žè¯¥<code class="function">word</code>å‡½æ•°ä¸€æ ·ï¼Œç¬¬ä¸€ä¸ªå­—çš„ç¼–å·ä¸º 1ã€‚å¦‚æžœ<code class="option">start</code>å¤§äºŽå­—æ•°ï¼Œåˆ™è¯¥å€¼ä¸ºç©ºã€‚å¦‚æžœ
                <code class="option">start</code>å¤§äºŽ<code class="option">end</code>ï¼Œåˆ™è¯¥å€¼ä¸ºç©ºã€‚å¦‚æžœ<code class="option">end</code>å¤§äºŽå•è¯æ•°ï¼Œåˆ™<code class="option">start</code>è¿”å›žä»Ž å¼€å§‹çš„æ‰€æœ‰å•è¯ã€‚</p><a id="OEBPS/ch04s02.html.I_4_tt194"></a><pre class="programlisting"># $(call uid_gid, ç”¨æˆ·å)
uid_gid = $(å•è¯åˆ—è¡¨ 3, 4, \
            $(æ›¿æ¢:,,\
              $(shell grep "^$1:" /etc/passwd)))</pre></dd><dd><p>This returns the <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>words in <code class="option">text</code> from
                <code class="option">start</code> to <code class="option">end</code>, inclusive. As
                with the <code class="function">word</code> function,
                the first word is numbered 1. If <code class="option">start</code> is
                greater than the number of words, the value is empty. If
                <code class="option">start</code> is greater than <code class="option">end</code>,
                the value is empty. If <code class="option">end</code> is greater than
                the number of words, all words from <code class="option">start</code> on
                are returned.</p><a></a><pre class="programlisting"># $(call uid_gid, user-name)
uid_gid = $(wordlist 3, 4, \
            $(subst :, ,   \
              $(shell grep "^$1:" /etc/passwd)))</pre></dd></dl></div></div><div class="sect2" title="é‡è¦çš„æ‚é¡¹åŠŸèƒ½"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch04s02.html.make3-CHP-4-SECT-2.2"></a>é‡è¦çš„æ‚é¡¹åŠŸèƒ½</h2><h2 class="title"><a></a>Important Miscellaneous Functions</h2></div></div></div><p>åœ¨æˆ‘ä»¬ä»‹ç»ç®¡ç†æ–‡ä»¶åçš„å‡½æ•°ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆä»‹ç»ä¸¤ä¸ªéžå¸¸æœ‰ç”¨çš„å‡½æ•°ï¼š<code class="function">sort</code>å’Œ<code class="function">shell</code>ã€‚</p><p>Before we push on to functions for managing filenames, let's
          introduce two very useful functions: <code class="function">sort</code> and <code class="function">shell</code>.</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">$(sort</code>
              <code class="option">list</code> <code class="literal">)</code></span></dt><dt><span class="term"><code class="literal">$(sort</code>
              <code class="option">list</code> <code class="literal">)</code></span></dt><dd><p>åŠŸèƒ½<code class="function">sort</code>â€‹
                <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1200" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1201" class="indexterm"></a>å¯¹å®ƒçš„<code class="option">list</code>å‚æ•°è¿›è¡ŒæŽ’åºå¹¶åˆ é™¤é‡å¤é¡¹ã€‚ç»“æžœåˆ—è¡¨åŒ…å«æŒ‰å­—å…¸é¡ºåºæŽ’åˆ—çš„æ‰€æœ‰å”¯ä¸€å•è¯ï¼Œæ¯ä¸ªå•è¯ç”±ä¸€ä¸ªç©ºæ ¼åˆ†éš”ã€‚æ­¤å¤–ï¼Œ<code class="function">sort</code>
                åŽ»é™¤å‰å¯¼å’Œå°¾éšç©ºç™½ã€‚</p><a id="OEBPS/ch04s02.html.I_4_tt195"></a><pre class="programlisting">$ make -f- &lt;&lt;&lt; 'x:;@echo =$(sort dbsdt )='
=bdst=</pre><p><code class="function">sort</code>å½“ç„¶ï¼Œè¯¥å‡½æ•°æ˜¯ç›´æŽ¥ç”±<em class="command">make</em>å®žçŽ°çš„ï¼Œå› æ­¤å®ƒä¸æ”¯æŒç¨‹åºçš„ä»»ä½•é€‰é¡¹<code class="literal">sort</code>
                ã€‚è¯¥å‡½æ•°å¯¹å…¶å‚æ•°è¿›è¡Œæ“ä½œï¼Œé€šå¸¸æ˜¯å˜é‡æˆ–å¦ä¸€ä¸ª<em class="command">make</em>å‡½æ•°çš„è¿”å›žå€¼ã€‚</p></dd><dd><p>The <code class="function">sort</code> function
                <a class="indexterm"></a> <a class="indexterm"></a>sorts its <code class="option">list</code> argument and
                removes duplicates. The resulting list contains all the unique
                words in lexicographic order, each separated by a single
                space. In addition, <code class="function">sort</code>
                strips leading and trailing blanks.</p><a></a><pre class="programlisting">$ make -f- &lt;&lt;&lt; 'x:;@echo =$(sort    d  b s   d      t   )='
=b d s t=</pre><p>The <code class="function">sort</code> function
                is, of course, implemented directly by <em class="command">make</em>, so it does not support any of
                the options of the <code class="literal">sort</code>
                program. The function operates on its argument, typically a
                variable or the return value of another <em class="command">make</em> function.</p></dd><dt><span class="term"><code class="literal">$(shell</code>
              <code class="option">command</code> <code class="literal">)</code></span></dt><dt><span class="term"><code class="literal">$(shell</code>
              <code class="option">command</code> <code class="literal">)</code></span></dt><dd><p>è¯¥<code class="function">shell</code>å‡½æ•°æŽ¥å—<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1202" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1203" class="indexterm"></a>æ‰©å±•çš„å•ä¸ªå‚æ•°ï¼ˆåƒæ‰€æœ‰å‚æ•°ä¸€æ ·ï¼‰å¹¶ä¼ é€’ç»™å­ shell æ‰§è¡Œã€‚ç„¶åŽè¯»å–å‘½ä»¤çš„æ ‡å‡†è¾“å‡ºå¹¶å°†å…¶ä½œä¸ºå‡½æ•°çš„å€¼è¿”å›žã€‚è¾“å‡ºä¸­çš„æ¢è¡Œç¬¦åºåˆ—è¢«æŠ˜å ä¸ºå•ä¸ªç©ºæ ¼ã€‚ä»»ä½•å°¾éšæ¢è¡Œç¬¦éƒ½ä¼šè¢«åˆ é™¤ã€‚ä¸è¿”å›žæ ‡å‡†é”™è¯¯ï¼Œä¹Ÿä¸è¿”å›žä»»ä½•ç¨‹åºé€€å‡ºçŠ¶æ€ã€‚</p><a id="OEBPS/ch04s02.html.I_4_tt196"></a><pre class="programlisting">stdout := $(shell å›žæ˜¾æ­£å¸¸æ¶ˆæ¯)
stderr := $(shell å›žæ˜¾é”™è¯¯æ¶ˆæ¯ 1&gt;&amp;2)
å¤–å£³å€¼ï¼š
        # $(æ ‡å‡†è¾“å‡º)
        # $(æ ‡å‡†é”™è¯¯)</pre><p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œå‘é€åˆ°<em class="filename">stderr</em>çš„æ¶ˆæ¯ç…§å¸¸å‘é€åˆ°ç»ˆç«¯ï¼Œå› æ­¤ä¸åŒ…å«åœ¨å‡½æ•°çš„è¾“å‡ºä¸­<code class="function">shell</code>ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt197"></a><pre class="programlisting">$ åˆ¶ä½œ
é”™è¯¯ä¿¡æ¯
# æ­£å¸¸æ¶ˆæ¯
#</pre><p>è¿™æ˜¯åˆ›å»ºä¸€ç»„ç›®å½•çš„å¾ªçŽ¯ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt198"></a><pre class="programlisting">REQUIRED_DIRS = ...
_MKDIRS := $(shell for d in $(REQUIRED_DIRS); \
             åš \
               [[ -d $$d ]] || mkdir -p $$d; \
             å®Œæ¯•ï¼‰</pre><p>é€šå¸¸ï¼Œ
                å¦‚æžœåœ¨æ‰§è¡Œä»»ä½•å‘½ä»¤è„šæœ¬ä¹‹å‰èƒ½å¤Ÿä¿è¯åŸºæœ¬çš„è¾“å‡ºç›®å½•å­˜åœ¨ï¼Œåˆ™<em class="filename">makefileæ›´å®¹æ˜“å®žçŽ°ã€‚è¯¥å˜é‡é€šè¿‡ä½¿ç”¨</em><em class="command">bash</em> shellâ€œforâ€å¾ªçŽ¯åˆ›å»ºå¿…è¦çš„ç›®å½•ï¼Œ
                ä»¥ç¡®ä¿ä¸€ç»„ç›®å½•å­˜åœ¨ã€‚åŒæ–¹æ‹¬å·æ˜¯<em class="command">bashæµ‹è¯•è¯­æ³•ï¼Œä¸Ž</em><em class="command">æµ‹è¯•</em>ç¨‹åºç±»ä¼¼
                ï¼Œåªæ˜¯ä¸æ‰§è¡Œåˆ†è¯å’Œè·¯å¾„åæ‰©å±•ã€‚å› æ­¤ï¼Œå¦‚æžœå˜é‡åŒ…å«å¸¦æœ‰åµŒå…¥ç©ºæ ¼çš„æ–‡ä»¶åï¼Œæµ‹è¯•ä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œï¼ˆå¹¶ä¸”ä¸å¸¦å¼•å·ï¼‰ã€‚é€šè¿‡å°†æ­¤<em class="command">makeå˜é‡èµ‹å€¼æ”¾åœ¨</em><em class="filename">makefile çš„</em>æ—©æœŸï¼Œæˆ‘ä»¬ç¡®ä¿å®ƒåœ¨å‘½ä»¤è„šæœ¬æˆ–å…¶ä»–å˜é‡ä½¿ç”¨è¾“å‡ºç›®å½•ä¹‹å‰æ‰§è¡Œã€‚çš„å®žé™…å€¼<code class="literal">_MKDIRS</code>æ˜¯æ— å…³ç´§è¦çš„ï¼Œ<code class="literal">_MKDIRS</code>å®ƒæœ¬èº«æ°¸è¿œä¸ä¼šè¢«ä½¿ç”¨ã€‚</p></dd><dd><p>The <code class="function">shell</code> function
                accepts <a class="indexterm"></a> <a class="indexterm"></a>a single argument that is expanded (like all
                arguments) and passed to a subshell for execution. The
                standard output of the command is then read and returned as
                the value of the function. Sequences of newlines in the output
                are collapsed to a single space. Any trailing newline is
                deleted. The standard error is not returned, nor is any
                program exit status.</p><a></a><pre class="programlisting">stdout := $(shell echo normal message)
stderr := $(shell echo error message 1&gt;&amp;2)
shell-value:
        # $(stdout)
        # $(stderr)</pre><p>As you can see, messages to <em class="filename">stderr</em> are sent to the terminal as
                usual and so are not included in the output of the <code class="function">shell</code> function:</p><a></a><pre class="programlisting">$ make
error message
# normal message
#</pre><p>Here is a loop to create a set of directories:</p><a></a><pre class="programlisting">REQUIRED_DIRS = ...
_MKDIRS := $(shell for d in $(REQUIRED_DIRS); \
             do                               \
               [[ -d $$d ]] || mkdir -p $$d;  \
             done)</pre><p>Often, a <em class="filename">makefile</em>
                is easier to implement if essential output directories can be
                guaranteed to exist before any command scripts are executed.
                This variable creates the necessary directories by using a
                <em class="command">bash</em> shell "for" loop to
                ensure that a set of directories exists. The double square
                brackets are <em class="command">bash</em> test
                syntax similar to the <em class="command">test</em>
                program except that word splitting and pathname expansion are
                not performed. Therefore if the variable contains a filename
                with embedded spaces, the test still works correctly (and
                without quoting). By placing this <em class="command">make</em> variable assignment early in
                the <em class="filename">makefile</em>, we ensure
                it is executed before command scripts or other variables use
                the output directories. The actual value of <code class="literal">_MKDIRS</code> is irrelevant and <code class="literal">_MKDIRS</code> itself would never be
                used.</p></dd></dl></div><p><code class="function">shell</code>æ—¢ç„¶å¯ä»¥ä½¿ç”¨è¯¥åŠŸèƒ½<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1204" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1205" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1206" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1207" class="indexterm"></a>è¦è°ƒç”¨ä»»ä½•å¤–éƒ¨ç¨‹åºï¼Œæ‚¨åº”è¯¥å°å¿ƒå¦‚ä½•ä½¿ç”¨å®ƒã€‚ç‰¹åˆ«æ˜¯ï¼Œæ‚¨åº”è¯¥è€ƒè™‘ç®€å•å˜é‡å’Œé€’å½’å˜é‡ä¹‹é—´çš„åŒºåˆ«ã€‚</p><p>Since the <code class="function">shell</code> function
          can be used <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>to invoke any external program, you should be careful
          how you use it. In particular, you should consider the distinction
          between simple variables and recursive variables.</p><a id="OEBPS/ch04s02.html.I_4_tt199"></a><pre class="programlisting">START_TIME := $(å¤–å£³æ—¥æœŸ)
CURRENT_TIME = $(å¤–å£³æ—¥æœŸ)</pre><pre class="programlisting">START_TIME   := $(shell date)
CURRENT_TIME =  $(shell date)</pre><p>å½“å®šä¹‰è¯¥å˜é‡æ—¶ï¼Œè¯¥<code class="literal">START_TIME</code>å˜é‡ä¼šå¯¼è‡´<em class="command">æ—¥æœŸ</em>å‘½ä»¤æ‰§è¡Œä¸€æ¬¡ã€‚æ¯æ¬¡åœ¨<em class="filename">makefile</em>ä¸­ä½¿ç”¨è¯¥å˜é‡æ—¶ï¼Œè¯¥<code class="literal">CURRENT_TIME</code>å˜é‡éƒ½ä¼šé‡æ–°æ‰§è¡Œ
          <em class="command">date</em>ã€‚<em class="filename"></em></p><p>The <code class="literal">START_TIME</code> variable
          causes the <em class="command">date</em> command to
          execute once when the variable is defined. The <code class="literal">CURRENT_TIME</code> variable will reexecute
          <em class="command">date</em> each time the variable is
          used in the <em class="filename">makefile</em>.</p><p>æˆ‘ä»¬çš„å·¥å…·ç®±çŽ°åœ¨å·²ç»è¶³å¤Ÿç¼–å†™ä¸€äº›ç›¸å½“æœ‰è¶£çš„å‡½æ•°äº†ã€‚è¿™æ˜¯ä¸€ä¸ªç”¨äºŽæµ‹è¯•å€¼æ˜¯å¦åŒ…å«é‡å¤é¡¹çš„å‡½æ•°ï¼š</p><p>Our toolbox is now full enough to write some fairly
          interesting functions. Here is a function for testing whether a
          value contains duplicates:</p><a id="OEBPS/ch04s02.html.I_4_tt200"></a><pre class="programlisting"># $(è°ƒç”¨æœ‰é‡å¤é¡¹ï¼Œå•è¯åˆ—è¡¨)
æœ‰é‡å¤é¡¹ = $(è¿‡æ»¤å™¨ \
                   $(å•è¯$1) \
                   $(å•è¯$(æŽ’åº$1)))</pre><pre class="programlisting"># $(call has-duplicates, word-list)
has-duplicates = $(filter               \
                   $(words $1)          \
                   $(words $(sort $1)))</pre><p>æˆ‘ä»¬è®¡ç®—åˆ—è¡¨å’Œå”¯ä¸€åˆ—è¡¨ä¸­çš„å•è¯ï¼Œç„¶åŽâ€œæ¯”è¾ƒâ€è¿™ä¸¤ä¸ªæ•°å­—ã€‚æ²¡æœ‰ä»»ä½•<em class="command">make</em>å‡½æ•°å¯ä»¥ç†è§£æ•°å­—ï¼Œåªèƒ½ç†è§£å­—ç¬¦ä¸²ã€‚è¦æ¯”è¾ƒä¸¤ä¸ªæ•°å­—ï¼Œæˆ‘ä»¬å¿…é¡»å°†å®ƒä»¬ä½œä¸ºå­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨<code class="function">filter</code>.æˆ‘ä»¬åœ¨å¦ä¸€ä¸ªæ•°å­—ä¸­æœç´¢ä¸€ä¸ªæ•°å­—ã€‚å¦‚æžœå­˜åœ¨é‡å¤é¡¹ï¼Œè¯¥<code class="function">has-duplicates</code>å‡½æ•°å°†ä¸ºéžç©ºã€‚</p><p>We count the words in the list and the unique list, then
          "compare" the two numbers. There are no <em class="command">make</em> functions that understand numbers,
          only strings. To compare two numbers, we must compare them as
          strings. The easiest way to do that is with <code class="function">filter</code>. We search for one number in the
          other number. The <code class="function">has-duplicates</code> function will be non-null
          if there are duplicates.</p><p>è¿™æ˜¯ç”Ÿæˆæ–‡ä»¶åçš„ç®€å•æ–¹æ³•<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1208" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1209" class="indexterm"></a>å¸¦æ—¶é—´æˆ³ï¼š</p><p>Here is a simple way to generate a filename <a class="indexterm"></a> <a class="indexterm"></a>with a timestamp:</p><a id="OEBPS/ch04s02.html.I_4_tt201"></a><pre class="programlisting">RELEASE_TAR := mpwm-$(shell æ—¥æœŸ +%F).tar.gz</pre><pre class="programlisting">RELEASE_TAR := mpwm-$(shell date +%F).tar.gz</pre><p>è¿™ä¼šäº§ç”Ÿï¼š</p><p>This produces:</p><a id="OEBPS/ch04s02.html.I_4_tt202"></a><pre class="programlisting">mpwm-2003-11-11.tar.gz</pre><pre class="programlisting">mpwm-2003-11-11.tar.gz</pre><p>æˆ‘ä»¬å¯ä»¥ç”Ÿæˆç›¸åŒçš„æ–‡ä»¶åå¹¶è®©<em class="command">date</em>å®Œæˆæ›´å¤šå·¥ä½œï¼š</p><p>We could produce the same filename and have <em class="command">date</em> do more of the work with:</p><a id="OEBPS/ch04s02.html.I_4_tt203"></a><pre class="programlisting">RELEASE_TAR := $(shell æ—¥æœŸ +mpwm-%F.tar.gz)</pre><pre class="programlisting">RELEASE_TAR := $(shell date +mpwm-%F.tar.gz)</pre><p>å¯ä»¥ä½¿ç”¨ä¸‹ä¸€ä¸ªå‡½æ•°æ¥è½¬æ¢<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1210" class="indexterm"></a>ç›¸å¯¹è·¯å¾„ï¼ˆå¯èƒ½æ¥è‡ª<em class="filename">com</em>ç›®å½•ï¼‰åˆ°å®Œå…¨é™å®šçš„ Java ç±»åï¼š</p><p>The next function can be used to convert <a class="indexterm"></a>relative paths (possibly from a <em class="filename">com</em> directory) into a fully qualified
          Java class name:</p><a id="OEBPS/ch04s02.html.I_4_tt204"></a><pre class="programlisting"># $(è°ƒç”¨æ–‡ä»¶åˆ°ç±»åï¼Œæ–‡ä»¶å)
æ–‡ä»¶åˆ°ç±»å := $(subst /,.,$(patsubst %.java,%,$1))</pre><pre class="programlisting"># $(call file-to-class-name, file-name)
file-to-class-name := $(subst /,.,$(patsubst %.java,%,$1))</pre><p><code class="function">subst</code>è¿™ç§ç‰¹æ®Šçš„æ¨¡å¼ä¹Ÿå¯ä»¥ç”¨ä¸¤ä¸ªæ¥å®Œæˆï¼š</p><p>This particular pattern can be accomplished with two <code class="function">subst</code>s as well:</p><a id="OEBPS/ch04s02.html.I_4_tt205"></a><pre class="programlisting"># $(è°ƒç”¨æ–‡ä»¶åˆ°ç±»åï¼Œæ–‡ä»¶å)
æ–‡ä»¶åˆ°ç±»å := $(subst /,.,$(subst .java,,$1))</pre><pre class="programlisting"># $(call file-to-class-name, file-name)
file-to-class-name := $(subst /,.,$(subst .java,,$1))</pre><p>ç„¶åŽæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥è°ƒç”¨ Java ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>We can then use this function to invoke the Java class like
          this:</p><a id="OEBPS/ch04s02.html.I_4_tt206"></a><pre class="programlisting">CALIBRATE_ELEVATOR := com/wonka/CalibrateElevator.java
æ ¡å‡†ï¼š
        $(JAVA) $(è°ƒç”¨æ–‡ä»¶åˆ°ç±»å,$(CALIBRATE_ELEVATOR))</pre><pre class="programlisting">CALIBRATE_ELEVATOR := com/wonka/CalibrateElevator.java
calibrate:
        $(JAVA) $(call file-to-class-name,$(CALIBRATE_ELEVATOR))</pre><p><code class="literal">$(sources)</code>å¦‚æžœä¸Šé¢æœ‰æ›´å¤šçš„çˆ¶ç›®å½•ç»„ä»¶<code class="literal">com</code>ï¼Œå¯ä»¥é€šè¿‡å°†ç›®å½•æ ‘çš„æ ¹ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ï¼Œä½¿ç”¨ä»¥ä¸‹å‡½æ•°åˆ é™¤å®ƒä»¬ï¼š<sup>[ <a id="OEBPS/ch04s02.html.make3-CHP-4-FNOTE-3" href="#OEBPS/ch04s02.html.ftn.make3-CHP-4-FNOTE-3" class="footnote">3</a> ]</sup></p><p>If there are more parent directory components in <code class="literal">$(sources)</code> above <code class="literal">com</code>, they can be removed with the
          following function by passing the root of the directory tree as the
          first argument:<sup>[<a href="#OEBPS/ch04s02.html.ftn.make3-CHP-4-FNOTE-3" class="footnote">3</a>]</sup></p><a id="OEBPS/ch04s02.html.I_4_tt207"></a><pre class="programlisting"># $(è°ƒç”¨æ–‡ä»¶åˆ°ç±»åã€æ ¹ç›®å½•ã€æ–‡ä»¶å)
æ–‡ä»¶åˆ°ç±»å := $(subst /,., \
                        $(subst .java,, \
                          $(æ›¿ä»£$1/,,$2)))</pre><pre class="programlisting"># $(call file-to-class-name, root-dir, file-name)
file-to-class-name := $(subst /,.,          \
                        $(subst .java,,     \
                          $(subst $1/,,$2)))</pre><p>å½“é˜…è¯»è¿™æ ·çš„å‡½æ•°æ—¶ï¼Œé€šå¸¸æœ€å®¹æ˜“å°è¯•ä»Žå¤´åˆ°å°¾åœ°ç†è§£å®ƒä»¬ã€‚ä»Žæœ€å†…éƒ¨å¼€å§‹
          <code class="function">subst</code>ï¼Œè¯¥å‡½æ•°åˆ é™¤ string <code class="literal">$1/</code>ï¼Œç„¶åŽåˆ é™¤å­—ç¬¦ä¸²<em class="filename">.java</em>ï¼Œæœ€åŽå°†æ‰€æœ‰æ–œæ è½¬æ¢ä¸ºå¥ç‚¹ã€‚</p><p>When reading functions such as this, it is typically easiest
          to try to understand them inside out. Beginning at the inner-most
          <code class="function">subst</code>, the function removes the
          string <code class="literal">$1/</code>, then removes the
          string <em class="filename">.java</em>, and finally
          converts all slashes to periods.</p></div><div class="sect2" title="æ–‡ä»¶åå‡½æ•°"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch04s02.html.make3-CHP-4-SECT-2.3"></a>æ–‡ä»¶åå‡½æ•°</h2><h2 class="title"><a></a>Filename Functions</h2></div></div></div><p><em class="filename">Makefile</em>ç¼–å†™è€…èŠ±è´¹å¤§é‡æ—¶é—´<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1211" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1212" class="indexterm"></a>å¤„ç†æ–‡ä»¶ã€‚å› æ­¤ï¼Œæœ‰å¾ˆå¤š<em class="command">make</em>å‡½æ•°å¯ä»¥å¸®åŠ©å®Œæˆè¿™é¡¹ä»»åŠ¡ä¹Ÿå°±ä¸è¶³ä¸ºå¥‡äº†ã€‚</p><p><em class="filename">Makefile</em> writers spend a
          lot of time <a class="indexterm"></a> <a class="indexterm"></a>handling files. So it isn't surprising there are a lot
          of <em class="command">make</em> functions to help with
          this task.</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">$(wildcard</code>
              <code class="option">pattern</code> <code class="literal">. . .
              )</code></span></dt><dt><span class="term"><code class="literal">$(wildcard</code>
              <code class="option">pattern</code> <code class="literal">. . .
              )</code></span></dt><dd><p>é€šé…ç¬¦<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1213" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1214" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1215" class="indexterm"></a><a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™">ç¬¬ 2 ç« </a>åœ¨ç›®æ ‡ã€å…ˆå†³æ¡ä»¶å’Œå‘½ä»¤è„šæœ¬çš„ä¸Šä¸‹æ–‡ä¸­ä»‹ç»äº†è¿™äº›å†…å®¹ã€‚ä½†æ˜¯ï¼Œå¦‚æžœæˆ‘ä»¬å¸Œæœ›åœ¨å¦ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼ˆä¾‹å¦‚å˜é‡å®šä¹‰ï¼‰ä½¿ç”¨æ­¤åŠŸèƒ½æ€Žä¹ˆåŠžï¼Ÿæœ‰äº†è¿™ä¸ª<code class="function">shell</code>å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°ä½¿ç”¨å­ shell æ¥æ‰©å±•æ¨¡å¼ï¼Œä½†å¦‚æžœæˆ‘ä»¬éœ€è¦ç»å¸¸è¿™æ ·åšï¼Œé‚£ä¼šéžå¸¸æ…¢ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥<code class="function">wildcard</code>
                å‡½æ•°ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt208"></a><pre class="programlisting">æ¥æº := $(é€šé…ç¬¦ *.c *.h)</pre><p>è¯¥<code class="function">wildcard</code>
                å‡½æ•°æŽ¥å—æ¨¡å¼åˆ—è¡¨å¹¶å¯¹æ¯ä¸ªæ¨¡å¼æ‰§è¡Œæ‰©å±•ã€‚<sup>[ <a id="OEBPS/ch04s02.html.make3-CHP-4-FNOTE-4" href="#OEBPS/ch04s02.html.ftn.make3-CHP-4-FNOTE-4" class="footnote">4</a> ]</sup>å¦‚æžœæ¨¡å¼ä¸Žä»»ä½•æ–‡ä»¶éƒ½ä¸åŒ¹é…ï¼Œåˆ™è¿”å›žç©ºå­—ç¬¦ä¸²ã€‚ä¸Žç›®æ ‡å’Œå…ˆå†³æ¡ä»¶ä¸­çš„é€šé…ç¬¦æ‰©å±•ä¸€æ ·ï¼Œæ”¯æŒæ­£å¸¸çš„ shell é€šé…ç¬¦ï¼š<code class="literal">~</code>ã€<code class="literal">*</code>ã€<code class="literal">?</code>ã€<code class="literal">[...]</code>å’Œ<code class="literal">[^...]</code>ã€‚</p><p>çš„å¦ä¸€ä¸ªç”¨é€”<code class="function">wildcard</code>æ˜¯æµ‹è¯•æ¡ä»¶ä¸­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚å½“ä¸Ž<code class="function">if</code>å‡½æ•°ï¼ˆç¨åŽæè¿°ï¼‰ç»“åˆä½¿ç”¨æ—¶ï¼Œæ‚¨ç»å¸¸ä¼šçœ‹åˆ°<code class="function">wildcard</code>å‚æ•°æ ¹æœ¬ä¸åŒ…å«é€šé…ç¬¦çš„å‡½æ•°è°ƒç”¨ã€‚ä¾‹å¦‚ï¼Œ</p><a id="OEBPS/ch04s02.html.I_4_tt209"></a><pre class="programlisting">ç‚¹-emacs-exists := $(é€šé…ç¬¦ ~/.emacs)</pre><p>å¦‚æžœç”¨æˆ·çš„ä¸»ç›®å½•ä¸åŒ…å«<em class="filename">.emacs</em>æ–‡ä»¶ï¼Œå°†è¿”å›žç©ºå­—ç¬¦ä¸²ã€‚</p></dd><dd><p>Wildcards <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>were covered in <a class="link" href="#OEBPS/ch02.html" title="Chapter&nbsp;2.&nbsp;Rules">Chapter 2</a>, in the context of
                targets, prerequisites, and command scripts. But what if we
                want this functionality in another context, say a variable
                definition? With the <code class="function">shell</code> function, we could simply use
                the subshell to expand the pattern, but that would be terribly
                slow if we needed to do this very often. Instead, we can use
                the <code class="function">wildcard</code>
                function:</p><a></a><pre class="programlisting">sources := $(wildcard *.c *.h)</pre><p>The <code class="function">wildcard</code>
                function accepts a list of patterns and performs expansion on
                each one.<sup>[<a href="#OEBPS/ch04s02.html.ftn.make3-CHP-4-FNOTE-4" class="footnote">4</a>]</sup> If a pattern does not match any files, the empty
                string is returned. As with wildcard expansion in targets and
                prerequisites, the normal shell globbing characters are
                supported: <code class="literal">~</code>, <code class="literal">*</code>, <code class="literal">?</code>, <code class="literal">[...]</code>, and <code class="literal">[^...]</code>.</p><p>Another use of <code class="function">wildcard</code> is to test for the
                existence of a file in conditionals. When used in conjunction
                with the <code class="function">if</code> function
                (described shortly) you often see <code class="function">wildcard</code> function calls whose
                argument contains no wildcard characters at all. For
                instance,</p><a></a><pre class="programlisting">dot-emacs-exists := $(wildcard ~/.emacs)</pre><p>will return the empty string if the user's home
                directory does not contain a <em class="filename">.emacs</em> file.</p></dd><dt><span class="term"><code class="literal">$(dir</code>
              <code class="option">list</code> <code class="literal">. . .
              )</code></span></dt><dt><span class="term"><code class="literal">$(dir</code>
              <code class="option">list</code> <code class="literal">. . .
              )</code></span></dt><dd><p>è¿™<code class="function">dir</code> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1216" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1217" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1218" class="indexterm"></a>å‡½æ•°è¿”å›ž ä¸­æ¯ä¸ªå•è¯çš„ç›®å½•éƒ¨åˆ†<code class="option">list</code>ã€‚ä»¥ä¸‹æ˜¯è¿”å›žåŒ…å« C æ–‡ä»¶çš„æ¯ä¸ªå­ç›®å½•çš„è¡¨è¾¾å¼ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt210"></a><pre class="programlisting">æºç›®å½• := $(æŽ’åº \
                 $(ç›®å½•\
                   $(shell find .-name '*.c')))</pre><p>æŸ¥æ‰¾<em class="command">è¿”å›ž</em>æ‰€æœ‰æºæ–‡ä»¶ï¼Œç„¶åŽè¯¥<code class="function">dir</code>å‡½æ•°å‰¥ç¦»ç¦»å¼€ç›®å½•çš„æ–‡ä»¶éƒ¨åˆ†ï¼Œå¹¶ä¸”æŽ’åºåˆ é™¤é‡å¤çš„ç›®å½•ã€‚è¯·æ³¨æ„ï¼Œæ­¤å˜é‡å®šä¹‰ä½¿ç”¨ä¸€ä¸ªç®€å•å˜é‡ï¼Œä»¥é¿å…æ¯æ¬¡ä½¿ç”¨è¯¥å˜é‡æ—¶é‡æ–°æ‰§è¡ŒæŸ¥æ‰¾<em class="command">ï¼ˆå› ä¸ºæˆ‘ä»¬å‡è®¾æºæ–‡ä»¶åœ¨</em><em class="filename">makefile</em>æ‰§è¡ŒæœŸé—´ä¸ä¼šè‡ªå‘å‡ºçŽ°å’Œæ¶ˆå¤±ï¼‰ã€‚è¿™æ˜¯éœ€è¦é€’å½’å˜é‡çš„å‡½æ•°å®žçŽ°ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt211"></a><pre class="programlisting"># $(è°ƒç”¨æºç›®å½•ï¼Œç›®å½•åˆ—è¡¨)
æºç›®å½• = $(æŽ’åº \
                $(ç›®å½•\
                  $(shell find $1 -name '*.c')))</pre><p>æ­¤ç‰ˆæœ¬æŽ¥å—ä»¥ç©ºæ ¼åˆ†éš”çš„ç›®å½•åˆ—è¡¨ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå‚æ•°è¿›è¡Œæœç´¢ã€‚è¦<em class="command">æŸ¥æ‰¾çš„</em>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦æœç´¢çš„ä¸€ä¸ªæˆ–å¤šä¸ªç›®å½•ã€‚ç›®å½•åˆ—è¡¨çš„æœ«å°¾ç”±ç¬¬ä¸€ä¸ªç ´æŠ˜å·å‚æ•°è¯†åˆ«ã€‚ ï¼ˆæˆ‘å‡ åå¹´æ¥éƒ½ä¸çŸ¥é“çš„<em class="command">æŸ¥æ‰¾åŠŸèƒ½ï¼ï¼‰</em></p></dd><dd><p>The <code class="function">dir</code> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>function returns the directory portion of each
                word in <code class="option">list</code>. Here is an expression to return
                every subdirectory that contains C files:</p><a></a><pre class="programlisting">source-dirs := $(sort                          \
                 $(dir                         \
                   $(shell find . -name '*.c')))</pre><p>The <em class="command">find</em> returns all
                the source files, then the <code class="function">dir</code> function strips off the file
                portion leaving the directory, and the sort removes duplicate
                directories. Notice that this variable definition uses a
                simple variable to avoid reexecuting the <em class="command">find</em> each time the variable is used
                (since we assume source files will not spontaneously appear
                and disappear during the execution of the <em class="filename">makefile</em>). Here's a function
                implementation that requires a recursive variable:</p><a></a><pre class="programlisting"># $(call source-dirs, dir-list)
source-dirs = $(sort                             \
                $(dir                            \
                  $(shell find $1 -name '*.c')))</pre><p>This version accepts a space-separated directory list to
                search as its first parameter. The first arguments to <em class="command">find</em> are one or more directories to
                search. The end of the directory list is recognized by the
                first dash argument. (A <em class="command">find</em> feature I didn't know about for
                several decades!)</p></dd><dt><span class="term"><code class="literal">$(notdir</code>
              <code class="option">name</code> <code class="literal">. . .
              )</code></span></dt><dt><span class="term"><code class="literal">$(notdir</code>
              <code class="option">name</code> <code class="literal">. . .
              )</code></span></dt><dd><p>è¿™<code class="function">notdir</code>
                <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1219" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1220" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1221" class="indexterm"></a>å‡½æ•°è¿”å›žæ–‡ä»¶è·¯å¾„çš„æ–‡ä»¶åéƒ¨åˆ†ã€‚ä»¥ä¸‹æ˜¯ä»Ž Java æºæ–‡ä»¶è¿”å›ž Java ç±»åçš„è¡¨è¾¾å¼ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt212"></a><pre class="programlisting"># $(è°ƒç”¨ get-java-class-name, æ–‡ä»¶å)
get-java-class-name = $(notdir $(subst .java,,$1))</pre><p>åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œ<code class="function">dir</code>å’Œ<code class="function">notdir</code>å¯ä»¥ä¸€èµ·ä½¿ç”¨æ¥äº§ç”Ÿæ‰€éœ€çš„è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œå‡è®¾å¿…é¡»åœ¨ä¸Žå…¶ç”Ÿæˆçš„è¾“å‡ºæ–‡ä»¶ç›¸åŒçš„ç›®å½•ä¸­æ‰§è¡Œè‡ªå®šä¹‰ shell è„šæœ¬ã€‚</p><a id="OEBPS/ch04s02.html.I_4_tt213"></a><pre class="programlisting">$(OUT)/myfile.out: $(SRC)/source1.in $(SRC)/source2.in
        cd $(ç›®å½•$@); \
        ç”Ÿæˆ myfile $^ &gt; $(notdir $@)</pre><p><code class="literal">$@</code>ä»£è¡¨ç›®æ ‡çš„è‡ªåŠ¨å˜é‡å¯ä»¥è¢«åˆ†è§£ä»¥äº§ç”Ÿç›®æ ‡ç›®å½•å’Œæ–‡ä»¶ä½œä¸ºå•ç‹¬çš„å€¼ã€‚äº‹å®žä¸Šï¼Œå¦‚æžœ<code class="literal">OUT</code>æ˜¯ç»å¯¹è·¯å¾„ï¼Œè¿™é‡Œå°±æ²¡æœ‰å¿…è¦ä½¿ç”¨è¯¥<code class="function">notdir</code>å‡½æ•°ï¼Œä½†è¿™æ ·åšä¼šä½¿è¾“å‡ºæ›´å…·å¯è¯»æ€§ã€‚</p><p>åœ¨å‘½ä»¤è„šæœ¬ä¸­ï¼Œåˆ†è§£æ–‡ä»¶åçš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨<code class="literal">$(@D)</code>
                å’Œ ï¼Œå¦‚<a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™">ç¬¬ 2 ç« </a><a class="link" href="#OEBPS/ch02s02.html.make3-CHP-2-SECT-2.1" title="è‡ªåŠ¨å˜é‡">2.2.1 èŠ‚</a>ä¸­
                <code class="literal">$(@F)</code>æ‰€è¿°
                ã€‚<a class="link" href="#OEBPS/ch02s02.html.make3-CHP-2-SECT-2.1" title="è‡ªåŠ¨å˜é‡"></a><a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™"></a></p></dd><dd><p>The <code class="function">notdir</code>
                <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> function returns the filename portion of a file
                path. Here is an expression to return the Java class name from
                a Java source file:</p><a></a><pre class="programlisting"># $(call get-java-class-name, file-name)
get-java-class-name = $(notdir $(subst .java,,$1))</pre><p>There are many instances where <code class="function">dir</code> and <code class="function">notdir</code> can be used together to
                produce the desired output. For instance, suppose a custom
                shell script must be executed in the same directory as the
                output file it generates.</p><a></a><pre class="programlisting">$(OUT)/myfile.out: $(SRC)/source1.in $(SRC)/source2.in
        cd $(dir $@); \
        generate-myfile $^ &gt; $(notdir $@)</pre><p>The automatic variable, <code class="literal">$@</code>, representing the target, can be
                decomposed to yield the target directory and file as separate
                values. In fact, if <code class="literal">OUT</code> is
                an absolute path, it isn't necessary to use the <code class="function">notdir</code> function here, but doing so
                will make the output more readable.</p><p>In command scripts, another way to decompose a filename
                is through the use of <code class="literal">$(@D)</code>
                and <code class="literal">$(@F)</code> as mentioned in
                <a class="link" href="#OEBPS/ch02s02.html.make3-CHP-2-SECT-2.1" title="Automatic Variables">Section 2.2.1</a> in
                <a class="link" href="#OEBPS/ch02.html" title="Chapter&nbsp;2.&nbsp;Rules">Chapter 2</a>.</p></dd></dl></div><p>è¿™é‡Œæœ‰æ·»åŠ å’Œåˆ é™¤æ–‡ä»¶åŽç¼€ç­‰åŠŸèƒ½ã€‚</p><p>Here are functions for adding and removing file suffixes,
          etc.</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">$(suffix</code>
              <code class="option">name</code> <code class="literal">. . .
              )</code></span></dt><dt><span class="term"><code class="literal">$(suffix</code>
              <code class="option">name</code> <code class="literal">. . .
              )</code></span></dt><dd><p>è¿™<code class="function">suffix</code>
                <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1222" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1223" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1224" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1225" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1226" class="indexterm"></a>å‡½æ•°è¿”å›žå…¶å‚æ•°ä¸­æ¯ä¸ªå•è¯çš„åŽç¼€ã€‚è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•åˆ—è¡¨ä¸­çš„æ‰€æœ‰å•è¯æ˜¯å¦å…·æœ‰ç›¸åŒåŽç¼€çš„å‡½æ•°ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt214"></a><pre class="programlisting"># $(è°ƒç”¨ç›¸åŒåŽç¼€ï¼Œæ–‡ä»¶åˆ—è¡¨)
ç›¸åŒåŽç¼€ = $(è¿‡æ»¤å™¨ 1, $(å•è¯ $(æŽ’åº $(åŽç¼€ $1))))</pre><p>è¯¥å‡½æ•°æ›´å¸¸è§çš„ç”¨æ³•<code class="function">suffix</code>æ˜¯åœ¨æ¡ä»¶è¯­å¥ä¸­ä¸Ž ç»“åˆä½¿ç”¨<code class="function">findstring</code>ã€‚</p></dd><dd><p>The <code class="function">suffix</code>
                <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> function returns the suffix of each word in its
                argument. Here is a function to test whether all the words in
                a list have the same suffix:</p><a></a><pre class="programlisting"># $(call same-suffix, file-list)
same-suffix = $(filter 1, $(words $(sort $(suffix $1))))</pre><p>A more common use of the <code class="function">suffix</code> function is within
                conditionals in conjunction with <code class="function">findstring</code>.</p></dd><dt><span class="term"><code class="literal">$(basename</code>
              <code class="option">name</code> <code class="literal">. . .
              )</code></span></dt><dt><span class="term"><code class="literal">$(basename</code>
              <code class="option">name</code> <code class="literal">. . .
              )</code></span></dt><dd><p>åŠŸèƒ½<code class="function">basename</code>
                â€‹<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1227" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1228" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1229" class="indexterm"></a>æ˜¯ çš„è¡¥é›†<code class="function">suffix</code>ã€‚å®ƒè¿”å›žä¸å¸¦åŽç¼€çš„æ–‡ä»¶åã€‚è°ƒç”¨åŽä»»ä½•å¼•å¯¼è·¯å¾„ç»„ä»¶éƒ½ä¿æŒä¸å˜<code class="function">basename</code>ã€‚ä»¥ä¸‹æ˜¯ç”¨ é‡å†™çš„æ—©æœŸå‡½æ•°<code class="function">file-to-class-name</code>å’Œå‡½æ•°ï¼š<code class="function">get-java-class-name</code><code class="function">basename</code></p><a id="OEBPS/ch04s02.html.I_4_tt215"></a><pre class="programlisting"># $(è°ƒç”¨æ–‡ä»¶åˆ°ç±»åã€æ ¹ç›®å½•ã€æ–‡ä»¶å)
æ–‡ä»¶åˆ°ç±»å := $(subst /,., \
                         $(åŸºæœ¬åç§°\
                           $(æ›¿ä»£$1/,,$2)))
# $(è°ƒç”¨ get-java-class-name, æ–‡ä»¶å)
get-java-class-name = $(notdir $(basename $1))</pre></dd><dd><p>The <code class="function">basename</code>
                function <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>is the complement of <code class="function">suffix</code>. It returns the filename
                without its suffix. Any leading path components remain intact
                after the <code class="function">basename</code> call.
                Here are the earlier <code class="function">file-to-class-name</code> and <code class="function">get-java-class-name</code> functions
                re-written with <code class="function">basename</code>:</p><a></a><pre class="programlisting"># $(call file-to-class-name, root-directory, file-name)
file-to-class-name  := $(subst /,.,          \
                         $(basename          \
                           $(subst $1/,,$2)))
# $(call get-java-class-name, file-name)
get-java-class-name =  $(notdir $(basename $1))</pre></dd><dt><span class="term"><code class="literal">$(addsuffix</code>
              <code class="option">suffix</code>,<code class="option">name</code> <code class="literal">. . . )</code></span></dt><dt><span class="term"><code class="literal">$(addsuffix</code>
              <code class="option">suffix</code>,<code class="option">name</code> <code class="literal">. . . )</code></span></dt><dd><p>åŠŸèƒ½<code class="function">addsuffix</code>
                â€‹<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1230" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1231" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1232" class="indexterm"></a>å°†ç»™å®š<code class="option">suffix</code>æ–‡æœ¬é™„åŠ åˆ° ä¸­çš„æ¯ä¸ªå•è¯<code class="option">name</code>ã€‚æ–‡æœ¬
                <code class="option">suffix</code>å¯ä»¥æ˜¯ä»»ä½•å†…å®¹ã€‚è¿™æ˜¯ä¸€ä¸ªæŸ¥æ‰¾ ä¸­<code class="literal">PATH</code>ä¸Žè¡¨è¾¾å¼åŒ¹é…çš„æ‰€æœ‰æ–‡ä»¶çš„å‡½æ•°ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt216"></a><pre class="programlisting"># $(è°ƒç”¨æŸ¥æ‰¾ç¨‹åºï¼Œè¿‡æ»¤å™¨æ¨¡å¼)
æŸ¥æ‰¾ç¨‹åº = $(è¿‡æ»¤ $1, \
                 $(é€šé…ç¬¦\
                   $(æ·»åŠ åŽç¼€ /*, \
                     $(æŽ’åº\
                       $(æ›¿æ¢:,,\
                         $(subst::,:.:, \
                           $(patsubst :%,.:%, \
                             $(patsubst %:,%:.,$(è·¯å¾„)))))))))
å¯»æ‰¾ï¼š
        @echo $(words $(è°ƒç”¨ find-program, %))</pre><p>æœ€é‡Œé¢çš„ä¸‰ä¸ªæ›¿æ¢è¯´æ˜Žäº† shell è¯­æ³•ä¸­çš„ç‰¹æ®Šæƒ…å†µã€‚ç©ºè·¯å¾„éƒ¨åˆ†è¡¨ç¤ºå½“å‰ç›®å½•ã€‚ä¸ºäº†è§„èŒƒåŒ–è¿™ç§ç‰¹æ®Šè¯­æ³•ï¼Œæˆ‘ä»¬æŒ‰é¡ºåºæœç´¢ç©ºå°¾éšè·¯å¾„ç»„ä»¶ã€ç©ºå‰å¯¼è·¯å¾„ç»„ä»¶å’Œç©ºå†…éƒ¨è·¯å¾„ç»„ä»¶ã€‚ä»»ä½•åŒ¹é…çš„ç»„ä»¶éƒ½æ›¿æ¢ä¸ºâ€œ.â€ã€‚æŽ¥ä¸‹æ¥ï¼Œå°†è·¯å¾„åˆ†éš”ç¬¦æ›¿æ¢ä¸ºç©ºæ ¼ä»¥åˆ›å»ºå•ç‹¬çš„å•è¯ã€‚è¯¥<code class="function">sort</code>å‡½æ•°ç”¨äºŽåŽ»é™¤é‡å¤çš„è·¯å¾„æˆåˆ†ã€‚ç„¶åŽå°†é€šé…åŽç¼€<em class="filename">/*</em>é™„åŠ åˆ°æ¯ä¸ªå•è¯å¹¶<code class="function">wildcard</code>è°ƒç”¨ä»¥æ‰©å±•é€šé…è¡¨è¾¾å¼ã€‚æœ€åŽï¼Œé€šè¿‡ æå–æ‰€éœ€çš„æ¨¡å¼<code class="function">filter</code>ã€‚</p><p>è™½ç„¶è¿™çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªè¿è¡Œèµ·æ¥éžå¸¸æ…¢çš„å‡½æ•°ï¼ˆè€Œä¸”å¾ˆå¯èƒ½åœ¨è®¸å¤šç³»ç»Ÿä¸Šï¼‰ï¼Œä½†åœ¨æˆ‘çš„ 1.9 GHz P4ï¼ˆå…·æœ‰ 512 MBï¼‰ä¸Šï¼Œè¯¥å‡½æ•°åœ¨ 0.20 ç§’å†…æ‰§è¡Œå¹¶æ‰¾åˆ° 4,335 ä¸ªç¨‹åºã€‚é€šè¿‡å°†<code class="literal">$1</code>è°ƒç”¨ä¸­çš„å‚æ•°ç§»è‡³ ï¼Œå¯ä»¥æé«˜æ­¤æ€§èƒ½
                <code class="function">wildcard</code>ã€‚ä»¥ä¸‹ç‰ˆæœ¬æ¶ˆé™¤äº†å¯¹è°ƒç”¨è€…å‚æ•°çš„è°ƒç”¨<code class="function">filter</code>å¹¶æ›´æ”¹<code class="function">addsuffix</code>ä¸ºä½¿ç”¨è°ƒç”¨è€…çš„å‚æ•°ã€‚</p><a id="OEBPS/ch04s02.html.I_4_tt217"></a><pre class="programlisting"># $(è°ƒç”¨æŸ¥æ‰¾ç¨‹åº,é€šé…ç¬¦æ¨¡å¼)
æŸ¥æ‰¾ç¨‹åº = $(é€šé…ç¬¦ \
                 $(æ·»åŠ åŽç¼€/$1,\
                   $(æŽ’åº\
                     $(æ›¿æ¢:,,\
                       $(subst::,:.:, \
                         $(patsubst :%,.:%, \
                           $(patsubst %:,%:.,$(è·¯å¾„))))))))
å¯»æ‰¾ï¼š
        @echo $(words $(è°ƒç”¨ find-program,*))</pre><p>è¯¥ç‰ˆæœ¬è¿è¡Œæ—¶é—´ä¸º 0.17 ç§’ã€‚å®ƒè¿è¡Œå¾—æ›´å¿«ï¼Œå› ä¸º<code class="function">wildcard</code>ä¸å†è¿”å›žæ¯ä¸ªæ–‡ä»¶åªæ˜¯ä¸ºäº†è®©å‡½æ•°ç¨åŽä½¿ç”¨<code class="function">filter</code>. <acronym class="acronym">GNU </acronym> <em class="command">make</em>æ‰‹å†Œä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„ä¾‹å­ã€‚å¦è¯·æ³¨æ„ï¼Œç¬¬ä¸€ä¸ªç‰ˆæœ¬ä½¿ç”¨<code class="function">filter</code>-style é€šé…æ¨¡å¼ï¼ˆ<code class="literal">%</code>ä»…ä½¿ç”¨ï¼‰ï¼Œè€Œç¬¬äºŒä¸ªç‰ˆæœ¬ä½¿ç”¨<code class="function">wildcard</code>-style é€šé…æ¨¡å¼ï¼ˆ<code class="literal">~</code>ã€<code class="literal">*</code>ã€<code class="literal">?</code>ã€<code class="literal">[...]</code>å’Œ<code class="literal">[^...]</code>ï¼‰ã€‚</p></dd><dd><p>The <code class="function">addsuffix</code>
                function <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>appends the given <code class="option">suffix</code> text
                to each word in <code class="option">name</code>. The
                <code class="option">suffix</code> text can be anything. Here is a
                function to find all the files in the <code class="literal">PATH</code> that match an
                expression:</p><a></a><pre class="programlisting"># $(call find-program, filter-pattern)
find-program = $(filter $1,                     \
                 $(wildcard                     \
                   $(addsuffix /*,              \
                     $(sort                     \
                       $(subst :, ,             \
                         $(subst ::,:.:,        \
                           $(patsubst :%,.:%,   \
                             $(patsubst %:,%:.,$(PATH)))))))))
find:
        @echo $(words $(call find-program, %))</pre><p>The inner-most three substitutions account for a special
                case in shell syntax. An empty path component is taken to mean
                the current directory. To normalize this special syntax we
                search for an empty trailing path component, an empty leading
                path component, and an empty interior path component, in that
                order. Any matching components are replaced with ".". Next,
                the path separator is replaced with a space to create separate
                words. The <code class="function">sort</code> function
                is used to remove repeated path components. Then the globbing
                suffix <em class="filename">/*</em> is appended to
                each word and <code class="function">wildcard</code> is
                invoked to expand the globbing expressions. Finally, the
                desired patterns are extracted by <code class="function">filter</code>.</p><p>Although this may seem like an extremely slow function
                to run (and it may well be on many systems), on my 1.9 GHz P4
                with 512 MB this function executes in 0.20 seconds and finds
                4,335 programs. This performance can be improved by moving the
                <code class="literal">$1</code> argument inside the call
                to <code class="function">wildcard</code>. The
                following version eliminates the call to <code class="function">filter</code> and changes <code class="function">addsuffix</code> to use the caller's
                argument.</p><a></a><pre class="programlisting"># $(call find-program,wildcard-pattern)
find-program = $(wildcard                       \
                 $(addsuffix /$1,               \
                   $(sort                       \
                     $(subst :, ,               \
                       $(subst ::,:.:,          \
                         $(patsubst :%,.:%,     \
                           $(patsubst %:,%:.,$(PATH))))))))
find:
        @echo $(words $(call find-program,*))</pre><p>This version runs in 0.17 seconds. It runs faster
                because <code class="function">wildcard</code> no
                longer returns every file only to make the function discard
                them later with <code class="function">filter</code>. A
                similar example occurs in the <acronym class="acronym">GNU</acronym> <em class="command">make</em> manual. Notice also that the
                first version uses <code class="function">filter</code>-style globbing patterns
                (using <code class="literal">%</code> only) while the
                second version uses <code class="function">wildcard</code>-style globbing patterns
                (<code class="literal">~</code>, <code class="literal">*</code>, <code class="literal">?</code>, <code class="literal">[...]</code>, and <code class="literal">[^...]</code>).</p></dd><dt><span class="term"><code class="literal">$(addprefix</code>
              <code class="option">prefix</code>,<code class="option">name</code> <code class="literal">. . . )</code></span></dt><dt><span class="term"><code class="literal">$(addprefix</code>
              <code class="option">prefix</code>,<code class="option">name</code> <code class="literal">. . . )</code></span></dt><dd><p>è¿™<code class="function">addprefix</code>
                <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1233" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1234" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1235" class="indexterm"></a>å‡½æ•°æ˜¯ çš„è¡¥é›†<code class="function">addsuffix</code>ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæµ‹è¯•ä¸€ç»„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”éžç©ºçš„è¡¨è¾¾å¼ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt218"></a><pre class="programlisting"># $(è°ƒç”¨æœ‰æ•ˆæ–‡ä»¶ï¼Œæ–‡ä»¶åˆ—è¡¨)
æœ‰æ•ˆæ–‡ä»¶=æµ‹è¯•-sã€‚ $(addprefix -a -s ,$1)</pre><p>æ­¤å‡½æ•°ä¸Žå‰é¢çš„å¤§å¤šæ•°ç¤ºä¾‹ä¸åŒï¼Œå› ä¸ºå®ƒæ—¨åœ¨åœ¨å‘½ä»¤è„šæœ¬ä¸­æ‰§è¡Œã€‚å®ƒä½¿ç”¨ shell çš„<em class="command">æµ‹è¯•</em>ç¨‹åºå’Œ
                <code class="option">-s</code>é€‰é¡¹ï¼ˆâ€œå¦‚æžœæ–‡ä»¶å­˜åœ¨ä¸”ä¸ä¸ºç©ºåˆ™ä¸º trueâ€ï¼‰æ¥æ‰§è¡Œæµ‹è¯•ã€‚ç”±äºŽ<em class="command">æµ‹è¯•</em>å‘½ä»¤éœ€è¦å¤šä¸ªæ–‡ä»¶åä¹‹é—´æœ‰ä¸€ä¸ª
                <code class="option">-a</code>ï¼ˆå’Œï¼‰é€‰é¡¹ï¼Œ
                å› æ­¤åœ¨æ¯ä¸ªæ–‡ä»¶åä¹‹å‰<code class="function">addprefix</code>æ·»åŠ 
                <code class="option">-a</code>ã€‚ç”¨äºŽå¯åŠ¨â€œä¸Žâ€é“¾çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶æ˜¯ç‚¹ï¼Œå®ƒæ€»æ˜¯äº§ç”Ÿ trueã€‚</p></dd><dd><p>The <code class="function">addprefix</code>
                <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> function is the complement of <code class="function">addsuffix</code>. Here is an expression to
                test whether a set of files exists and is nonempty:</p><a></a><pre class="programlisting"># $(call valid-files, file-list)
valid-files = test -s . $(addprefix -a -s ,$1)</pre><p>This function is different from most of the previous
                examples in that it is intended to be executed in a command
                script. It uses the shell's <em class="command">test</em> program with the
                <code class="option">-s</code> option ("true if the file exists and is
                not empty") to perform the test. Since the <em class="command">test</em> command requires a
                <code class="option">-a</code> (and) option between multiple filenames,
                <code class="function">addprefix</code> prepends the
                <code class="option">-a</code> before each filename. The first file used
                to start the "and" chain is dot, which always yields
                true.</p></dd><dt><span class="term"><code class="literal">$(join</code>
              <code class="option">prefix-list</code>,<code class="option">suffix-list</code>
              <code class="literal">)</code></span></dt><dt><span class="term"><code class="literal">$(join</code>
              <code class="option">prefix-list</code>,<code class="option">suffix-list</code>
              <code class="literal">)</code></span></dt><dd><p>è¿™<code class="function">join</code> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1236" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1237" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1238" class="indexterm"></a><code class="function">dir</code>å‡½æ•°æ˜¯å’Œçš„è¡¥é›†<code class="function">notdir</code>ã€‚å®ƒæŽ¥å—ä¸¤ä¸ªåˆ—è¡¨ï¼Œå¹¶å°†ç¬¬ä¸€ä¸ªå…ƒç´  from
                <code class="option">prefix-list</code>ä¸Žç¬¬ä¸€ä¸ªå…ƒç´  from
                è¿žæŽ¥èµ·æ¥<code class="option">suffix-list</code>ï¼Œç„¶åŽå°†ç¬¬äºŒä¸ªå…ƒç´  from
                <code class="option">prefix-list</code>ä¸Žç¬¬äºŒä¸ªå…ƒç´ 
                è¿žæŽ¥<code class="option">suffix-list</code>èµ·æ¥ï¼Œä¾æ­¤ç±»æŽ¨ã€‚å®ƒå¯ç”¨äºŽé‡å»ºç”¨<code class="function">dir</code>å’Œåˆ†è§£çš„åˆ—è¡¨<code class="function">notdir</code>ã€‚</p></dd><dd><p>The <code class="function">join</code> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>function is the complement of <code class="function">dir</code> and <code class="function">notdir</code>. It accepts two lists and
                concatenates the first element from
                <code class="option">prefix-list</code> with the first element from
                <code class="option">suffix-list</code>, then the second element from
                <code class="option">prefix-list</code> with the second element from
                <code class="option">suffix-list</code> and so on. It can be used to
                reconstruct lists decomposed with <code class="function">dir</code> and <code class="function">notdir</code>.</p></dd></dl></div></div><div class="sect2" title="æµé‡æŽ§åˆ¶"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch04s02.html.make3-CHP-4-SECT-2.4"></a>æµé‡æŽ§åˆ¶</h2><h2 class="title"><a></a>Flow Control</h2></div></div></div><p>å› ä¸ºè®¸å¤š<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1239" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1240" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1241" class="indexterm"></a>åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬çœ‹åˆ°çš„å‡½æ•°éƒ½æ˜¯ä¸ºäº†åœ¨åˆ—è¡¨ä¸Šæ‰§è¡Œæ“ä½œè€Œå®žçŽ°çš„ï¼Œå³ä½¿æ²¡æœ‰å¾ªçŽ¯ç»“æž„ï¼Œå®ƒä»¬ä¹Ÿèƒ½å¾ˆå¥½åœ°å·¥ä½œã€‚ä½†å¦‚æžœæ²¡æœ‰çœŸæ­£çš„å¾ªçŽ¯è¿ç®—ç¬¦å’ŒæŸç§æ¡ä»¶å¤„ç†ï¼Œ<em class="command">make</em>å®è¯­è¨€ç¡®å®žä¼šéžå¸¸æœ‰é™ã€‚å¹¸è¿çš„æ˜¯ï¼Œ<em class="command">make</em>
          æä¾›äº†è¿™ä¸¤ç§è¯­è¨€åŠŸèƒ½ã€‚æˆ‘è¿˜åœ¨æœ¬èŠ‚ä¸­åŠ å…¥äº†è‡´å‘½<code class="function">error</code>
          å‡½æ•°ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸€ç§éžå¸¸æžç«¯çš„æµé‡æŽ§åˆ¶å½¢å¼ï¼</p><p>Because many of the <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>functions we have seen so far are implemented to
          perform their operations on lists, they work well even without a
          looping construct. But without a true looping operator and
          conditional processing of some kind the <em class="command">make</em> macro language would be very limited,
          indeed. Fortunately, <em class="command">make</em>
          provides both of these language features. I have also thrown into
          this section the fatal <code class="function">error</code>
          function, clearly a very extreme form of flow control!</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">$(if</code>
              <code class="option">condition</code>, <code class="option">then-part</code>,<code class="option">else-part</code>
              <code class="literal">)</code></span></dt><dt><span class="term"><code class="literal">$(if</code>
              <code class="option">condition</code>,<code class="option">then-part</code>,<code class="option">else-part</code>
              <code class="literal">)</code></span></dt><dd><p>è¿™<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1242" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1243" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1244" class="indexterm"></a> <code class="function">if</code>
                å‡½æ•°ï¼ˆä¸è¦ä¸Ž
                <a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®">ç¬¬ 3 ç« </a>ä¸­è®¨è®ºçš„æ¡ä»¶æŒ‡ä»¤<code class="literal">ifeq</code>ã€<code class="literal">ifneq</code>ã€<code class="literal">ifdef</code>å’Œæ··æ·†ï¼‰æ ¹æ®æ¡ä»¶è¡¨è¾¾å¼çš„â€œå€¼â€é€‰æ‹©ä¸¤ä¸ªå®æ‰©å±•ä¹‹ä¸€ã€‚å¦‚æžœå…¶æ‰©å±•åŒ…å«ä»»ä½•å­—ç¬¦ï¼ˆç”šè‡³ç©ºæ ¼ï¼‰ï¼Œåˆ™ä¸º true ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¢«æ‰©å±•ã€‚å¦åˆ™ï¼Œå¦‚æžœ çš„æ‰©å±•ä¸ºç©ºï¼Œåˆ™ä¸º falseï¼Œå¹¶ä¸”è¢«æ‰©å±•ã€‚<sup>[ </sup><sup><a id="OEBPS/ch04s02.html.make3-CHP-4-FNOTE-5" href="#OEBPS/ch04s02.html.ftn.make3-CHP-4-FNOTE-5" class="footnote">5</a></sup><sup> ]</sup><code class="literal">ifndef</code><a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®"></a><code class="option">condition</code><code class="option">then-part</code><code class="option">condition</code><code class="option">else-part</code><sup><a id="OEBPS/ch04s02.html.make3-CHP-4-FNOTE-5" href="#OEBPS/ch04s02.html.ftn.make3-CHP-4-FNOTE-5" class="footnote"></a></sup></p><p>è¿™æ˜¯æµ‹è¯• makefile æ˜¯å¦<em class="filename">åœ¨</em>Windows ä¸Šè¿è¡Œçš„ç®€å•æ–¹æ³•ã€‚æŸ¥æ‰¾<code class="literal">COMSPEC</code>
                ä»…åœ¨ Windows ä¸Šå®šä¹‰çš„çŽ¯å¢ƒå˜é‡ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt219"></a><pre class="programlisting">PATH_SEP := $(å¦‚æžœ $(COMSPEC),;,:)</pre><p><em class="command">make</em><code class="option">condition</code>é€šè¿‡é¦–å…ˆåˆ é™¤å‰å¯¼å’Œå°¾éšç©ºæ ¼ï¼Œç„¶åŽæ‰©å±•è¡¨è¾¾å¼æ¥è®¡ç®—
                ã€‚å¦‚æžœæ‰©å±•äº§ç”Ÿä»»ä½•å­—ç¬¦ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰ï¼Œåˆ™è¡¨è¾¾å¼ä¸º trueã€‚çŽ°åœ¨<code class="literal">PATH_SEP</code>åŒ…å«åœ¨è·¯å¾„ä¸­ä½¿ç”¨çš„æ­£ç¡®å­—ç¬¦ï¼Œæ— è®º<em class="filename">makefile</em>æ˜¯åœ¨ Windows è¿˜æ˜¯ Unix ä¸Šè¿è¡Œã€‚</p><p>åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬æåˆ°å¦‚æžœæ‚¨ä½¿ç”¨ä¸€äº›æœ€æ–°åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼‰ï¼Œè¯·æ£€æŸ¥<em class="command">make</em>çš„ç‰ˆæœ¬ã€‚å’Œ<code class="function">eval</code>å‡½æ•°ç»å¸¸ä¸€èµ·ä½¿ç”¨æ¥æµ‹è¯•å­—ç¬¦ä¸²çš„å€¼ï¼š<code class="function">if</code><code class="function">filter</code></p><a id="OEBPS/ch04s02.html.I_4_tt220"></a><pre class="programlisting">$(å¦‚æžœ$(è¿‡æ»¤å™¨$(MAKE_VERSION),3.80),,\
  $(é”™è¯¯æ­¤ makefile éœ€è¦ GNU make ç‰ˆæœ¬ 3.80ã€‚))</pre><p>çŽ°åœ¨ï¼Œéšç€<em class="command">make</em>çš„åŽç»­ç‰ˆæœ¬å‘å¸ƒï¼Œè¯¥è¡¨è¾¾å¼å¯ä»¥ç”¨æ›´å¯æŽ¥å—çš„ç‰ˆæœ¬è¿›è¡Œæ‰©å±•ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt221"></a><pre class="programlisting">$(å¦‚æžœ$(è¿‡æ»¤å™¨$(MAKE_VERSION),3.80 3.81 3.90 3.92),,\
  $(é”™è¯¯æ­¤ makefile éœ€è¦ GNU make ç‰ˆæœ¬ä¹‹ä¸€....))</pre><p>è¿™ç§æŠ€æœ¯çš„ç¼ºç‚¹æ˜¯å½“å®‰è£…æ–°ç‰ˆæœ¬çš„<em class="command">make</em>æ—¶å¿…é¡»æ›´æ–°ä»£ç ã€‚ä½†è¿™ç§æƒ…å†µå¹¶ä¸ç»å¸¸å‘ç”Ÿã€‚ ï¼ˆä¾‹å¦‚ï¼Œè‡ª 2002 å¹´ 10 æœˆä»¥æ¥ï¼Œ3.80 ä¸€ç›´æ˜¯å‘å¸ƒç‰ˆæœ¬ã€‚ï¼‰ä¸Šè¿°æµ‹è¯•å¯ä»¥
                ä½œä¸ºé¡¶çº§è¡¨è¾¾å¼æ·»åŠ åˆ°<em class="filename">makefile</em><code class="function">if</code>ä¸­ï¼Œå› ä¸º
                å¦‚æžœä¸º trueï¼Œåˆ™å´©æºƒä¸ºç©ºï¼Œå¦åˆ™<code class="function">error</code>ç»ˆæ­¢<em class="command">make</em>ã€‚</p></dd><dd><p>The<a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <code class="function">if</code>
                function (not to be confused with the conditional directives
                <code class="literal">ifeq</code>, <code class="literal">ifneq</code>, <code class="literal">ifdef</code>, and <code class="literal">ifndef</code> discussed in <a class="link" href="#OEBPS/ch03.html" title="Chapter&nbsp;3.&nbsp;Variables and Macros">Chapter 3</a>) selects one of two
                macro expansions depending on the "value" of the conditional
                expression. The <code class="option">condition</code> is true if its
                expansion contains any characters (even space). In this case,
                the <code class="option">then-part</code> is expanded. Otherwise, if the
                expansion of <code class="option">condition</code> is empty, it is false
                and the <code class="option">else-part</code> is expanded.<sup>[<a href="#OEBPS/ch04s02.html.ftn.make3-CHP-4-FNOTE-5" class="footnote">5</a>]</sup></p><p>Here is an easy way to test whether the <em class="filename">makefile</em> is running on Windows.
                Look for the <code class="literal">COMSPEC</code>
                environment variable defined only on Windows:</p><a></a><pre class="programlisting">PATH_SEP := $(if $(COMSPEC),;,:)</pre><p><em class="command">make</em> evaluates the
                <code class="option">condition</code> by first removing leading and
                trailing whitespace, then expanding the expression. If the
                expansion yields any characters (including whitespace), the
                expression is true. Now <code class="literal">PATH_SEP</code> contains the proper
                character to use in paths, whether the <em class="filename">makefile</em> is running on Windows or
                Unix.</p><p>In the last chapter, we mentioned checking the version
                of <em class="command">make</em> if you use some of
                the newest features (like <code class="function">eval</code>). The <code class="function">if</code> and <code class="function">filter</code> functions are often used
                together to test the value of a string:</p><a></a><pre class="programlisting">$(if $(filter $(MAKE_VERSION),3.80),,\
  $(error This makefile requires GNU make version 3.80.))</pre><p>Now, as subsequent versions of <em class="command">make</em> are released, the expression
                can be extended with more acceptable versions:</p><a></a><pre class="programlisting">$(if $(filter $(MAKE_VERSION),3.80 3.81 3.90 3.92),,\
  $(error This makefile requires one of GNU make version ....))</pre><p>This technique has the disadvantage that the code must
                be updated when a new version of <em class="command">make</em> is installed. But that doesn't
                happen very often. (For instance, 3.80 has been the release
                version since October 2002.) The above test can be added to a
                <em class="filename">makefile</em> as a top-level
                expression since the <code class="function">if</code>
                collapses to nothing if true and <code class="function">error</code> terminates the <em class="command">make</em> otherwise.</p></dd><dt><span class="term"><code class="literal">$(error</code>
              <code class="option">text</code>ï¼‰</span></dt><dt><span class="term"><code class="literal">$(error</code>
              <code class="option">text</code>)</span></dt><dd><p>åŠŸèƒ½<code class="function">error</code>â€‹
                <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1245" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1246" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1247" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1248" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1249" class="indexterm"></a>ç”¨äºŽæ‰“å°è‡´å‘½é”™è¯¯æ¶ˆæ¯ã€‚å‡½æ•°æ‰“å°å…¶æ¶ˆæ¯åŽï¼Œ<em class="command">make</em>ä»¥é€€å‡ºçŠ¶æ€ 2 ç»ˆæ­¢ã€‚è¾“å‡ºä»¥å½“å‰
                <em class="filename">makefile</em>çš„åç§°ã€å½“å‰è¡Œå·å’Œæ¶ˆæ¯æ–‡æœ¬ä¸ºå‰ç¼€ã€‚ä»¥ä¸‹æ˜¯<em class="command">make</em><code class="function">assert</code>
                çš„å¸¸è§ç¼–ç¨‹ç»“æž„çš„å®žçŽ°ï¼š<em class="command"></em></p><a id="OEBPS/ch04s02.html.I_4_tt222"></a><pre class="programlisting"># $(è°ƒç”¨æ–­è¨€,æ¡ä»¶,æ¶ˆæ¯)
å®šä¹‰æ–­è¨€
  $(å¦‚æžœ $1,,$(é”™è¯¯æ–­è¨€å¤±è´¥: $2))
æ©å¾·å¤«
# $(è°ƒç”¨æ–­è¨€æ–‡ä»¶å­˜åœ¨ï¼Œé€šé…ç¬¦æ¨¡å¼)
å®šä¹‰æ–­è¨€æ–‡ä»¶å­˜åœ¨
  $(è°ƒç”¨æ–­è¨€,$(é€šé…ç¬¦$1),$1ä¸å­˜åœ¨)
æ©å¾·å¤«
# $(è°ƒç”¨æ–­è¨€éžç©ºï¼Œmake-variable)
å®šä¹‰æ–­è¨€éžç©º
  $(è°ƒç”¨æ–­è¨€,$($1),å˜é‡â€œ$1â€ä¸ºç©º)
æ©å¾·å¤«
é”™è¯¯é€€å‡ºï¼š
        $(è°ƒç”¨æ–­è¨€-not-null,NON_EXISTENT)</pre><p>ç¬¬ä¸€ä¸ªå‡½æ•° ,<code class="function">assert</code>åªæ˜¯<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1250" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1251" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1252" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1253" class="indexterm"></a>æµ‹è¯•å…¶ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¦‚æžœä¸ºç©ºåˆ™æ‰“å°ç”¨æˆ·çš„é”™è¯¯æ¶ˆæ¯ã€‚ç¬¬äºŒä¸ªå‡½æ•°å»ºç«‹åœ¨ç¬¬ä¸€ä¸ªå‡½æ•°çš„åŸºç¡€ä¸Šï¼Œå¹¶æµ‹è¯•é€šé…ç¬¦æ¨¡å¼æ˜¯å¦ç”ŸæˆçŽ°æœ‰æ–‡ä»¶ã€‚è¯·æ³¨æ„ï¼Œè¯¥å‚æ•°å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„é€šé…æ¨¡å¼ã€‚</p><p>ç¬¬ä¸‰ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªéžå¸¸æœ‰ç”¨çš„æ–­è¨€
                <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1254" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1255" class="indexterm"></a>ä¾èµ–äºŽ<em class="firstterm">è®¡ç®—å˜é‡</em>ã€‚<em class="command">make</em>å˜é‡å¯ä»¥åŒ…å«ä»»ä½•å†…å®¹ï¼ŒåŒ…æ‹¬å¦ä¸€ä¸ª<em class="command">make</em>å˜é‡çš„åç§°ã€‚ä½†æ˜¯ï¼Œå¦‚æžœä¸€ä¸ªå˜é‡åŒ…å«å¦ä¸€ä¸ªå˜é‡çš„åç§°ï¼Œå¦‚ä½•è®¿é—®å¦ä¸€ä¸ªå˜é‡çš„å€¼å‘¢ï¼Ÿå—¯ï¼Œéžå¸¸ç®€å•ï¼Œåªéœ€å°†å˜é‡æ‰©å±•ä¸¤æ¬¡ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt223"></a><pre class="programlisting">NO_SPACE_MSG := è®¾å¤‡ä¸Šæ²¡æœ‰å‰©ä½™ç©ºé—´ã€‚
NO_FILE_MSG := æœªæ‰¾åˆ°æ–‡ä»¶ã€‚
...;
STATUS_MSG := NO_SPACE_MSG
$(é”™è¯¯$($(STATUS_MSG)))</pre><p>ä¸ºäº†ä¿æŒç®€å•ï¼Œè¿™ä¸ªç¤ºä¾‹ç¨å¾®åšäº†ä¸€äº›è®¾è®¡ï¼Œä½†è¿™é‡Œ<code class="literal">STATUS_MSG</code>é€šè¿‡å­˜å‚¨é”™è¯¯æ¶ˆæ¯å˜é‡åç§°æ¥è®¾ç½®å¤šä¸ªé”™è¯¯æ¶ˆæ¯ä¹‹ä¸€ã€‚å½“éœ€è¦æ‰“å°æ¶ˆæ¯æ—¶ï¼Œ
                <code class="literal">STATUS_MSG</code>é¦–å…ˆæ‰©å±•ä»¥è®¿é—®é”™è¯¯æ¶ˆæ¯å˜é‡åç§°ï¼Œ<code class="literal">$(STATUS_MSG)</code>ç„¶åŽå†æ¬¡æ‰©å±•ä»¥è®¿é—®æ¶ˆæ¯æ–‡æœ¬ï¼Œ<code class="literal">$($(STATUS_MSG)</code>ï¼‰ã€‚åœ¨æˆ‘ä»¬çš„<code class="function">assert-not-null</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å‡è®¾å‡½æ•°çš„å‚æ•°æ˜¯<em class="command">make</em>å˜é‡
                çš„<span class="emphasis"><em>åç§°</em></span>ã€‚æˆ‘ä»¬é¦–å…ˆæ‰©å±•å‚æ•°æ¥è®¿é—®å˜é‡åç§°ï¼Œç„¶åŽå†æ¬¡æ‰©å±•) æ¥ç¡®å®šå®ƒæ˜¯å¦æœ‰å€¼ã€‚å¦‚æžœå®ƒä¸ºç©ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åœ¨é”™è¯¯æ¶ˆæ¯ä¸­ä½¿ç”¨å˜é‡åç§°ã€‚<em class="command"></em><code class="literal">$1</code><code class="literal">$($1</code><code class="literal">$1</code></p><a id="OEBPS/ch04s02.html.I_4_tt224"></a><pre class="programlisting">$ åˆ¶ä½œ
Makefile:14: *** æ–­è¨€å¤±è´¥ï¼šå˜é‡â€œNON_EXISTENTâ€ä¸ºç©ºã€‚åœæ­¢ã€‚</pre><p>è¿˜æœ‰ä¸€ä¸ª<code class="function">warning</code>å‡½æ•°ï¼ˆå‚è§æœ¬ç« åŽé¢çš„<a class="link" href="#OEBPS/ch04s02.html.make3-CHP-4-SECT-2.5" title="ä¸å¤ªé‡è¦çš„æ‚é¡¹åŠŸèƒ½">4.2.5 èŠ‚</a>ï¼‰ä»¥ä¸Ž ç›¸åŒçš„æ ¼å¼æ‰“å°æ¶ˆæ¯
                <code class="function">error</code>ï¼Œä½†ä¸ç»ˆæ­¢<em class="command">make</em>ã€‚</p></dd><dd><p>The <code class="function">error</code> function
                <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>is used for printing fatal error messages. After
                the function prints its message, <em class="command">make</em> terminates with an exit status
                of 2. The output is prefixed with the name of the current
                <em class="filename">makefile</em>, the current
                line number, and the message text. Here is an implementation
                of the common <code class="function">assert</code>
                programming construct for <em class="command">make</em>:</p><a></a><pre class="programlisting"># $(call assert,condition,message)
define assert
  $(if $1,,$(error Assertion failed: $2))
endef
# $(call assert-file-exists,wildcard-pattern)
define assert-file-exists
  $(call assert,$(wildcard $1),$1 does not exist)
endef
# $(call assert-not-null,make-variable)
define assert-not-null
  $(call assert,$($1),The variable "$1" is null)
endef
error-exit:
        $(call assert-not-null,NON_EXISTENT)</pre><p>The first function, <code class="function">assert</code>, just <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>tests its first argument and prints the user's
                error message if it is empty. The second function builds on
                the first and tests that a wildcard pattern yields an existing
                file. Note that the argument can include any number of
                globbing patterns.</p><p>The third function is a very useful assert that
                <a class="indexterm"></a> <a class="indexterm"></a>relies on <em class="firstterm">computed
                variables</em>. A <em class="command">make</em> variable can contain anything,
                including the name of another <em class="command">make</em> variable. But if a variable
                contains the name of another variable how can you access the
                value of that other variable? Well, very simply by expanding
                the variable twice:</p><a></a><pre class="programlisting">NO_SPACE_MSG := No space left on device.
NO_FILE_MSG  := File not found.
...;
STATUS_MSG   := NO_SPACE_MSG
$(error $($(STATUS_MSG)))</pre><p>This example is slightly contrived to keep it simple,
                but here <code class="literal">STATUS_MSG</code> is set
                to one of several error messages by storing the error message
                variable name. When it comes time to print the message,
                <code class="literal">STATUS_MSG</code> is first
                expanded to access the error message variable name, <code class="literal">$(STATUS_MSG)</code>, then expanded again
                to access the message text, <code class="literal">$($(STATUS_MSG)</code>). In our <code class="function">assert-not-null</code> function we assume
                the argument to the function is the <span class="emphasis"><em>name</em></span>
                of a <em class="command">make</em> variable. We
                first expand the argument, <code class="literal">$1</code>, to access the variable name,
                then expand again, <code class="literal">$($1</code>),
                to determine if it has a value. If it is null, then we have
                the variable name right in <code class="literal">$1</code> to use in the error
                message.</p><a></a><pre class="programlisting">$ make
Makefile:14: *** Assertion failed: The variable "NON_EXISTENT" is null.  Stop.</pre><p>There is also a <code class="function">warning</code> function (see the <a class="link" href="#OEBPS/ch04s02.html.make3-CHP-4-SECT-2.5" title="Less Important Miscellaneous Functions">Section 4.2.5</a> later in
                this chapter) that prints a message in the same format as
                <code class="function">error</code>, but does not
                terminate <em class="command">make</em>.</p></dd><dt><span class="term"><code class="literal">$(foreach</code>
              <code class="option">variable</code>, <code class="option">list</code>,<code class="option">body</code>
              <code class="literal">)</code></span></dt><dt><span class="term"><code class="literal">$(foreach</code>
              <code class="option">variable</code>,<code class="option">list</code>,<code class="option">body</code>
              <code class="literal">)</code></span></dt><dd><p>è¿™<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1256" class="indexterm"></a> <code class="function">foreach</code>
                <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1257" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1258" class="indexterm"></a>å‡½æ•°æä¾›äº†ä¸€ç§æ–¹æ³•<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1259" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1260" class="indexterm"></a>é‡å¤æ‰©å±•æ–‡æœ¬ï¼ŒåŒæ—¶å°†ä¸åŒçš„å€¼æ›¿æ¢åˆ°æ¯ä¸ªæ‰©å±•ä¸­ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸Žä½¿ç”¨ä¸åŒå‚æ•°é‡å¤æ‰§è¡Œå‡½æ•°ä¸åŒï¼ˆå°½ç®¡å®ƒä¹Ÿå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼‰ã€‚ä¾‹å¦‚ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt225"></a><pre class="programlisting">å­—æ¯ := $(å¯¹äºŽæ¯ä¸ªå­—æ¯,abcd,$(å­—æ¯))
æ˜¾ç¤ºè¯ï¼š
        # ä¸ªå­—æ¯æœ‰ $(å•è¯ $(å­—æ¯)) ä¸ªå•è¯ï¼š '$(å­—æ¯)'
$ åˆ¶ä½œ
# ä¸ªå­—æ¯æœ‰ 4 ä¸ªå•è¯ï¼š'abc d'</pre><p>æ‰§è¡Œæ­¤å‘½ä»¤æ—¶<code class="function">foreach</code>
                ï¼Œå®ƒå°†å¾ªçŽ¯æŽ§åˆ¶å˜é‡ è®¾å®š<code class="literal">letter</code>ä¸º ä¸­çš„æ¯ä¸ªå€¼ï¼Œ<code class="option">a b
                c d</code>å¹¶ä¸ºæ¯ä¸ªå€¼æ‰©å±•å¾ªçŽ¯ä½“<code class="literal">$(letter)</code>ä¸€æ¬¡ã€‚æ‰©å±•çš„æ–‡æœ¬é€šè¿‡ç©ºæ ¼åˆ†éš”æ¯ä¸ªæ‰©å±•æ¥ç´¯ç§¯ã€‚</p></dd><dd><p>The <a class="indexterm"></a> <code class="function">foreach</code>
                <a class="indexterm"></a> <a class="indexterm"></a> function provides a way to <a class="indexterm"></a> <a class="indexterm"></a>expand text repeatedly while substituting
                different values into each expansion. Notice that this is
                different from executing a function repeatedly with different
                arguments (although it can do that, too). For example:</p><a></a><pre class="programlisting">letters := $(foreach letter,a b c d,$(letter))
show-words:
        # letters has $(words $(letters)) words: '$(letters)'
$ make
# letters has 4 words: 'a b c d'</pre><p>When this <code class="function">foreach</code>
                is executed, it sets the loop control variable, <code class="literal">letter</code>, to each value in <code class="option">a b
                c d</code> and expands the body of the loop, <code class="literal">$(letter)</code>, once for each value. The
                expanded text is accumulated with a space separating each
                expansion.</p></dd></dl></div><p>è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ˜¯å¦è®¾ç½®äº†ä¸€ç»„å˜é‡çš„å‡½æ•°ï¼š</p><p>Here is a function to test if a set of variables is
          set:</p><a id="OEBPS/ch04s02.html.I_4_tt226"></a><pre class="programlisting">VARIABLE_LIST := æºå¯¹è±¡ä¸»é¡µ
$(foreach i,$(VARIABLE_LIST), \
  $(å¦‚æžœ$($i),,\
    $(shell echo $i æ²¡æœ‰å€¼ &gt; /dev/stderr)))</pre><pre class="programlisting">VARIABLE_LIST := SOURCES OBJECTS HOME
$(foreach i,$(VARIABLE_LIST), \
  $(if $($i),,                \
    $(shell echo $i has no value &gt; /dev/stderr)))</pre><p>ï¼ˆå‡½æ•°ä¸­çš„ä¼ªæ–‡ä»¶<em class="filename">/dev/stderr</em><code class="function">shell</code>éœ€è¦è®¾ç½®<code class="literal">SHELL</code>ä¸º<em class="command">bash</em>ã€‚ï¼‰æ­¤å¾ªçŽ¯<code class="literal">i</code>è®¾ç½®<code class="literal">VARIABLE_LIST</code>.ç¬¬ä¸€ä¸ªä¸­çš„æµ‹è¯•è¡¨è¾¾å¼<code class="literal">if</code>æ±‚å€¼<code class="literal">$i</code>ä»¥èŽ·å–å˜é‡åç§°ï¼Œç„¶åŽåœ¨è®¡ç®—è¡¨è¾¾å¼ä¸­å†æ¬¡æ±‚å€¼<code class="literal">$($i)</code>ä»¥æŸ¥çœ‹å®ƒæ˜¯å¦ä¸ºéžç©ºã€‚å¦‚æžœè¡¨è¾¾å¼æœ‰å€¼ï¼Œåˆ™è¯¥<em class="replaceable"><code>then</code></em>éƒ¨åˆ†ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼›å¦åˆ™ï¼Œè¯¥<em class="replaceable"><code>else</code></em>éƒ¨ä»¶å°†æ‰“å°è­¦å‘Šã€‚è¯·æ³¨æ„ï¼Œå¦‚æžœæˆ‘ä»¬çœç•¥ echo çš„é‡å®šå‘ï¼Œåˆ™å‘½ä»¤çš„è¾“å‡º<code class="function">shell</code>
          å°†è¢«æ›¿æ¢åˆ°<em class="filename">makefile</em>ä¸­ï¼Œä»Žè€Œäº§ç”Ÿè¯­æ³•é”™è¯¯ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œæ•´ä¸ª<code class="function">foreach</code>å¾ªçŽ¯æ‰©å±•ä¸ºç©ºã€‚</p><p>(The pseudo file <em class="filename">/dev/stderr</em> in the <code class="function">shell</code> function requires setting <code class="literal">SHELL</code> to <em class="command">bash</em>.) This loop sets <code class="literal">i</code> to each word of <code class="literal">VARIABLE_LIST</code>. The test expression inside
          the <code class="literal">if</code> first evaluates <code class="literal">$i</code> to get the variable name, then
          evaluates this again in a computed expression <code class="literal">$($i)</code> to see if it is non-null. If the
          expression has a value, the <em class="replaceable"><code>then</code></em> part
          does nothing; otherwise, the <em class="replaceable"><code>else</code></em> part
          prints a warning. Note that if we omit the redirection from the
          echo, the output of the <code class="function">shell</code>
          command will be substituted into the <em class="filename">makefile</em>, yielding a syntax error. As
          shown, the entire <code class="function">foreach</code> loop
          expands to nothing.</p><p>æ­£å¦‚ä¹‹å‰æ‰€æ‰¿è¯ºçš„ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªä»Žåˆ—è¡¨ä¸­æ”¶é›†åŒ…å«å­å­—ç¬¦ä¸²çš„æ‰€æœ‰å•è¯çš„å‡½æ•°ï¼š</p><p>As promised earlier, here is a function that gathers all the
          words that contain a substring from a list:</p><a id="OEBPS/ch04s02.html.I_4_tt227"></a><pre class="programlisting"># $(è°ƒç”¨ grep å­—ç¬¦ä¸²ã€æœç´¢å­—ç¬¦ä¸²ã€å•è¯åˆ—è¡¨)
å®šä¹‰ grep å­—ç¬¦ä¸²
$(æ¡\
  $(foreach w, $2, \
    $(if $(findstring $1, $w), \
      $w)))
æ©å¾·å¤«
å•è¯ := count_words.c counter.c lexer.l lexer.h counter.h
æŸ¥è¯ï¼š
        @echo $(è°ƒç”¨ grep-string,un,$(words))</pre><pre class="programlisting"># $(call grep-string, search-string, word-list)
define grep-string
$(strip                                         \
  $(foreach w, $2,                               \
    $(if $(findstring $1, $w),                   \
      $w)))
endef
words := count_words.c counter.c lexer.l lexer.h counter.h
find-words:
        @echo $(call grep-string,un,$(words))</pre><p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªå‡½æ•°ä¸æŽ¥å—æ¨¡å¼ï¼Œä½†å®ƒç¡®å®žæ‰¾åˆ°ç®€å•çš„å­å­—ç¬¦ä¸²ï¼š</p><p>Unfortunately, this function does not accept patterns, but it
          does find simple substrings:</p><a id="OEBPS/ch04s02.html.I_4_tt228"></a><pre class="programlisting">$ åˆ¶ä½œ
count_words.c counter.c counter.h</pre><pre class="programlisting">$ make
count_words.c counter.c counter.h</pre><div class="sect3" title="å…³äºŽå˜é‡å’Œæ‹¬å·çš„æ ·å¼æ³¨é‡Š"><div class="titlepage"><div><div><h3 class="title"><a id="OEBPS/ch04s02.html.make3-CHP-4-SECT-2.4.1"></a>å…³äºŽå˜é‡å’Œæ‹¬å·çš„æ ·å¼æ³¨é‡Š</h3><h3 class="title"><a></a>Style note concerning variables and parentheses</h3></div></div></div><p>å¦‚å‰æ‰€è¿°ï¼Œæ‹¬å·<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1261" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1262" class="indexterm"></a>å¯¹äºŽä¸€ä¸ªå­—ç¬¦çš„<em class="command">make</em>å˜é‡æ¥è¯´ä¸éœ€è¦ã€‚ä¾‹å¦‚ï¼Œæ‰€æœ‰åŸºæœ¬è‡ªåŠ¨å˜é‡éƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦ã€‚å³ä½¿åœ¨<acronym class="acronym">GNU </acronym> <em class="command">make</em>æ‰‹å†Œä¸­ï¼Œè‡ªåŠ¨å˜é‡ä¹Ÿæ™®éä¸å¸¦æ‹¬å·ã€‚ç„¶è€Œï¼Œ<em class="command">make</em>æ‰‹å†Œå‡ ä¹Žå¯¹æ‰€æœ‰å…¶ä»–å˜é‡ï¼ˆç”šè‡³å•ä¸ªå­—ç¬¦å˜é‡ï¼‰éƒ½ä½¿ç”¨æ‹¬å·ï¼Œå¹¶å¼ºçƒˆæ•¦ä¿ƒç”¨æˆ·æ•ˆä»¿ã€‚è¿™çªå‡ºäº†<em class="command">make</em>å˜é‡çš„ç‰¹æ®Šæ€§è´¨
            ï¼Œå› ä¸ºå‡ ä¹Žæ‰€æœ‰å…¶ä»–å…·æœ‰â€œç¾Žå…ƒå˜é‡â€çš„ç¨‹åºï¼ˆä¾‹å¦‚ shellã€<em class="command">perl</em>ã€<em class="command">awk</em>ã€<em class="command">yacc</em>ç­‰ï¼‰éƒ½ä¸éœ€è¦æ‹¬å·ã€‚æœ€å¸¸è§çš„<em class="command">make</em>ç¼–ç¨‹é”™è¯¯ä¹‹ä¸€
            æ˜¯å¿˜è®°æ‹¬å·ã€‚ä»¥ä¸‹æ˜¯<code class="literal">foreach</code>åŒ…å«é”™è¯¯çš„å¸¸è§ç”¨æ³•ï¼š</p><p>As noted earlier, parentheses<a class="indexterm"></a> <a class="indexterm"></a> are not required for <em class="command">make</em> variables of one character. For
            instance, all of the basic automatic variables are one character.
            Automatic variables are universally written without parentheses
            even in the <acronym class="acronym">GNU</acronym> <em class="command">make</em> manual. However, the <em class="command">make</em> manual uses parentheses for
            virtually all other variables, even single character variables,
            and strongly urges users to follow suit. This highlights the
            special nature of <em class="command">make</em>
            variables since almost all other programs that have "dollar
            variables" (such as shells, <em class="command">perl</em>, <em class="command">awk</em>, <em class="command">yacc</em>, etc.) don't require parentheses.
            One of the more common <em class="command">make</em>
            programming errors is forgetting parentheses. Here is a common use
            of <code class="literal">foreach</code> containing the
            error:</p><a id="OEBPS/ch04s02.html.I_4_tt229"></a><pre class="programlisting">åŒ…æ‹¬_ç›®å½•:= ...
åŒ…æ‹¬ := $(foreach i,$INCLUDE_DIRS,-I $i)
# INCLUDES çŽ°åœ¨çš„å€¼ä¸ºâ€œ-I NCLUDE_DIRSâ€</pre><pre class="programlisting">INCLUDE_DIRS := ...
INCLUDES := $(foreach i,$INCLUDE_DIRS,-I $i)
# INCLUDES now has the value "-I NCLUDE_DIRS"</pre><p>ç„¶è€Œï¼Œæˆ‘å‘çŽ°é€šè¿‡æ˜Žæ™ºåœ°ä½¿ç”¨å•å­—ç¬¦å˜é‡å¹¶çœç•¥ä¸å¿…è¦çš„æ‹¬å·ï¼Œå¯ä»¥æ›´å®¹æ˜“åœ°è¯»å–å®ã€‚ä¾‹å¦‚ï¼Œæˆ‘è®¤ä¸º
            <code class="function">has-duplicates</code>æ²¡æœ‰å®Œæ•´æ‹¬å·çš„å‡½æ•°æ›´å®¹æ˜“é˜…è¯»ï¼š</p><p>However, I find that reading macros can be much easier
            through the judicious use of single-character variables and
            omitting unnecessary parentheses. For instance, I think the
            <code class="function">has-duplicates</code> function is
            easier to read without full parentheses:</p><a id="OEBPS/ch04s02.html.I_4_tt230"></a><pre class="programlisting"># $(è°ƒç”¨æœ‰é‡å¤é¡¹ï¼Œå•è¯åˆ—è¡¨)
æœ‰é‡å¤é¡¹ = $(è¿‡æ»¤å™¨ \
                   $(å•è¯$1) \
                   $(å•è¯$(æŽ’åº$1))))</pre><pre class="programlisting"># $(call has-duplicates, word-list)
has-duplicates = $(filter               \
                   $(words $1)          \
                   $(words $(sort $1))))</pre><p>ç›¸å¯¹ï¼š</p><p>versus:</p><a id="OEBPS/ch04s02.html.I_4_tt231"></a><pre class="programlisting"># $(è°ƒç”¨æœ‰é‡å¤é¡¹ï¼Œå•è¯åˆ—è¡¨)
æœ‰é‡å¤é¡¹ = $(è¿‡æ»¤å™¨ \
                   $(å•è¯$(1)) \
                   $(å•è¯$(æŽ’åº$(1)))))</pre><pre class="programlisting"># $(call has-duplicates, word-list)
has-duplicates = $(filter                 \
                   $(words $(1))          \
                   $(words $(sort $(1)))))</pre><p>ç„¶è€Œï¼Œ<code class="function">kill-program</code>ä½¿ç”¨å®Œæ•´çš„æ‹¬å·è¯¥å‡½æ•°å¯èƒ½æ›´å…·å¯è¯»æ€§ï¼Œå› ä¸ºå®ƒå°†æœ‰åŠ©äºŽåŒºåˆ†
            <em class="command">make</em>å˜é‡ä¸Ž shell å˜é‡æˆ–å…¶ä»–ç¨‹åºä¸­ä½¿ç”¨çš„å˜é‡ï¼š</p><p>However, the <code class="function">kill-program</code> function might be more
            readable with full parentheses since it would help distinguish
            <em class="command">make</em> variables from shell
            variables or variables used in other programs:</p><a id="OEBPS/ch04s02.html.I_4_tt232"></a><pre class="programlisting">å®šä¹‰ç»ˆæ­¢ç¨‹åº
  @ $(PS) $(PS_FLAGS) | \
  $(AWK) 'å¼€å§‹ { FieldWIDTHS = $(PS_FIELDS) } \
          /$(1)/{ \
                  æ‰“å°â€œæ€æ­»â€$$3ï¼› \
                  ç³»ç»Ÿ(â€œ$(KILL)$(KILLFLAGS)â€$$1)\
                }'
æ©å¾·å¤«</pre><pre class="programlisting">define kill-program
  @ $(PS) $(PS_FLAGS) |                                 \
  $(AWK) 'BEGIN { FIELDWIDTHS = $(PS_FIELDS) }          \
          /$(1)/{                                       \
                  print "Killing " $$3;                 \
                  system( "$(KILL) $(KILLFLAGS) " $$1 ) \
                }'
endef</pre><p>æœç´¢å­—ç¬¦ä¸²åŒ…å«å®çš„ç¬¬ä¸€ä¸ªå‚æ•°
            <code class="literal">$(1)</code>ã€‚<code class="literal">$$3</code>å¹¶<code class="literal">$$1</code>å¼•ç”¨<em class="command">awk</em>å˜é‡ã€‚</p><p>The search string contains the first parameter to the macro,
            <code class="literal">$(1)</code>. <code class="literal">$$3</code> and <code class="literal">$$1</code> refer to <em class="command">awk</em> variables.</p><p>æˆ‘ä½¿ç”¨å•å­—ç¬¦å˜é‡ï¼Œå¹¶ä¸”ä»…åœ¨çœ‹èµ·æ¥ä½¿ä»£ç æ›´å…·å¯è¯»æ€§æ—¶æ‰çœç•¥æ‹¬å·ã€‚æˆ‘é€šå¸¸å¯¹å®çš„å‚æ•°å’Œ
            <code class="function">foreach</code>å¾ªçŽ¯ä¸­çš„æŽ§åˆ¶å˜é‡æ‰§è¡Œæ­¤æ“ä½œã€‚æ‚¨åº”è¯¥éµå¾ªé€‚åˆæ‚¨æƒ…å†µçš„é£Žæ ¼ã€‚å¦‚æžœæ‚¨å¯¹<em class="filename">makefile</em>çš„å¯ç»´æŠ¤æ€§æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·éµå¾ª<em class="command">make</em>æ‰‹å†Œçš„å»ºè®®å¹¶ä½¿ç”¨å®Œæ•´çš„æ‹¬å·ã€‚è¯·è®°ä½ï¼Œ<em class="command">make</em>
            ç¨‹åºå°±æ˜¯ä¸ºäº†ç¼“è§£ä¸Žç»´æŠ¤è½¯ä»¶ç›¸å…³çš„é—®é¢˜ã€‚å¦‚æžœæ‚¨åœ¨ç¼–å†™<em class="filename">makefile</em>æ—¶ç‰¢è®°è¿™ä¸€ç‚¹
            ï¼Œé‚£ä¹ˆæ‚¨å¾ˆå¯èƒ½ä¼šé¿å…éº»çƒ¦ã€‚</p><p>I use single-character variables and omit the parentheses
            only when it seems to make the code more readable. I typically do
            this for the parameters to macros and the control variable in
            <code class="function">foreach</code> loops. You should
            follow a style that suits your situation. If you have any doubts
            about the maintainability of your <em class="filename">makefile</em>s, follow the <em class="command">make</em> manual's suggestion and use full
            parentheses. Remember, the <em class="command">make</em>
            program is all about easing the problems associated with
            maintaining software. If you keep that in mind as you write your
            <em class="filename">makefile</em>s, you will most
            likely stay clear of trouble.</p></div></div><div class="sect2" title="ä¸å¤ªé‡è¦çš„æ‚é¡¹åŠŸèƒ½"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch04s02.html.make3-CHP-4-SECT-2.5"></a>ä¸å¤ªé‡è¦çš„æ‚é¡¹åŠŸèƒ½</h2><h2 class="title"><a></a>Less Important Miscellaneous Functions</h2></div></div></div><p>æœ€åŽï¼Œæˆ‘ä»¬æœ‰ä¸€äº›æ‚é¡¹ï¼ˆä½†é‡è¦ï¼‰çš„å­—ç¬¦ä¸²å‡½æ•°ã€‚è™½ç„¶ä¸Ž<code class="function">foreach</code>æˆ–ç›¸æ¯”è¾ƒå°<code class="function">call</code>ï¼Œä½†æ‚¨ä¼šå‘çŽ°è‡ªå·±ç»å¸¸ä½¿ç”¨å®ƒä»¬ã€‚</p><p>Finally, we have some miscellaneous (but important) string
          functions. Although minor in comparison with <code class="function">foreach</code> or <code class="function">call</code>, you'll find yourself using these
          very often.</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">$(strip</code>
              <code class="option">text</code> <code class="literal">)</code></span></dt><dt><span class="term"><code class="literal">$(strip</code>
              <code class="option">text</code> <code class="literal">)</code></span></dt><dd><p>è¿™<code class="function">strip</code>
                <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1263" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1264" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1265" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1266" class="indexterm"></a>å‡½æ•°åˆ é™¤æ‰€æœ‰<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1267" class="indexterm"></a><code class="option">text</code>å°†æ‰€æœ‰å†…éƒ¨ç©ºç™½æ›¿æ¢ä¸ºå•ä¸ªç©ºæ ¼çš„å‰å¯¼å’Œå°¾éšç©ºç™½
                ã€‚æ­¤å‡½æ•°çš„å¸¸è§ç”¨é€”æ˜¯æ¸…ç†æ¡ä»¶è¡¨è¾¾å¼ä¸­ä½¿ç”¨çš„å˜é‡ã€‚</p><p>æˆ‘æœ€å¸¸ä½¿ç”¨æ­¤å‡½æ•°ä»Žè·¨å¤šè¡Œæ ¼å¼åŒ–çš„å˜é‡å’Œå®å®šä¹‰ä¸­åˆ é™¤ä¸éœ€è¦çš„ç©ºæ ¼ã€‚ä½†å¦‚æžœå‡½æ•°å¯¹å‰å¯¼ç©ºæ ¼æ•æ„Ÿï¼Œåˆ™ç”¨ åŒ…è£¹å‡½æ•°å‚æ•°<code class="literal">$1</code>ã€
                <code class="literal">$2</code>ç­‰ä¹Ÿæ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚é€šå¸¸ï¼Œä¸äº†è§£<em class="command">make</em><code class="function">strip</code>å¾®å¦™ä¹‹å¤„çš„ç¨‹åºå‘˜ä¼šåœ¨å‚æ•°åˆ—è¡¨ä¸­çš„é€—å·åŽé¢æ·»åŠ ä¸€ä¸ªç©ºæ ¼
                ã€‚<em class="command"></em><code class="function">call</code></p></dd><dd><p>The <code class="function">strip</code>
                <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> function removes all <a class="indexterm"></a>leading and trailing whitespace from
                <code class="option">text</code> and replaces all internal whitespace
                with a single space. A common use for this function is to
                clean up variables used in conditional expressions.</p><p>I most often use this function to remove unwanted
                whitespace from variable and macro definitions I've formatted
                across multiple lines. But it can also be a good idea to wrap
                the function parameters <code class="literal">$1</code>,
                <code class="literal">$2</code>, etc., with <code class="function">strip</code> if the function is sensitive
                to leading blanks. Often programmers unaware of the subtleties
                of <em class="command">make</em> will add a space
                after commas in a <code class="function">call</code>
                argument list.</p></dd><dt><span class="term"><code class="literal">$(origin</code>
              <code class="option">variable</code> <code class="literal">)</code></span></dt><dt><span class="term"><code class="literal">$(origin</code>
              <code class="option">variable</code> <code class="literal">)</code></span></dt><dd><p>è¿™<code class="function">origin</code>
                <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1268" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1269" class="indexterm"></a>å‡½æ•°è¿”å›žä¸€ä¸ªå­—ç¬¦ä¸²<a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1270" class="indexterm"></a>æè¿°å˜é‡çš„æ¥æºã€‚è¿™å¯¹äºŽå†³å®šå¦‚ä½•ä½¿ç”¨å˜é‡çš„å€¼éžå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœå˜é‡çš„å€¼æ¥è‡ªçŽ¯å¢ƒï¼Œæ‚¨å¯èƒ½å¸Œæœ›å¿½ç•¥å®ƒï¼Œä½†å¦‚æžœå®ƒæ˜¯ä»Žå‘½ä»¤è¡Œè®¾ç½®çš„ï¼Œåˆ™ä¸éœ€è¦ã€‚å¯¹äºŽæ›´å…·ä½“çš„ç¤ºä¾‹ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªæ–°çš„æ–­è¨€å‡½æ•°ï¼Œç”¨äºŽæµ‹è¯•å˜é‡æ˜¯å¦å·²å®šä¹‰ï¼š</p><a id="OEBPS/ch04s02.html.I_4_tt233"></a><pre class="programlisting"># $(è°ƒç”¨æ–­è¨€å®šä¹‰ï¼Œå˜é‡å)
å®šä¹‰æ–­è¨€å®šä¹‰
  $(è°ƒç”¨æ–­è¨€ï¼Œ\
    $(è¿‡æ»¤å‡ºæœªå®šä¹‰ï¼Œ$(åŽŸç‚¹$1))ï¼Œ\
    â€œ$1â€æœªå®šä¹‰ï¼‰
æ©å¾·å¤«</pre><p>å¯èƒ½çš„è¿”å›žå€¼ä¸º<code class="function">origin</code>ï¼š</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">undefined</code></span></dt><dd><p>è¯¥å˜é‡ä»Žæœªè¢«å®šä¹‰è¿‡ã€‚</p></dd><dt><span class="term"><code class="literal">default</code></span></dt><dd><p>è¯¥å˜é‡çš„å®šä¹‰æ¥è‡ª<em class="command">make</em>çš„å†…ç½®æ•°æ®åº“ã€‚å¦‚æžœæ›´æ”¹å†…ç½®å˜é‡çš„å€¼ï¼Œåˆ™<code class="function">origin</code>è¿”å›žæœ€æ–°å®šä¹‰çš„æ¥æºã€‚</p></dd><dt><span class="term"><code class="literal">environment</code></span></dt><dd><p>å˜é‡çš„å®šä¹‰æ¥è‡ªçŽ¯å¢ƒï¼ˆå¹¶ä¸”è¯¥
                      <code class="option">â€”environment-overrides</code>é€‰é¡¹
                      <span class="emphasis"><em>æœª</em></span>æ‰“å¼€ï¼‰ã€‚</p></dd><dt><span class="term"><code class="literal">environment
                    override</code></span></dt><dd><p>å˜é‡çš„å®šä¹‰æ¥è‡ªçŽ¯å¢ƒï¼ˆå¹¶ä¸”è¯¥
                      <code class="option">â€”environment-overrides</code>é€‰é¡¹
                      <span class="emphasis"><em>å·²</em></span>æ‰“å¼€ï¼‰ã€‚</p></dd><dt><span class="term"><code class="literal">file</code></span></dt><dd><p>è¯¥å˜é‡çš„å®šä¹‰æ¥è‡ª<em class="filename">makefile</em>ã€‚</p></dd><dt><span class="term"><code class="literal">command
                    line</code></span></dt><dd><p>å˜é‡çš„å®šä¹‰æ¥è‡ªå‘½ä»¤è¡Œã€‚</p></dd><dt><span class="term"><code class="literal">override</code></span></dt><dd><p>å˜é‡çš„å®šä¹‰æ¥è‡ª<code class="function">override</code>æŒ‡ä»¤ã€‚</p></dd><dt><span class="term"><code class="literal">automatic</code></span></dt><dd><p><em class="command">è¯¥å˜é‡æ˜¯make</em>å®šä¹‰çš„è‡ªåŠ¨å˜é‡
                      ã€‚</p></dd><dt><span class="term"><code class="literal">$(warning</code>
                    <code class="option">text</code> <code class="literal">)</code></span></dt><dd><p>è¿™<code class="function">warning</code>
                      <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1271" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1272" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1273" class="indexterm"></a> <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1274" class="indexterm"></a>function ä¸Ž function ç±»ä¼¼<code class="function">error</code>ï¼Œåªæ˜¯å®ƒä¸ä¼šå¯¼è‡´<em class="command">make</em>
                      é€€å‡ºã€‚ä¸Žå‡½æ•°ä¸€æ ·ï¼Œè¾“å‡ºä»¥å½“å‰<em class="filename">makefile</em><code class="function">error</code>çš„åç§°å’Œå½“å‰è¡Œå·ä¸ºå‰ç¼€ï¼ŒåŽè·Ÿæ¶ˆæ¯æ–‡æœ¬ã€‚å‡½æ•°å±•å¼€ä¸ºç©º<em class="filename"></em><code class="function">warning</code><a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1275" class="indexterm"></a>
                      <a id="OEBPS/ch04s02.html.make3-CHP-4-ITERM-1276" class="indexterm"></a>å­—ç¬¦ä¸²ï¼Œå› æ­¤å®ƒå‡ ä¹Žå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ã€‚</p><a id="OEBPS/ch04s02.html.I_4_tt234"></a><pre class="programlisting">$(if $(é€šé…ç¬¦ $(JAVAC)),, \
  $(è­¦å‘Šjavaç¼–è¯‘å™¨å˜é‡ï¼ŒJAVAC($(JAVAC))ï¼Œ\
            æœªæ­£ç¡®è®¾ç½®ã€‚ï¼‰ï¼‰</pre></dd></dl></div></dd><dd><p>The <code class="function">origin</code>
                <a class="indexterm"></a> <a class="indexterm"></a> function returns a string <a class="indexterm"></a>describing the origin of a variable. This can be
                very useful in deciding how to use the value of a variable.
                For instance, you might want to ignore the value of a variable
                if it came from the environment, but not if it was set from
                the command line. For a more concrete example, here is a new
                assert function that tests if a variable is defined:</p><a></a><pre class="programlisting"># $(call assert-defined,variable-name)
define assert-defined
  $(call assert,                          \
    $(filter-out undefined,$(origin $1)), \
    '$1' is undefined)
endef</pre><p>The possible return values of <code class="function">origin</code> are:</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">undefined</code></span></dt><dd><p>The variable has never been defined.</p></dd><dt><span class="term"><code class="literal">default</code></span></dt><dd><p>The variable's definition came from <em class="command">make</em>'s built-in database. If
                      you alter the value of a built-in variable, <code class="function">origin</code> returns the origin of
                      the most recent definition.</p></dd><dt><span class="term"><code class="literal">environment</code></span></dt><dd><p>The variable's definition came from the
                      environment (and the
                      <code class="option">â€”environment-overrides</code> option is
                      <span class="emphasis"><em>not</em></span> turned on).</p></dd><dt><span class="term"><code class="literal">environment
                    override</code></span></dt><dd><p>The variable's definition came from the
                      environment (and the
                      <code class="option">â€”environment-overrides</code> option
                      <span class="emphasis"><em>is</em></span> turned on).</p></dd><dt><span class="term"><code class="literal">file</code></span></dt><dd><p>The variable's definition came from the <em class="filename">makefile</em>.</p></dd><dt><span class="term"><code class="literal">command
                    line</code></span></dt><dd><p>The variable's definition came from the command
                      line.</p></dd><dt><span class="term"><code class="literal">override</code></span></dt><dd><p>The variable's definition came from an <code class="function">override</code> directive.</p></dd><dt><span class="term"><code class="literal">automatic</code></span></dt><dd><p>The variable is an automatic variable defined by
                      <em class="command">make</em>.</p></dd><dt><span class="term"><code class="literal">$(warning</code>
                    <code class="option">text</code> <code class="literal">)</code></span></dt><dd><p>The <code class="function">warning</code>
                      <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> function is similar to the <code class="function">error</code> function except that it
                      does not cause <em class="command">make</em>
                      to exit. Like the <code class="function">error</code> function, the output is
                      prefixed with the name of the current <em class="filename">makefile</em> and the current line
                      number followed by the message text. The <code class="function">warning</code> function expands to
                      the empty <a class="indexterm"></a>
                      <a class="indexterm"></a>string so
                      it can be used almost anywhere.</p><a></a><pre class="programlisting">$(if $(wildcard $(JAVAC)),,                               \
  $(warning The java compiler variable, JAVAC ($(JAVAC)), \
            is not properly set.))</pre></dd></dl></div></dd></dl></div></div><div class="footnotes"><br><br><hr><div class="footnote"><p><sup>[ <a id="OEBPS/ch04s02.html.ftn.make3-CHP-4-FNOTE-3" href="#OEBPS/ch04s02.html.make3-CHP-4-FNOTE-3" class="para">3</a> ]</sup>åœ¨ Java ä¸­ï¼Œå»ºè®®æ‰€æœ‰ç±»éƒ½åœ¨åŒ…å«å¼€å‘äººå‘˜å®Œæ•´ Internet åŸŸåçš„åŒ…ä¸­å£°æ˜Žï¼Œç›¸åã€‚æ­¤å¤–ï¼Œç›®å½•ç»“æž„é€šå¸¸åæ˜ åŒ…ç»“æž„ã€‚å› æ­¤ï¼Œè®¸å¤šæºä»£ç æ ‘çœ‹èµ·æ¥åƒ
              <em class="replaceable"><code>root-dir</code></em>/com/ <em class="replaceable"><code>company-name</code></em>/ <em class="replaceable"><code>dir</code></em>ã€‚</p><p><sup>[<a href="#OEBPS/ch04s02.html.make3-CHP-4-FNOTE-3" class="para">3</a>] </sup>In Java, it is suggested that all classes be declared
              within a package containing the developer's complete Internet
              domain name, reversed. Also, the directory structure typically
              mirrors the package structure. Therefore, many source trees look
              like
              <em class="replaceable"><code>root-dir</code></em>/com/<em class="replaceable"><code>company-name</code></em>/<em class="replaceable"><code>dir</code></em>.</p></div><div class="footnote"><p><sup>[ <a id="OEBPS/ch04s02.html.ftn.make3-CHP-4-FNOTE-4" href="#OEBPS/ch04s02.html.make3-CHP-4-FNOTE-4" class="para">4</a> ]</sup> make <em class="command">3.80</em>æ‰‹å†Œæ²¡æœ‰æåˆ°å…è®¸ä½¿ç”¨å¤šç§æ¨¡å¼ã€‚</p><p><sup>[<a href="#OEBPS/ch04s02.html.make3-CHP-4-FNOTE-4" class="para">4</a>] </sup>The <em class="command">make</em> 3.80
                    manual fails to mention that more than one pattern is
                    allowed.</p></div><div class="footnote"><p><sup>[ <a id="OEBPS/ch04s02.html.ftn.make3-CHP-4-FNOTE-5" href="#OEBPS/ch04s02.html.make3-CHP-4-FNOTE-5" class="para">5</a> ]</sup>åœ¨<a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®">ç¬¬3ç« </a>ä¸­ï¼Œæˆ‘å¯¹å®è¯­è¨€å’Œå…¶ä»–ç¼–ç¨‹è¯­è¨€è¿›è¡Œäº†åŒºåˆ†ã€‚å®è¯­è¨€çš„å·¥ä½œåŽŸç†æ˜¯é€šè¿‡å®šä¹‰å’Œæ‰©å±•å®å°†æºæ–‡æœ¬è½¬æ¢ä¸ºè¾“å‡ºæ–‡æœ¬ã€‚å½“æˆ‘ä»¬äº†è§£è¯¥<code class="function">if</code>
                    å‡½æ•°çš„å·¥ä½œåŽŸç†æ—¶ï¼Œè¿™ç§åŒºåˆ«å°±ä¼šå˜å¾—æ›´åŠ æ¸…æ™°ã€‚</p><p><sup>[<a href="#OEBPS/ch04s02.html.make3-CHP-4-FNOTE-5" class="para">5</a>] </sup>In <a class="link" href="#OEBPS/ch03.html" title="Chapter&nbsp;3.&nbsp;Variables and Macros">Chapter 3</a>, I
                    made a distinction between macro languages and other
                    programming languages. Macro languages work by
                    transforming source text into output text through defining
                    and expanding macros. This distinction becomes clearer as
                    we see how the <code class="function">if</code>
                    function works.</p></div></div></div></div></div>
<div id="OEBPS/ch04s03.html"><div>
<div class="sect1" title="é«˜çº§ç”¨æˆ·å®šä¹‰å‡½æ•°"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch04s03.html.make3-CHP-4-SECT-3"></a>é«˜çº§ç”¨æˆ·å®šä¹‰å‡½æ•°</h1><h1 class="title"><a></a>Advanced User-Defined Functions</h1></div></div></div><p>æˆ‘ä»¬ä¼šèŠ±å¾ˆå¤šæ—¶é—´<a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1277" class="indexterm"></a> <a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1278" class="indexterm"></a>ç¼–å†™å®å‡½æ•°ã€‚ä¸å¹¸çš„æ˜¯ï¼Œ <em class="command">make</em>ä¸­æ²¡æœ‰å¤ªå¤šå¸®åŠ©è°ƒè¯•å®ƒä»¬çš„åŠŸèƒ½ã€‚è®©æˆ‘ä»¬é¦–å…ˆå°è¯•ç¼–å†™ä¸€ä¸ªç®€å•çš„è°ƒè¯•è·Ÿè¸ªå‡½æ•°æ¥å¸®åŠ©æˆ‘ä»¬è§£å†³é—®é¢˜ã€‚</p><p>We'll spend a lot of time <a class="indexterm"></a> <a class="indexterm"></a>writing macro functions. Unfortunately, there aren't
        many features in <em class="command">make</em> for helping
        to debug them. Let's begin by trying to write a simple debugging trace
        function to help us out.</p><p>æ­£å¦‚æˆ‘ä»¬æ‰€æåˆ°çš„ï¼Œ<code class="function">call</code>
        å°†æŠŠå®ƒçš„æ¯ä¸ªå‚æ•°ç»‘å®šåˆ°ç¼–å·å˜é‡<code class="literal">$1</code>ã€<code class="literal">$2</code>ç­‰ã€‚å¯ä»¥å‘ èµ‹äºˆä»»æ„æ•°é‡çš„å‚æ•°<code class="function">call</code>ã€‚ä½œä¸ºä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå½“å‰æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°çš„åç§°ï¼ˆå³å˜é‡åç§°ï¼‰å¯ä»¥é€šè¿‡ è®¿é—®<code class="literal">$0</code>ã€‚åˆ©ç”¨è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€å¯¹è°ƒè¯•å‡½æ•°ï¼Œé€šè¿‡å®æ‰©å±•è¿›è¡Œè·Ÿè¸ªï¼š</p><p>As we've mentioned, <code class="function">call</code>
        will bind each of its parameters to the numbered variables <code class="literal">$1</code>, <code class="literal">$2</code>,
        etc. Any number of arguments can be given to <code class="function">call</code>. As a special case, the name of the
        currently executing function (i.e., the variable name) is accessible
        through <code class="literal">$0</code>. Using this information,
        we can write a pair of debugging functions for tracing through macro
        expansion:</p><a id="OEBPS/ch04s03.html.I_4_tt235"></a><pre class="programlisting"># $(è°ƒè¯•è¾“å…¥)
è°ƒè¯•è¾“å…¥ = $(å¦‚æžœ $(debug_trace),\
                $(è­¦å‘Šè¾“å…¥$0($(echo-args))))

# $(è°ƒè¯•ç¦»å¼€)
debug-leave = $(if $(debug_trace),$(è­¦å‘Šç¦»å¼€ $0))

é€—å· := ,
echo-args = $(subst ' ','$(é€—å·) ',\
                $(foreach a,1 2 3 4 5 6 7 8 9,'$($a)'))</pre><pre class="programlisting"># $(debug-enter)
debug-enter = $(if $(debug_trace),\
                $(warning Entering $0($(echo-args))))

# $(debug-leave)
debug-leave = $(if $(debug_trace),$(warning Leaving $0))

comma := ,
echo-args   = $(subst ' ','$(comma) ',\
                $(foreach a,1 2 3 4 5 6 7 8 9,'$($a)'))</pre><p>å¦‚æžœæˆ‘ä»¬æƒ³è§‚å¯Ÿå‡½æ•°<code class="function">a</code>å’Œ<code class="function">b</code>æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ä½¿ç”¨è¿™äº›è·Ÿè¸ªå‡½æ•°ï¼š</p><p>If we want to watch how functions <code class="function">a</code> and <code class="function">b</code> are invoked, we can use these trace
        functions like this:</p><a id="OEBPS/ch04s03.html.I_4_tt236"></a><pre class="programlisting">è°ƒè¯•è·Ÿè¸ª = 1

å®šä¹‰ä¸€ä¸ª
  $(è°ƒè¯•-è¾“å…¥)
  @echo $1 $2 $3
  $(è°ƒè¯•ç¦»å¼€)
æ©å¾·å¤«

å®šä¹‰b
  $(è°ƒè¯•-è¾“å…¥)
  $(å‘¼å« a,$1,$2,hi)
  $(è°ƒè¯•ç¦»å¼€)
æ©å¾·å¤«

è·Ÿè¸ªå®ï¼š
        $(è°ƒç”¨ b,5,$(MAKE))</pre><pre class="programlisting">debug_trace = 1

define a
  $(debug-enter)
  @echo $1 $2 $3
  $(debug-leave)
endef

define b
  $(debug-enter)
  $(call a,$1,$2,hi)
  $(debug-leave)
endef

trace-macro:
        $(call b,5,$(MAKE))</pre><p>é€šè¿‡å°†<code class="function">debug-enter</code>å’Œ
        <code class="function">debug-leave</code>å˜é‡æ”¾ç½®åœ¨
        <a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1279" class="indexterm"></a> <a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1280" class="indexterm"></a> <a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1281" class="indexterm"></a> <a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1282" class="indexterm"></a>å‡½æ•°çš„å¼€å§‹å’Œç»“æŸï¼Œæ‚¨å¯ä»¥è·Ÿè¸ªè‡ªå·±å‡½æ•°çš„æ‰©å±•ã€‚è¿™äº›åŠŸèƒ½è¿˜è¿œè¿œä¸å¤Ÿå®Œå–„ã€‚è¯¥<code class="function">echo-args</code>å‡½æ•°å°†ä»…å›žæ˜¾å‰ä¹ä¸ªå‚æ•°ï¼Œæ›´ç³Ÿç³•çš„æ˜¯ï¼Œå®ƒæ— æ³•ç¡®å®šè°ƒç”¨ä¸­å®žé™…å‚æ•°çš„æ•°é‡ï¼ˆå½“ç„¶ï¼Œä¹Ÿä¸èƒ½<em class="command">make</em>ï¼ï¼‰ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘å·²ç»ç”¨è¿‡<a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1283" class="indexterm"></a> <a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1284" class="indexterm"></a>è¿™äº›å®åœ¨æˆ‘è‡ªå·±çš„è°ƒè¯•ä¸­â€œæŒ‰åŽŸæ ·â€ã€‚æ‰§è¡Œæ—¶ï¼Œ<em class="filename">makefile</em>ä¼šç”Ÿæˆä»¥ä¸‹è·Ÿè¸ªè¾“å‡ºï¼š</p><p>By placing <code class="function">debug-enter</code> and
        <code class="function">debug-leave</code> variables at the
        <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>start and end of your functions, you can trace the
        expansions of your own functions. These functions are far from
        perfect. The <code class="function">echo-args</code> function
        will echo only the first nine arguments and, worse, it cannot
        determine the number of actual arguments in the call (of course,
        neither can <em class="command">make</em>!). Nevertheless,
        I've used <a class="indexterm"></a> <a class="indexterm"></a>these macros "as is" in my own debugging. When executed,
        the <em class="filename">makefile</em> generates this trace
        output:</p><a id="OEBPS/ch04s03.html.I_4_tt237"></a><pre class="programlisting">$ åˆ¶ä½œ
makefile:14: è¾“å…¥ b('5', 'make', '', '', '', '', '', '', '')
makefile:14: è¾“å…¥ a( '5', 'make', 'hi', '', '', '', '', '', '')
makefile:14: ç•™ä¸‹ä¸€ä¸ª
makefile:14: ç¦»å¼€ b
5 æ‰“ä¸ªæ‹›å‘¼</pre><pre class="programlisting">$ make
makefile:14: Entering b( '5', 'make', '', '', '', '', '', '', '')
makefile:14: Entering a( '5', 'make', 'hi', '', '', '', '', '', '')
makefile:14: Leaving a
makefile:14: Leaving b
5 make hi</pre><p>æ­£å¦‚ä¸€ä½æœ‹å‹æœ€è¿‘å¯¹æˆ‘è¯´çš„é‚£æ ·ï¼Œâ€œæˆ‘ä»¥å‰ä»Žæœªæƒ³è¿‡<em class="command">å°† make</em>ä½œä¸ºä¸€ç§ç¼–ç¨‹è¯­è¨€ã€‚â€
         <acronym class="acronym">GNU </acronym> <em class="command">make</em>ä¸æ˜¯ä½ ç¥–æ¯çš„<em class="command">make</em>ï¼</p><p>As a friend said to me recently, "I never thought of <em class="command">make</em> as a programming language before."
        <acronym class="acronym">GNU</acronym> <em class="command">make</em> isn't
        your grandmother's <em class="command">make</em>!</p><div class="sect2" title="è¯„ä¼°å’Œä»·å€¼"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch04s03.html.make3-CHP-4-SECT-3.1"></a>è¯„ä¼°å’Œä»·å€¼</h2><h2 class="title"><a></a>eval and value</h2></div></div></div><p>è¿™<code class="function">eval</code> <a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1285" class="indexterm"></a> <a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1286" class="indexterm"></a>å‡½æ•°ä¸Žå…¶ä»–å†…ç½®å‡½æ•°å®Œå…¨ä¸åŒã€‚å…¶ç›®çš„æ˜¯å°†æ–‡æœ¬ç›´æŽ¥æä¾›ç»™
          <em class="command">make</em>è§£æžå™¨ã€‚ä¾‹å¦‚ï¼Œ</p><p>The <code class="function">eval</code> <a class="indexterm"></a> <a class="indexterm"></a> function is completely different from the rest of the
          built-in functions. Its purpose is to feed text directly to the
          <em class="command">make</em> parser. For instance,</p><a id="OEBPS/ch04s03.html.I_4_tt238"></a><pre class="programlisting">$(è¯„ä¼°æº:= foo.c bar.c)</pre><pre class="programlisting">$(eval sources := foo.c bar.c)</pre><p>é¦–å…ˆæ‰«æçš„å‚æ•°<code class="function">eval</code>ä»¥æŸ¥æ‰¾å˜é‡å¹¶å±•å¼€ï¼ˆå°±åƒæ‰€æœ‰å‡½æ•°çš„æ‰€æœ‰å‚æ•°ä¸€æ ·ï¼‰ï¼Œç„¶åŽå¯¹æ–‡æœ¬è¿›è¡Œè§£æžå’Œè¯„ä¼°ï¼Œå°±å¥½åƒå®ƒæ¥è‡ªè¾“å…¥æ–‡ä»¶ä¸€æ ·ã€‚è¿™ä¸ªä¾‹å­éžå¸¸ç®€å•ï¼Œæ‚¨å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆè¦è´¹å¿ƒä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚è®©æˆ‘ä»¬å°è¯•ä¸€ä¸ªæ›´æœ‰è¶£çš„ä¾‹å­ã€‚å‡è®¾æ‚¨æœ‰ä¸€ä¸ª<em class="filename">makefile</em>æ¥ç¼–è¯‘åå‡ ä¸ªç¨‹åºï¼Œå¹¶ä¸”æ‚¨æƒ³ä¸ºæ¯ä¸ªç¨‹åºå®šä¹‰å‡ ä¸ªå˜é‡ï¼Œä¾‹å¦‚<code class="literal">sources</code>ã€<code class="literal">headers</code>å’Œ<code class="literal">objects</code>ã€‚ä¸è¦å¯¹æ¯ç»„å˜é‡ä¸€éåˆä¸€éåœ°é‡å¤è¿™äº›å˜é‡åˆ†é…ï¼š</p><p>The argument to <code class="function">eval</code> is
          first scanned for variables and expanded (as all arguments to all
          functions are), then the text is parsed and evaluated as if it had
          come from an input file. This example is so simple you might be
          wondering why you would bother with this function. Let's try a more
          interesting example. Suppose you have a <em class="filename">makefile</em> to compile a dozen programs and
          you want to define several variables for each program, say <code class="literal">sources</code>, <code class="literal">headers</code>, and <code class="literal">objects</code>. Instead of repeating these
          variable assignments over and over with each set of
          variables:</p><a id="OEBPS/ch04s03.html.I_4_tt239"></a><pre class="programlisting">ls_sources := ls.c glob.c
ls_headers := ls.h glob.h
ls_objects := ls.o glob.o
...</pre><pre class="programlisting">ls_sources := ls.c glob.c
ls_headers := ls.h glob.h
ls_objects := ls.o glob.o
...</pre><p>æˆ‘ä»¬å¯èƒ½ä¼šå°è¯•å®šä¹‰ä¸€ä¸ªå®æ¥å®Œæˆè¿™é¡¹å·¥ä½œï¼š</p><p>We might try to define a macro to do the job:</p><a id="OEBPS/ch04s03.html.I_4_tt240"></a><pre class="programlisting"># $(è°ƒç”¨ç¨‹åºå˜é‡ã€å˜é‡å‰ç¼€ã€æ–‡ä»¶åˆ—è¡¨)
å®šä¹‰ç¨‹åºå˜é‡
  $1_sources = $(è¿‡æ»¤å™¨%.c,$2)
  $1_headers = $(è¿‡æ»¤å™¨%.h,$2)
  $1_objects = $(subst .c,.o,$(è¿‡æ»¤å™¨ %.c,$2))
æ©å¾·å¤«

$(è°ƒç”¨ç¨‹åºå˜é‡, ls, ls.c ls.h glob.c glob.h)

æ˜¾ç¤ºå˜é‡ï¼š
        # $(ls_sources)
        # $(ls_headers)
        # $(ls_objects)</pre><pre class="programlisting"># $(call program-variables, variable-prefix, file-list)
define program-variables
  $1_sources = $(filter %.c,$2)
  $1_headers = $(filter %.h,$2)
  $1_objects = $(subst .c,.o,$(filter %.c,$2))
endef

$(call program-variables, ls, ls.c ls.h glob.c glob.h)

show-variables:
        # $(ls_sources)
        # $(ls_headers)
        # $(ls_objects)</pre><p>è¯¥<code class="function">program-variables</code>
          å®æŽ¥å—<a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1287" class="indexterm"></a> <a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1288" class="indexterm"></a>ä¸¤ä¸ªå‚æ•°ï¼šä¸‰ä¸ªå˜é‡çš„å‰ç¼€å’Œä¸€ä¸ªæ–‡ä»¶åˆ—è¡¨ï¼Œå®ä»Žä¸­é€‰æ‹©è¦åœ¨æ¯ä¸ªå˜é‡ä¸­è®¾ç½®çš„æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬å°è¯•ä½¿ç”¨è¿™ä¸ªå®æ—¶ï¼Œæˆ‘ä»¬æ”¶åˆ°é”™è¯¯ï¼š</p><p>The <code class="function">program-variables</code>
          macro accepts<a class="indexterm"></a> <a class="indexterm"></a> two arguments: a prefix for the three variables and a
          file list from which the macro selects files to set in each
          variable. But, when we try to use this macro, we get the
          error:</p><a id="OEBPS/ch04s03.html.I_4_tt241"></a><pre class="programlisting">$ <strong class="userinput"><code>make</code></strong>
Makefile:7: *** ç¼ºå°‘åˆ†éš”ç¬¦ã€‚åœæ­¢ã€‚</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
Makefile:7: *** missing separator.  Stop.</pre><p>ç”±äºŽ<em class="command">make</em>è§£æžå™¨çš„å·¥ä½œæ–¹å¼ï¼Œè¿™ä¸èƒ½æŒ‰é¢„æœŸå·¥ä½œã€‚æ‰©å±•ä¸ºå¤šè¡Œçš„å®ï¼ˆåœ¨é¡¶çº§è§£æžçº§åˆ«ï¼‰æ˜¯éžæ³•çš„ï¼Œä¼šå¯¼è‡´è¯­æ³•é”™è¯¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè§£æžå™¨è®¤ä¸ºè¯¥è¡Œæ˜¯è§„åˆ™æˆ–å‘½ä»¤è„šæœ¬çš„ä¸€éƒ¨åˆ†ï¼Œä½†ç¼ºå°‘åˆ†éš”ç¬¦æ ‡è®°ã€‚ç›¸å½“ä»¤äººå›°æƒ‘çš„é”™è¯¯æ¶ˆæ¯ã€‚è¯¥<code class="function">eval</code>å‡½æ•°çš„å¼•å…¥å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¦‚æžœæˆ‘ä»¬å°†<code class="function">call</code>è¡Œæ›´æ”¹ä¸ºï¼š</p><p>This doesn't work as expected because of the way the <em class="command">make</em> parser works. A macro (at the top
          parsing level) that expands to multiple lines is illegal and results
          in syntax errors. In this case, the parser believes this line is a
          rule or part of a command script but is missing a separator token.
          Quite a confusing error message. The <code class="function">eval</code> function was introduced to handle
          this issue. If we change our <code class="function">call</code> line to:</p><a id="OEBPS/ch04s03.html.I_4_tt242"></a><pre class="programlisting">$(eval $(è°ƒç”¨ç¨‹åºå˜é‡, ls, ls.c ls.h glob.c glob.h))</pre><pre class="programlisting">$(eval $(call program-variables, ls, ls.c ls.h glob.c glob.h))</pre><p>æˆ‘ä»¬å¾—åˆ°äº†æˆ‘ä»¬æ‰€æœŸæœ›çš„ï¼š</p><p>we get what we expect:</p><a id="OEBPS/ch04s03.html.I_4_tt243"></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
# ls.c glob.c
# ls.h glob.h
# ls.o glob.o</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
# ls.c glob.c
# ls.h glob.h
# ls.o glob.o</pre><p>ä½¿ç”¨<code class="function">eval</code>è§£å†³äº†
          <a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1289" class="indexterm"></a> <a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1290" class="indexterm"></a>è§£æžé—®é¢˜ï¼Œå› ä¸º<code class="function">eval</code>å¤„ç†å¤šè¡Œå®æ‰©å±•å¹¶ä¸”æœ¬èº«æ‰©å±•ä¸ºé›¶è¡Œã€‚</p><p>Using <code class="function">eval</code> resolves the
          <a class="indexterm"></a> <a class="indexterm"></a>parsing issue because <code class="function">eval</code> handles the multiline macro
          expansion and itself expands to zero lines.</p><p>çŽ°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªéžå¸¸ç®€æ´åœ°å®šä¹‰äº†ä¸‰ä¸ªå˜é‡çš„å®ã€‚è¯·æ³¨æ„å®ä¸­çš„èµ‹å€¼å¦‚ä½•ä»Žä¼ é€’åˆ°å‡½æ•°çš„å‰ç¼€å’Œå›ºå®šåŽç¼€
          <code class="literal">$1_sources</code>.ç»„æˆå˜é‡åç§°ã€‚è¿™äº›ä¸æ˜¯å‰é¢æè¿°çš„ç²¾ç¡®è®¡ç®—çš„å˜é‡ï¼Œä½†å®ƒä»¬å…·æœ‰å¤§è‡´ç›¸åŒçš„é£Žæ ¼ã€‚</p><p>Now we have a macro that defines three variables very
          concisely. Notice how the assignments in the macro compose variable
          names from a prefix passed in to the function and a fixed suffix,
          <code class="literal">$1_sources</code>. These aren't
          precisely computed variables as described previously, but they have
          much the same flavor.</p><p>ç»§ç»­è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æ„è¯†åˆ°æˆ‘ä»¬è¿˜å¯ä»¥åŒ…æ‹¬æˆ‘ä»¬çš„
          <a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1291" class="indexterm"></a> <a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1292" class="indexterm"></a>å®ä¸­çš„è§„åˆ™ï¼š</p><p>Continuing this example, we realize we can also include our
          <a class="indexterm"></a> <a class="indexterm"></a>rules in the macro:</p><a id="OEBPS/ch04s03.html.I_4_tt244"></a><pre class="programlisting"># $(è°ƒç”¨ç¨‹åºå˜é‡,å˜é‡å‰ç¼€,æ–‡ä»¶åˆ—è¡¨)
å®šä¹‰ç¨‹åºå˜é‡
  $1_sources = $(è¿‡æ»¤å™¨%.c,$2)
  $1_headers = $(è¿‡æ»¤å™¨%.h,$2)
  $1_objects = $(subst .c,.o,$(è¿‡æ»¤å™¨ %.c,$2))

  $($1_objects): $($1_headers)
æ©å¾·å¤«

ls: $(ls_objects)

$(eval $(è°ƒç”¨ç¨‹åºå˜é‡,ls,ls.c ls.h glob.c glob.h))</pre><pre class="programlisting"># $(call program-variables,variable-prefix,file-list)
define program-variables
  $1_sources = $(filter %.c,$2)
  $1_headers = $(filter %.h,$2)
  $1_objects = $(subst .c,.o,$(filter %.c,$2))

  $($1_objects): $($1_headers)
endef

ls: $(ls_objects)

$(eval $(call program-variables,ls,ls.c ls.h glob.c glob.h))</pre><p>è¯·æ³¨æ„è¿™ä¸¤ä¸ªç‰ˆæœ¬å¦‚ä½•<code class="function">program-variables</code>è¯´æ˜Žå‡½æ•°å‚æ•°ä¸­çš„ç©ºæ ¼é—®é¢˜ã€‚åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œä¸¤ä¸ªå‡½æ•°å‚æ•°çš„ç®€å•ä½¿ç”¨ä¸å—å‚æ•°å‰å¯¼ç©ºæ ¼çš„å½±å“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ— è®º<code class="literal">$1</code>æˆ–ä¸­æ˜¯å¦æœ‰ä»»ä½•å‰å¯¼ç©ºæ ¼ï¼Œä»£ç çš„è¡Œä¸ºéƒ½æ˜¯ç›¸åŒçš„<code class="literal">$2</code>ã€‚ç„¶è€Œï¼Œæ–°ç‰ˆæœ¬å¼•å…¥äº†è®¡ç®—å˜é‡<code class="literal">$($1_objects)</code>å’Œ<code class="literal">$($1_headers)</code>ã€‚çŽ°åœ¨ï¼Œå‘å‡½æ•° ( <em class="command">ls</em> )çš„ç¬¬ä¸€ä¸ªå‚æ•°æ·»åŠ å‰å¯¼ç©ºæ ¼ä¼šå¯¼è‡´è®¡ç®—å˜é‡ä»¥å‰å¯¼ç©ºæ ¼å¼€å¤´ï¼Œè¯¥å˜é‡ä¼šæ‰©å±•ä¸ºç©ºï¼Œå› ä¸ºæˆ‘ä»¬å®šä¹‰çš„å˜é‡éƒ½æ²¡æœ‰ä»¥å‰å¯¼ç©ºæ ¼å¼€å¤´ã€‚è¿™å¯èƒ½æ˜¯ä¸€ä¸ªéžå¸¸éšè”½çš„è¯Šæ–­é—®é¢˜ã€‚</p><p>Notice how these two versions of <code class="function">program-variables</code> illustrate a problem
          with spaces in function arguments. In the previous version, the
          simple uses of the two function parameters were immune to leading
          spaces on the arguments. That is, the code behaved the same
          regardless of any leading spaces in <code class="literal">$1</code> or <code class="literal">$2</code>. The new version, however, introduced
          the computed variables <code class="literal">$($1_objects)</code> and <code class="literal">$($1_headers)</code>. Now adding a leading space
          to the first argument to our function (<em class="command">ls</em>) causes the computed variable to begin
          with a leading space, which expands to nothing because no variable
          we've defined begins with a leading space. This can be quite an
          insidious problem to diagnose.</p><p>å½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ª<em class="filename">makefile</em>æ—¶ï¼Œæˆ‘ä»¬å‘çŽ°
          <em class="command">make</em>å¿½ç•¥äº†<em class="filename">.h</em>å…ˆå†³æ¡ä»¶ã€‚ä¸ºäº†è¯Šæ–­è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é€šè¿‡è¿è¡Œ<em class="command">make</em>
          åŠå…¶é€‰é¡¹æ¥æ£€æŸ¥<em class="command">make</em>çš„å†…éƒ¨æ•°æ®åº“ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸€äº›å¥‡æ€ªçš„ä¸œè¥¿ï¼š<em class="command"></em><em class="command"></em><em class="command"></em><code class="option">â€”print-data-base</code></p><p>When we run this <em class="filename">makefile</em>, we discover that somehow the
          <em class="filename">.h</em> prerequisites are being
          ignored by <em class="command">make</em>. To diagnose this
          problem, we examine <em class="command">make</em>'s
          internal database by running <em class="command">make</em>
          with its <code class="option">â€”print-data-base</code> option and we see
          something strange:</p><a id="OEBPS/ch04s03.html.I_4_tt245"></a><pre class="programlisting">$<strong class="userinput"><code>make --print-database | grep ^ls</code></strong>
ls_headers = ls.h glob.h
ls_sources = ls.c glob.c
ls_objects = ls.o glob.o
ls.c:
ls.o: ls.c
ls: ls.o</pre><pre class="programlisting">$<strong class="userinput"><code>make --print-database | grep ^ls</code></strong>
ls_headers = ls.h glob.h
ls_sources = ls.c glob.c
ls_objects = ls.o glob.o
ls.c:
ls.o: ls.c
ls: ls.o</pre><p><em class="filename">ls.o</em>çš„
          <em class="filename">.h</em>å…ˆå†³æ¡ä»¶ç¼ºå¤±ï¼ä½¿ç”¨è®¡ç®—å˜é‡çš„è§„åˆ™æœ‰é—®é¢˜ã€‚<em class="filename"></em></p><p>The <em class="filename">.h</em> prerequisites for
          <em class="filename">ls.o</em> are missing! There is
          something wrong with the rule using computed variables.</p><p>å½“<em class="command">make</em>è§£æž
          <code class="function">eval</code>å‡½æ•°è°ƒç”¨æ—¶ï¼Œå®ƒé¦–å…ˆæ‰©å±•ç”¨æˆ·å®šä¹‰çš„å‡½æ•°<code class="function">program-variables</code>ã€‚å®çš„ç¬¬ä¸€è¡Œæ‰©å±•ä¸ºï¼š</p><p>When <em class="command">make</em> parses the
          <code class="function">eval</code> function call, it first
          expands the user-defined function, <code class="function">program-variables</code>. The first line of the
          macro expands to:</p><a id="OEBPS/ch04s03.html.I_4_tt246"></a><pre class="programlisting">ls_sources = ls.c glob.c</pre><pre class="programlisting">ls_sources = ls.c glob.c</pre><p>è¯·æ³¨æ„ï¼Œå®çš„æ¯ä¸€è¡Œéƒ½ä¼šæŒ‰é¢„æœŸç«‹å³å±•å¼€ã€‚å…¶ä»–å˜é‡èµ‹å€¼çš„å¤„ç†æ–¹å¼ç±»ä¼¼ã€‚ç„¶åŽæˆ‘ä»¬å¾—å‡ºè§„åˆ™ï¼š</p><p>Notice that each line of the macro is expanded immediately as
          expected. The other variable assignments are handled similarly. Then
          we get to the rule:</p><a id="OEBPS/ch04s03.html.I_4_tt247"></a><pre class="programlisting">$($1_objects): $($1_headers)</pre><pre class="programlisting">$($1_objects): $($1_headers)</pre><p>è®¡ç®—å˜é‡é¦–å…ˆæ‰©å±•å…¶å˜é‡åï¼š</p><p>The computed variables first have their variable name
          expanded:</p><a id="OEBPS/ch04s03.html.I_4_tt248"></a><pre class="programlisting">$(ls_objects): $(ls_headers)</pre><pre class="programlisting">$(ls_objects): $(ls_headers)</pre><p>ç„¶åŽæ‰§è¡Œå¤–éƒ¨å˜é‡æ‰©å±•ï¼Œäº§ç”Ÿï¼š</p><p>Then the outer variable expansion is performed,
          yielding:</p><a id="OEBPS/ch04s03.html.I_4_tt249"></a><pre class="programlisting">ï¼š</pre><pre class="programlisting">:</pre><p>ç­‰å¾…ï¼æˆ‘ä»¬çš„å˜é‡åˆ°å“ªé‡ŒåŽ»äº†ï¼Ÿç­”æ¡ˆæ˜¯å‰é¢çš„ä¸‰ä¸ªèµ‹å€¼è¯­å¥è¢« make æ‰©å±•ä½†<span class="emphasis"><em>æ²¡æœ‰</em></span><em class="command">è®¡ç®—</em>ã€‚è®©æˆ‘ä»¬ç»§ç»­çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ä¸€æ—¦<code class="function">program-variables</code>æ‰©å±•äº†
          å¯¹çš„è°ƒç”¨ï¼Œ <em class="command">make</em>å°±ä¼šçœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p><p>Wait! Where did our variables go? The answer is that the
          previous three assignment statements were expanded <span class="emphasis"><em>but not
          evaluated</em></span> by <em class="command">make</em>.
          Let's keep going to see how this works. Once the call to <code class="function">program-variables</code> has been expanded,
          <em class="command">make</em> sees something like:</p><a id="OEBPS/ch04s03.html.I_4_tt250"></a><pre class="programlisting">$(eval ls_sources = ls.c glob.c
ls_headers = ls.h glob.h
ls_objects = ls.o glob.o

:)</pre><pre class="programlisting">$(eval   ls_sources = ls.c glob.c
ls_headers = ls.h glob.h
ls_objects = ls.o glob.o

:)</pre><p>ç„¶åŽè¯¥<code class="function">eval</code>å‡½æ•°æ‰§è¡Œå¹¶å®šä¹‰ä¸‰ä¸ªå˜é‡ã€‚å› æ­¤ï¼Œç­”æ¡ˆæ˜¯è§„åˆ™ä¸­çš„å˜é‡åœ¨å®žé™…å®šä¹‰ä¹‹å‰å°±å·²è¢«æ‰©å±•ã€‚</p><p>The <code class="function">eval</code> function then
          executes and defines the three variables. So, the answer is that the
          variables in the rule are being expanded before they have actually
          been defined.</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ˜¾å¼æŽ¨è¿Ÿè®¡ç®—å˜é‡çš„æ‰©å±•ç›´åˆ°å®šä¹‰äº†ä¸‰ä¸ªå˜é‡æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨è®¡ç®—å˜é‡å‰é¢å¼•ç”¨ç¾Žå…ƒç¬¦å·æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼š</p><p>We can resolve this problem by explicitly deferring the
          expansion of the computed variables until the three variables are
          defined. We can do this by quoting the dollar signs in front of the
          computed variables:</p><a id="OEBPS/ch04s03.html.I_4_tt251"></a><pre class="programlisting">$$($1_objects): $$($1_headers)</pre><pre class="programlisting">$$($1_objects): $$($1_headers)</pre><p>è¿™æ¬¡<em class="command">make</em>æ•°æ®åº“æ˜¾ç¤ºäº†æˆ‘ä»¬æœŸæœ›çš„å…ˆå†³æ¡ä»¶ï¼š</p><p>This time the <em class="command">make</em> database
          shows the prerequisites we expect:</p><a id="OEBPS/ch04s03.html.I_4_tt252"></a><pre class="programlisting">$<strong class="userinput"><code>make -p | grep ^ls</code></strong>
ls_headers = ls.h glob.h
ls_sources = ls.c glob.c
ls_objects = ls.o glob.o
ls.c:
ls.o: ls.c ls.h glob.h
ls: ls.o</pre><pre class="programlisting">$<strong class="userinput"><code>make -p | grep ^ls</code></strong>
ls_headers = ls.h glob.h
ls_sources = ls.c glob.c
ls_objects = ls.o glob.o
ls.c:
ls.o: ls.c ls.h glob.h
ls: ls.o</pre><p>æ€»è€Œè¨€ä¹‹ï¼Œ çš„å‚æ•°<code class="function">eval</code>è¢«æ‰©å±•
          <span class="emphasis"><em>ä¸¤æ¬¡</em></span>ï¼šä¸€æ¬¡æ˜¯å½“<em class="command">make</em>ä¸º å‡†å¤‡å‚æ•°åˆ—è¡¨
          æ—¶<code class="function">eval</code>ï¼Œå¦ä¸€æ¬¡æ˜¯ by
           <code class="function">eval</code>ã€‚</p><p>To summarize, the argument to <code class="function">eval</code> is expanded
          <span class="emphasis"><em>twice</em></span>: once when when <em class="command">make</em> prepares the argument list for
          <code class="function">eval</code>, and once again by
          <code class="function">eval</code>.</p><p>æˆ‘ä»¬é€šè¿‡æŽ¨è¿Ÿè®¡ç®—å˜é‡çš„è¯„ä¼°è§£å†³äº†æœ€åŽä¸€ä¸ªé—®é¢˜ã€‚å¤„ç†è¯¥é—®é¢˜çš„å¦ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡ç”¨ä»¥ä¸‹å†…å®¹åŒ…è£…æ¯ä¸ªå˜é‡æ¥å¼ºåˆ¶æ—©æœŸè¯„ä¼°å˜é‡åˆ†é…<code class="function">eval</code>ï¼š</p><p>We resolved the last problem by deferring evaluation of the
          computed variables. Another way of handling the problem is to force
          early evaluation of the variable assignments by wrapping each one
          with <code class="function">eval</code>:</p><a id="OEBPS/ch04s03.html.I_4_tt253"></a><pre class="programlisting"># $(è°ƒç”¨ç¨‹åºå˜é‡,å˜é‡å‰ç¼€,æ–‡ä»¶åˆ—è¡¨)
å®šä¹‰ç¨‹åºå˜é‡
  $(eval $1_sources = $(è¿‡æ»¤å™¨%.c,$2))
  $(eval $1_headers = $(è¿‡æ»¤å™¨%.h,$2))
  $(eval $1_objects = $(subst .c,.o,$(è¿‡æ»¤å™¨ %.c,$2)))

  $($1_objects): $($1_headers)
æ©å¾·å¤«

ls: $(ls_objects)

$(eval $(è°ƒç”¨ç¨‹åºå˜é‡,ls,ls.c ls.h glob.c glob.h))</pre><pre class="programlisting"># $(call program-variables,variable-prefix,file-list)
define program-variables
  $(eval $1_sources = $(filter %.c,$2))
  $(eval $1_headers = $(filter %.h,$2))
  $(eval $1_objects = $(subst .c,.o,$(filter %.c,$2)))

  $($1_objects): $($1_headers)
endef

ls: $(ls_objects)

$(eval $(call program-variables,ls,ls.c ls.h glob.c glob.h))</pre><p>é€šè¿‡å°†å˜é‡èµ‹å€¼åŒ…è£…åœ¨å®ƒä»¬è‡ªå·±çš„è°ƒç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®å±•å¼€æ—¶
          <code class="function">eval</code>ä½¿å®ƒä»¬è¢«<em class="command">make</em><code class="function">program-variables</code>å†…éƒ¨åŒ–ã€‚ç„¶åŽå®ƒä»¬å°±å¯ä»¥ç«‹å³åœ¨å®ä¸­ä½¿ç”¨ã€‚</p><p>By wrapping the variable assignments in their own <code class="function">eval</code> calls, we cause them to be
          internalized by <em class="command">make</em> while the
          <code class="function">program-variables</code> macro is
          being expanded. They are then available for use within the macro
          immediately.</p><p>å½“æˆ‘ä»¬å¢žå¼º<em class="filename">makefile</em>æ—¶ï¼Œæˆ‘ä»¬æ„è¯†åˆ°æˆ‘ä»¬è¿˜æœ‰å¦ä¸€ä¸ªå¯ä»¥æ·»åŠ åˆ°å®ä¸­çš„è§„åˆ™ã€‚ç¨‹åºæœ¬èº«å–å†³äºŽå®ƒçš„å¯¹è±¡ã€‚å› æ­¤ï¼Œä¸ºäº†å®Œæˆæˆ‘ä»¬çš„å‚æ•°åŒ–<em class="filename">makefile</em>ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªé¡¶çº§<em class="filename">allç›®æ ‡ï¼Œå¹¶éœ€è¦ä¸€ä¸ªå˜é‡æ¥ä¿å­˜æˆ‘ä»¬çš„</em><em class="filename">makefile</em>
          å¯ä»¥ç®¡ç†çš„æ‰€æœ‰ç¨‹åºï¼š</p><p>As we enhance our <em class="filename">makefile</em>, we realize we have another rule
          we can add to our macro. The program itself depends on its objects.
          So, to finish our parameterized <em class="filename">makefile</em>, we add a top-level <em class="filename">all</em> target and need a variable to hold
          all the programs our <em class="filename">makefile</em>
          can manage:</p><a id="OEBPS/ch04s03.html.I_4_tt254"></a><pre class="programlisting">#$(è°ƒç”¨ç¨‹åºå˜é‡ã€å˜é‡å‰ç¼€ã€æ–‡ä»¶åˆ—è¡¨)
å®šä¹‰ç¨‹åºå˜é‡
  $(eval $1_sources = $(è¿‡æ»¤å™¨%.c,$2))
  $(eval $1_headers = $(è¿‡æ»¤å™¨%.h,$2))
  $(eval $1_objects = $(subst .c,.o,$(è¿‡æ»¤å™¨ %.c,$2)))

  èŠ‚ç›® += $1

  $1: $($1_objects)

  $($1_objects): $($1_headers)
æ©å¾·å¤«

# å°†æ‰€æœ‰ç›®æ ‡æ”¾åœ¨è¿™é‡Œï¼Œæ‰€ä»¥å®ƒæ˜¯é»˜è®¤ç›®æ ‡ã€‚
å…¨éƒ¨ï¼š

$(eval $(è°ƒç”¨ç¨‹åºå˜é‡,ls,ls.c ls.h glob.c glob.h))
$(eval $(è°ƒç”¨ç¨‹åºå˜é‡,cp,...))
$(eval $(è°ƒç”¨ç¨‹åºå˜é‡,mv,...))
$(eval $(è°ƒç”¨ç¨‹åºå˜é‡,ln,...))
$(eval $(è°ƒç”¨ç¨‹åºå˜é‡,rm,...))

# å°†ç¨‹åºå…ˆå†³æ¡ä»¶æ”¾ç½®åœ¨æ­¤å¤„å®šä¹‰çš„ä½ç½®ã€‚
å…¨éƒ¨ï¼š$ï¼ˆç¨‹åºï¼‰</pre><pre class="programlisting">#$(call program-variables,variable-prefix,file-list)
define program-variables
  $(eval $1_sources = $(filter %.c,$2))
  $(eval $1_headers = $(filter %.h,$2))
  $(eval $1_objects = $(subst .c,.o,$(filter %.c,$2)))

  programs += $1

  $1: $($1_objects)

  $($1_objects): $($1_headers)
endef

# Place all target here, so it is the default goal.
all:

$(eval $(call program-variables,ls,ls.c ls.h glob.c glob.h))
$(eval $(call program-variables,cp,...))
$(eval $(call program-variables,mv,...))
$(eval $(call program-variables,ln,...))
$(eval $(call program-variables,rm,...))

# Place the programs prerequisite here where it is defined.
all: $(programs)</pre><p>æ³¨æ„ç›®æ ‡çš„æ”¾ç½®<code class="literal">all</code>åŠå…¶å…ˆå†³æ¡ä»¶ã€‚è¯¥
          <code class="literal">programs</code>å˜é‡ç›´åˆ°äº”æ¬¡<code class="literal">eval</code>
          è°ƒç”¨ä¹‹åŽæ‰è¢«æ­£ç¡®å®šä¹‰ï¼Œä½†æˆ‘ä»¬å¸Œæœ›å°†ç›®æ ‡æ”¾åœ¨<span class="email"><a class="email" href="#OEBPS/mailto:makefile">makefile</a></span><code class="literal">all</code>ä¸­çš„ç¬¬ä¸€ä¸ªä½ç½®
          ï¼Œå› æ­¤è¿™æ˜¯é»˜è®¤ç›®æ ‡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å…ˆæ”¾ç½®å…ˆå†³æ¡ä»¶ç„¶åŽå†æ·»åŠ å…ˆå†³æ¡ä»¶æ¥æ»¡è¶³æ‰€æœ‰é™åˆ¶
          ã€‚<span class="email"><a class="email" href="#OEBPS/mailto:makefile"></a></span><code class="literal">all</code><code class="literal">all</code></p><p>Notice the placement of the <code class="literal">all</code> target and its prerequisite. The
          <code class="literal">programs</code> variable is not properly
          defined until after the five <code class="literal">eval</code>
          calls, but we would like to place the <code class="literal">all</code> target first in the
          <span class="email"><a class="email" href="#OEBPS/mailto:makefile">makefile</a></span> so <code class="literal">all</code> is
          the default goal. We can satisfy all our constrains by putting
          <code class="literal">all</code> first and adding the
          prerequisites later.</p><p>è¯¥<code class="function">program-variables</code>
          å‡½æ•°å­˜åœ¨é—®é¢˜ï¼Œå› ä¸ºæŸäº›å˜é‡è¯„ä¼°å¾—å¤ªæ—©ã€‚<em class="command">make</em>å®žé™…ä¸Šæä¾›äº†ä¸€ä¸ª
          <code class="function">value</code>å‡½æ•°æ¥å¸®åŠ©è§£å†³è¿™ç§æƒ…å†µã€‚è¯¥å‡½æ•°è¿”å›žå…¶å‚æ•°
          <span class="emphasis"><em>unexpanded</em></span><code class="function">value</code>
          çš„å€¼ã€‚ç„¶åŽå¯ä»¥å°†è¯¥æœªæ‰©å±•çš„å€¼ä¼ é€’ç»™å¤„ç†ã€‚é€šè¿‡è¿”å›žæœªæ‰©å±•çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é¿å…å¿…é¡»åœ¨å®ä¸­å¼•ç”¨æŸäº›å˜é‡å¼•ç”¨çš„é—®é¢˜ã€‚<code class="option">variable</code><span class="emphasis"><em></em></span><code class="function">eval</code></p><p>The <code class="function">program-variables</code>
          function had problems because some variables were evaluated too
          early. <em class="command">make</em> actually offers a
          <code class="function">value</code> function to help address
          this situation. The <code class="function">value</code>
          function returns the value of its <code class="option">variable</code> argument
          <span class="emphasis"><em>unexpanded</em></span>. This unexpanded value can then be
          passed to <code class="function">eval</code> for processing.
          By returning an unexpanded value, we can avoid the problem of having
          to quote some of the variable references in our macros.</p><p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªå‡½æ•°ä¸èƒ½ä¸Žå®ä¸€èµ·ä½¿ç”¨<code class="function">program-variables</code>ã€‚é‚£æ˜¯å› ä¸º
          <code class="function">value</code>æ˜¯ä¸€ä¸ªå…¨æœ‰æˆ–å…¨æ— çš„å‡½æ•°ã€‚å¦‚æžœä½¿ç”¨ï¼Œ<code class="function">value</code>å°†ä¸ä¼šæ‰©å±•å®ä¸­çš„<span class="emphasis"><em>ä»»ä½•</em></span>å˜é‡ã€‚æ­¤å¤–ï¼Œ<code class="function">value</code>ä¸æŽ¥å—å‚æ•°ï¼ˆå¦‚æžœæŽ¥å—ï¼Œä¹Ÿä¸ä¼šå¯¹å…¶æ‰§è¡Œä»»ä½•æ“ä½œï¼‰ï¼Œå› æ­¤æˆ‘ä»¬çš„ç¨‹åºåç§°å’Œæ–‡ä»¶åˆ—è¡¨å‚æ•°ä¸ä¼šæ‰©å±•ã€‚</p><p>Unfortunately, this function cannot be used with the <code class="function">program-variables</code> macro. That's because
          <code class="function">value</code> is an all-or-nothing
          function. If used, <code class="function">value</code> will
          not expand <span class="emphasis"><em>any</em></span> of the variables in the macro.
          Furthermore, <code class="function">value</code> doesn't
          accept parameters (and wouldn't do anything with them if it did) so
          our program name and file list parameters wouldn't be
          expanded.</p><p>ç”±äºŽè¿™äº›é™åˆ¶ï¼Œæ‚¨<code class="function">value</code>åœ¨æœ¬ä¹¦ä¸­ä¸ä¼šç»å¸¸çœ‹åˆ°å®ƒçš„ä½¿ç”¨ã€‚</p><p>Because of these limitations, you won't see <code class="function">value</code> used very often in this
          book.</p></div><div class="sect2" title="æŒ‚é’©å‡½æ•°"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch04s03.html.make3-CHP-4-SECT-3.2"></a>æŒ‚é’©å‡½æ•°</h2><h2 class="title"><a></a>Hooking Functions</h2></div></div></div><p>ç”¨æˆ·å®šä¹‰çš„å‡½æ•°åªæ˜¯<a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1293" class="indexterm"></a> <a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1294" class="indexterm"></a>ä¿å­˜æ–‡æœ¬çš„å˜é‡ã€‚è¯¥<code class="function">call</code>å‡½æ•°å°†æ‰©å±•å˜é‡æ–‡æœ¬ä¸­çš„ ã€ ç­‰å¼•ç”¨ï¼ˆå¦‚æžœå­˜åœ¨ï¼‰<code class="literal">$1</code>ã€‚<code class="literal">$2</code>å¦‚æžœå‡½æ•°ä¸åŒ…å«ä»»ä½•è¿™äº›å˜é‡å¼•ç”¨ï¼Œåˆ™<code class="function">call</code>ä¸åœ¨ä¹Žã€‚äº‹å®žä¸Šï¼Œå¦‚æžœå˜é‡ä¸åŒ…å«ä»»ä½•æ–‡æœ¬ï¼Œåˆ™<code class="function">call</code>ä¸åœ¨ä¹Žã€‚ä¸ä¼šå‡ºçŽ°é”™è¯¯æˆ–è­¦å‘Šã€‚å¦‚æžœæ‚¨ç¢°å·§æ‹¼é”™äº†å‡½æ•°åç§°ï¼Œè¿™å¯èƒ½ä¼šéžå¸¸ä»¤äººæ²®ä¸§ã€‚ä½†å®ƒä¹Ÿå¯èƒ½éžå¸¸æœ‰ç”¨ã€‚</p><p>User-defined functions are just <a class="indexterm"></a> <a class="indexterm"></a>variables holding text. The <code class="function">call</code> function will expand <code class="literal">$1</code>, <code class="literal">$2</code>,
          etc. references in the variable text if they exist. If the function
          doesn't contain any of these variable references, <code class="function">call</code> doesn't care. In fact, if the
          variable doesn't contain any text, <code class="function">call</code> doesn't care. No error or warning
          occurs. This can be very frustrating if you happen to misspell a
          function name. But it can also be very useful.</p><p>å‡½æ•°éƒ½æ˜¯å…³äºŽå¯é‡ç”¨ä»£ç çš„ã€‚å‡½æ•°é‡ç”¨çš„æ¬¡æ•°è¶Šå¤šï¼Œå°±è¶Šå€¼å¾—æŠŠå®ƒå†™å¥½ã€‚é€šè¿‡å‘å‡½æ•°æ·»åŠ <span class="emphasis"><em>é’©å­</em></span>å¯ä»¥ä½¿å‡½æ•°æ›´åŠ å¯é‡ç”¨
          ã€‚é’©å­æ˜¯ä¸€ä¸ªå‡½æ•°å¼•ç”¨<em class="firstterm">ï¼Œ</em>ç”¨æˆ·å¯ä»¥é‡æ–°å®šä¹‰å®ƒä»¥åœ¨æ ‡å‡†æ“ä½œæœŸé—´æ‰§è¡Œè‡ªå·±çš„è‡ªå®šä¹‰ä»»åŠ¡ã€‚</p><p>Functions are all about reusable code. The more often you
          reuse a function, the more worthwhile it is to write it well.
          Functions can be made more reusable by adding
          <span class="emphasis"><em>hooks</em></span> to them. A <em class="firstterm">hook</em> is
          a function reference that can be redefined by a user to perform
          their own custom tasks during a standard operation.</p><p>å‡è®¾æ‚¨æ­£åœ¨ makefile ä¸­æž„å»ºè®¸å¤š<em class="filename">åº“</em>ã€‚åœ¨æŸäº›ç³»ç»Ÿä¸Šï¼Œæ‚¨å¸Œæœ›è¿è¡Œ<em class="command">ranlib</em>ï¼Œè€Œåœ¨å…¶ä»–ç³»ç»Ÿä¸Šæ‚¨å¯èƒ½å¸Œæœ›è¿è¡Œ<em class="command">chmod</em>ã€‚æ‚¨å¯ä»¥é€‰æ‹©ç¼–å†™ä¸€ä¸ªå‡½æ•°å¹¶æ·»åŠ ä¸€ä¸ªé’©å­ï¼Œè€Œä¸æ˜¯ä¸ºè¿™äº›æ“ä½œç¼–å†™æ˜¾å¼å‘½ä»¤ï¼š</p><p>Suppose you are building many libraries in your <em class="filename">makefile</em>. On some systems, you'd like to
          run <em class="command">ranlib</em> and on others you
          might want to run <em class="command">chmod</em>. Rather
          than writing explicit commands for these operations, you might
          choose to write a function and add a hook:</p><a id="OEBPS/ch04s03.html.I_4_tt255"></a><pre class="programlisting"># $(è°ƒç”¨æž„å»ºåº“ï¼Œå¯¹è±¡æ–‡ä»¶)
å®šä¹‰æž„å»ºåº“
  $(AR) $(ARFLAGS) $@ $1
  $(è°ƒç”¨æž„å»ºåº“é’©å­ï¼Œ$@)
æ©å¾·å¤«</pre><pre class="programlisting"># $(call build-library, object-files)
define build-library
  $(AR) $(ARFLAGS) $@ $1
  $(call build-library-hook,$@)
endef</pre><p>è¦ä½¿ç”¨é’©å­ï¼Œè¯·å®šä¹‰å‡½æ•°<code class="function">build-library-hook</code>ï¼š</p><p>To use the hook, define the function <code class="function">build-library-hook</code>:</p><a id="OEBPS/ch04s03.html.I_4_tt256"></a><pre class="programlisting">$(foo_lib): æž„å»ºåº“é’©å­ = $(RANLIB) $1
$(foo_lib): $(foo_objects)
        $(è°ƒç”¨æž„å»ºåº“,$^)

$(bar_lib): æž„å»ºåº“é’©å­ = $(CHMOD) 444 $1
$(bar_lib): $(bar_objects)
        $(è°ƒç”¨æž„å»ºåº“,$^)</pre><pre class="programlisting">$(foo_lib): build-library-hook = $(RANLIB) $1
$(foo_lib): $(foo_objects)
        $(call build-library,$^)

$(bar_lib): build-library-hook = $(CHMOD) 444 $1
$(bar_lib): $(bar_objects)
        $(call build-library,$^)</pre></div><div class="sect2" title="ä¼ é€’å‚æ•°"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch04s03.html.make3-CHP-4-SECT-3.3"></a>ä¼ é€’å‚æ•°</h2><h2 class="title"><a></a>Passing Parameters</h2></div></div></div><p>ä¸€ä¸ªå‡½æ•°å¯ä»¥å¾—åˆ°å®ƒçš„<a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1295" class="indexterm"></a> <a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1296" class="indexterm"></a> <a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1297" class="indexterm"></a>æ¥è‡ªå››ä¸ªâ€œæºâ€çš„æ•°æ®ï¼š using ä¼ å…¥çš„å‚æ•°
          <code class="function">call</code>ã€å…¨å±€å˜é‡ã€è‡ªåŠ¨å˜é‡å’Œç‰¹å®šäºŽç›®æ ‡çš„å˜é‡ã€‚å…¶ä¸­ï¼Œä¾èµ–å‚æ•°æ˜¯æœ€æ¨¡å—åŒ–çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒä»¬çš„ä½¿ç”¨ä½¿å‡½æ•°å…å—å…¨å±€æ•°æ®çš„ä»»ä½•æ›´æ”¹çš„å½±å“ï¼Œä½†æœ‰æ—¶è¿™ä¸æ˜¯æœ€é‡è¦çš„æ ‡å‡†ã€‚</p><p>A function can get its<a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> data from four "sources": parameters passed in using
          <code class="function">call</code>, global variables,
          automatic variables, and target-specific variables. Of these,
          relying on parameters is the most modular choice, since their use
          insulates the function from any changes to global data, but
          sometimes that isn't the most important criteria.</p><p>å‡è®¾æˆ‘ä»¬æœ‰å‡ ä¸ªä½¿ç”¨ä¸€ç»„é€šç”¨
          <em class="command">make</em>å‡½æ•°çš„é¡¹ç›®ã€‚æ¯ä¸ªé¡¹ç›®éƒ½å¯ä»¥é€šè¿‡å˜é‡å‰ç¼€ï¼ˆä¾‹å¦‚ ï¼‰æ¥æ ‡è¯†<code class="literal">PROJECT1_</code>ï¼Œå¹¶ä¸”é¡¹ç›®çš„å…³é”®å˜é‡éƒ½ä½¿ç”¨å¸¦æœ‰è·¨é¡¹ç›®åŽç¼€çš„å‰ç¼€ã€‚å‰é¢çš„ç¤ºä¾‹ ,<code class="literal">PROJECT_SRC</code>å¯èƒ½çœ‹èµ·æ¥åƒ<code class="literal">PROJECT1_SRC</code>, <code class="literal">PROJECT1_BIN</code>, å’Œ<code class="literal">PROJECT1_LIB</code>ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¡ç®—å˜é‡å¹¶ä¼ é€’å•ä¸ªå‚æ•°ï¼Œå³å‰ç¼€ï¼Œè€Œä¸æ˜¯ç¼–å†™éœ€è¦è¿™ä¸‰ä¸ªå˜é‡çš„å‡½æ•°ï¼š</p><p>Suppose we have several projects using a common set of
          <em class="command">make</em> functions. Each project
          might be identified by a variable prefix, say <code class="literal">PROJECT1_</code>, and critical variables for the
          project all use the prefix with cross-project suffixes. The earlier
          example, <code class="literal">PROJECT_SRC</code>, might look
          like <code class="literal">PROJECT1_SRC</code>, <code class="literal">PROJECT1_BIN</code>, and <code class="literal">PROJECT1_LIB</code>. Rather than write a function
          that requires these three variables we could instead use computed
          variables and pass a single argument, the prefix:</p><a id="OEBPS/ch04s03.html.I_4_tt257"></a><pre class="programlisting"># $(è°ƒç”¨æµç¨‹-xml,é¡¹ç›®å‰ç¼€,æ–‡ä»¶å)
å®šä¹‰æµç¨‹-xml
  $($1_LIB)/xmlto -o $($1_BIN)/xml/$2 $($1_SRC)/xml/$2
æ©å¾·å¤«</pre><pre class="programlisting"># $(call process-xml,project-prefix,file-name)
define process-xml
  $($1_LIB)/xmlto -o $($1_BIN)/xml/$2 $($1_SRC)/xml/$2
endef</pre><p>ä¼ é€’å‚æ•°çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ç‰¹å®šäºŽç›®æ ‡çš„å˜é‡ã€‚å½“å¤§å¤šæ•°è°ƒç”¨ä½¿ç”¨æ ‡å‡†å€¼ä½†å°‘æ•°éœ€è¦ç‰¹æ®Šå¤„ç†æ—¶ï¼Œè¿™ç‰¹åˆ«æœ‰ç”¨ã€‚å½“è§„åˆ™åœ¨åŒ…å«æ–‡ä»¶ä¸­å®šä¹‰ä½†ä»Žå®šä¹‰å˜é‡çš„<em class="filename">makefileè°ƒç”¨æ—¶ï¼Œç‰¹å®šäºŽç›®æ ‡çš„å˜é‡è¿˜æä¾›äº†çµæ´»æ€§ã€‚</em></p><p>Another approach to passing arguments uses target-specific
          variables. This is particularly useful when most invocations use a
          standard value but a few require special processing. Target-specific
          variables also provide flexibility when the rule is defined in an
          include file, but invoked from a <em class="filename">makefile</em> where the variable is
          defined.</p><a id="OEBPS/ch04s03.html.I_4_tt258"></a><pre class="programlisting">å‘å¸ƒï¼šMAKING_RELEASE = 1
å‘å¸ƒï¼šåº“å¯æ‰§è¡Œæ–‡ä»¶
...
$(foo_lib):
        $(è°ƒç”¨æž„å»ºåº“,$^)
...
# $(è°ƒç”¨æž„å»ºåº“ï¼Œæ–‡ä»¶åˆ—è¡¨)
å®šä¹‰æž„å»ºåº“
  $(AR) $(ARFLAGS) $@ \
    $(å¦‚æžœ$(MAKING_RELEASE), \
      $(è¿‡æ»¤æŽ‰è°ƒè¯•/%,$1), \
      1 ç¾Žå…ƒï¼‰
æ©å¾·å¤«</pre><pre class="programlisting">release: MAKING_RELEASE = 1
release: libraries executables
...
$(foo_lib):
        $(call build-library,$^)
...
# $(call build-library, file-list)
define build-library
  $(AR) $(ARFLAGS) $@           \
    $(if $(MAKING_RELEASE),     \
      $(filter-out debug/%,$1), \
      $1)
endef</pre><p>æ­¤ä»£ç è®¾ç½®ä¸€ä¸ªç‰¹å®šäºŽç›®æ ‡çš„å˜é‡æ¥æŒ‡ç¤ºä½•æ—¶æ‰§è¡Œå‘å¸ƒç‰ˆæœ¬ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1298" class="indexterm"></a> <a id="OEBPS/ch04s03.html.make3-CHP-4-ITERM-1299" class="indexterm"></a>åº“æž„å»ºåŠŸèƒ½å°†ä»Žåº“ä¸­è¿‡æ»¤æŽ‰ä»»ä½•è°ƒè¯•æ¨¡å—ã€‚</p><p>This code sets a target-specific variable to indicate when a
          release build is being executed. In that case, the <a class="indexterm"></a> <a class="indexterm"></a>library-building
          function will filter out any debugging modules from the
          libraries.</p></div></div></div></div>
<div id="OEBPS/ch05.html"><div>
<div class="chapter" title="ç¬¬ 5 ç« å‘½ä»¤"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch05.html.make3-CHP-5"></a>ç¬¬ 5 ç« å‘½ä»¤</h1><h1 class="title"><a></a>Chapter&nbsp;5.&nbsp;Commands</h1></div></div></div><p><em class="command">æˆ‘ä»¬å·²ç»ä»‹ç»äº†make</em>å‘½ä»¤çš„è®¸å¤šåŸºæœ¬å…ƒç´ ï¼Œä½†ä¸ºäº†ç¡®ä¿æˆ‘ä»¬éƒ½åœ¨åŒä¸€é¡µé¢ä¸Šï¼Œè®©æˆ‘ä»¬å›žé¡¾ä¸€ä¸‹ã€‚</p><p>We've already covered many of the basic elements of <em class="command">make</em> commands, but just to make sure we're all
      on the same page, let's review a little.</p><p>å‘½ä»¤æœ¬è´¨ä¸Šæ˜¯ä¸€è¡Œ shell è„šæœ¬ã€‚å®žé™…ä¸Šï¼Œ
       <em class="command">make</em>æŠ“å–æ¯ä¸€è¡Œå¹¶å°†å…¶ä¼ é€’ç»™å­ shell æ¥æ‰§è¡Œã€‚äº‹å®žä¸Šï¼Œå¦‚æžœ<em class="command">make</em>èƒ½å¤Ÿä¿è¯çœç•¥ shell ä¸ä¼šæ”¹å˜ç¨‹åºçš„è¡Œä¸ºï¼Œå®ƒå°±å¯ä»¥ä¼˜åŒ–è¿™ç§ï¼ˆç›¸å¯¹ï¼‰æ˜‚è´µçš„ fork/exec ç®—æ³•ã€‚å®ƒé€šè¿‡æ‰«ææ¯ä¸ªå‘½ä»¤è¡Œä¸­çš„ shell ç‰¹æ®Šå­—ç¬¦ï¼ˆä¾‹å¦‚é€šé…ç¬¦å’Œ I/O é‡å®šå‘ï¼‰æ¥æ£€æŸ¥è¿™ä¸€ç‚¹ã€‚å¦‚æžœæ²¡æœ‰æ‰¾åˆ°ï¼Œ<em class="command">åˆ™ make</em>ç›´æŽ¥æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œè€Œä¸å°†å…¶ä¼ é€’ç»™å­ shellã€‚</p><p>Commands are essentially one-line shell scripts. In effect,
      <em class="command">make</em> grabs each line and passes it to
      a subshell for execution. In fact, <em class="command">make</em> can optimize this (relatively) expensive
      fork/exec algorithm if it can guarantee that omitting the shell will not
      change the behavior of the program. It checks this by scanning each
      command line for shell special characters, such as wildcard characters
      and i/o redirection. If none are found, <em class="command">make</em> directly executes the command without
      passing it to a subshell.</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<em class="filename">/bin/sh</em>ç”¨äºŽ shellã€‚è¯¥ shell ç”±<em class="command">make</em>å˜é‡æŽ§åˆ¶<code class="literal">SHELL</code>ï¼Œä½†å®ƒä¸æ˜¯ä»ŽçŽ¯å¢ƒç»§æ‰¿çš„ã€‚å½“<em class="command">make</em>å¯åŠ¨æ—¶ï¼Œå®ƒä»Žç”¨æˆ·çŽ¯å¢ƒä¸­å¯¼å…¥æ‰€æœ‰å˜é‡ä½œä¸º<em class="command">make</em>å˜é‡ï¼Œé™¤äº†<code class="literal">SHELL</code>ã€‚è¿™æ˜¯å› ä¸ºç”¨æˆ·å¯¹ shell çš„é€‰æ‹©ä¸åº”å¯¼è‡´<em class="filename">makefile</em> 
      ï¼ˆå¯èƒ½åŒ…å«åœ¨æŸäº›ä¸‹è½½çš„è½¯ä»¶åŒ…ä¸­ï¼‰å¤±è´¥ã€‚å¦‚æžœç”¨æˆ·ç¡®å®žæƒ³è¦æ›´æ”¹<em class="command">make</em><code class="literal">SHELL</code>ä½¿ç”¨çš„é»˜è®¤ shellï¼Œä»–å¯ä»¥åœ¨<em class="filename">makefile</em>ä¸­æ˜¾å¼è®¾ç½®è¯¥å˜é‡ã€‚æˆ‘ä»¬å°†åœ¨
      æœ¬ç« åŽé¢çš„<a class="link" href="#OEBPS/ch05s02.html" title="ä½¿ç”¨å“ªä¸ªå¤–å£³">5.2 èŠ‚ä¸­è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚</a></p><p>By default, <em class="filename">/bin/sh</em> is used
      for the shell. This shell is controlled by the <em class="command">make</em> variable <code class="literal">SHELL</code> but it is not inherited from the
      environment. When <em class="command">make</em> starts, it
      imports all the variables from the user's environment as <em class="command">make</em> variables, except <code class="literal">SHELL</code>. This is because the user's choice of
      shell should not cause a <em class="filename">makefile</em>
      (possibly included in some downloaded software package) to fail. If a
      user really wants to change the default shell used by <em class="command">make</em>, he can set the <code class="literal">SHELL</code> variable explicitly in the <em class="filename">makefile</em>. We will discuss this issue in the
      <a class="link" href="#OEBPS/ch05s02.html" title="Which Shell to Use">Section 5.2</a> later in this
      chapter.</p><div class="sect1" title="è§£æžå‘½ä»¤"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch05.html.make3-CHP-5-SECT-1"></a>è§£æžå‘½ä»¤</h1><h1 class="title"><a></a>Parsing Commands</h1></div></div></div><p>éµå¾ª<em class="command">make</em>ç›®æ ‡ï¼Œè¡Œ<a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1300" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1301" class="indexterm"></a>ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯åˆ¶è¡¨ç¬¦çš„å­—ç¬¦è¢«å‡å®šä¸ºå‘½ä»¤ï¼ˆé™¤éžå‰ä¸€è¡Œä»¥åæ–œæ ç»§ç»­ï¼‰ã€‚
         <acronym class="acronym">GNU </acronym> <em class="command">make</em>åœ¨å¤„ç†å…¶ä»–ä¸Šä¸‹æ–‡ä¸­çš„é€‰é¡¹å¡æ—¶å°è¯•å°½å¯èƒ½æ™ºèƒ½ã€‚ä¾‹å¦‚ï¼Œå½“ä¸å­˜åœ¨æ­§ä¹‰æ—¶ï¼Œæ³¨é‡Šã€å˜é‡èµ‹å€¼å’ŒåŒ…å«æŒ‡ä»¤éƒ½å¯ä»¥ä½¿ç”¨åˆ¶è¡¨ç¬¦ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚å¦‚æžœ<em class="command">make</em>è¯»å–çš„å‘½ä»¤è¡Œæ²¡æœ‰ç´§è·Ÿç›®æ ‡ï¼Œåˆ™ä¼šæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼š</p><p>Following a <em class="command">make</em> target,
        lines <a class="indexterm"></a> <a class="indexterm"></a>whose first character is a tab are assumed to be
        commands (unless the previous line was continued with a backslash).
        <acronym class="acronym">GNU</acronym> <em class="command">make</em> tries
        to be as smart as possible when handling tabs in other contexts. For
        instance, when there is no possible ambiguity, comments, variable
        assignments, and include directives may all use a tab as their first
        character. If <em class="command">make</em> reads a command
        line that does not immediately follow a target, an error message is
        displayed:</p><a id="OEBPS/ch05.html.I_5_tt259"></a><pre class="programlisting">makefile:20: *** å‘½ä»¤åœ¨ç¬¬ä¸€ä¸ªç›®æ ‡ä¹‹å‰å¼€å§‹ã€‚åœæ­¢ã€‚</pre><pre class="programlisting">makefile:20: *** commands commence before first target.  Stop.</pre><p>è¯¥æ¶ˆæ¯çš„æŽªè¾žæœ‰ç‚¹å¥‡æ€ªï¼Œå› ä¸ºå®ƒç»å¸¸å‡ºçŽ°åœ¨æŒ‡å®šâ€œç¬¬ä¸€ä¸ªâ€ç›®æ ‡ä¹‹åŽå¾ˆä¹…çš„<em class="filename">makefile</em>ä¸­é—´ï¼Œä½†æˆ‘ä»¬çŽ°åœ¨å¯ä»¥è½»æ¾ç†è§£å®ƒã€‚æ­¤æ¶ˆæ¯çš„æ›´å¥½æŽªè¾žå¯èƒ½æ˜¯â€œåœ¨ç›®æ ‡ä¸Šä¸‹æ–‡ä¹‹å¤–é‡åˆ°å‘½ä»¤â€ã€‚</p><p>The wording of this message is a bit odd because it often occurs
        in the middle of a <em class="filename">makefile</em> long
        after the "first" target was specified, but we can now understand it
        without too much trouble. A better wording for this message might be,
        "encountered a command outside the context of a target."</p><p>å½“è§£æžå™¨åœ¨åˆæ³•ä¸Šä¸‹æ–‡ä¸­çœ‹åˆ°å‘½ä»¤æ—¶ï¼Œå®ƒä¼šåˆ‡æ¢åˆ°â€œå‘½ä»¤è§£æžâ€æ¨¡å¼ï¼Œä¸€æ¬¡æž„å»ºä¸€è¡Œè„šæœ¬ã€‚å½“é‡åˆ°ä¸å¯èƒ½æ˜¯ä¸€éƒ¨åˆ†çš„è¡Œæ—¶ï¼Œå®ƒä¼šåœæ­¢é™„åŠ åˆ°è„šæœ¬<a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1302" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1303" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1304" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1305" class="indexterm"></a>å‘½ä»¤è„šæœ¬çš„ã€‚è„šæœ¬åˆ°æ­¤ç»“æŸã€‚å‘½ä»¤è„šæœ¬ä¸­å¯èƒ½ä¼šå‡ºçŽ°ä»¥ä¸‹å†…å®¹ï¼š</p><p>When the parser sees a command in a legal context, it switches
        to "command parsing" mode, building the script one line at a time. It
        stops appending to the script when it encounters a line that cannot
        possibly be part<a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> of the command script. There the script ends. The
        following may appear in a command script:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>ä»¥åˆ¶è¡¨ç¬¦å¼€å¤´çš„è¡Œæ˜¯å°†ç”±å­ shell æ‰§è¡Œçš„å‘½ä»¤ã€‚å³ä½¿æ˜¯é€šå¸¸è¢«è§£é‡Šä¸º<em class="command">make</em>ç»“æž„çš„è¡Œï¼ˆä¾‹å¦‚ï¼Œ<code class="literal">ifdef</code>æ³¨é‡Šã€
            <code class="literal">include</code>æŒ‡ä»¤ï¼‰åœ¨â€œå‘½ä»¤è§£æžâ€æ¨¡å¼ä¸‹ä¹Ÿä¼šè¢«è§†ä¸ºå‘½ä»¤ã€‚</p></li><li class="listitem"><p>Lines beginning with a tab character are commands that will
            be executed by a subshell. Even lines that would normally be
            interpreted as <em class="command">make</em> constructs
            (e.g., <code class="literal">ifdef</code>, comments,
            <code class="literal">include</code> directives) are treated
            as commands while in "command parsing" mode.</p></li><li class="listitem"><p>ç©ºè¡Œå°†è¢«å¿½ç•¥ã€‚å®ƒä»¬ä¸æ˜¯ç”±å­ shellâ€œæ‰§è¡Œâ€çš„ã€‚</p></li><li class="listitem"><p>Blank lines are ignored. They are not "executed" by a
            subshell.</p></li><li class="listitem"><p>ä»¥ a å¼€å¤´çš„è¡Œ<code class="literal">#</code>ï¼ˆå¯èƒ½å¸¦æœ‰å‰å¯¼ç©ºæ ¼ï¼ˆä¸æ˜¯åˆ¶è¡¨ç¬¦ï¼ï¼‰ï¼‰æ˜¯<em class="filename">makefile</em>æ³¨é‡Šï¼Œä¼šè¢«å¿½ç•¥ã€‚</p></li><li class="listitem"><p>Lines beginning with a <code class="literal">#</code>,
            possibly with leading spaces (not tabs!), are <em class="filename">makefile</em> comments and are
            ignored.</p></li><li class="listitem"><p>æ¡ä»¶å¤„ç†æŒ‡ä»¤ï¼ˆä¾‹å¦‚<code class="literal">ifdef</code>å’Œ<code class="literal">ifeq</code>ï¼‰åœ¨å‘½ä»¤è„šæœ¬ä¸­æ­£å¸¸è¯†åˆ«å’Œå¤„ç†ã€‚</p></li><li class="listitem"><p>Conditional processing directives, such as <code class="literal">ifdef</code> and <code class="literal">ifeq</code>, are recognized and processed
            normally within command scripts.</p></li></ul></div><p>é™¤éžå‰é¢æœ‰åˆ¶è¡¨ç¬¦ï¼Œå¦åˆ™å†…ç½®<em class="command">make</em>å‡½æ•°ä¼šç»ˆæ­¢å‘½ä»¤è§£æžæ¨¡å¼ã€‚è¿™æ„å‘³ç€å®ƒä»¬å¿…é¡»æ‰©å±•ä¸ºæœ‰æ•ˆçš„ shell å‘½ä»¤ï¼Œæˆ–è€…æ‰©å±•ä¸ºç©ºã€‚å‡½æ•°<code class="function">warning</code>å¹¶<code class="function">eval</code>æ‰©å±•ä¸ºæ— å­—ç¬¦ã€‚</p><p>Built-in <em class="command">make</em> functions
        terminate command parsing mode unless preceded by a tab character.
        This means they must expand to valid shell commands or to nothing. The
        functions <code class="function">warning</code> and <code class="function">eval</code> expand to no characters.</p><p><em class="command">å‘½ä»¤è„šæœ¬ä¸­å…è®¸ç©ºè¡Œå’Œæ³¨é‡Šçš„</em>äº‹å®žä¸€å¼€å§‹å¯èƒ½ä¼šä»¤äººæƒŠè®¶ã€‚ä»¥ä¸‹å‡ è¡Œæ˜¾ç¤ºäº†å®ƒæ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼š</p><p>The fact that blank lines and <em class="command">make</em> comments are allowed in command scripts
        can be surprising at first. The following lines show how it is carried
        out:</p><a id="OEBPS/ch05.html.I_5_tt260"></a><pre class="programlisting">é•¿å‘½ä»¤ï¼š
        @echo Line 2ï¼šåŽé¢æ˜¯ä¸€ä¸ªç©ºè¡Œ

        @echo ç¬¬ 4 è¡Œï¼šshell æ³¨é‡Šå¦‚ä¸‹
        # shell æ³¨é‡Šï¼ˆå‰å¯¼é€‰é¡¹å¡ï¼‰
        @echo ç¬¬ 6 è¡Œï¼šä¸‹é¢æ˜¯ä¸€æ¡æ³¨é‡Š
# æ³¨é‡Šï¼Œåœ¨è¡Œé¦–
        @echo ç¬¬ 8 è¡Œï¼šç¼©è¿›æ³¨é‡Šå¦‚ä¸‹
  # ä¸€æ¡æ³¨é‡Šï¼Œå‰å¯¼ç©ºæ ¼ç¼©è¿›
        # å¦ä¸€ä¸ªæ³¨é‡Šï¼Œç”¨å‰å¯¼ç©ºæ ¼ç¼©è¿›
        @echo ç¬¬ 11 è¡Œï¼šåŽé¢æ˜¯æ¡ä»¶è¯­å¥
    ifdef è®¡ç®—æœºè§„èŒƒ
        @echo è¿è¡Œ Windows
    ä¸‡ä¸€
        @echo ç¬¬ 15 è¡Œï¼šéšåŽæ˜¯è­¦å‘Šâ€œå‘½ä»¤â€
        $(è­¦å‘Šè­¦å‘Š)
        @echo ç¬¬ 17 è¡Œï¼ševalâ€œå‘½ä»¤â€å¦‚ä¸‹
        $(eval $(shell echo Shell echo 1&gt;&amp;2))</pre><pre class="programlisting">long-command:
        @echo Line 2: A blank line follows

        @echo Line 4: A shell comment follows
        # A shell comment (leading tab)
        @echo Line 6: A make comment follows
# A make comment, at the beginning of a line
        @echo Line 8: Indented make comments follow
  # A make comment, indented with leading spaces
        # Another make comment, indented with leading spaces
        @echo Line 11: A conditional follows
    ifdef COMSPEC
        @echo Running Windows
    endif
        @echo Line 15: A warning "command" follows
        $(warning A warning)
        @echo Line 17: An eval "command" follows
        $(eval $(shell echo Shell echo 1&gt;&amp;2))</pre><p>è¯·æ³¨æ„ï¼Œç¬¬ 5 è¡Œå’Œç¬¬ 10 è¡Œçœ‹èµ·æ¥ç›¸åŒï¼Œä½†æœ‰å¾ˆå¤§ä¸åŒã€‚ç¬¬ 5 è¡Œæ˜¯ shell æ³¨é‡Šï¼Œç”±å‰å¯¼åˆ¶è¡¨ç¬¦æŒ‡ç¤ºï¼Œè€Œç¬¬ 10 è¡Œæ˜¯ç¼©è¿› 8 ä¸ªç©ºæ ¼çš„<em class="command">make</em>æ³¨é‡Šã€‚æ˜¾ç„¶ï¼Œæˆ‘ä»¬ä¸å»ºè®®ä»¥
        è¿™ç§æ–¹å¼æ ¼å¼åŒ–<em class="command">makeæ³¨é‡Šï¼ˆé™¤éžæ‚¨æ‰“ç®—å‚åŠ æ··æ·†çš„</em><em class="filename">makefile</em>ç«žèµ›ï¼‰ã€‚æ­£å¦‚æ‚¨åœ¨ä»¥ä¸‹è¾“å‡ºä¸­çœ‹åˆ°çš„ï¼Œå³ä½¿æ³¨é‡Šå‡ºçŽ°åœ¨å‘½ä»¤è„šæœ¬çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œ<em class="command">make</em>æ³¨é‡Šï¼Œä¹Ÿä¸ä¼šå›žæ˜¾åˆ°è¾“å‡ºï¼š</p><p>Notice that lines 5 and 10 appear identical, but are quite
        different. Line 5 is a shell comment, indicated by a leading tab,
        while line 10 is a <em class="command">make</em> comment
        indented eight spaces. Obviously, we do not recommend formatting
        <em class="command">make</em> comments this way (unless you
        intend entering an obfuscated <em class="filename">makefile</em> contest). As you can see in the
        following output, <em class="command">make</em> comments are
        not executed and are not echoed to the output even though they occur
        within the context of a command script:</p><a id="OEBPS/ch05.html.I_5_tt261"></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
makefile:2ï¼šè­¦å‘Š
è´å£³å›žå£°
ç¬¬ 2 è¡Œï¼šåŽé¢æ˜¯ä¸€ä¸ªç©ºè¡Œ
ç¬¬ 4 è¡Œï¼šshell æ³¨é‡Šå¦‚ä¸‹
# shell æ³¨é‡Šï¼ˆå‰å¯¼é€‰é¡¹å¡ï¼‰
ç¬¬ 6 è¡Œï¼šåŽé¢æ˜¯ make æ³¨é‡Š
ç¬¬ 8 è¡Œï¼šç¼©è¿›ï¼Œåœ¨åŽé¢æ·»åŠ æ³¨é‡Š
ç¬¬ 11 è¡Œï¼šåŽé¢æ˜¯æ¡ä»¶è¯­å¥
è¿è¡ŒWindows
ç¬¬ 15 è¡Œï¼šéšåŽæ˜¯è­¦å‘Šå‘½ä»¤
ç¬¬ 17 è¡Œï¼ševal å‘½ä»¤å¦‚ä¸‹</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
makefile:2: A warning
Shell echo
Line 2: A blank line follows
Line 4: A shell comment follows
# A shell comment (leading tab)
Line 6: A make comment follows
Line 8: Indented make comments follow
Line 11: A conditional follows
Running Windows
Line 15: A warning command follows
Line 17: An eval command follows</pre><p><code class="function">warning</code>
        å’Œå‡½æ•°çš„è¾“å‡º<code class="function">eval</code>ä¼¼ä¹Žæ˜¯æ— åºçš„ï¼Œä½†ä¸ç”¨æ‹…å¿ƒï¼Œäº‹å®žå¹¶éžå¦‚æ­¤ã€‚ ï¼ˆæˆ‘ä»¬å°†åœ¨æœ¬ç« åŽé¢çš„<a class="link" href="#OEBPS/ch05s05.html" title="è¯„ä¼°å‘½ä»¤">ç¬¬ 5.5 èŠ‚</a>ä¸­è®¨è®ºæ±‚å€¼çš„é¡ºåºã€‚ï¼‰å‘½ä»¤è„šæœ¬å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„ç©ºè¡Œå’Œæ³¨é‡Šï¼Œè¿™ä¸€äº‹å®žå¯èƒ½ä¼šæˆä¸ºä»¤äººæ²®ä¸§çš„é”™è¯¯æ¥æºã€‚å‡è®¾æ‚¨ä¸å°å¿ƒå¼•å…¥äº†å¸¦æœ‰å‰å¯¼åˆ¶è¡¨ç¬¦çš„è¡Œã€‚å¦‚æžœå…ˆå‰çš„ç›®æ ‡ï¼ˆå¸¦æˆ–ä¸å¸¦å‘½ä»¤ï¼‰å­˜åœ¨ï¼Œå¹¶ä¸”ä¸­é—´åªæœ‰æ³¨é‡Šæˆ–ç©ºè¡Œï¼Œåˆ™<em class="command">make</em>ä¼šå°†æ„å¤–çš„é€‰é¡¹å¡è¡Œè§†ä¸ºä¸Žå…ˆå‰ç›®æ ‡å…³è”çš„å‘½ä»¤ã€‚æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œè¿™æ˜¯å®Œå…¨åˆæ³•çš„ï¼Œå¹¶ä¸”ä¸ä¼šç”Ÿæˆè­¦å‘Šæˆ–é”™è¯¯ï¼Œé™¤éžåŒä¸€ç›®æ ‡åœ¨<em class="filename">makefile</em>ï¼ˆæˆ–å…¶åŒ…å«æ–‡ä»¶ä¹‹ä¸€ï¼‰ä¸­çš„å…¶ä»–ä½ç½®æœ‰è§„åˆ™ã€‚</p><p>The output of the <code class="function">warning</code>
        and <code class="function">eval</code> functions appears to be
        out of order, but don't worry, it isn't. (We'll discuss the order of
        evaluation later this chapter in <a class="link" href="#OEBPS/ch05s05.html" title="Evaluating Commands">Section 5.5</a>.) The fact that
        command scripts can contain any number of blank lines and comments can
        be a frustrating source of errors. Suppose you accidentally introduce
        a line with a leading tab. If a previous target (with or without
        commands) exists and you have only comments or blank lines
        intervening, <em class="command">make</em> will treat your
        accidental tabbed line as a command associated with the preceding
        target. As you've seen, this is perfectly legal and will not generate
        a warning or error unless the same target has a rule somewhere else in
        the <em class="filename">makefile</em> (or one of its
        include files).</p><p>å¦‚æžœå¹¸è¿çš„è¯ï¼Œæ‚¨çš„<em class="filename">makefile</em>å°†åœ¨æ„å¤–çš„åˆ¶è¡¨ç¬¦è¡Œå’Œä¸Šä¸€ä¸ªå‘½ä»¤è„šæœ¬ä¹‹é—´åŒ…å«ä¸€ä¸ªéžç©ºç™½ã€éžæ³¨é‡Šã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å°†æ”¶åˆ°â€œå‘½ä»¤åœ¨ç¬¬ä¸€ä¸ªç›®æ ‡ä¹‹å‰å¼€å§‹â€æ¶ˆæ¯ã€‚</p><p>If you're lucky, your <em class="filename">makefile</em> will include a nonblank,
        noncomment between your accidental tabbed line and the previous
        command script. In that case, you'll get the "commands commence before
        first target" message.</p><p>çŽ°åœ¨æ˜¯ç®€è¦æåŠè½¯ä»¶å·¥å…·çš„å¥½æ—¶æœºã€‚æˆ‘æƒ³çŽ°åœ¨æ¯ä¸ªäººéƒ½åŒæ„ï¼Œä½¿ç”¨å‰å¯¼é€‰é¡¹å¡æ¥æŒ‡ç¤ºå‘½ä»¤è¡Œæ˜¯ä¸€ä¸ªä¸å¹¸çš„å†³å®šï¼Œä½†çŽ°åœ¨æ”¹å˜æœ‰ç‚¹æ™šäº†ã€‚ç”¨ä¸€ä¸ª<a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1306" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1307" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1308" class="indexterm"></a>çŽ°ä»£çš„è¯­æ³•æ„ŸçŸ¥ç¼–è¾‘å™¨å¯ä»¥é€šè¿‡æ˜Žæ˜¾æ ‡è®°å¯ç–‘çš„ç»“æž„æ¥å¸®åŠ©é¿å…æ½œåœ¨çš„é—®é¢˜ã€‚<acronym class="acronym">GNU </acronym>
        <em class="command">emacs</em>æœ‰ä¸€ä¸ªéžå¸¸å¥½çš„ç¼–è¾‘<em class="filename">makefile çš„</em>æ¨¡å¼ã€‚æ­¤æ¨¡å¼æ‰§è¡Œè¯­æ³•çªå‡ºæ˜¾ç¤ºå¹¶æŸ¥æ‰¾ç®€å•çš„è¯­æ³•é”™è¯¯ï¼Œä¾‹å¦‚è¿žç»­è¡ŒåŽé¢çš„ç©ºæ ¼ä»¥åŠæ··åˆå‰å¯¼ç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦ã€‚ç¨åŽæˆ‘å°†è¯¦ç»†è®¨è®ºå¦‚ä½•ä½¿ç”¨<em class="command">emacs</em>å’Œ<em class="command">make ã€‚</em></p><p>Now is a good time to briefly mention software tools. I think
        everyone agrees, now, that using a leading tab to indicate a command
        line was an unfortunate decision, but it's a little late to change.
        Using a <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>modern, syntax-aware editor can help head off potential
        problems by visibly marking dubious constructs. <acronym class="acronym">GNU</acronym>
        <em class="command">emacs</em> has a very nice mode for
        editing <em class="filename">makefile</em>s. This mode
        performs syntax highlighting and looks for simple syntactic errors,
        such as spaces after continuation lines and mixing leading spaces and
        tabs. I'll talk more about using <em class="command">emacs</em> and <em class="command">make</em> later on.</p><div class="sect2" title="è¿žç»­é•¿å‘½ä»¤"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch05.html.make3-CHP-5-SECT-1.1"></a>è¿žç»­é•¿å‘½ä»¤</h2><h2 class="title"><a></a>Continuing Long Commands</h2></div></div></div><p>ç”±äºŽæ¯ä¸ªå‘½ä»¤éƒ½è¢«æ‰§è¡Œ<a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1309" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1310" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1311" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1312" class="indexterm"></a>åœ¨å®ƒè‡ªå·±çš„ shell ä¸­ï¼ˆæˆ–è€…è‡³å°‘
          <span class="emphasis"><em>çœ‹èµ·æ¥</em></span>æ˜¯ï¼‰ï¼Œéœ€è¦ä¸€èµ·è¿è¡Œçš„ shell å‘½ä»¤åºåˆ—å¿…é¡»è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘éœ€è¦ç”Ÿæˆä¸€ä¸ªåŒ…å«æ–‡ä»¶åˆ—è¡¨çš„æ–‡ä»¶ã€‚ Javaç¼–è¯‘å™¨æŽ¥å—è¿™æ ·çš„æ–‡ä»¶æ¥ç¼–è¯‘è®¸å¤šæºæ–‡ä»¶ã€‚æˆ‘å¯èƒ½ä¼šå†™ä¸€ä¸ªè¿™æ ·çš„å‘½ä»¤è„šæœ¬ï¼š</p><p>Since each command is executed <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>in its own shell (or at least
          <span class="emphasis"><em>appears</em></span> to be), sequences of shell commands
          that need to be run together must be handled specially. For
          instance, suppose I need to generate a file containing a list of
          files. The Java compiler accepts such a file for compiling many
          source files. I might write a command script like this:</p><a id="OEBPS/ch05.html.I_5_tt262"></a><pre class="programlisting">.INTERMEDIATEï¼šæ–‡ä»¶åˆ—è¡¨
æ–‡ä»¶åˆ—è¡¨ï¼š
        for d åœ¨é€»è¾‘ ui ä¸­
        åš
          å›žæ˜¾$d/*.java
        å®Œæˆ &gt; $@</pre><pre class="programlisting">.INTERMEDIATE: file_list
file_list:
        for d in logic ui
        do
          echo $d/*.java
        done &gt; $@</pre><p>çŽ°åœ¨åº”è¯¥å¾ˆæ¸…æ¥šè¿™æ˜¯è¡Œä¸é€šçš„ã€‚å®ƒä¼šç”Ÿæˆé”™è¯¯ï¼š</p><p>By now it should be clear that this won't work. It generates
          the error:</p><a id="OEBPS/ch05.html.I_5_tt263"></a><pre class="programlisting">$ åˆ¶ä½œ
for d åœ¨é€»è¾‘ ui ä¸­
/bin/sh: -c: ç¬¬ 2 è¡Œï¼šè¯­æ³•é”™è¯¯ï¼šæ„å¤–çš„æ–‡ä»¶ç»“å°¾
make: *** [æ–‡ä»¶åˆ—è¡¨] é”™è¯¯ 2</pre><pre class="programlisting">$ make
for d in logic ui
/bin/sh: -c: line 2: syntax error: unexpected end of file
make: *** [file_list] Error 2</pre><p>æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªä¿®å¤æ˜¯å‘æ¯è¡Œæ·»åŠ è¿žç»­å­—ç¬¦ï¼š</p><p>Our first fix is to add continuation characters to each
          line:</p><a id="OEBPS/ch05.html.I_5_tt264"></a><pre class="programlisting">.INTERMEDIATEï¼šæ–‡ä»¶åˆ—è¡¨
æ–‡ä»¶åˆ—è¡¨ï¼š
        å¯¹äºŽé€»è¾‘ ui ä¸­çš„ d \
        åš \
          å›žæ˜¾ $d/*.java \
        å®Œæˆ &gt; $@</pre><pre class="programlisting">.INTERMEDIATE: file_list
file_list:
        for d in logic ui       \
        do                      \
          echo $d/*.java        \
        done &gt; $@</pre><p>è¿™ä¼šäº§ç”Ÿé”™è¯¯ï¼š</p><p>which generates the error:</p><a id="OEBPS/ch05.html.I_5_tt265"></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
å¯¹äºŽé€»è¾‘ ui ä¸­çš„ d \
åš \
  å›žå£°/*.java \
å®Œæˆ &gt; æ–‡ä»¶åˆ—è¡¨
/bin/sh: -c: ç¬¬ 1 è¡Œï¼šæ„å¤–æ ‡è®°â€œ&gt;â€é™„è¿‘å‡ºçŽ°è¯­æ³•é”™è¯¯
/bin/sh: -c: ç¬¬ 1 è¡Œï¼š`for d in é€»è¾‘ ui do echo /*.java   
make: *** [æ–‡ä»¶åˆ—è¡¨] é”™è¯¯ 2</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
for d in logic ui       \
do                      \
  echo /*.java  \
done &gt; file_list
/bin/sh: -c: line 1: syntax error near unexpected token `&gt;'
/bin/sh: -c: line 1: `for d in logic ui  do                      echo /*.java   
make: *** [file_list] Error 2</pre><p>å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿä¸¤ä¸ªé—®é¢˜ã€‚é¦–å…ˆï¼Œ<code class="literal">d</code>éœ€è¦è½¬ä¹‰å¯¹å¾ªçŽ¯æŽ§åˆ¶å˜é‡ çš„å¼•ç”¨ã€‚å…¶æ¬¡ï¼Œç”±äºŽ for å¾ªçŽ¯ä½œä¸ºå•è¡Œä¼ é€’åˆ°å­ shellï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»åœ¨æ–‡ä»¶åˆ—è¡¨å’Œ for å¾ªçŽ¯è¯­å¥ä¹‹åŽæ·»åŠ åˆ†å·åˆ†éš”ç¬¦ï¼š</p><p>What happened? Two problems. First, the reference to the loop
          control variable, <code class="literal">d</code>, needs to be
          escaped. Second, since the for loop is passed to the subshell as a
          single line, we must add semicolon separators after the file list
          and for-loop statement:</p><a id="OEBPS/ch05.html.I_5_tt266"></a><pre class="programlisting">.INTERMEDIATEï¼šæ–‡ä»¶åˆ—è¡¨
æ–‡ä»¶åˆ—è¡¨ï¼š
        å¯¹äºŽé€»è¾‘ ui ä¸­çš„ dï¼› \
        åš \
          å›žå£° $$d/*.java; \
        å®Œæˆ &gt; $@</pre><pre class="programlisting">.INTERMEDIATE: file_list
file_list:
        for d in logic ui;      \
        do                      \
          echo $$d/*.java;      \
        done &gt; $@</pre><p>çŽ°åœ¨æˆ‘ä»¬å¾—åˆ°äº†æˆ‘ä»¬æœŸæœ›çš„æ–‡ä»¶ã€‚å£°æ˜Žç›®æ ‡<code class="literal">.INTERMEDIATE</code>ï¼Œä»¥ä¾¿<em class="command">make</em>åœ¨ç¼–è¯‘å®ŒæˆåŽåˆ é™¤è¿™ä¸ªä¸´æ—¶ç›®æ ‡ã€‚</p><p>Now we get the file we expect. The target is declared <code class="literal">.INTERMEDIATE</code> so that <em class="command">make</em> will delete this temporary target
          after the compile is complete.</p><p>åœ¨æ›´å®žé™…çš„ç¤ºä¾‹ä¸­ï¼Œç›®å½•åˆ—è¡¨å°†å­˜å‚¨åœ¨<em class="command">make</em>å˜é‡ä¸­ã€‚å¦‚æžœæˆ‘ä»¬ç¡®å®šæ–‡ä»¶çš„æ•°é‡ç›¸å¯¹è¾ƒå°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<em class="command">make</em>å‡½æ•°æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œè€Œæ— éœ€ for å¾ªçŽ¯ï¼š</p><p>In a more realistic example, the list of directories would be
          stored in a <em class="command">make</em> variable. If we
          are sure that the number of files is relatively small, we can
          perform this same operation without a for loop by using <em class="command">make</em> functions:</p><a id="OEBPS/ch05.html.I_5_tt267"></a><pre class="programlisting">.INTERMEDIATEï¼šæ–‡ä»¶åˆ—è¡¨
æ–‡ä»¶åˆ—è¡¨ï¼š
        echo $(addsuffix /*.java,$(COMPILATION_DIRS)) &gt; $@</pre><pre class="programlisting">.INTERMEDIATE: file_list
file_list:
        echo $(addsuffix /*.java,$(COMPILATION_DIRS)) &gt; $@</pre><p>ä½†æ˜¯ï¼Œå¦‚æžœæˆ‘ä»¬æœŸæœ›ç›®å½•åˆ—è¡¨éšç€æ—¶é—´çš„æŽ¨ç§»è€Œå¢žé•¿ï¼Œåˆ™ for å¾ªçŽ¯ç‰ˆæœ¬ä¸å¤ªå¯èƒ½é‡åˆ°å‘½ä»¤è¡Œé•¿åº¦é—®é¢˜ã€‚</p><p>But the for-loop version is less likely to run up against
          command-line length issues if we expect the list of directories to
          grow with time.</p><p><em class="command">make</em>å‘½ä»¤è„šæœ¬ä¸­çš„å¦ä¸€ä¸ªå¸¸è§é—®é¢˜æ˜¯å¦‚ä½•åˆ‡æ¢ç›®å½•ã€‚åŒæ ·ï¼Œåº”è¯¥æ¸…æ¥šçš„æ˜¯ä¸€ä¸ªç®€å•çš„å‘½ä»¤è„šæœ¬ï¼Œä¾‹å¦‚ï¼š</p><p>Another common problem in <em class="command">make</em> command scripts is how to switch
          directories. Again, it should be clear that a simple command script
          like:</p><a id="OEBPS/ch05.html.I_5_tt268"></a><pre class="programlisting">æ ‡ç­¾ï¼š
        å…‰ç›˜æºæ–‡ä»¶
        ctags--é€’å½’</pre><pre class="programlisting">TAGS:
        cd src
        ctags --recurse</pre><p>ä¸ä¼šæ‰§è¡Œ<em class="filename">src</em>å­ç›®å½•
          ä¸­çš„<em class="command">ctags</em>ç¨‹åº
          ã€‚ä¸ºäº†èŽ·å¾—æˆ‘ä»¬æƒ³è¦çš„æ•ˆæžœï¼Œæˆ‘ä»¬å¿…é¡»å°†ä¸¤ä¸ªå‘½ä»¤æ”¾åœ¨ä¸€è¡Œä¸Šï¼Œæˆ–è€…ä½¿ç”¨åæ–œæ è½¬ä¹‰æ¢è¡Œç¬¦ï¼ˆå¹¶ä½¿ç”¨åˆ†å·åˆ†éš”å‘½ä»¤ï¼‰ï¼š<em class="filename"></em></p><p>will not execute the <em class="command">ctags</em>
          program in the <em class="filename">src</em>
          subdirectory. To get the effect we want, we must either place both
          commands on a single line or escape the newline with a backslash
          (and separate the commands with a semicolon):</p><a id="OEBPS/ch05.html.I_5_tt269"></a><pre class="programlisting">æ ‡ç­¾ï¼š
        cd æºæ–‡ä»¶ï¼› \
        ctags--é€’å½’</pre><pre class="programlisting">TAGS:
        cd src;           \
        ctags --recurse</pre><p>æ›´å¥½çš„ç‰ˆæœ¬ä¼šåœ¨æ‰§è¡Œ<em class="command">ctagsç¨‹åºä¹‹å‰æ£€æŸ¥</em><em class="command">cd</em>çš„çŠ¶æ€ï¼š<em class="command"></em></p><p>An even better version would check the status of the <em class="command">cd</em> before executing the <em class="command">ctags</em> program:</p><a id="OEBPS/ch05.html.I_5_tt270"></a><pre class="programlisting">æ ‡ç­¾ï¼š
        cd src &amp;&amp; \
        ctags--é€’å½’</pre><pre class="programlisting">TAGS:
        cd src &amp;&amp;           \
        ctags --recurse</pre><p>è¯·æ³¨æ„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œçœç•¥åˆ†å·å¯èƒ½ä¸ä¼šäº§ç”Ÿ<em class="command">make</em>æˆ– shell é”™è¯¯ï¼š</p><p>Notice that in some circumstances omitting the semicolon might
          not produce a <em class="command">make</em> or shell
          error:</p><a id="OEBPS/ch05.html.I_5_tt271"></a><pre class="programlisting">disk-free = echo "æ­£åœ¨æ£€æŸ¥å¯ç”¨ç£ç›˜ç©ºé—´..." \
            df ã€‚ | awk '{ æ‰“å° $$4 }'</pre><pre class="programlisting">disk-free = echo "Checking free disk space..." \
            df . | awk '{ print $$4 }'</pre><p>æ­¤ç¤ºä¾‹æ‰“å°ä¸€æ¡ç®€å•æ¶ˆæ¯ï¼ŒåŽè·Ÿå½“å‰è®¾å¤‡ä¸Šçš„ç©ºé—²å—æ•°ã€‚æˆ–è€…ç¡®å®žå¦‚æ­¤ï¼Ÿæˆ‘ä»¬ä¸å°å¿ƒçœç•¥äº†<em class="command">echo</em>å‘½ä»¤åŽé¢çš„åˆ†å·ï¼Œå› æ­¤æˆ‘ä»¬ä»ŽæœªçœŸæ­£è¿è¡Œ
          <em class="command">df</em>ç¨‹åºã€‚ç›¸åï¼Œæˆ‘ä»¬å›žå“ï¼š</p><p>This example prints a simple message followed by the number of
          free blocks on the current device. Or does it? We have accidentally
          omitted the semicolon after the <em class="command">echo</em> command, so we never actually run the
          <em class="command">df</em> program. Instead, we
          echo:</p><a id="OEBPS/ch05.html.I_5_tt272"></a><pre class="programlisting">æ£€æŸ¥å¯ç”¨ç£ç›˜ç©ºé—´... df ã€‚</pre><pre class="programlisting">Checking free disk space... df .</pre><p>è¿›å…¥<em class="command">awk</em>ä¸­ï¼Œå®ƒä¼šå°½èŒå°½è´£åœ°æ‰“å°ç¬¬å››ä¸ªå­—æ®µï¼Œ<code class="literal">space..</code>..</p><p>into <em class="command">awk</em> which dutifully
          prints the fourth field, <code class="literal">space..</code>..</p><p>æ‚¨å¯èƒ½ä¼šæƒ³åˆ°ä½¿ç”¨è¯¥<code class="literal">define</code>æŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤æ—¨åœ¨åˆ›å»ºå¤šè¡Œå‘½ä»¤åºåˆ—ï¼Œè€Œä¸æ˜¯è¿žç»­è¡Œã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™å¹¶ä¸æ˜¯åŒä¸€ä¸ªé—®é¢˜ã€‚å½“å±•å¼€å¤šè¡Œå®æ—¶ï¼Œæ¯ä¸€è¡Œéƒ½ä¼šæ’å…¥åˆ°å¸¦æœ‰å‰å¯¼åˆ¶è¡¨ç¬¦çš„å‘½ä»¤è„šæœ¬ä¸­ï¼Œå¹¶ä¸”<em class="command">make ä¼š</em>ç‹¬ç«‹å¤„ç†æ¯ä¸€è¡Œã€‚å®çš„å„è¡Œä¸åœ¨å•ä¸ªå­ shell ä¸­æ‰§è¡Œã€‚å› æ­¤ï¼Œæ‚¨è¿˜éœ€è¦æ³¨æ„å®ä¸­çš„å‘½ä»¤è¡Œå»¶ç»­ã€‚</p><p>It might have occurred to you to use the <code class="literal">define</code> directive, which is intended for
          creating multiline command sequences, rather than continuation
          lines. Unfortunately, this isn't quite the same problem. When a
          multiline macro is expanded, each line is inserted into the command
          script with a leading tab and <em class="command">make</em> treats each line independently. The
          lines of the macro are not executed in a single subshell. So you
          will need to pay attention to command-line continuation in macros as
          well.</p></div><div class="sect2" title="å‘½ä»¤ä¿®é¥°ç¬¦"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch05.html.make3-CHP-5-SECT-1.2"></a>å‘½ä»¤ä¿®é¥°ç¬¦</h2><h2 class="title"><a></a>Command Modifiers</h2></div></div></div><p>ä¸€ä¸ªå‘½ä»¤å¯ä»¥ç”±å¤šä¸ªå‰ç¼€ä¿®æ”¹ã€‚æˆ‘ä»¬ä¹‹å‰å·²ç»è§è¿‡<code class="literal">@</code>å¤šæ¬¡ä½¿ç”¨â€œsilentâ€å‰ç¼€ã€‚å®Œæ•´çš„å‰ç¼€åˆ—è¡¨ä»¥åŠä¸€äº›è¡€æ·‹æ·‹çš„ç»†èŠ‚æ˜¯ï¼š</p><p>A command can be modified by several prefixes. We've already
          seen the "silent" prefix, <code class="literal">@</code>, used
          many times before. The complete list of prefixes, along with some
          gory details, are:</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">@</code></span></dt><dt><span class="term"><code class="literal">@</code></span></dt><dd><p>ä¸å›žå£°<a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1313" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1314" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1315" class="indexterm"></a>å‘½ä»¤ã€‚ä¸ºäº†å®žçŽ°åŽ†å²å…¼å®¹æ€§ï¼Œ<code class="literal">.SILENT</code>å¦‚æžœæ‚¨å¸Œæœ›éšè—å…¶æ‰€æœ‰å‘½ä»¤ï¼Œåˆ™å¯ä»¥ä½¿æ‚¨çš„ç›®æ ‡æˆä¸ºç‰¹æ®Šç›®æ ‡çš„å…ˆå†³æ¡ä»¶
                ã€‚ä½†æ˜¯ï¼Œé¦–é€‰ä½¿ç”¨<code class="literal">@</code>ï¼Œå› ä¸ºå®ƒå¯ä»¥åº”ç”¨äºŽå‘½ä»¤è„šæœ¬ä¸­çš„å„ä¸ªå‘½ä»¤ã€‚å¦‚æžœä½ æƒ³å°†æ­¤ä¿®é¥°ç¬¦åº”ç”¨äºŽæ‰€æœ‰ç›®æ ‡ï¼ˆå°½ç®¡å¾ˆéš¾æƒ³è±¡ä¸ºä»€ä¹ˆï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨
                <code class="option">â€”silent</code>(æˆ–<code class="option">-s</code>) é€‰é¡¹ã€‚</p><p><em class="command">éšè—å‘½ä»¤å¯ä»¥ä½¿make</em>çš„è¾“å‡ºæ›´ç›´è§‚ï¼Œä½†ä¹Ÿä¼šä½¿å‘½ä»¤çš„è°ƒè¯•æ›´åŠ å›°éš¾ã€‚å¦‚æžœæ‚¨å‘çŽ°è‡ªå·±ç»å¸¸åˆ é™¤ä¿®é¥°ç¬¦å¹¶æ¢å¤å®ƒä»¬ï¼Œåˆ™å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ…å«ä¿®é¥°ç¬¦çš„<code class="literal">@</code>
                å˜é‡ï¼Œä¾‹å¦‚ï¼Œå¹¶åœ¨å‘½ä»¤ä¸­ä½¿ç”¨å®ƒï¼š<code class="literal">QUIET</code><code class="literal">@</code></p><a id="OEBPS/ch05.html.I_5_tt273"></a><pre class="programlisting">å®‰é™=@
æ¯›èŒ¸èŒ¸çš„è„šæœ¬ï¼š
        $(QUIET) å¤æ‚è„šæœ¬...</pre><p>ç„¶åŽï¼Œå¦‚æžœæ‚¨éœ€è¦åœ¨<em class="command">make</em>è¿è¡Œæ—¶æŸ¥çœ‹å¤æ‚çš„è„šæœ¬ï¼Œåªéœ€
                <code class="literal">QUIET</code>ä»Žå‘½ä»¤è¡Œé‡ç½®å˜é‡å³å¯ï¼š</p><a id="OEBPS/ch05.html.I_5_tt274"></a><pre class="programlisting">$ è®©å®‰é™= hairy_script
å¤æ‚çš„è„šæœ¬...</pre><div class="variablelist"><dl><dt><span class="term"><code class="literal">-</code></span></dt><dd><p>ç ´æŠ˜å·å‰ç¼€<a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1316" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1317" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1318" class="indexterm"></a>è¡¨æ˜Žé”™è¯¯åœ¨<a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1319" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1320" class="indexterm"></a>å‘½ä»¤åº”è¯¥è¢«<em class="command">make</em>å¿½ç•¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“
                      <em class="command">make</em>æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥ç¨‹åºæˆ–ç®¡é“çš„é€€å‡ºçŠ¶æ€ï¼Œå¦‚æžœè¿”å›žéžé›¶ï¼ˆå¤±è´¥ï¼‰é€€å‡ºçŠ¶æ€ï¼Œ<em class="command">make</em>
                      å°†ç»ˆæ­¢å‘½ä»¤è„šæœ¬å…¶ä½™éƒ¨åˆ†çš„æ‰§è¡Œå¹¶é€€å‡ºã€‚è¯¥ä¿®é¥°ç¬¦æŒ‡ç¤º<em class="command">make</em>å¿½ç•¥ä¿®æ”¹è¡Œçš„é€€å‡ºçŠ¶æ€å¹¶ç»§ç»­ï¼Œå°±åƒæ²¡æœ‰å‘ç”Ÿé”™è¯¯ä¸€æ ·ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­æ›´æ·±å…¥åœ°è®¨è®ºè¿™ä¸ªä¸»é¢˜ã€‚</p><p>ä¸ºäº†å®žçŽ°åŽ†å²å…¼å®¹æ€§ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä½¿ç›®æ ‡æˆä¸º<code class="literal">.IGNORE</code>ç‰¹æ®Šç›®æ ‡çš„å…ˆå†³æ¡ä»¶æ¥å¿½ç•¥å‘½ä»¤è„šæœ¬ä»»ä½•éƒ¨åˆ†ä¸­çš„é”™è¯¯ã€‚å¦‚æžœè¦å¿½ç•¥æ•´ä¸ª<em class="filename">makefileä¸­çš„æ‰€æœ‰é”™è¯¯ï¼Œ</em>å¯ä»¥ä½¿ç”¨
                      <code class="option">â€”ignore-errors</code>(æˆ–<code class="option">-i</code>) é€‰é¡¹ã€‚å†è¯´ä¸€éï¼Œè¿™ä¼¼ä¹Žä¸å¤ªæœ‰ç”¨ã€‚</p></dd><dt><span class="term"><code class="literal">+</code></span></dt><dd><p>åŠ å·ä¿®é¥°ç¬¦<a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1321" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1322" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1323" class="indexterm"></a>å‘Šè¯‰<em class="command">make</em>æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå³ä½¿ä¸º<em class="command">make</em><code class="option">â€”just-print</code>æä¾›äº†(æˆ–
                      <code class="option">-n</code>) å‘½ä»¤è¡Œé€‰é¡¹
                      ã€‚å®ƒåœ¨ç¼–å†™é€’å½’<em class="filename">makefile</em>æ—¶ä½¿ç”¨ã€‚æˆ‘ä»¬å°†åœ¨<a class="link" href="#OEBPS/ch06.html" title="ç¬¬ 6 ç« ç®¡ç†å¤§åž‹é¡¹ç›®">ç¬¬ 6 ç« </a>çš„<a class="link" href="#OEBPS/ch06.html.make3-CHP-6-SECT-1" title="é€’å½’make">6.1 èŠ‚</a>ä¸­æ›´è¯¦ç»†åœ°è®¨è®ºè¿™ä¸ªä¸»é¢˜ã€‚<em class="command"></em><em class="filename"></em><a class="link" href="#OEBPS/ch06.html.make3-CHP-6-SECT-1" title="é€’å½’make"></a><a class="link" href="#OEBPS/ch06.html" title="ç¬¬ 6 ç« ç®¡ç†å¤§åž‹é¡¹ç›®"></a></p></dd></dl></div><p>ä»»ä½•æˆ–æ‰€æœ‰è¿™äº›ä¿®é¥°ç¬¦éƒ½å…è®¸å‡ºçŽ°åœ¨ä¸€è¡Œä¸­ã€‚æ˜¾ç„¶ï¼Œä¿®é¥°ç¬¦åœ¨å‘½ä»¤æ‰§è¡Œä¹‹å‰è¢«åˆ é™¤ã€‚</p></dd><dd><p>Do not echo <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>the command. For historical compatibility, you
                can make your target a prerequisite of the special target
                <code class="literal">.SILENT</code> if you want all of
                its commands to be hidden. Using <code class="literal">@</code> is preferred, however, because it
                can be applied to individual commands within a command script.
                If you want to apply this modifier to all targets (although it
                is hard to imagine why), you can use the
                <code class="option">â€”silent</code> (or <code class="option">-s</code>)
                option.</p><p>Hiding commands can make the output of <em class="command">make</em> easier on the eyes, but it can
                also make debugging the commands more difficult. If you find
                yourself removing the <code class="literal">@</code>
                modifiers and restoring them frequently, you might create a
                variable, say <code class="literal">QUIET</code>,
                containing the <code class="literal">@</code> modifier
                and use that on commands:</p><a></a><pre class="programlisting">QUIET = @
hairy_script:
        $(QUIET) complex script ...</pre><p>Then, if you need to see the complex script as <em class="command">make</em> runs it, just reset the
                <code class="literal">QUIET</code> variable from the
                command line:</p><a></a><pre class="programlisting">$ make QUIET= hairy_script
complex script ...</pre><div class="variablelist"><dl><dt><span class="term"><code class="literal">-</code></span></dt><dd><p>The dash prefix <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>indicates that errors in the<a class="indexterm"></a> <a class="indexterm"></a> command should be ignored by <em class="command">make</em>. By default, when
                      <em class="command">make</em> executes a
                      command, it examines the exit status of the program or
                      pipeline, and if a nonzero (failure) exit status is
                      returned, <em class="command">make</em>
                      terminates execution of the remainder of the command
                      script and exits. This modifier directs <em class="command">make</em> to ignore the exit status
                      of the modified line and continue as if no error
                      occurred. We'll discuss this topic in more depth in the
                      next section.</p><p>For historical compatibility, you can ignore
                      errors in any part of a command script by making the
                      target a prerequisite of the <code class="literal">.IGNORE</code> special target. If you
                      want to ignore all errors in the entire <em class="filename">makefile,</em> you can use the
                      <code class="option">â€”ignore-errors</code> (or <code class="option">-i</code>)
                      option. Again, this doesn't seem too useful.</p></dd><dt><span class="term"><code class="literal">+</code></span></dt><dd><p>The plus modifier <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>tells <em class="command">make</em> to execute the command
                      even if the <code class="option">â€”just-print</code> (or
                      <code class="option">-n</code>) command-line option is given to
                      <em class="command">make</em>. It is used when
                      writing recursive <em class="filename">makefile</em>s. We'll discuss this
                      topic in more detail in the <a class="link" href="#OEBPS/ch06.html.make3-CHP-6-SECT-1" title="Recursive make">Section 6.1</a> in <a class="link" href="#OEBPS/ch06.html" title="Chapter&nbsp;6.&nbsp;Managing Large Projects">Chapter 6</a>.</p></dd></dl></div><p>Any or all of these modifiers are allowed on a single
                line. Obviously, the modifiers are stripped before the
                commands are executed.</p></dd></dl></div></div><div class="sect2" title="é”™è¯¯å’Œä¸­æ–­"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch05.html.make3-CHP-5-SECT-1.3"></a>é”™è¯¯å’Œä¸­æ–­</h2><h2 class="title"><a></a>Errors and Interrupts</h2></div></div></div><p><em class="command">make</em>
          æ‰§è¡Œçš„æ¯ä¸ªå‘½ä»¤<a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1324" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1325" class="indexterm"></a>è¿”å›žä¸€ä¸ªçŠ¶æ€ç ã€‚çŠ¶æ€ä¸ºé›¶è¡¨ç¤ºå‘½ä»¤æˆåŠŸã€‚éžé›¶çŠ¶æ€è¡¨ç¤ºæŸç§æ•…éšœã€‚æœ‰äº›ç¨‹åºä½¿ç”¨è¿”å›žçŠ¶æ€ä»£ç æ¥æŒ‡ç¤ºæ¯”ç®€å•çš„â€œé”™è¯¯â€æ›´æœ‰æ„ä¹‰çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œ
          å¦‚æžœæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œ <em class="command">grep</em>å°†è¿”å›ž 0ï¼ˆæˆåŠŸï¼‰ï¼›å¦‚æžœæœªæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œåˆ™è¿”å›ž 1ï¼›å¦‚æžœå‘ç”ŸæŸç§é”™è¯¯ï¼Œåˆ™è¿”å›ž 2ã€‚</p><p>Every command that <em class="command">make</em>
          executes <a class="indexterm"></a> <a class="indexterm"></a>returns a status code. A status of zero indicates that
          the command succeeded. A status of nonzero indicates some kind of
          failure. Some programs use the return status code to indicate
          something more meaningful than simply "error." For instance,
          <em class="command">grep</em> returns 0 (success) if a
          match is found, 1 if no match is found, and 2 if some kind of error
          occurred.</p><p>é€šå¸¸ï¼Œå½“ç¨‹åºå¤±è´¥ï¼ˆå³è¿”å›žéžé›¶é€€å‡ºçŠ¶æ€ï¼‰æ—¶ï¼Œ<em class="command">make</em>ä¼šåœæ­¢æ‰§è¡Œå‘½ä»¤å¹¶ä»¥é”™è¯¯çŠ¶æ€é€€å‡ºã€‚æœ‰æ—¶æ‚¨å¸Œæœ›<em class="command">make</em>ç»§ç»­ä¸‹åŽ»ï¼Œå°è¯•å®Œæˆå°½å¯èƒ½å¤šçš„ç›®æ ‡ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ç¼–è¯‘å°½å¯èƒ½å¤šçš„æ–‡ä»¶ï¼Œä»¥ä¾¿åœ¨ä¸€æ¬¡è¿è¡Œä¸­æŸ¥çœ‹æ‰€æœ‰ç¼–è¯‘é”™è¯¯ã€‚æ‚¨å¯ä»¥ä½¿ç”¨<code class="option">â€”keep-going</code>(æˆ–
          <code class="option">-k</code>) é€‰é¡¹æ¥æ‰§è¡Œæ­¤æ“ä½œã€‚</p><p>Normally, when a program fails (i.e., returns a nonzero exit
          status), <em class="command">make</em> stops executing
          commands and exits with an error status. Sometimes you want <em class="command">make</em> to continue, trying to complete as
          many targets as possible. For instance, you might want to compile as
          many files as possible to see all the compilation errors in a single
          run. You can do this with the <code class="option">â€”keep-going</code> (or
          <code class="option">-k</code>) option.</p><p>å°½ç®¡<code class="literal">-</code>ä¿®é¥°ç¬¦ä¼šå¯¼è‡´<em class="command">make</em>å¿½ç•¥å„ä¸ªå‘½ä»¤ä¸­çš„é”™è¯¯ï¼Œä½†æˆ‘ä¼šå°½å¯èƒ½é¿å…ä½¿ç”¨å®ƒã€‚è¿™æ˜¯å› ä¸ºå®ƒä½¿è‡ªåŠ¨é”™è¯¯å¤„ç†å˜å¾—å¤æ‚å¹¶ä¸”è§†è§‰ä¸Šä¸å’Œè°ã€‚</p><p>Although the <code class="literal">-</code> modifier
          causes <em class="command">make</em> to ignore errors in
          individual commands, I try to avoid its use whenever possible. This
          is because it complicates automated error processing and is visually
          jarring.</p><p>å½“<em class="command">make</em>å¿½ç•¥é”™è¯¯æ—¶ï¼Œå®ƒä¼šæ‰“å°ä¸€æ¡è­¦å‘Šä»¥åŠæ–¹æ‹¬å·ä¸­çš„ç›®æ ‡åç§°ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯<em class="command">rm</em>å°è¯•åˆ é™¤ä¸å­˜åœ¨çš„æ–‡ä»¶æ—¶çš„è¾“å‡ºï¼š</p><p>When <em class="command">make</em> ignores an error
          it prints a warning along with the name of the target in square
          brackets. For example, here is the output when <em class="command">rm</em> tries to delete a nonexistent
          file:</p><a id="OEBPS/ch05.html.I_5_tt275"></a><pre class="programlisting">rm ä¸å­˜åœ¨çš„æ–‡ä»¶
rmï¼šæ— æ³•åˆ é™¤â€œä¸å­˜åœ¨çš„æ–‡ä»¶â€ï¼šæ²¡æœ‰è¿™æ ·çš„æ–‡ä»¶æˆ–ç›®å½•
make: [clean] é”™è¯¯ 1ï¼ˆå¿½ç•¥ï¼‰</pre><pre class="programlisting">rm non-existent-file
rm: cannot remove `non-existent-file': No such file or directory
make: [clean] Error 1 (ignored)</pre><p>æŸäº›å‘½ä»¤ï¼ˆä¾‹å¦‚<em class="command">rm</em>ï¼‰å…·æœ‰é€‰é¡¹<a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1326" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1327" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1328" class="indexterm"></a>æŠ‘åˆ¶å®ƒä»¬çš„é”™è¯¯é€€å‡ºçŠ¶æ€ã€‚è¯¥
          <code class="option">-f</code>é€‰é¡¹å°†å¼ºåˆ¶<em class="command">rm</em>è¿”å›žæˆåŠŸï¼ŒåŒæ—¶æŠ‘åˆ¶é”™è¯¯æ¶ˆæ¯ã€‚ä½¿ç”¨æ­¤ç±»é€‰é¡¹æ¯”ä¾èµ–å‰é¢çš„ç ´æŠ˜å·æ›´å¥½ã€‚</p><p>Some commands, like <em class="command">rm</em>,
          have options <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>that suppress their error exit status. The
          <code class="option">-f</code> option will force <em class="command">rm</em> to return success while also
          suppressing error messages. Using such options is better than
          depending on a preceding dash.</p><p>æœ‰æ—¶ï¼Œæ‚¨å¸Œæœ›å‘½ä»¤å¤±è´¥ï¼Œå¹¶ä¸”å¸Œæœ›åœ¨ç¨‹åºæˆåŠŸæ—¶æ”¶åˆ°é”™è¯¯ã€‚å¯¹äºŽè¿™äº›æƒ…å†µï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿç®€å•åœ°å¦å®šç¨‹åºçš„é€€å‡ºçŠ¶æ€ï¼š</p><p>Occasionally, you want a command to fail and would like to get
          an error if the program succeeds. For these situations, you should
          be able to simply negate the exit status of the program:</p><a id="OEBPS/ch05.html.I_5_tt276"></a><pre class="programlisting"># éªŒè¯ä»£ç ä¸­æ²¡æœ‰ç•™ä¸‹ä»»ä½•è°ƒè¯•è¯­å¥ã€‚
.PHONYï¼šno_debug_printf
no_debug_printfï¼š$ï¼ˆæ¥æºï¼‰
        ï¼ grep --line-number '"è°ƒè¯•ï¼š' $^</pre><pre class="programlisting"># Verify there are no debug statements left in the code.
.PHONY: no_debug_printf
no_debug_printf: $(sources)
        ! grep --line-number '"debug:' $^</pre><p><em class="command">ä¸å¹¸çš„æ˜¯ï¼Œ make</em> 3.80ä¸­æœ‰ä¸€ä¸ªé”™è¯¯é˜»æ­¢äº†è¿™ç§ç®€å•çš„ä½¿ç”¨ã€‚<em class="command">make</em>æ— æ³•è¯†åˆ«<code class="literal">!</code>éœ€è¦ shell å¤„ç†çš„å­—ç¬¦å¹¶æ‰§è¡Œå‘½ä»¤è¡Œæœ¬èº«ï¼Œä»Žè€Œå¯¼è‡´é”™è¯¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ³•æ˜¯æ·»åŠ  shell ç‰¹æ®Šå­—ç¬¦ä½œä¸º<em class="command">make çš„</em>çº¿ç´¢ï¼š</p><p>Unfortunately, there is a bug in <em class="command">make</em> 3.80 that prevents this
          straightforward use. <em class="command">make</em> does
          not recognize the <code class="literal">!</code> character as
          requiring shell processing and executes the command line itself,
          resulting in an error. In this case, a simple work around is to add
          a shell special character as a clue to <em class="command">make</em>:</p><a id="OEBPS/ch05.html.I_5_tt277"></a><pre class="programlisting"># éªŒè¯ä»£ç ä¸­æ²¡æœ‰ç•™ä¸‹ä»»ä½•è°ƒè¯•è¯­å¥
.PHONYï¼šno_debug_printf
no_debug_printfï¼š$ï¼ˆæ¥æºï¼‰
        ï¼ grep --line-number '"è°ƒè¯•ï¼š' $^ &lt; /dev/null</pre><pre class="programlisting"># Verify there are no debug statement left in the code
.PHONY: no_debug_printf
no_debug_printf: $(sources)
        ! grep --line-number '"debug:' $^ &lt; /dev/null</pre><p>æ„å¤–å‘½ä»¤é”™è¯¯çš„å¦ä¸€ä¸ªå¸¸è§æ¥æºæ˜¯ä½¿ç”¨<code class="function">if</code>ä¸å¸¦<code class="literal">else</code>.</p><p>Another common source of unexpected command errors is using
          the shell's <code class="function">if</code> construct
          without an <code class="literal">else</code>.</p><a id="OEBPS/ch05.html.I_5_tt278"></a><pre class="programlisting">$ï¼ˆé…ç½®ï¼‰ï¼š$ï¼ˆé…ç½®_æ¨¡æ¿ï¼‰
        å¦‚æžœ [ ï¼ -d $(dir $@) ]; \
        ç„¶åŽ \
          $(MKDIR) $(ç›®å½• $@); \
        è²
        $(M4) $^ &gt; $@</pre><pre class="programlisting">$(config): $(config_template)
        if [ ! -d $(dir $@) ];     \
        then                       \
          $(MKDIR) $(dir $@);      \
        fi
        $(M4) $^ &gt; $@</pre><p>ç¬¬ä¸€ä¸ªå‘½ä»¤æµ‹è¯•è¾“å‡ºç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æžœä¸å­˜åœ¨åˆ™è°ƒç”¨<em class="command">mkdir</em>åˆ›å»ºå®ƒã€‚ä¸å¹¸çš„æ˜¯ï¼Œå¦‚æžœè¯¥ç›®å½•ç¡®å®žå­˜åœ¨ï¼Œè¯¥<code class="function">if</code>å‘½ä»¤å°†è¿”å›žå¤±è´¥é€€å‡ºçŠ¶æ€ï¼ˆæµ‹è¯•çš„é€€å‡ºçŠ¶æ€ï¼‰ï¼Œä»Žè€Œç»ˆæ­¢è„šæœ¬ã€‚ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯æ·»åŠ ä¸€ä¸ª<code class="literal">else</code>
          å­å¥ï¼š</p><p>The first command tests if the output directory exists and
          calls <em class="command">mkdir</em> to create it if it
          does not. Unfortunately, if the directory does exist, the <code class="function">if</code> command returns a failure exit status
          (the exit status of the test), which terminates the script. One
          solution is to add an <code class="literal">else</code>
          clause:</p><a id="OEBPS/ch05.html.I_5_tt279"></a><pre class="programlisting">$ï¼ˆé…ç½®ï¼‰ï¼š$ï¼ˆé…ç½®_æ¨¡æ¿ï¼‰
        å¦‚æžœ [ ï¼ -d $(dir $@) ]; \
        ç„¶åŽ \
          $(MKDIR) $(ç›®å½• $@); \
        åˆ«çš„ \
          çœŸçš„; \
        è²
        $(M4) $^ &gt; $@</pre><pre class="programlisting">$(config): $(config_template)
        if [ ! -d $(dir $@) ];     \
        then                       \
          $(MKDIR) $(dir $@);      \
        else                       \
          true;                    \
        fi
        $(M4) $^ &gt; $@</pre><p>åœ¨ shell ä¸­ï¼Œå†’å· (:) æ˜¯<a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1329" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1330" class="indexterm"></a>no-op å‘½ä»¤å§‹ç»ˆè¿”å›ž trueï¼Œå¹¶ä¸”å¯ä»¥ç”¨æ¥ä»£æ›¿<em class="command">true</em>ã€‚æ­¤å¤„æ•ˆæžœè‰¯å¥½çš„æ›¿ä»£å®žçŽ°æ˜¯ï¼š</p><p>In the shell, the colon (:) is a<a class="indexterm"></a> <a class="indexterm"></a> no-op command that always returns true, and can be
          used instead of <em class="command">true</em>. An
          alternative implementation that works well here is:</p><a id="OEBPS/ch05.html.I_5_tt280"></a><pre class="programlisting">$ï¼ˆé…ç½®ï¼‰ï¼š$ï¼ˆé…ç½®_æ¨¡æ¿ï¼‰
        [[ -d $(dir $@) ]] || $(MKDIR) $(ç›®å½• $@)
        $(M4) $^ &gt; $@</pre><pre class="programlisting">$(config): $(config_template)
        [[ -d $(dir $@) ]] || $(MKDIR) $(dir $@)
        $(M4) $^ &gt; $@</pre><p>çŽ°åœ¨ï¼Œå½“ç›®å½•å­˜åœ¨æˆ–<em class="command">mkdir</em>æˆåŠŸæ—¶ï¼Œç¬¬ä¸€æ¡è¯­å¥ä¸º trueã€‚å¦ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨<em class="command">mkdir</em>
          <code class="option">-p</code>ã€‚å³ä½¿ç›®å½•å·²ç»å­˜åœ¨ï¼Œè¿™ä¹Ÿå…è®¸<em class="command">mkdir</em>æˆåŠŸã€‚å³ä½¿ç›®å½•å­˜åœ¨ï¼Œæ‰€æœ‰è¿™äº›å®žçŽ°éƒ½ä¼šåœ¨å­ shell ä¸­æ‰§è¡ŒæŸäº›æ“ä½œã€‚é€šè¿‡ä½¿ç”¨<code class="function">wildcard</code>ï¼Œå¦‚æžœç›®å½•å­˜åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨çœç•¥æ‰§è¡Œã€‚</p><p>Now the first statement is true when the directory exists or
          when the <em class="command">mkdir</em> succeeds. Another
          alternative is to use <em class="command">mkdir</em>
          <code class="option">-p</code>. This allows <em class="command">mkdir</em> to succeed even when the directory
          already exists. All these implementations execute something in a
          subshell even when the directory exists. By using <code class="function">wildcard</code>, we can omit the execution
          entirely if the directory is present.</p><a id="OEBPS/ch05.html.I_5_tt281"></a><pre class="programlisting"># $(è°ƒç”¨ make-dir, ç›®å½•)
make-dir = $(if $(é€šé…ç¬¦ $1),,$(MKDIR) -p $1)

$ï¼ˆé…ç½®ï¼‰ï¼š$ï¼ˆé…ç½®_æ¨¡æ¿ï¼‰
        $(è°ƒç”¨ make-dir, $(dir $@))
        $(M4) $^ &gt; $@</pre><pre class="programlisting"># $(call make-dir, directory)
make-dir = $(if $(wildcard $1),,$(MKDIR) -p $1)

$(config): $(config_template)
        $(call make-dir, $(dir $@))
        $(M4) $^ &gt; $@</pre><p>å› ä¸ºæ¯ä¸ªå‘½ä»¤éƒ½æ˜¯åœ¨è‡ªå·±çš„ shell ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥é€šå¸¸æœ‰<a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1331" class="indexterm"></a> <a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1332" class="indexterm"></a>å¤šè¡Œå‘½ä»¤ï¼Œæ¯ä¸ªç»„ä»¶ç”¨åˆ†å·åˆ†éš”ã€‚è¯·æ³¨æ„ï¼Œè¿™äº›è„šæœ¬ä¸­çš„é”™è¯¯å¯èƒ½ä¸ä¼šç»ˆæ­¢è„šæœ¬ï¼š</p><p>Because each command is executed in its own shell, it is
          common to have <a class="indexterm"></a> <a class="indexterm"></a>multiline commands with each component separated by
          semicolons. Be aware that errors within these scripts may not
          terminate the script:</p><a id="OEBPS/ch05.html.I_5_tt282"></a><pre class="programlisting">ç›®æ ‡ï¼š
        rm rm-å¤±è´¥ï¼› echo ä½†ä¸‹ä¸€ä¸ªå‘½ä»¤ä»ç„¶æ‰§è¡Œ</pre><pre class="programlisting">target:
        rm rm-fails; echo But the next command executes anyway</pre><p>æœ€å¥½å°½é‡å‡å°‘å‘½ä»¤è„šæœ¬çš„é•¿åº¦ï¼Œå¹¶
          ä¸ºæ‚¨<em class="command">æä¾›</em>ç®¡ç†é€€å‡ºçŠ¶æ€å’Œç»ˆæ­¢çš„æœºä¼šã€‚ä¾‹å¦‚ï¼š</p><p>It is best to minimize the length of command scripts and give
          <em class="command">make</em> a chance to manage exit
          status and termination for you. For instance:</p><a id="OEBPS/ch05.html.I_5_tt283"></a><pre class="programlisting">è·¯å¾„ä¿®å¤ = -e "s;[a-zA-Z:/]*/src/;$(SOURCE_DIR)/;g" \
             -e "s;[a-zA-Z:/]*/bin/;$(OUTPUT_DIR)/;g"

# ä¸€ä¸ªå¥½çš„ç‰ˆæœ¬ã€‚
å®šä¹‰ä¿®å¤é¡¹ç›®è·¯å¾„
  sed $(è·¯å¾„ä¿®å¤) $1 &gt; $2.fixed &amp;&amp; \
  mv $2.å›ºå®š$2
æ©å¾·å¤«

# ä¸€ä¸ªæ›´å¥½çš„ç‰ˆæœ¬ã€‚
å®šä¹‰ä¿®å¤é¡¹ç›®è·¯å¾„
  sed $(è·¯å¾„ä¿®å¤) $1 &gt; $2.fixed
  mv $2.å›ºå®š$2
æ©å¾·å¤«</pre><pre class="programlisting">path-fixup = -e "s;[a-zA-Z:/]*/src/;$(SOURCE_DIR)/;g" \
             -e "s;[a-zA-Z:/]*/bin/;$(OUTPUT_DIR)/;g"

# A good version.
define fix-project-paths
  sed $(path-fixup) $1 &gt; $2.fixed &amp;&amp; \
  mv $2.fixed $2
endef

# A better version.
define fix-project-paths
  sed $(path-fixup) $1 &gt; $2.fixed
  mv $2.fixed $2
endef</pre><p>è¯¥å®å°† DOS æ ·å¼è·¯å¾„ï¼ˆå¸¦æœ‰æ­£æ–œæ ï¼‰è½¬æ¢ä¸ºç‰¹å®šæºå’Œè¾“å‡ºæ ‘çš„ç›®æ ‡è·¯å¾„ã€‚è¯¥å®æŽ¥å—ä¸¤ä¸ªæ–‡ä»¶åï¼Œå³è¾“å…¥æ–‡ä»¶å’Œè¾“å‡ºæ–‡ä»¶ã€‚ä»…å½“<em class="command">sed</em>å‘½ä»¤æ­£ç¡®å®Œæˆæ—¶ï¼Œæ‰ä¼šå°å¿ƒåœ°è¦†ç›–è¾“å‡ºæ–‡ä»¶ã€‚ â€œå¥½çš„â€ç‰ˆæœ¬é€šè¿‡è¿žæŽ¥<em class="command">sed</em>å’Œ<em class="command">mv</em>æ¥å®žçŽ°è¿™ä¸€ç‚¹<code class="literal">&amp;&amp;</code>ï¼Œä»¥ä¾¿å®ƒä»¬åœ¨å•ä¸ª shell ä¸­æ‰§è¡Œã€‚ â€œæ›´å¥½â€çš„ç‰ˆæœ¬å°†å®ƒä»¬ä½œä¸ºä¸¤ä¸ªå•ç‹¬çš„å‘½ä»¤æ‰§è¡Œï¼Œå¦‚æžœ<em class="command">sedå¤±è´¥ï¼Œåˆ™è®©</em><em class="command">make</em>ç»ˆæ­¢è„šæœ¬ã€‚ â€œæ›´å¥½â€çš„ç‰ˆæœ¬å¹¶ä¸æ›´æ˜‚è´µï¼ˆ<em class="command">mv</em>ä¸éœ€è¦shellå¹¶ä¸”ç›´æŽ¥æ‰§è¡Œï¼‰ï¼Œæ›´å®¹æ˜“é˜…è¯»ï¼Œå¹¶ä¸”åœ¨å‘ç”Ÿé”™è¯¯æ—¶æä¾›æ›´å¤šä¿¡æ¯ï¼ˆå› ä¸º<em class="command">make</em>ä¼šæŒ‡ç¤ºå“ªä¸ªå‘½ä»¤å¤±è´¥ï¼‰ã€‚<em class="command"></em><em class="command"></em><em class="command"></em></p><p>This macro transforms DOS-style paths (with forward slashes)
          into destination paths for a particular source and output tree. The
          macro accepts two filenames, the input and output files. It is
          careful to overwrite the output file only if the <em class="command">sed</em> command completes correctly. The
          "good" version does this by connecting the <em class="command">sed</em> and <em class="command">mv</em> with <code class="literal">&amp;&amp;</code> so they execute in a single
          shell. The "better" version executes them as two separate commands,
          letting <em class="command">make</em> terminate the script
          if the <em class="command">sed</em> fails. The "better"
          version is no more expensive (the <em class="command">mv</em> doesn't need a shell and is executed
          directly), is easier to read, and provides more information when
          errors occur (because <em class="command">make</em> will
          indicate which command failed).</p><p><em class="command">è¯·æ³¨æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸Žcd</em>å¸¸è§é—®é¢˜ä¸åŒçš„é—®é¢˜ï¼š</p><p>Note that this is a different issue than the common problem
          with <em class="command">cd</em>:</p><a id="OEBPS/ch05.html.I_5_tt284"></a><pre class="programlisting">æ ‡ç­¾ï¼š
        cd src &amp;&amp; \
        ctags--é€’å½’</pre><pre class="programlisting">TAGS:
        cd src &amp;&amp; \
        ctags --recurse</pre><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ä¸ªè¯­å¥å¿…é¡»åœ¨åŒä¸€ä¸ªå­ shell ä¸­æ‰§è¡Œã€‚å› æ­¤ï¼Œå‘½ä»¤å¿…é¡»ç”±æŸç§è¯­å¥è¿žæŽ¥å™¨åˆ†éš”ï¼Œä¾‹å¦‚<code class="literal">;</code>æˆ–<code class="literal">&amp;&amp;</code>ã€‚</p><p>In this case, the two statements must be executed within the
          same subshell. Therefore, the commands must be separated by some
          kind of statement connector, such as <code class="literal">;</code> or <code class="literal">&amp;&amp;</code>.</p><div class="sect3" title="åˆ é™¤å’Œä¿ç•™ç›®æ ‡æ–‡ä»¶"><div class="titlepage"><div><div><h3 class="title"><a id="OEBPS/ch05.html.make3-CHP-5-SECT-1.3.1"></a>åˆ é™¤å’Œä¿ç•™ç›®æ ‡æ–‡ä»¶</h3><h3 class="title"><a></a>Deleting and preserving target files</h3></div></div></div><p>å¦‚æžœå‘ç”Ÿé”™è¯¯ï¼Œ<em class="command">make ä¼š</em>
            å‡è®¾ç›®æ ‡<a id="OEBPS/ch05.html.make3-CHP-5-ITERM-1333" class="indexterm"></a>æ— æ³•é‡åˆ¶ã€‚ä»¥å½“å‰ç›®æ ‡ä¸ºå…ˆå†³æ¡ä»¶çš„ä»»ä½•å…¶ä»–ç›®æ ‡ä¹Ÿæ— æ³•é‡æ–°åˆ›å»ºï¼Œå› æ­¤
            <em class="command">make</em>ä¸ä¼šå°è¯•å®ƒä»¬ï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œå…¶å‘½ä»¤è„šæœ¬çš„ä»»ä½•éƒ¨åˆ†ã€‚å¦‚æžœ
            ä½¿ç”¨<code class="option">â€”keep-going</code>(æˆ–<code class="option">-k</code>) é€‰é¡¹ï¼Œåˆ™å°†å°è¯•ä¸‹ä¸€ä¸ªç›®æ ‡ï¼›å¦åˆ™ï¼Œ<em class="command">é€€å‡º</em>ã€‚å¦‚æžœå½“å‰ç›®æ ‡æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æžœè¯¥å‘½ä»¤åœ¨å®Œæˆå…¶å·¥ä½œä¹‹å‰é€€å‡ºï¼Œåˆ™è¯¥æ–‡ä»¶å¯èƒ½ä¼šæŸåã€‚ä¸å¹¸çš„æ˜¯ï¼Œå‡ºäºŽåŽ†å²å…¼å®¹æ€§çš„åŽŸå› ï¼Œ
             <em class="command">make</em>ä¼šå°†è¿™ä¸ªå¯èƒ½æŸåçš„æ–‡ä»¶ä¿ç•™åœ¨ç£ç›˜ä¸Šã€‚ç”±äºŽæ–‡ä»¶çš„æ—¶é—´æˆ³å·²æ›´æ–°ï¼Œå› æ­¤åŽç»­æ‰§è¡Œ<em class="command">make</em>å¯èƒ½æ— æ³•ä½¿ç”¨æ­£ç¡®çš„æ•°æ®æ›´æ–°æ–‡ä»¶ã€‚é€šè¿‡<em class="command">å°†</em>ç›®æ ‡æ–‡ä»¶ä½œä¸º
            .<code class="literal">.DELETE_ON_ERROR</code>å¦‚æžœ<code class="literal">.DELETE_ON_ERROR</code>åœ¨æ²¡æœ‰å…ˆå†³æ¡ä»¶çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œåˆ™ä»»ä½•ç›®æ ‡æ–‡ä»¶æž„å»ºä¸­çš„é”™è¯¯éƒ½å°†å¯¼è‡´<em class="command">make</em>åˆ é™¤ç›®æ ‡ã€‚</p><p>If an error occurs, <em class="command">make</em>
            assumes that the target <a class="indexterm"></a>cannot be remade. Any other targets that have the
            current target as a prerequisite also cannot be remade, so
            <em class="command">make</em> will not attempt them nor
            execute any part of their command scripts. If the
            <code class="option">â€”keep-going</code> (or <code class="option">-k</code>) option is
            used, the next goal will be attempted; otherwise, <em class="command">make</em> exits. If the current target is a
            file, it may be corrupt if the command exits before finishing its
            work. Unfortunately, for reasons of historical compatibility,
            <em class="command">make</em> will leave this
            potentially corrupt file on disk. Because the file's timestamp has
            been updated, subsequent executions of <em class="command">make</em> may not update the file with
            correct data. You can avoid this problem and cause <em class="command">make</em> to delete these questionable files
            when an error occurs by making the target file a prerequisite of
            <code class="literal">.DELETE_ON_ERROR</code>. If <code class="literal">.DELETE_ON_ERROR</code> is used with no
            prerequisites, errors in any target file build will cause <em class="command">make</em> to delete the target.</p><p><em class="command">å½“make</em>è¢«ä¿¡å·ï¼ˆä¾‹å¦‚ Ctrl-Cï¼‰ä¸­æ–­æ—¶ï¼Œå°±ä¼šå‡ºçŽ°äº’è¡¥é—®é¢˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ
            å¦‚æžœæ–‡ä»¶å·²è¢«ä¿®æ”¹ï¼Œ<em class="command">make å°†</em>åˆ é™¤å½“å‰ç›®æ ‡æ–‡ä»¶ã€‚æœ‰æ—¶åˆ é™¤æ–‡ä»¶æ˜¯é”™è¯¯çš„åšæ³•ã€‚ä¹Ÿè®¸è¯¥æ–‡ä»¶çš„åˆ›å»ºæˆæœ¬éžå¸¸é«˜ï¼Œå¹¶ä¸”éƒ¨åˆ†å†…å®¹æ€»æ¯”æ²¡æœ‰å¥½ï¼Œæˆ–è€…è¯¥æ–‡ä»¶å¯èƒ½å¿…é¡»å­˜åœ¨æ‰èƒ½ä½¿æž„å»ºçš„å…¶ä»–éƒ¨åˆ†ç»§ç»­è¿›è¡Œã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡å°†å…¶ä½œä¸ºç‰¹æ®Šç›®æ ‡çš„å…ˆå†³æ¡ä»¶æ¥ä¿æŠ¤è¯¥æ–‡ä»¶<code class="literal">.PRECIOUS</code>ã€‚</p><p>A complementary problem occurs when <em class="command">make</em> is interrupted by a signal, such as
            a Ctrl-C. In this case, <em class="command">make</em>
            deletes the current target file if the file has been modified.
            Sometimes deleting the file is the wrong thing to do. Perhaps the
            file is very expensive to create and partial contents are better
            than none, or perhaps the file must exist for other parts of the
            build to proceed. In these cases, you can protect the file by
            making it a prerequisite of the special target <code class="literal">.PRECIOUS</code>.</p></div></div></div></div></div></div>
<div id="OEBPS/ch05s02.html"><div>
<div class="sect1" title="ä½¿ç”¨å“ªä¸ªå¤–å£³"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch05s02.html.make3-CHP-5-SECT-2"></a>ä½¿ç”¨å“ªä¸ªå¤–å£³</h1><h1 class="title"><a></a>Which Shell to Use</h1></div></div></div><p>å½“<em class="command">make</em>éœ€è¦ä¼ é€’ä¸€ä¸ª<a id="OEBPS/ch05s02.html.make3-CHP-5-ITERM-1334" class="indexterm"></a> <a id="OEBPS/ch05s02.html.make3-CHP-5-ITERM-1335" class="indexterm"></a> <a id="OEBPS/ch05s02.html.make3-CHP-5-ITERM-1336" class="indexterm"></a>å‘½ä»¤è¡Œåˆ°å­ shellï¼Œå®ƒä½¿ç”¨<em class="filename">/bin/sh</em>ã€‚æ‚¨å¯ä»¥é€šè¿‡è®¾ç½®<em class="command">make</em>å˜é‡æ¥æ›´æ”¹ shell <code class="literal">SHELL</code>ã€‚è¿™æ ·åšä¹‹å‰è¯·ä»”ç»†è€ƒè™‘ã€‚é€šå¸¸ï¼Œä½¿ç”¨<em class="command">make</em>çš„ç›®çš„
        æ˜¯ä¸ºå¼€å‘äººå‘˜ç¤¾åŒºæä¾›ä¸€ç§å·¥å…·ï¼Œä»¥ä»Žå…¶æºç»„ä»¶æž„å»ºç³»ç»Ÿã€‚é€šè¿‡ä½¿ç”¨å¯¹ç¤¾åŒºä¸­å…¶ä»–å¼€å‘äººå‘˜ä¸å¯ç”¨çš„å·¥å…·æˆ–ä¸æ­£ç¡®çš„å‡è®¾ï¼Œå¾ˆå®¹æ˜“åˆ›å»ºä¸€ä¸ªæ— æ³•å®žçŽ°æ­¤ç›®æ ‡çš„<em class="filename">makefile</em> ã€‚
        åœ¨ä»»ä½•å¹¿æ³›åˆ†å‘çš„åº”ç”¨ç¨‹åºï¼ˆé€šè¿‡åŒ¿å ftp æˆ– open cvs åˆ†å‘çš„åº”ç”¨ç¨‹åºï¼‰ä¸­ä½¿ç”¨é™¤<em class="filename">/bin/shä¹‹å¤–çš„ä»»ä½• shell éƒ½è¢«è®¤ä¸ºæ˜¯éžå¸¸ç³Ÿç³•çš„å½¢å¼ã€‚æˆ‘ä»¬å°†åœ¨</em><a class="link" href="#OEBPS/ch07.html" title="ç¬¬ 7 ç« å¯ç§»æ¤ Makefile">ç¬¬ 7 ç« </a>ä¸­æ›´è¯¦ç»†åœ°è®¨è®ºå¯ç§»æ¤æ€§ã€‚</p><p>When <em class="command">make</em> needs to pass
        a<a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> command line to a subshell, it uses <em class="filename">/bin/sh</em>. You can change the shell by
        setting the <em class="command">make</em> variable <code class="literal">SHELL</code>. Think carefully before doing this.
        Usually, the purpose of using <em class="command">make</em>
        is to provide a tool for a community of developers to build a system
        from its source components. It is quite easy to create a <em class="filename">makefile</em> that fails in this goal by using
        tools that are not available or assumptions that are not true for
        other developers in the community. It is considered very bad form to
        use any shell other than <em class="filename">/bin/sh</em>
        in any widely distributed application (one distributed via anonymous
        ftp or open cvs). We'll discuss portability in more detail in <a class="link" href="#OEBPS/ch07.html" title="Chapter&nbsp;7.&nbsp;Portable Makefiles">Chapter 7</a>.</p><p>ç„¶è€Œï¼Œä½¿ç”¨<em class="command">make</em>è¿˜æœ‰å¦ä¸€ä¸ªä¸Šä¸‹æ–‡ã€‚é€šå¸¸ï¼Œåœ¨å°é—­çš„å¼€å‘çŽ¯å¢ƒä¸­ï¼Œå¼€å‘äººå‘˜ä¸Žç»è¿‡æ‰¹å‡†çš„å¼€å‘äººå‘˜å°ç»„ä¸€èµ·åœ¨æœ‰é™çš„æœºå™¨å’Œæ“ä½œç³»ç»Ÿä¸Šå·¥ä½œã€‚äº‹å®žä¸Šï¼Œè¿™æ˜¯æˆ‘æœ€å¸¸é‡åˆ°çš„çŽ¯å¢ƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè‡ªå®šä¹‰
        <em class="command">make</em>é¢„æœŸè¿è¡Œçš„çŽ¯å¢ƒæ˜¯éžå¸¸æœ‰æ„ä¹‰çš„ã€‚å¼€å‘äººå‘˜å°†è¢«æŒ‡å¯¼å¦‚ä½•è®¾ç½®ä»–ä»¬çš„çŽ¯å¢ƒï¼Œä»¥ä¾¿åœ¨æž„å»ºå’Œç”Ÿæ´»ä¸­æ­£å¸¸å·¥ä½œã€‚</p><p>There is another context for using <em class="command">make</em>, however. Often, in closed development
        environments, the developers are working on a limited set of machines
        and operating systems with an approved group of developers. In fact,
        this is the environment I've most often found myself in. In this
        situation, it can make perfect sense to customize the environment
        <em class="command">make</em> is expected to run under.
        Developers are instructed in how to set up their environment to work
        properly with the build and life goes on.</p><p>åœ¨è¿™æ ·çš„çŽ¯å¢ƒä¸­ï¼Œæˆ‘æ›´å–œæ¬¢â€œé¢„å…ˆâ€åšå‡ºä¸€äº›å¯ç§»æ¤æ€§ç‰ºç‰²ã€‚æˆ‘ç›¸ä¿¡è¿™å¯ä»¥è®©æ•´ä¸ªå¼€å‘è¿‡ç¨‹æ›´åŠ é¡ºåˆ©ã€‚å…¶ä¸­ä¸€é¡¹ç‰ºç‰²æ˜¯å°†<code class="literal">SHELL</code>å˜é‡æ˜¾å¼è®¾ç½®ä¸º<em class="filename">/usr/bin/bash</em>ã€‚ bash shell æ˜¯ä¸€ä¸ªå¯ç§»æ¤çš„ã€ç¬¦åˆ POSIX æ ‡å‡†çš„ shellï¼ˆå› æ­¤æ˜¯<em class="command">shçš„è¶…é›†ï¼‰ </em><em class="command">ï¼Œ</em>å¹¶ä¸”æ˜¯ GNU/Linux ä¸Šçš„æ ‡å‡† shellã€‚<em class="filename">makefile</em>ä¸­çš„è®¸å¤šå¯ç§»æ¤æ€§é—®é¢˜æ˜¯ç”±äºŽåœ¨å‘½ä»¤è„šæœ¬ä¸­ä½¿ç”¨ä¸å¯ç§»æ¤çš„ç»“æž„é€ æˆçš„ã€‚è¿™å¯ä»¥é€šè¿‡æ˜¾å¼ä½¿ç”¨ä¸€ä¸ªæ ‡å‡† shell è€Œä¸æ˜¯å†™å…¥<em class="command">sh</em>çš„å¯ç§»æ¤å­é›†æ¥è§£å†³
        ã€‚ Paul Smithï¼Œ <acronym class="acronym">GNU </acronym><em class="command">make</em>çš„ç»´æŠ¤è€…
        ï¼Œæœ‰ä¸€ä¸ªç½‘é¡µâ€œPaul's Rules of Makefilesâ€ï¼ˆ<a class="ulink" href="http://make.paulandlesley.org/rules.html">http://make.paulandlesley.org/rules.html</a>ï¼‰ï¼Œä»–åœ¨å…¶ä¸­æŒ‡å‡ºï¼Œâ€œä¸è¦ä¸ºç¼–å†™å¯ç§»æ¤çš„ makefile è€Œçƒ¦æ¼ï¼Œä½¿ç”¨è€Œæ˜¯ä¾¿æºå¼
        <span class="emphasis"><em>å“ç‰Œ</em></span>ï¼â€æˆ‘è¿˜ä¼šè¯´ï¼Œâ€œå¦‚æžœå¯èƒ½çš„è¯ï¼Œä¸è¦è´¹åŠ›ç¼–å†™å¯ç§»æ¤çš„å‘½ä»¤è„šæœ¬ï¼Œè€Œæ˜¯ä½¿ç”¨å¯ç§»æ¤çš„ shell (bash)ã€‚â€ bash shell<em class="command">å¯ä»¥</em>
        åœ¨å¤§å¤šæ•°æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼ŒåŒ…æ‹¬å‡ ä¹Žæ‰€æœ‰ Unixã€Windowsã€BeOSã€Amiga å’Œ OS/2 å˜ä½“ã€‚<em class="command"></em><em class="filename"></em><em class="command"></em><acronym class="acronym"></acronym> <em class="command"></em><a class="ulink" href="http://make.paulandlesley.org/rules.html"></a><span class="emphasis"><em></em></span><em class="command"></em></p><p>In environments such as this, I prefer to make some portability
        sacrifices "up front." I believe this can make the entire development
        process go much more smoothly. One such sacrifice is to explicitly set
        the <code class="literal">SHELL</code> variable to <em class="filename">/usr/bin/bash</em>. The <em class="command">bash</em> shell is a portable, POSIX-compliant
        shell (and, therefore, a superset of <em class="command">sh</em>) and is the standard shell on GNU/Linux.
        Many portability problems in <em class="filename">makefile</em>s are due to using nonportable
        constructs in command scripts. This can be solved by explicitly using
        one standard shell rather than writing to the portable subset of
        <em class="command">sh</em>. Paul Smith, the maintainer of
        <acronym class="acronym">GNU</acronym> <em class="command">make</em>, has a
        web page "Paul's Rules of Makefiles" (<a class="ulink" href="http://make.paulandlesley.org/rules.html">http://make.paulandlesley.org/rules.html</a>) on which he
        states, "Don't hassle with writing portable makefiles, use a portable
        <span class="emphasis"><em>make</em></span> instead!" I would also say, "Where possible,
        don't hassle with writing portable command scripts, use a portable
        shell (bash) instead." The <em class="command">bash</em>
        shell runs on most operating systems including virtually all variants
        of Unix, Windows, BeOS, Amiga, and OS/2.</p><p>åœ¨æœ¬ä¹¦çš„å…¶ä½™éƒ¨åˆ†ä¸­ï¼Œæˆ‘å°†åœ¨å‘½ä»¤è„šæœ¬ä½¿ç”¨ç‰¹å®šäºŽ bash çš„åŠŸèƒ½æ—¶è¿›è¡Œè¯´æ˜Žã€‚</p><p>For the remainder of this book, I will note when a command
        script uses bash-specific features.</p></div></div></div>
<div id="OEBPS/ch05s03.html"><div>
<div class="sect1" title="ç©ºå‘½ä»¤"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch05s03.html.make3-CHP-5-SECT-3"></a>ç©ºå‘½ä»¤</h1><h1 class="title"><a></a>Empty Commands</h1></div></div></div><p><em class="firstterm">ç©º</em>å‘½ä»¤æ˜¯<a id="OEBPS/ch05s03.html.make3-CHP-5-ITERM-1337" class="indexterm"></a> <a id="OEBPS/ch05s03.html.make3-CHP-5-ITERM-1338" class="indexterm"></a>ä¸€ä¸ªä»€ä¹ˆä¹Ÿä¸åšçš„äººã€‚</p><p>An <em class="firstterm">empty command</em> is<a class="indexterm"></a> <a class="indexterm"></a> one that does nothing.</p><a id="OEBPS/ch05s03.html.I_5_tt285"></a><pre class="programlisting">æ ‡é¢˜.h: ;</pre><pre class="programlisting">header.h: ;</pre><p>å›žæƒ³ä¸€ä¸‹ï¼Œç›®æ ‡çš„å…ˆå†³æ¡ä»¶åˆ—è¡¨åŽé¢å¯ä»¥è·Ÿä¸€ä¸ªåˆ†å·å’Œå‘½ä»¤ã€‚è¿™é‡Œçš„åˆ†å·åŽé¢ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œè¡¨ç¤ºæ²¡æœ‰å‘½ä»¤ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»…åŒ…å«é€‰é¡¹å¡çš„è¡Œæ¥è·Ÿéšç›®æ ‡ï¼Œä½†è¿™å°†æ— æ³•è¯»å–ã€‚ç©ºå‘½ä»¤æœ€å¸¸ç”¨äºŽé˜²æ­¢æ¨¡å¼è§„åˆ™åŒ¹é…ç›®æ ‡å¹¶æ‰§è¡Œæ‚¨ä¸æƒ³è¦çš„å‘½ä»¤ã€‚</p><p>Recall that the prerequisites list for a target can be followed
        by a semicolon and the command. Here a semicolon with nothing after it
        indicates that there are no commands. You could instead follow the
        target with a line containing only a tab, but that would be impossible
        to read. Empty commands are most often used to prevent a pattern rule
        from matching the target and executing commands you don't want.</p><p>è¯·æ³¨æ„ï¼Œåœ¨å…¶ä»–ç‰ˆæœ¬çš„<em class="command">make</em>ä¸­ï¼Œç©ºç›®æ ‡æœ‰æ—¶è¢«ç”¨ä½œè™šå‡ç›®æ ‡ã€‚åœ¨<acronym class="acronym">GNU </acronym> <em class="command">make</em>ä¸­ï¼Œæ”¹ç”¨<code class="literal">.PHONY</code>ç‰¹æ®Šç›®æ ‡ï¼›å®ƒæ›´å®‰å…¨ã€æ›´æ¸…æ™°ã€‚</p><p>Note that in other versions of <em class="command">make</em>, empty targets are sometimes used as
        phony targets. In <acronym class="acronym">GNU</acronym> <em class="command">make</em>, use the <code class="literal">.PHONY</code> special target instead; it's safer
        and clearer.</p></div></div></div>
<div id="OEBPS/ch05s04.html"><div>
<div class="sect1" title="å‘½ä»¤çŽ¯å¢ƒ"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch05s04.html.make3-CHP-5-SECT-4"></a>å‘½ä»¤çŽ¯å¢ƒ</h1><h1 class="title"><a></a>Command Environment</h1></div></div></div><p><em class="command">make</em>æ‰§è¡Œçš„å‘½ä»¤<em class="command"></em>
        <a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1339" class="indexterm"></a> <a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1340" class="indexterm"></a><em class="command">ä»Žmake</em>æœ¬èº«ç»§æ‰¿å®ƒä»¬çš„å¤„ç†çŽ¯å¢ƒã€‚è¯¥çŽ¯å¢ƒåŒ…æ‹¬å½“å‰å·¥ä½œç›®å½•ã€æ–‡ä»¶æè¿°ç¬¦ä»¥åŠ<em class="command">make</em>ä¼ é€’çš„çŽ¯å¢ƒå˜é‡ã€‚</p><p>Commands executed by <em class="command">make</em>
        <a class="indexterm"></a> <a class="indexterm"></a>inherit their processing environment from <em class="command">make</em> itself. This environment includes the
        current working directory, file descriptors, and the environment
        variables passed by <em class="command">make</em>.</p><p>åˆ›å»ºå­ shell æ—¶ï¼Œ<em class="command">make</em>ä¼šå‘çŽ¯å¢ƒæ·»åŠ ä¸€äº›å˜é‡ï¼š</p><p>When a subshell is created, <em class="command">make</em> adds a few variables to the
        environment:</p><a id="OEBPS/ch05s04.html.I_5_tt286"></a><pre class="programlisting">åˆ¶ä½œæ ‡å¿—
MFLAGS
åˆ¶é€ æ°´å¹³</pre><pre class="programlisting">MAKEFLAGS
MFLAGS
MAKELEVEL</pre><p>å˜é‡<code class="literal">MAKEFLAGS</code>â€‹
        <a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1341" class="indexterm"></a> <a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1342" class="indexterm"></a> <a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1343" class="indexterm"></a> <a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1344" class="indexterm"></a><em class="command">åŒ…æ‹¬ä¼ é€’ç»™make çš„</em>å‘½ä»¤è¡Œé€‰é¡¹ã€‚è¯¥<code class="literal">MFLAGS</code>å˜é‡åæ˜ <code class="literal">MAKEFLAGS</code>å¹¶å› åŽ†å²åŽŸå› è€Œå­˜åœ¨ã€‚å˜é‡<code class="literal">MAKELEVEL</code>â€‹<a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1345" class="indexterm"></a> <a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1346" class="indexterm"></a> <a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1347" class="indexterm"></a> <a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1348" class="indexterm"></a><em class="command">è¡¨ç¤ºåµŒå¥—make</em>è°ƒç”¨çš„æ•°é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“<em class="command">make</em>é€’å½’è°ƒç”¨<em class="command">make</em>æ—¶ï¼Œ<code class="literal">MAKELEVEL</code>å˜é‡åŠ ä¸€ã€‚å•çˆ¶<em class="command">make</em>çš„å­è¿›ç¨‹å°†æœ‰<code class="literal">MAKELEVEL</code>ä¸€ä¸ªã€‚è¿™äº›å˜é‡é€šå¸¸ç”¨äºŽç®¡ç†é€’å½’<em class="command">make</em>ã€‚æˆ‘ä»¬å°†åœ¨<a class="link" href="#OEBPS/ch06.html" title="ç¬¬ 6 ç« ç®¡ç†å¤§åž‹é¡¹ç›®">ç¬¬ 6 ç« </a>çš„<a class="link" href="#OEBPS/ch06.html.make3-CHP-6-SECT-1" title="é€’å½’make">6.1 èŠ‚</a>ä¸­è®¨è®ºå®ƒä»¬ã€‚<a class="link" href="#OEBPS/ch06.html" title="ç¬¬ 6 ç« ç®¡ç†å¤§åž‹é¡¹ç›®"></a></p><p>The <code class="literal">MAKEFLAGS</code> variable
        <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>includes the command-line options passed to <em class="command">make</em>. The <code class="literal">MFLAGS</code> variable mirrors <code class="literal">MAKEFLAGS</code> and exists for historical reasons.
        The <code class="literal">MAKELEVEL</code> variable <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>indicates the number of nested <em class="command">make</em> invocations. That is, when <em class="command">make</em> recursively invokes <em class="command">make</em>, the <code class="literal">MAKELEVEL</code> variable increases by one.
        Subprocesses of a single parent <em class="command">make</em> will have a <code class="literal">MAKELEVEL</code> of one. These variables are
        typically used for managing recursive <em class="command">make</em>. We'll discuss them in the <a class="link" href="#OEBPS/ch06.html.make3-CHP-6-SECT-1" title="Recursive make">Section 6.1</a> in <a class="link" href="#OEBPS/ch06.html" title="Chapter&nbsp;6.&nbsp;Managing Large Projects">Chapter 6</a>.</p><p>å½“ç„¶ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨è¯¥<code class="function">export</code>æŒ‡ä»¤å°†ä»–ä»¬å–œæ¬¢çš„ä»»ä½•å˜é‡æ·»åŠ åˆ°å­è¿›ç¨‹çŽ¯å¢ƒä¸­ã€‚</p><p>Of course, the user can add whatever variables they like to the
        subprocess environment with the use of the <code class="function">export</code> directive.</p><p>å·²æ‰§è¡Œå‘½ä»¤çš„å½“å‰å·¥ä½œç›®å½•æ˜¯çˆ¶<em class="command">make</em>çš„å·¥ä½œç›®å½•ã€‚è¿™é€šå¸¸ä¸Žæ‰§è¡Œ<em class="command">make</em>ç¨‹åºçš„ç›®å½•ç›¸åŒï¼Œä½†å¯ä»¥ä½¿ç”¨
        (æˆ–) å‘½ä»¤è¡Œé€‰é¡¹è¿›è¡Œæ›´æ”¹ã€‚è¯·æ³¨æ„ï¼Œä»…
        ä½¿ç”¨æŒ‡å®šä¸åŒçš„<em class="filename">makefile</em>ä¸ä¼šæ›´æ”¹å½“å‰ç›®å½•ï¼Œåªä¼šè¯»å–<em class="filename">makefile</em>ã€‚<code class="literal">--directory=<em class="replaceable"><code>directory</code></em></code><code class="option">-C</code><em class="filename"></em><code class="option">â€”file</code><em class="filename"></em></p><p>The current working directory for an executed command is the
        working directory of the parent <em class="command">make</em>. This is typically the same as the
        directory the <em class="command">make</em> program was
        executed from, but can be changed with the the <code class="literal">--directory=<em class="replaceable"><code>directory</code></em></code>
        (or <code class="option">-C</code>) command-line option. Note that simply
        specifying a different <em class="filename">makefile</em>
        using <code class="option">â€”file</code> does not change the current directory,
        only the <em class="filename">makefile</em> read.</p><p>æ¯ä¸ªå­è¿›ç¨‹<em class="command">make</em> Spawn éƒ½ä¼šç»§æ‰¿<a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1349" class="indexterm"></a> <a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1350" class="indexterm"></a> <a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1351" class="indexterm"></a> <a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1352" class="indexterm"></a> <a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1353" class="indexterm"></a> <a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1354" class="indexterm"></a>ä¸‰ä¸ªæ ‡å‡†æ–‡ä»¶æè¿°ç¬¦ï¼š<em class="filename">stdin</em>ã€<em class="filename">stdout</em>å’Œ<em class="filename">stderr</em>ã€‚é™¤äº†è§‚å¯Ÿåˆ°å‘½ä»¤è„šæœ¬å¯ä»¥è¯»å–å…¶
        <em class="filename">stdin</em>ä¹‹å¤–ï¼Œè¿™å¹¶ä¸æ˜¯ç‰¹åˆ«å€¼å¾—æ³¨æ„ã€‚è¿™æ˜¯â€œåˆç†çš„â€å¹¶ä¸”æœ‰æ•ˆã€‚è„šæœ¬å®Œæˆè¯»å–åŽï¼Œå…¶ä½™å‘½ä»¤å°†æŒ‰é¢„æœŸæ‰§è¡Œã€‚ä½†æ˜¯<em class="filename">makefile</em>é€šå¸¸æœŸæœ›åœ¨æ²¡æœ‰è¿™ç§äº¤äº’çš„æƒ…å†µä¸‹è¿è¡Œã€‚ç”¨æˆ·é€šå¸¸å¸Œæœ›èƒ½å¤Ÿå¼€å§‹<em class="command">æž„å»º</em>å¹¶â€œç¦»å¼€â€è¯¥è¿‡ç¨‹ï¼Œç¨åŽè¿”å›žæ£€æŸ¥ç»“æžœã€‚å½“ç„¶ï¼Œè¯»å–<em class="filename">stdin</em>ä¹Ÿå¾€å¾€ä¼šä¸ŽåŸºäºŽ<em class="command">cron</em>çš„è‡ªåŠ¨åŒ–æž„å»ºäº¤äº’ä¸è‰¯ã€‚</p><p>Each subprocess <em class="command">make</em> spawns
        inherits <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>the three standard file descriptors: <em class="filename">stdin</em>, <em class="filename">stdout</em>, and <em class="filename">stderr</em>. This is not particularly noteworthy
        except to observe that it is possible for a command script to read its
        <em class="filename">stdin</em>. This is "reasonable" and
        works. Once the script completes its read, the remaining commands are
        executed as expected. But <em class="filename">makefile</em>s are generally expected to run
        without this kind of interaction. Users often expect to be able to
        start a <em class="command">make</em> and "walk away" from
        the process, returning later to examine the results. Of course,
        reading the <em class="filename">stdin</em> will also tend
        to interact poorly with <em class="command">cron</em>-based
        automated builds.</p><p><em class="filename">makefile</em>ä¸­çš„ä¸€ä¸ªå¸¸è§é”™è¯¯æ˜¯æ„å¤–è¯»å–<em class="filename">stdin</em> 
        ï¼š</p><p>A common error in <em class="filename">makefile</em>s
        is to read the <em class="filename">stdin</em>
        accidentally:</p><a id="OEBPS/ch05s04.html.I_5_tt287"></a><pre class="programlisting">$ï¼ˆæ•°æ®æ–‡ä»¶ï¼‰ï¼š$ï¼ˆåŽŸå§‹æ•°æ®ï¼‰
        grep æ¨¡å¼ $(RAW_DATA_FILES) &gt; $@</pre><pre class="programlisting">$(DATA_FILE): $(RAW_DATA)
        grep pattern $(RAW_DATA_FILES) &gt; $@</pre><p>
        è¿™é‡ŒæŒ‡å®šäº†<em class="command">grep</em>çš„è¾“å…¥æ–‡ä»¶<a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1355" class="indexterm"></a> <a id="OEBPS/ch05s04.html.make3-CHP-5-ITERM-1356" class="indexterm"></a>å¸¦æœ‰ä¸€ä¸ªå˜é‡ï¼ˆæœ¬ä¾‹ä¸­æ‹¼å†™é”™è¯¯ï¼‰ã€‚å¦‚æžœå˜é‡æ‰©å±•ä¸ºç©ºï¼Œ<em class="command">åˆ™ grep</em>ä¼šç»§ç»­è¯»å–<em class="filename">æ ‡å‡†è¾“å…¥</em>ï¼Œè€Œä¸ä¼šæç¤ºæˆ–æŒ‡ç¤º<em class="command">make</em>ä¸ºä½•â€œæŒ‚èµ·â€ã€‚è§£å†³æ­¤é—®é¢˜çš„ä¸€ä¸ªç®€å•æ–¹æ³•æ˜¯å§‹ç»ˆåœ¨å‘½ä»¤è¡Œä¸ŠåŒ…å«<em class="filename">/dev/nullä½œä¸ºé™„åŠ â€œæ–‡ä»¶â€ï¼š</em></p><p>Here the input file to <em class="command">grep</em>
        is specified <a class="indexterm"></a> <a class="indexterm"></a>with a variable (misspelled in this example). If the
        variable expands to nothing, the <em class="command">grep</em> is left to read the <em class="filename">stdin</em> with no prompt or indication of why
        the <em class="command">make</em> is "hanging." A simple way
        around this issue is to always include <em class="filename">/dev/null</em> on the command line as an
        additional "file":</p><a id="OEBPS/ch05s04.html.I_5_tt288"></a><pre class="programlisting">$ï¼ˆæ•°æ®æ–‡ä»¶ï¼‰ï¼š$ï¼ˆåŽŸå§‹æ•°æ®ï¼‰
        grep æ¨¡å¼ $(RAW_DATA_FILES) /dev/null &gt; $@</pre><pre class="programlisting">$(DATA_FILE): $(RAW_DATA)
        grep pattern $(RAW_DATA_FILES) /dev/null &gt; $@</pre><p>æ­¤<em class="command">grep</em>å‘½ä»¤æ°¸è¿œä¸ä¼šå°è¯•è¯»å–<em class="filename">stdin</em>ã€‚å½“ç„¶ï¼Œè°ƒè¯•<em class="filename">makefile</em>ä¹Ÿæ˜¯åˆé€‚çš„ï¼</p><p>This <em class="command">grep</em> command will never
        attempt to read <em class="filename">stdin</em>. Of course,
        debugging the <em class="filename">makefile</em> is also
        appropriate!</p></div></div></div>
<div id="OEBPS/ch05s05.html"><div>
<div class="sect1" title="è¯„ä¼°å‘½ä»¤"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch05s05.html.make3-CHP-5-SECT-5"></a>è¯„ä¼°å‘½ä»¤</h1><h1 class="title"><a></a>Evaluating Commands</h1></div></div></div><p>å‘½ä»¤è„šæœ¬å¤„ç†å‘ç”Ÿåœ¨<a id="OEBPS/ch05s05.html.make3-CHP-5-ITERM-1357" class="indexterm"></a>å››ä¸ªæ­¥éª¤ï¼šè¯»å–ä»£ç ã€æ‰©å±•å˜é‡ã€è®¡ç®—
        <em class="command">make</em>è¡¨è¾¾å¼ã€æ‰§è¡Œå‘½ä»¤ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™äº›æ­¥éª¤å¦‚ä½•åº”ç”¨äºŽå¤æ‚çš„å‘½ä»¤è„šæœ¬ã€‚è€ƒè™‘è¿™ä¸ªï¼ˆæœ‰ç‚¹åšä½œçš„ï¼‰<em class="filename">makefile</em>ã€‚é“¾æŽ¥åº”ç”¨ç¨‹åºï¼Œç„¶åŽé€‰æ‹©æ€§åœ°åŽ»é™¤ç¬¦å·å¹¶ä½¿ç”¨<em class="command">upx</em>å¯æ‰§è¡ŒåŠ å£³ç¨‹åºè¿›è¡ŒåŽ‹ç¼©ï¼š</p><p>Command script processing occurs in <a class="indexterm"></a>four steps: read the code, expand variables, evaluate
        <em class="command">make</em> expressions, and execute
        commands. Let's see how these steps apply to a complex command script.
        Consider this (somewhat contrived) <em class="filename">makefile</em>. An application is linked, then
        optionally stripped of symbols and compressed using the <em class="command">upx</em> executable packer:</p><a id="OEBPS/ch05s05.html.I_5_tt289"></a><pre class="programlisting"># $(è°ƒç”¨æ¡å¸¦ç¨‹åºï¼Œæ–‡ä»¶)
å®šä¹‰æ¡å¸¦ç¨‹åº
  è„±è¡£ $1
æ©å¾·å¤«

å¤æ‚è„šæœ¬ï¼š
        $(CC) $^ -o $@
    ifdef æ¡å¸¦
        $(è°ƒç”¨å‰¥ç¦»ç¨‹åºï¼Œ$@)
    ä¸‡ä¸€
        $(å¦‚æžœ$(PACK), upx --æœ€å¥½$@)
        $(è­¦å‘Šæœ€ç»ˆå¤§å°ï¼š$(shell ls -s $@))</pre><pre class="programlisting"># $(call strip-program, file)
define strip-program
  strip $1
endef

complex_script:
        $(CC) $^ -o $@
    ifdef STRIP
        $(call strip-program, $@)
    endif
        $(if $(PACK), upx --best $@)
        $(warning Final size: $(shell ls -s $@))</pre><p>å‘½ä»¤è„šæœ¬çš„è¯„ä¼°è¢«æŽ¨è¿Ÿåˆ°æ‰§è¡ŒåŽï¼Œä½†<code class="literal">ifdef</code>æŒ‡ä»¤æ— è®ºä½•æ—¶å‡ºçŽ°éƒ½ä¼šç«‹å³å¤„ç†ã€‚å› æ­¤ï¼Œ<em class="command">make</em>è¯»å–å‘½ä»¤è„šæœ¬ï¼Œå¿½ç•¥å†…å®¹å¹¶å­˜å‚¨æ¯ä¸€è¡Œâ€‹â€‹ï¼Œç›´åˆ°åˆ°è¾¾ line <code class="literal">ifdef</code> <code class="literal">STRIP</code>ã€‚å®ƒè¯„ä¼°æµ‹è¯•ï¼Œå¦‚æžœ
        <code class="literal">STRIP</code>æœªå®šä¹‰ï¼Œ<em class="command">åˆ™è¯»å–</em>å¹¶ä¸¢å¼ƒç›´åˆ°ï¼ˆåŒ…æ‹¬ç»“æŸï¼‰çš„æ‰€æœ‰æ–‡æœ¬<code class="literal">endif</code>ã€‚
        ç„¶åŽ<em class="command">make</em>ç»§ç»­è¯»å–å¹¶å­˜å‚¨è„šæœ¬çš„å…¶ä½™éƒ¨åˆ†ã€‚</p><p>The evaluation of command scripts is deferred until they are
        executed, but <code class="literal">ifdef</code> directives are
        processed immediately wherever they occur. Therefore, <em class="command">make</em> reads the command script, ignoring the
        content and storing each line until it gets to the line <code class="literal">ifdef</code> <code class="literal">STRIP</code>. It evaluates the test and, if
        <code class="literal">STRIP</code> is not defined, <em class="command">make</em> reads and discards all the text up to
        and including the closing <code class="literal">endif</code>.
        <em class="command">make</em> then continues reading and
        storing the rest of the script.</p><p>å½“è¦æ‰§è¡Œå‘½ä»¤è„šæœ¬æ—¶ï¼Œ<em class="command">make</em>é¦–å…ˆæ‰«æè„šæœ¬ä»¥æŸ¥æ‰¾éœ€è¦æ‰©å±•æˆ–è¯„ä¼°çš„<em class="command">make</em>ç»“æž„ã€‚å±•å¼€å®æ—¶ï¼Œæ¯è¡Œå‰é¢éƒ½ä¼šæ·»åŠ ä¸€ä¸ªå‰å¯¼åˆ¶è¡¨ç¬¦ã€‚å¦‚æžœæ‚¨æ²¡æœ‰åšå¥½å‡†å¤‡ï¼Œåœ¨æ‰§è¡Œä»»ä½•å‘½ä»¤ä¹‹å‰è¿›è¡Œæ‰©å±•å’Œè¯„ä¼°å¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„æ‰§è¡Œé¡ºåºã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œè„šæœ¬çš„æœ€åŽä¸€è¡Œæ˜¯é”™è¯¯çš„ã€‚<code class="function">shell</code>å’Œå‘½ä»¤
        åœ¨é“¾æŽ¥åº”ç”¨ç¨‹åº<span class="emphasis"><em>ä¹‹å‰</em></span><code class="function">warning</code>æ‰§è¡Œ
        ã€‚å› æ­¤ï¼Œ
         <em class="command">ls</em>å‘½ä»¤å°†åœ¨å…¶æ­£åœ¨æ£€æŸ¥çš„æ–‡ä»¶æ›´æ–°ä¹‹å‰æ‰§è¡Œã€‚è¿™è§£é‡Šäº†å‰é¢<a class="link" href="#OEBPS/ch05.html.make3-CHP-5-SECT-1" title="è§£æžå‘½ä»¤">ç¬¬ 5.1 èŠ‚</a>ä¸­çœ‹åˆ°çš„â€œä¹±åºâ€è¾“å‡ºã€‚<span class="emphasis"><em></em></span><em class="command"></em><a class="link" href="#OEBPS/ch05.html.make3-CHP-5-SECT-1" title="è§£æžå‘½ä»¤"></a></p><p>When a command script is to be executed, <em class="command">make</em> first scans the script for <em class="command">make</em> constructs that need to be expanded or
        evaluated. When macros are expanded, a leading tab is prepended to
        each line. Expanding and evaluating before any commands are executed
        can lead to an unexpected execution order if you aren't prepared for
        it. In our example, the last line of the script is wrong. The
        <code class="function">shell</code> and <code class="function">warning</code> commands are executed
        <span class="emphasis"><em>before</em></span> linking the application. Therefore, the
        <em class="command">ls</em> command will be executed before
        the file it is examining has been updated. This explains the "out of
        order" output seen earlier in <a class="link" href="#OEBPS/ch05.html.make3-CHP-5-SECT-1" title="Parsing Commands">Section 5.1</a>.</p><p>å¦è¯·æ³¨æ„ï¼Œè¯¥<code class="literal">ifdef</code>
        <code class="literal">STRIP</code>è¡Œæ˜¯åœ¨è¯»å–æ–‡ä»¶æ—¶è¯„ä¼°çš„ï¼Œä½†è¯¥è¡Œæ˜¯åœ¨æ‰§è¡Œ<code class="literal">$(if...)</code>
        å‘½ä»¤ä¹‹å‰ç«‹å³è¯„ä¼°çš„ã€‚<code class="literal">complex_script</code>ä½¿ç”¨è¯¥
        <code class="function">if</code>å‡½æ•°æ›´åŠ çµæ´»ï¼Œå› ä¸ºæœ‰æ›´å¤šæœºä¼šæŽ§åˆ¶ä½•æ—¶å®šä¹‰å˜é‡ï¼Œä½†å®ƒä¸å¤ªé€‚åˆç®¡ç†å¤§æ–‡æœ¬å—ã€‚</p><p>Also, notice that the <code class="literal">ifdef</code>
        <code class="literal">STRIP</code> line is evaluated while
        reading the file, but the <code class="literal">$(if...)</code>
        line is evaluated immediately before the commands for <code class="literal">complex_script</code> are executed. Using the
        <code class="function">if</code> function is more flexible
        since there are more opportunities to control when the variable is
        defined, but it is not very well suited for managing large blocks of
        text.</p><p>æ­£å¦‚æœ¬ä¾‹æ‰€ç¤ºï¼Œå§‹ç»ˆæ³¨æ„å“ªä¸ªç¨‹åºæ­£åœ¨è®¡ç®—è¡¨è¾¾å¼ï¼ˆä¾‹å¦‚<em class="command">make</em>æˆ– shellï¼‰ä»¥åŠä½•æ—¶æ‰§è¡Œè®¡ç®—ï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼š</p><p>As this example shows, it is important to always attend to what
        program is evaluating an expression (e.g., <em class="command">make</em> or the shell) and when the evaluation
        is performed:</p><a id="OEBPS/ch05s05.html.I_5_tt290"></a><pre class="programlisting">$(LINK.c) $(shell find $(if $(ALL),$(é€šé…ç¬¦ core ext*),core) -name '*.o')</pre><pre class="programlisting">$(LINK.c) $(shell find $(if $(ALL),$(wildcard core ext*),core) -name '*.o')</pre><p>è¿™ä¸ªå¤æ‚çš„å‘½ä»¤è„šæœ¬å°è¯•é“¾æŽ¥ä¸€ç»„ç›®æ ‡æ–‡ä»¶ã€‚è¯„ä¼°çš„é¡ºåºå’Œæ‰§è¡Œæ“ä½œçš„ç¨‹åºï¼ˆåœ¨æ‹¬å·ä¸­ï¼‰æ˜¯ï¼š</p><p>This convoluted command script attempts to link a set of object
        files. The sequence of evaluation and the program performing the
        operation (in parentheses) is:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>å±•å¼€<code class="literal">$ALL</code>ï¼ˆ<em class="command">åˆ¶ä½œ</em>ï¼‰ã€‚</p></li><li class="listitem"><p>Expand <code class="literal">$ALL</code> (<em class="command">make</em>).</p></li><li class="listitem"><p>è¯„ä¼°<code class="function">if</code>ï¼ˆ<em class="command">åšå‡º</em>ï¼‰ã€‚</p></li><li class="listitem"><p>Evaluate <code class="function">if</code> (<em class="command">make</em>).</p></li><li class="listitem"><p>è¯„ä¼°<code class="function">wildcard</code>ï¼Œå‡è®¾<code class="literal">ALL</code>ä¸ä¸ºç©º ( <em class="command">make</em> )ã€‚</p></li><li class="listitem"><p>Evaluate the <code class="function">wildcard</code>,
            assuming <code class="literal">ALL</code> is not empty
            (<em class="command">make</em>).</p></li><li class="listitem"><p>è¯„ä¼°<code class="function">shell</code>
            ï¼ˆ<em class="command">åˆ¶ä½œ</em>ï¼‰ã€‚</p></li><li class="listitem"><p>Evaluate the <code class="function">shell</code>
            (<em class="command">make</em>).</p></li><li class="listitem"><p>æ‰§è¡ŒæŸ¥æ‰¾<em class="command">ï¼ˆ</em> 
            sh <em class="command">ï¼‰</em>ã€‚</p></li><li class="listitem"><p>Execute the <em class="command">find</em>
            (<em class="command">sh</em>).</p></li><li class="listitem"><p><em class="command">å®Œæˆmake</em>ç»“æž„çš„æ‰©å±•å’Œè¯„ä¼°åŽ
            ï¼Œæ‰§è¡Œé“¾æŽ¥å‘½ä»¤ ( <em class="command">sh</em> )ã€‚</p></li><li class="listitem"><p>After completing the expansion and evaluation of the
            <em class="command">make</em> constructs, execute the
            link command (<em class="command">sh</em>).</p></li></ol></div></div></div></div>
<div id="OEBPS/ch05s06.html"><div>
<div class="sect1" title="å‘½ä»¤è¡Œé™åˆ¶"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch05s06.html.make3-CHP-5-SECT-6"></a>å‘½ä»¤è¡Œé™åˆ¶</h1><h1 class="title"><a></a>Command-Line Limits</h1></div></div></div><p>åœ¨å¤„ç†å¤§åž‹é¡¹ç›®æ—¶ï¼Œæ‚¨å¶å°”ä¼š<a id="OEBPS/ch05s06.html.make3-CHP-5-ITERM-1358" class="indexterm"></a><em class="command">make</em>å°è¯•æ‰§è¡Œçš„å‘½ä»¤é•¿åº¦å—åˆ°é™åˆ¶
        ã€‚å‘½ä»¤è¡Œé™åˆ¶éšæ“ä½œç³»ç»Ÿçš„ä¸åŒè€Œæœ‰å¾ˆå¤§å·®å¼‚ã€‚ Red Hat 9 GNU/Linux ä¼¼ä¹Žæœ‰å¤§çº¦ 128K å­—ç¬¦çš„é™åˆ¶ï¼Œè€Œ Windows XP åˆ™æœ‰ 32K å­—ç¬¦çš„é™åˆ¶ã€‚ç”Ÿæˆçš„é”™è¯¯æ¶ˆæ¯ä¹Ÿå„ä¸ç›¸åŒã€‚åœ¨ä½¿ç”¨ Cygwin ç«¯å£çš„ Windows ä¸Šï¼Œæ¶ˆæ¯ä¸ºï¼š</p><p>When working with large projects, you occasionally <a class="indexterm"></a>bump up against limitations in the length of commands
        <em class="command">make</em> tries to execute. Command-line
        limits vary widely with the operating system. Red Hat 9 GNU/Linux
        appears to have a limit of about 128K characters, while Windows XP has
        a limit of 32K. The error message generated also varies. On Windows
        using the Cygwin port, the message is:</p><a id="OEBPS/ch05s06.html.I_5_tt291"></a><pre class="programlisting">C:\usr\cygwin\bin\bash: /usr/bin/ls: æ— æ•ˆå‚æ•°</pre><pre class="programlisting">C:\usr\cygwin\bin\bash: /usr/bin/ls: Invalid argument</pre><p>å½“<em class="command">ls</em>ç»™å‡ºçš„å‚æ•°åˆ—è¡¨å¤ªé•¿æ—¶ã€‚åœ¨ Red Hat 9 ä¸Šï¼Œæ¶ˆæ¯æ˜¯ï¼š</p><p>when <em class="command">ls</em> is given too long an
        argument list. On Red Hat 9 the message is:</p><a id="OEBPS/ch05s06.html.I_5_tt292"></a><pre class="programlisting">/bin/lsï¼šå‚æ•°åˆ—è¡¨å¤ªé•¿</pre><pre class="programlisting">/bin/ls: argument list too long</pre><p>å¯¹äºŽå‘½ä»¤è¡Œæ¥è¯´ï¼Œå³ä½¿ 32K å¬èµ·æ¥ä¹Ÿå¾ˆå¤§ï¼Œä½†æ˜¯å½“æ‚¨çš„é¡¹ç›®åœ¨ 100 ä¸ªå­ç›®å½•ä¸­åŒ…å« 3,000 ä¸ªæ–‡ä»¶å¹¶ä¸”æ‚¨æƒ³è¦æ“ä½œæ‰€æœ‰æ–‡ä»¶æ—¶ï¼Œæ­¤é™åˆ¶å¯èƒ½ä¼šå—åˆ°é™åˆ¶ã€‚</p><p>Even 32K sounds like a lot of data for a command line, but when
        your project contains 3,000 files in 100 subdirectories and you want
        to manipulate them all, this limit can be constraining.</p><p>æœ‰ä¸¤ç§åŸºæœ¬æ–¹æ³•å¯ä»¥è®©æ‚¨é™·å…¥å›°å¢ƒï¼šä½¿ç”¨ shell å·¥å…·æ‰©å±•ä¸€äº›åŸºæœ¬å€¼ï¼Œæˆ–è€…ä½¿ç”¨<em class="command">make</em>æœ¬èº«å°†å˜é‡è®¾ç½®ä¸ºå¾ˆé•¿çš„å€¼ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³åœ¨å•ä¸ªå‘½ä»¤è¡Œä¸­ç¼–è¯‘æ‰€æœ‰æºæ–‡ä»¶ï¼š</p><p>There are two basic ways to get yourself into this mess: expand
        some basic value using shell tools, or use <em class="command">make</em> itself to set a variable to a very long
        value. For example, suppose we want to compile all our source files in
        a single command line:</p><a id="OEBPS/ch05s06.html.I_5_tt293"></a><pre class="programlisting">ç¼–è¯‘å…¨éƒ¨ï¼š
        $(JAVAC) $(é€šé…ç¬¦ $(addsuffix /*.java,$(source_dirs)))</pre><pre class="programlisting">compile_all:
        $(JAVAC) $(wildcard $(addsuffix /*.java,$(source_dirs)))</pre><p>makeå˜é‡å¯èƒ½åªåŒ…å«å‡ ç™¾ä¸ªå•è¯ï¼Œä½†æ˜¯åœ¨é™„åŠ  Java æ–‡ä»¶çš„é€šé…ç¬¦å¹¶ä½¿ç”¨ æ‰©å±•å®ƒä¹‹åŽï¼Œ<em class="command">è¿™ä¸ª</em>åˆ—è¡¨å¾ˆå®¹æ˜“è¶…å‡ºç³»ç»Ÿçš„å‘½ä»¤è¡Œé™åˆ¶ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œ<em class="command">make</em>æ²¡æœ‰å†…ç½®çš„é™åˆ¶æ¥çº¦æŸæˆ‘ä»¬ã€‚åªè¦æœ‰å¯ç”¨çš„è™šæ‹Ÿå†…å­˜ï¼Œ<em class="command">make</em>å°±å…è®¸æ‚¨åˆ›å»ºä»»æ„æ•°é‡çš„æ•°æ®ã€‚<code class="literal">source_dirs</code><code class="function">wildcard</code><em class="command"></em><em class="command"></em></p><p>The <em class="command">make</em> variable <code class="literal">source_dirs</code> may contain only a couple
        hundred words, but after appending the wildcard for Java files and
        expanding it using <code class="function">wildcard</code>, this
        list can easily exceed the command-line limit of the system. By the
        way, <em class="command">make</em> has no built-in limits to
        constrain us. So long as there is virtual memory available, <em class="command">make</em> will allow any amount of data you care
        to create.</p><p>å½“ä½ å‘çŽ°è‡ªå·±å¤„äºŽè¿™ç§æƒ…å†µæ—¶ï¼Œæ„Ÿè§‰å°±åƒå¤è€çš„å†’é™©æ¸¸æˆä¸€æ ·ï¼Œâ€œä½ å¤„äºŽä¸€ä¸ªæ›²æŠ˜çš„è¿·å®«ä¸­ï¼Œé€šé“éƒ½æ˜¯ç›¸ä¼¼çš„ã€‚â€ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½å°è¯•ä½¿ç”¨<em class="command">xargs</em>è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå› ä¸º<em class="command">xargs</em>å°†é€šè¿‡å°†å‚æ•°åˆ†é…åˆ°ç³»ç»Ÿç‰¹å®šçš„é•¿åº¦æ¥ç®¡ç†é•¿å‘½ä»¤è¡Œï¼š</p><p>When you find yourself in this situation, it can feel like the
        old Adventure game, "You are in a twisty maze of passages all alike."
        For instance, you might try to solve the above using <em class="command">xargs</em>, since <em class="command">xargs</em> will manage long command lines by
        parceling out arguments up to the system-specific length:</p><a id="OEBPS/ch05s06.html.I_5_tt294"></a><pre class="programlisting">ç¼–è¯‘å…¨éƒ¨ï¼š
        echo $(é€šé…ç¬¦$(addsuffix /*.java,$(source_dirs))) | \
        xargs $(JAVAC)</pre><pre class="programlisting">compile_all:
        echo $(wildcard $(addsuffix /*.java,$(source_dirs))) | \
        xargs $(JAVAC)</pre><p>ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬åˆšåˆšå°†å‘½ä»¤è¡Œé™åˆ¶é—®é¢˜ä»Ž<em class="command">javac</em>å‘½ä»¤è¡Œè½¬ç§»åˆ°äº†
        <em class="command">echo</em>å‘½ä»¤<a id="OEBPS/ch05s06.html.make3-CHP-5-ITERM-1359" class="indexterm"></a> <a id="OEBPS/ch05s06.html.make3-CHP-5-ITERM-1360" class="indexterm"></a>çº¿ã€‚åŒæ ·ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨<em class="command">echo</em>æˆ–<em class="command">printf</em>å°†æ•°æ®å†™å…¥æ–‡ä»¶ï¼ˆå‡è®¾ç¼–è¯‘å™¨å¯ä»¥ä»Žæ–‡ä»¶ä¸­è¯»å–æ–‡ä»¶åˆ—è¡¨ï¼‰ã€‚</p><p>Unfortunately, we've just moved the command-line limit problem
        from the <em class="command">javac</em> command line to the
        <em class="command">echo</em> command <a class="indexterm"></a> <a class="indexterm"></a>line. Similarly, we cannot use <em class="command">echo</em> or <em class="command">printf</em> to write the data to a file (assuming
        the compiler can read the file list from a file).</p><p>ä¸ï¼Œå¤„ç†è¿™ç§æƒ…å†µçš„æ–¹æ³•æ˜¯é¦–å…ˆé¿å…ä¸€æ¬¡åˆ›å»ºæ‰€æœ‰æ–‡ä»¶åˆ—è¡¨ã€‚ç›¸åï¼Œä½¿ç”¨ shell ä¸€æ¬¡éåŽ†ä¸€ä¸ªç›®å½•ï¼š</p><p>No, the way to handle this situation is to avoid creating the
        file list all at once in the first place. Instead, use the shell to
        glob one directory at a time:</p><a id="OEBPS/ch05s06.html.I_5_tt295"></a><pre class="programlisting">ç¼–è¯‘å…¨éƒ¨ï¼š
        for d in $(source_dirs); \
        åš \
            $(JAVAC) $$d/*.java; \
        å®Œæ¯•</pre><pre class="programlisting">compile_all:
        for d in $(source_dirs); \
        do                       \
            $(JAVAC) $$d/*.java; \
        done</pre><p>æˆ‘ä»¬è¿˜å¯ä»¥å°†æ–‡ä»¶åˆ—è¡¨é€šè¿‡ç®¡é“ä¼ è¾“åˆ°<em class="command">xargs</em>ï¼Œä»¥æ›´å°‘çš„æ‰§è¡Œæ¬¡æ•°æ¥æ‰§è¡Œä»»åŠ¡ï¼š</p><p>We could also pipe the file list to <em class="command">xargs</em> to perform the task with fewer
        executions:</p><a id="OEBPS/ch05s06.html.I_5_tt296"></a><pre class="programlisting">ç¼–è¯‘å…¨éƒ¨ï¼š
        for d in $(source_dirs); \
        åš \
            å›žå£° $$d/*.java; \
        å®Œæˆ | \
        xargs $(JAVAC)</pre><pre class="programlisting">compile_all:
        for d in $(source_dirs); \
        do                       \
            echo $$d/*.java;     \
        done |                   \
        xargs $(JAVAC)</pre><p>é—æ†¾çš„æ˜¯ï¼Œè¿™äº›å‘½ä»¤è„šæœ¬éƒ½æ²¡æœ‰æ­£ç¡®å¤„ç†ç¼–è¯‘æœŸé—´çš„é”™è¯¯ã€‚å¦‚æžœç¼–è¯‘å™¨æ”¯æŒä»Žæ–‡ä»¶ä¸­è¯»å–å…¶å‚æ•°ï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯ä¿å­˜å®Œæ•´çš„æ–‡ä»¶åˆ—è¡¨å¹¶å°†å…¶æä¾›ç»™ç¼–è¯‘å™¨ã€‚ Java ç¼–è¯‘å™¨æ”¯æŒæ­¤åŠŸèƒ½ï¼š</p><p>Sadly, neither of these command scripts handle errors during
        compilation properly. A better approach would be to save the full file
        list and feed it to the compiler, if the compiler supports reading its
        arguments from a file. Java compilers support this feature:</p><a id="OEBPS/ch05s06.html.I_5_tt297"></a><pre class="programlisting">ç¼–è¯‘å…¨éƒ¨ï¼š$(FILE_LIST)
        $(JAVA)@$&lt;

.INTERMEDIATEï¼š$(FILE_LIST)
$ï¼ˆæ–‡ä»¶åˆ—è¡¨ï¼‰ï¼š
        for d in $(source_dirs); \
        åš \
            å›žå£° $$d/*.java; \
        å®Œæˆ &gt; $@</pre><pre class="programlisting">compile_all: $(FILE_LIST)
        $(JAVA) @$&lt;

.INTERMEDIATE: $(FILE_LIST)
$(FILE_LIST):
        for d in $(source_dirs); \
        do                       \
            echo $$d/*.java;     \
        done &gt; $@</pre><p><em class="command">è¯·æ³¨æ„for</em>å¾ªçŽ¯ä¸­çš„å¾®å¦™é”™è¯¯ã€‚å¦‚æžœä»»ä½•ç›®å½•ä¸åŒ…å« Java æ–‡ä»¶ï¼Œåˆ™è¯¥å­—ç¬¦ä¸²<code class="literal">*.java</code>å°†åŒ…å«åœ¨æ–‡ä»¶åˆ—è¡¨ä¸­ï¼Œå¹¶ä¸” Java ç¼–è¯‘å™¨å°†ç”Ÿæˆâ€œæ‰¾ä¸åˆ°æ–‡ä»¶â€é”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®é€‰é¡¹ä½¿
        <em class="command">bash</em>æŠ˜å ç©ºçš„é€šé…æ¨¡å¼<code class="literal">nullglob</code>
        ã€‚</p><p>Notice the subtle error in the <em class="command">for</em> loop. If any of the directories does not
        contain a Java file, the string <code class="literal">*.java</code> will be included in the file list and
        the Java compiler will generate a "File not found" error. We can make
        <em class="command">bash</em> collapse empty globbing
        patterns by setting the <code class="literal">nullglob</code>
        option.</p><a id="OEBPS/ch05s06.html.I_5_tt298"></a><pre class="programlisting">ç¼–è¯‘å…¨éƒ¨ï¼š$(FILE_LIST)
        $(JAVA)@$&lt;

.INTERMEDIATEï¼š$(FILE_LIST)
$ï¼ˆæ–‡ä»¶åˆ—è¡¨ï¼‰ï¼š
        shopt -s nullglobï¼› \
        for d in $(source_dirs); \
        åš \
            å›žå£° $$d/*.java; \
        å®Œæˆ &gt; $@</pre><pre class="programlisting">compile_all: $(FILE_LIST)
        $(JAVA) @$&lt;

.INTERMEDIATE: $(FILE_LIST)
$(FILE_LIST):
        shopt -s nullglob;       \
        for d in $(source_dirs); \
        do                       \
            echo $$d/*.java;     \
        done &gt; $@</pre><p>è®¸å¤šé¡¹ç›®å¿…é¡»åˆ¶ä½œæ–‡ä»¶åˆ—è¡¨ã€‚è¿™æ˜¯ä¸€ä¸ªåŒ…å«ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨çš„<em class="command">bash</em>è„šæœ¬çš„å®ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦æ›´æ”¹åˆ°çš„æ ¹ç›®å½•ã€‚åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ–‡ä»¶éƒ½å°†ç›¸å¯¹äºŽè¯¥æ ¹ç›®å½•ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”¨äºŽæœç´¢åŒ¹é…æ–‡ä»¶çš„ç›®å½•åˆ—è¡¨ã€‚ç¬¬ä¸‰ä¸ªå’Œç¬¬å››ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œä»£è¡¨æ–‡ä»¶åŽç¼€ã€‚</p><p>Many projects have to make lists of files. Here is a macro
        containing a <em class="command">bash</em> script producing
        file lists. The first argument is the root directory to change to. All
        the files in the list will be relative to this root directory. The
        second argument is a list of directories to search for matching files.
        The third and fourth arguments are optional and represent file
        suffixes.</p><a id="OEBPS/ch05s06.html.I_5_tt299"></a><pre class="programlisting"># $(è°ƒç”¨collect-names, root-dir, dir-list, suffix1-opt, suffix2-opt)
å®šä¹‰æ”¶é›†åç§°
  echo ä»Žç›®å½•åˆ—è¡¨ä¸­åˆ›å»º$@...
  å…‰ç›˜1ç¾Žå…ƒï¼› \
  shopt -s nullglobï¼› \
  for f in $(foreach file,$2,'$(file)');åš \
    æ–‡ä»¶=( $$f$(å¦‚æžœ$3,/*.{$3$(å¦‚æžœ$4,$(é€—å·)$4)}) ); \
    if (( $${#files[@]} &gt; 0 )); \
    ç„¶åŽ \
      printf '"%s"\n' $${files[@]}; \
    åˆ«çš„ ï¼š;è²ï¼› \
  å®Œæ¯•
æ©å¾·å¤«</pre><pre class="programlisting"># $(call collect-names, root-dir, dir-list, suffix1-opt, suffix2-opt)
define collect-names
  echo Making $@ from directory list...
  cd $1;                                                    \
  shopt -s nullglob;                                        \
  for f in $(foreach file,$2,'$(file)'); do                 \
    files=( $$f$(if $3,/*.{$3$(if $4,$(comma)$4)}) );       \
    if (( $${#files[@]} &gt; 0 ));                             \
    then                                                    \
      printf '"%s"\n' $${files[@]};                         \
    else :; fi;                                             \
  done
endef</pre><p>ä»¥ä¸‹æ˜¯åˆ›å»ºå›¾åƒæ–‡ä»¶åˆ—è¡¨çš„æ¨¡å¼è§„åˆ™ï¼š</p><p>Here is a pattern rule for creating a list of image
        files:</p><a id="OEBPS/ch05s06.html.I_5_tt300"></a><pre class="programlisting">ï¼…ã€‚å›¾ç‰‡ï¼š
        @$(è°ƒç”¨æ”¶é›†åç§°,$(SOURCE_DIR),$^,gif,jpeg) &gt; $@</pre><pre class="programlisting">%.images:
        @$(call collect-names,$(SOURCE_DIR),$^,gif,jpeg) &gt; $@</pre><p>å®æ‰§è¡Œæ˜¯éšè—çš„ï¼Œå› ä¸ºè„šæœ¬å¾ˆé•¿ï¼Œå¹¶ä¸”å¾ˆå°‘æœ‰ç†ç”±å‰ªåˆ‡å’Œç²˜è´´æ­¤ä»£ç ã€‚å…ˆå†³æ¡ä»¶ä¸­æä¾›äº†ç›®å½•åˆ—è¡¨ã€‚æ›´æ”¹åˆ°æ ¹ç›®å½•åŽï¼Œè¯¥è„šæœ¬å¯ç”¨ç©ºé€šé…ã€‚å‰©ä¸‹çš„å°±æ˜¯ä¸€ä¸ª<em class="command">for</em>å¾ªçŽ¯æ¥å¤„ç†æˆ‘ä»¬æƒ³è¦æœç´¢çš„æ¯ä¸ªç›®å½•ã€‚æ–‡ä»¶æœç´¢è¡¨è¾¾å¼æ˜¯ä¼ å…¥å‚æ•°çš„å•è¯åˆ—è¡¨<code class="literal">$2</code>ã€‚è¯¥è„šæœ¬ä½¿ç”¨å•å¼•å·ä¿æŠ¤æ–‡ä»¶åˆ—è¡¨ä¸­çš„å•è¯ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½åŒ…å« shell ç‰¹æ®Šå­—ç¬¦ã€‚ç‰¹åˆ«æ˜¯ï¼ŒJava ç­‰è¯­è¨€ä¸­çš„æ–‡ä»¶åå¯ä»¥åŒ…å«ç¾Žå…ƒç¬¦å·ï¼š</p><p>The macro execution is hidden because the script is long and
        there is seldom a reason to cut and paste this code. The directory
        list is provided in the prerequisites. After changing to the root
        directory, the script enables null globbing. The rest is a <em class="command">for</em> loop to process each directory we want
        to search. The file search expression is a list of words passed in
        parameter <code class="literal">$2</code>. The script protects
        words in the file list with single quotes because they may contain
        shell-special characters. In particular, filenames in languages like
        Java can contain dollar signs:</p><a id="OEBPS/ch05s06.html.I_5_tt301"></a><pre class="programlisting">for f in $(foreach file,$2,'$(file)');åš</pre><pre class="programlisting">for f in $(foreach file,$2,'$(file)'); do</pre><p><code class="literal">files</code>æˆ‘ä»¬é€šè¿‡å¡«å……æ•°ç»„æ¥æœç´¢ç›®å½•<a id="OEBPS/ch05s06.html.make3-CHP-5-ITERM-1361" class="indexterm"></a> <a id="OEBPS/ch05s06.html.make3-CHP-5-ITERM-1362" class="indexterm"></a>é€šé…ç¬¦çš„ç»“æžœã€‚å¦‚æžœ<code class="literal">files</code>æ•°ç»„åŒ…å«ä»»ä½•å…ƒç´ ï¼Œæˆ‘ä»¬ä½¿ç”¨
        <em class="command">printf</em>å†™å…¥æ¯ä¸ªå•è¯ï¼ŒåŽè·Ÿæ¢è¡Œç¬¦ã€‚ä½¿ç”¨æ•°ç»„å…è®¸å®æ­£ç¡®å¤„ç†å¸¦æœ‰åµŒå…¥ç©ºæ ¼çš„è·¯å¾„ã€‚è¿™ä¹Ÿæ˜¯<em class="command">printf</em>ç”¨åŒå¼•å·å°†æ–‡ä»¶åå¼•èµ·æ¥çš„åŽŸå› ã€‚</p><p>We search a directory by filling the <code class="literal">files</code> array <a class="indexterm"></a> <a class="indexterm"></a>with the result of globbing. If the <code class="literal">files</code> array contains any elements, we use
        <em class="command">printf</em> to write each word followed
        by a newline. Using the array allows the macro to properly handle
        paths with embedded spaces. This is also the reason <em class="command">printf</em> surrounds the filename with double
        quotes.</p><p>æ–‡ä»¶åˆ—è¡¨æ˜¯ç”¨ä»¥ä¸‹è¡Œç”Ÿæˆçš„ï¼š</p><p>The file list is produced with the line:</p><a id="OEBPS/ch05s06.html.I_5_tt302"></a><pre class="programlisting">æ–‡ä»¶=( $$f$(å¦‚æžœ$3,/*.{$3$(å¦‚æžœ$4,$(é€—å·)$4)}) );</pre><pre class="programlisting">files=( $$f$(if $3,/*.{$3$(if $4,$(comma)$4)}) );</pre><p>æ˜¯<code class="literal">$$f</code>å®çš„ç›®å½•æˆ–æ–‡ä»¶å‚æ•°ã€‚ä»¥ä¸‹è¡¨è¾¾å¼æ˜¯<em class="command">make</em> <code class="function">if</code>
        æµ‹è¯•ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å¦ä¸ºéžç©ºã€‚è¿™æ˜¯å®žçŽ°å¯é€‰å‚æ•°çš„æ–¹æ³•ã€‚å¦‚æžœç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºç©ºï¼Œåˆ™å‡å®šç¬¬å››ä¸ªå‚æ•°ä¹Ÿä¸ºç©ºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä¼ é€’çš„æ–‡ä»¶åº”è¯¥æŒ‰åŽŸæ ·åŒ…å«åœ¨æ–‡ä»¶åˆ—è¡¨ä¸­ã€‚è¿™å…è®¸å®æž„å»ºé€šé…ç¬¦æ¨¡å¼ä¸åˆé€‚çš„ä»»æ„æ–‡ä»¶åˆ—è¡¨ã€‚å¦‚æžœæä¾›äº†ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œåˆ™<code class="function">if</code>é™„åŠ <code class="literal">/*.{$3}</code>åˆ°æ ¹æ–‡ä»¶ã€‚å¦‚æžœæä¾›äº†ç¬¬å››ä¸ªå‚æ•°ï¼Œå®ƒå°†é™„åŠ <code class="literal">,$4</code>åœ¨<code class="literal">$3</code>.è¯·æ³¨æ„æˆ‘ä»¬å¿…é¡»ä½¿ç”¨çš„è¯¡è®¡æ¥å°†é€—å·æ’å…¥åˆ°é€šé…ç¬¦æ¨¡å¼ä¸­ã€‚é€šè¿‡åœ¨<em class="command">make</em>å˜é‡ä¸­æ”¾ç½®é€—å·ï¼Œ
        æˆ‘ä»¬å¯ä»¥å°†å…¶å·å·åœ°é€šè¿‡è§£æžå™¨ï¼Œå¦åˆ™ï¼Œé€—å·å°†è¢«è§£é‡Šä¸º<em class="replaceable"><code>then</code></em>å°†éƒ¨åˆ†
        <em class="replaceable"><code>else</code></em>ä¸Ž<code class="function">if</code>.çš„å®šä¹‰<code class="literal">comma</code>å¾ˆç®€å•ï¼š</p><p>The <code class="literal">$$f</code> is the directory or
        file argument to the macro. The following expression is a <em class="command">make</em> <code class="function">if</code>
        testing whether the third argument is nonempty. This is how you can
        implement optional arguments. If the third argument is empty, it is
        assumed the fourth is as well. In this case, the file passed by the
        user should be included in the file list as is. This allows the macro
        to build lists of arbitrary files for which wildcard patterns are
        inappropriate. If the third argument is provided, the <code class="function">if</code> appends <code class="literal">/*.{$3}</code> to the root file. If the fourth
        argument is provided, it appends <code class="literal">,$4</code> after the <code class="literal">$3</code>. Notice the subterfuge we must use to
        insert a comma into the wildcard pattern. By placing a comma in a
        <em class="command">make</em> variable we can sneak it past
        the parser, otherwise, the comma would be interpreted as separating
        the <em class="replaceable"><code>then</code></em> part from the
        <em class="replaceable"><code>else</code></em> part of the <code class="function">if</code>. The definition of <code class="literal">comma</code> is straightforward:</p><a id="OEBPS/ch05s06.html.I_5_tt303"></a><pre class="programlisting">é€—å· := ,</pre><pre class="programlisting">comma := ,</pre><p>å‰é¢çš„æ‰€æœ‰<em class="command">for</em>å¾ªçŽ¯ä¹Ÿå—åˆ°å‘½ä»¤è¡Œé•¿åº¦é™åˆ¶ï¼Œå› ä¸ºå®ƒä»¬ä½¿ç”¨é€šé…ç¬¦æ‰©å±•ã€‚ä¸åŒä¹‹å¤„åœ¨äºŽé€šé…ç¬¦æ˜¯ç”¨å•ä¸ªç›®å½•çš„å†…å®¹æ‰©å±•çš„ï¼Œè¶…å‡ºé™åˆ¶çš„å¯èƒ½æ€§è¦å°å¾—å¤šã€‚</p><p>All the preceding <em class="command">for</em> loops
        also suffer from the command-line length limit, since they use
        wildcard expansion. The difference is that the wildcard is expanded
        with the contents of a single directory, which is far less likely to
        exceed the limits.</p><p><em class="command">å¦‚æžœmake</em>
        å˜é‡åŒ…å«æˆ‘ä»¬çš„é•¿æ–‡ä»¶åˆ—è¡¨ï¼Œæˆ‘ä»¬è¯¥æ€Žä¹ˆåŠžï¼Ÿå¥½å§ï¼Œé‚£ä¹ˆæˆ‘ä»¬çœŸçš„æœ‰éº»çƒ¦äº†ã€‚æˆ‘å‘çŽ°åªæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å°†å¾ˆé•¿çš„
        <em class="command">make</em>å˜é‡ä¼ é€’ç»™å­ shellã€‚ç¬¬ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡è¿‡æ»¤å†…å®¹ä»…å°†å˜é‡å†…å®¹çš„å­é›†ä¼ é€’ç»™ä»»ä½•ä¸€ä¸ªå­ shell è°ƒç”¨ã€‚</p><p>What do we do if a <em class="command">make</em>
        variable contains our long file list? Well, then we are in real
        trouble. There are only two ways I've found to pass a very long
        <em class="command">make</em> variable to a subshell. The
        first approach is to pass only a subset of the variable contents to
        any one subshell invocation by filtering the contents.</p><a id="OEBPS/ch05s06.html.I_5_tt304"></a><pre class="programlisting">ç¼–è¯‘å…¨éƒ¨ï¼š
        $(JAVAC) $(å•è¯åˆ—è¡¨ 1, 499, $(æ‰€æœ‰æºæ–‡ä»¶))
        $(JAVAC) $(å•è¯åˆ—è¡¨ 500, 999, $(æ‰€æœ‰æºæ–‡ä»¶))
        $(JAVAC) $(å•è¯åˆ—è¡¨ 1000, 1499, $(æ‰€æœ‰æºæ–‡ä»¶))</pre><pre class="programlisting">compile_all:
        $(JAVAC) $(wordlist 1, 499, $(all-source-files))
        $(JAVAC) $(wordlist 500, 999, $(all-source-files))
        $(JAVAC) $(wordlist 1000, 1499, $(all-source-files))</pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥<code class="function">filter</code>å‡½æ•°ï¼Œä½†è¿™å¯èƒ½æ›´åŠ ä¸ç¡®å®šï¼Œå› ä¸ºæ‰€é€‰æ–‡ä»¶çš„æ•°é‡å°†å–å†³äºŽæ‰€é€‰æ¨¡å¼ç©ºé—´å†…çš„åˆ†å¸ƒã€‚è¿™é‡Œæˆ‘ä»¬æ ¹æ®å­—æ¯è¡¨é€‰æ‹©ä¸€ä¸ªæ¨¡å¼ï¼š</p><p>The <code class="function">filter</code> function can be
        used as well, but that can be more uncertain since the number of files
        selected will depend on the distribution within the pattern space
        chosen. Here we choose a pattern based on the alphabet:</p><a id="OEBPS/ch05s06.html.I_5_tt305"></a><pre class="programlisting">ç¼–è¯‘å…¨éƒ¨ï¼š
        $(JAVAC) $(è¿‡æ»¤ a%, $(æ‰€æœ‰æºæ–‡ä»¶))
        $(JAVAC) $(è¿‡æ»¤å™¨ b%, $(æ‰€æœ‰æºæ–‡ä»¶))</pre><pre class="programlisting">compile_all:
        $(JAVAC) $(filter a%, $(all-source-files))
        $(JAVAC) $(filter b%, $(all-source-files))</pre><p>å…¶ä»–æ¨¡å¼å¯èƒ½ä¼šä½¿ç”¨æ–‡ä»¶åæœ¬èº«çš„ç‰¹æ®Šç‰¹å¾ã€‚</p><p>Other patterns might use special characteristics of the
        filenames themselves.</p><p>è¯·æ³¨æ„ï¼Œå¾ˆéš¾è¿›ä¸€æ­¥å®žçŽ°è‡ªåŠ¨åŒ–ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•å°†å­—æ¯è¡¨æ–¹æ³•åŒ…è£…åœ¨ä¸€ä¸ª<code class="function">foreach</code>å¾ªçŽ¯ä¸­ï¼š</p><p>Notice that it is difficult to automate this further. We could
        try to wrap the alphabet approach in a <code class="function">foreach</code> loop:</p><a id="OEBPS/ch05s06.html.I_5_tt306"></a><pre class="programlisting">ç¼–è¯‘å…¨éƒ¨ï¼š
        $(foreach l,abcde ..., \
          $(if $(è¿‡æ»¤å™¨ $l%, $(æ‰€æœ‰æºæ–‡ä»¶)), \
            $(JAVAC) $(è¿‡æ»¤å™¨ $l%, $(æ‰€æœ‰æºæ–‡ä»¶));))</pre><pre class="programlisting">compile_all:
        $(foreach l,a b c d e ...,                        \
          $(if $(filter $l%, $(all-source-files)),        \
            $(JAVAC) $(filter $l%, $(all-source-files));))</pre><p>ä½†è¿™è¡Œä¸é€šã€‚<em class="command">make</em>
        å°†å…¶æ‰©å±•ä¸ºå•è¡Œæ–‡æœ¬ï¼Œä»Žè€Œä½¿è¡Œé•¿åº¦é—®é¢˜å˜å¾—æ›´åŠ å¤æ‚ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ eval æ¥ä»£æ›¿ï¼š</p><p>but this doesn't work. <em class="command">make</em>
        expands this into a single line of text, thus compounding the
        line-length problem. We can instead use eval:</p><a id="OEBPS/ch05s06.html.I_5_tt307"></a><pre class="programlisting">ç¼–è¯‘å…¨éƒ¨ï¼š
        $(foreach l,abcde ..., \
          $(if $(è¿‡æ»¤å™¨ $l%, $(æ‰€æœ‰æºæ–‡ä»¶)), \
            $(è¯„ä¼°\
              $(å¤–å£³\
                $(JAVAC) $(è¿‡æ»¤å™¨ $l%, $(æ‰€æœ‰æºæ–‡ä»¶));))))</pre><pre class="programlisting">compile_all:
        $(foreach l,a b c d e ...,                 \
          $(if $(filter $l%, $(all-source-files)), \
            $(eval                                 \
              $(shell                              \
                $(JAVAC) $(filter $l%, $(all-source-files));))))</pre><p>è¿™æ˜¯æœ‰æ•ˆçš„ï¼Œå› ä¸º<code class="function">eval</code>
        å°†ç«‹å³æ‰§è¡Œ<code class="function">shell</code>å‘½ä»¤ï¼Œæ‰©å±•ä¸ºç©ºã€‚æ‰€ä»¥<code class="function">foreach</code>å¾ªçŽ¯ä¼šæ‰©å±•ä¸ºç©ºã€‚é—®é¢˜æ˜¯é”™è¯¯æŠ¥å‘Šåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› æ­¤ç¼–è¯‘é”™è¯¯ä¸ä¼šè¢«æ­£ç¡®åœ°ä¼ é€’ç»™<em class="command">make</em>ã€‚</p><p>This works because <code class="function">eval</code>
        will execute the <code class="function">shell</code> command
        immediately, expanding to nothing. So the <code class="function">foreach</code> loop expands to nothing. The
        problem is that error reporting is meaningless in this context, so
        compilation errors will not be transmitted to <em class="command">make</em> correctly.</p><p>è¯¥<code class="function">wordlist</code>æ–¹æ³•æ›´ç³Ÿç³•ã€‚ç”±äºŽ<em class="command">make</em>çš„æ•°å€¼èƒ½åŠ›æœ‰é™ï¼Œå› æ­¤æ— æ³•å°†è¯¥<code class="function">wordlist</code>æŠ€æœ¯åŒ…å«åœ¨å¾ªçŽ¯ä¸­ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¤„ç†å·¨å¤§æ–‡ä»¶åˆ—è¡¨çš„ä»¤äººæ»¡æ„çš„æ–¹æ³•å¾ˆå°‘ã€‚</p><p>The <code class="function">wordlist</code> approach is
        worse. Due to <em class="command">make</em>'s limited
        numerical capabilities, there is no way to enclose the <code class="function">wordlist</code> technique in a loop. In general,
        there are very few satisfying ways to deal with immense file
        lists.</p></div></div></div>
<div id="OEBPS/pt02.html"><div>
<div class="part" title="ç¬¬äºŒéƒ¨åˆ†ã€‚é«˜çº§å’Œä¸“ä¸šä¸»é¢˜"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/pt02.html.make3-PART-2"></a>ç¬¬äºŒéƒ¨åˆ†ã€‚é«˜çº§å’Œä¸“ä¸šä¸»é¢˜</h1><h1 class="title"><a></a>Part&nbsp;II.&nbsp;Advanced and Specialized Topics</h1></div></div></div><div class="partintro" title="é«˜çº§å’Œä¸“ä¸šä¸»é¢˜" id="OEBPS/pt02.html.id3152439"><div></div><p>åœ¨<a class="link" href="#OEBPS/pt02.html" title="ç¬¬äºŒéƒ¨åˆ†ã€‚é«˜çº§å’Œä¸“ä¸šä¸»é¢˜">ç¬¬äºŒéƒ¨åˆ†</a>ä¸­ï¼Œæˆ‘ä»¬ä»¥é—®é¢˜ä¸ºå¯¼å‘çš„è§’åº¦æ¥çœ‹å¾…<em class="command">make</em>ã€‚å¦‚ä½•å°†<em class="command">make</em>
      åº”ç”¨äºŽå®žé™…é—®é¢˜ï¼ˆä¾‹å¦‚å¤šç›®å½•æž„å»ºã€æ–°ç¼–ç¨‹è¯­è¨€ã€å¯ç§»æ¤æ€§å’Œæ€§èƒ½é—®é¢˜æˆ–è°ƒè¯•ï¼‰é€šå¸¸å¹¶ä¸æ˜Žæ˜¾ã€‚æ¯ä¸ªé—®é¢˜éƒ½è¿›è¡Œäº†è®¨è®ºï¼Œå¹¶æœ‰ä¸€ç« æ¶µç›–äº†å‡ ä¸ªå¤æ‚çš„ä¾‹å­ã€‚</p><p>In <a class="link" href="#OEBPS/pt02.html" title="Part&nbsp;II.&nbsp;Advanced and Specialized Topics">Part II</a>, we take a
      problem-oriented view of <em class="command">make</em>. It is
      often not obvious how to apply <em class="command">make</em>
      to real-world problems such as multidirectory builds, new programming
      languages, portability and performance issues, or debugging. Each of
      these problems is discussed, along with a chapter covering several
      complex examples.</p><p><a class="link" href="#OEBPS/ch06.html" title="ç¬¬ 6 ç« ç®¡ç†å¤§åž‹é¡¹ç›®">ç¬¬ 6 ç« </a>ï¼Œç®¡ç†å¤§åž‹é¡¹ç›®</p><p><a class="link" href="#OEBPS/ch06.html" title="Chapter&nbsp;6.&nbsp;Managing Large Projects">Chapter 6</a>, Managing Large
      Projects</p><p><a class="link" href="#OEBPS/ch07.html" title="ç¬¬ 7 ç« å¯ç§»æ¤ Makefile">ç¬¬ 7 ç« </a>ï¼Œå¯ç§»æ¤ Makefile</p><p><a class="link" href="#OEBPS/ch07.html" title="Chapter&nbsp;7.&nbsp;Portable Makefiles">Chapter 7</a>, Portable
      Makefiles</p><p><a class="link" href="#OEBPS/ch08.html" title="ç¬¬ 8 ç«  C å’Œ C++">ç¬¬8ç« </a>ï¼ŒCå’ŒC++</p><p><a class="link" href="#OEBPS/ch08.html" title="Chapter&nbsp;8.&nbsp;C and C++">Chapter 8</a>, C and C++</p><p><a class="link" href="#OEBPS/ch09.html" title="ç¬¬ 9 ç«  Java">ç¬¬9ç« </a>ï¼ŒJava</p><p><a class="link" href="#OEBPS/ch09.html" title="Chapter&nbsp;9.&nbsp;Java">Chapter 9</a>, Java</p><p><a class="link" href="#OEBPS/ch10.html" title="ç¬¬ 10 ç« æé«˜ make çš„æ€§èƒ½">ç¬¬10ç« </a>ï¼Œæé«˜makeçš„æ€§èƒ½</p><p><a class="link" href="#OEBPS/ch10.html" title="Chapter&nbsp;10.&nbsp;Improving the Performance of make">Chapter 10</a>, Improving the
      Performance of make</p><p><a class="link" href="#OEBPS/ch11.html" title="ç¬¬ 11 ç«  Makefile ç¤ºä¾‹">ç¬¬ 11 ç« </a>ï¼Œç¤ºä¾‹ Makefile</p><p><a class="link" href="#OEBPS/ch11.html" title="Chapter&nbsp;11.&nbsp;Example Makefiles">Chapter 11</a>, Example
      Makefiles</p><p><a class="link" href="#OEBPS/ch12.html" title="ç¬¬ 12 ç« è°ƒè¯• Makefile">ç¬¬12ç« </a>ï¼Œè°ƒè¯•Makefile</p><p><a class="link" href="#OEBPS/ch12.html" title="Chapter&nbsp;12.&nbsp;Debugging Makefiles">Chapter 12</a>, Debugging
      Makefiles</p></div></div></div></div>
<div id="OEBPS/ch06.html"><div>
<div class="chapter" title="ç¬¬ 6 ç« ç®¡ç†å¤§åž‹é¡¹ç›®"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch06.html.make3-CHP-6"></a>ç¬¬ 6 ç« ç®¡ç†å¤§åž‹é¡¹ç›®</h1><h1 class="title"><a></a>Chapter&nbsp;6.&nbsp;Managing Large Projects</h1></div></div></div><p>ä»€ä¹ˆå«å¤§é¡¹ç›®ï¼Ÿå°±æˆ‘ä»¬çš„ç›®çš„è€Œè¨€ï¼Œå®ƒéœ€è¦ä¸€ç»„å¼€å‘äººå‘˜ï¼Œå¯èƒ½åœ¨å¤šç§æž¶æž„ä¸Šè¿è¡Œï¼Œå¹¶ä¸”å¯èƒ½æœ‰å¤šä¸ªéœ€è¦ç»´æŠ¤çš„çŽ°åœºç‰ˆæœ¬ã€‚å½“ç„¶ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰è¿™äº›éƒ½éœ€è¦ç§°ä¸ºå¤§åž‹é¡¹ç›®ã€‚å•ä¸ªå¹³å°ä¸Šçš„ä¸€ç™¾ä¸‡è¡Œé¢„å‘å¸ƒ C++ ä»ç„¶å¾ˆå¤§ã€‚ä½†è½¯ä»¶å¾ˆå°‘ä¼šæ°¸è¿œä¿æŒé¢„å‘å¸ƒçŠ¶æ€ã€‚å¦‚æžœæˆåŠŸçš„è¯ï¼Œæœ€ç»ˆä¼šæœ‰äººåœ¨å¦ä¸€ä¸ªå¹³å°ä¸Šè¦æ±‚å®ƒã€‚å› æ­¤ï¼Œå¤§å¤šæ•°å¤§åž‹è½¯ä»¶ç³»ç»Ÿåœ¨ä¸€æ®µæ—¶é—´åŽçœ‹èµ·æ¥éƒ½éžå¸¸ç›¸ä¼¼ã€‚</p><p>What do you call a large project? For our purposes, it is one that
      requires a team of developers, may run on multiple architectures, and
      may have several field releases that require maintenance. Of course, not
      all of these are required to call a project large. A million lines of
      prerelease C++ on a single platform is still large. But software rarely
      stays prerelease forever. And if it is successful, someone will
      eventually ask for it on another platform. So most large software
      systems wind up looking very similar after awhile.</p><p>å¤§åž‹è½¯ä»¶é¡¹ç›®é€šå¸¸æ˜¯<a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1363" class="indexterm"></a>é€šè¿‡å°†å®ƒä»¬åˆ’åˆ†ä¸ºä¸»è¦ç»„ä»¶æ¥ç®€åŒ–ï¼Œè¿™äº›ç»„ä»¶é€šå¸¸æ”¶é›†åˆ°ä¸åŒçš„ç¨‹åºã€åº“æˆ–ä¸¤è€…ä¸­ã€‚è¿™äº›ç»„ä»¶é€šå¸¸å­˜å‚¨åœ¨å®ƒä»¬è‡ªå·±çš„ç›®å½•ä¸‹ï¼Œå¹¶ç”±å®ƒä»¬è‡ªå·±çš„
      <em class="filename">makefile</em>è¿›è¡Œç®¡ç†ã€‚æž„å»ºæ•´ä¸ªç»„ä»¶ç³»ç»Ÿçš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨é¡¶çº§<em class="filename">makefile</em> ï¼Œä»¥æ­£ç¡®çš„é¡ºåºè°ƒç”¨æ¯ä¸ªç»„ä»¶çš„<em class="filename">makefile</em> ã€‚è¿™ç§æ–¹æ³•ç§°ä¸º<em class="firstterm">é€’å½’ makeï¼Œ</em>
      å› ä¸ºé¡¶çº§<em class="filename">makefile</em>åœ¨æ¯ä¸ªç»„ä»¶çš„<em class="filename">makefile</em>ä¸Š
      é€’å½’è°ƒç”¨<em class="command">make</em>ã€‚é€’å½’
      <em class="command">make</em>æ˜¯ä¸€ç§å¸¸è§çš„<em class="filename"></em><em class="command"></em><a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1364" class="indexterm"></a>å¤„ç†ç»„ä»¶å¼æž„å»ºçš„æŠ€æœ¯ã€‚ Peter Miller åœ¨ 1998 å¹´æå‡ºçš„æ›¿ä»£æ–¹æ¡ˆé€šè¿‡ä½¿ç”¨åŒ…å«æ¯ä¸ªç»„ä»¶ç›®å½•ä¿¡æ¯çš„å•ä¸ª
      <em class="filename">makefileé¿å…äº†é€’å½’</em><em class="command">makeçš„è®¸å¤šé—®é¢˜ã€‚ </em><sup>[ </sup><sup><a id="OEBPS/ch06.html.make3-CHP-6-FNOTE-1" href="#OEBPS/ch06.html.ftn.make3-CHP-6-FNOTE-1" class="footnote">1</a></sup><sup> ]</sup><em class="filename"></em><sup><a id="OEBPS/ch06.html.make3-CHP-6-FNOTE-1" href="#OEBPS/ch06.html.ftn.make3-CHP-6-FNOTE-1" class="footnote"></a></sup></p><p>Large software projects are usually <a class="indexterm"></a>simplified by dividing them into major components, often
      collected into distinct programs, libraries, or both. These components
      are often stored under their own directories and managed by their own
      <em class="filename">makefile</em>s. One way to build an
      entire system of components employs a top-level <em class="filename">makefile</em> that invokes the <em class="filename">makefile</em> for each component in the proper
      order. This approach is called <em class="firstterm">recursive make</em>
      because the top-level <em class="filename">makefile</em>
      invokes <em class="command">make</em> recursively on each
      component's <em class="filename">makefile</em>. Recursive
      <em class="command">make</em> is a common <a class="indexterm"></a>technique for handling component-wise builds. An
      alternative suggested by Peter Miller in 1998 avoids many issues with
      recursive <em class="command">make</em> by using a single
      <em class="filename">makefile</em> that includes information
      from each component directory.<sup>[<a href="#OEBPS/ch06.html.ftn.make3-CHP-6-FNOTE-1" class="footnote">1</a>]</sup></p><p>ä¸€æ—¦é¡¹ç›®è¶…å‡ºäº†æž„å»ºå…¶ç»„ä»¶çš„èŒƒå›´ï¼Œå®ƒæœ€ç»ˆä¼šå‘çŽ°ç®¡ç†æž„å»ºæ–¹é¢å­˜åœ¨æ›´å¤§çš„ç»„ç»‡é—®é¢˜ã€‚å…¶ä¸­åŒ…æ‹¬å¤„ç†é¡¹ç›®çš„å¤šä¸ªç‰ˆæœ¬çš„å¼€å‘ã€æ”¯æŒå¤šä¸ªå¹³å°ã€æä¾›å¯¹æºä»£ç å’ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„é«˜æ•ˆè®¿é—®ä»¥åŠæ‰§è¡Œè‡ªåŠ¨åŒ–æž„å»ºã€‚æˆ‘ä»¬å°†åœ¨æœ¬ç« åŽåŠéƒ¨åˆ†è®¨è®ºè¿™äº›é—®é¢˜ã€‚</p><p>Once a project gets beyond building its components, it eventually
      finds that there are larger organizational issues in managing builds.
      These include handling development on multiple versions of a project,
      supporting several platforms, providing efficient access to source and
      binaries, and performing automated builds. We will discuss these
      problems in the second half of this chapter.</p><div class="sect1" title="é€’å½’make"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch06.html.make3-CHP-6-SECT-1"></a>é€’å½’make</h1><h1 class="title"><a></a>Recursive make</h1></div></div></div><p>é€’å½’èƒŒåŽçš„åŠ¨æœº<a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1365" class="indexterm"></a>make å¾ˆç®€å•ï¼š<em class="command">make</em>
        åœ¨å•ä¸ªç›®å½•ï¼ˆæˆ–ä¸€å°ç»„ç›®å½•ï¼‰ä¸­å·¥ä½œå¾—å¾ˆå¥½ï¼Œä½†å½“ç›®å½•æ•°é‡å¢žåŠ æ—¶ä¼šå˜å¾—æ›´åŠ å¤æ‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<em class="command">make</em>æ¥æž„å»ºä¸€ä¸ªå¤§åž‹é¡¹ç›®ï¼Œæ–¹æ³•æ˜¯ä¸ºæ¯ä¸ªç›®å½•ç¼–å†™ä¸€ä¸ªç®€å•çš„ã€ç‹¬ç«‹çš„<em class="filename">makefile</em>ï¼Œç„¶åŽå•ç‹¬æ‰§è¡Œå®ƒä»¬ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è„šæœ¬å·¥å…·æ¥æ‰§è¡Œæ­¤æ‰§è¡Œï¼Œä½†ä½¿ç”¨<em class="command">make</em>æœ¬èº«æ›´æœ‰æ•ˆï¼Œå› ä¸ºè¿˜æ¶‰åŠæ›´é«˜çº§åˆ«çš„ä¾èµ–å…³ç³»ã€‚</p><p>The motivation behind recursive <a class="indexterm"></a>make is simple: <em class="command">make</em>
        works very well within a single directory (or small set of
        directories) but becomes more complex when the number of directories
        grows. So, we can use <em class="command">make</em> to build
        a large project by writing a simple, self-contained <em class="filename">makefile</em> for each directory, then executing
        them all individually. We could use a scripting tool to perform this
        execution, but it is more effective to use <em class="command">make</em> itself since there are also
        dependencies involved at the higher level.</p><p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘æœ‰ä¸€ä¸ª MP3 æ’­æ”¾å™¨åº”ç”¨ç¨‹åºã€‚å®ƒåœ¨é€»è¾‘ä¸Šå¯ä»¥åˆ†ä¸ºå‡ ä¸ªç»„ä»¶ï¼šç”¨æˆ·ç•Œé¢ã€ç¼–è§£ç å™¨å’Œæ•°æ®åº“ç®¡ç†ã€‚è¿™äº›å¯èƒ½ç”±ä¸‰ä¸ªåº“è¡¨ç¤ºï¼š<em class="filename">libui.a</em>ã€<em class="filename">libcodec.a</em>å’Œ<em class="filename">libdb.a</em>ã€‚è¯¥åº”ç”¨ç¨‹åºæœ¬èº«ç”±å°†è¿™äº›éƒ¨ä»¶ç²˜åˆåœ¨ä¸€èµ·çš„èƒ¶æ°´ç»„æˆã€‚è¿™äº›ç»„ä»¶åˆ°æ–‡ä»¶ç»“æž„çš„ç›´æŽ¥æ˜ å°„å¯èƒ½å¦‚å›¾<a class="link" href="#OEBPS/ch06.html.make3-CHP-6-FIG-1" title="å›¾ 6-1ã€‚ MP3 æ’­æ”¾å™¨çš„æ–‡ä»¶å¸ƒå±€">6-1</a>æ‰€ç¤ºã€‚</p><p>For example, suppose I have an mp3 player application. It can
        logically be divided into several components: the user interface,
        codecs, and database management. These might be represented by three
        libraries: <em class="filename">libui.a</em>, <em class="filename">libcodec.a</em>, and <em class="filename">libdb.a</em>. The application itself consists of
        glue holding these pieces together. A straightforward mapping of these
        components onto a file structure might look like <a class="link" href="#OEBPS/ch06.html.make3-CHP-6-FIG-1" title="Figure&nbsp;6-1.&nbsp;File layout for an MP3 player">Figure 6-1</a>.</p><div class="figure"><a id="OEBPS/ch06.html.make3-CHP-6-FIG-1"></a><div class="figure-contents"><div class="mediaobject"><a id="OEBPS/ch06.html.I_1_tt308"></a><img src="data:image/png;base64,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" width="146" alt="MP3 æ’­æ”¾å™¨çš„æ–‡ä»¶å¸ƒå±€"></div></div><p class="title">å›¾ 6-1ã€‚ MP3 æ’­æ”¾å™¨çš„æ–‡ä»¶å¸ƒå±€</p><p class="title">Figure&nbsp;6-1.&nbsp;File layout for an MP3 player</p></div><p>æ›´ä¼ ç»Ÿçš„å¸ƒå±€ä¼šå°†åº”ç”¨ç¨‹åºçš„ä¸»è¦åŠŸèƒ½å’Œç²˜åˆæ”¾åœ¨é¡¶éƒ¨ç›®å½•ä¸­ï¼Œè€Œä¸æ˜¯æ”¾åœ¨å­ç›®å½•
        <em class="filename">app/player</em>ä¸­ã€‚æˆ‘æ›´å–œæ¬¢å°†åº”ç”¨ç¨‹åºä»£ç æ”¾åœ¨è‡ªå·±çš„ç›®å½•ä¸­ï¼Œä»¥ä¾¿åœ¨é¡¶å±‚åˆ›å»ºæ›´æ¸…æ™°çš„å¸ƒå±€ï¼Œå¹¶å…è®¸é€šè¿‡é™„åŠ æ¨¡å—æ¥æ‰©å±•ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæˆ‘ä»¬é€‰æ‹©ç¨åŽæ·»åŠ ä¸€ä¸ªå•ç‹¬çš„ç¼–ç›®åº”ç”¨ç¨‹åºï¼Œå®ƒå¯ä»¥æ•´é½åœ°æ”¾ç½®åœ¨<em class="filename">app/catalog</em>ä¸‹ã€‚</p><p>A more traditional layout would place the application's main
        function and glue in the top directory rather than in the subdirectory
        <em class="filename">app/player</em>. I prefer to put
        application code in its own directory to create a cleaner layout at
        the top level and allow for growth of the system with additional
        modules. For instance, if we choose to add a separate cataloging
        application later it can neatly fit under <em class="filename">app/catalog</em>.</p><p>å¦‚æžœæ¯ä¸ªç›®å½•<em class="filename">lib/db</em>ã€<em class="filename">lib/codec</em>ã€<em class="filename">lib/ui</em>å’Œ<em class="filename">app/player</em>éƒ½åŒ…å«ä¸€ä¸ª<em class="filename">makefile</em>ï¼Œé‚£ä¹ˆé¡¶çº§<em class="filename">makefile</em>çš„å·¥ä½œå°±æ˜¯è°ƒç”¨å®ƒä»¬ã€‚</p><p>If each of the directories <em class="filename">lib/db</em>, <em class="filename">lib/codec</em>, <em class="filename">lib/ui</em>, and <em class="filename">app/player</em> contains a <em class="filename">makefile</em>, then it is the job of the
        top-level <em class="filename">makefile</em> to invoke
        them.</p><a id="OEBPS/ch06.html.I_1_tt309"></a><pre class="programlisting">lib_codec := lib/ç¼–è§£ç å™¨
lib_db := lib/db
lib_ui := lib/ui
åº“ := $(lib_ui) $(lib_db) $(lib_codec)
æ’­æ”¾å™¨ := åº”ç”¨ç¨‹åº/æ’­æ”¾å™¨

.PHONYï¼šæ‰€æœ‰ $(player) $(libraries)
å…¨éƒ¨ï¼š$ï¼ˆçŽ©å®¶ï¼‰

$ï¼ˆçŽ©å®¶ï¼‰$ï¼ˆå›¾ä¹¦é¦†ï¼‰ï¼š
        $(MAKE) --ç›®å½•=$@

$ï¼ˆçŽ©å®¶ï¼‰ï¼š$ï¼ˆå›¾ä¹¦é¦†ï¼‰
$(lib_ui): $(lib_db) $(lib_codec)</pre><pre class="programlisting">lib_codec := lib/codec
lib_db    := lib/db
lib_ui    := lib/ui
libraries := $(lib_ui) $(lib_db) $(lib_codec)
player    := app/player

.PHONY: all $(player) $(libraries)
all: $(player)

$(player) $(libraries):
        $(MAKE) --directory=$@

$(player): $(libraries)
$(lib_ui): $(lib_db) $(lib_codec)</pre><p>é¡¶çº§<em class="filename">makefile</em>é€šè¿‡å°†å­ç›®å½•åˆ—ä¸ºç›®æ ‡çš„è§„åˆ™åœ¨æ¯ä¸ªå­ç›®å½•ä¸Š
        è°ƒç”¨<em class="command">make ï¼Œå…¶æ“ä½œæ˜¯è°ƒç”¨</em><em class="command">make</em>ï¼š</p><p>The top-level <em class="filename">makefile</em>
        invokes <em class="command">make</em> on each subdirectory
        through a rule that lists the subdirectories as targets and whose
        action is to invoke <em class="command">make</em>:</p><a id="OEBPS/ch06.html.I_1_tt310"></a><pre class="programlisting">$ï¼ˆçŽ©å®¶ï¼‰$ï¼ˆå›¾ä¹¦é¦†ï¼‰ï¼š
        $(MAKE) --ç›®å½•=$@</pre><pre class="programlisting">$(player) $(libraries):
        $(MAKE) --directory=$@</pre><p>è¯¥å˜é‡<code class="literal">MAKE</code>åº”å§‹ç»ˆç”¨äºŽ
        åœ¨<em class="filename">makefileä¸­è°ƒç”¨</em><em class="command">make</em>ã€‚è¯¥å˜é‡ç”±<em class="command">make</em>è¯†åˆ«å¹¶è®¾ç½®ä¸º
        <em class="command">make</em>çš„å®žé™…è·¯å¾„ï¼Œå› æ­¤é€’å½’è°ƒç”¨éƒ½ä½¿ç”¨ç›¸åŒçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚æ­¤å¤–ï¼Œå½“ä½¿ç”¨å‘½ä»¤è¡Œé€‰é¡¹( )ã€
         ( ) å’Œ
        ( ) æ—¶ï¼ŒåŒ…å«å˜é‡çš„è¡Œå°†è¢«ç‰¹æ®Šå¤„ç†ã€‚æˆ‘ä»¬å°†åœ¨æœ¬ç« åŽé¢çš„<a class="link" href="#OEBPS/ch06.html.make3-CHP-6-SECT-1.1" title="å‘½ä»¤è¡Œé€‰é¡¹">6.1.1 èŠ‚</a>ä¸­è¯¦ç»†è®¨è®ºè¿™ä¸€ç‚¹ã€‚<em class="filename"></em><code class="literal">MAKE</code><em class="command"></em><em class="command"></em><code class="literal">MAKE</code><code class="option">â€”touch</code><code class="option">-t</code><code class="option">â€”just-print</code><code class="option">-n</code><code class="option">â€”question</code><code class="option">-q</code><a class="link" href="#OEBPS/ch06.html.make3-CHP-6-SECT-1.1" title="å‘½ä»¤è¡Œé€‰é¡¹"></a></p><p>The variable <code class="literal">MAKE</code> should
        always be used to invoke <em class="command">make</em>
        within a <em class="filename">makefile</em>. The <code class="literal">MAKE</code> variable is recognized by <em class="command">make</em> and is set to the actual path of
        <em class="command">make</em> so recursive invocations all
        use the same executable. Also, lines containing the variable <code class="literal">MAKE</code> are handled specially when the
        command-line options <code class="option">â€”touch</code> (<code class="option">-t</code>),
        <code class="option">â€”just-print</code> (<code class="option">-n</code>), and
        <code class="option">â€”question</code> (<code class="option">-q</code>) are used. We'll
        discuss this in detail in <a class="link" href="#OEBPS/ch06.html.make3-CHP-6-SECT-1.1" title="Command-Line Options">Section
        6.1.1</a> later in this chapter.</p><p>ç›®æ ‡ç›®å½•æ ‡è®°ä¸º ï¼Œ<code class="literal">.PHONY</code>å› æ­¤å³ä½¿ç›®æ ‡å¯èƒ½æ˜¯æœ€æ–°çš„ï¼Œè§„åˆ™ä¹Ÿä¼šè§¦å‘ã€‚<code class="option">â€”directory</code>
        ( )é€‰é¡¹<code class="option">-C</code>ç”¨äºŽä½¿<em class="command">makeåœ¨è¯»å–</em><em class="filename">makefile</em>ä¹‹å‰æ›´æ”¹åˆ°ç›®æ ‡ç›®å½•ã€‚</p><p>The target directories are marked with <code class="literal">.PHONY</code> so the rule fires even though the
        target may be up to date. The <code class="option">â€”directory</code>
        (<code class="option">-C</code>) option is used to cause <em class="command">make</em> to change to the target directory
        before reading a <em class="filename">makefile</em>.</p><p>è¯¥è§„åˆ™è™½ç„¶æœ‰ç‚¹å¾®å¦™ï¼Œä½†å…‹æœäº†ä¸Žæ›´ç®€å•çš„å‘½ä»¤è„šæœ¬ç›¸å…³çš„å‡ ä¸ªé—®é¢˜ï¼š</p><p>This rule, although a bit subtle, overcomes several problems
        associated with a more straightforward command script:</p><a id="OEBPS/ch06.html.I_1_tt311"></a><pre class="programlisting">å…¨éƒ¨ï¼š
        for d in $(player) $(libraries); \
        åš \
          $(MAKE) --ç›®å½•=$$d; \
        å®Œæ¯•</pre><pre class="programlisting">all:
        for d in $(player) $(libraries); \
        do                               \
          $(MAKE) --directory=$$d;       \
        done</pre><p>æ­¤å‘½ä»¤è„šæœ¬æ— æ³•æ­£ç¡®åœ°å°†é”™è¯¯ä¼ è¾“åˆ°çˆ¶<em class="command">make</em>ã€‚å®ƒè¿˜ä¸å…è®¸
        <em class="command">make</em>å¹¶è¡Œæ‰§è¡Œä»»ä½•å­ç›®å½•æž„å»ºã€‚æˆ‘ä»¬å°†åœ¨<a class="link" href="#OEBPS/ch10.html" title="ç¬¬ 10 ç« æé«˜ make çš„æ€§èƒ½">ç¬¬ 10 ç« è®¨è®º</a><em class="command">make</em>çš„è¿™ä¸€ç‰¹æ€§ã€‚<a class="link" href="#OEBPS/ch10.html" title="ç¬¬ 10 ç« æé«˜ make çš„æ€§èƒ½"></a></p><p>This command script fails to properly transmit errors to the
        parent <em class="command">make</em>. It also does not allow
        <em class="command">make</em> to execute any subdirectory
        builds in parallel. We'll discuss this feature of <em class="command">make</em> in <a class="link" href="#OEBPS/ch10.html" title="Chapter&nbsp;10.&nbsp;Improving the Performance of make">Chapter
        10</a>.</p><p>å½“<em class="command">make</em>è§„åˆ’ä¾èµ–å›¾çš„æ‰§è¡Œæ—¶ï¼Œç›®æ ‡çš„å…ˆå†³æ¡ä»¶æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚æ­¤å¤–ï¼Œç›¸äº’ä¹‹é—´æ²¡æœ‰ä¾èµ–å…³ç³»çš„å•ç‹¬ç›®æ ‡ä¹Ÿæ˜¯ç‹¬ç«‹çš„ã€‚ä¾‹å¦‚ï¼Œ<a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1366" class="indexterm"></a>
        åº“ä¸Žç›®æ ‡æˆ–å½¼æ­¤ä¹‹é—´æ²¡æœ‰<span class="emphasis"><em>å†…åœ¨</em></span>
        å…³ç³»ã€‚<code class="literal">app/player</code>è¿™æ„å‘³ç€<em class="command">make</em>åœ¨æž„å»ºä»»ä½•åº“ä¹‹å‰å¯ä»¥è‡ªç”±åœ°æ‰§è¡Œ<em class="filename">åº”ç”¨ç¨‹åº/æ’­æ”¾å™¨</em> <em class="filename">makefile</em> ã€‚æ˜¾ç„¶ï¼Œè¿™ä¼šå¯¼è‡´æž„å»ºå¤±è´¥ï¼Œå› ä¸ºé“¾æŽ¥åº”ç”¨ç¨‹åºéœ€è¦åº“ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æä¾›äº†é¢å¤–çš„ä¾èµ–ä¿¡æ¯ã€‚</p><p>As <em class="command">make</em> is planning the
        execution of the dependency graph, the prerequisites of a target are
        independent of one another. In addition, separate targets with no
        dependency relationships to one another are also independent. For
        example, the <a class="indexterm"></a>libraries have no <span class="emphasis"><em>inherent</em></span>
        relationship to the <code class="literal">app/player</code>
        target or to each other. This means <em class="command">make</em> is free to execute the <em class="filename">app/player</em> <em class="filename">makefile</em> before building any of the
        libraries. Clearly, this would cause the build to fail since linking
        the application requires the libraries. To solve this problem, we
        provide additional dependency information.</p><a id="OEBPS/ch06.html.I_1_tt312"></a><pre class="programlisting">$ï¼ˆçŽ©å®¶ï¼‰ï¼š$ï¼ˆå›¾ä¹¦é¦†ï¼‰
$(lib_ui): $(lib_db) $(lib_codec)</pre><pre class="programlisting">$(player): $(libraries)
$(lib_ui): $(lib_db) $(lib_codec)</pre><p>è¿™é‡Œæˆ‘ä»¬å£°æ˜Žlibraryå­ç›®å½•ä¸‹çš„<em class="filename">makefile</em>å¿…é¡»å…ˆäºŽè¯¥ç›®å½•ä¸‹çš„<em class="filename">makefile</em>æ‰§è¡Œ<code class="literal">player</code>ã€‚åŒæ ·ï¼Œ<em class="filename">lib/ui</em>ä»£ç éœ€è¦ç¼–è¯‘<em class="filename">lib/db</em>å’Œ<em class="filename">lib/codec</em>åº“ã€‚è¿™ç¡®ä¿äº†åœ¨ç¼–è¯‘<em class="filename">ui</em>ä»£ç 
        ä¹‹å‰å·²ç”Ÿæˆä»»ä½•ç”Ÿæˆçš„ä»£ç ï¼ˆä¾‹å¦‚<em class="command">yacc</em> / <em class="command">lexæ–‡ä»¶ï¼‰ã€‚</em><em class="filename"></em></p><p>Here we state that the <em class="filename">makefile</em>s in the library subdirectories
        must be executed before the <em class="filename">makefile</em> in the <code class="literal">player</code> directory. Similarly, the <em class="filename">lib/ui</em> code requires the <em class="filename">lib/db</em> and <em class="filename">lib/codec</em> libraries to be compiled. This
        ensures that any generated code (such as <em class="command">yacc</em>/<em class="command">lex</em>
        files) have been generated before the <em class="filename">ui</em> code is compiled.</p><p>è¿˜æœ‰ä¸€ä¸ªæ›´å¾®å¦™çš„é¡ºåº<a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1367" class="indexterm"></a> <a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1368" class="indexterm"></a>æ›´æ–°å…ˆå†³æ¡ä»¶æ—¶å‡ºçŽ°é—®é¢˜ã€‚ä¸Žæ‰€æœ‰ä¾èµ–é¡¹ä¸€æ ·ï¼Œæ›´æ–°çš„é¡ºåºæ˜¯é€šè¿‡å¯¹ä¾èµ–å…³ç³»å›¾çš„åˆ†æžæ¥ç¡®å®šçš„ï¼Œä½†æ˜¯å½“ç›®æ ‡çš„å…ˆå†³æ¡ä»¶åˆ—åœ¨ä¸€è¡Œä¸Šæ—¶ï¼Œ<acronym class="acronym">GNU </acronym> <em class="command">make</em>æ°å¥½ä»Žå·¦åˆ°å³æ›´æ–°å®ƒä»¬ã€‚ä¾‹å¦‚ï¼š</p><p>There is a further subtle ordering <a class="indexterm"></a> <a class="indexterm"></a>issue when updating prerequisites. As with all
        dependencies, the order of updating is determined by the analysis of
        the dependency graph, but when the prerequisites of a target are
        listed on a single line, <acronym class="acronym">GNU</acronym> <em class="command">make</em> happens to update them from left to
        right. For example:</p><a id="OEBPS/ch06.html.I_1_tt313"></a><pre class="programlisting">å…¨éƒ¨ï¼šabc
å…¨éƒ¨ï¼š å®šä¹‰</pre><pre class="programlisting">all: a b c
all: d e f</pre><p>å¦‚æžœæ²¡æœ‰å…¶ä»–ä¾èµ–å…³ç³»<a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1369" class="indexterm"></a> <a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1370" class="indexterm"></a>è€ƒè™‘åˆ°ï¼Œå…­ä¸ªå…ˆå†³æ¡ä»¶å¯ä»¥æŒ‰ä»»ä½•é¡ºåºæ›´æ–°ï¼ˆä¾‹å¦‚ï¼Œâ€œdbace fâ€ï¼‰ï¼Œä½†<acronym class="acronym">GNU </acronym> <em class="command">make</em>åœ¨å•ä¸ªç›®æ ‡è¡Œä¸­ä½¿ç”¨ä»Žå·¦åˆ°å³çš„æ–¹å¼ï¼Œäº§ç”Ÿæ›´æ–°é¡ºåºï¼šâ€œabcde fâ€
        <span class="emphasis"><em>æˆ–</em></span>â€œdefab câ€ã€‚å°½ç®¡è¿™ä¸ªé¡ºåºæ˜¯æ‰§è¡Œä¸­çš„ä¸€ä¸ªæ„å¤–ï¼Œä½†æ‰§è¡Œé¡ºåºçœ‹èµ·æ¥æ˜¯æ­£ç¡®çš„ã€‚äººä»¬å¾ˆå®¹æ˜“å¿˜è®°æ­£ç¡®çš„é¡ºåºæ˜¯ä¸€ä¸ªæ„å¤–ï¼Œå¹¶ä¸”æœªèƒ½æä¾›å®Œæ•´çš„ä¾èµ–ä¿¡æ¯ã€‚æœ€ç»ˆï¼Œä¾èµ–æ€§åˆ†æžå°†äº§ç”Ÿä¸åŒçš„é¡ºåºå¹¶å¯¼è‡´é—®é¢˜ã€‚å› æ­¤ï¼Œå¦‚æžœå¿…é¡»æŒ‰ç‰¹å®šé¡ºåºæ›´æ–°ä¸€ç»„ç›®æ ‡ï¼Œè¯·åœ¨é€‚å½“çš„å…ˆå†³æ¡ä»¶ä¸‹å¼ºåˆ¶æ‰§è¡Œæ­£ç¡®çš„é¡ºåºã€‚</p><p>If there are no other dependency relationships to <a class="indexterm"></a> <a class="indexterm"></a>be considered, the six prerequisites can be updated in
        any order (e.g., "d b a c e f"), but <acronym class="acronym">GNU</acronym> <em class="command">make</em> uses left to right within a single
        target line, yielding the update order: "a b c d e f"
        <span class="emphasis"><em>or</em></span> "d e f a b c." Although this ordering is an
        accident of the implementation, the order of execution appears
        correct. It is easy to forget that the correct order is a happy
        accident and fail to provide full dependency information. Eventually,
        the dependency analysis will yield a different order and cause
        problems. So, if a set of targets must be updated in a specific order,
        enforce the proper order with appropriate prerequisites.</p><p>å½“é¡¶å±‚<em class="filename">makefile</em>
        è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼š</p><p>When the top-level <em class="filename">makefile</em>
        is run, we see:</p><a id="OEBPS/ch06.html.I_1_tt314"></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
ä½¿ --directory=lib/db
make[1]: è¿›å…¥ç›®å½• `/test/book/out/ch06-simple/lib/db'
æ›´æ–°æ•°æ®åº“...
make[1]ï¼šç¦»å¼€ç›®å½•`/test/book/out/ch06-simple/lib/db'
make --directory=lib/ç¼–è§£ç å™¨
make[1]: è¿›å…¥ç›®å½• `/test/book/out/ch06-simple/lib/codec'
æ›´æ–°ç¼–è§£ç å™¨åº“...
make[1]ï¼šç¦»å¼€ç›®å½•`/test/book/out/ch06-simple/lib/codec'
ä½¿ --directory=lib/ui
make[1]: è¿›å…¥ç›®å½• `/test/book/out/ch06-simple/lib/ui'
æ›´æ–°ç”¨æˆ·ç•Œé¢åº“...
make[1]ï¼šç¦»å¼€ç›®å½•`/test/book/out/ch06-simple/lib/ui'
make --directory=åº”ç”¨ç¨‹åº/æ’­æ”¾å™¨
make[1]: è¿›å…¥ç›®å½• `/test/book/out/ch06-simple/app/player'
æ›´æ–°æ’­æ”¾å™¨åº”ç”¨ç¨‹åº...
make[1]ï¼šç¦»å¼€ç›®å½•`/test/book/out/ch06-simple/app/player'</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
make --directory=lib/db
make[1]: Entering directory `/test/book/out/ch06-simple/lib/db'
Update db library...
make[1]: Leaving directory `/test/book/out/ch06-simple/lib/db'
make --directory=lib/codec
make[1]: Entering directory `/test/book/out/ch06-simple/lib/codec'
Update codec library...
make[1]: Leaving directory `/test/book/out/ch06-simple/lib/codec'
make --directory=lib/ui
make[1]: Entering directory `/test/book/out/ch06-simple/lib/ui'
Update ui library...
make[1]: Leaving directory `/test/book/out/ch06-simple/lib/ui'
make --directory=app/player
make[1]: Entering directory `/test/book/out/ch06-simple/app/player'
Update player application...
make[1]: Leaving directory `/test/book/out/ch06-simple/app/player'</pre><p>å½“<em class="command">make</em>æ£€æµ‹åˆ°å®ƒæ­£åœ¨é€’å½’è°ƒç”¨å¦ä¸€ä¸ª<em class="command">make</em>æ—¶ï¼Œå®ƒâ€‹â€‹ä¼šå¯ç”¨<code class="option">â€”print-directory</code>( <code class="option">-w</code>) é€‰é¡¹ï¼Œè¿™ä¼šå¯¼è‡´<em class="command">make</em>æ‰“å°<code class="literal">Entering</code> <code class="literal">directory</code>å’Œ<code class="literal">Leaving</code> <code class="literal">directory</code>æ¶ˆæ¯ã€‚ä½¿ç”¨<code class="option">â€”directory</code>( ) é€‰é¡¹æ—¶ä¹Ÿä¼šå¯ç”¨æ­¤é€‰é¡¹ã€‚ <em class="command">make</em>å˜é‡<code class="option">-C</code>çš„å€¼ä¹Ÿæ‰“å°åœ¨æ¯è¡Œçš„æ–¹æ‹¬å·ä¸­ã€‚åœ¨è¿™ä¸ªç®€å•çš„ç¤ºä¾‹ä¸­ï¼Œæ¯ä¸ªç»„ä»¶<em class="filename">makefile</em>éƒ½ä¼šæ‰“å°ä¸€æ¡æœ‰å…³æ›´æ–°ç»„ä»¶çš„ç®€å•æ¶ˆæ¯ã€‚<em class="command"></em><code class="literal">MAKELEVEL</code><em class="filename"></em></p><p>When <em class="command">make</em> detects that it is
        invoking another <em class="command">make</em> recursively,
        it enables the <code class="option">â€”print-directory</code> (<code class="option">-w</code>)
        option, which causes <em class="command">make</em> to print
        the <code class="literal">Entering</code> <code class="literal">directory</code> and <code class="literal">Leaving</code> <code class="literal">directory</code> messages. This option is also
        enabled when the <code class="option">â€”directory</code> (<code class="option">-C</code>)
        option is used. The value of the <em class="command">make</em> variable <code class="literal">MAKELEVEL</code> is printed in square brackets in
        each line as well. In this simple example, each component <em class="filename">makefile</em> prints a simple message about
        updating the component.</p><div class="sect2" title="å‘½ä»¤è¡Œé€‰é¡¹"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch06.html.make3-CHP-6-SECT-1.1"></a>å‘½ä»¤è¡Œé€‰é¡¹</h2><h2 class="title"><a></a>Command-Line Options</h2></div></div></div><p>é€’å½’<em class="command">make</em>æ˜¯ä¸€ä¸ªç®€å•çš„æƒ³æ³•<a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1371" class="indexterm"></a> <a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1372" class="indexterm"></a>è¿™å¾ˆå¿«å°±ä¼šå˜å¾—å¤æ‚ã€‚å®Œç¾Žçš„é€’å½’<em class="command">make</em>å®žçŽ°çš„è¡Œä¸ºå°±åƒç³»ç»Ÿä¸­çš„
          è®¸å¤š<em class="filename">makefileéƒ½æ˜¯å•ä¸ª</em><em class="filename">makefile</em>ä¸€æ ·ã€‚å®žçŽ°è¿™ç§ç¨‹åº¦çš„åè°ƒå®žé™…ä¸Šæ˜¯ä¸å¯èƒ½çš„ï¼Œå› æ­¤å¿…é¡»åšå‡ºå¦¥åã€‚å½“æˆ‘ä»¬ç ”ç©¶å¦‚ä½•å¤„ç†å‘½ä»¤è¡Œé€‰é¡¹æ—¶ï¼Œå¾®å¦™çš„é—®é¢˜å˜å¾—æ›´åŠ æ¸…æ™°ã€‚</p><p>Recursive <em class="command">make</em> is a simple
          idea<a class="indexterm"></a> <a class="indexterm"></a> that quickly becomes complicated. The perfect
          recursive <em class="command">make</em> implementation
          would behave as if the many <em class="filename">makefile</em>s in the system are a single
          <em class="filename">makefile</em>. Achieving this level
          of coordination is virtually impossible, so compromises must be
          made. The subtle issues become more clear when we look at how
          command-line options must be handled.</p><p>å‡è®¾æˆ‘ä»¬å·²å°†æ³¨é‡Šæ·»åŠ åˆ° mp3 æ’­æ”¾å™¨ä¸­çš„å¤´æ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬æ„è¯†åˆ°æˆ‘ä»¬å¯ä»¥æ‰§è¡Œ<em class="command">make</em> <code class="option">â€”touch</code>æ¥æ›´æ–°æ–‡ä»¶çš„æ—¶é—´æˆ³ï¼Œè€Œä¸æ˜¯é‡æ–°ç¼–è¯‘ä¾èµ–äºŽä¿®æ”¹åŽçš„æ ‡å¤´çš„æ‰€æœ‰æºä»£ç ã€‚é€šè¿‡ä½¿ç”¨é¡¶çº§makefileæ‰§è¡Œ<em class="command">make </em> <em class="filename">ï¼Œ</em>æˆ‘ä»¬å¸Œæœ›<em class="command">makeèƒ½å¤Ÿè§¦åŠå­</em><em class="command">make</em>ç®¡ç†çš„æ‰€æœ‰ç›¸åº”æ–‡ä»¶ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚<code class="option">â€”touch</code><em class="filename"></em><em class="command"></em><em class="command"></em></p><p>Suppose we have added comments to a header file in our mp3
          player. Rather than recompiling all the source that depends on the
          modified header, we realize we can instead perform a <em class="command">make</em> <code class="option">â€”touch</code> to bring the
          timestamps of the files up to date. By executing the <em class="command">make</em> <code class="option">â€”touch</code> with the
          top-level <em class="filename">makefile,</em> we would
          like <em class="command">make</em> to touch all the
          appropriate files managed by sub-<em class="command">make</em>s. Let's see how this works.</p><p>é€šå¸¸ï¼Œå½“<code class="option">â€”touch</code>åœ¨å‘½ä»¤è¡Œä¸Šæä¾› æ—¶ï¼Œè§„åˆ™çš„æ­£å¸¸å¤„ç†å°†è¢«æš‚åœã€‚ç›¸åï¼Œä¼šéåŽ†ä¾èµ–å…³ç³»å›¾ï¼Œå¹¶é€šè¿‡åœ¨ç›®æ ‡ä¸Šæ‰§è¡Œ<em class="command">touch</em><code class="literal">.PHONY</code>æ¥æ›´æ–°
          é€‰å®šçš„ç›®æ ‡å’Œé‚£äº›æœªæ ‡è®°çš„å…ˆå†³æ¡ä»¶ã€‚ç”±äºŽæˆ‘ä»¬çš„å­ç›®å½•è¢«æ ‡è®°ä¸ºï¼Œå®ƒä»¬é€šå¸¸ä¼šè¢«å¿½ç•¥ï¼ˆåƒæ™®é€šæ–‡ä»¶ä¸€æ ·è§¦æ‘¸å®ƒä»¬æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼‰ã€‚ä½†æˆ‘ä»¬ä¸å¸Œæœ›è¿™äº›ç›®æ ‡è¢«å¿½ç•¥ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰§è¡Œå®ƒä»¬çš„å‘½ä»¤è„šæœ¬ã€‚ä¸ºäº†åšæ­£ç¡®çš„äº‹æƒ…ï¼Œ<em class="command">makeä¼š</em>è‡ªåŠ¨æ ‡è®°åŒ…å«ä¿®é¥°ç¬¦çš„ä»»ä½•è¡Œï¼Œè¿™æ„å‘³ç€æ— è®º
          é€‰é¡¹å¦‚ä½•ï¼Œ <em class="command">make</em>éƒ½ä¼šè¿è¡Œå­<em class="command">make</em>ã€‚<em class="command"></em><code class="literal">.PHONY</code><em class="command"></em><code class="literal">MAKE</code><code class="literal">+</code><em class="command"></em><em class="command"></em><code class="option">â€”touch</code></p><p>Usually, when <code class="option">â€”touch</code> is provided on the
          command line, the normal processing of rules is suspended. Instead,
          the dependency graph is traversed and the selected targets and those
          prerequisites that are not marked <code class="literal">.PHONY</code> are brought up to date by executing
          <em class="command">touch</em> on the target. Since our
          subdirectories are marked <code class="literal">.PHONY</code>,
          they would normally be ignored (touching them like normal files
          would be pointless). But we don't want those targets ignored, we
          want their command script executed. To do the right thing, <em class="command">make</em> automatically labels any line
          containing <code class="literal">MAKE</code> with the <code class="literal">+</code> modifier, meaning <em class="command">make</em> runs the sub-<em class="command">make</em> regardless of the
          <code class="option">â€”touch</code> option.</p><p>å½“<em class="command">make</em>è¿è¡Œå­<em class="command">make</em>æ—¶ï¼Œå®ƒâ€‹â€‹è¿˜å¿…é¡»å®‰æŽ’å°†<code class="option">â€”touch</code>æ ‡å¿—ä¼ é€’ç»™å­è¿›ç¨‹ã€‚å®ƒé€šè¿‡<code class="literal">MAKEFLAGS</code>
          å˜é‡æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å½“<em class="command">make</em>å¯åŠ¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å°†å¤§å¤šæ•°å‘½ä»¤è¡Œé€‰é¡¹é™„åŠ åˆ°<code class="literal">MAKEFLAGS</code>.å”¯ä¸€çš„ä¾‹å¤–æ˜¯é€‰é¡¹<code class="option">â€”directory</code>( <code class="option">-C</code>)ã€
           <code class="option">â€”file</code>( <code class="option">-f</code>)ã€
           <code class="option">â€”old-file</code>( <code class="option">-o</code>) å’Œ
          <code class="option">â€”new-file</code>( <code class="option">-W</code>)ã€‚ç„¶åŽè¯¥<code class="literal">MAKEFLAGS</code>å˜é‡è¢«å¯¼å‡ºåˆ°çŽ¯å¢ƒä¸­å¹¶ç”±å­<em class="command">make</em>åœ¨å¯åŠ¨æ—¶è¯»å–ã€‚</p><p>When <em class="command">make</em> runs the
          sub-<em class="command">make</em> it must also arrange for
          the <code class="option">â€”touch</code> flag to be passed to the sub-process. It
          does this through the <code class="literal">MAKEFLAGS</code>
          variable. When <em class="command">make</em> starts, it
          automatically appends most command-line options to <code class="literal">MAKEFLAGS</code>. The only exceptions are the
          options <code class="option">â€”directory</code> (<code class="option">-C</code>),
          <code class="option">â€”file</code> (<code class="option">-f</code>),
          <code class="option">â€”old-file</code> (<code class="option">-o</code>), and
          <code class="option">â€”new-file</code> (<code class="option">-W</code>). The <code class="literal">MAKEFLAGS</code> variable is then exported to the
          environment and read by the sub-<em class="command">make</em> as it starts.</p><p>æœ‰äº†è¿™ç§ç‰¹æ®Šçš„æ”¯æŒï¼Œå­å“ç‰Œ<em class="command">çš„</em>è¡Œä¸ºåŸºæœ¬ä¸Šå¯ä»¥æŒ‰ç…§æ‚¨æƒ³è¦çš„æ–¹å¼è¿›è¡Œã€‚é€‚ç”¨äºŽ
          ( )çš„é€’å½’æ‰§è¡Œ<code class="literal">$(MAKE)</code>
          å’Œç‰¹æ®Šå¤„ç†ä¹Ÿé€‚ç”¨äºŽé€‰é¡¹( ) å’Œ
          ( )ã€‚<code class="literal">MAKEFLAGS</code><code class="option">â€”touch</code><code class="option">-t</code><code class="option">â€”just-print</code><code class="option">-n</code><code class="option">â€”question</code><code class="option">-q</code></p><p>With this special support, sub-<em class="command">make</em>s behave mostly the way you want. The
          recursive execution of <code class="literal">$(MAKE)</code>
          and the special handling of <code class="literal">MAKEFLAGS</code> that is applied to
          <code class="option">â€”touch</code> (<code class="option">-t</code>) is also applied to the
          options <code class="option">â€”just-print</code> (<code class="option">-n</code>) and
          <code class="option">â€”question</code> (<code class="option">-q</code>).</p></div><div class="sect2" title="ä¼ é€’å˜é‡"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch06.html.make3-CHP-6-SECT-1.2"></a>ä¼ é€’å˜é‡</h2><h2 class="title"><a></a>Passing Variables</h2></div></div></div><p>æ­£å¦‚æˆ‘ä»¬å·²ç»æåˆ°çš„ï¼Œ<a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1373" class="indexterm"></a> <a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1374" class="indexterm"></a> <a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1375" class="indexterm"></a>å˜é‡é€šè¿‡çŽ¯å¢ƒä¼ é€’ç»™ sub- <em class="command">make</em><code class="function">export</code>å¹¶ä½¿ç”¨å’Œ
          <code class="function">unexport</code>æŒ‡ä»¤è¿›è¡ŒæŽ§åˆ¶ã€‚é€šè¿‡çŽ¯å¢ƒä¼ é€’çš„å˜é‡è¢«è§†ä¸ºé»˜è®¤å€¼ï¼Œä½†ä¼šè¢«å¯¹è¯¥å˜é‡çš„ä»»ä½•èµ‹å€¼æ‰€è¦†ç›–ã€‚ä½¿ç”¨
          <code class="option">â€”environment-overrides</code>( <code class="option">-e</code>) é€‰é¡¹å…è®¸çŽ¯å¢ƒå˜é‡è¦†ç›–æœ¬åœ°åˆ†é…ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æŒ‡ä»¤æ˜¾å¼è¦†ç›–ç‰¹å®šåˆ†é…çš„çŽ¯å¢ƒï¼ˆå³ä½¿<code class="option">â€”environment-overrides</code>ä½¿ç”¨è¯¥é€‰é¡¹ï¼‰<code class="function">override</code>
          ï¼š</p><p>As we have already mentioned, <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>variables are passed to sub-<em class="command">make</em>s through the environment and
          controlled using the <code class="function">export</code> and
          <code class="function">unexport</code> directives. Variables
          passed through the environment are taken as default values, but are
          overridden by any assignment to the variable. Use the
          <code class="option">â€”environment-overrides</code> (<code class="option">-e</code>) option
          to allow environment variables to override the local assignment. You
          can explicitly override the environment for a specific assignment
          (even when the <code class="option">â€”environment-overrides</code> option is
          used) with the <code class="function">override</code>
          directive:</p><a id="OEBPS/ch06.html.I_1_tt315"></a><pre class="programlisting">è¦†ç›– TMPDIR = ~/tmp</pre><pre class="programlisting">override TMPDIR = ~/tmp</pre><p>å¦‚æžœå‘½ä»¤è¡Œä¸Šå®šä¹‰çš„å˜é‡ä½¿ç”¨åˆæ³•çš„ shell è¯­æ³•ï¼Œåˆ™å®ƒä»¬ä¼šè‡ªåŠ¨å¯¼å‡ºåˆ°çŽ¯å¢ƒä¸­ã€‚å¦‚æžœå˜é‡ä»…ä½¿ç”¨å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œåˆ™è¯¥å˜é‡è¢«è§†ä¸ºåˆæ³•ã€‚æ¥è‡ªå‘½ä»¤è¡Œçš„å˜é‡åˆ†é…<code class="literal">MAKEFLAGS</code>ä¸Žå‘½ä»¤è¡Œé€‰é¡¹ä¸€èµ·å­˜å‚¨åœ¨å˜é‡ä¸­ã€‚</p><p>Variables defined on the command line are automatically
          exported to the environment if they use legal shell syntax. A
          variable is considered legal if it uses only letters, numbers, and
          underscores. Variable assignments from the command line are stored
          in the <code class="literal">MAKEFLAGS</code> variable along
          with command-line options.</p></div><div class="sect2" title="é”™è¯¯å¤„ç†"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch06.html.make3-CHP-6-SECT-1.3"></a>é”™è¯¯å¤„ç†</h2><h2 class="title"><a></a>Error Handling</h2></div></div></div><p>é€’å½’æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ<a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1376" class="indexterm"></a> <a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1377" class="indexterm"></a> <em class="command">make</em>å‡ºçŽ°é”™è¯¯ï¼Ÿäº‹å®žä¸Šï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«ä¸å¯»å¸¸çš„ã€‚æŽ¥æ”¶åˆ°é”™è¯¯çŠ¶æ€<em class="command">çš„ make</em>å°†ç»ˆæ­¢å…¶å¤„ç†ï¼Œé€€å‡ºçŠ¶æ€ä¸º 2ã€‚ç„¶åŽçˆ¶<em class="command">make</em>é€€å‡ºï¼Œå°†é”™è¯¯çŠ¶æ€æ²¿ç€é€’å½’<em class="command">make</em>
          è¿›ç¨‹æ ‘å‘ä¸Šä¼ æ’­ã€‚å¦‚æžœåœ¨é¡¶çº§<em class="command">make</em><code class="option">â€”keep-going</code>ä¸Šä½¿ç”¨
          ( ) é€‰é¡¹ï¼Œå®ƒå°†åƒå¾€å¸¸ä¸€æ ·ä¼ é€’ç»™å­<em class="command">make</em>ã€‚å­<em class="command">make</em>æ‰§è¡Œå…¶é€šå¸¸æ‰§è¡Œçš„æ“ä½œï¼Œè·³è¿‡å½“å‰ç›®æ ‡å¹¶ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªç›®æ ‡ï¼Œè¯¥ç›®æ ‡ä¸ä½¿ç”¨é”™è¯¯ç›®æ ‡ä½œä¸ºå…ˆå†³æ¡ä»¶ã€‚<code class="option">-k</code><em class="command"></em><em class="command"></em><em class="command"></em></p><p>What happens when a recursive<a class="indexterm"></a> <a class="indexterm"></a> <em class="command">make</em> gets an
          error? Nothing very unusual, actually. The <em class="command">make</em> receiving the error status terminates
          its processing with an exit status of 2. The parent <em class="command">make</em> then exits, propagating the error
          status up the recursive <em class="command">make</em>
          process tree. If the <code class="option">â€”keep-going</code>
          (<code class="option">-k</code>) option is used on the top-level <em class="command">make</em>, it is passed to sub-<em class="command">make</em>s as usual. The sub-<em class="command">make</em> does what it normally does, skips the
          current target and proceeds to the next goal that does not use the
          erroneous target as a prerequisite.</p><p>ä¾‹å¦‚ï¼Œå¦‚æžœæˆ‘ä»¬çš„ mp3 æ’­æ”¾å™¨ç¨‹åºåœ¨<code class="literal">lib/db</code>
          ç»„ä»¶ä¸­é‡åˆ°ç¼–è¯‘é”™è¯¯ï¼Œ<code class="literal">lib/db</code> <em class="command">make</em>å°†é€€å‡ºï¼Œå¹¶å‘é¡¶çº§<em class="filename">makefile</em>è¿”å›žçŠ¶æ€ 2 ã€‚å¦‚æžœæˆ‘ä»¬ä½¿ç”¨<code class="option">â€”keep-going</code>( <code class="option">-k</code>) é€‰é¡¹ï¼Œé¡¶çº§<em class="filename">makefile</em>
          å°†ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªä¸ç›¸å…³çš„ç›®æ ‡<code class="literal">lib/codec</code>.å½“å®ƒå®Œæˆè¯¥ç›®æ ‡æ—¶ï¼Œæ— è®ºå…¶é€€å‡ºçŠ¶æ€å¦‚ä½•ï¼Œmake<em class="command">éƒ½ä¼š</em>ä»¥çŠ¶æ€ 2 é€€å‡ºï¼Œå› ä¸ºç”±äºŽ çš„å¤±è´¥è€Œæ²¡æœ‰æ›´å¤šç›®æ ‡å¯ä»¥å¤„ç†<code class="literal">lib/db</code>ã€‚</p><p>For example, if our mp3 player program encountered a
          compilation error in the <code class="literal">lib/db</code>
          component, the <code class="literal">lib/db</code> <em class="command">make</em> would exit, returning a status of 2
          to the top-level <em class="filename">makefile</em>. If
          we used the <code class="option">â€”keep-going</code> (<code class="option">-k</code>)
          option, the top-level <em class="filename">makefile</em>
          would proceed to the next unrelated target, <code class="literal">lib/codec</code>. When it had completed that
          target, regardless of its exit status, the <em class="command">make</em> would exit with a status of 2 since
          there are no further targets that can be processed due to the
          failure of <code class="literal">lib/db</code>.</p><p><code class="option">â€”question</code>( )é€‰é¡¹<code class="option">-q</code>çš„è¡Œä¸ºéžå¸¸ç›¸ä¼¼ã€‚å¦‚æžœæŸä¸ªç›®æ ‡ä¸æ˜¯æœ€æ–°çš„ï¼Œæ­¤é€‰é¡¹ä¼šä½¿<em class="command">make</em>è¿”å›žé€€å‡ºçŠ¶æ€ 1ï¼Œå¦åˆ™è¿”å›ž 0ã€‚å½“åº”ç”¨äºŽ
          <em class="filename">makefile</em>æ ‘æ—¶ï¼Œ<em class="command">make</em>å¼€å§‹é€’å½’æ‰§è¡Œ
          <em class="filename">makefile</em>ç›´åˆ°å®ƒå¯ä»¥ç¡®å®šé¡¹ç›®æ˜¯å¦æ˜¯æœ€æ–°çš„ã€‚ä¸€æ—¦å‘çŽ°è¿‡æœŸæ–‡ä»¶ï¼Œ<em class="command">make</em>å°±ä¼šç»ˆæ­¢å½“å‰æ´»åŠ¨çš„<em class="command">make</em>å¹¶å±•å¼€é€’å½’ã€‚</p><p>The <code class="option">â€”question</code> (<code class="option">-q</code>) option
          behaves very similarly. This option causes <em class="command">make</em> to return an exit status of 1 if some
          target is not up to date, 0 otherwise. When applied to a tree of
          <em class="filename">makefile</em>s, <em class="command">make</em> begins recursively executing
          <em class="filename">makefile</em>s until it can
          determine if the project is up to date. As soon as an out-of-date
          file is found, <em class="command">make</em> terminates
          the currently active <em class="command">make</em> and
          unwinds the recursion.</p></div><div class="sect2" title="åˆ¶å®šå…¶ä»–ç›®æ ‡"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch06.html.make3-CHP-6-SECT-1.4"></a>åˆ¶å®šå…¶ä»–ç›®æ ‡</h2><h2 class="title"><a></a>Building Other Targets</h2></div></div></div><p>åŸºç¡€çš„<a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1378" class="indexterm"></a> <a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1379" class="indexterm"></a> <a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1380" class="indexterm"></a>æž„å»ºç›®æ ‡å¯¹äºŽä»»ä½•æž„å»ºç³»ç»Ÿéƒ½æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦æˆ‘ä»¬æ‰€ä¾èµ–çš„å…¶ä»–æ”¯æŒç›®æ ‡ï¼Œä¾‹å¦‚<code class="literal">clean</code>ã€<code class="literal">install</code>ã€<code class="literal">print</code>ç­‰ã€‚å› ä¸ºè¿™äº›æ˜¯<code class="literal">.PHONY</code>ç›®æ ‡ï¼Œæ‰€ä»¥å‰é¢æè¿°çš„æŠ€æœ¯ä¸èƒ½å¾ˆå¥½åœ°å·¥ä½œã€‚</p><p>The basic <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>build target is essential for any build system, but we
          also need the other support targets we've come to depend upon, such
          as <code class="literal">clean</code>, <code class="literal">install</code>, <code class="literal">print</code>, etc. Because these are <code class="literal">.PHONY</code> targets, the technique described
          earlier doesn't work very well.</p><p>ä¾‹å¦‚ï¼Œæœ‰å‡ ç§æŸåçš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š</p><p>For instance, there are several broken approaches, such
          as:</p><a id="OEBPS/ch06.html.I_1_tt316"></a><pre class="programlisting">å¹²å‡€ï¼š$ï¼ˆçŽ©å®¶ï¼‰$ï¼ˆåº“ï¼‰
        $(MAKE) --directory=$@ å¹²å‡€</pre><pre class="programlisting">clean: $(player) $(libraries)
        $(MAKE) --directory=$@ clean</pre><p>æˆ–è€…ï¼š</p><p>or:</p><a id="OEBPS/ch06.html.I_1_tt317"></a><pre class="programlisting">$ï¼ˆçŽ©å®¶ï¼‰$ï¼ˆå›¾ä¹¦é¦†ï¼‰ï¼š
        $(MAKE) --directory=$@ å¹²å‡€</pre><pre class="programlisting">$(player) $(libraries):
        $(MAKE) --directory=$@ clean</pre><p><code class="literal">$(player)</code>ç¬¬ä¸€ä¸ªè¢«ç ´åäº†ï¼Œå› ä¸ºå…ˆå†³æ¡ä»¶å°†è§¦å‘å’Œ<code class="literal">$(libraries)</code> <em class="filename">makefile</em>ä¸­é»˜è®¤ç›®æ ‡çš„æž„å»ºï¼Œè€Œä¸æ˜¯ç›®æ ‡çš„æž„å»º<code class="literal">clean</code>ã€‚ç¬¬äºŒä¸ªæ˜¯éžæ³•çš„ï¼Œå› ä¸ºè¿™äº›ç›®æ ‡å·²ç»å­˜åœ¨å¹¶å…·æœ‰ä¸åŒçš„å‘½ä»¤è„šæœ¬ã€‚</p><p>The first is broken because the prerequisites would trigger a
          build of the default target in the <code class="literal">$(player)</code> and <code class="literal">$(libraries)</code> <em class="filename">makefile</em>s, not a build of the <code class="literal">clean</code> target. The second is illegal
          because these targets already exist with a different command
          script.</p><p>ä¸€ç§å¯è¡Œçš„æ–¹æ³•ä¾èµ–äºŽ shell <em class="command">for</em>å¾ªçŽ¯ï¼š</p><p>One approach that works relies on a shell <em class="command">for</em> loop:</p><a id="OEBPS/ch06.html.I_1_tt318"></a><pre class="programlisting">å¹²å‡€çš„ï¼š
        for d in $(player) $(libraries); \
        åš \
          $(MAKE) --directory=$$d å¹²å‡€ï¼› \
        å®Œæ¯•</pre><pre class="programlisting">clean:
        for d in $(player) $(libraries); \
        do                               \
          $(MAKE) --directory=$$d clean; \
        done</pre><p>ç”±äºŽå‰é¢æè¿°çš„æ‰€æœ‰åŽŸå› ï¼Œ<em class="command">for</em>å¾ªçŽ¯å¹¶ä¸æ˜¯å¾ˆä»¤äººæ»¡æ„ï¼Œä½†å®ƒï¼ˆä»¥åŠå‰é¢çš„éžæ³•ç¤ºä¾‹ï¼‰å‘æˆ‘ä»¬æŒ‡å‡ºäº†è¿™ä¸ªè§£å†³æ–¹æ¡ˆï¼š</p><p>A <em class="command">for</em> loop is not very
          satisfying for all the reasons described earlier, but it (and the
          preceding illegal example) points us to this solution:</p><a id="OEBPS/ch06.html.I_1_tt319"></a><pre class="programlisting">$ï¼ˆçŽ©å®¶ï¼‰$ï¼ˆå›¾ä¹¦é¦†ï¼‰ï¼š
        $(MAKE) --directory=$@ $(ç›®æ ‡)</pre><pre class="programlisting">$(player) $(libraries):
        $(MAKE) --directory=$@ $(TARGET)</pre><p>é€šè¿‡å°†å˜é‡æ·»åŠ <code class="literal">$(TARGET)</code>åˆ°é€’å½’<em class="command">make</em>è¡Œå¹¶<code class="literal">TARGET</code>åœ¨<em class="command">make</em>å‘½ä»¤è¡Œä¸Šè®¾ç½®å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥å‘å­<em class="command">make</em>æ·»åŠ ä»»æ„ç›®æ ‡ï¼š</p><p>By adding the variable <code class="literal">$(TARGET)</code> to the recursive <em class="command">make</em> line and setting the <code class="literal">TARGET</code> variable on the <em class="command">make</em> command line, we can add arbitrary
          goals to the sub-<em class="command">make</em>:</p><a id="OEBPS/ch06.html.I_1_tt320"></a><pre class="programlisting">$<strong class="userinput"><code>make TARGET=clean</code></strong></pre><pre class="programlisting">$<strong class="userinput"><code>make TARGET=clean</code></strong></pre><p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ä¼šè°ƒç”¨<code class="literal">$(TARGET)</code>é¡¶å±‚<em class="filename">makefile</em>ã€‚é€šå¸¸è¿™ä¸æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºé¡¶çº§<em class="filename">makefile</em>
          æ— å…³ï¼Œä½†æ˜¯ï¼Œå¦‚æžœæœ‰å¿…è¦ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ å¦ä¸€ä¸ªç”±ä»¥ä¸‹å†…å®¹ä¿æŠ¤çš„<em class="command">make</em><code class="function">if</code>è°ƒç”¨ï¼š</p><p>Unfortunately, this does not invoke the <code class="literal">$(TARGET)</code> on the top-level <em class="filename">makefile</em>. Often this is not necessary
          because the top-level <em class="filename">makefile</em>
          has nothing to do, but, if necessary, we can add another invocation
          of <em class="command">make</em> protected by an <code class="function">if</code>:</p><a id="OEBPS/ch06.html.I_1_tt321"></a><pre class="programlisting">$ï¼ˆçŽ©å®¶ï¼‰$ï¼ˆå›¾ä¹¦é¦†ï¼‰ï¼š
        $(MAKE) --directory=$@ $(ç›®æ ‡)
        $(å¦‚æžœ$(ç›®æ ‡), $(MAKE) $(ç›®æ ‡))</pre><pre class="programlisting">$(player) $(libraries):
        $(MAKE) --directory=$@ $(TARGET)
        $(if $(TARGET), $(MAKE) $(TARGET))</pre><p>çŽ°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•åœ°åœ¨å‘½ä»¤è¡Œä¸Š<code class="literal">clean</code>
          è¿›è¡Œè®¾ç½®æ¥è°ƒç”¨ç›®æ ‡ï¼ˆæˆ–ä»»ä½•å…¶ä»–ç›®æ ‡ï¼‰ ã€‚<code class="literal">TARGET</code></p><p>Now we can invoke the <code class="literal">clean</code>
          target (or any other target) by simply setting <code class="literal">TARGET</code> on the command line.</p></div><div class="sect2" title="è·¨ Makefile ä¾èµ–å…³ç³»"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch06.html.make3-CHP-6-SECT-1.5"></a>è·¨ Makefile ä¾èµ–å…³ç³»</h2><h2 class="title"><a></a>Cross-Makefile Dependencies</h2></div></div></div><p><em class="command">make</em>
          å¯¹å‘½ä»¤è¡Œçš„ç‰¹æ®Šæ”¯æŒ<a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1381" class="indexterm"></a>é€šè¿‡çŽ¯å¢ƒå˜é‡è¿›è¡Œçš„é€‰é¡¹å’Œé€šä¿¡è¡¨æ˜Žé€’å½’<em class="command">make</em>å·²è¢«è°ƒæ•´ä¸ºå¯ä»¥æ­£å¸¸å·¥ä½œã€‚é‚£ä¹ˆå‰é¢æåˆ°çš„ä¸¥é‡å¹¶å‘ç—‡æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>The special support in <em class="command">make</em>
          for command-line <a class="indexterm"></a>options and communication through environment
          variables suggests that recursive <em class="command">make</em> has been tuned to work well. So what
          are the serious complications alluded to earlier?</p><p>ç”±é€’å½’å‘½ä»¤é“¾æŽ¥çš„å•ç‹¬çš„<em class="filename">makefile</em><code class="literal">$(MAKE)</code>ä»…è®°å½•æœ€è¡¨é¢çš„é¡¶çº§é“¾æŽ¥ã€‚ä¸å¹¸çš„æ˜¯ï¼ŒæŸäº›ç›®å½•ä¸­ç»å¸¸éšè—ç€å¾®å¦™çš„ä¾èµ–å…³ç³»ã€‚</p><p>Separate <em class="filename">makefile</em>s linked
          by recursive <code class="literal">$(MAKE)</code> commands
          record only the most superficial top-level links. Unfortunately,
          there are often subtle dependencies buried in some
          directories.</p><p>ä¾‹å¦‚ï¼Œå‡è®¾<em class="filename">db</em>
          æ¨¡å—åŒ…å«ä¸€ä¸ªåŸºäºŽ<em class="command">yacc</em>çš„è§£æžå™¨ï¼Œç”¨äºŽå¯¼å…¥å’Œå¯¼å‡ºéŸ³ä¹æ•°æ®ã€‚å¦‚æžœ<em class="filename">ui</em>æ¨¡å—<em class="filename">ui.c</em>åŒ…å«ç”Ÿæˆçš„<em class="command">yacc</em>æ ‡å¤´ï¼Œåˆ™è¿™ä¸¤ä¸ªæ¨¡å—ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ã€‚å¦‚æžœä¾èµ–å…³ç³»è¢«æ­£ç¡®å»ºæ¨¡ï¼Œ
          åªè¦è¯­æ³•å¤´æ›´æ–°ï¼Œ<em class="command">make</em>å°±åº”è¯¥çŸ¥é“é‡æ–°ç¼–è¯‘æˆ‘ä»¬çš„
          <em class="filename">ui</em>æ¨¡å—ã€‚ä½¿ç”¨å‰é¢æè¿°çš„è‡ªåŠ¨ä¾èµ–æ€§ç”ŸæˆæŠ€æœ¯æ¥å®‰æŽ’è¿™ä¸€ç‚¹å¹¶ä¸å›°éš¾ã€‚ä½†æ˜¯å¦‚æžœ<em class="command">yacc</em>æ–‡ä»¶æœ¬èº«è¢«ä¿®æ”¹äº†æ€Žä¹ˆåŠžï¼Ÿåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“è¿è¡Œ<em class="filename">ui </em> <em class="filename">makefileæ—¶ï¼Œæ­£ç¡®çš„</em><em class="filename">makefile</em>å°†è¯†åˆ«å‡ºåœ¨ç¼–è¯‘<em class="filename">ui.cä¹‹å‰å¿…é¡»é¦–å…ˆè¿è¡Œ</em><em class="command">yacc</em>æ¥ç”Ÿæˆè§£æžå™¨å’Œæ ‡å¤´ã€‚åœ¨æˆ‘ä»¬çš„é€’å½’åˆ†è§£ä¸­ï¼Œè¿™ç§æƒ…å†µä¸ä¼šå‘ç”Ÿï¼Œå› ä¸ºè¿è¡Œ<em class="command">yacc</em>çš„è§„åˆ™å’Œä¾èµ–é¡¹ä½äºŽ<em class="filename">db </em><em class="filename">makefile</em>ä¸­ï¼Œè€Œä¸æ˜¯<em class="filename">ui </em><em class="filename">makefile ä¸­</em>ã€‚<em class="filename"></em><code class="literal">make</code><em class="command"></em><em class="filename"></em> <em class="filename"></em><em class="filename"></em> <em class="filename"></em></p><p>For example, suppose a <em class="filename">db</em>
          module includes a <em class="command">yacc</em>-based
          parser for importing and exporting music data. If the <em class="filename">ui</em> module, <em class="filename">ui.c</em>, includes the generated <em class="command">yacc</em> header, we have a dependency between
          these two modules. If the dependencies are properly modeled,
          <em class="command">make</em> should know to recompile our
          <em class="filename">ui</em> module whenever the grammar
          header is updated. This is not difficult to arrange using the
          automatic dependency generation technique described earlier. But
          what if the <em class="command">yacc</em> file itself is
          modified? In this case, when the <em class="filename">ui</em> <em class="filename">makefile</em> is run, a correct <em class="filename">makefile</em> would recognize that <em class="command">yacc</em> must first be run to generate the
          parser and header before compiling <em class="filename">ui.c</em>. In our recursive <code class="literal">make</code> decomposition, this does not occur,
          because the rule and dependencies for running <em class="command">yacc</em> are in the <em class="filename">db</em> <em class="filename">makefile</em>, not the <em class="filename">ui</em> <em class="filename">makefile</em>.</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬èƒ½åšçš„æœ€å¥½çš„äº‹æƒ…å°±æ˜¯ç¡®ä¿
          <em class="filename">db </em> <em class="filename">makefileå§‹ç»ˆåœ¨æ‰§è¡Œ</em><em class="filename">ui </em> <em class="filename">makefile</em>ä¹‹å‰æ‰§è¡Œã€‚è¿™ç§æ›´é«˜çº§åˆ«çš„ä¾èµ–å…³ç³»å¿…é¡»æ‰‹åŠ¨ç¼–ç ã€‚æˆ‘ä»¬åœ¨<em class="filename">makefile</em>çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¸­è¶³å¤Ÿèªæ˜Žåœ°è®¤è¯†åˆ°äº†è¿™ä¸€ç‚¹ï¼Œä½†æ€»çš„æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªéžå¸¸å›°éš¾çš„ç»´æŠ¤é—®é¢˜ã€‚å½“ç¼–å†™å’Œä¿®æ”¹ä»£ç æ—¶ï¼Œé¡¶å±‚<em class="filename">makefile</em>å°†æ— æ³•æ­£ç¡®è®°å½•æ¨¡å—é—´ä¾èµ–å…³ç³»ã€‚</p><p>In this case, the best we can do is to ensure that the
          <em class="filename">db</em> <em class="filename">makefile</em> is always executed before
          executing the <em class="filename">ui</em> <em class="filename">makefile</em>. This higher-level dependency
          must be encoded by hand. We were astute enough in the first version
          of our <em class="filename">makefile</em> to recognize
          this, but, in general, this is a very difficult maintenance problem.
          As code is written and modified, the top-level <em class="filename">makefile</em> will fail to properly record the
          intermodule dependencies.</p><p>ç»§ç»­è¿™ä¸ªä¾‹å­ï¼Œå¦‚æžœ<em class="filename">db</em>ä¸­çš„<em class="command">yacc</em>è¯­æ³•è¢«æ›´æ–°ï¼Œå¹¶ä¸”<em class="filename">ui </em><em class="filename">makefileåœ¨</em><em class="filename">db </em><em class="filename">makefile</em>ä¹‹å‰è¿è¡Œï¼ˆé€šè¿‡ç›´æŽ¥æ‰§è¡Œå®ƒè€Œä¸æ˜¯é€šè¿‡é¡¶çº§<em class="filename">makefile</em>ï¼‰ï¼Œé‚£ä¹ˆ<em class="filename">ui </em><em class="filename">makefile</em>ä¸çŸ¥é“ ä¸­å­˜åœ¨æœªæ»¡è¶³çš„ä¾èµ–å…³ç³»å¿…é¡»<em class="filename">è¿è¡Œ db makefile</em>å’Œ<em class="filename">yacc</em>æ¥<em class="command">æ›´æ–°</em>å¤´æ–‡ä»¶ã€‚ç›¸åï¼Œ<em class="filename">ui </em><em class="filename">makefileä½¿ç”¨æ—§çš„</em><em class="command">yacc</em>æ ‡å¤´ç¼–è¯‘å…¶ç¨‹åºã€‚å¦‚æžœå·²å®šä¹‰æ–°ç¬¦å·å¹¶ä¸”çŽ°åœ¨æ­£åœ¨å¼•ç”¨æ–°ç¬¦å·ï¼Œåˆ™ä¼šæŠ¥å‘Šç¼–è¯‘é”™è¯¯ã€‚å› æ­¤ï¼Œé€’å½’<em class="command">make</em>æ–¹æ³•æœ¬è´¨ä¸Šæ¯”å•ä¸ª<em class="filename">makefile</em>æ›´è„†å¼±ã€‚<em class="filename"></em><em class="filename"></em> <em class="filename"></em><em class="filename"></em> <em class="filename"></em><em class="filename"></em><em class="filename"></em> <em class="filename"></em><em class="filename"></em> <em class="filename"></em><em class="command"></em><em class="filename"></em> <em class="filename"></em><em class="command"></em><em class="command"></em><em class="filename"></em></p><p>To continue the example, if the <em class="command">yacc</em> grammar in <em class="filename">db</em> is updated and the <em class="filename">ui</em> <em class="filename">makefile</em> is run before the <em class="filename">db</em> <em class="filename">makefile</em> (by executing it directly
          instead of through the top-level <em class="filename">makefile</em>), the <em class="filename">ui</em> <em class="filename">makefile</em> does not know there is an
          unsatisfied dependency in the <em class="filename">db</em> <em class="filename">makefile</em> and that <em class="command">yacc</em> must be run to update the header
          file. Instead, the <em class="filename">ui</em> <em class="filename">makefile</em> compiles its program with the
          old <em class="command">yacc</em> header. If new symbols
          have been defined and are now being referenced, then a compilation
          error is reported. Thus, the recursive <em class="command">make</em> approach is inherently more fragile
          than a single <em class="filename">makefile</em>.</p><p>å½“ä»£ç ç”Ÿæˆå™¨è¢«æ›´å¹¿æ³›åœ°ä½¿ç”¨æ—¶ï¼Œé—®é¢˜ä¼šå˜å¾—æ›´åŠ ä¸¥é‡ã€‚å‡è®¾å°† RPC å­˜æ ¹ç”Ÿæˆå™¨çš„ä½¿ç”¨æ·»åŠ åˆ°<em class="filename">uiä¸­ï¼Œå¹¶åœ¨</em><em class="filename">db</em>ä¸­å¼•ç”¨æ ‡å¤´ã€‚çŽ°åœ¨æˆ‘ä»¬æœ‰ç›¸äº’å‚è€ƒæ¥åº”å¯¹ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯èƒ½éœ€è¦è®¿é—®<em class="filename">db</em>æ¥ç”Ÿæˆ<em class="command">yacc</em>å¤´ï¼Œç„¶åŽè®¿é—®<em class="filename">ui</em>æ¥ç”ŸæˆRPCå­˜æ ¹ï¼Œç„¶åŽè®¿é—®<em class="filename">db</em>æ¥ç¼–è¯‘æ–‡ä»¶ï¼Œæœ€åŽè®¿é—®<em class="filename">ui</em>
          æ¥å®Œæˆç¼–è¯‘è¿‡ç¨‹ã€‚åˆ›å»ºå’Œç¼–è¯‘é¡¹ç›®æºä»£ç æ‰€éœ€çš„éæ•°å–å†³äºŽä»£ç çš„ç»“æž„ä»¥åŠç”¨äºŽåˆ›å»ºä»£ç çš„å·¥å…·ã€‚è¿™ç§ç›¸äº’å¼•ç”¨åœ¨å¤æ‚ç³»ç»Ÿä¸­å¾ˆå¸¸è§ã€‚</p><p>The problem worsens when code generators are used more
          extensively. Suppose that the use of an RPC stub generator is added
          to <em class="filename">ui</em> and the headers are
          referenced in <em class="filename">db</em>. Now we have
          mutual reference to contend with. To resolve this, it may be
          required to visit <em class="filename">db</em> to
          generate the <em class="command">yacc</em> header, then
          visit <em class="filename">ui</em> to generate the RPC
          stubs, then visit <em class="filename">db</em> to compile
          the files, and finally visit <em class="filename">ui</em>
          to complete the compilation process. The number of passes required
          to create and compile the source for a project is dependent on the
          structure of the code and the tools used to create it. This kind of
          mutual reference is common in complex systems.</p><p>çŽ°å®žä¸–ç•Œä¸­<em class="filename">makefile</em>çš„æ ‡å‡†è§£å†³æ–¹æ¡ˆé€šå¸¸æ˜¯ hackã€‚ä¸ºäº†ç¡®ä¿æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯æœ€æ–°çš„ï¼Œå½“å‘é¡¶çº§<em class="filename">makefileå‘å‡ºå‘½ä»¤æ—¶ï¼Œæ¯ä¸ª</em><em class="filename">makefile</em>éƒ½ä¼šè¢«æ‰§è¡Œã€‚è¯·æ³¨æ„ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬çš„ mp3 æ’­æ”¾å™¨<em class="filename">makefile</em>
          æ‰€åšçš„äº‹æƒ…ã€‚å½“é¡¶å±‚<em class="filename">makefile</em>è¿è¡Œæ—¶ï¼Œå››ä¸ªå­<em class="filename">makefile</em>ä¸­çš„æ¯ä¸€ä¸ªéƒ½ä¼šæ— æ¡ä»¶è¿è¡Œã€‚åœ¨å¤æ‚çš„æƒ…å†µä¸‹ï¼Œä¼šé‡å¤è¿è¡Œ<em class="filename">makefile</em>ä»¥ç¡®ä¿é¦–å…ˆç”Ÿæˆç„¶åŽç¼–è¯‘æ‰€æœ‰ä»£ç ã€‚é€šå¸¸ï¼Œè¿™ç§è¿­ä»£æ‰§è¡Œå®Œå…¨æ˜¯æµªè´¹æ—¶é—´ï¼Œä½†æœ‰æ—¶æ˜¯å¿…éœ€çš„ã€‚<em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em></p><p>The standard solution in real-world <em class="filename">makefile</em>s is usually a hack. To ensure
          that all files are up to date, every <em class="filename">makefile</em> is executed when a command is
          given to the top-level <em class="filename">makefile</em>. Notice that this is precisely
          what our mp3 player <em class="filename">makefile</em>
          does. When the top-level <em class="filename">makefile</em> is run, each of the four
          sub-<em class="filename">makefile</em>s is
          unconditionally run. In complex cases, <em class="filename">makefile</em>s are run repeatedly to ensure
          that all code is first generated then compiled. Often this iterative
          execution is a complete waste of time, but occasionally it is
          required.</p></div><div class="sect2" title="é¿å…é‡å¤ä»£ç "><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch06.html.make3-CHP-6-SECT-1.6"></a>é¿å…é‡å¤ä»£ç </h2><h2 class="title"><a></a>Avoiding Duplicate Code</h2></div></div></div><p>æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„ç›®å½•å¸ƒå±€<a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1382" class="indexterm"></a> <a id="OEBPS/ch06.html.make3-CHP-6-ITERM-1383" class="indexterm"></a>åŒ…æ‹¬ä¸‰ä¸ªåº“ã€‚è¿™äº›åº“<em class="filename">çš„ makefile</em>éžå¸¸ç›¸ä¼¼ã€‚è¿™æ˜¯æœ‰é“ç†çš„ï¼Œå› ä¸ºè¿™ä¸‰ä¸ªåº“åœ¨æœ€ç»ˆåº”ç”¨ç¨‹åºä¸­å…·æœ‰ä¸åŒçš„ç”¨é€”ï¼Œä½†éƒ½æ˜¯ä½¿ç”¨ç±»ä¼¼çš„å‘½ä»¤æž„å»ºçš„ã€‚è¿™ç§åˆ†è§£æ˜¯å¤§åž‹é¡¹ç›®çš„å…¸åž‹åšæ³•ï¼Œä¼šå¯¼è‡´è®¸å¤šç±»ä¼¼çš„<em class="filename">makefile</em>å’Œå¤§é‡ ( <em class="filename">makefile</em> ) ä»£ç é‡å¤ã€‚</p><p>The directory layout of our application <a class="indexterm"></a> <a class="indexterm"></a>includes three libraries. The <em class="filename">makefile</em>s for these libraries are very
          similar. This makes sense because the three libraries serve
          different purposes in the final application but are all built with
          similar commands. This kind of decomposition is typical of large
          projects and leads to many similar <em class="filename">makefile</em>s and lots of (<em class="filename">makefile</em>) code duplication.</p><p>ä»£ç é‡å¤æ˜¯ä¸å¥½çš„ï¼Œç”šè‡³<em class="filename">makefile</em>ä»£ç é‡å¤ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å®ƒå¢žåŠ äº†è½¯ä»¶çš„ç»´æŠ¤æˆæœ¬å¹¶å¯¼è‡´æ›´å¤šçš„é”™è¯¯ã€‚å®ƒè¿˜ä½¿å¾—ç†è§£ç®—æ³•å’Œè¯†åˆ«å…¶ä¸­çš„å¾®å°å˜åŒ–å˜å¾—æ›´åŠ å›°éš¾ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½é¿å…<em class="filename">makefileä¸­çš„ä»£ç é‡å¤ã€‚é€šè¿‡å°†</em><em class="filename">makefile</em>çš„å…¬å…±éƒ¨åˆ†ç§»åŠ¨åˆ°å…¬å…±åŒ…å«æ–‡ä»¶ä¸­ï¼Œå¯ä»¥æœ€è½»æ¾åœ°å®žçŽ°æ­¤ç›®çš„ã€‚</p><p>Code duplication is bad, even <em class="filename">makefile</em> code duplication. It increases
          the maintenance costs of the software and leads to more bugs. It
          also makes it more difficult to understand algorithms and identify
          minor variations in them. So we would like to avoid code duplication
          in our <em class="filename">makefile</em>s as much as
          possible. This is most easily accomplished by moving the common
          pieces of a <em class="filename">makefile</em> into a
          common include file.</p><p>ä¾‹å¦‚ï¼Œ<em class="filename">ç¼–è§£ç å™¨</em>
          <em class="filename">makefile</em>åŒ…å«ï¼š</p><p>For example, the <em class="filename">codec</em>
          <em class="filename">makefile</em> contains:</p><a id="OEBPS/ch06.html.I_1_tt322"></a><pre class="programlisting">lib_codec := libcodec.a
æ¥æºï¼š=ç¼–è§£ç å™¨.c
å¯¹è±¡ := $(subst .c,.o,$(æ¥æº))
ä¾èµ–é¡¹ := $(subst .c,.d,$(æº))

include_dirs := .. ../../include
CPPFLAGS += $(addprefix -I ,$(include_dirs))
vpath %.h $(include_dirs)

å…¨éƒ¨ï¼š$(lib_codec)

$(lib_codec): $(å¯¹è±¡)
        $(AR) $(ARFLAGS) $@ $^

.PHONYï¼šå¹²å‡€
å¹²å‡€çš„ï¼š
        $(RM) $(lib_codec) $(å¯¹è±¡) $(ä¾èµ–é¡¹)

ifneq "$(MAKECMDGOALS)" "å¹²å‡€"
  åŒ…æ‹¬ $(ä¾èµ–é¡¹)
ä¸‡ä¸€

%.d: %.c
        $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -M $&lt; | \
        sed 's,\($*\.o\) *:,\1 $@: ,' &gt; $@.tmp
        mv $@.tmp $@</pre><pre class="programlisting">lib_codec    := libcodec.a
sources      := codec.c
objects      := $(subst .c,.o,$(sources))
dependencies := $(subst .c,.d,$(sources))

include_dirs := .. ../../include
CPPFLAGS     += $(addprefix -I ,$(include_dirs))
vpath %.h $(include_dirs)

all: $(lib_codec)

$(lib_codec): $(objects)
        $(AR) $(ARFLAGS) $@ $^

.PHONY: clean
clean:
        $(RM) $(lib_codec) $(objects) $(dependencies)

ifneq "$(MAKECMDGOALS)" "clean"
  include $(dependencies)
endif

%.d: %.c
        $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -M $&lt; |      \
        sed 's,\($*\.o\) *:,\1 $@: ,' &gt; $@.tmp
        mv $@.tmp $@</pre><p>å‡ ä¹Žæ‰€æœ‰è¿™äº›ä»£ç éƒ½åœ¨<em class="filename">db</em>å’Œ<em class="filename">ui </em> <em class="filename">makefile</em>ä¸­é‡å¤ã€‚æ¯ä¸ªåº“å”¯ä¸€æ”¹å˜çš„è¡Œæ˜¯åº“æœ¬èº«çš„åç§°å’Œåº“åŒ…å«çš„æºæ–‡ä»¶ã€‚å½“é‡å¤çš„ä»£ç è¢«ç§»å…¥<em class="filename">common.mk</em>æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ­¤<em class="filename">makefile</em>å‰Šå‡ä¸ºï¼š</p><p>Almost all of this code is duplicated in the <em class="filename">db</em> and <em class="filename">ui</em> <em class="filename">makefile</em>s. The only lines that change for
          each library are the name of the library itself and the source files
          the library contains. When duplicate code is moved into <em class="filename">common.mk</em>, we can pare this <em class="filename">makefile</em> down to:</p><a id="OEBPS/ch06.html.I_1_tt323"></a><pre class="programlisting">åº“ := libcodec.a
æ¥æºï¼š=ç¼–è§£ç å™¨.c

åŒ…æ‹¬../../common.mk</pre><pre class="programlisting">library := libcodec.a
sources := codec.c

include ../../common.mk</pre><p>æŸ¥çœ‹æˆ‘ä»¬å·²å°†å“ªäº›å†…å®¹ç§»å…¥å•ä¸ªå…±äº«åŒ…å«æ–‡ä»¶ä¸­ï¼š</p><p>See what we have moved into the single, shared include
          file:</p><a id="OEBPS/ch06.html.I_1_tt324"></a><pre class="programlisting">MV := mv -f
RM := rm -f
SED := sed

å¯¹è±¡ := $(subst .c,.o,$(æ¥æº))
ä¾èµ–é¡¹ := $(subst .c,.d,$(æº))
include_dirs := .. ../../include
CPPFLAGS += $(addprefix -I ,$(include_dirs))

vpath %.h $(include_dirs)

.PHONYï¼šå›¾ä¹¦é¦†
å›¾ä¹¦é¦†ï¼š$ï¼ˆå›¾ä¹¦é¦†ï¼‰

$ï¼ˆåº“ï¼‰ï¼š$ï¼ˆå¯¹è±¡ï¼‰
        $(AR) $(ARFLAGS) $@ $^

.PHONYï¼šå¹²å‡€
å¹²å‡€çš„ï¼š
        $(RM) $(å¯¹è±¡) $(ç¨‹åº) $(åº“) $(ä¾èµ–é¡¹) $(extra_clean)

ifneq "$(MAKECMDGOALS)" "å¹²å‡€"
  -åŒ…æ‹¬$ï¼ˆä¾èµ–é¡¹ï¼‰
ä¸‡ä¸€

%.c %.h: %.y
        $(YACC.y) --å®šä¹‰$&lt;
        $(MV) y.tab.c $*.c
        $(MV) y.tab.h $*.h

%.d: %.c
        $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -M $&lt; | \
        $(SED) 's,\($*\.o\) *:,\1 $@: ,' &gt; $@.tmp
        $(MV) $@.tmp $@</pre><pre class="programlisting">MV           := mv -f
RM           := rm -f
SED          := sed

objects      := $(subst .c,.o,$(sources))
dependencies := $(subst .c,.d,$(sources))
include_dirs := .. ../../include
CPPFLAGS     += $(addprefix -I ,$(include_dirs))

vpath %.h $(include_dirs)

.PHONY: library
library: $(library)

$(library): $(objects)
        $(AR) $(ARFLAGS) $@ $^

.PHONY: clean
clean:
        $(RM) $(objects) $(program) $(library) $(dependencies) $(extra_clean)

ifneq "$(MAKECMDGOALS)" "clean"
  -include $(dependencies)
endif

%.c %.h: %.y
        $(YACC.y) --defines $&lt;
        $(MV) y.tab.c $*.c
        $(MV) y.tab.h $*.h

%.d: %.c
        $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -M $&lt; |      \
        $(SED) 's,\($*\.o\) *:,\1 $@: ,' &gt; $@.tmp
        $(MV) $@.tmp $@</pre><p><em class="filename">æ¯ä¸ªmakefile</em><code class="literal">include_dirs</code>éƒ½ä¸åŒçš„å˜é‡çŽ°åœ¨åœ¨æ‰€æœ‰
          <em class="filename">makefile</em>ä¸­éƒ½æ˜¯ç›¸åŒçš„ï¼Œå› ä¸ºæˆ‘ä»¬é‡æ–°è®¾è®¡äº†ç”¨äºŽåŒ…å«å¤´æ–‡ä»¶çš„è·¯å¾„æºæ–‡ä»¶ï¼Œä»¥ä½¿æ‰€æœ‰åº“ä½¿ç”¨ç›¸åŒçš„åŒ…å«è·¯å¾„ã€‚<em class="filename"></em><em class="filename"></em></p><p>The variable <code class="literal">include_dirs</code>,
          which was different for each <em class="filename">makefile</em>, is now identical in all
          <em class="filename">makefile</em>s because we reworked
          the path source files use for included headers to make all libraries
          use the same include path.</p><p>common.mk<em class="filename">æ–‡ä»¶</em>ç”šè‡³åŒ…å«åº“åŒ…å«æ–‡ä»¶çš„é»˜è®¤ç›®æ ‡ã€‚åŽŸå§‹çš„<em class="filename">makefile</em>ä½¿ç”¨é»˜è®¤çš„ target <code class="literal">all</code>ã€‚è¿™ä¼šå¯¼è‡´éžåº“<em class="filename">makefile</em>å‡ºçŽ°é—®é¢˜ï¼Œéœ€è¦ä¸ºå…¶é»˜è®¤ç›®æ ‡æŒ‡å®šä¸€ç»„ä¸åŒçš„å…ˆå†³æ¡ä»¶ã€‚å› æ­¤å…±äº«ä»£ç ç‰ˆæœ¬ä½¿ç”¨é»˜è®¤ç›®æ ‡<code class="literal">library</code>.</p><p>The <em class="filename">common.mk</em> file even
          includes the default goal for the library include files. The
          original <em class="filename">makefile</em>s used the
          default target <code class="literal">all</code>. That would
          cause problems with nonlibrary <em class="filename">makefile</em>s that need to specify a
          different set of prerequisites for their default goal. So the shared
          code version uses a default target of <code class="literal">library</code>.</p><p><em class="filename">è¯·æ³¨æ„ï¼Œå› ä¸ºæ­¤å…¬å…±æ–‡ä»¶åŒ…å«ç›®æ ‡ï¼Œæ‰€ä»¥å®ƒå¿…é¡»åŒ…å«åœ¨éžåº“makefile</em>çš„é»˜è®¤ç›®æ ‡ä¹‹åŽã€‚å¦è¯·æ³¨æ„ï¼Œ<code class="literal">clean</code>å‘½ä»¤è„šæœ¬å¼•ç”¨äº†å˜é‡<code class="literal">program</code>ã€<code class="literal">library</code>å’Œ<code class="literal">extra_clean</code>ã€‚å¯¹äºŽåº“<em class="filename">makefile</em>ï¼Œè¯¥<code class="literal">program</code>å˜é‡ä¸ºç©ºï¼›å¯¹äºŽç¨‹åº
          <em class="filename">makefile</em>ï¼Œè¯¥<code class="literal">library</code>å˜é‡ä¸ºç©ºã€‚è¯¥<code class="literal">extra_clean</code>å˜é‡æ˜¯ä¸“é—¨ä¸º<em class="filename">db </em>
          <em class="filename">makefile</em>æ·»åŠ çš„ã€‚æ­¤<em class="filename">makefile</em>ä½¿ç”¨å˜é‡æ¥è¡¨ç¤º<em class="command">yacc</em>ç”Ÿæˆçš„ä»£ç ã€‚<em class="filename">ç”Ÿæˆæ–‡ä»¶</em>æ˜¯ï¼š</p><p>Notice that because this common file contains targets it must
          be included after the default target for nonlibrary <em class="filename">makefile</em>s. Also notice that the <code class="literal">clean</code> command script references the
          variables <code class="literal">program</code>, <code class="literal">library</code>, and <code class="literal">extra_clean</code>. For library <em class="filename">makefile</em>s, the <code class="literal">program</code> variable is empty; for program
          <em class="filename">makefile</em>s, the <code class="literal">library</code> variable is empty. The <code class="literal">extra_clean</code> variable was added
          specifically for the <em class="filename">db</em>
          <em class="filename">makefile</em>. This <em class="filename">makefile</em> uses the variable to denote code
          generated by <em class="command">yacc</em>. The <em class="filename">makefile</em> is:</p><a id="OEBPS/ch06.html.I_1_tt325"></a><pre class="programlisting">åº“ := libdb.a
æ¥æºï¼š=æ‰«æä»ª.c æ’­æ”¾åˆ—è¡¨.c
extra_clean := $(sources) playlist.h

.SECONDARYï¼šæ’­æ”¾åˆ—è¡¨.c æ’­æ”¾åˆ—è¡¨.h æ‰«æä»ª.c

åŒ…æ‹¬../../common.mk</pre><pre class="programlisting">library     := libdb.a
sources     := scanner.c playlist.c
extra_clean := $(sources) playlist.h

.SECONDARY: playlist.c playlist.h scanner.c

include ../../common.mk</pre><p>ä½¿ç”¨è¿™äº›æŠ€æœ¯ï¼Œå¯ä»¥å°†ä»£ç é‡å¤ä¿æŒåœ¨æœ€ä½Žé™åº¦ã€‚éšç€æ›´å¤šçš„<em class="filename">makefile</em>ä»£ç è¢«ç§»å…¥é€šç”¨<em class="filename">makefile</em>ä¸­ï¼Œå®ƒæ¼”å˜æˆ
          æ•´ä¸ªé¡¹ç›®çš„é€šç”¨<em class="filename">makefile ã€‚ </em><em class="command">make</em>å˜é‡å’Œç”¨æˆ·å®šä¹‰çš„å‡½æ•°ç”¨ä½œè‡ªå®šä¹‰ç‚¹ï¼Œå…è®¸ä¸ºæ¯ä¸ªç›®å½•ä¿®æ”¹é€šç”¨<em class="filename">makefile ã€‚</em></p><p>Using these techniques, code duplication can be kept to a
          minimum. As more <em class="filename">makefile</em> code
          is moved into the common <em class="filename">makefile</em>, it evolves into a generic
          <em class="filename">makefile</em> for the entire
          project. <em class="command">make</em> variables and
          user-defined functions are used as customization points, allowing
          the generic <em class="filename">makefile</em> to be
          modified for each directory.</p></div></div><div class="footnotes"><br><br><hr><div class="footnote"><p><sup>[ <a id="OEBPS/ch06.html.ftn.make3-CHP-6-FNOTE-1" href="#OEBPS/ch06.html.make3-CHP-6-FNOTE-1" class="para">1</a> ]</sup> Millerï¼ŒPAï¼Œ<span class="emphasis"><em>é€’å½’ä½¿äººè®¤ä¸ºæœ‰å®³</em></span>ï¼ŒAUUGN Journal of AUUG Inc.ï¼Œ19(1)ï¼Œç¬¬ 14-25 é¡µ (1998)ã€‚ä¹Ÿå¯ä»Ž<a class="ulink" href="http://aegis.sourceforge.net/auug97.pdf">http://aegis.sourceforge.net/auug97.pdf</a>èŽ·å–ã€‚</p><p><sup>[<a href="#OEBPS/ch06.html.make3-CHP-6-FNOTE-1" class="para">1</a>] </sup>Miller, P.A., <span class="emphasis"><em>Recursive Make Considered
          Harmful</em></span>, AUUGN Journal of AUUG Inc., 19(1), pp. 14-25
          (1998). Also available from <a class="ulink" href="http://aegis.sourceforge.net/auug97.pdf">http://aegis.sourceforge.net/auug97.pdf</a>.</p></div></div></div></div></div>
<div id="OEBPS/ch06s02.html"><div>
<div class="sect1" title="éžé€’å½’make"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch06s02.html.make3-CHP-6-SECT-2"></a>éžé€’å½’make</h1><h1 class="title"><a></a>Nonrecursive make</h1></div></div></div><p>å¤šç›®å½•é¡¹ç›®<a id="OEBPS/ch06s02.html.make3-CHP-6-ITERM-1384" class="indexterm"></a> <a id="OEBPS/ch06s02.html.make3-CHP-6-ITERM-1385" class="indexterm"></a> <a id="OEBPS/ch06s02.html.make3-CHP-6-ITERM-1386" class="indexterm"></a>ä¹Ÿå¯ä»¥åœ¨æ²¡æœ‰é€’å½’<em class="command">make</em>çš„æƒ…å†µä¸‹è¿›è¡Œç®¡ç†ã€‚æ­¤å¤„çš„åŒºåˆ«åœ¨äºŽ<em class="filename">makefile</em>æ“ä½œçš„æºä»£ç ä½äºŽå¤šä¸ªç›®å½•ä¸­ã€‚ä¸ºäº†é€‚åº”è¿™ç§æƒ…å†µï¼Œå¯¹å­ç›®å½•ä¸­æ–‡ä»¶çš„å¼•ç”¨å¿…é¡»åŒ…å«æ–‡ä»¶çš„è·¯å¾„ - ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ã€‚</p><p>Multidirectory projects <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>can also be managed without recursive <em class="command">make</em>s. The difference here is that the
        source manipulated by the <em class="filename">makefile</em> lives in more than one directory.
        To accommodate this, references to files in subdirectories must
        include the path to the fileâ€”either absolute or relative.</p><p>é€šå¸¸ï¼Œç®¡ç†å¤§åž‹é¡¹ç›®çš„<em class="filename">makefile</em>
        æœ‰è®¸å¤šç›®æ ‡ï¼Œé¡¹ç›®ä¸­çš„æ¯ä¸ªæ¨¡å—éƒ½æœ‰ä¸€ä¸ªç›®æ ‡ã€‚å¯¹äºŽæˆ‘ä»¬çš„ mp3 æ’­æ”¾å™¨ç¤ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦æ¯ä¸ªåº“å’Œæ¯ä¸ªåº”ç”¨ç¨‹åºçš„ç›®æ ‡ã€‚å®ƒä¹Ÿå¯èƒ½æœ‰ç”¨
        <a id="OEBPS/ch06s02.html.make3-CHP-6-ITERM-1387" class="indexterm"></a> <a id="OEBPS/ch06s02.html.make3-CHP-6-ITERM-1388" class="indexterm"></a>ä¸ºæ¨¡å—é›†åˆæ·»åŠ è™šå‡ç›®æ ‡ï¼Œä¾‹å¦‚æ‰€æœ‰åº“çš„é›†åˆã€‚é»˜è®¤ç›®æ ‡é€šå¸¸ä¼šæž„å»ºæ‰€æœ‰è¿™äº›ç›®æ ‡ã€‚é€šå¸¸ï¼Œé»˜è®¤ç›®æ ‡ä¼šæž„å»ºæ–‡æ¡£å¹¶è¿è¡Œæµ‹è¯•è¿‡ç¨‹ã€‚</p><p>Often, the <em class="filename">makefile</em>
        managing a large project has many targets, one for each module in the
        project. For our mp3 player example, we would need targets for each of
        the libraries and each of the applications. It can also be useful
        <a class="indexterm"></a> <a class="indexterm"></a>to add phony targets for collections of modules such as
        the collection of all libraries. The default goal would typically
        build all of these targets. Often the default goal builds
        documentation and runs a testing procedure as well.</p><p><em class="command">éžé€’å½’make</em>æœ€ç›´æŽ¥çš„ç”¨æ³•åŒ…æ‹¬å•ä¸ª<em class="filename">makefile</em>ä¸­çš„ç›®æ ‡ã€ç›®æ ‡æ–‡ä»¶å¼•ç”¨å’Œä¾èµ–é¡¹ã€‚è¿™å¯¹äºŽç†Ÿæ‚‰é€’å½’<em class="command">make</em>çš„å¼€å‘äººå‘˜æ¥è¯´é€šå¸¸æ˜¯ä¸æ»¡æ„çš„ï¼Œå› ä¸ºç›®å½•ä¸­æ–‡ä»¶çš„ä¿¡æ¯é›†ä¸­åœ¨å•ä¸ªæ–‡ä»¶ä¸­ï¼Œè€Œæºæ–‡ä»¶æœ¬èº«åˆ†å¸ƒåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMiller å…³äºŽéžé€’å½’<em class="command">make çš„</em>è®ºæ–‡å»ºè®®å¯¹æ¯ä¸ªåŒ…å«æ–‡ä»¶åˆ—è¡¨å’Œæ¨¡å—ç‰¹å®šè§„åˆ™çš„ç›®å½•ä½¿ç”¨ä¸€ä¸ª<em class="command">make</em> include æ–‡ä»¶ã€‚é¡¶çº§
        <em class="filename">makefile</em>åŒ…å«è¿™äº›å­<em class="filename">makefile</em>ã€‚</p><p>The most straightforward use of nonrecursive <em class="command">make</em> includes targets, object file
        references, and dependencies in a single <em class="filename">makefile</em>. This is often unsatisfying to
        developers familiar with recursive <em class="command">make</em> because information about the files in
        a directory is centralized in a single file while the source files
        themselves are distributed in the filesystem. To address this issue,
        the Miller paper on nonrecursive <em class="command">make</em> suggests using one <em class="command">make</em> include file for each directory
        containing file lists and module-specific rules. The top-level
        <em class="filename">makefile</em> includes these
        sub-<em class="filename">makefile</em>s.</p><p><a class="link" href="#OEBPS/ch06s02.html.make3-CHP-6-EX-1" title="ä¾‹ 6-1ã€‚éžé€’å½’ makefile">ç¤ºä¾‹ 6-1</a>æ˜¾ç¤ºäº†
        mp3 æ’­æ”¾å™¨çš„<em class="filename">makefile</em> ï¼Œå…¶ä¸­åŒ…å«
        æ¯ä¸ªå­ç›®å½•ä¸­çš„æ¨¡å—çº§<em class="filename">makefile ã€‚</em><a class="link" href="#OEBPS/ch06s02.html.make3-CHP-6-EX-2" title="ä¾‹ 6-2ã€‚éžé€’å½’ makefile çš„ lib/codec åŒ…å«æ–‡ä»¶">ç¤ºä¾‹ 6-2</a>æ˜¾ç¤ºäº†æ¨¡å—çº§åŒ…å«æ–‡ä»¶ä¹‹ä¸€ã€‚</p><p><a class="link" href="#OEBPS/ch06s02.html.make3-CHP-6-EX-1" title="Example&nbsp;6-1.&nbsp;A nonrecursive makefile">Example 6-1</a> shows a
        <em class="filename">makefile</em> for our mp3 player that
        includes a module-level <em class="filename">makefile</em>
        from each subdirectory. <a class="link" href="#OEBPS/ch06s02.html.make3-CHP-6-EX-2" title="Example&nbsp;6-2.&nbsp;The lib/codec include file for a nonrecursive makefile">Example
        6-2</a> shows one of the module-level include files.</p><div class="example"><a id="OEBPS/ch06s02.html.make3-CHP-6-EX-1"></a><p class="title">ä¾‹ 6-1ã€‚éžé€’å½’ makefile</p><p class="title">Example&nbsp;6-1.&nbsp;A nonrecursive makefile</p><div class="example-contents"><pre class="programlisting"># ä»Žè¿™å››ä¸ªå˜é‡ä¸­æ”¶é›†æ¯ä¸ªæ¨¡å—çš„ä¿¡æ¯ã€‚
# åœ¨è¿™é‡Œå°†å®ƒä»¬åˆå§‹åŒ–ä¸ºç®€å•å˜é‡ã€‚
ç¨‹åº:=
æ¥æº:=
åº“:=
é¢å¤–çš„æ¸…æ´ï¼š=

å¯¹è±¡ = $(subst .c,.o,$(æ¥æº))
ä¾èµ–é¡¹ = $(subst .c,.d,$(æº))

include_dirs := lib åŒ…å«
CPPFLAGS += $(addprefix -I ,$(include_dirs))
vpath %.h $(include_dirs)

MV := mv -f
RM := rm -f
SED := sed

å…¨éƒ¨ï¼š

åŒ…å« lib/codec/module.mk
åŒ…å« lib/db/module.mk
åŒ…å« lib/ui/module.mk
åŒ…æ‹¬åº”ç”¨ç¨‹åº/æ’­æ”¾å™¨/module.mk

.PHONYï¼šå…¨éƒ¨
å…¨éƒ¨ï¼š$ï¼ˆç¨‹åºï¼‰

.PHONYï¼šåº“
å›¾ä¹¦é¦†ï¼š$ï¼ˆå›¾ä¹¦é¦†ï¼‰

.PHONYï¼šå¹²å‡€
å¹²å‡€çš„ï¼š
        $(RM) $(å¯¹è±¡) $(ç¨‹åº) $(åº“) \
              $ï¼ˆä¾èµ–é¡¹ï¼‰$ï¼ˆextra_cleanï¼‰

ifneq "$(MAKECMDGOALS)" "å¹²å‡€"
  åŒ…æ‹¬ $(ä¾èµ–é¡¹)
ä¸‡ä¸€

%.c %.h: %.y
        $(YACC.y) --å®šä¹‰$&lt;
        $(MV) y.tab.c $*.c
        $(MV) y.tab.h $*.h

%.d: %.c
        $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -M $&lt; | \
        $(SED) 's,\($(notdir $*)\.o\) *:,$(dir $@)\1 $@: ,' &gt; $@.tmp
        $(MV) $@.tmp $@</pre><pre class="programlisting"># Collect information from each module in these four variables.
# Initialize them here as simple variables.
programs     :=
sources      :=
libraries    :=
extra_clean  :=

objects      = $(subst .c,.o,$(sources))
dependencies = $(subst .c,.d,$(sources))

include_dirs := lib include
CPPFLAGS     += $(addprefix -I ,$(include_dirs))
vpath %.h $(include_dirs)

MV  := mv -f
RM  := rm -f
SED := sed

all:

include lib/codec/module.mk
include lib/db/module.mk
include lib/ui/module.mk
include app/player/module.mk

.PHONY: all
all: $(programs)

.PHONY: libraries
libraries: $(libraries)

.PHONY: clean
clean:
        $(RM) $(objects) $(programs) $(libraries) \
              $(dependencies) $(extra_clean)

ifneq "$(MAKECMDGOALS)" "clean"
  include $(dependencies)
endif

%.c %.h: %.y
        $(YACC.y) --defines $&lt;
        $(MV) y.tab.c $*.c
        $(MV) y.tab.h $*.h

%.d: %.c
        $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -M $&lt; | \
        $(SED) 's,\($(notdir $*)\.o\) *:,$(dir $@)\1 $@: ,' &gt; $@.tmp
        $(MV) $@.tmp $@</pre></div></div><div class="example"><a id="OEBPS/ch06s02.html.make3-CHP-6-EX-2"></a><p class="title">ä¾‹ 6-2ã€‚éžé€’å½’ makefile çš„ lib/codec åŒ…å«æ–‡ä»¶</p><p class="title">Example&nbsp;6-2.&nbsp;The lib/codec include file for a nonrecursive
          makefile</p><div class="example-contents"><pre class="programlisting">local_dir := lib/ç¼–è§£ç å™¨
local_lib := $(local_dir)/libcodec.a
local_src := $(addprefix $(local_dir)/,codec.c)
local_objs := $(subst .c,.o,$(local_src))

åº“ += $(local_lib)
æ¥æº += $(local_src)

$(local_lib): $(local_objs)
        $(AR) $(ARFLAGS) $@ $^</pre><pre class="programlisting">local_dir  := lib/codec
local_lib  := $(local_dir)/libcodec.a
local_src  := $(addprefix $(local_dir)/,codec.c)
local_objs := $(subst .c,.o,$(local_src))

libraries  += $(local_lib)
sources    += $(local_src)

$(local_lib): $(local_objs)
        $(AR) $(ARFLAGS) $@ $^</pre></div></div><p>å› æ­¤ï¼Œç‰¹å®šäºŽæ¨¡å—çš„æ‰€æœ‰ä¿¡æ¯éƒ½åŒ…å«åœ¨æ¨¡å—ç›®å½•æœ¬èº«çš„åŒ…å«æ–‡ä»¶ä¸­ã€‚è¿™<a id="OEBPS/ch06s02.html.make3-CHP-6-ITERM-1389" class="indexterm"></a>é¡¶å±‚<em class="filename">makefile</em>
        ä»…åŒ…å«æ¨¡å—å’ŒæŒ‡ä»¤çš„åˆ—è¡¨<code class="literal">include</code>ã€‚è®©æˆ‘ä»¬
        è¯¦ç»†æ£€æŸ¥ä¸€ä¸‹<em class="filename">makefile</em>å’Œ<em class="filename">module.mk ã€‚</em></p><p>Thus, all the information specific to a module is contained in
        an include file in the module directory itself. The <a class="indexterm"></a>top-level <em class="filename">makefile</em>
        contains only a list of modules and <code class="literal">include</code> directives. Let's examine the
        <em class="filename">makefile</em> and <em class="filename">module.mk</em> in detail.</p><p>æ¯ä¸ª<em class="filename">module.mk</em>åŒ…å«æ–‡ä»¶å°†æœ¬åœ°åº“åç§°é™„åŠ åˆ°å˜é‡<code class="literal">libraries</code>ï¼Œå°†æœ¬åœ°æºé™„åŠ åˆ°<code class="literal">sources</code>.å˜é‡<code class="literal">local_</code>ç”¨äºŽä¿å­˜å¸¸é‡å€¼æˆ–é¿å…é‡å¤è®¡ç®—å€¼ã€‚è¯·æ³¨æ„ï¼Œæ¯ä¸ªåŒ…å«æ–‡ä»¶éƒ½é‡å¤ä½¿ç”¨è¿™äº›ç›¸åŒçš„<code class="literal">local_</code>å˜é‡åç§°ã€‚å› æ­¤ï¼Œå®ƒä½¿ç”¨ç®€å•å˜é‡ï¼ˆç”¨ åˆ†é…çš„å˜é‡<code class="literal">:=</code>ï¼‰è€Œä¸æ˜¯é€’å½’å˜é‡ï¼Œä»¥ä¾¿ç»„åˆå¤šä¸ª<em class="filename">makefileçš„æž„å»ºä¸ä¼šæœ‰æ„ŸæŸ“æ¯ä¸ª</em><em class="filename">makefile</em>ä¸­çš„å˜é‡çš„é£Žé™©ã€‚åº“åç§°å’Œæºæ–‡ä»¶åˆ—è¡¨ä½¿ç”¨å‰é¢è®¨è®ºçš„ç›¸å¯¹è·¯å¾„ã€‚æœ€åŽï¼ŒåŒ…å«æ–‡ä»¶å®šä¹‰äº†æ›´æ–°æœ¬åœ°åº“çš„è§„åˆ™ã€‚ä½¿ç”¨æ­¤è§„åˆ™ä¸­çš„å˜é‡æ²¡æœ‰é—®é¢˜ï¼Œ<code class="literal">local_</code>å› ä¸ºè§„åˆ™çš„ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶éƒ¨åˆ†ä¼šç«‹å³è¯„ä¼°ã€‚</p><p>Each <em class="filename">module.mk</em> include file
        appends the local library name to the variable <code class="literal">libraries</code> and the local sources to <code class="literal">sources</code>. The <code class="literal">local_</code> variables are used to hold constant
        values or to avoid duplicating a computed value. Note that each
        include file reuses these same <code class="literal">local_</code> variable names. Therefore, it uses
        simple variables (those assigned with <code class="literal">:=</code>) rather than recursive ones so that
        builds combining multiple <em class="filename">makefile</em>s hold no risk of infecting the
        variables in each <em class="filename">makefile</em>. The
        library name and source file lists use a relative path as discussed
        earlier. Finally, the include file defines a rule for updating the
        local library. There is no problem with using the <code class="literal">local_</code> variables in this rule because the
        target and prerequisite parts of a rule are immediately
        evaluated.</p><p>åœ¨é¡¶å±‚<em class="filename">makefile</em>ä¸­ï¼Œå‰å››è¡Œå®šä¹‰äº†ç´¯ç§¯æ¯ä¸ªæ¨¡å—çš„ç‰¹å®šæ–‡ä»¶ä¿¡æ¯çš„å˜é‡ã€‚è¿™äº›å˜é‡å¿…é¡»æ˜¯ç®€å•å˜é‡ï¼Œå› ä¸ºæ¯ä¸ªæ¨¡å—å°†ä½¿ç”¨ç›¸åŒçš„å±€éƒ¨å˜é‡åç§°é™„åŠ åˆ°å®ƒä»¬ï¼š</p><p>In the top-level <em class="filename">makefile</em>,
        the first four lines define the variables that accumulate each
        module's specific file information. These variables must be simple
        variables because each module will append to them using the same local
        variable name:</p><a id="OEBPS/ch06s02.html.I_1_tt326"></a><pre class="programlisting">local_src := $(addprefix $(local_dir)/,codec.c)
...
æ¥æº += $(local_src)</pre><pre class="programlisting">local_src  := $(addprefix $(local_dir)/,codec.c)
...
sources    += $(local_src)</pre><p>ä¾‹å¦‚ï¼Œå¦‚æžœå°†é€’å½’å˜é‡ç”¨äºŽ<code class="literal">sources</code>ï¼Œåˆ™æœ€ç»ˆå€¼å°†åªæ˜¯<code class="literal">local_src</code>ä¸€éåˆä¸€éé‡å¤çš„æœ€åŽä¸€ä¸ªå€¼ã€‚å³ä½¿åˆ†é…äº†ç©ºå€¼ï¼Œä¹Ÿéœ€è¦æ˜¾å¼èµ‹å€¼æ¥åˆå§‹åŒ–è¿™äº›ç®€å•å˜é‡ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹å˜é‡æ˜¯é€’å½’çš„ã€‚</p><p>If a recursive variable were used for <code class="literal">sources</code>, for instance, the final value would
        simply be the last value of <code class="literal">local_src</code> repeated over and over. An
        explicit assignment is required to initialize these simple variables,
        even though they are assigned null values, since variables are
        recursive by default.</p><p>ä¸‹ä¸€éƒ¨åˆ†<code class="literal">objects</code>æ ¹æ®å˜é‡è®¡ç®—ç›®æ ‡æ–‡ä»¶åˆ—è¡¨ã€å’Œä¾èµ–æ–‡ä»¶åˆ—è¡¨
        <code class="literal">sources</code>ã€‚è¿™äº›å˜é‡æ˜¯é€’å½’çš„ï¼Œå› ä¸ºæ­¤æ—¶<em class="filename">makefile</em>ä¸­çš„å˜é‡<code class="literal">sources</code>ä¸ºç©ºã€‚ç›´åˆ°ç¨åŽè¯»å–åŒ…å«æ–‡ä»¶æ—¶æ‰ä¼šå¡«å……å®ƒã€‚åœ¨æ­¤
        <em class="filename">makefile</em>ä¸­ï¼Œå°†è¿™äº›å˜é‡çš„å®šä¹‰ç§»åˆ°åŒ…å«ä¹‹åŽå¹¶å°†å…¶ç±»åž‹æ›´æ”¹ä¸ºç®€å•å˜é‡æ˜¯å®Œå…¨åˆç†çš„ï¼Œä½†æ˜¯å°†åŸºæœ¬æ–‡ä»¶åˆ—è¡¨ï¼ˆä¾‹å¦‚ï¼Œ<code class="literal">sources</code>ã€
         <code class="literal">libraries</code>ã€<code class="literal">objects</code>ï¼‰æ”¾åœ¨ä¸€èµ·å¯ä»¥ç®€åŒ–å¯¹<em class="filename">makefile çš„</em>ç†è§£ï¼Œå¹¶ä¸”é€šå¸¸æ˜¯å¾ˆå¥½çš„åšæ³•ã€‚å¦å¤–ï¼Œåœ¨å…¶ä»–<em class="filename">makefile</em>æƒ…å†µä¸‹ï¼Œå˜é‡ä¹‹é—´çš„ç›¸äº’å¼•ç”¨éœ€è¦ä½¿ç”¨é€’å½’å˜é‡ã€‚</p><p>The next section computes the object file list, <code class="literal">objects</code>, and dependency file list from the
        <code class="literal">sources</code> variable. These variables
        are recursive because at this point in the <em class="filename">makefile</em> the <code class="literal">sources</code> variable is empty. It will not be
        populated until later when the include files are read. In this
        <em class="filename">makefile</em>, it is perfectly
        reasonable to move the definition of these variables after the
        includes and change their type to simple variables, but keeping the
        basic file lists (e.g., <code class="literal">sources</code>,
        <code class="literal">libraries</code>, <code class="literal">objects</code>) together simplifies understanding
        the <em class="filename">makefile</em> and is generally
        good practice. Also, in other <em class="filename">makefile</em> situations, mutual references
        between variables require the use of recursive variables.</p><p>æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡è®¾ç½® .c æ¥å¤„ç† C è¯­è¨€åŒ…å«æ–‡ä»¶<code class="literal">CPPFLAGS</code>ã€‚è¿™å…è®¸ç¼–è¯‘å™¨æ‰¾åˆ°æ ‡å¤´ã€‚æˆ‘ä»¬è¿½åŠ åˆ°<code class="literal">CPPFLAGS</code>å˜é‡ä¸­æ˜¯å› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“å˜é‡æ˜¯å¦çœŸçš„ä¸ºç©ºï¼›å‘½ä»¤è¡Œé€‰é¡¹ã€çŽ¯å¢ƒå˜é‡æˆ–å…¶ä»–<em class="command">make</em>ç»“æž„å¯èƒ½å·²ç»è®¾ç½®äº†å®ƒã€‚è¯¥<code class="literal">vpath</code>
        æŒ‡ä»¤å…è®¸<em class="command">make</em>æŸ¥æ‰¾å­˜å‚¨åœ¨å…¶ä»–ç›®å½•ä¸­çš„æ ‡å¤´ã€‚è¯¥<code class="literal">include_dirs</code>å˜é‡ç”¨äºŽé¿å…é‡å¤åŒ…å«ç›®å½•åˆ—è¡¨ã€‚</p><p>Next, we handle C language include files by setting <code class="literal">CPPFLAGS</code>. This allows the compiler to find
        the headers. We append to the <code class="literal">CPPFLAGS</code> variable because we don't know if
        the variable is really empty; command-line options, environment
        variables, or other <em class="command">make</em> constructs
        may have set it. The <code class="literal">vpath</code>
        directive allows <em class="command">make</em> to find the
        headers stored in other directories. The <code class="literal">include_dirs</code> variable is used to avoid
        duplicating the include directory list.</p><p><em class="command">å®šä¹‰mv</em>ã€<em class="command">rm</em>å’Œ<em class="command">sed</em>çš„å˜é‡æ˜¯ä¸ºäº†é¿å…å°†ç¨‹åºç¡¬ç¼–ç åˆ°<em class="filename">makefile</em>ä¸­ã€‚æ³¨æ„å˜é‡çš„æƒ…å†µã€‚æˆ‘ä»¬éµå¾ª<em class="command">åˆ¶ä½œ</em>æ‰‹å†Œä¸­å»ºè®®çš„çº¦å®šã€‚<em class="filename">makefile</em>å†…éƒ¨çš„å˜é‡æ˜¯å°å†™çš„ï¼›å¯ä»¥ä»Žå‘½ä»¤è¡Œè®¾ç½®çš„å˜é‡æ˜¯å¤§å†™çš„ã€‚</p><p>Variables for <em class="command">mv</em>, <em class="command">rm</em>, and <em class="command">sed</em> are defined to avoid hard coding
        programs into the <em class="filename">makefile</em>.
        Notice the case of variables. We are following the conventions
        suggested in the <em class="command">make</em> manual.
        Variables that are internal to the <em class="filename">makefile</em> are lowercased; variables that
        might be set from the command line are uppercased.</p><p>åœ¨ makefile çš„ä¸‹ä¸€éƒ¨åˆ†ä¸­<em class="filename">ï¼Œ</em>äº‹æƒ…å˜å¾—æ›´åŠ æœ‰è¶£ã€‚æˆ‘ä»¬å¸Œæœ›ä»¥é»˜è®¤ç›®æ ‡ å¼€å§‹æ˜¾å¼è§„åˆ™
        <code class="literal">all</code>ã€‚ä¸å¹¸çš„æ˜¯ï¼Œ çš„å…ˆå†³æ¡ä»¶<code class="literal">all</code>æ˜¯å˜é‡<code class="literal">programs</code>ã€‚è¯¥å˜é‡ä¼šç«‹å³è®¡ç®—ï¼Œä½†é€šè¿‡è¯»å–æ¨¡å—åŒ…å«æ–‡ä»¶æ¥è®¾ç½®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨<code class="literal">all</code>å®šä¹‰ç›®æ ‡ä¹‹å‰è¯»å–åŒ…å«æ–‡ä»¶ã€‚å†æ¬¡ä¸å¹¸çš„æ˜¯ï¼ŒåŒ…å«æ¨¡å—åŒ…å«ç›®æ ‡ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå°†è¢«è§†ä¸ºé»˜è®¤ç›®æ ‡ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªå›°å¢ƒï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®š<code class="literal">all</code>æ²¡æœ‰å…ˆå†³æ¡ä»¶çš„ç›®æ ‡ï¼ŒèŽ·å–åŒ…å«æ–‡ä»¶ï¼Œç„¶åŽæ·»åŠ å…ˆå†³æ¡ä»¶
        <code class="literal">all</code>ã€‚</p><p>In the next section of the <em class="filename">makefile,</em> things get more interesting. We
        would like to begin the explicit rules with the default target,
        <code class="literal">all</code>. Unfortunately, the
        prerequisite for <code class="literal">all</code> is the
        variable <code class="literal">programs</code>. This variable is
        evaluated immediately, but is set by reading the module include files.
        So, we must read the include files before the <code class="literal">all</code> target is defined. Unfortunately again,
        the include modules contain targets, the first of which will be
        considered the default goal. To work through this dilemma, we can
        specify the <code class="literal">all</code> target with no
        prerequisites, source the include files, then add the prerequisites to
        <code class="literal">all</code> later.</p><p><em class="filename">makefile</em>çš„å…¶ä½™éƒ¨åˆ†åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­å·²ç»å¾ˆç†Ÿæ‚‰ï¼Œä½†<em class="command">make</em>å¦‚ä½•åº”ç”¨éšå¼è§„åˆ™å€¼å¾—æ³¨æ„ã€‚æˆ‘ä»¬çš„æºæ–‡ä»¶çŽ°åœ¨ä½äºŽå­ç›®å½•ä¸­ã€‚å½“<em class="command">make</em>å°è¯•åº”ç”¨æ ‡å‡†<code class="literal">%.o: %.c</code>è§„åˆ™æ—¶ï¼Œå…ˆå†³æ¡ä»¶å°†æ˜¯å…·æœ‰ç›¸å¯¹è·¯å¾„çš„æ–‡ä»¶ï¼Œä¾‹å¦‚<em class="filename">lib/ui/ui.c</em>ã€‚<em class="command">make</em>å°†è‡ªåŠ¨å°†è¯¥ç›¸å¯¹è·¯å¾„ä¼ æ’­åˆ°ç›®æ ‡æ–‡ä»¶å¹¶å°è¯•æ›´æ–°<em class="filename">lib/ui/ui.o</em>ã€‚å› æ­¤ï¼Œ<em class="command">make ä¼š</em>è‡ªåŠ¨åšæ­£ç¡®çš„äº‹ã€‚</p><p>The remainder of the <em class="filename">makefile</em> is already familiar from previous
        examples, but how <em class="command">make</em> applies
        implicit rules is worth noting. Our source files now reside in
        subdirectories. When <em class="command">make</em> tries to
        apply the standard <code class="literal">%.o: %.c</code> rule,
        the prerequisite will be a file with a relative path, say <em class="filename">lib/ui/ui.c</em>. <em class="command">make</em> will automatically propagate that
        relative path to the target file and attempt to update <em class="filename">lib/ui/ui.o</em>. Thus, <em class="command">make</em> automagically does the Right
        Thing.</p><p>æœ€åŽè¿˜æœ‰ä¸€ä¸ªå°æ•…éšœã€‚å°½ç®¡<em class="command">makeå¯ä»¥æ­£ç¡®å¤„ç†è·¯å¾„ï¼Œä½†å¹¶éž</em><em class="filename">makefile</em>ä½¿ç”¨çš„æ‰€æœ‰å·¥å…·
        éƒ½æ˜¯å¦‚æ­¤ã€‚ç‰¹åˆ«æ˜¯ï¼Œå½“ä½¿ç”¨<em class="command">gcc</em>æ—¶ï¼Œç”Ÿæˆçš„ä¾èµ–æ–‡ä»¶ä¸åŒ…å«ç›®æ ‡å¯¹è±¡æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ çš„è¾“å‡º<code class="literal">gcc</code> <code class="literal">-M</code>
        æ˜¯ï¼š</p><p>There is one final glitch. Although <em class="command">make</em> is handling paths correctly, not all
        the tools used by the <em class="filename">makefile</em>
        are. In particular, when using <em class="command">gcc</em>,
        the generated dependency file does not include the relative path to
        the target object file. That is, the output of <code class="literal">gcc</code> <code class="literal">-M</code>
        is:</p><a id="OEBPS/ch06s02.html.I_1_tt327"></a><pre class="programlisting">ui.o: lib/ui/ui.c include/ui/ui.h lib/db/playlist.h</pre><pre class="programlisting">ui.o: lib/ui/ui.c include/ui/ui.h lib/db/playlist.h</pre><p>è€Œä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„ï¼š</p><p>rather than what we expect:</p><a id="OEBPS/ch06s02.html.I_1_tt328"></a><pre class="programlisting">lib/ui/ui.o: lib/ui/ui.c include/ui/ui.h lib/db/playlist.h</pre><pre class="programlisting">lib/ui/ui.o: lib/ui/ui.c include/ui/ui.h lib/db/playlist.h</pre><p>è¿™ä¼šç ´åå¤´æ–‡ä»¶å…ˆå†³æ¡ä»¶çš„å¤„ç†ã€‚è¦è§£å†³æ­¤é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ”¹<em class="command">sed</em>
        å‘½ä»¤ä»¥æ·»åŠ ç›¸å¯¹è·¯å¾„ä¿¡æ¯ï¼š</p><p>This disrupts the handling of header file prerequisites. To fix
        this problem we can alter the <em class="command">sed</em>
        command to add relative path information:</p><a id="OEBPS/ch06s02.html.I_1_tt329"></a><pre class="programlisting">$(SED) 's,\($(notdir $*)\.o\) *:,$(dir $@)\1 $@: ,'</pre><pre class="programlisting">$(SED) 's,\($(notdir $*)\.o\) *:,$(dir $@)\1 $@: ,'</pre><p>è°ƒæ•´<em class="filename">makefile</em>ä»¥å¤„ç†å„ç§å·¥å…·çš„æ€ªç™–æ˜¯ä½¿ç”¨<em class="command">make</em>çš„æ­£å¸¸éƒ¨åˆ†ã€‚å¯ç§»æ¤çš„<em class="filename">makefile</em>é€šå¸¸éžå¸¸å¤æ‚ï¼Œå› ä¸ºå®ƒä»¬è¢«è¿«ä¾èµ–çš„å„ç§å·¥å…·çš„å˜åŒ–æ— å¸¸ã€‚</p><p>Tweaking the <em class="filename">makefile</em> to
        handle the quirks of various tools is a normal part of using <em class="command">make</em>. Portable <em class="filename">makefile</em>s are often very complex due to
        vagarities of the diverse set of tools they are forced to rely
        upon.</p><p>æˆ‘ä»¬çŽ°åœ¨æœ‰äº†ä¸€ä¸ªä¸é”™çš„éžé€’å½’<em class="filename">makefile</em>ï¼Œä½†å­˜åœ¨ç»´æŠ¤é—®é¢˜ã€‚ module.mk<em class="filename">åŒ…å«</em>æ–‡ä»¶å¤§ä½“ç›¸ä¼¼ã€‚å¯¹å…¶ä¸­ä¸€é¡¹çš„æ›´æ”¹å¯èƒ½ä¼šæ¶‰åŠå¯¹æ‰€æœ‰é¡¹çš„æ›´æ”¹ã€‚å¯¹äºŽåƒæˆ‘ä»¬çš„ MP3 æ’­æ”¾å™¨è¿™æ ·çš„å°é¡¹ç›®æ¥è¯´ï¼Œè¿™å¾ˆçƒ¦äººã€‚å¯¹äºŽå…·æœ‰æ•°ç™¾ä¸ªåŒ…å«æ–‡ä»¶çš„å¤§åž‹é¡¹ç›®æ¥è¯´ï¼Œè¿™å¯èƒ½æ˜¯è‡´å‘½çš„ã€‚é€šè¿‡ä½¿ç”¨ä¸€è‡´çš„å˜é‡åç§°å¹¶è§„èŒƒåŒ…å«æ–‡ä»¶çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå¥½åœ°è§£å†³è¿™äº›é—®é¢˜ã€‚è¿™æ˜¯é‡æž„åŽçš„<em class="filename">lib/codec</em>
        åŒ…å«æ–‡ä»¶ï¼š</p><p>We now have a decent nonrecursive <em class="filename">makefile</em>, but there are maintenance
        problems. The <em class="filename">module.mk</em> include
        files are largely similar. A change to one will likely involve a
        change to all of them. For small projects like our mp3 player it is
        annoying. For large projects with several hundred include files it can
        be fatal. By using consistent variable names and regularizing the
        contents of the include files, we position ourselves nicely to cure
        these ills. Here is the <em class="filename">lib/codec</em>
        include file after refactoring:</p><a id="OEBPS/ch06s02.html.I_1_tt330"></a><pre class="programlisting">local_src := $(é€šé…ç¬¦$(å­ç›®å½•)/*.c)

$(eval $(è°ƒç”¨ make-library, $(å­ç›®å½•)/libcodec.a, $(local_src)))</pre><pre class="programlisting">local_src := $(wildcard $(subdirectory)/*.c)

$(eval $(call make-library, $(subdirectory)/libcodec.a, $(local_src)))</pre><p>æˆ‘ä»¬å‡è®¾è¦é‡å»ºç›®å½•ä¸­çš„æ‰€æœ‰<em class="filename">.c</em>æ–‡ä»¶ï¼Œè€Œä¸æ˜¯æŒ‰åç§°æŒ‡å®šæºæ–‡ä»¶ã€‚è¿™<a id="OEBPS/ch06s02.html.make3-CHP-6-ITERM-1390" class="indexterm"></a> <a id="OEBPS/ch06s02.html.make3-CHP-6-ITERM-1391" class="indexterm"></a> <a id="OEBPS/ch06s02.html.make3-CHP-6-ITERM-1392" class="indexterm"></a> <code class="function">make-library</code>
        å‡½æ•°çŽ°åœ¨æ‰§è¡ŒåŒ…å«æ–‡ä»¶çš„å¤§éƒ¨åˆ†ä»»åŠ¡ã€‚è¯¥å‡½æ•°åœ¨æˆ‘ä»¬é¡¹ç›®<em class="filename">makefile</em>çš„é¡¶éƒ¨å®šä¹‰ä¸ºï¼š</p><p>Instead of specifying source files by name, we assume we want to
        rebuild all <em class="filename">.c</em> files in the
        directory. The <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <code class="function">make-library</code>
        function now performs the bulk of the tasks for an include file. This
        function is defined at the top of our project <em class="filename">makefile</em> as:</p><a id="OEBPS/ch06s02.html.I_1_tt331"></a><pre class="programlisting"># $(è°ƒç”¨ make-library, åº“å, æºæ–‡ä»¶åˆ—è¡¨)
å®šä¹‰ make-library
  å›¾ä¹¦é¦† += $1
  æ¥æº += $2

  $1: $(è°ƒç”¨æºåˆ°å¯¹è±¡,$2)
    $(AR) $(ARFLAGS) $$@ $$^
æ©å¾·å¤«</pre><pre class="programlisting"># $(call make-library, library-name, source-file-list)
define make-library
  libraries += $1
  sources   += $2

  $1: $(call source-to-object,$2)
    $(AR) $(ARFLAGS) $$@ $$^
endef</pre><p>è¯¥å‡½æ•°å°†åº“å’Œæºé™„åŠ åˆ°å„è‡ªçš„å˜é‡ï¼Œç„¶åŽå®šä¹‰æž„å»ºåº“çš„æ˜¾å¼è§„åˆ™ã€‚è¯·æ³¨æ„è‡ªåŠ¨å˜é‡å¦‚ä½•ä½¿ç”¨ä¸¤ä¸ªç¾Žå…ƒç¬¦å·æ¥æŽ¨è¿Ÿ<code class="literal">$@</code>å’Œçš„å®žé™…è¯„ä¼°ï¼Œ<code class="literal">$^</code>ç›´åˆ°è§„åˆ™è¢«è§¦å‘ã€‚è¯¥<code class="function">source-to-object</code>å‡½æ•°å°†æºæ–‡ä»¶åˆ—è¡¨è½¬æ¢ä¸ºå…¶ç›¸åº”çš„ç›®æ ‡æ–‡ä»¶ï¼š</p><p>The function appends the library and sources to their respective
        variables, then defines the explicit rule to build the library. Notice
        how the automatic variables use two dollar signs to defer actual
        evaluation of the <code class="literal">$@</code> and <code class="literal">$^</code> until the rule is fired. The <code class="function">source-to-object</code> function translates a list
        of source files to their corresponding object files:</p><a id="OEBPS/ch06s02.html.I_1_tt332"></a><pre class="programlisting">æºåˆ°å¯¹è±¡ = $(subst .c,.o,$(filter %.c,$1)) \
                   $(subst .y,.o,$(è¿‡æ»¤å™¨ %.y,$1)) \
                   $(subst .l,.o,$(è¿‡æ»¤å™¨ %.l,$1))</pre><pre class="programlisting">source-to-object = $(subst .c,.o,$(filter %.c,$1)) \
                   $(subst .y,.o,$(filter %.y,$1)) \
                   $(subst .l,.o,$(filter %.l,$1))</pre><p>åœ¨æˆ‘ä»¬ä¹‹å‰ç‰ˆæœ¬çš„<em class="filename">makefileä¸­ï¼Œæˆ‘ä»¬æŽ©ç›–äº†å®žé™…çš„è§£æžå™¨å’Œæ‰«æå™¨æºæ–‡ä»¶æ˜¯</em><em class="filename">playlist.y</em>å’Œ<em class="filename">Scanner.l çš„</em>äº‹å®žã€‚ç›¸åï¼Œæˆ‘ä»¬å°†æºæ–‡ä»¶åˆ—ä¸ºç”Ÿæˆçš„<em class="filename">.c</em>
        ç‰ˆæœ¬ã€‚è¿™è¿«ä½¿æˆ‘ä»¬æ˜Žç¡®åˆ—å‡ºå®ƒä»¬å¹¶åŒ…å«ä¸€ä¸ªé¢å¤–çš„å˜é‡<code class="literal">extra_clean</code>.æˆ‘ä»¬é€šè¿‡å…è®¸<code class="literal">sources</code>å˜é‡ç›´æŽ¥åŒ…å«<em class="filename">.y</em>å’Œ<em class="filename">.l</em>æ–‡ä»¶å¹¶è®©<code class="function">source-to-object</code> <a id="OEBPS/ch06s02.html.make3-CHP-6-ITERM-1393" class="indexterm"></a> <a id="OEBPS/ch06s02.html.make3-CHP-6-ITERM-1394" class="indexterm"></a>å‡½æ•°å®Œæˆç¿»è¯‘å®ƒä»¬çš„å·¥ä½œã€‚</p><p>In our previous version of the <em class="filename">makefile</em>, we glossed over the fact that the
        actual parser and scanner source files are <em class="filename">playlist.y</em> and <em class="filename">scanner.l</em>. Instead, we listed the source
        files as the generated <em class="filename">.c</em>
        versions. This forced us to list them explicitly and to include an
        extra variable, <code class="literal">extra_clean</code>. We've
        fixed that issue here by allowing the <code class="literal">sources</code> variable to include <em class="filename">.y</em> and <em class="filename">.l</em> files directly and letting the <code class="function">source-to-object</code> <a class="indexterm"></a> <a class="indexterm"></a> function do the work of translating them.</p><p>é™¤äº†ä¿®æ”¹ ä¹‹å¤–<code class="function">source-to-object</code>ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¦ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—<em class="command">yacc</em>å’Œ<em class="command">lex</em>è¾“å‡ºæ–‡ä»¶ï¼Œä»¥ä¾¿<code class="literal">clean</code>ç›®æ ‡å¯ä»¥æ‰§è¡Œé€‚å½“çš„æ¸…ç†ã€‚è¿™<code class="function">generated-source</code> <a id="OEBPS/ch06s02.html.make3-CHP-6-ITERM-1395" class="indexterm"></a> <a id="OEBPS/ch06s02.html.make3-CHP-6-ITERM-1396" class="indexterm"></a>å‡½æ•°åªæŽ¥å—æºåˆ—è¡¨å¹¶ç”Ÿæˆä¸­é—´æ–‡ä»¶åˆ—è¡¨ä½œä¸ºè¾“å‡ºï¼š</p><p>In addition to modifying <code class="function">source-to-object</code>, we need another function
        to compute the <em class="command">yacc</em> and <em class="command">lex</em> output files so the <code class="literal">clean</code> target can perform proper clean up.
        The <code class="function">generated-source</code> <a class="indexterm"></a> <a class="indexterm"></a> function simply accepts a list of sources and produces
        a list of intermediate files as output:</p><a id="OEBPS/ch06s02.html.I_1_tt333"></a><pre class="programlisting"># $(è°ƒç”¨ç”Ÿæˆæºï¼Œæºæ–‡ä»¶åˆ—è¡¨)
ç”Ÿæˆæº = $(subst .y,.c,$(filter %.y,$1)) \
                   $(subst .y,.h,$(è¿‡æ»¤å™¨ %.y,$1)) \
                   $(subst .l,.c,$(è¿‡æ»¤å™¨ %.l,$1))</pre><pre class="programlisting"># $(call generated-source, source-file-list)
generated-source = $(subst .y,.c,$(filter %.y,$1)) \
                   $(subst .y,.h,$(filter %.y,$1)) \
                   $(subst .l,.c,$(filter %.l,$1))</pre><p>æˆ‘ä»¬çš„å¦ä¸€ä¸ªè¾…åŠ©å‡½æ•°<code class="function">subdirectory</code>å…è®¸æˆ‘ä»¬çœç•¥å˜é‡<code class="literal">local_dir</code>ã€‚</p><p>Our other helper function, <code class="function">subdirectory</code>, allows us to omit the
        variable <code class="literal">local_dir</code>.</p><a id="OEBPS/ch06s02.html.I_1_tt334"></a><pre class="programlisting">å­ç›®å½• = $(patsubst %/makefile,%, \
                 $(å•è¯\
                   $(å•è¯$(MAKEFILE_LIST)),$(MAKEFILE_LIST)))</pre><pre class="programlisting">subdirectory = $(patsubst %/makefile,%,                         \
                 $(word                                         \
                   $(words $(MAKEFILE_LIST)),$(MAKEFILE_LIST)))</pre><p><a class="link" href="#OEBPS/ch04.html" title="ç¬¬ 4 ç« å‡½æ•°">æ­£å¦‚ç¬¬ 4 ç« </a><a class="link" href="#OEBPS/ch04s02.html.make3-CHP-4-SECT-2.1" title="å­—ç¬¦ä¸²å‡½æ•°">4.2.1 èŠ‚</a>æ‰€è¿°ï¼Œæˆ‘ä»¬å¯ä»¥ä»Ž ä¸­æ£€ç´¢å½“å‰<em class="filename">makefile</em>çš„åç§°ã€‚ä½¿ç”¨ç®€å•çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä»Žé¡¶çº§<em class="filename">makefile</em>ä¸­æå–ç›¸å¯¹è·¯å¾„ã€‚è¿™æ¶ˆé™¤äº†å¦ä¸€ä¸ªå˜é‡å¹¶å‡å°‘äº†åŒ…å«æ–‡ä»¶ä¹‹é—´çš„å·®å¼‚ã€‚<a class="link" href="#OEBPS/ch04.html" title="ç¬¬ 4 ç« å‡½æ•°"></a><em class="filename"></em><code class="literal">MAKEFILE_LIST</code><code class="function">patsubst</code><em class="filename"></em></p><p>As noted in <a class="link" href="#OEBPS/ch04s02.html.make3-CHP-4-SECT-2.1" title="String Functions">Section
        4.2.1</a> in <a class="link" href="#OEBPS/ch04.html" title="Chapter&nbsp;4.&nbsp;Functions">Chapter 4</a>, we can
        retrieve the name of the current <em class="filename">makefile</em> from <code class="literal">MAKEFILE_LIST</code>. Using a simple <code class="function">patsubst</code>, we can extract the relative path
        from the top-level <em class="filename">makefile</em>. This
        eliminates another variable and reduces the differences between
        include files.</p><p>æˆ‘ä»¬æœ€ç»ˆçš„ä¼˜åŒ–ï¼ˆè‡³å°‘å¯¹äºŽè¿™ä¸ªä¾‹å­ï¼‰ï¼Œç”¨äºŽ
        <code class="function">wildcard</code>èŽ·å–æºæ–‡ä»¶åˆ—è¡¨ã€‚è¿™åœ¨å¤§å¤šæ•°æºä»£ç æ ‘ä¿æŒå¹²å‡€çš„çŽ¯å¢ƒä¸­éƒ½å¾ˆæœ‰æ•ˆã€‚ç„¶è€Œï¼Œæˆ‘å‚ä¸Žè¿‡çš„é¡¹ç›®å´å¹¶éžå¦‚æ­¤ã€‚æ—§ä»£ç ä¿ç•™åœ¨æºä»£ç æ ‘ä¸­â€œä»¥é˜²ä¸‡ä¸€â€ã€‚è¿™åœ¨ç¨‹åºå‘˜çš„æ—¶é—´å’Œç—›è‹¦æ–¹é¢å¸¦æ¥äº†å®žé™…æˆæœ¬ï¼Œå› ä¸ºå½“å…¨å±€æœç´¢å’Œæ›¿æ¢å‘çŽ°æ—§çš„ã€æ­»çš„ä»£ç æ—¶ï¼Œå®ƒä¼šè¢«ç»´æŠ¤ï¼Œè€Œæ–°ç¨‹åºå‘˜ï¼ˆæˆ–ä¸ç†Ÿæ‚‰æ¨¡å—çš„è€ç¨‹åºå‘˜ï¼‰è¯•å›¾ç¼–è¯‘æˆ–è°ƒè¯•ä»Žæœªä½¿ç”¨è¿‡çš„ä»£ç ã€‚å¦‚æžœæ‚¨ä½¿ç”¨çš„æ˜¯çŽ°ä»£æºä»£ç æŽ§åˆ¶ç³»ç»Ÿï¼Œä¾‹å¦‚ CVSï¼Œåˆ™æ— éœ€åœ¨æºä»£ç æ ‘ä¸­ä¿ç•™æ­»ä»£ç ï¼ˆå› ä¸ºå®ƒé©»ç•™åœ¨å­˜å‚¨åº“ä¸­ï¼‰å¹¶ä¸”ä½¿ç”¨<code class="function">wildcard</code>
        å˜å¾—å¯è¡Œã€‚</p><p>Our final optimization (at least for this example), uses
        <code class="function">wildcard</code> to acquire the source
        file list. This works well in most environments where the source tree
        is kept clean. However, I have worked on projects where this is not
        the case. Old code was kept in the source tree "just in case." This
        entailed real costs in terms of programmer time and anguish since old,
        dead code was maintained when it was found by global search and
        replace and new programmers (or old ones not familiar with a module)
        attempted to compile or debug code that was never used. If you are
        using a modern source code control system, such as CVS, keeping dead
        code in the source tree is unnecessary (since it resides in the
        repository) and using <code class="function">wildcard</code>
        becomes feasible.</p><p>æŒ‡ä»¤<code class="literal">include</code>â€‹
        <a id="OEBPS/ch06s02.html.make3-CHP-6-ITERM-1397" class="indexterm"></a> <a id="OEBPS/ch06s02.html.make3-CHP-6-ITERM-1398" class="indexterm"></a>è¿˜å¯ä»¥ä¼˜åŒ–ï¼š</p><p>The <code class="literal">include</code> directives
        <a class="indexterm"></a> <a class="indexterm"></a>can also be optimzed:</p><a id="OEBPS/ch06s02.html.I_1_tt335"></a><pre class="programlisting">æ¨¡å—ï¼š= lib /ç¼–è§£ç å™¨lib / db lib / uiåº”ç”¨ç¨‹åº/æ’­æ”¾å™¨
 ã€‚ ã€‚ ã€‚
åŒ…æ‹¬ $(addsuffix /module.mk,$(modules))</pre><pre class="programlisting">modules := lib/codec lib/db lib/ui app/player
 . . . 
include $(addsuffix /module.mk,$(modules))</pre><p>å¯¹äºŽè¾ƒå¤§çš„é¡¹ç›®ï¼Œéšç€æ¨¡å—åˆ—è¡¨å¢žé•¿åˆ°æ•°ç™¾æˆ–æ•°åƒï¼Œè¿™ç”šè‡³å¯èƒ½æˆä¸ºç»´æŠ¤é—®é¢˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½å®šä¹‰<code class="literal">modules</code> <a id="OEBPS/ch06s02.html.make3-CHP-6-ITERM-1399" class="indexterm"></a> <a id="OEBPS/ch06s02.html.make3-CHP-6-ITERM-1400" class="indexterm"></a>ä½œä¸º<em class="command">æŸ¥æ‰¾</em>
        å‘½ä»¤ï¼š</p><p>For larger projects, even this can be a maintenance problem as
        the list of modules grows to the hundreds or thousands. Under these
        circumstances, it might be preferable to define <code class="literal">modules</code> <a class="indexterm"></a> <a class="indexterm"></a>as a <em class="command">find</em>
        command:</p><a id="OEBPS/ch06s02.html.I_1_tt336"></a><pre class="programlisting">æ¨¡å— := $(subst /module.mk,,$(shell find .-name module.mk))
 ã€‚ ã€‚ ã€‚
åŒ…æ‹¬ $(addsuffix /module.mk,$(modules))</pre><pre class="programlisting">modules := $(subst /module.mk,,$(shell find . -name module.mk))
 . . . 
include $(addsuffix /module.mk,$(modules))</pre><p><em class="command">æˆ‘ä»¬ä»ŽæŸ¥æ‰¾</em>è¾“å‡ºä¸­åˆ é™¤æ–‡ä»¶åï¼Œå› æ­¤è¯¥<code class="literal">modules</code>å˜é‡ä½œä¸ºæ¨¡å—åˆ—è¡¨æ›´æœ‰ç”¨ã€‚å¦‚æžœæ²¡æœ‰å¿…è¦ï¼Œé‚£ä¹ˆï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬ä¼šçœç•¥<code class="function">subst</code>and
        å¹¶ç®€å•åœ°å°†<em class="command">find</em><code class="function">addsuffix</code>çš„è¾“å‡ºä¿å­˜åœ¨ ä¸­ã€‚<a class="link" href="#OEBPS/ch06s02.html.make3-CHP-6-EX-3" title="ä¾‹ 6-3ã€‚éžé€’å½’ makefileï¼Œç‰ˆæœ¬ 2">ä¾‹ 6-3</a>æ˜¾ç¤ºäº†æœ€ç»ˆçš„
        <em class="filename">makefile</em>ã€‚<em class="command"></em><code class="literal">modules</code><a class="link" href="#OEBPS/ch06s02.html.make3-CHP-6-EX-3" title="ä¾‹ 6-3ã€‚éžé€’å½’ makefileï¼Œç‰ˆæœ¬ 2"></a><em class="filename"></em></p><p>We strip the filename from the <em class="command">find</em> output so the <code class="literal">modules</code> variable is more generally useful as
        the list of modules. If that isn't necessary, then, of course, we
        would omit the <code class="function">subst</code> and
        <code class="function">addsuffix</code> and simply save the
        output of <em class="command">find</em> in <code class="literal">modules</code>. <a class="link" href="#OEBPS/ch06s02.html.make3-CHP-6-EX-3" title="Example&nbsp;6-3.&nbsp;A nonrecursive makefile, version 2">Example 6-3</a> shows the final
        <em class="filename">makefile</em>.</p><div class="example"><a id="OEBPS/ch06s02.html.make3-CHP-6-EX-3"></a><p class="title">ä¾‹ 6-3ã€‚éžé€’å½’ makefileï¼Œç‰ˆæœ¬ 2</p><p class="title">Example&nbsp;6-3.&nbsp;A nonrecursive makefile, version 2</p><div class="example-contents"><pre class="programlisting"># $(è°ƒç”¨æºåˆ°å¯¹è±¡ï¼Œæºæ–‡ä»¶åˆ—è¡¨)
æºåˆ°å¯¹è±¡ = $(subst .c,.o,$(filter %.c,$1)) \
                   $(subst .y,.o,$(è¿‡æ»¤å™¨ %.y,$1)) \
                   $(subst .l,.o,$(è¿‡æ»¤å™¨ %.l,$1))

# $(å­ç›®å½•)
å­ç›®å½• = $(patsubst %/module.mk,%, \
                 $(å•è¯\
                   $(å•è¯$(MAKEFILE_LIST)),$(MAKEFILE_LIST)))

# $(è°ƒç”¨ make-library, åº“å, æºæ–‡ä»¶åˆ—è¡¨)
å®šä¹‰ make-library
  å›¾ä¹¦é¦† += $1
  æ¥æº += $2

  $1: $(è°ƒç”¨æºåˆ°å¯¹è±¡,$2)
        $(AR) $(ARFLAGS) $$@ $$^
æ©å¾·å¤«

# $(è°ƒç”¨ç”Ÿæˆæºï¼Œæºæ–‡ä»¶åˆ—è¡¨)
ç”Ÿæˆæº = $(subst .y,.c,$(filter %.y,$1)) \
                   $(subst .y,.h,$(è¿‡æ»¤å™¨ %.y,$1)) \
                   $(subst .l,.c,$(è¿‡æ»¤å™¨ %.l,$1))

# ä»Žè¿™å››ä¸ªå˜é‡ä¸­æ”¶é›†æ¯ä¸ªæ¨¡å—çš„ä¿¡æ¯ã€‚
# åœ¨è¿™é‡Œå°†å®ƒä»¬åˆå§‹åŒ–ä¸ºç®€å•å˜é‡ã€‚
æ¨¡å—ï¼š= lib /ç¼–è§£ç å™¨lib / db lib / uiåº”ç”¨ç¨‹åº/æ’­æ”¾å™¨
ç¨‹åº:=
åº“:=
æ¥æº:=

å¯¹è±¡ = $(è°ƒç”¨æºåˆ°å¯¹è±¡,$(æº))
ä¾èµ–é¡¹ = $(subst .o,.d,$(å¯¹è±¡))

include_dirs := lib åŒ…å«
CPPFLAGS += $(addprefix -I ,$(include_dirs))
vpath %.h $(include_dirs)

MV := mv -f
RM := rm -f
SED := sed

å…¨éƒ¨ï¼š

åŒ…æ‹¬ $(addsuffix /module.mk,$(modules))

.PHONYï¼šå…¨éƒ¨
å…¨éƒ¨ï¼š$ï¼ˆç¨‹åºï¼‰

.PHONYï¼šåº“
å›¾ä¹¦é¦†ï¼š$ï¼ˆå›¾ä¹¦é¦†ï¼‰

.PHONYï¼šå¹²å‡€
å¹²å‡€çš„ï¼š
        $(RM) $(å¯¹è±¡) $(ç¨‹åº) $(åº“) $(ä¾èµ–é¡¹) \
              $(è°ƒç”¨ç”Ÿæˆæºï¼Œ$(æº))

ifneq "$(MAKECMDGOALS)" "å¹²å‡€"
  åŒ…æ‹¬ $(ä¾èµ–é¡¹)
ä¸‡ä¸€

%.c %.h: %.y
        $(YACC.y) --å®šä¹‰$&lt;
        $(MV) y.tab.c $*.c
        $(MV) y.tab.h $*.h

%.d: %.c
        $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -M $&lt; | \
        $(SED) 's,\($(notdir $*)\.o\) *:,$(dir $@)\1 $@: ,' &gt; $@.tmp
        $(MV) $@.tmp $@</pre><pre class="programlisting"># $(call source-to-object, source-file-list)
source-to-object = $(subst .c,.o,$(filter %.c,$1)) \
                   $(subst .y,.o,$(filter %.y,$1)) \
                   $(subst .l,.o,$(filter %.l,$1))

# $(subdirectory)
subdirectory = $(patsubst %/module.mk,%,                        \
                 $(word                                         \
                   $(words $(MAKEFILE_LIST)),$(MAKEFILE_LIST)))

# $(call make-library, library-name, source-file-list)
define make-library
  libraries += $1
  sources   += $2

  $1: $(call source-to-object,$2)
        $(AR) $(ARFLAGS) $$@ $$^
endef

# $(call generated-source, source-file-list)
generated-source = $(subst .y,.c,$(filter %.y,$1))      \
                   $(subst .y,.h,$(filter %.y,$1))      \
                   $(subst .l,.c,$(filter %.l,$1))

# Collect information from each module in these four variables.
# Initialize them here as simple variables.
modules      := lib/codec lib/db lib/ui app/player
programs     :=
libraries    :=
sources      :=

objects      =  $(call source-to-object,$(sources))
dependencies =  $(subst .o,.d,$(objects))

include_dirs := lib include
CPPFLAGS     += $(addprefix -I ,$(include_dirs))
vpath %.h $(include_dirs)

MV  := mv -f
RM  := rm -f
SED := sed

all:

include $(addsuffix /module.mk,$(modules))

.PHONY: all
all: $(programs)

.PHONY: libraries
libraries: $(libraries)

.PHONY: clean
clean:
        $(RM) $(objects) $(programs) $(libraries) $(dependencies)       \
              $(call generated-source, $(sources))

ifneq "$(MAKECMDGOALS)" "clean"
  include $(dependencies)
endif

%.c %.h: %.y
        $(YACC.y) --defines $&lt;
        $(MV) y.tab.c $*.c
        $(MV) y.tab.h $*.h

%.d: %.c
        $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -M $&lt; | \
        $(SED) 's,\($(notdir $*)\.o\) *:,$(dir $@)\1 $@: ,' &gt; $@.tmp
        $(MV) $@.tmp $@</pre></div></div><p>æ¯ä¸ªæ¨¡å—ä½¿ç”¨ä¸€ä¸ªåŒ…å«æ–‡ä»¶æ˜¯ç›¸å½“å¯è¡Œçš„ï¼Œå¹¶ä¸”æœ‰ä¸€äº›ä¼˜ç‚¹ï¼Œä½†æˆ‘ä¸ç›¸ä¿¡è¿™æ˜¯å€¼å¾—åšçš„ã€‚æˆ‘è‡ªå·±åœ¨å¤§åž‹ Java é¡¹ç›®ä¸­çš„ç»éªŒè¡¨æ˜Žï¼Œå•ä¸ªé¡¶çº§<em class="filename">makefile</em>æœ‰æ•ˆåœ°å°†æ‰€æœ‰
        <em class="filename">module.mk</em>æ–‡ä»¶ç›´æŽ¥æ’å…¥åˆ°
        <em class="filename">makefile</em>ä¸­ï¼Œæä¾›äº†åˆç†çš„è§£å†³æ–¹æ¡ˆã€‚è¯¥é¡¹ç›®åŒ…æ‹¬ 997 ä¸ªç‹¬ç«‹æ¨¡å—ã€å¤§çº¦ä¸¤æ‰“åº“å’Œå…­ä¸ªåº”ç”¨ç¨‹åºã€‚æœ‰å‡ ä¸ª<em class="filename">makefile</em>ç”¨äºŽä¸ç›¸äº¤çš„ä»£ç é›†ã€‚è¿™äº›
        <em class="filename">makefile</em>å¤§çº¦æœ‰ 2,500 è¡Œé•¿ã€‚åŒ…å«å…¨å±€å˜é‡ã€ç”¨æˆ·å®šä¹‰å‡½æ•°å’Œæ¨¡å¼è§„åˆ™çš„å…¬å…±åŒ…å«æ–‡ä»¶è¿˜æœ‰ 2,500 è¡Œã€‚</p><p>Using one include file per module is quite workable and has some
        advantages, but I'm not convinced it is worth doing. My own experience
        with a large Java project indicates that a single top-level <em class="filename">makefile</em>, effectively inserting all the
        <em class="filename">module.mk</em> files directly into the
        <em class="filename">makefile</em>, provides a reasonable
        solution. This project included 997 separate modules, about two dozen
        libraries, and half a dozen applications. There were several <em class="filename">makefile</em>s for disjoint sets of code. These
        <em class="filename">makefile</em>s were roughly 2,500
        lines long. A common include file containing global variables,
        user-defined functions, and pattern rules was another 2,500
        lines.</p><p>æ— è®ºæ‚¨é€‰æ‹©å•ä¸ª<em class="filename">makefile</em>è¿˜æ˜¯å°†æ¨¡å—ä¿¡æ¯åˆ†è§£ä¸ºåŒ…å«æ–‡ä»¶ï¼Œéžé€’å½’<em class="command">make</em>è§£å†³æ–¹æ¡ˆéƒ½æ˜¯æž„å»ºå¤§åž‹é¡¹ç›®çš„å¯è¡Œæ–¹æ³•ã€‚å®ƒè¿˜è§£å†³äº†é€’å½’<em class="command">make</em>
        æ–¹æ³•ä¸­å‘çŽ°çš„è®¸å¤šä¼ ç»Ÿé—®é¢˜ã€‚æˆ‘çŸ¥é“çš„å”¯ä¸€ç¼ºç‚¹æ˜¯ä¹ æƒ¯äºŽé€’å½’<em class="command">make çš„</em>å¼€å‘äººå‘˜éœ€è¦è¿›è¡ŒèŒƒå¼è½¬å˜ã€‚</p><p>Whether you choose a single <em class="filename">makefile</em> or break out module information
        into include files, the nonrecursive <em class="command">make</em> solution is a viable approach to
        building large projects. It also solves many traditional problems
        found in the recursive <em class="command">make</em>
        approach. The only drawback I'm aware of is the paradigm shift
        required for developers used to recursive <em class="command">make</em>.</p></div></div></div>
<div id="OEBPS/ch06s03.html"><div>
<div class="sect1" title="å¤§åž‹ç³»ç»Ÿçš„ç»„ä»¶"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch06s03.html.make3-CHP-6-SECT-3"></a>å¤§åž‹ç³»ç»Ÿçš„ç»„ä»¶</h1><h1 class="title"><a></a>Components of Large Systems</h1></div></div></div><p>å‡ºäºŽæœ¬æ¬¡è®¨è®ºçš„ç›®çš„ï¼Œæœ‰<a id="OEBPS/ch06s03.html.make3-CHP-6-ITERM-1401" class="indexterm"></a> <a id="OEBPS/ch06s03.html.make3-CHP-6-ITERM-1402" class="indexterm"></a> <a id="OEBPS/ch06s03.html.make3-CHP-6-ITERM-1403" class="indexterm"></a>å½“ä»Šæµè¡Œä¸¤ç§å¼€å‘é£Žæ ¼ï¼šè‡ªç”±è½¯ä»¶æ¨¡åž‹å’Œå•†ä¸šå¼€å‘æ¨¡åž‹ã€‚</p><p>For the purposes of this discussion, there <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>are two styles of development popular today: the free
        software model and the commercial development model.</p><p>åœ¨è‡ªç”±è½¯ä»¶æ¨¡åž‹ä¸­ï¼Œæ¯ä¸ªå¼€å‘äººå‘˜å¾ˆå¤§ç¨‹åº¦ä¸Šä¾é è‡ªå·±ã€‚ä¸€ä¸ªé¡¹ç›®æœ‰ä¸€ä¸ª<em class="filename">makefile</em>å’Œä¸€ä¸ª<em class="filename">README</em>ï¼Œå¼€å‘äººå‘˜åªéœ€å°‘é‡å¸®åŠ©å°±å¯ä»¥å¼„æ¸…æ¥šå®ƒã€‚è¯¥é¡¹ç›®çš„è´Ÿè´£äººå¸Œæœ›ä¸€åˆ‡é¡ºåˆ©ï¼Œå¹¶å¸Œæœ›æ”¶åˆ°æ¥è‡ªå¤§åž‹ç¤¾åŒºçš„è´¡çŒ®ï¼Œä½†ä»–ä»¬æœ€æ„Ÿå…´è¶£çš„æ˜¯æŠ€æœ¯ç†Ÿç»ƒä¸”ç§¯æžä¸»åŠ¨çš„äººçš„è´¡çŒ®ã€‚è¿™ä¸æ˜¯æ‰¹è¯„ã€‚ä»Žè¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œè½¯ä»¶åº”è¯¥å†™å¾—å¥½ï¼Œè€Œä¸ä¸€å®šè¦æŒ‰ç…§æ—¶é—´è¡¨æ¥å†™ã€‚</p><p>In the free software model, each developer is largely on his
        own. A project has a <em class="filename">makefile</em> and
        a <em class="filename">README</em> and developers are
        expected to figure it out with only a small amount of help. The
        principals of the project want things to work well and want to receive
        contributions from a large community, but they are mostly interested
        in contributions from the skilled and well-motivated. This is not a
        criticism. In this point of view, software should be written well, and
        not necessarily to a schedule.</p><p>åœ¨å•†ä¸šå¼€å‘æ¨¡å¼ä¸­ï¼Œå¼€å‘äººå‘˜çš„æŠ€èƒ½æ°´å¹³å„ä¸ç›¸åŒï¼Œä»–ä»¬éƒ½å¿…é¡»èƒ½å¤Ÿå¼€å‘è½¯ä»¶æ¥ä¸ºç›ˆåˆ©åšå‡ºè´¡çŒ®ã€‚ä»»ä½•ä¸çŸ¥é“å¦‚ä½•å®Œæˆå·¥ä½œçš„å¼€å‘äººå‘˜éƒ½æ˜¯åœ¨æµªè´¹é‡‘é’±ã€‚å¦‚æžœç³»ç»Ÿä¸èƒ½æ­£å¸¸ç¼–è¯‘æˆ–è¿è¡Œï¼Œæ•´ä¸ªå¼€å‘å›¢é˜Ÿå¯èƒ½ä¼šé—²ç½®ï¼Œè¿™æ˜¯æœ€æ˜‚è´µçš„æƒ…å†µã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå¼€å‘è¿‡ç¨‹ç”±å·¥ç¨‹æ”¯æŒå›¢é˜Ÿç®¡ç†ï¼Œè¯¥å›¢é˜Ÿè´Ÿè´£åè°ƒæž„å»ºè¿‡ç¨‹ã€è½¯ä»¶å·¥å…·çš„é…ç½®ã€æ–°å¼€å‘å’Œç»´æŠ¤å·¥ä½œçš„åè°ƒä»¥åŠç‰ˆæœ¬çš„ç®¡ç†ã€‚åœ¨è¿™ç§çŽ¯å¢ƒä¸‹ï¼Œæ•ˆçŽ‡é—®é¢˜åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­å æ®ä¸»å¯¼åœ°ä½ã€‚</p><p>In the commercial development model, developers come in a wide
        variety of skill levels and all of them must be able to develop
        software to contribute to the bottom line. Any developer who can't
        figure out how to do their job is wasting money. If the system doesn't
        compile or run properly, the development team as a whole may be idle,
        the most expensive possible scenario. To handle these issues, the
        development process is managed by an engineering support team that
        coordinates the build process, configuration of software tools,
        coordination of new development and maintenance work, and the
        management of releases. In this environment, efficiency concerns
        dominate the process.</p><p>å•†ä¸šå¼€å‘æ¨¡åž‹å€¾å‘äºŽåˆ›å»ºå¤æ‚çš„æž„å»ºç³»ç»Ÿã€‚å…¶ä¸»è¦åŽŸå› æ˜¯é€šè¿‡æé«˜ç¨‹åºå‘˜æ•ˆçŽ‡æ¥é™ä½Žè½¯ä»¶å¼€å‘æˆæœ¬çš„åŽ‹åŠ›ã€‚åè¿‡æ¥ï¼Œè¿™åº”è¯¥ä¼šå¯¼è‡´åˆ©æ¶¦å¢žåŠ ã€‚è¿™ç§æ¨¡åž‹æœ€éœ€è¦<em class="command">make</em>çš„æ”¯æŒã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè®¨è®ºçš„æŠ€æœ¯ä¹Ÿé€‚ç”¨äºŽè‡ªç”±è½¯ä»¶æ¨¡åž‹ï¼Œå½“ä»–ä»¬çš„éœ€æ±‚éœ€è¦å®ƒæ—¶ã€‚</p><p>It is the commercial development model that tends to create
        elaborate build systems. The primary reason for this is pressure to
        reduce the cost of software development by increasing programmer
        efficiency. This, in turn, should lead to increased profit. It is this
        model that requires the most support from <em class="command">make</em>. Nevertheless, the techniques we
        discuss here apply to the free software model as well when their
        requirements demand it.</p><p>æœ¬èŠ‚åŒ…å«å¤§é‡é«˜çº§ä¿¡æ¯ï¼Œä½†å…·ä½“ç»†èŠ‚å¾ˆå°‘ï¼Œä¹Ÿæ²¡æœ‰ç¤ºä¾‹ã€‚è¿™æ˜¯å› ä¸ºå¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºŽæ‰€ä½¿ç”¨çš„è¯­è¨€å’Œæ“ä½œçŽ¯å¢ƒã€‚åœ¨<a class="link" href="#OEBPS/ch08.html" title="ç¬¬ 8 ç«  C å’Œ C++">ç¬¬ 8 ç« å’Œ</a><a class="link" href="#OEBPS/ch09.html" title="ç¬¬ 9 ç«  Java">ç¬¬ 9 ç« </a>ä¸­ï¼Œæˆ‘å°†æä¾›å¦‚ä½•å®žçŽ°å…¶ä¸­è®¸å¤šåŠŸèƒ½çš„å…·ä½“ç¤ºä¾‹ã€‚</p><p>This section contains a lot of high-level information with very
        few specifics and no examples. That's because so much depends on the
        language and operating environment used. In <a class="link" href="#OEBPS/ch08.html" title="Chapter&nbsp;8.&nbsp;C and C++">Chapter 8</a> and <a class="link" href="#OEBPS/ch09.html" title="Chapter&nbsp;9.&nbsp;Java">Chapter 9</a>, I will provide specific
        examples of how to implement many of these features.</p><div class="sect2" title="è¦æ±‚"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch06s03.html.make3-CHP-6-SECT-3.1"></a>è¦æ±‚</h2><h2 class="title"><a></a>Requirements</h2></div></div></div><p>å½“ç„¶è¦æ±‚ä¸åŒ<a id="OEBPS/ch06s03.html.make3-CHP-6-ITERM-1404" class="indexterm"></a>æ¯ä¸ªé¡¹ç›®å’Œæ¯ä¸ªå·¥ä½œçŽ¯å¢ƒã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ¶µç›–äº†åœ¨è®¸å¤šå•†ä¸šå¼€å‘çŽ¯å¢ƒä¸­é€šå¸¸è¢«è®¤ä¸ºé‡è¦çš„å¹¿æ³›èŒƒå›´ã€‚</p><p>Of course requirements vary <a class="indexterm"></a>with every project and every work environment. Here we
          cover a wide range that are often considered important in many
          commercial development environments.</p><p>å¼€å‘å›¢é˜ŸæœŸæœ›çš„æœ€å¸¸è§çš„åŠŸèƒ½æ˜¯å°†æºä»£ç ä¸ŽäºŒè¿›åˆ¶ä»£ç åˆ†ç¦»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–è¯‘ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶åº”è¯¥æ”¾ç½®åœ¨å•ç‹¬çš„äºŒå‰æ ‘ä¸­ã€‚åè¿‡æ¥ï¼Œè¿™å…è®¸æ·»åŠ è®¸å¤šå…¶ä»–åŠŸèƒ½ã€‚å•ç‹¬çš„äºŒå‰æ ‘æä¾›äº†è®¸å¤š<a id="OEBPS/ch06s03.html.make3-CHP-6-ITERM-1405" class="indexterm"></a>ä¼˜ç‚¹ï¼š</p><p>The most common feature desired by development teams is the
          separation of source code from binary code. That is, the object
          files generated from a compile should be placed in a separate binary
          tree. This, in turn, allows many other features to be added.
          Separate binary trees offer many <a class="indexterm"></a>advantages:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>å½“å¯ä»¥æŒ‡å®šå¤§åž‹äºŒå‰æ ‘çš„ä½ç½®æ—¶ï¼Œç®¡ç†ç£ç›˜èµ„æºä¼šæ›´å®¹æ˜“ã€‚</p></li><li class="listitem"><p>It is easier to manage disk resources when the location of
              large binary trees can be specified.</p></li><li class="listitem"><p>å¯ä»¥å¹¶è¡Œç®¡ç†äºŒå‰æ ‘çš„è®¸å¤šç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œå•ä¸ªæºä»£ç æ ‘å¯èƒ½å…·æœ‰å¯ç”¨çš„ä¼˜åŒ–ã€è°ƒè¯•å’Œåˆ†æžäºŒè¿›åˆ¶ç‰ˆæœ¬ã€‚</p></li><li class="listitem"><p>Many versions of a binary tree can be managed in parallel.
              For instance, a single source tree may have optimized, debug,
              and profiling binary versions available.</p></li><li class="listitem"><p>å¯ä»¥åŒæ—¶æ”¯æŒå¤šä¸ªå¹³å°ã€‚æ­£ç¡®å®žçŽ°çš„æºä»£ç æ ‘å¯ç”¨äºŽå¹¶è¡Œç¼–è¯‘å¤šä¸ªå¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p></li><li class="listitem"><p>Multiple platforms can be supported simultaneously. A
              properly implemented source tree can be used to compile binaries
              for many platforms in parallel.</p></li><li class="listitem"><p>å¼€å‘äººå‘˜å¯ä»¥æ£€æŸ¥éƒ¨åˆ†æºä»£ç æ ‘ï¼Œå¹¶è®©æž„å»ºç³»ç»Ÿè‡ªåŠ¨ä»Žå‚è€ƒæºä»£ç å’ŒäºŒè¿›åˆ¶æ ‘ä¸­â€œå¡«å……â€ç¼ºå¤±çš„æ–‡ä»¶ã€‚è¿™å¹¶ä¸ä¸¥æ ¼è¦æ±‚åˆ†ç¦»æºä»£ç å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½†å¦‚æžœä¸è¿›è¡Œåˆ†ç¦»ï¼Œå¼€å‘äººå‘˜æž„å»ºç³»ç»Ÿå¾ˆå¯èƒ½ä¼šå¯¹åº”è¯¥åœ¨å“ªé‡Œæ‰¾åˆ°äºŒè¿›åˆ¶æ–‡ä»¶æ„Ÿåˆ°å›°æƒ‘ã€‚</p></li><li class="listitem"><p>Developers can check out partial source trees and have the
              build system automatically "fill in" the missing files from a
              reference source and binary trees. This doesn't strictly require
              separating source and binary, but without the separation it is
              more likely that developer build systems would get confused
              about where binaries should be found.</p></li><li class="listitem"><p>å¯ä»¥é€šè¿‡åªè¯»è®¿é—®æ¥ä¿æŠ¤æºæ ‘ã€‚è¿™æä¾›äº†é¢å¤–çš„ä¿è¯ï¼Œå³æž„å»ºåæ˜ å­˜å‚¨åº“ä¸­çš„æºä»£ç ã€‚</p></li><li class="listitem"><p>Source trees can be protected with read-only access. This
              provides added assurance that the builds reflect the source code
              in the repository.</p></li><li class="listitem"><p><code class="literal">clean</code>å¦‚æžœå¯ä»¥å°†æ ‘è§†ä¸ºå•ä¸ªå•å…ƒè€Œä¸æ˜¯åœ¨æ ‘ä¸­æœç´¢è¦æ“ä½œçš„æ–‡ä»¶ï¼Œåˆ™æŸäº›ç›®æ ‡ï¼ˆä¾‹å¦‚ï¼‰å¯ä»¥è½»æ¾å®žçŽ°ï¼ˆå¹¶ä¸”æ‰§è¡Œé€Ÿåº¦ä¼šæ˜¾ç€åŠ å¿«ï¼‰ã€‚</p></li><li class="listitem"><p>Some targets, such as <code class="literal">clean</code>, can be implemented trivially
              (and will execute dramatically faster) if a tree can be treated
              as a single unit rather than searching the tree for files to
              operate on.</p></li></ul></div><p>ä¸Šè¿°å¤§å¤šæ•°è¦ç‚¹æœ¬èº«å°±æ˜¯é‡è¦çš„æž„å»ºåŠŸèƒ½ï¼Œå¹¶ä¸”å¯èƒ½æ˜¯é¡¹ç›®è¦æ±‚ã€‚</p><p>Most of the above points are themselves important build
          features and may be project requirements.</p><p>èƒ½å¤Ÿç»´æŠ¤é¡¹ç›®çš„å‚è€ƒç‰ˆæœ¬é€šå¸¸æ˜¯ä¸€ä¸ªé‡è¦çš„ç³»ç»ŸåŠŸèƒ½ã€‚è¿™ä¸ªæƒ³æ³•æ˜¯ï¼Œæ¯æ™šéƒ½ä¼šå¯¹æºä»£ç è¿›è¡Œå¹²å‡€çš„ç­¾å‡ºå’Œæž„å»ºï¼Œé€šå¸¸æ˜¯é€šè¿‡<em class="command">cron</em>ä½œä¸šæ¥æ‰§è¡Œã€‚ç”±äºŽç”Ÿæˆçš„æºä»£ç å’ŒäºŒå‰æ ‘ç›¸å¯¹äºŽ CVS æºä»£ç æ²¡æœ‰è¿›è¡Œä¿®æ”¹ï¼Œå› æ­¤æˆ‘å°†å®ƒä»¬ç§°ä¸ºå‚è€ƒæºä»£ç å’ŒäºŒå‰æ ‘ã€‚ç”±æ­¤äº§ç”Ÿçš„æ ‘æœ¨æœ‰å¾ˆå¤šç”¨é€”ã€‚</p><p>Being able to maintain reference builds of a project is often
          an important system feature. The idea is that a clean check-out and
          build of the source is performed nightly, typically by a <em class="command">cron</em> job. Since the resulting source and
          binary trees are unmodified with respect to the CVS source, I refer
          to these as reference source and binary trees. The resulting trees
          have many uses.</p><p>é¦–å…ˆï¼Œéœ€è¦æŸ¥çœ‹æºä»£ç çš„ç¨‹åºå‘˜å’Œç®¡ç†äººå‘˜å¯ä»¥ä½¿ç”¨å‚è€ƒæºä»£ç æ ‘ã€‚è¿™å¯èƒ½çœ‹èµ·æ¥å¾®ä¸è¶³é“ï¼Œä½†æ˜¯å½“æ–‡ä»¶å’Œç‰ˆæœ¬çš„æ•°é‡å¢žåŠ æ—¶ï¼ŒæœŸæœ›æŸäººä»…ä»…ä¸ºäº†æ£€æŸ¥å•ä¸ªæ–‡ä»¶è€Œæ£€æŸ¥æºä»£ç å¯èƒ½ä¼šå¾ˆç¬¨æ‹™æˆ–ä¸åˆç†ã€‚æ­¤å¤–ï¼Œè™½ç„¶ CVS å­˜å‚¨åº“æµè§ˆå·¥å…·å¾ˆå¸¸è§ï¼Œä½†å®ƒä»¬é€šå¸¸ä¸æä¾›å¯¹æ•´ä¸ªæºä»£ç æ ‘çš„è½»æ¾æœç´¢ã€‚ä¸ºæ­¤ï¼Œæ ‡ç­¾è¡¨ç”šè‡³<em class="command">find</em> / <em class="command">grep</em>ï¼ˆæˆ–<em class="command">grep</em> <code class="option">-R</code>ï¼‰æ›´åˆé€‚ã€‚</p><p>First, a reference source tree can be used by programmers and
          managers who need to look at the source. This may seem trivial, but
          when the number of files and releases grows it can be unwieldy or
          unreasonable to expect someone to check-out the source just to
          examine a single file. Also, while CVS repository browsing tools are
          common, they do not typically provide for easy searching of the
          entire source tree. For this, tags tables or even <em class="command">find</em>/<em class="command">grep</em> (or <em class="command">grep</em> <code class="option">-R</code>) are more
          appropriate.</p><p>å…¶æ¬¡ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œå‚è€ƒäºŒå‰æ ‘è¡¨æ˜Žæºä»£ç çš„æž„å»ºæ˜¯å¹²å‡€çš„ã€‚å½“å¼€å‘äººå‘˜æ¯å¤©æ—©ä¸Šå¼€å§‹å·¥ä½œæ—¶ï¼Œä»–ä»¬çŸ¥é“ç³»ç»Ÿæ˜¯æŸåè¿˜æ˜¯å®Œæ•´ã€‚å¦‚æžœå­˜åœ¨é¢å‘æ‰¹å¤„ç†çš„æµ‹è¯•æ¡†æž¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¹²å‡€çš„æž„å»ºæ¥è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚å¼€å‘äººå‘˜æ¯å¤©éƒ½å¯ä»¥æ£€æŸ¥æµ‹è¯•æŠ¥å‘Šæ¥ç¡®å®šç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µï¼Œè€Œæ— éœ€æµªè´¹æ—¶é—´è‡ªå·±è¿è¡Œæµ‹è¯•ã€‚å¦‚æžœå¼€å‘äººå‘˜åªæœ‰æºä»£ç çš„ä¿®æ”¹ç‰ˆæœ¬ï¼Œåˆ™èŠ‚çœçš„æˆæœ¬ä¼šæ›´åŠ å¤æ‚ï¼Œå› ä¸ºä»–é¿å…äº†èŠ±è´¹é¢å¤–çš„æ—¶é—´æ¥æ‰§è¡Œå¹²å‡€çš„ç­¾å‡ºå’Œæž„å»ºã€‚æœ€åŽï¼Œå¼€å‘äººå‘˜å¯ä»¥è¿è¡Œå‚è€ƒç‰ˆæœ¬æ¥æµ‹è¯•å’Œæ¯”è¾ƒç‰¹å®šç»„ä»¶çš„åŠŸèƒ½ã€‚</p><p>Second, and most importantly, a reference binary tree
          indicates that the source builds cleanly. When developers begin each
          morning, they know if the system is broken or whole. If a
          batch-oriented testing framework is in place, the clean build can be
          used to run automated tests. Each day developers can examine the
          test report to determine the health of the system without wasting
          time running the tests themselves. The cost savings is compounded if
          a developer has only a modified version of the source because he
          avoids spending additional time performing a clean check-out and
          build. Finally, the reference build can be run by developers to test
          and compare the functionality of specific components.</p><p>å‚è€ƒæž„å»ºä¹Ÿå¯ä»¥ä»¥å…¶ä»–æ–¹å¼ä½¿ç”¨ã€‚å¯¹äºŽåŒ…å«è®¸å¤šåº“çš„é¡¹ç›®ï¼Œç¨‹åºå‘˜å¯ä»¥ä½¿ç”¨å¤œé—´æž„å»ºä¸­çš„é¢„ç¼–è¯‘åº“å°†ä»–ä»¬è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸Žä»–ä»¬æœªä¿®æ”¹çš„åº“é“¾æŽ¥èµ·æ¥ã€‚è¿™ä½¿ä»–ä»¬èƒ½å¤Ÿé€šè¿‡ä»Žæœ¬åœ°ç¼–è¯‘ä¸­çœç•¥å¤§éƒ¨åˆ†æºä»£ç æ ‘æ¥ç¼©çŸ­å¼€å‘å‘¨æœŸã€‚å½“ç„¶ï¼Œå¦‚æžœå¼€å‘äººå‘˜éœ€è¦æ£€æŸ¥ä»£ç å¹¶ä¸”æ²¡æœ‰å®Œæ•´ç­¾å‡ºçš„æºä»£ç æ ‘ï¼Œé‚£ä¹ˆè½»æ¾è®¿é—®æœ¬åœ°æ–‡ä»¶æœåŠ¡å™¨ä¸Šçš„é¡¹ç›®æºä»£ç ä¼šå¾ˆæ–¹ä¾¿ã€‚</p><p>The reference build can be used in other ways as well. For
          projects that consist of many libraries, the precompiled libraries
          from the nightly build can be used by programmers to link their own
          application with those libraries they are not modifying. This allows
          them to shorten their develoment cycle by omiting large portions of
          the source tree from their local compiles. Of course, easy access to
          the project source on a local file server is convenient if
          developers need to examine the code and do not have a complete
          checked out source tree.</p><p>ç”±äºŽæœ‰å¦‚æ­¤å¤šçš„ä¸åŒç”¨é€”ï¼ŒéªŒè¯å‚è€ƒæºå’ŒäºŒå‰æ ‘çš„å®Œæ•´æ€§å˜å¾—æ›´åŠ é‡è¦ã€‚æé«˜å¯é æ€§çš„ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹æ³•æ˜¯å°†æºä»£ç æ ‘è®¾ç½®ä¸ºåªè¯»ã€‚å› æ­¤ï¼Œå¯ä»¥ä¿è¯å‚è€ƒæºæ–‡ä»¶å‡†ç¡®åœ°åæ˜ æ£€å‡ºæ—¶å­˜å‚¨åº“çš„çŠ¶æ€ã€‚æ‰§è¡Œæ­¤æ“ä½œå¯èƒ½éœ€è¦ç‰¹åˆ«å°å¿ƒï¼Œå› ä¸ºæž„å»ºçš„è®¸å¤šä¸åŒæ–¹é¢å¯èƒ½ä¼šå°è¯•å› æžœåœ°å†™å…¥æºæ ‘ã€‚ç‰¹åˆ«æ˜¯åœ¨ç”Ÿæˆæºä»£ç æˆ–å†™å…¥ä¸´æ—¶æ–‡ä»¶æ—¶ã€‚å°†æºä»£ç æ ‘è®¾ç½®ä¸ºåªè¯»è¿˜å¯ä»¥é˜²æ­¢ä¸´æ—¶ç”¨æˆ·æ„å¤–æŸåæºä»£ç æ ‘ï¼ˆè¿™æ˜¯æœ€å¸¸è§çš„æƒ…å†µï¼‰ã€‚</p><p>With so many different uses, it becomes more important to
          verify the integrity of the reference source and binary trees. One
          simple and effective way to improve reliability is to make the
          source tree read-only. Thus, it is guaranteed that the reference
          source files accurately reflect the state of the repository at the
          time of check out. Doing this can require special care, because many
          different aspects of the build may attempt to causally write to the
          source tree. Especially when generating source code or writing
          temporary files. Making the source tree read-only also prevents
          casual users from accidentally corrupting the source tree, a most
          common occurrence.</p><p>é¡¹ç›®æž„å»ºç³»ç»Ÿçš„å¦ä¸€ä¸ªå¸¸è§è¦æ±‚æ˜¯èƒ½å¤Ÿè½»æ¾å¤„ç†ä¸åŒçš„ç¼–è¯‘ã€é“¾æŽ¥å’Œéƒ¨ç½²é…ç½®ã€‚æž„å»ºç³»ç»Ÿé€šå¸¸å¿…é¡»èƒ½å¤Ÿç®¡ç†é¡¹ç›®çš„ä¸åŒç‰ˆæœ¬ï¼ˆå¯èƒ½æ˜¯æºå­˜å‚¨åº“çš„åˆ†æ”¯ï¼‰ã€‚</p><p>Another common requirement of the project build system is the
          ability to easily handle different compilation, linking, and
          deployment configurations. The build system typically must be able
          to manage different versions of the project (which may be branches
          of the source repository).</p><p>å¤§å¤šæ•°å¤§åž‹é¡¹ç›®éƒ½ä¾èµ–äºŽé‡è¦çš„ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼Œæ— è®ºæ˜¯å¯é“¾æŽ¥åº“è¿˜æ˜¯å·¥å…·çš„å½¢å¼ã€‚å¦‚æžœæ²¡æœ‰å…¶ä»–å·¥å…·æ¥ç®¡ç†è½¯ä»¶çš„é…ç½®ï¼ˆé€šå¸¸æ²¡æœ‰ï¼‰ï¼Œé‚£ä¹ˆä½¿ç”¨ makefile<em class="filename">å’Œ</em>æž„å»ºç³»ç»Ÿæ¥ç®¡ç†å®ƒé€šå¸¸æ˜¯ä¸€ä¸ªåˆç†çš„é€‰æ‹©ã€‚</p><p>Most large projects rely on significant third-party software,
          either in the form of linkable libraries or tools. If there are no
          other tools to manage configurations of the software (and often
          there are not), using the <em class="filename">makefile</em> and build system to manage this
          is often a reasonable choice.</p><p>æœ€åŽï¼Œå½“è½¯ä»¶å‘å¸ƒç»™å®¢æˆ·æ—¶ï¼Œé€šå¸¸ä¼šä»Žå…¶å¼€å‘å½¢å¼é‡æ–°æ‰“åŒ…ã€‚è¿™å¯ä»¥åƒä¸º Windows æž„å»º<em class="filename">setup.exe</em>æ–‡ä»¶ä¸€æ ·å¤æ‚ï¼Œä¹Ÿå¯ä»¥åƒæ ¼å¼åŒ– HTML æ–‡ä»¶å¹¶å°†å…¶ä¸Ž jar æ†ç»‘ä¸€æ ·ç®€å•ã€‚æœ‰æ—¶ï¼Œæ­¤å®‰è£…ç¨‹åºæž„å»ºæ“ä½œä¼šä¸Žæ­£å¸¸æž„å»ºè¿‡ç¨‹ç»“åˆåœ¨ä¸€èµ·ã€‚æˆ‘æ›´å–œæ¬¢å°†æž„å»ºå’Œå®‰è£…ç”Ÿæˆä½œä¸ºä¸¤ä¸ªç‹¬ç«‹çš„é˜¶æ®µï¼Œå› ä¸ºå®ƒä»¬ä¼¼ä¹Žä½¿ç”¨å®Œå…¨ä¸åŒçš„æµç¨‹ã€‚æ— è®ºå¦‚ä½•ï¼Œè¿™ä¸¤ä¸ªæ“ä½œéƒ½å¯èƒ½ä¼šå¯¹æž„å»ºç³»ç»Ÿäº§ç”Ÿå½±å“ã€‚</p><p>Finally, when software is released to a customer, it is often
          repackaged from its development form. This can be as complex as
          constructing a <em class="filename">setup.exe</em> file
          for Windows or as simple as formatting an HTML file and bundling it
          with a jar. Sometimes this installer build operation is combined
          with the normal build process. I prefer to keep the build and the
          install generation as two separate stages because they seem to use
          radically different processes. In any case, it is likely that both
          of these operations will have an impact on the build system.</p></div></div></div></div>
<div id="OEBPS/ch06s04.html"><div>
<div class="sect1" title="æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch06s04.html.make3-CHP-6-SECT-4"></a>æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€</h1><h1 class="title"><a></a>Filesystem Layout</h1></div></div></div><p>ä¸€æ—¦æ‚¨é€‰æ‹©æ”¯æŒf<a id="OEBPS/ch06s04.html.make3-CHP-6-ITERM-1406" class="indexterm"></a> <a id="OEBPS/ch06s04.html.make3-CHP-6-ITERM-1407" class="indexterm"></a>å¤šä¸ªäºŒå‰æ ‘ï¼Œå°±ä¼šå‡ºçŽ°æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€çš„é—®é¢˜ã€‚åœ¨éœ€è¦å¤šä¸ªäºŒå‰æ ‘çš„çŽ¯å¢ƒä¸­ï¼Œå¾€å¾€ä¼šæœ‰<span class="emphasis"><em>å¾ˆå¤š</em></span><span class="emphasis"><em>äºŒå‰æ ‘</em></span> ã€‚è¦ä¿æŒæ‰€æœ‰è¿™äº›æ ‘ç¬”ç›´ï¼Œéœ€è¦ä¸€äº›æ€è€ƒã€‚<span class="emphasis"><em></em></span></p><p>Once you choose to support f<a class="indexterm"></a> <a class="indexterm"></a>multiple binary trees, the question of filesystem layout
        arises. In environments that require multiple binary trees, there are
        often <span class="emphasis"><em>a</em></span> <span class="emphasis"><em>lot</em></span> of binary trees.
        To keep all these trees straight requires some thought.</p><p>ç»„ç»‡è¿™äº›æ•°æ®çš„å¸¸è§æ–¹æ³•æ˜¯ä¸ºäºŒå‰æ ‘â€œåœºâ€æŒ‡å®šä¸€ä¸ªå¤§ç£ç›˜ã€‚åœ¨è¯¥ç£ç›˜çš„é¡¶å±‚ï¼ˆæˆ–é™„è¿‘ï¼‰æ˜¯æ¯ä¸ªäºŒå‰æ ‘çš„ä¸€ä¸ªç›®å½•ã€‚è¿™äº›æ ‘çš„ä¸€ç§åˆç†å¸ƒå±€æ˜¯åœ¨æ¯ä¸ªç›®å½•åç§°ä¸­åŒ…å«äºŒå‰æ ‘çš„ä¾›åº”å•†ã€ç¡¬ä»¶å¹³å°ã€æ“ä½œç³»ç»Ÿå’Œæž„å»ºå‚æ•°ï¼š</p><p>A common way to organize this data is to designate a large disk
        for a binary tree "farm." At (or near) the top level of this disk is
        one directory for each binary tree. One reasonable layout for these
        trees is to include in each directory name the vendor, hardware
        platform, operating system, and build parameters of the binary
        tree:</p><a id="OEBPS/ch06s04.html.I_1_tt337"></a><pre class="programlisting">$<strong class="userinput"><code>ls</code></strong>
hp-386-windows-ä¼˜åŒ–
hp-386-windows-è°ƒè¯•
sgi-irix ä¼˜åŒ–
sgi-irix-è°ƒè¯•
sun-solaris8-profiled
sun-solaris8-è°ƒè¯•</pre><pre class="programlisting">$<strong class="userinput"><code>ls</code></strong>
hp-386-windows-optimized
hp-386-windows-debug
sgi-irix-optimzed
sgi-irix-debug
sun-solaris8-profiled
sun-solaris8-debug</pre><p>å½“å¿…é¡»ä¿ç•™è®¸å¤šä¸åŒæ—¶é—´çš„æž„å»ºæ—¶ï¼Œé€šå¸¸æœ€å¥½åœ¨ç›®å½•åç§°ä¸­åŒ…å«æ—¥æœŸæˆ³ï¼ˆç”šè‡³æ—¶é—´æˆ³ï¼‰ã€‚æ ¼å¼<code class="literal">yymmdd</code>
        æˆ–<code class="literal">yymmddhhmm</code>æŽ’åºè‰¯å¥½ï¼š</p><p>When builds from many different times must be kept, it is
        usually best to include a date stamp (and even a timestamp) in the
        directory name. The format <code class="literal">yymmdd</code>
        or <code class="literal">yymmddhhmm</code> sorts well:</p><a id="OEBPS/ch06s04.html.I_1_tt338"></a><pre class="programlisting">$<strong class="userinput"><code>ls</code></strong>
hp-386-windows-optimized-040123
hp-386-windows-debug-040123
sgi-irix-optimized-040127
sgi-irix-è°ƒè¯•-040127
å¤ªé˜³-solaris8-profiled-040127
å¤ªé˜³-solaris8-è°ƒè¯•-040127</pre><pre class="programlisting">$<strong class="userinput"><code>ls</code></strong>
hp-386-windows-optimized-040123
hp-386-windows-debug-040123
sgi-irix-optimzed-040127
sgi-irix-debug-040127
sun-solaris8-profiled-040127
sun-solaris8-debug-040127</pre><p>å½“ç„¶ï¼Œè¿™äº›æ–‡ä»¶åç»„æˆéƒ¨åˆ†çš„é¡ºåºå–å†³äºŽæ‚¨çš„ç«™ç‚¹ã€‚è¿™äº›æ ‘çš„é¡¶çº§ç›®å½•æ˜¯ä¿å­˜<em class="filename">makefile</em>å’Œæµ‹è¯•æ—¥å¿—çš„å¥½åœ°æ–¹ã€‚</p><p>Of course, the order of these filename components is up to your
        site. The top-level directory of these trees is a good place to hold
        the <em class="filename">makefile</em> and testing
        logs.</p><p>æ­¤å¸ƒå±€é€‚åˆå­˜å‚¨è®¸å¤šå¹¶è¡Œå¼€å‘äººå‘˜æž„å»ºã€‚å¦‚æžœå¼€å‘å›¢é˜Ÿå¯èƒ½ä¸ºå†…éƒ¨å®¢æˆ·è¿›è¡Œâ€œå‘å¸ƒâ€ï¼Œæ‚¨å¯ä»¥è€ƒè™‘æ·»åŠ ä¸€ä¸ªé¢å¤–çš„å‘å¸ƒåœºï¼Œå…¶ç»“æž„ä¸ºä¸€ç»„äº§å“ï¼Œæ¯ä¸ªäº§å“å¯èƒ½éƒ½æœ‰ç‰ˆæœ¬å·å’Œæ—¶é—´æˆ³ï¼Œå¦‚å›¾<a class="link" href="#OEBPS/ch06s04.html.make3-CHP-6-FIG-2" title="å›¾ 6-2ã€‚å‘å¸ƒæ ‘å¸ƒå±€ç¤ºä¾‹">6-2</a>æ‰€ç¤ºã€‚</p><p>This layout is appropriate for storing many parallel developer
        builds. If a development team makes "releases," possibly for internal
        customers, you can consider adding an additional release farm,
        structured as a set of products, each of which may have a version
        number and timestamp as shown in <a class="link" href="#OEBPS/ch06s04.html.make3-CHP-6-FIG-2" title="Figure&nbsp;6-2.&nbsp;Example of a release tree layout">Figure 6-2</a>.</p><div class="figure"><a id="OEBPS/ch06s04.html.make3-CHP-6-FIG-2"></a><div class="figure-contents"><div class="mediaobject"><a id="OEBPS/ch06s04.html.I_1_tt339"></a><img src="data:image/jpg;base64,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" width="185" alt="å‘å¸ƒæ ‘å¸ƒå±€ç¤ºä¾‹"></div></div><p class="title">å›¾ 6-2ã€‚å‘å¸ƒæ ‘å¸ƒå±€ç¤ºä¾‹</p><p class="title">Figure&nbsp;6-2.&nbsp;Example of a release tree layout</p></div><p>è¿™é‡Œçš„äº§å“å¯èƒ½æ˜¯åº“ï¼Œæ˜¯å¼€å‘å›¢é˜Ÿçš„è¾“å‡ºï¼Œä¾›å…¶ä»–å¼€å‘äººå‘˜ä½¿ç”¨ã€‚å½“ç„¶ï¼Œå®ƒä»¬ä¹Ÿå¯èƒ½æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„äº§å“ã€‚</p><p>Here products might be libraries that are the output of a
        development team for use by other developers. Of course, they may also
        be products in the traditional sense.</p><p>æ— è®ºæ‚¨çš„æ–‡ä»¶å¸ƒå±€æˆ–çŽ¯å¢ƒå¦‚ä½•ï¼Œè®¸å¤šç›¸åŒçš„æ ‡å‡†éƒ½æŽ§åˆ¶ç€å®žæ–½ã€‚å¿…é¡»å¾ˆå®¹æ˜“è¯†åˆ«æ¯æ£µæ ‘ã€‚æ¸…ç†å·¥ä½œåº”è¯¥å¿«é€Ÿä¸”æ˜Žæ˜¾ã€‚å®ƒæœ‰åŠ©äºŽè½»æ¾ç§»åŠ¨æ ‘å’Œå½’æ¡£æ ‘ã€‚æ­¤å¤–ï¼Œæ–‡ä»¶ç³»ç»Ÿå¸ƒå±€åº”ä¸Žç»„ç»‡çš„è¿›ç¨‹ç»“æž„ç´§å¯†åŒ¹é…ã€‚è¿™ä½¿å¾—ç»ç†ã€è´¨é‡ä¿è¯å’ŒæŠ€æœ¯å‡ºç‰ˆç‰©ç­‰éžç¨‹åºå‘˜å¯ä»¥è½»æ¾æµè§ˆæž—åœºã€‚</p><p>Whatever your file layout or environment, many of the same
        criteria govern the implementation. It must be easy to identify each
        tree. Cleanup should be fast and obvious. It is useful to make it easy
        to move trees around and archive trees. In addition, the filesystem
        layout should closely match the process structure of the organization.
        This makes it easy for nonprogrammers such as managers, quality
        assurance, and technical publications to navigate the tree
        farm.</p></div></div></div>
<div id="OEBPS/ch06s05.html"><div>
<div class="sect1" title="è‡ªåŠ¨åŒ–æž„å»ºå’Œæµ‹è¯•"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch06s05.html.make3-CHP-6-SECT-5"></a>è‡ªåŠ¨åŒ–æž„å»ºå’Œæµ‹è¯•</h1><h1 class="title"><a></a>Automating Builds and Testing</h1></div></div></div><p>é€šå¸¸é‡è¦çš„æ˜¯èƒ½å¤Ÿ<a id="OEBPS/ch06s05.html.make3-CHP-6-ITERM-1409" class="indexterm"></a> <a id="OEBPS/ch06s05.html.make3-CHP-6-ITERM-1410" class="indexterm"></a>å°½å¯èƒ½è‡ªåŠ¨åŒ–æž„å»ºè¿‡ç¨‹ã€‚è¿™å…è®¸åœ¨å¤œé—´æ‰§è¡Œå‚è€ƒæ ‘æž„å»ºï¼Œä»Žè€ŒèŠ‚çœå¼€å‘äººå‘˜ç™½å¤©çš„æ—¶é—´ã€‚å®ƒè¿˜å…è®¸å¼€å‘äººå‘˜è‡ªå·±åœ¨æ— äººå€¼å®ˆçš„æƒ…å†µä¸‹åœ¨è‡ªå·±çš„æœºå™¨ä¸Šè¿è¡Œæž„å»ºã€‚</p><p>It is typically important to be able to <a class="indexterm"></a> <a class="indexterm"></a>automate the build process as much as possible. This
        allows reference tree builds to be performed at night, saving
        developer time during the day. It also allows developers themselves to
        run builds on their own machines unattended.</p><p>å¯¹äºŽâ€œç”Ÿäº§ä¸­â€çš„è½¯ä»¶ï¼Œé€šå¸¸å­˜åœ¨è®¸å¤šå¯¹ä¸åŒäº§å“çš„ä¸åŒç‰ˆæœ¬çš„æž„å»ºçš„æœªå†³è¯·æ±‚ã€‚å¯¹äºŽè´Ÿè´£æ»¡è¶³è¿™äº›è¯·æ±‚çš„äººæ¥è¯´ï¼Œå¯åŠ¨å¤šä¸ªæž„å»ºå¹¶â€œèµ°å¼€â€çš„èƒ½åŠ›é€šå¸¸å¯¹äºŽä¿æŒç†æ™ºå’Œæ»¡è¶³è¯·æ±‚è‡³å…³é‡è¦ã€‚</p><p>For software that is "in production," there are often many
        outstanding requests for builds of different versions of different
        products. For the person in charge of satisfying these requests, the
        ability to fire off several builds and "walk away" is often critical
        to maintaining sanity and satisfying requests.</p><p>è‡ªåŠ¨åŒ–æµ‹è¯•ä¹Ÿæœ‰å…¶è‡ªèº«çš„é—®é¢˜ã€‚è®¸å¤šéžå›¾å½¢åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ç®€å•çš„è„šæœ¬æ¥ç®¡ç†æµ‹è¯•è¿‡ç¨‹ã€‚<acronym class="acronym">GNU</acronym>å·¥å…·dejaGnuè¿˜å¯ç”¨äºŽæµ‹è¯•éœ€è¦äº¤äº’çš„éžå›¾å½¢å®žç”¨ç¨‹åº<em class="command">ã€‚</em>å½“ç„¶ï¼Œåƒ JUnit ( <a class="ulink" href="http://www.junit.org/">http://www.junit.org</a> ) è¿™æ ·çš„æµ‹è¯•æ¡†æž¶ä¹Ÿæä¾›å¯¹éžå›¾å½¢å•å…ƒæµ‹è¯•çš„æ”¯æŒã€‚</p><p>Automated testing presents its own issues. Many nongraphical
        applications can use simple scripting to manage the testing process.
        The <acronym class="acronym">GNU</acronym> tool <em class="command">dejaGnu</em> can also be used to test
        nongraphical utilities that require interaction. Of course, testing
        frameworks like JUnit (<a class="ulink" href="http://www.junit.org">http://www.junit.org</a>)
        also provide support for nongraphical unit testing.</p><p>å›¾å½¢åº”ç”¨ç¨‹åºçš„æµ‹è¯•å‘ˆçŽ°å‡ºç‰¹æ®Šçš„<a id="OEBPS/ch06s05.html.make3-CHP-6-ITERM-1411" class="indexterm"></a>é—®é¢˜ã€‚å¯¹äºŽåŸºäºŽ X11 çš„ç³»ç»Ÿï¼Œæˆ‘å·²ä½¿ç”¨è™šæ‹Ÿå¸§ç¼“å†²åŒº<em class="command">Xvfb</em>æˆåŠŸæ‰§è¡Œäº†æ— äººå€¼å®ˆã€åŸºäºŽ cron çš„æµ‹è¯•ã€‚åœ¨Windowsä¸Šï¼Œæˆ‘è¿˜æ²¡æœ‰æ‰¾åˆ°ä»¤äººæ»¡æ„çš„æ— äººå€¼å®ˆæµ‹è¯•è§£å†³æ–¹æ¡ˆã€‚æ‰€æœ‰æ–¹æ³•éƒ½ä¾èµ–äºŽä¿æŒæµ‹è¯•å¸æˆ·ç™»å½•ä¸”å±å¹•è§£é”ã€‚</p><p>Testing of graphical applications presents special <a class="indexterm"></a>problems. For X11-based
        systems, I have successfully performed unattended, cron-based testing
        using the virtual frame buffer, <em class="command">Xvfb</em>. On Windows, I have not found a
        satisfactory solution to unattended testing. All approaches rely on
        leaving the testing account logged in and the screen unlocked.</p></div></div></div>
<div id="OEBPS/ch07.html"><div>
<div class="chapter" title="ç¬¬ 7 ç« å¯ç§»æ¤ Makefile"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch07.html.make3-CHP-7"></a>ç¬¬ 7 ç« å¯ç§»æ¤ Makefile</h1><h1 class="title"><a></a>Chapter&nbsp;7.&nbsp;Portable Makefiles</h1></div></div></div><p><em class="filename">å¯ç§»æ¤makefile</em>æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿä½œä¸ºä¸€ä¸ªæžç«¯çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¸Œæœ›
      <em class="filename">makefileå¯ä»¥åœ¨è¿è¡Œ</em><acronym class="acronym">GNU </acronym> <em class="command">make</em>çš„ä»»ä½•ç³»ç»Ÿä¸Šè¿è¡Œè€Œæ— éœ€æ›´æ”¹ã€‚ä½†ç”±äºŽæ“ä½œç³»ç»Ÿç§ç±»ç¹å¤šï¼Œè¿™å®žé™…ä¸Šæ˜¯ä¸å¯èƒ½çš„ã€‚æ›´åˆç†çš„è§£é‡Šæ˜¯<em class="filename">makefile</em>å¾ˆå®¹æ˜“é’ˆå¯¹å…¶è¿è¡Œçš„æ¯ä¸ªæ–°å¹³å°è¿›è¡Œæ›´æ”¹ã€‚ä¸€ä¸ªé‡è¦çš„é™„åŠ é™åˆ¶æ˜¯æ–°ç³»ç»Ÿçš„ç§»æ¤ä¸ä¼šç ´åå¯¹ä»¥å‰å¹³å°çš„æ”¯æŒã€‚</p><p>What do we mean by a portable <em class="filename">makefile</em>? As an extreme example, we want a
      <em class="filename">makefile</em> that runs without change
      on any system that <acronym class="acronym">GNU</acronym> <em class="command">make</em> runs on. But this is virtually impossible
      due to the enormous variety in operating systems. A more reasonable
      interpretation is a <em class="filename">makefile</em> that
      is easy to change for each new platform it is run on. An important added
      constraint is that the port to the new system does not break support for
      the previous platforms.</p><p>æˆ‘ä»¬å¯ä»¥è¾¾åˆ°è¿™ä¸ªæ°´å¹³<a id="OEBPS/ch07.html.make3-CHP-7-ITERM-1412" class="indexterm"></a>ä½¿ç”¨ä¸Žä¼ ç»Ÿç¼–ç¨‹ç›¸åŒçš„æŠ€æœ¯æ¥å®žçŽ°<em class="filename">makefile</em>çš„å¯ç§»æ¤æ€§ï¼šå°è£…å’ŒæŠ½è±¡ã€‚é€šè¿‡ä½¿ç”¨å˜é‡å’Œç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°è£…åº”ç”¨ç¨‹åºå’Œç®—æ³•ã€‚é€šè¿‡ä¸ºå‘½ä»¤è¡Œå‚æ•°å’Œå‚æ•°å®šä¹‰å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä»Žæ’å®šçš„å…ƒç´ ä¸­æŠ½è±¡å‡ºå› å¹³å°è€Œå¼‚çš„å…ƒç´ ã€‚</p><p>We can achieve this level of <a class="indexterm"></a>portability for <em class="filename">makefile</em>s using the same techniques as
      traditional programming: encapsulation and abstraction. By using
      variables and user-defined functions we can encapsulate applications and
      algorithms. By defining variables for command-line arguments and
      parameters, we can abstract out elements that vary from platform to
      platform from elements that are constant.</p><p>ç„¶åŽï¼Œæ‚¨å¿…é¡»ç¡®å®šæ¯ä¸ªå¹³å°æä¾›å“ªäº›å·¥å…·æ¥å®Œæˆæ‚¨çš„å·¥ä½œï¼Œä»¥åŠæ¯ä¸ªå¹³å°ä½¿ç”¨å“ªäº›å·¥å…·ã€‚å¯ç§»æ¤æ€§çš„æžè‡´æ˜¯ä»…ä½¿ç”¨æ‰€æœ‰æ„Ÿå…´è¶£çš„å¹³å°ä¸Šå­˜åœ¨çš„å·¥å…·å’ŒåŠŸèƒ½ã€‚è¿™é€šå¸¸è¢«ç§°ä¸ºâ€œæœ€å°å…¬åˆ†æ¯â€æ–¹æ³•ï¼Œæ˜¾ç„¶å¯ä»¥ç»™æ‚¨ç•™ä¸‹éžå¸¸åŽŸå§‹çš„åŠŸèƒ½æ¥ä½¿ç”¨ã€‚</p><p>You then have to determine what tools each platform offers to get
      your job done, and what to use from each platform. The extreme in
      portability is to use only those tools and features that exist on all
      platforms of interest. This is typically called the "least common
      denominator" approach and obviously can leave you with very primitive
      functionality to work with.</p><p>æœ€å°å…¬åˆ†æ¯æ–¹æ³•çš„å¦ä¸€ä¸ªç‰ˆæœ¬æ˜¯é€‰æ‹©ä¸€ç»„åŠŸèƒ½å¼ºå¤§çš„å·¥å…·ï¼Œå¹¶ç¡®ä¿å°†å…¶å¸¦åˆ°æ¯ä¸ªå¹³å°ï¼Œä»Žè€Œä¿è¯æ‚¨åœ¨ makefile ä¸­è°ƒç”¨çš„å‘½ä»¤åœ¨
      <em class="filename">ä»»ä½•</em>åœ°æ–¹éƒ½å®Œå…¨ç›¸åŒã€‚æ— è®ºæ˜¯åœ¨ç®¡ç†ä¸Šè¿˜æ˜¯åœ¨è®©ä½ çš„ç»„ç»‡é…åˆä½ æ‘†å¼„ä»–ä»¬çš„ç³»ç»Ÿæ–¹é¢ï¼Œè¿™éƒ½å¾ˆéš¾å®žçŽ°ã€‚ä½†å®ƒå¯ä»¥æˆåŠŸï¼Œç¨åŽæˆ‘å°†é€šè¿‡é€‚ç”¨äºŽ Windows çš„ Cygwin è½¯ä»¶åŒ…å±•ç¤ºä¸€ä¸ªç¤ºä¾‹ã€‚æ­£å¦‚æ‚¨å°†çœ‹åˆ°çš„ï¼Œå·¥å…·æ ‡å‡†åŒ–å¹¶ä¸èƒ½è§£å†³æ‰€æœ‰é—®é¢˜ã€‚æ€»æ˜¯å­˜åœ¨æ“ä½œç³»ç»Ÿå·®å¼‚éœ€è¦å¤„ç†ã€‚</p><p>Another version of the least common denominator approach is to
      choose a powerful set of tools and make sure to bring it with you to
      every platform, thus guaranteeing that the commands you invoke in the
      <em class="filename">makefile</em> work exactly the same
      everywhere. This can be hard to pull off, both administratively and in
      terms of getting your organization to cooperate with your fiddling with
      their systems. But it can be successful, and I'll show one example of
      that later with the Cygwin package for Windows. As you'll see,
      standardizing on tools does not solve every problem; there are always
      operating system differences to deal with.</p><p>æœ€åŽï¼Œæ‚¨å¯ä»¥æŽ¥å—ç³»ç»Ÿä¹‹é—´çš„å·®å¼‚ï¼Œå¹¶é€šè¿‡ä»”ç»†é€‰æ‹©å®å’Œå‡½æ•°æ¥è§£å†³è¿™äº›å·®å¼‚ã€‚æˆ‘ä¹Ÿå°†åœ¨æœ¬ç« ä¸­å±•ç¤ºè¿™ç§æ–¹æ³•ã€‚</p><p>Finally, you can accept differences between systems and work
      around them by careful choices of macros and functions. I'll show this
      approach in this chapter, too.</p><p>å› æ­¤ï¼Œé€šè¿‡æ˜Žæ™ºåœ°ä½¿ç”¨å˜é‡å’Œç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼Œå¹¶é€šè¿‡æœ€å¤§é™åº¦åœ°å‡å°‘å¤–æ¥åŠŸèƒ½çš„ä½¿ç”¨å¹¶ä¾èµ–æ ‡å‡†å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥æé«˜<em class="filename">makefile</em>çš„å¯ç§»æ¤æ€§ã€‚å¦‚å‰æ‰€è¿°ï¼Œä¸å­˜åœ¨å®Œç¾Žçš„å¯ç§»æ¤æ€§ï¼Œå› æ­¤æˆ‘ä»¬çš„å·¥ä½œæ˜¯å¹³è¡¡å·¥ä½œé‡ä¸Žå¯ç§»æ¤æ€§ã€‚ä½†åœ¨æˆ‘ä»¬æŽ¢è®¨å…·ä½“æŠ€æœ¯ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå›žé¡¾ä¸€ä¸‹å¯ç§»æ¤<em class="filename">makefile</em>çš„ä¸€äº›é—®é¢˜ã€‚</p><p>So, by judicious use of variables and user-defined functions, and
      by minimizing the use of exotic features and relying on standard tools,
      we can increase the portability of our <em class="filename">makefile</em>s. As noted previously, there is no
      such thing as perfect portability, so it is our job to balance effort
      versus portability. But before we explore specific techniques, let's
      review some of the issues of portable <em class="filename">makefile</em>s.</p><div class="sect1" title="å¯ç§»æ¤æ€§é—®é¢˜"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch07.html.make3-CHP-7-SECT-1"></a>å¯ç§»æ¤æ€§é—®é¢˜</h1><h1 class="title"><a></a>Portability Issues</h1></div></div></div><p>å¯ç§»æ¤æ€§é—®é¢˜å¯èƒ½å¾ˆéš¾æè¿°ï¼Œå› ä¸ºå®ƒä»¬æ¶µç›–äº†ä»Žæ€»ä½“èŒƒå¼è½¬å˜ï¼ˆä¾‹å¦‚ä¼ ç»Ÿ Mac OS ä¸Ž System V Unixï¼‰åˆ°å‡ ä¹Žå¾®ä¸è¶³é“çš„é”™è¯¯ä¿®å¤ï¼ˆä¾‹å¦‚ä¿®å¤ç¨‹åºé”™è¯¯é€€å‡ºçŠ¶æ€ä¸­çš„é”™è¯¯ï¼‰çš„æ•´ä¸ªèŒƒå›´ã€‚ ï¼‰ã€‚å°½ç®¡å¦‚æ­¤ï¼Œä»¥ä¸‹æ˜¯æ¯ä¸ª
        <em class="filename">makefile</em>è¿Ÿæ—©å¿…é¡»å¤„ç†çš„ä¸€äº›å¸¸è§çš„å¯ç§»æ¤æ€§é—®é¢˜ï¼š</p><p>Portability problems can be difficult to characterize since they
        span the entire spectrum from a total paradigm shift (such as
        traditional Mac OS versus System V Unix) to almost trivial bug fixes
        (such as a fix to a bug in the error exit status of a program).
        Nevertheless, here are some common portability problems that every
        <em class="filename">makefile</em> must deal with sooner or
        later:</p><div class="variablelist"><dl><dt><span class="term">ç¨‹åºåç§°</span></dt><dt><span class="term">Program names</span></dt><dd><p>è¿™æ˜¯å¾ˆå¸¸è§çš„<a id="OEBPS/ch07.html.make3-CHP-7-ITERM-1413" class="indexterm"></a> <a id="OEBPS/ch07.html.make3-CHP-7-ITERM-1414" class="indexterm"></a>ä¸åŒçš„å¹³å°å¯¹ç›¸åŒæˆ–ç›¸ä¼¼çš„ç¨‹åºä½¿ç”¨ä¸åŒçš„åç§°ã€‚æœ€å¸¸è§çš„æ˜¯ C æˆ– C++ ç¼–è¯‘å™¨çš„åç§°ï¼ˆä¾‹å¦‚<em class="command">cc</em>ã€
               <em class="command">xlc</em>ï¼‰ã€‚<acronym class="acronym">GNU</acronym>ç‰ˆæœ¬çš„ç¨‹åºé€šå¸¸
              å®‰è£…åœ¨å¸¦æœ‰
              <span class="emphasis"><em>g</em></span><acronym class="acronym">å‰ç¼€çš„éžGNU</acronym>ç³»ç»Ÿä¸Šï¼ˆä¾‹å¦‚<em class="command">gmake</em>ã€<em class="command">gawk</em>ï¼‰ã€‚<span class="emphasis"><em></em></span><em class="command"></em><em class="command"></em></p></dd><dd><p>It is quite common for <a class="indexterm"></a> <a class="indexterm"></a>various platforms to use different names for the
              same or similar programs. The most common is the name of the C
              or C++ compiler (e.g., <em class="command">cc</em>,
              <em class="command">xlc</em>). It is also common for
              <acronym class="acronym">GNU</acronym> versions of programs to be installed on a
              non-<acronym class="acronym">GNU</acronym> system with the
              <span class="emphasis"><em>g</em></span> prefix (e.g., <em class="command">gmake</em>, <em class="command">gawk</em>).</p></dd><dt><span class="term">è·¯å¾„</span></dt><dt><span class="term">Paths</span></dt><dd><p>ç¨‹åºçš„ä½ç½®å’Œ<a id="OEBPS/ch07.html.make3-CHP-7-ITERM-1415" class="indexterm"></a> <a id="OEBPS/ch07.html.make3-CHP-7-ITERM-1416" class="indexterm"></a>æ–‡ä»¶é€šå¸¸å› å¹³å°è€Œå¼‚ã€‚ä¾‹å¦‚ï¼Œåœ¨ Solaris ç³»ç»Ÿä¸Šï¼ŒX ç›®å½•å­˜å‚¨åœ¨
              <em class="filename">/usr/X</em>ä¸‹ï¼Œè€Œåœ¨è®¸å¤šå…¶ä»–ç³»ç»Ÿä¸Šï¼Œè·¯å¾„æ˜¯<em class="filename">/usr/X11R6</em>ã€‚æ­¤å¤–ï¼Œå½“æ‚¨ä»Žä¸€ä¸ªç³»ç»Ÿè½¬ç§»åˆ°å¦ä¸€ä¸ªç³»ç»Ÿæ—¶ï¼Œ <em class="filename">/bin</em>ã€
               <em class="filename">/usr/bin</em>ã€<em class="filename">/sbin</em>å’Œ<em class="filename">/usr/sbin</em>ä¹‹é—´çš„åŒºåˆ«é€šå¸¸ç›¸å½“æ¨¡ç³Šã€‚</p></dd><dd><p>The location of programs and <a class="indexterm"></a> <a class="indexterm"></a>files often varies between platforms. For
              instance, on Solaris systems the X directories are stored under
              <em class="filename">/usr/X</em> while on many other
              systems the path is <em class="filename">/usr/X11R6</em>. In addition, the
              distinction between <em class="filename">/bin</em>,
              <em class="filename">/usr/bin</em>, <em class="filename">/sbin</em>, and <em class="filename">/usr/sbin</em> is often rather fuzzy as
              you move from one system to another.</p></dd><dt><span class="term">é€‰é¡¹</span></dt><dt><span class="term">Options</span></dt><dd><p>å‘½ä»¤è¡Œ<a id="OEBPS/ch07.html.make3-CHP-7-ITERM-1417" class="indexterm"></a> <a id="OEBPS/ch07.html.make3-CHP-7-ITERM-1418" class="indexterm"></a>ç¨‹åºçš„é€‰é¡¹å„ä¸ç›¸åŒï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨æ›¿ä»£å®žçŽ°æ—¶ã€‚æ­¤å¤–ï¼Œå¦‚æžœå¹³å°ç¼ºå°‘å®žç”¨ç¨‹åºæˆ–ç‰ˆæœ¬æŸåï¼Œæ‚¨å¯èƒ½éœ€è¦å°†è¯¥å®žç”¨ç¨‹åºæ›¿æ¢ä¸ºä½¿ç”¨ä¸åŒå‘½ä»¤è¡Œé€‰é¡¹çš„å¦ä¸€ä¸ªå®žç”¨ç¨‹åºã€‚</p></dd><dd><p>The command-line <a class="indexterm"></a> <a class="indexterm"></a>options to programs vary, particularly when an
              alternate implementation is used. Furthermore, if a platform is
              missing a utility or comes with a broken version, you may need
              to replace the utility with another that uses different
              command-line options.</p></dd><dt><span class="term">å¤–å£³ç‰¹ç‚¹</span></dt><dt><span class="term">Shell features</span></dt><dd><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<em class="command">make</em>
              æ‰§è¡Œå‘½ä»¤è„šæœ¬<a id="OEBPS/ch07.html.make3-CHP-7-ITERM-1419" class="indexterm"></a> <a id="OEBPS/ch07.html.make3-CHP-7-ITERM-1420" class="indexterm"></a>ä¸Ž<em class="filename">/bin/sh</em>ï¼Œä½†<em class="command">sh</em>å®žçŽ°çš„åŠŸèƒ½å·®å¼‚å¾ˆå¤§ã€‚ç‰¹åˆ«æ˜¯ï¼ŒPOSIX ä¹‹å‰çš„ shell ç¼ºå°‘è®¸å¤šåŠŸèƒ½ï¼Œå¹¶ä¸”ä¸æŽ¥å—ä¸ŽçŽ°ä»£ shell ç›¸åŒçš„è¯­æ³•ã€‚</p><p>Open Group æœ‰ä¸€ä»½éžå¸¸æœ‰ç”¨çš„ç™½çš®ä¹¦ï¼Œä»‹ç»äº† System V shell å’Œ POSIX shell ä¹‹é—´çš„å·®å¼‚ã€‚å¯ä»¥åœ¨<a class="ulink" href="http://www.unix-systems.org/whitepapers/shdiffs.html">http://www.unix-systems.org/whitepapers/shdiffs.html</a>æ‰¾åˆ°å®ƒã€‚å¯¹äºŽé‚£äº›æƒ³è¦äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯çš„äººï¼Œå¯ä»¥åœ¨<a class="ulink" href="http://www.opengroup.org/onlinepubs/007904975/utilities/xcu_chap02.html">http://www.opengroup.org/onlinepubs/007904975/utilities/xcu_chap02.html</a>æ‰¾åˆ° POSIX shell å‘½ä»¤è¯­è¨€çš„è§„èŒƒã€‚</p></dd><dd><p>By default, <em class="command">make</em>
              executes command scripts <a class="indexterm"></a> <a class="indexterm"></a>with <em class="filename">/bin/sh</em>,
              but <em class="command">sh</em> implementations vary
              widely in their features. In particular, pre-POSIX shells are
              missing many features and will not accept the same syntax as a
              modern shell.</p><p>The Open Group has a very useful white paper on the
              differences between the System V shell and the POSIX shell. It
              can be found at <a class="ulink" href="http://www.unix-systems.org/whitepapers/shdiffs.html">http://www.unix-systems.org/whitepapers/shdiffs.html</a>.
              For those who want more details, the specification of the POSIX
              shell's command language can be found at <a class="ulink" href="http://www.opengroup.org/onlinepubs/007904975/utilities/xcu_chap02.html">http://www.opengroup.org/onlinepubs/007904975/utilities/xcu_chap02.html</a>.</p></dd><dt><span class="term">ç¨‹åºè¡Œä¸º</span></dt><dt><span class="term">Program behavior</span></dt><dd><p>ä¾¿æºå¼<em class="filename">makefile</em>å¿…é¡»ç«žäº‰<a id="OEBPS/ch07.html.make3-CHP-7-ITERM-1421" class="indexterm"></a> <a id="OEBPS/ch07.html.make3-CHP-7-ITERM-1422" class="indexterm"></a>ä¸Žè¡Œä¸ºä¸åŒçš„ç¨‹åºã€‚å½“ä¸åŒçš„ä¾›åº”å•†ä¿®å¤æˆ–æ’å…¥é”™è¯¯å¹¶æ·»åŠ åŠŸèƒ½æ—¶ï¼Œè¿™ç§æƒ…å†µå¾ˆå¸¸è§ã€‚è¿˜æœ‰ä¸€äº›å®žç”¨ç¨‹åºçš„å‡çº§ï¼Œè¿™äº›å‡çº§å¯èƒ½å·²åŒ…å«åœ¨ä¾›åº”å•†çš„ç‰ˆæœ¬ä¸­ï¼Œä¹Ÿå¯èƒ½æœªåŒ…å«åœ¨å…¶ä¸­ã€‚ä¾‹å¦‚ï¼Œ1987 å¹´<em class="command">awk</em>ç¨‹åºç»åŽ†äº†ä¸€æ¬¡é‡å¤§ä¿®æ”¹ã€‚è¿‘ 20 å¹´åŽï¼Œä¸€äº›ç³»ç»Ÿä»ç„¶æ²¡æœ‰å®‰è£…è¿™ä¸ªå‡çº§ç‰ˆæœ¬ä½œä¸ºæ ‡å‡†
              <em class="command">awk</em>ã€‚</p></dd><dd><p>Portable <em class="filename">makefile</em>s
              must contend<a class="indexterm"></a> <a class="indexterm"></a> with programs that simply behave differently.
              This is very common as different vendors fix or insert bugs and
              add features. There are also upgrades to utilities that may or
              may not have made it into a vendor's release. For instance, in
              1987 the <em class="command">awk</em> program
              underwent a major revision. Nearly 20 years later, some systems
              still do not install this upgraded version as the standard
              <em class="command">awk</em>.</p></dd><dt><span class="term">æ“ä½œç³»ç»Ÿ</span></dt><dt><span class="term">Operating system</span></dt><dd><p>æœ€åŽï¼Œè¿˜å­˜åœ¨ä¸Žå®Œå…¨ä¸åŒçš„æ“ä½œç³»ç»Ÿç›¸å…³çš„å¯ç§»æ¤æ€§é—®é¢˜ï¼Œä¾‹å¦‚ Windows ä¸Ž Unix æˆ– Linux ä¸Ž VMSã€‚</p></dd><dd><p>Finally, there are the portability problems associated
              with a completely different operating system such as Windows
              versus Unix or Linux versus VMS.</p></dd></dl></div></div></div></div></div>
<div id="OEBPS/ch07s02.html"><div>
<div class="sect1" title="è¥¿æ ¼æ¸©"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch07s02.html.make3-CHP-7-SECT-2"></a>è¥¿æ ¼æ¸©</h1><h1 class="title"><a></a>Cygwin</h1></div></div></div><p>è™½ç„¶æœ‰ä¸€ä¸ª<a id="OEBPS/ch07s02.html.make3-CHP-7-ITERM-1423" class="indexterm"></a> <a id="OEBPS/ch07s02.html.make3-CHP-7-ITERM-1424" class="indexterm"></a><em class="command">make</em>çš„æœ¬æœº Win32 ç«¯å£ï¼Œè¿™æ˜¯ Windows å¯ç§»æ¤æ€§é—®é¢˜çš„ä¸€å°éƒ¨åˆ†ï¼Œå› ä¸ºè¯¥æœ¬æœºç«¯å£ä½¿ç”¨çš„ shell æ˜¯
        <span class="emphasis"><em>cmd.exe</em></span>ï¼ˆæˆ–<span class="emphasis"><em>command.exe</em></span>ï¼‰ã€‚å†åŠ ä¸Šå¤§å¤šæ•° Unix å·¥å…·çš„ç¼ºä¹ï¼Œä½¿å¾—è·¨å¹³å°å¯ç§»æ¤æ€§æˆä¸ºä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚å¹¸è¿çš„æ˜¯ï¼ŒCygwin é¡¹ç›® ( <a class="ulink" href="http://www.cygwin.com/">http://www.cygwin.com</a> ) å·²ç»ä¸º Windows æž„å»ºäº†ä¸€ä¸ªä¸Ž Linux å…¼å®¹çš„åº“ï¼Œè®¸å¤šç¨‹åº<sup>[ <a id="OEBPS/ch07s02.html.make3-CHP-7-FNOTE-1" href="#OEBPS/ch07s02.html.ftn.make3-CHP-7-FNOTE-1" class="footnote">1</a> ]</sup>å·²ç§»æ¤åˆ°å…¶ä¸­ã€‚å¯¹äºŽæƒ³è¦ Linux å…¼å®¹æ€§æˆ–è®¿é—® GNU å·¥å…·çš„ Windows å¼€å‘äººå‘˜æ¥è¯´ï¼Œæˆ‘ä¸è®¤ä¸ºæœ‰æ›´å¥½çš„å·¥å…·å¯ä»¥æ‰¾åˆ°ã€‚</p><p>Although there is a <a class="indexterm"></a> <a class="indexterm"></a>native Win32 port of <em class="command">make</em>, this is a small part of the Windows
        portability problem, because the shell this native port uses is
        <span class="emphasis"><em>cmd.exe</em></span> (or <span class="emphasis"><em>command.exe</em></span>).
        This, along with the absence of most of the Unix tools, makes
        cross-platform portability a daunting task. Fortunately, the Cygwin
        project (<a class="ulink" href="http://www.cygwin.com">http://www.cygwin.com</a>) has built a
        Linux-compatible library for Windows to which many programs<sup>[<a href="#OEBPS/ch07s02.html.ftn.make3-CHP-7-FNOTE-1" class="footnote">1</a>]</sup> have been ported. For Windows developers who want Linux
        compatibility or access to GNU tools, I don't believe there is a
        better tool to be found.</p><p>æˆ‘åœ¨å„ç§é¡¹ç›®ä¸­ä½¿ç”¨ Cygwin å·²è¶…è¿‡ 10 å¹´ï¼Œä»Žç»„åˆçš„ C++/Lisp CAD åº”ç”¨ç¨‹åºåˆ°çº¯ Java å·¥ä½œæµç®¡ç†ç³»ç»Ÿã€‚ Cygwin å·¥å…·é›†åŒ…æ‹¬è®¸å¤šç¼–ç¨‹è¯­è¨€çš„ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨ã€‚ç„¶è€Œï¼Œå³ä½¿åº”ç”¨ç¨‹åºæœ¬èº«æ˜¯ä½¿ç”¨éž Cygwin ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨å®žçŽ°çš„ï¼ŒCygwin ä¹Ÿå¯ä»¥æœ‰åˆ©å¯å›¾ã€‚ Cygwin å·¥å…·é›†åªèƒ½ç”¨ä½œåè°ƒå¼€å‘å’Œæž„å»ºè¿‡ç¨‹çš„è¾…åŠ©å·¥å…·ã€‚æ¢å¥è¯è¯´ï¼Œæ— éœ€ç¼–å†™â€œCygwinâ€åº”ç”¨ç¨‹åºæˆ–ä½¿ç”¨ Cygwin è¯­è¨€å·¥å…·å³å¯èŽ·å¾— Cygwin çŽ¯å¢ƒçš„å¥½å¤„ã€‚</p><p>I have used Cygwin for over 10 years on a variety of projects
        from a combined C++/Lisp CAD application to a pure Java workflow
        management system. The Cygwin tool set includes compilers and
        interpreters for many programming languages. However, Cygwin can be
        used profitably even when the applications themselves are implemented
        using non-Cygwin compilers and interpreters. The Cygwin tool set can
        be used solely as an aid to coordinating the development and build
        process. In other words, it is not necessary to write a "Cygwin"
        application or use Cygwin language tools to reap the benefits of the
        Cygwin environment.</p><p>ç„¶è€Œï¼ŒLinux ä¸æ˜¯ Windowsï¼ˆè°¢å¤©è°¢åœ°ï¼ï¼‰ï¼Œå°† Cygwin å·¥å…·åº”ç”¨äºŽæœ¬æœº Windows åº”ç”¨ç¨‹åºæ—¶ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚å‡ ä¹Žæ‰€æœ‰è¿™äº›é—®é¢˜éƒ½ä¸Žæ–‡ä»¶ä¸­ä½¿ç”¨çš„è¡Œç»“å°¾ä»¥åŠ Cygwin å’Œ Windows ä¹‹é—´ä¼ é€’çš„è·¯å¾„å½¢å¼æœ‰å…³ã€‚</p><p>Nevertheless, Linux is not Windows (thank goodness!) and there
        are issues involved when applying Cygwin tools to native Windows
        applications. Almost all of these issues revolve around the line
        endings used in files and the form of paths passed between Cygwin and
        Windows.</p><div class="sect2" title="çº¿è·¯ç»ˆç«¯"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch07s02.html.make3-CHP-7-SECT-2.1"></a>çº¿è·¯ç»ˆç«¯</h2><h2 class="title"><a></a>Line Termination</h2></div></div></div><p>Windows æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨<a id="OEBPS/ch07s02.html.make3-CHP-7-ITERM-1425" class="indexterm"></a> <a id="OEBPS/ch07s02.html.make3-CHP-7-ITERM-1426" class="indexterm"></a>ä¸¤ä¸ªå­—ç¬¦åºåˆ—å›žè½¦ç¬¦åŽè·Ÿæ¢è¡Œç¬¦ï¼ˆæˆ– CRLFï¼‰ä»¥ç»ˆæ­¢æ–‡æœ¬æ–‡ä»¶çš„æ¯ä¸€è¡Œã€‚ POSIX ç³»ç»Ÿä½¿ç”¨å•ä¸ªå­—ç¬¦ï¼Œæ¢è¡Œç¬¦ï¼ˆLF æˆ–
          <em class="firstterm">æ¢è¡Œç¬¦</em>ï¼‰ã€‚æœ‰æ—¶ï¼Œå½“ç¨‹åºæŠ¥å‘Šè¯­æ³•é”™è¯¯æˆ–å¯»æ‰¾æ•°æ®æ–‡ä»¶ä¸­çš„é”™è¯¯ä½ç½®æ—¶ï¼Œè¿™ç§å·®å¼‚å¯èƒ½ä¼šå¯¼è‡´ç²—å¿ƒçš„ä¸€äº›æ··ä¹±ã€‚ç„¶è€Œï¼ŒCygwin åº“åœ¨è§£å†³è¿™äº›é—®é¢˜æ–¹é¢åšå¾—éžå¸¸å¥½ã€‚å®‰è£… Cygwin æ—¶ï¼ˆæˆ–è€…ä½¿ç”¨<em class="command">mount</em>å‘½ä»¤æ—¶ï¼‰ï¼Œæ‚¨å¯ä»¥é€‰æ‹© Cygwin æ˜¯å¦åº”è¯¥ç¿»è¯‘ä»¥ CRLF ç»“å°¾çš„æ–‡ä»¶ã€‚å¦‚æžœé€‰æ‹© DOS æ–‡ä»¶æ ¼å¼ï¼ŒCygwin å°†åœ¨è¯»å–æ–‡æœ¬æ–‡ä»¶æ—¶å°† CRLF è½¬æ¢ä¸º LFï¼Œåœ¨å†™å…¥æ–‡æœ¬æ–‡ä»¶æ—¶å°†å…¶åå‘è½¬æ¢ï¼Œä»¥ä¾¿åŸºäºŽ Unix çš„ç¨‹åºå¯ä»¥æ­£ç¡®å¤„ç† DOS æ–‡æœ¬æ–‡ä»¶ã€‚å¦‚æžœæ‚¨è®¡åˆ’ä½¿ç”¨æœ¬æœºè¯­è¨€å·¥å…·ï¼ˆä¾‹å¦‚ Visual C++ æˆ– Sun çš„ Java SDKï¼‰ï¼Œè¯·é€‰æ‹© DOS æ–‡ä»¶æ ¼å¼ã€‚å¦‚æžœæ‚¨è¦ä½¿ç”¨ Cygwin ç¼–è¯‘å™¨ï¼Œè¯·é€‰æ‹© Unixã€‚ ï¼ˆæ‚¨çš„é€‰æ‹©å¯ä»¥éšæ—¶æ›´æ”¹ã€‚ï¼‰</p><p>Windows filesystems use a <a class="indexterm"></a> <a class="indexterm"></a>two-character sequence carriage return followed by
          line feed (or CRLF) to terminate each line of a text file. POSIX
          systems use a single character, a line feed (LF or
          <em class="firstterm">newline</em>). Occasionally this difference can
          cause the unwary some confusion as programs report syntax errors or
          seek to the wrong location in a data file. However, the Cygwin
          library does a very good job of working through these issues. When
          Cygwin is installed (or alternatively when the <em class="command">mount</em> command is used), you can choose
          whether Cygwin should translate files with CRLF endings. If a DOS
          file format is selected, Cygwin will translate CRLF to LF when
          reading and the reverse when writing text files so that Unix-based
          programs can properly handle DOS text files. If you plan to use
          native language tools such as Visual C++ or Sun's Java SDK, choose
          the DOS file format. If you are going to use Cygwin compilers,
          choose Unix. (Your choice can be changed at any time.)</p><p>æ­¤å¤–ï¼ŒCygwin è¿˜é™„å¸¦äº†æ˜¾å¼ç¿»è¯‘æ–‡ä»¶çš„å·¥å…·ã€‚å¦‚æœ‰å¿…è¦ï¼Œå®žç”¨ç¨‹åº<em class="command">dos2unix</em>å’Œ<em class="command">unix2dos</em>ä¼šè½¬æ¢æ–‡ä»¶çš„è¡Œç»“å°¾ã€‚</p><p>In addition, Cygwin comes with tools to translate files
          explicitly. The utilities <em class="command">dos2unix</em> and <em class="command">unix2dos</em> transform the line endings of a
          file, if necessary.</p></div><div class="sect2" title="æ–‡ä»¶ç³»ç»Ÿ"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch07s02.html.make3-CHP-7-SECT-2.2"></a>æ–‡ä»¶ç³»ç»Ÿ</h2><h2 class="title"><a></a>Filesystem</h2></div></div></div><p>Cygwin æä¾› POSIX è§†å›¾<a id="OEBPS/ch07s02.html.make3-CHP-7-ITERM-1427" class="indexterm"></a> <a id="OEBPS/ch07s02.html.make3-CHP-7-ITERM-1428" class="indexterm"></a>Windows æ–‡ä»¶ç³»ç»Ÿçš„ã€‚ POSIX æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•æ˜¯<em class="filename">/</em>ï¼Œå®ƒæ˜ å°„åˆ° Cygwin çš„å®‰è£…ç›®å½•ã€‚ Windows é©±åŠ¨å™¨å¯é€šè¿‡ä¼ªç›®å½•<em class="filename">/cygdrive/</em>
          <em class="replaceable"><code>letter</code></em>è®¿é—®ã€‚å› æ­¤ï¼Œå¦‚æžœ Cygwin å®‰è£…åœ¨
          <em class="filename">C:\usr\cygwin ï¼ˆæˆ‘çš„é¦–é€‰ä½ç½®ï¼‰ä¸­ï¼Œ</em><a class="link" href="#OEBPS/ch07s02.html.make3-CHP-7-TABLE-1" title="è¡¨ 7-1ã€‚é»˜è®¤ Cygwin ç›®å½•æ˜ å°„">åˆ™è¡¨ 7-1</a>ä¸­æ‰€ç¤ºçš„ç›®å½•æ˜ å°„å°†ä¿ç•™ã€‚</p><p>Cygwin provides a POSIX view <a class="indexterm"></a> <a class="indexterm"></a>of the Windows filesystem. The root directory of a
          POSIX filesystem is <em class="filename">/</em>, which
          maps to the directory in which Cygwin is installed. Windows drives
          are accessible through the pseudo-directory <em class="filename">/cygdrive/</em>
          <em class="replaceable"><code>letter</code></em>. So, if Cygwin is installed in
          <em class="filename">C:\usr\cygwin</em> (my preferred
          location), the directory mappings shown in <a class="link" href="#OEBPS/ch07s02.html.make3-CHP-7-TABLE-1" title="Table&nbsp;7-1.&nbsp;Default Cygwin directory mapping">Table 7-1</a> would hold.</p><div class="table"><a id="OEBPS/ch07s02.html.make3-CHP-7-TABLE-1"></a><p class="title">è¡¨ 7-1ã€‚é»˜è®¤ Cygwin ç›®å½•æ˜ å°„</p><p class="title">Table&nbsp;7-1.&nbsp;Default Cygwin directory mapping</p><div class="table-contents"><table summary="Default Cygwin directory mapping" style="border-collapse:collapse;border-top:0.5pt solid;border-bottom:0.5pt solid;border-left:0.5pt solid;border-right:0.5pt solid"><colgroup><col><col><col></colgroup><thead><tr><th style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>æœ¬æœº Windows è·¯å¾„</p><p>Native Windows path</p></th><th style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>CYGWINè·¯å¾„</p><p>Cygwin path</p></th><th style="border-bottom:0.5pt solid"><p>å¤‡ç”¨ Cygwin è·¯å¾„</p><p>Alternate Cygwin path</p></th></tr></thead><tbody><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <span class="emphasis"><em>c:\usr\cygwin</em></span>
                  </p><p> <span class="emphasis"><em>c:\usr\cygwin</em></span>
                  </p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <span class="emphasis"><em>/</em></span> </p><p> <span class="emphasis"><em>/</em></span> </p></td><td style="border-bottom:0.5pt solid"><p> <span class="emphasis"><em>/cygdrive/c/usr/cygwin</em></span>
                  </p><p> <span class="emphasis"><em>/cygdrive/c/usr/cygwin</em></span>
                  </p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <span class="emphasis"><em>c:\ç¨‹åºæ–‡ä»¶</em></span>
                  </p><p> <span class="emphasis"><em>c:\Program Files</em></span>
                  </p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <span class="emphasis"><em>/cygdrive/c/ç¨‹åºæ–‡ä»¶</em></span>
                  </p><p> <span class="emphasis"><em>/cygdrive/c/Program Files</em></span>
                  </p></td><td style="border-bottom:0.5pt solid">&nbsp;</td></tr><tr><td style="border-right:0.5pt solid"><p> <span class="emphasis"><em>c:\usr\cygwin\bin</em></span>
                  </p><p> <span class="emphasis"><em>c:\usr\cygwin\bin</em></span>
                  </p></td><td style="border-right:0.5pt solid"><p> <span class="emphasis"><em>/åžƒåœ¾æ¡¶</em></span> </p><p> <span class="emphasis"><em>/bin</em></span> </p></td><td style=""><p>
                  <span class="emphasis"><em>/cygdrive/c/usr/cygwin/bin</em></span>
                  </p><p>
                  <span class="emphasis"><em>/cygdrive/c/usr/cygwin/bin</em></span>
                  </p></td></tr></tbody></table></div></div><p>ä¸€å¼€å§‹è¿™å¯èƒ½æœ‰ç‚¹ä»¤äººå›°æƒ‘ï¼Œä½†ä¸ä¼šç»™å·¥å…·å¸¦æ¥ä»»ä½•é—®é¢˜ã€‚ Cygwinè¿˜åŒ…å«ä¸€ä¸ª<em class="command">mount</em>å‘½ä»¤ï¼Œå¯ä»¥è®©ç”¨æˆ·æ›´æ–¹ä¾¿åœ°è®¿é—®æ–‡ä»¶å’Œç›®å½•ã€‚<em class="command">mount</em>ã€
           ã€çš„ä¸€ä¸ªé€‰é¡¹<code class="option">â€”change-cygdrive-prefix</code>å…è®¸æ‚¨æ›´æ”¹å‰ç¼€ã€‚æˆ‘å‘çŽ°å°†å‰ç¼€æ›´æ”¹ä¸ºç®€å•çš„<em class="filename">/</em>ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå¯ä»¥æ›´è‡ªç„¶åœ°è®¿é—®é©±åŠ¨å™¨å·ï¼š</p><p>This can be a little confusing at first, but doesn't pose any
          problems to tools. Cygwin also includes a <em class="command">mount</em> command that allows users to access
          files and directories more conveniently. One option to <em class="command">mount</em>,
          <code class="option">â€”change-cygdrive-prefix</code>, allows you to change the
          prefix. I find that changing the prefix to simply <em class="filename">/</em> is particularly useful because drive
          letters can be accessed more naturally:</p><a id="OEBPS/ch07s02.html.I_2_tt340"></a><pre class="programlisting">$ mount --change-cygdrive-prefix /
$ ls /c
AUTOEXEC.BAT ä¸»ç¨‹åºæ–‡ä»¶ hp
BOOT.INI I386 å›žæ”¶å™¨ ntldr
CD IO.SYS ç³»ç»Ÿå·ä¿¡æ¯ pagefile.sys
CONFIG.SYS MSDOS.SYS ä¸´æ—¶ tmp
C_DILLA NTDETECT.COM WINDOWS ç”¨æˆ·
æ–‡æ¡£å’Œè®¾ç½® PERSIST WUTemp å·¥ä½œ</pre><pre class="programlisting">$ mount --change-cygdrive-prefix /
$ ls /c
AUTOEXEC.BAT            Home          Program Files              hp
BOOT.INI                I386          RECYCLER                   ntldr
CD                      IO.SYS        System Volume Information  pagefile.sys
CONFIG.SYS              MSDOS.SYS     Temp                       tmp
C_DILLA                 NTDETECT.COM  WINDOWS                    usr
Documents and Settings  PERSIST       WUTemp                     work</pre><p>ä¸€æ—¦è¿›è¡Œæ­¤æ›´æ”¹ï¼Œæˆ‘ä»¬ä¹‹å‰çš„ç›®å½•æ˜ å°„å°†æ›´æ”¹ä¸º<a class="link" href="#OEBPS/ch07s02.html.make3-CHP-7-TABLE-2" title="è¡¨ 7-2ã€‚ä¿®æ”¹Cygwinç›®å½•æ˜ å°„">è¡¨ 7-2</a>ä¸­æ‰€ç¤ºçš„å†…å®¹ã€‚</p><p>Once this change is made, our previous directory mapping would
          change to those shown in <a class="link" href="#OEBPS/ch07s02.html.make3-CHP-7-TABLE-2" title="Table&nbsp;7-2.&nbsp;Modified Cygwin directory mapping">Table
          7-2</a>.</p><div class="table"><a id="OEBPS/ch07s02.html.make3-CHP-7-TABLE-2"></a><p class="title">è¡¨ 7-2ã€‚ä¿®æ”¹Cygwinç›®å½•æ˜ å°„</p><p class="title">Table&nbsp;7-2.&nbsp;Modified Cygwin directory mapping</p><div class="table-contents"><table summary="Modified Cygwin directory mapping" style="border-collapse:collapse;border-top:0.5pt solid;border-bottom:0.5pt solid;border-left:0.5pt solid;border-right:0.5pt solid"><colgroup><col><col><col></colgroup><thead><tr><th style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>æœ¬æœº Windows è·¯å¾„</p><p>Native Windows path</p></th><th style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>CYGWINè·¯å¾„</p><p>Cygwin path</p></th><th style="border-bottom:0.5pt solid"><p>å¤‡ç”¨ Cygwin è·¯å¾„</p><p>Alternate Cygwin path</p></th></tr></thead><tbody><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <span class="emphasis"><em>c:\usr\cygwin</em></span>
                  </p><p> <span class="emphasis"><em>c:\usr\cygwin</em></span>
                  </p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <span class="emphasis"><em>/</em></span> </p><p> <span class="emphasis"><em>/</em></span> </p></td><td style="border-bottom:0.5pt solid"><p> <span class="emphasis"><em>/c/usr/cygwin</em></span>
                  </p><p> <span class="emphasis"><em>/c/usr/cygwin</em></span>
                  </p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <span class="emphasis"><em>c:\ç¨‹åºæ–‡ä»¶</em></span>
                  </p><p> <span class="emphasis"><em>c:\Program Files</em></span>
                  </p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <span class="emphasis"><em>/c/ç¨‹åºæ–‡ä»¶</em></span>
                  </p><p> <span class="emphasis"><em>/c/Program Files</em></span>
                  </p></td><td style="border-bottom:0.5pt solid">&nbsp;</td></tr><tr><td style="border-right:0.5pt solid"><p> <span class="emphasis"><em>c:\usr\cygwin\bin</em></span>
                  </p><p> <span class="emphasis"><em>c:\usr\cygwin\bin</em></span>
                  </p></td><td style="border-right:0.5pt solid"><p> <span class="emphasis"><em>/åžƒåœ¾æ¡¶</em></span> </p><p> <span class="emphasis"><em>/bin</em></span> </p></td><td style=""><p> <span class="emphasis"><em>/c/usr/cygwin/bin</em></span>
                  </p><p> <span class="emphasis"><em>/c/usr/cygwin/bin</em></span>
                  </p></td></tr></tbody></table></div></div><p>å¦‚æžœéœ€è¦å°†æ–‡ä»¶åä¼ é€’ç»™ Windows ç¨‹åºï¼ˆä¾‹å¦‚ Visual C++ ç¼–è¯‘å™¨ï¼‰ï¼Œé€šå¸¸åªéœ€ä½¿ç”¨ POSIX æ ·å¼çš„æ­£æ–œæ ä¼ é€’æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„å³å¯ã€‚ Win32 API ä¸åŒºåˆ†æ­£æ–œæ å’Œåæ–œæ ã€‚ä¸å¹¸çš„æ˜¯ï¼Œä¸€äº›æ‰§è¡Œè‡ªå·±çš„å‘½ä»¤è¡Œå‚æ•°è§£æžçš„å®žç”¨ç¨‹åºå°†æ‰€æœ‰æ­£æ–œæ è§†ä¸ºå‘½ä»¤é€‰é¡¹ã€‚ DOS<em class="command">æ‰“å°</em>å‘½ä»¤å°±æ˜¯è¿™æ ·çš„å®žç”¨ç¨‹åºä¹‹ä¸€ã€‚å¦ä¸€ä¸ªæ˜¯<em class="command">net</em>å‘½ä»¤ã€‚</p><p>If you need to pass a filename to a Windows program, such as
          the Visual C++ compiler, you can usually just pass the relative path
          to the file using POSIX-style forward slashes. The Win32 API does
          not distinguish between forward and backward slashes. Unfortunately,
          some utilities that perform their own command-line argument parsing
          treat all forward slashes as command options. One such utility is
          the DOS <em class="command">print</em> command; another is
          the <em class="command">net</em> command.</p><p>å¦‚æžœä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œé©±åŠ¨å™¨ç›˜ç¬¦è¯­æ³•å§‹ç»ˆæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚å°½ç®¡ Windows ç¨‹åºé€šå¸¸å–œæ¬¢ä½¿ç”¨æ­£æ–œæ ï¼Œä½†å®ƒä»¬å®Œå…¨æ— æ³•ç†è§£<em class="filename">/c</em>è¯­æ³•ã€‚é©±åŠ¨å™¨å·å¿…é¡»å§‹ç»ˆè½¬æ¢å›ž<em class="filename">c:</em>ã€‚ä¸ºäº†å®Œæˆæ­¤æ“ä½œä»¥åŠæ­£æ–œæ /åæ–œæ è½¬æ¢ï¼ŒCygwin æä¾›äº†<em class="command">cygpath</em>å®žç”¨ç¨‹åºæ¥åœ¨ POSIX è·¯å¾„å’Œ Windows è·¯å¾„ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</p><p>If absolute paths are used, the drive letter syntax is always
          a problem. Although Windows programs are usually happy with forward
          slashes, they are completely unable to fathom the <em class="filename">/c</em> syntax. The drive letter must always
          be tranformed back into <em class="filename">c:</em>. To
          accomplish this and the forward/backslash conversion, Cygwin
          provides the <em class="command">cygpath</em> utility to
          translate between POSIX paths and Windows paths.</p><a id="OEBPS/ch07s02.html.I_2_tt341"></a><pre class="programlisting">$<strong class="userinput"><code>cygpath --windows /c/work/src/lib/foo.c</code></strong>
c:\work\src\lib\foo.c
$<strong class="userinput"><code>cygpath --mixed /c/work/src/lib/foo.c</code></strong>
c:/work/src/lib/foo.c
$ <strong class="userinput"><code>cygpath --mixed --path "/c/work/src:/c/work/include"</code></strong>
c:/work/src;c:/work/include</pre><pre class="programlisting">$<strong class="userinput"><code>cygpath --windows /c/work/src/lib/foo.c</code></strong>
c:\work\src\lib\foo.c
$ <strong class="userinput"><code>cygpath --mixed /c/work/src/lib/foo.c</code></strong>
c:/work/src/lib/foo.c
$ <strong class="userinput"><code>cygpath --mixed --path "/c/work/src:/c/work/include"</code></strong>
c:/work/src;c:/work/include</pre><p>è¯¥<code class="option">â€”windows</code>é€‰é¡¹å°†å‘½ä»¤è¡Œä¸Šç»™å‡ºçš„ POSIX è·¯å¾„è½¬æ¢ä¸º â€‹â€‹Windows è·¯å¾„ï¼ˆæˆ–è€…ä½¿ç”¨é€‚å½“çš„å‚æ•°åä¹‹äº¦ç„¶ï¼‰ã€‚æˆ‘æ›´å–œæ¬¢ä½¿ç”¨<code class="option">â€”mixed</code>
          ç”Ÿæˆ Windows è·¯å¾„çš„é€‰é¡¹ï¼Œä½†ä½¿ç”¨æ­£æ–œæ è€Œä¸æ˜¯åæ–œæ ï¼ˆå½“ Windows å®žç”¨ç¨‹åºæŽ¥å—å®ƒæ—¶ï¼‰ã€‚è¿™åœ¨ Cygwin shell ä¸­æ•ˆæžœæ›´å¥½ï¼Œå› ä¸ºåæ–œæ æ˜¯è½¬ä¹‰å­—ç¬¦ã€‚<em class="command">cygpath</em>å®žç”¨
          ç¨‹åºæœ‰è®¸å¤šé€‰é¡¹ï¼Œå…¶ä¸­ä¸€äº›é€‰é¡¹æä¾›å¯¹é‡è¦ Windows è·¯å¾„çš„å¯ç§»æ¤è®¿é—®ï¼š</p><p>The <code class="option">â€”windows</code> option translates the POSIX path
          given on the command line into a Windows path (or vice versa with
          the proper argument). I prefer to use the <code class="option">â€”mixed</code>
          option that produces a Windows path, but with forward slashes
          instead of backslashes (when the Windows utility accepts it). This
          plays much better with the Cygwin shell because the backslash is the
          escape character. The <em class="command">cygpath</em>
          utility has many options, some of which provide portable access to
          important Windows paths:</p><a id="OEBPS/ch07s02.html.I_2_tt342"></a><pre class="programlisting">$<strong class="userinput"><code>cygpath --desktop</code></strong>
/c/æ–‡æ¡£å’Œè®¾ç½®/æ‰€æœ‰è€…/æ¡Œé¢
$<strong class="userinput"><code>cygpath --homeroot</code></strong>
/c/æ–‡æ¡£å’Œè®¾ç½®
$<strong class="userinput"><code>cygpath --smprograms</code></strong>
/c/æ–‡æ¡£å’Œè®¾ç½®/æ‰€æœ‰è€…/å¼€å§‹èœå•/ç¨‹åº
$<strong class="userinput"><code>cygpath --sysdir</code></strong>
/c/WINDOWS/SYSTEM32
$ <strong class="userinput"><code>cygpath --windir</code></strong>
/c/WINDOWS</pre><pre class="programlisting">$<strong class="userinput"><code>cygpath --desktop</code></strong>
/c/Documents and Settings/Owner/Desktop
$ <strong class="userinput"><code>cygpath --homeroot</code></strong>
/c/Documents and Settings
$ <strong class="userinput"><code>cygpath --smprograms</code></strong>
/c/Documents and Settings/Owner/Start Menu/Programs
$ <strong class="userinput"><code>cygpath --sysdir</code></strong>
/c/WINDOWS/SYSTEM32
$ <strong class="userinput"><code>cygpath --windir</code></strong>
/c/WINDOWS</pre><p>å¦‚æžœæ‚¨åœ¨æ··åˆ Windows/Unix çŽ¯å¢ƒä¸­ä½¿ç”¨<em class="command">cygpath</em>ï¼Œåˆ™éœ€è¦å°†è¿™äº›è°ƒç”¨åŒ…è£…åœ¨å¯ç§»æ¤å‡½æ•°ä¸­ï¼š</p><p>If you're using <em class="command">cygpath</em> in
          a mixed Windows/Unix environment, you'll want to wrap these calls in
          a portable function:</p><a id="OEBPS/ch07s02.html.I_2_tt343"></a><pre class="programlisting">ifdef è®¡ç®—æœºè§„èŒƒ
  cygpath-æ··åˆ = $(shell cygpath -m "$1")
  cygpath-unix = $(shell cygpath -u "$1")
  é©±åŠ¨å™¨å­—æ¯åˆ°æ–œæ  = /$(subst :,,$1)
åˆ«çš„
  cygpath æ··åˆ = $1
  cygpath-unix = $1
  é©±åŠ¨å™¨å·åˆ°æ–œæ  = $1
ä¸‡ä¸€</pre><pre class="programlisting">ifdef COMSPEC
  cygpath-mixed         = $(shell cygpath -m "$1")
  cygpath-unix          = $(shell cygpath -u "$1")
  drive-letter-to-slash = /$(subst :,,$1)
else
  cygpath-mixed         = $1
  cygpath-unix          = $1
  drive-letter-to-slash = $1
endif</pre><p>å¦‚æžœæ‚¨éœ€è¦åšçš„åªæ˜¯å°†<em class="filename">c:</em>é©±åŠ¨å™¨ç›˜ç¬¦è¯­æ³•æ˜ å°„åˆ° POSIX å½¢å¼ï¼Œåˆ™è¯¥<code class="function">drive-letter-to-slash</code>
          å‡½æ•°æ¯”è¿è¡Œ<em class="command">cygpath</em>ç¨‹åºæ›´å¿«ã€‚</p><p>If all you need to do is map the <em class="filename">c:</em> drive letter syntax to the POSIX form,
          the <code class="function">drive-letter-to-slash</code>
          function is faster than running the <em class="command">cygpath</em> program.</p><p>æœ€åŽï¼ŒCygwin æ— æ³•éšè— Windows çš„æ‰€æœ‰æ€ªç™–ã€‚åœ¨ Windows ä¸­æ— æ•ˆçš„æ–‡ä»¶ååœ¨ Cygwin ä¸­ä¹Ÿæ— æ•ˆã€‚å› æ­¤ï¼Œè¯¸å¦‚<em class="filename">aux.h</em>ã€
           <em class="filename">com1</em>å’Œ<em class="filename">prn</em>ä¹‹ç±»çš„åç§°ä¸èƒ½åœ¨ POSIX è·¯å¾„ä¸­ä½¿ç”¨ï¼Œå³ä½¿å¸¦æœ‰æ‰©å±•åä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>Finally, Cygwin cannot hide all the quirks of Windows.
          Filenames that are invalid in Windows are also invalid in Cygwin.
          Thus, names such as <em class="filename">aux.h</em>,
          <em class="filename">com1</em>, and <em class="filename">prn</em> cannot be used in a POSIX path, even
          with an extension.</p></div><div class="sect2" title="ç¨‹åºå†²çª"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch07s02.html.make3-CHP-7-SECT-2.3"></a>ç¨‹åºå†²çª</h2><h2 class="title"><a></a>Program Conflicts</h2></div></div></div><p>ä¸€äº› Windows ç¨‹åºæœ‰<a id="OEBPS/ch07s02.html.make3-CHP-7-ITERM-1429" class="indexterm"></a>ä¸Ž Unix ç¨‹åºåŒåã€‚å½“ç„¶ï¼ŒWindows ç¨‹åºä¸æŽ¥å—ä¸Ž Unix ç¨‹åºç›¸åŒçš„å‘½ä»¤è¡Œå‚æ•°æˆ–ä»¥å…¼å®¹çš„æ–¹å¼è¿è¡Œã€‚å¦‚æžœæ‚¨ä¸å°å¿ƒè°ƒç”¨äº† Windows ç‰ˆæœ¬ï¼Œé€šå¸¸ä¼šå¯¼è‡´ä¸¥é‡æ··ä¹±ã€‚æœ€éº»çƒ¦çš„ä¼¼ä¹Žæ˜¯<em class="command">find</em>ã€<em class="command">sort</em>ã€<em class="command">ftp</em>å’Œ<em class="command">telnet</em>ã€‚ä¸ºäº†èŽ·å¾—æœ€å¤§çš„å¯ç§»æ¤æ€§ï¼Œåœ¨ Unixã€Windows å’Œ Cygwin ä¹‹é—´ç§»æ¤æ—¶ï¼Œæ‚¨åº”è¯¥ç¡®ä¿æä¾›è¿™äº›ç¨‹åºçš„å®Œæ•´è·¯å¾„ã€‚</p><p>Several Windows programs have <a class="indexterm"></a>the same names as Unix programs. Of course, the
          Windows programs do not accept the same command-line arguments or
          behave in compatible ways with the Unix programs. If you
          accidentally invoke the Windows versions, the usual result is
          serious confusion. The most troublesome ones seem to be <em class="command">find</em>, <em class="command">sort</em>, <em class="command">ftp</em>, and <em class="command">telnet</em>. For maximum portability, you
          should be sure to provide full paths to these programs when porting
          between Unix, Windows, and Cygwin.</p><p>å¦‚æžœæ‚¨å¯¹ Cygwin çš„æ‰¿è¯ºåšå®šï¼Œå¹¶ä¸”ä¸éœ€è¦ä½¿ç”¨æœ¬æœº Windows æ”¯æŒå·¥å…·è¿›è¡Œæž„å»ºï¼Œåˆ™å¯ä»¥å®‰å…¨åœ°å°† Cygwin <em class="filename">/bin</em>ç›®å½•æ”¾ç½®åœ¨ Windows è·¯å¾„çš„å‰é¢ã€‚è¿™å°†ä¿è¯é€šè¿‡ Windows ç‰ˆæœ¬è®¿é—® Cygwin å·¥å…·ã€‚</p><p>If your commitment to Cygwin is strong and you do not need to
          build using native Windows support tools, you can safely place the
          Cygwin <em class="filename">/bin</em> directory at the
          front of your Windows path. This will guarantee access to Cygwin
          tools over Windows versions.</p><p>å¦‚æžœæ‚¨çš„<em class="filename">makefile</em>ä½¿ç”¨ Java å·¥å…·ï¼Œè¯·æ³¨æ„ Cygwin åŒ…å«
          
          ä¸Žæ ‡å‡† Sun <em class="filename">jaræ–‡ä»¶æ ¼å¼ä¸å…¼å®¹çš„</em><acronym class="acronym">GNU </acronym> <em class="command">jar</em>ç¨‹åºã€‚å› æ­¤ï¼ŒJava jdk
           <em class="filename">bin</em>ç›®å½•åº”è¯¥æ”¾åœ¨
          ä½ çš„å˜é‡ä¸­Cygwin <em class="filename">/bin</em>ç›®å½•ä¹‹å‰ï¼Œä»¥é¿å…ä½¿ç”¨Cygwinçš„<em class="command">jar</em>
          ç¨‹åºã€‚<em class="filename"></em><em class="filename"></em><em class="filename"></em><code class="literal">Path</code><em class="command"></em></p><p>If your <em class="filename">makefile</em> is
          working with Java tools, be aware that Cygwin includes the
          <acronym class="acronym">GNU</acronym> <em class="command">jar</em>
          program that is incompatible with the standard Sun <em class="filename">jar</em> file format. Therefore, the Java jdk
          <em class="filename">bin</em> directory should be placed
          before the Cygwin <em class="filename">/bin</em>
          directory in your <code class="literal">Path</code> variable
          to avoid using Cygwin's <em class="command">jar</em>
          program.</p></div><div class="footnotes"><br><br><hr><div class="footnote"><p><sup>[ <a id="OEBPS/ch07s02.html.ftn.make3-CHP-7-FNOTE-1" href="#OEBPS/ch07s02.html.make3-CHP-7-FNOTE-1" class="para">1</a> ]</sup>æˆ‘çš„ Cygwin <em class="filename">/bin</em>
            ç›®å½•å½“å‰åŒ…å« 1343 ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><p><sup>[<a href="#OEBPS/ch07s02.html.make3-CHP-7-FNOTE-1" class="para">1</a>] </sup>My Cygwin <em class="filename">/bin</em>
            directory currently contains 1343 executables.</p></div></div></div></div></div>
<div id="OEBPS/ch07s03.html"><div>
<div class="sect1" title="ç®¡ç†ç¨‹åºå’Œæ–‡ä»¶"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch07s03.html.make3-CHP-7-SECT-3"></a>ç®¡ç†ç¨‹åºå’Œæ–‡ä»¶</h1><h1 class="title"><a></a>Managing Programs and Files</h1></div></div></div><p>æœ€å¸¸è§çš„ç®¡ç†æ–¹å¼<a id="OEBPS/ch07s03.html.make3-CHP-7-ITERM-1430" class="indexterm"></a> <a id="OEBPS/ch07s03.html.make3-CHP-7-ITERM-1431" class="indexterm"></a>ç¨‹åºçš„ç›®çš„æ˜¯å¯¹å¯èƒ½æ›´æ”¹çš„ç¨‹åºåç§°æˆ–è·¯å¾„ä½¿ç”¨å˜é‡ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œå˜é‡å¯ä»¥åœ¨ä¸€ä¸ªç®€å•çš„å—ä¸­å®šä¹‰ï¼š</p><p>The most common way to manage <a class="indexterm"></a> <a class="indexterm"></a>programs is to use a variable for program names or paths
        that are likely to change. The variables can be defined in a simple
        block, as we have seen:</p><a id="OEBPS/ch07s03.html.I_2_tt344"></a><pre class="programlisting">MV ?= mv -f
RM ?= rm -f</pre><pre class="programlisting">MV ?= mv -f
RM ?= rm -f</pre><p>æˆ–è€…åœ¨æ¡ä»¶å—ä¸­ï¼š</p><p>or in a conditional block:</p><a id="OEBPS/ch07s03.html.I_2_tt345"></a><pre class="programlisting">ifdef è®¡ç®—æœºè§„èŒƒ
  MV ?= ç§»åŠ¨
  RM ?= åˆ é™¤
åˆ«çš„
  MV ?= mv -f
  RM ?= rm -f
ä¸‡ä¸€</pre><pre class="programlisting">ifdef COMSPEC
  MV ?= move
  RM ?= del
else
  MV ?= mv -f
  RM ?= rm -f
endif</pre><p>å¦‚æžœä½¿ç”¨ç®€å•çš„å—ï¼Œåˆ™å¯ä»¥é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸Šé‡ç½®å®ƒä»¬ã€ç¼–è¾‘ makefile<em class="filename">æˆ–</em>ï¼ˆåœ¨æœ¬ä¾‹ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨æ¡ä»¶èµ‹å€¼<code class="literal">?=</code>ï¼‰é€šè¿‡è®¾ç½®çŽ¯å¢ƒå˜é‡æ¥æ›´æ”¹è¿™äº›å€¼ã€‚å¦‚å‰æ‰€è¿°ï¼Œæµ‹è¯• Windows å¹³å°çš„ä¸€ç§æ–¹æ³•æ˜¯æ£€æŸ¥<code class="literal">COMSPEC</code>æ‰€æœ‰ Windows æ“ä½œç³»ç»Ÿéƒ½ä½¿ç”¨çš„å˜é‡ã€‚æœ‰æ—¶åªéœ€è¦æ›´æ”¹è·¯å¾„ï¼š</p><p>If a simple block is used, the values can be changed by
        resetting them on the command line, by editing the <em class="filename">makefile</em>, or (in this case because we used
        conditional assignment, <code class="literal">?=</code>) by
        setting an environment variable. As mentioned previously, one way to
        test for a Windows platform is to check for the <code class="literal">COMSPEC</code> variable, which is used by all
        Windows operating systems. Sometimes only a path needs to
        change:</p><a id="OEBPS/ch07s03.html.I_2_tt346"></a><pre class="programlisting">ifdef è®¡ç®—æœºè§„èŒƒ
  è¾“å‡ºæ ¹:= d:
  GCC_HOME := c:/gnu/usr/bin
åˆ«çš„
  è¾“å‡ºæ ¹ := $(HOME)
  GCC_HOME := /usr/bin
ä¸‡ä¸€

OUTPUT_DIR := $(OUTPUT_ROOT)/å·¥ä½œ/äºŒè¿›åˆ¶æ–‡ä»¶
CC := $(GCC_HOME)/gcc</pre><pre class="programlisting">ifdef COMSPEC
  OUTPUT_ROOT := d:
  GCC_HOME    := c:/gnu/usr/bin
else
  OUTPUT_ROOT := $(HOME)
  GCC_HOME    := /usr/bin
endif

OUTPUT_DIR := $(OUTPUT_ROOT)/work/binaries
CC := $(GCC_HOME)/gcc</pre><p>è¿™ç§é£Žæ ¼äº§ç”Ÿçš„<em class="filename">makefile</em>ä¸­å¤§å¤šæ•°ç¨‹åºéƒ½æ˜¯é€šè¿‡<em class="command">make</em>å˜é‡è°ƒç”¨çš„ã€‚åœ¨æ‚¨ä¹ æƒ¯ä¹‹å‰ï¼Œè¿™å¯èƒ½ä¼šä½¿<em class="filename">makefile</em>æœ‰ç‚¹éš¾ä»¥é˜…è¯»ã€‚ç„¶è€Œï¼Œæ— è®ºå¦‚ä½•ï¼Œåœ¨<em class="filename">makefile</em>ä¸­ä½¿ç”¨å˜é‡é€šå¸¸æ›´æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥æ¯”æ–‡å­—ç¨‹åºåç§°çŸ­å¾—å¤šï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨å®Œæ•´è·¯å¾„æ—¶ã€‚</p><p>This style results in a <em class="filename">makefile</em> in which most programs are invoked
        via <em class="command">make</em> variables. Until you get
        used to it, this can make the <em class="filename">makefile</em> a little harder to read. However,
        variables are often more convenient to use in the <em class="filename">makefile</em> anyway, because they can be
        considerably shorter than the literal program name, particularly when
        full paths are used.</p><p>å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æŠ€æœ¯æ¥ç®¡ç†ä¸åŒçš„å‘½ä»¤é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œå†…ç½®ç¼–è¯‘è§„åˆ™åŒ…å«ä¸€ä¸ªå˜é‡ ï¼Œ<code class="literal">TARGET_ARCH</code>å¯ç”¨äºŽè®¾ç½®ç‰¹å®šäºŽå¹³å°çš„æ ‡å¿—ï¼š</p><p>The same technique can be used to manage different command
        options. For instance, the built-in compilation rules include a
        variable, <code class="literal">TARGET_ARCH</code>, that can be
        used to set platform-specific flags:</p><a id="OEBPS/ch07s03.html.I_2_tt347"></a><pre class="programlisting">ifeq "$(æœºå™¨)" "hpux-hppa"
  TARGET_ARCH := -mdisable-fpregs
ä¸‡ä¸€</pre><pre class="programlisting">ifeq "$(MACHINE)" "hpux-hppa"
  TARGET_ARCH := -mdisable-fpregs
endif</pre><p>å½“å®šä¹‰è‡ªå·±çš„ç¨‹åºå˜é‡æ—¶ï¼Œæ‚¨å¯èƒ½éœ€è¦ä½¿ç”¨ç±»ä¼¼çš„æ–¹æ³•ï¼š</p><p>When defining your own program variables, you may need to use a
        similar approach:</p><a id="OEBPS/ch07s03.html.I_2_tt348"></a><pre class="programlisting">MV := mv $(MV_FLAGS)

ifeq "$(MACHINE)" "solaris-sparc"
  MV_FLAGS := -f
ä¸‡ä¸€</pre><pre class="programlisting">MV := mv $(MV_FLAGS)

ifeq "$(MACHINE)" "solaris-sparc"
  MV_FLAGS := -f
endif</pre><p>å¦‚æžœæ‚¨è¦ç§»æ¤åˆ°è®¸å¤šå¹³å°ï¼Œé“¾æŽ¥è¿™äº›<code class="literal">ifdef</code>éƒ¨åˆ†å¯èƒ½ä¼šå˜å¾—ä¸‘é™‹ä¸”éš¾ä»¥ç»´æŠ¤ã€‚ä¸è¦ä½¿ç”¨ ï¼Œè€Œæ˜¯<code class="literal">ifdef</code>å°†æ¯ç»„ç‰¹å®šäºŽå¹³å°çš„å˜é‡æ”¾åœ¨å…¶è‡ªå·±çš„æ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶çš„åç§°åŒ…å«å¹³å°æŒ‡ç¤ºç¬¦ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæ‚¨é€šè¿‡<em class="command">uname</em>å‚æ•°æŒ‡å®šå¹³å°ï¼Œåˆ™å¯ä»¥é€‰æ‹©é€‚å½“çš„<em class="command">make</em> include æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>If you are porting to many platforms, chaining the <code class="literal">ifdef</code> sections can become ugly and difficult
        to maintain. Instead of using <code class="literal">ifdef</code>, place each set of platform-specific
        variables in its own file whose name contains a platform indicator.
        For instance, if you designate a platform by its <em class="command">uname</em> parameters, you can select the
        appropriate <em class="command">make</em> include file like
        this:</p><a id="OEBPS/ch07s03.html.I_2_tt349"></a><pre class="programlisting">æœºå™¨ := $(shell uname -smo | sed 's/ /-/g')
åŒ…æ‹¬ $(MACHINE)-defines.mk</pre><pre class="programlisting">MACHINE := $(shell uname -smo | sed 's/ /-/g')
include $(MACHINE)-defines.mk</pre><p><em class="command">å¸¦æœ‰ç©ºæ ¼çš„æ–‡ä»¶åç»™make</em>å¸¦æ¥äº†ä¸€ä¸ªç‰¹åˆ«æ¼äººçš„é—®é¢˜ã€‚åœ¨è§£æžè¿‡ç¨‹ä¸­ç©ºæ ¼åˆ†éš”æ ‡è®°çš„å‡è®¾æ˜¯<em class="command">çš„</em>åŸºç¡€ã€‚è®¸å¤šå†…ç½®å‡½æ•°ï¼ˆä¾‹å¦‚
        <code class="function">word</code>ã€<code class="function">filter</code>ã€<code class="function">wildcard</code>å’Œå…¶ä»–å‡½æ•°ï¼‰å‡å®šå®ƒä»¬çš„å‚æ•°æ˜¯ç©ºæ ¼åˆ†éš”çš„å•è¯ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™é‡Œæœ‰ä¸€äº›æŠ€å·§å¯èƒ½ä¼šåœ¨ä¸€äº›å°æ–¹é¢æœ‰æ‰€å¸®åŠ©ã€‚ç¬¬ä¸€ä¸ªæŠ€å·§ï¼Œåœ¨<a class="link" href="#OEBPS/ch08.html" title="ç¬¬ 8 ç«  C å’Œ C++">ç¬¬ 8 ç« </a>çš„<a class="link" href="#OEBPS/ch07s04.html.make3-CHP-7-SECT-4.1" title="æ ‡å‡†å¤–å£³">7.4.1 èŠ‚</a>ä¸­æåˆ°ï¼Œæ˜¯å¦‚ä½•ä½¿ç”¨å¦ä¸€ä¸ªå­—ç¬¦æ›¿æ¢ç©ºæ ¼ï¼š<a class="link" href="#OEBPS/ch08.html" title="ç¬¬ 8 ç«  C å’Œ C++"></a><code class="function">subst</code></p><p>Filenames with spaces present a particularly irritating problem
        for <em class="command">make</em>. The assumption that
        whitespace separates tokens during parsing is fundamental to <em class="command">make</em>. Many built-in functions such as
        <code class="function">word</code>, <code class="function">filter</code>, <code class="function">wildcard</code>, and others assume their arguments
        are space-separated words. Nevertheless, here are some tricks that may
        help in small ways. The first trick, noted in <a class="link" href="#OEBPS/ch07s04.html.make3-CHP-7-SECT-4.1" title="A Standard Shell">Section 7.4.1</a> in <a class="link" href="#OEBPS/ch08.html" title="Chapter&nbsp;8.&nbsp;C and C++">Chapter 8</a>, is how to replace spaces with
        another character using <code class="function">subst</code>:</p><a id="OEBPS/ch07s03.html.I_2_tt350"></a><pre class="programlisting">ç©ºé—´ = $(ç©º) $(ç©º)

# $(è°ƒç”¨é—®é¢˜ç©ºé—´,æ–‡ä»¶å)
ç©ºæ ¼åˆ°é—®é¢˜ = $(subst $(ç©ºæ ¼),?,$1)</pre><pre class="programlisting">space = $(empty) $(empty)

# $(call space-to-question,file-name)
space-to-question = $(subst $(space),?,$1)</pre><p>è¯¥<code class="function">space-to-question</code>
        å‡½æ•°ç”¨é€šé…ç¬¦é—®å·æ›¿æ¢æ‰€æœ‰ç©ºæ ¼ã€‚çŽ°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å®žçŽ°å¯ä»¥å¤„ç†ç©ºæ ¼çš„å‡½æ•°<code class="function">wildcard</code>
        ï¼š<code class="function">file-exists</code></p><p>The <code class="function">space-to-question</code>
        function replaces all spaces with the globbing wildcard question mark.
        Now, we can implement <code class="function">wildcard</code>
        and <code class="function">file-exists</code> functions that
        can handle spaces:</p><a id="OEBPS/ch07s03.html.I_2_tt351"></a><pre class="programlisting"># $(è°ƒç”¨é€šé…ç¬¦ç©ºæ ¼,æ–‡ä»¶å)
é€šé…ç¬¦ç©ºæ ¼ = $(é€šé…ç¬¦ $(è°ƒç”¨ç©ºæ ¼åˆ°é—®é¢˜,$1))

# $(è°ƒç”¨æ–‡ä»¶å­˜åœ¨
æ–‡ä»¶å­˜åœ¨= $(æ¡å¸¦\
                 $(å¦‚æžœ$1,,$(è­¦å‘Š$1æ²¡æœ‰å€¼)) \
                 $(è°ƒç”¨é€šé…ç¬¦ç©ºæ ¼,$1))</pre><pre class="programlisting"># $(call wildcard-spaces,file-name)
wildcard-spaces = $(wildcard $(call space-to-question,$1))

# $(call file-exists
file-exists = $(strip                                       \
                 $(if $1,,$(warning $1 has no value))       \
                 $(call wildcard-spaces,$1))</pre><p>åŠŸèƒ½<code class="function">wildcard-spaces</code>
        â€‹<a id="OEBPS/ch07s03.html.make3-CHP-7-ITERM-1432" class="indexterm"></a> <a id="OEBPS/ch07s03.html.make3-CHP-7-ITERM-1433" class="indexterm"></a>ç”¨äºŽ<code class="function">space-to-question</code>å…è®¸<em class="filename">makefile</em>å¯¹åŒ…å«ç©ºæ ¼çš„æ¨¡å¼æ‰§è¡Œé€šé…ç¬¦æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„<code class="function">wildcard-spaces</code>å‡½æ•°æ¥å®žçŽ°
        <code class="function">file-exists</code>ã€‚å½“ç„¶ï¼Œä½¿ç”¨é—®å·ä¹Ÿå¯èƒ½å¯¼è‡´<code class="function">wildcard-spaces</code>è¿”å›žä¸ŽåŽŸå§‹é€šé…ç¬¦æ¨¡å¼ä¸æ­£ç¡®åŒ¹é…çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚â€œmy document.docâ€å’Œâ€œmy-document.docâ€ï¼‰ï¼Œä½†è¿™æ˜¯æˆ‘ä»¬èƒ½åšåˆ°çš„æœ€å¥½çš„åšã€‚</p><p>The <code class="function">wildcard-spaces</code>
        function <a class="indexterm"></a> <a class="indexterm"></a>uses <code class="function">space-to-question</code> to allow the <em class="filename">makefile</em> to perform a wildcard operation on
        a pattern including spaces. We can use our <code class="function">wildcard-spaces</code> function to implement
        <code class="function">file-exists</code>. Of course, the use
        of the question mark may also cause <code class="function">wildcard-spaces</code> to return files that do not
        correctly match the original wildcard pattern (e.g., "my document.doc"
        and "my-document.doc"), but this is the best we can do.</p><p>åŠŸèƒ½<code class="function">space-to-question</code>
        â€‹<a id="OEBPS/ch07s03.html.make3-CHP-7-ITERM-1434" class="indexterm"></a> <a id="OEBPS/ch07s03.html.make3-CHP-7-ITERM-1435" class="indexterm"></a>è¿˜å¯ä»¥ç”¨äºŽè½¬æ¢ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶ä¸­å¸¦æœ‰ç©ºæ ¼çš„æ–‡ä»¶åï¼Œå› ä¸ºå®ƒä»¬å…è®¸ä½¿ç”¨é€šé…æ¨¡å¼ã€‚</p><p>The <code class="function">space-to-question</code>
        function <a class="indexterm"></a> <a class="indexterm"></a>can also be used to transform filenames with spaces in
        targets and prerequisites, since those allow globbing patterns to be
        used.</p><a id="OEBPS/ch07s03.html.I_2_tt352"></a><pre class="programlisting">ç©ºé—´ := $(ç©º) $(ç©º)

# $(è°ƒç”¨é—®é¢˜ç©ºé—´,æ–‡ä»¶å)
ç©ºæ ¼åˆ°é—®é¢˜ = $(subst $(ç©ºæ ¼),?,$1)

# $(è°ƒç”¨é—®é¢˜åˆ°ç©ºé—´,æ–‡ä»¶å)
é—®é¢˜åˆ°ç©ºæ ¼ = $(subst ?,$(space),$1)

$(è°ƒç”¨ç©ºæ ¼åˆ°é—®é¢˜,foo bar): $(è°ƒç”¨ç©ºæ ¼åˆ°é—®é¢˜,bar baz)
        è§¦æ‘¸â€œ$(å‘¼å«é—®é¢˜åˆ°ç©ºé—´,$@)â€</pre><pre class="programlisting">space := $(empty) $(empty)

# $(call space-to-question,file-name)
space-to-question = $(subst $(space),?,$1)

# $(call question-to-space,file-name)
question-to-space = $(subst ?,$(space),$1)

$(call space-to-question,foo bar): $(call space-to-question,bar baz)
        touch "$(call question-to-space,$@)"</pre><p>å‡è®¾æ–‡ä»¶â€œ <em class="filename">bar baz</em> â€å­˜åœ¨ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œè¯¥<em class="filename">makefile</em>æ—¶å°±ä¼šæ‰¾åˆ°å…ˆå†³æ¡ä»¶ï¼Œå› ä¸ºä¼šè¯„ä¼°é€šé…æ¨¡å¼ã€‚ä½†æ˜¯ç›®æ ‡é€šé…æ¨¡å¼ä¼šå¤±è´¥ï¼Œå› ä¸ºç›®æ ‡å°šä¸å­˜åœ¨ï¼Œå› æ­¤
        <code class="literal">$@</code>å€¼ ä¹Ÿä¸å­˜åœ¨<code class="literal">foo?bar</code>ã€‚ç„¶åŽï¼Œå‘½ä»¤è„šæœ¬ç”¨äºŽ
        <code class="function">question-to-space</code>å°†å…¶è½¬æ¢
        <code class="literal">$@</code>å›žå¸¦æœ‰æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„ç©ºæ ¼çš„æ–‡ä»¶ã€‚ä¸‹æ¬¡è¿è¡Œ<em class="filename">makefile</em>æ—¶ï¼Œä¼šæ‰¾åˆ°ç›®æ ‡ï¼Œå› ä¸ºé€šé…æ¨¡å¼æ‰¾åˆ°å¸¦æœ‰ç©ºæ ¼çš„ç›®æ ‡ã€‚æœ‰ç‚¹éš¾çœ‹ï¼Œä½†æˆ‘å‘çŽ°è¿™äº›æŠ€å·§åœ¨çœŸæ­£çš„<em class="filename">makefile</em>ä¸­å¾ˆæœ‰ç”¨ã€‚</p><p>Assuming the file "<em class="filename">bar baz</em>"
        exists, the first time this <em class="filename">makefile</em> is executed the prerequisite is
        found because the globbing pattern is evaluated. But the target
        globbing pattern fails because the target does not yet exist, so
        <code class="literal">$@</code> has the value <code class="literal">foo?bar</code>. The command script then uses
        <code class="function">question-to-space</code> to transform
        <code class="literal">$@</code> back to the file with spaces
        that we really want. The next time the <em class="filename">makefile</em> is run, the target is found
        because the globbing pattern finds the target with spaces. A bit ugly,
        but I have found these tricks useful in real <em class="filename">makefile</em>s.</p><div class="sect2" title="æºæ ‘å¸ƒå±€"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch07s03.html.make3-CHP-7-SECT-3.1"></a>æºæ ‘å¸ƒå±€</h2><h2 class="title"><a></a>Source Tree Layout</h2></div></div></div><p>å¯ç§»æ¤æ€§çš„å¦ä¸€ä¸ªæ–¹é¢æ˜¯<a id="OEBPS/ch07s03.html.make3-CHP-7-ITERM-1436" class="indexterm"></a> <a id="OEBPS/ch07s03.html.make3-CHP-7-ITERM-1437" class="indexterm"></a>å…è®¸å¼€å‘äººå‘˜åœ¨ä»–ä»¬è®¤ä¸ºå¿…è¦æ—¶è‡ªç”±ç®¡ç†å…¶å¼€å‘çŽ¯å¢ƒçš„èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæž„å»ºç³»ç»Ÿè¦æ±‚å¼€å‘äººå‘˜å§‹ç»ˆå°†å…¶æºä»£ç ã€äºŒè¿›åˆ¶æ–‡ä»¶ã€åº“å’Œæ”¯æŒå·¥å…·æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹æˆ–åŒä¸€ Windows ç£ç›˜é©±åŠ¨å™¨ä¸Šï¼Œå°±ä¼šå‡ºçŽ°é—®é¢˜ã€‚æœ€ç»ˆï¼Œä¸€äº›ç£ç›˜ç©ºé—´ä¸è¶³çš„å¼€å‘äººå‘˜å°†é¢ä¸´å¿…é¡»å¯¹è¿™äº›ä¸åŒæ–‡ä»¶è¿›è¡Œåˆ†åŒºçš„é—®é¢˜ã€‚</p><p>Another aspect of portability is the <a class="indexterm"></a> <a class="indexterm"></a>ability to allow developers freedom to manage their
          development environment as they deem necessary. There will be
          problems if the build system requires the developers to always place
          their source, binaries, libraries, and support tools under the same
          directory or on the same Windows disk drive, for instance.
          Eventually, some developer low on disk space will be faced with the
          problem of having to partition these various files.</p><p>ç›¸åï¼Œä½¿ç”¨å˜é‡æ¥å¼•ç”¨è¿™äº›æ–‡ä»¶é›†åˆå¹¶è®¾ç½®åˆç†çš„é»˜è®¤å€¼æ¥å®žçŽ°<em class="filename">makefile</em>æ˜¯æœ‰æ„ä¹‰çš„ã€‚æ­¤å¤–ï¼Œæ¯ä¸ªæ”¯æŒåº“å’Œå·¥å…·éƒ½å¯ä»¥é€šè¿‡å˜é‡å¼•ç”¨ï¼Œä»¥å…è®¸å¼€å‘äººå‘˜æ ¹æ®éœ€è¦è‡ªå®šä¹‰æ–‡ä»¶ä½ç½®ã€‚å¯¹äºŽæœ€å¯èƒ½çš„è‡ªå®šä¹‰å˜é‡ï¼Œè¯·ä½¿ç”¨æ¡ä»¶èµ‹å€¼è¿ç®—ç¬¦ï¼Œä»¥ä¾¿å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡ç®€å•çš„æ–¹æ³•ä½¿ç”¨çŽ¯å¢ƒå˜é‡è¦†ç›–<em class="filename">makefile ã€‚</em></p><p>Instead, it makes sense to implement the <em class="filename">makefile</em> using variables to reference
          these collections of files and set reasonable defaults. In addition,
          each support library and tool can be referenced through a variable
          to allow developers to customize file locations as they find
          necessary. For the most likely customization variables, use the
          conditional assignment operator to allow developers a simple way of
          overriding the <em class="filename">makefile</em> with
          environment variables.</p><p>æ­¤å¤–ï¼Œè½»æ¾æ”¯æŒæºä»£ç å’ŒäºŒå‰æ ‘çš„å¤šä¸ªå‰¯æœ¬çš„èƒ½åŠ›å¯¹å¼€å‘äººå‘˜æ¥è¯´æ˜¯ä¸€ä¸ªç¦éŸ³ã€‚å³ä½¿ä»–ä»¬ä¸å¿…æ”¯æŒä¸åŒçš„å¹³å°æˆ–ç¼–è¯‘é€‰é¡¹ï¼Œå¼€å‘äººå‘˜ä¹Ÿç»å¸¸å‘çŽ°è‡ªå·±æ­£åœ¨ä½¿ç”¨æºä»£ç çš„å¤šä¸ªå‰¯æœ¬ï¼Œè¦ä¹ˆæ˜¯å‡ºäºŽè°ƒè¯•ç›®çš„ï¼Œè¦ä¹ˆæ˜¯å› ä¸ºä»–ä»¬å¹¶è¡Œå¤„ç†å¤šä¸ªé¡¹ç›®ã€‚å·²ç»è®¨è®ºäº†æ”¯æŒè¿™ä¸€ç‚¹çš„ä¸¤ç§æ–¹æ³•ï¼šä½¿ç”¨â€œé¡¶çº§â€çŽ¯å¢ƒå˜é‡æ¥æ ‡è¯†æºä»£ç å’ŒäºŒå‰æ ‘çš„æ ¹ï¼Œæˆ–è€…ä½¿ç”¨ makefile çš„ç›®å½•
          <em class="filename">å’Œ</em>å›ºå®šçš„ç›¸å¯¹è·¯å¾„æ¥æŸ¥æ‰¾äºŒå‰æ ‘ã€‚å…¶ä¸­ä»»ä½•ä¸€ä¸ªéƒ½å…è®¸å¼€å‘äººå‘˜çµæ´»åœ°æ”¯æŒå¤šæ£µæ ‘ã€‚</p><p>In addition, the ability to easily support multiple copies of
          the source and binary tree is a boon to developers. Even if they
          don't have to support different platforms or compilation options,
          developers often find themselves working with several copies of the
          source, either for debugging purposes or because they work on
          several projects in parallel. Two ways to support this have already
          been discussed: use a "top-level" environment variable to identify
          the root of the source and binary trees, or use the directory of the
          <em class="filename">makefile</em> and a fixed relative
          path to find the binary tree. Either of these allows developers the
          flexibility of supporting more than one tree.</p></div></div></div></div>
<div id="OEBPS/ch07s04.html"><div>
<div class="sect1" title="ä½¿ç”¨éžä¾¿æºå¼å·¥å…·"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch07s04.html.make3-CHP-7-SECT-4"></a>ä½¿ç”¨éžä¾¿æºå¼å·¥å…·</h1><h1 class="title"><a></a>Working with Nonportable Tools</h1></div></div></div><p>å¦‚å‰æ‰€è¿°ï¼Œ<a id="OEBPS/ch07s04.html.make3-CHP-7-ITERM-1438" class="indexterm"></a><em class="filename">å°†makefile</em>å†™å…¥æœ€å°å…¬åˆ†æ¯çš„ä¸€ç§æ›¿ä»£æ–¹æ³•æ˜¯é‡‡ç”¨ä¸€äº›æ ‡å‡†å·¥å…·ã€‚å½“ç„¶ï¼Œç›®æ ‡æ˜¯ç¡®ä¿æ ‡å‡†å·¥å…·è‡³å°‘ä¸Žæ‚¨æ­£åœ¨æž„å»ºçš„åº”ç”¨ç¨‹åºä¸€æ ·å¯ç§»æ¤ã€‚ä¾¿æºå¼å·¥å…·çš„æ˜Žæ˜¾é€‰æ‹©æ˜¯æ¥è‡ª
        <acronym class="acronym">GNU</acronym>é¡¹ç›®çš„ç¨‹åºï¼Œä½†ä¾¿æºå¼å·¥å…·çš„æ¥æºå¤šç§å¤šæ ·ã€‚ Perl å’Œ Python æ˜¯æˆ‘æƒ³åˆ°çš„å¦å¤–ä¸¤ä¸ªå·¥å…·ã€‚</p><p>As noted previously, <a class="indexterm"></a>one alternative to writing <em class="filename">makefile</em>s to the least common denominator
        is to adopt some standard tools. Of course, the goal is to make sure
        the standard tools are at least as portable as the application you are
        building. The obvious choice for portable tools are programs from the
        <acronym class="acronym">GNU</acronym> project, but portable tools come from a wide
        variety of sources. Perl and Python are two other tools that come to
        mind.</p><p>åœ¨ç¼ºä¹å¯ç§»æ¤å·¥å…·çš„æƒ…å†µä¸‹ï¼Œå°†ä¸å¯ç§»æ¤å·¥å…·å°è£…åœ¨<em class="command">make</em>å‡½æ•°ä¸­æœ‰æ—¶ä¹Ÿèƒ½èµ·åˆ°åŒæ ·çš„ä½œç”¨ã€‚ä¾‹å¦‚ï¼Œä¸ºäº†æ”¯æŒ Enterprise JavaBeans çš„å¤šç§ç¼–è¯‘å™¨ï¼ˆæ¯ç§ç¼–è¯‘å™¨çš„è°ƒç”¨è¯­æ³•ç•¥æœ‰ä¸åŒï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªåŸºæœ¬å‡½æ•°æ¥ç¼–è¯‘ EJB jar å¹¶å°†å…¶å‚æ•°åŒ–ä»¥å…è®¸æ’å…¥ä¸åŒçš„ç¼–è¯‘å™¨ã€‚</p><p>In the absence of portable tools, encapsulating nonportable
        tools in <em class="command">make</em> functions can
        sometimes do just as well. For instance, to support a variety of
        compilers for Enterprise JavaBeans (each of which has a slightly
        different invocation syntax), we can write a basic function to compile
        an EJB jar and parameterize it to allow one to plug in different
        compilers.</p><a id="OEBPS/ch07s04.html.I_2_tt353"></a><pre class="programlisting">EJB_TMP_JAR = $(TMPDIR)/temp.jar

# $(è°ƒç”¨compile-generic-bean, bean-type, jar-name,
# bean-files-wildcard, æ¸…å•åç§°-opt )
å®šä¹‰ç¼–è¯‘é€šç”¨ bean
  $(RM) $(ç›®å½• $(META_INF))
  $(MKDIR) $(META_INF)
  $(if $(è¿‡æ»¤å™¨ %.xml %.xmi, $3), \
    cp $(è¿‡æ»¤å™¨ %.xml %.xmi, $3) $(META_INF))
  $(è°ƒç”¨ç¼–è¯‘-$1-bean-hook,$2)
  cd $(OUTPUT_DIR) &amp;&amp; \
  $(JAR) -cf0 $(EJB_TMP_JAR) \
         $(è°ƒç”¨ jar-file-arg,$(META_INF)) \
         $(è°ƒç”¨beanç±»ï¼Œ$3)
  $(è°ƒç”¨$1-ç¼–è¯‘å‘½ä»¤ï¼Œ$2)
  $(è°ƒç”¨create-manifest,$(if $4,$4,$2),,)
æ©å¾·å¤«</pre><pre class="programlisting">EJB_TMP_JAR = $(TMPDIR)/temp.jar

# $(call compile-generic-bean, bean-type, jar-name,
#                              bean-files-wildcard, manifest-name-opt )
define compile-generic-bean
  $(RM) $(dir $(META_INF))
  $(MKDIR) $(META_INF)
  $(if $(filter %.xml %.xmi, $3),            \
    cp $(filter %.xml %.xmi, $3) $(META_INF))
  $(call compile-$1-bean-hook,$2)
  cd $(OUTPUT_DIR) &amp;&amp;                        \
  $(JAR) -cf0 $(EJB_TMP_JAR)                 \
         $(call jar-file-arg,$(META_INF))    \
         $(call bean-classes,$3)
  $(call $1-compile-command,$2)
  $(call create-manifest,$(if $4,$4,$2),,)
endef</pre><p>è¿™ä¸ªé€šç”¨ EJB ç¼–è¯‘å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„ bean ç¼–è¯‘å™¨çš„ç±»åž‹ï¼Œä¾‹å¦‚ Weblogicã€Websphere ç­‰ã€‚å…¶ä½™å‚æ•°æ˜¯ jar åç§°ã€æž„æˆ jar å†…å®¹çš„æ–‡ä»¶ï¼ˆåŒ…æ‹¬é…ç½®æ–‡ä»¶ï¼‰å’Œå¯é€‰çš„æ¸…å•æ–‡ä»¶ã€‚æ¨¡æ¿å‡½æ•°é¦–å…ˆé€šè¿‡åˆ é™¤ä»»ä½•æ—§çš„ä¸´æ—¶ç›®å½•å¹¶é‡æ–°åˆ›å»ºå®ƒæ¥åˆ›å»ºä¸€ä¸ªå¹²å‡€çš„ä¸´æ—¶åŒºåŸŸã€‚æŽ¥ä¸‹æ¥ï¼Œè¯¥å‡½æ•°å°†å…ˆå†³æ¡ä»¶ä¸­å­˜åœ¨çš„<em class="filename">xml</em>æˆ–
        <em class="filename">xmi</em><code class="literal">$(META_INF)</code>æ–‡ä»¶å¤åˆ¶åˆ°è¯¥
        ç›®å½•ä¸­ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œæ¥æ¸…ç†<em class="filename">META-INF</em>æ–‡ä»¶æˆ–å‡†å¤‡<em class="filename">.class</em>æ–‡ä»¶ã€‚ä¸ºäº†æ”¯æŒè¿™äº›æ“ä½œï¼Œæˆ‘ä»¬åŒ…å«ä¸€ä¸ªé’©å­å‡½æ•°ï¼Œ<code class="function">compile-$1-bean-hook</code>ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦å®šä¹‰è¯¥å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœ Websphere ç¼–è¯‘å™¨éœ€è¦é¢å¤–çš„æŽ§åˆ¶æ–‡ä»¶ï¼ˆä¾‹å¦‚<em class="filename">xsl</em>
        æ–‡ä»¶ï¼‰ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä»¥ä¸‹é’©å­ï¼š</p><p>The first argument to this general EJB compilation function is
        the type of bean compiler we are using, such as Weblogic, Websphere,
        etc. The remaining arguments are the jar name, the files forming the
        content of the jar (including configuration files), and an optional
        manifest file. The template function first creates a clean temporary
        area by deleting any old temporary directory and recreating it. Next,
        the function copies in the <em class="filename">xml</em> or
        <em class="filename">xmi</em> files present in the
        prerequisites into the <code class="literal">$(META_INF)</code>
        directory. At this point, we may need to perform custom operations to
        clean up the <em class="filename">META-INF</em> files or
        prepare the <em class="filename">.class</em> files. To
        support these operations, we include a hook function, <code class="function">compile-$1-bean-hook</code>, that the user can
        define, if necessary. For instance, if the Websphere compiler required
        an extra control file, say an <em class="filename">xsl</em>
        file, we would write this hook:</p><a id="OEBPS/ch07s04.html.I_2_tt354"></a><pre class="programlisting"># $(è°ƒç”¨compile-websphere-bean-hook, æ–‡ä»¶åˆ—è¡¨)
å®šä¹‰ç¼–è¯‘ websphere-bean-hook
  cp $(è¿‡æ»¤å™¨%.xsl, $1) $(META_INF)
æ©å¾·å¤«</pre><pre class="programlisting"># $(call compile-websphere-bean-hook, file-list)
define compile-websphere-bean-hook
  cp $(filter %.xsl, $1) $(META_INF)
endef</pre><p>é€šè¿‡ç®€å•åœ°å®šä¹‰è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ç¡®ä¿<code class="function">call</code>in<code class="function">compile-generic-bean</code>å°†è¢«é€‚å½“åœ°æ‰©å±•ã€‚å¦‚æžœæˆ‘ä»¬ä¸é€‰æ‹©ç¼–å†™é’©å­å‡½æ•°ï¼Œåˆ™è°ƒç”¨<code class="function">compile-generic-bean</code>å°†æ‰©å±•ä¸ºç©ºã€‚</p><p>By simply defining this function, we make sure the <code class="function">call</code> in <code class="function">compile-generic-bean</code> will be expanded
        appropriately. If we do not choose to write a hook function, the call
        in <code class="function">compile-generic-bean</code> expands
        to nothing.</p><p>æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çš„é€šç”¨å‡½æ•°åˆ›å»º jarã€‚è¾…åŠ©å‡½æ•°
        <code class="function">jar-file-arg</code>å°†æ™®é€šæ–‡ä»¶è·¯å¾„åˆ†è§£ä¸º<code class="option">-C</code>é€‰é¡¹å’Œç›¸å¯¹è·¯å¾„ï¼š</p><p>Next, our generic function creates the jar. The helper function
        <code class="function">jar-file-arg</code> decomposes a normal
        file path into a <code class="option">-C</code> option and a relative
        path:</p><a id="OEBPS/ch07s04.html.I_2_tt355"></a><pre class="programlisting"># $(è°ƒç”¨ jar-file-arg, æ–‡ä»¶å)
å®šä¹‰ jar æ–‡ä»¶å‚æ•°
  -C "$(patsubst %/,%,$(dir $1))" $(notdir $1)
æ©å¾·å¤«</pre><pre class="programlisting"># $(call jar-file-arg, file-name)
define jar-file-arg
  -C "$(patsubst %/,%,$(dir $1))" $(notdir $1)
endef</pre><p>è¾…åŠ©å‡½æ•°<code class="function">bean-classes</code>ä»Žæºæ–‡ä»¶åˆ—è¡¨ä¸­æå–é€‚å½“çš„ç±»æ–‡ä»¶ï¼ˆjar æ–‡ä»¶åªéœ€è¦æŽ¥å£å’Œä¸»ç±»ï¼‰ï¼š</p><p>The helper function <code class="function">bean-classes</code> extracts the appropriate class
        files from a source file list (the jar file only needs the interface
        and home classes):</p><a id="OEBPS/ch07s04.html.I_2_tt356"></a><pre class="programlisting"># $(è°ƒç”¨ bean-classes, bean-files-list)
å®šä¹‰beanç±»
  $(subst $(SOURCE_DIR)/,, \
    $(è¿‡æ»¤å™¨ %Interface.class %Home.class, \
      $(subst .java,.class,$1)))
æ©å¾·å¤«</pre><pre class="programlisting"># $(call bean-classes, bean-files-list)
define bean-classes
  $(subst $(SOURCE_DIR)/,,                 \
    $(filter %Interface.class %Home.class, \
      $(subst .java,.class,$1)))
endef</pre><p>ç„¶åŽé€šç”¨å‡½æ•°è°ƒç”¨é€‰æ‹©çš„ç¼–è¯‘å™¨
        <code class="literal">$(call
        $1-compile-command,$2)</code>ï¼š</p><p>Then the generic function invokes the compiler of choice with
        <code class="literal">$(call
        $1-compile-command,$2)</code>:</p><a id="OEBPS/ch07s04.html.I_2_tt357"></a><pre class="programlisting">å®šä¹‰ weblogic ç¼–è¯‘å‘½ä»¤
  cd $(TMPDIR) &amp;&amp; \
  $(JVM) weblogic.ejbc -ç¼–è¯‘å™¨ $(EJB_JAVAC) $(EJB_TMP_JAR) $1
æ©å¾·å¤«</pre><pre class="programlisting">define weblogic-compile-command
  cd $(TMPDIR) &amp;&amp; \
  $(JVM) weblogic.ejbc -compiler $(EJB_JAVAC) $(EJB_TMP_JAR) $1
endef</pre><p>æœ€åŽï¼Œæˆ‘ä»¬çš„é€šç”¨å‡½æ•°æ·»åŠ äº†æ¸…å•ã€‚</p><p>Finally, our generic function adds the manifest.</p><p>å®šä¹‰åŽ<code class="literal">compile-generic-bean</code>ï¼Œæˆ‘ä»¬å°†å…¶åŒ…è£…åœ¨æˆ‘ä»¬æƒ³è¦æ”¯æŒçš„æ¯ä¸ªçŽ¯å¢ƒçš„ç‰¹å®šäºŽç¼–è¯‘å™¨çš„å‡½æ•°ä¸­ã€‚</p><p>Having defined <code class="literal">compile-generic-bean</code>, we wrap it in a
        compiler-specific function for each environment we want to
        support.</p><a id="OEBPS/ch07s04.html.I_2_tt358"></a><pre class="programlisting"># $(è°ƒç”¨compile-weblogic-bean, jar-name,
# bean-files-wildcard, æ¸…å•åç§°-opt )
å®šä¹‰ç¼–è¯‘ weblogic-bean
  $(è°ƒç”¨compile-generic-bean,weblogic,$1,$2,$3)
æ©å¾·å¤«</pre><pre class="programlisting"># $(call compile-weblogic-bean, jar-name,
#                               bean-files-wildcard, manifest-name-opt )
define compile-weblogic-bean
  $(call compile-generic-bean,weblogic,$1,$2,$3)
endef</pre><div class="sect2" title="æ ‡å‡†å¤–å£³"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch07s04.html.make3-CHP-7-SECT-4.1"></a>æ ‡å‡†å¤–å£³</h2><h2 class="title"><a></a>A Standard Shell</h2></div></div></div><p>å€¼å¾—é‡ç”³çš„æ˜¯<a id="OEBPS/ch07s04.html.make3-CHP-7-ITERM-1439" class="indexterm"></a> <a id="OEBPS/ch07s04.html.make3-CHP-7-ITERM-1440" class="indexterm"></a>åœ¨ä»Žä¸€ä¸ªç³»ç»Ÿè¿ç§»åˆ°å¦ä¸€ä¸ªç³»ç»Ÿæ—¶ï¼Œäººä»¬å‘çŽ°çš„ä»¤äººè®¨åŽŒçš„ä¸å…¼å®¹æ€§ä¹‹ä¸€æ˜¯
          <em class="filename">/bin/shçš„åŠŸèƒ½ï¼Œå®ƒæ˜¯</em><em class="command">make</em>ä½¿ç”¨çš„é»˜è®¤ shell ã€‚å¦‚æžœæ‚¨å‘çŽ°è‡ªå·±åœ¨<em class="filename">makefile</em>ä¸­è°ƒæ•´å‘½ä»¤è„šæœ¬ï¼Œåˆ™åº”è¯¥è€ƒè™‘æ ‡å‡†åŒ–æ‚¨çš„ shellã€‚å½“ç„¶ï¼Œè¿™å¯¹äºŽ<em class="filename">makefile</em>åœ¨ä¸å—æŽ§åˆ¶çš„çŽ¯å¢ƒä¸­æ‰§è¡Œçš„å…¸åž‹å¼€æºé¡¹ç›®æ¥è¯´æ˜¯ä¸åˆç†çš„ã€‚ç„¶è€Œï¼Œåœ¨å—æŽ§çŽ¯å¢ƒä¸­ï¼Œä½¿ç”¨ä¸€ç»„å›ºå®šçš„ä¸“é—¨é…ç½®çš„æœºå™¨ï¼Œè¿™æ˜¯ç›¸å½“åˆç†çš„ã€‚</p><p>It is worth reiterating<a class="indexterm"></a> <a class="indexterm"></a> here that one of the irksome incompatibilities one
          finds in moving from system to system is the capabilities of
          <em class="filename">/bin/sh</em>, the default shell used
          by <em class="command">make</em>. If you find yourself
          tweaking the command scripts in your <em class="filename">makefile</em>, you should consider
          standardizing your shell. Of course, this is not reasonable for the
          typical open source project where the <em class="filename">makefile</em> is executed in uncontrolled
          environments. However, in a controlled setting, with a fixed set of
          specially configured machines, this is quite reasonable.</p><p>é™¤äº†é¿å… shell ä¸å…¼å®¹ä¹‹å¤–ï¼Œè®¸å¤š shell è¿˜æä¾›å¯ä»¥é¿å…ä½¿ç”¨å¤§é‡å°åž‹å®žç”¨ç¨‹åºçš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œ<em class="command">bash</em> shell åŒ…æ‹¬å¢žå¼ºçš„ shell å˜é‡æ‰©å±•ï¼Œä¾‹å¦‚<code class="literal">%%</code>å’Œ<code class="literal">##</code>ï¼Œè¿™å¯ä»¥å¸®åŠ©é¿å…ä½¿ç”¨ shell å®žç”¨ç¨‹åºï¼Œä¾‹å¦‚<em class="command">sed</em>å’Œ
          <em class="command">expr</em>ã€‚</p><p>In addition to avoiding shell incompatibilities, many shells
          provide features that can avoid the use of numerous small utilities.
          For example, the <em class="command">bash</em> shell
          includes enhanced shell variable expansion, such as <code class="literal">%%</code> and <code class="literal">##</code>, that can help avoid the use of shell
          utilities, such as <em class="command">sed</em> and
          <em class="command">expr</em>.</p></div></div></div></div>
<div id="OEBPS/ch07s05.html"><div>
<div class="sect1" title="æ±½è½¦åˆ¶é€ å•†"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch07s05.html.make3-CHP-7-SECT-5"></a>æ±½è½¦åˆ¶é€ å•†</h1><h1 class="title"><a></a>Automake</h1></div></div></div><p>æœ¬ç« é‡ç‚¹<a id="OEBPS/ch07s05.html.make3-CHP-7-ITERM-1441" class="indexterm"></a>ä¸€ç›´è‡´åŠ›äºŽæœ‰æ•ˆåœ°ä½¿ç”¨<acronym class="acronym">GNU </acronym> <em class="command">make</em>å’Œæ”¯æŒå·¥å…·æ¥å®žçŽ°å¯ç§»æ¤çš„æž„å»ºç³»ç»Ÿã€‚ç„¶è€Œï¼Œæœ‰æ—¶å³ä½¿æ˜¯è¿™äº›é€‚åº¦çš„è¦æ±‚ä¹Ÿæ— æ³•å®žçŽ°ã€‚å¦‚æžœæ‚¨æ— æ³•ä½¿ç”¨<acronym class="acronym">GNU </acronym> <em class="command">make</em>çš„å¢žå¼ºåŠŸèƒ½ï¼Œå¹¶ä¸”è¢«è¿«ä¾èµ–ä¸€ç»„æœ€å°å…¬åˆ†æ¯åŠŸèƒ½ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥è€ƒè™‘ä½¿ç”¨<em class="command">automake</em>å·¥å…·ï¼Œ<a class="ulink" href="http://www.gnu.org/software/automake/automake.html">http://www.gnu.org/software/automake/automakeã€‚ html</a>ã€‚</p><p>The focus of this chapter <a class="indexterm"></a>has been on using <acronym class="acronym">GNU</acronym> <em class="command">make</em> and supporting tools effectively to
        achieve a portable build system. There are times, however, when even
        these modest requirements are beyond reach. If you cannot use the
        enhanced features of <acronym class="acronym">GNU</acronym> <em class="command">make</em> and are forced to rely on a
        least-common-denominator set of features, you should consider using
        the <em class="command">automake</em> tool, <a class="ulink" href="http://www.gnu.org/software/automake/automake.html">http://www.gnu.org/software/automake/automake.html</a>.</p><p><em class="command">automake</em>å·¥å…·æŽ¥å—ç¨‹å¼åŒ–çš„<em class="filename">makefile</em>ä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”Ÿæˆå¯ç§»æ¤çš„æ—§å¼<em class="filename">makefile</em>ä½œä¸ºè¾“å‡ºã€‚<em class="command">automake</em>æ˜¯å›´ç»•ä¸€ç»„<em class="command">m4å®æž„å»ºçš„ï¼Œè¿™äº›å®å…è®¸åœ¨è¾“å…¥æ–‡ä»¶ï¼ˆç§°ä¸º</em><em class="filename">makefile.am</em>ï¼‰ä¸­ä½¿ç”¨éžå¸¸ç®€æ´çš„ç¬¦å·ã€‚é€šå¸¸ï¼Œ<em class="command">automakeä¸Ž</em><em class="command">autoconf</em>ï¼ˆC/C++ ç¨‹åºçš„å¯ç§»æ¤æ€§æ”¯æŒåŒ…ï¼‰ç»“åˆä½¿ç”¨
        ï¼Œä½†<em class="command">autoconf</em>ä¸æ˜¯å¿…éœ€çš„ã€‚</p><p>The <em class="command">automake</em> tool accepts a
        stylized <em class="filename">makefile</em> as input and
        generates a portable old-style <em class="filename">makefile</em> as output. <em class="command">automake</em> is built around a set of <em class="command">m4</em> macros that allow a very terse notation
        in the input file (called <em class="filename">makefile.am</em>). Typically, <em class="command">automake</em> is used in conjunction with
        <em class="command">autoconf</em>, a portability support
        package for C/C++ programs, but <em class="command">autoconf</em> is not required.</p><p>è™½ç„¶<em class="command">automake</em>å¯¹äºŽéœ€è¦æœ€å¤§å¯ç§»æ¤æ€§çš„æž„å»ºç³»ç»Ÿæ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œ
        ä½†å®ƒç”Ÿæˆçš„<em class="filename">makefileä¸èƒ½ä½¿ç”¨</em><acronym class="acronym">GNU </acronym> <em class="command">make</em>çš„ä»»ä½•é«˜çº§åŠŸèƒ½ï¼Œé™¤äº†é™„åŠ èµ‹å€¼ ä¹‹å¤–<code class="literal">+=</code>ï¼Œå®ƒå¯¹æ­¤æœ‰ç‰¹æ®Šæ”¯æŒã€‚æ­¤å¤–ï¼Œ <em class="command">automake</em>çš„è¾“å…¥ä¸Žæ­£å¸¸çš„<em class="filename">makefile</em>è¾“å…¥å‡ ä¹Žæ²¡æœ‰ç›¸ä¼¼ä¹‹å¤„
        ã€‚å› æ­¤ï¼Œä½¿ç”¨
        <em class="command">automake</em>ï¼ˆä¸å¸¦<em class="command">autoconf</em>ï¼‰ä¸Žä½¿ç”¨æœ€å°å…¬åˆ†æ¯æ–¹æ³•å¹¶æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚</p><p>While <em class="command">automake</em> is a good
        solution for build systems that require maxium portability, the
        <em class="filename">makefile</em>s it generates cannot use
        any of the advanced features of <acronym class="acronym">GNU</acronym> <em class="command">make</em> with the exception of appending
        assignment, <code class="literal">+=</code>, for which it has
        special support. Furthermore, the input to <em class="command">automake</em> bears little resemblance to normal
        <em class="filename">makefile</em> input. Thus, using
        <em class="command">automake</em> (without <em class="command">autoconf</em>) isn't terribly different from
        using the least-common-denominator approach.</p></div></div></div>
<div id="OEBPS/ch08.html"><div>
<div class="chapter" title="ç¬¬ 8 ç«  C å’Œ C++"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch08.html.make3-CHP-8"></a>ç¬¬ 8 ç«  C å’Œ C++</h1><h1 class="title"><a></a>Chapter&nbsp;8.&nbsp;C and C++</h1></div></div></div><p><a class="link" href="#OEBPS/ch06.html" title="ç¬¬ 6 ç« ç®¡ç†å¤§åž‹é¡¹ç›®">ç¬¬ 6 ç« </a>ä¸­ä»‹ç»çš„é—®é¢˜å’ŒæŠ€æœ¯åœ¨æœ¬ç« ä¸­å¾—åˆ°å¢žå¼ºå¹¶åº”ç”¨äºŽ C å’Œ C++ é¡¹ç›®ã€‚æˆ‘ä»¬å°†ç»§ç»­åœ¨éžé€’å½’<em class="filename">makefile</em>ä¸Šæž„å»º mp3 æ’­æ”¾å™¨ç¤ºä¾‹ã€‚</p><p>The issues and techniques shown in <a class="link" href="#OEBPS/ch06.html" title="Chapter&nbsp;6.&nbsp;Managing Large Projects">Chapter 6</a> are enhanced and applied in this
      chapter to C and C++ projects. We'll continue with the mp3 player
      example building on our nonrecursive <em class="filename">makefile</em>.</p><div class="sect1" title="åˆ†ç¦»æºä»£ç å’ŒäºŒè¿›åˆ¶æ–‡ä»¶"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch08.html.make3-CHP-8-SECT-1"></a>åˆ†ç¦»æºä»£ç å’ŒäºŒè¿›åˆ¶æ–‡ä»¶</h1><h1 class="title"><a></a>Separating Source and Binary</h1></div></div></div><p>å¦‚æžœæˆ‘ä»¬æƒ³æ”¯æŒå•ä¸ª<a id="OEBPS/ch08.html.make3-CHP-8-ITERM-1442" class="indexterm"></a> <a id="OEBPS/ch08.html.make3-CHP-8-ITERM-1443" class="indexterm"></a>æºæ ‘å…·æœ‰å¤šä¸ªå¹³å°å¹¶ä¸”æ¯ä¸ªå¹³å°æœ‰å¤šä¸ªæž„å»ºï¼Œå› æ­¤å¿…é¡»å°†æºæ ‘å’ŒäºŒå‰æ ‘åˆ†å¼€ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥æ€Žä¹ˆåšå‘¢ï¼Ÿ<em class="command">make</em>ç¨‹åºæœ€åˆæ˜¯ä¸ºå•ä¸ªç›®å½•ä¸­çš„æ–‡ä»¶è€Œç¼–å†™çš„ã€‚å°½ç®¡è‡ªé‚£æ—¶èµ·å®ƒå·²ç»å‘ç”Ÿäº†å·¨å¤§çš„å˜åŒ–ï¼Œä½†å®ƒå¹¶æ²¡æœ‰å¿˜è®°å®ƒçš„æ ¹æºã€‚å½“ make æ›´æ–°çš„æ–‡ä»¶ä½äºŽå½“å‰ç›®å½•ï¼ˆæˆ–å…¶å­ç›®å½•ï¼‰ä¸­æ—¶ï¼Œ<em class="command">makeå¯ä»¥æœ€å¥½åœ°å¤„ç†å¤šä¸ªç›®å½•ã€‚</em></p><p>If we want to support a single <a class="indexterm"></a> <a class="indexterm"></a>source tree with multiple platforms and multiple builds
        per platform, separating the source and binary trees is necessary, so
        how do we do it? The <em class="command">make</em> program
        was originally written to work well for files in a single directory.
        Although it has changed dramatically since then, it hasn't forgotten
        its roots. <em class="command">make</em> works with multiple
        directories best when the files it is updating live in the current
        directory (or its subdirectories).</p><div class="sect2" title="ç®€å•çš„æ–¹æ³•"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch08.html.make3-CHP-8-SECT-1.1"></a>ç®€å•çš„æ–¹æ³•</h2><h2 class="title"><a></a>The Easy Way</h2></div></div></div><p><em class="command">è®©make</em>å°†äºŒè¿›åˆ¶æ–‡ä»¶æ”¾ç½®åœ¨ä¸Žæºä»£ç ä¸åŒçš„ç›®å½•ä¸­çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä»ŽäºŒè¿›åˆ¶ç›®å½•
          å¯åŠ¨<em class="command">make</em>ç¨‹åºã€‚è¾“å‡ºæ–‡ä»¶æ˜¯ä½¿ç”¨ç›¸å¯¹è·¯å¾„è®¿é—®çš„ï¼Œå¦‚ä¸Šä¸€ç« æ‰€ç¤ºï¼Œè€Œè¾“å…¥æ–‡ä»¶å¿…é¡»é€šè¿‡æ˜¾å¼è·¯å¾„æˆ–é€šè¿‡æœç´¢æ¥æ‰¾åˆ°<code class="literal">vpath</code>ã€‚æ— è®ºå“ªç§æƒ…å†µï¼Œæˆ‘ä»¬éƒ½éœ€è¦åœ¨å¤šä¸ªä½ç½®å¼•ç”¨æºç›®å½•ï¼Œå› æ­¤æˆ‘ä»¬ä»Žä¸€ä¸ªå˜é‡æ¥ä¿å­˜å®ƒï¼š</p><p>The easiest way to get <em class="command">make</em>
          to place binaries in a separate directory from sources is to start
          the <em class="command">make</em> program from the binary
          directory. The output files are accessed using relative paths, as
          shown in the previous chapter, while the input files must be found
          either through explicit paths or through searching through <code class="literal">vpath</code>. In either case, we'll need to refer
          to the source directory in several places, so we start with a
          variable to hold it:</p><a id="OEBPS/ch08.html.I_3_tt359"></a><pre class="programlisting">SOURCE_DIR := ../mp3_player</pre><pre class="programlisting">SOURCE_DIR := ../mp3_player</pre><p><em class="filename">åœ¨æˆ‘ä»¬ä¹‹å‰çš„makefile çš„</em>åŸºç¡€ä¸Šæž„å»ºï¼Œè¯¥<code class="function">source-to-object</code>å‡½æ•°æœªæ›´æ”¹ï¼Œä½†è¯¥<code class="function">subdirectory</code>å‡½æ•°çŽ°åœ¨éœ€è¦è€ƒè™‘æºçš„ç›¸å¯¹è·¯å¾„ã€‚</p><p>Building on our previous <em class="filename">makefile</em>, the <code class="function">source-to-object</code> function is unchanged,
          but the <code class="function">subdirectory</code> function
          now needs to take into account the relative path to the
          source.</p><a id="OEBPS/ch08.html.I_3_tt360"></a><pre class="programlisting"># $(è°ƒç”¨æºåˆ°å¯¹è±¡ï¼Œæºæ–‡ä»¶åˆ—è¡¨)
æºåˆ°å¯¹è±¡ = $(subst .c,.o,$(filter %.c,$1)) \
                   $(subst .y,.o,$(è¿‡æ»¤å™¨ %.y,$1)) \
                   $(subst .l,.o,$(è¿‡æ»¤å™¨ %.l,$1))

# $(å­ç›®å½•)
å­ç›®å½• = $(patsubst $(SOURCE_DIR)/%/module.mk,%, \
                 $(å•è¯\
                   $(å•è¯$(MAKEFILE_LIST)),$(MAKEFILE_LIST)))</pre><pre class="programlisting"># $(call source-to-object, source-file-list)
source-to-object = $(subst .c,.o,$(filter %.c,$1)) \
                   $(subst .y,.o,$(filter %.y,$1)) \
                   $(subst .l,.o,$(filter %.l,$1))

# $(subdirectory)
subdirectory = $(patsubst $(SOURCE_DIR)/%/module.mk,%,  \
                 $(word                                 \
                   $(words $(MAKEFILE_LIST)),$(MAKEFILE_LIST)))</pre><p>åœ¨æˆ‘ä»¬çš„æ–°<em class="filename">makefile</em>ä¸­ï¼Œåˆ—å‡ºçš„æ–‡ä»¶<code class="literal">MAKEFILE_LIST</code>
          å°†åŒ…å«æºçš„ç›¸å¯¹è·¯å¾„ã€‚å› æ­¤ï¼Œè¦æå–æ¨¡å—ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼Œæˆ‘ä»¬å¿…é¡»åŽ»æŽ‰å‰ç¼€å’Œ<em class="filename">module.mk</em>
          åŽç¼€ã€‚</p><p>In our new <em class="filename">makefile</em>, the
          files listed in the <code class="literal">MAKEFILE_LIST</code>
          will include the relative path to the source. So to extract the
          relative path to the module's directory, we must strip off the
          prefix as well as the <em class="filename">module.mk</em>
          suffix.</p><p>æŽ¥ä¸‹æ¥ï¼Œä¸ºäº†å¸®åŠ©<em class="command">æ‰¾åˆ°</em>æ¥æºï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹<code class="literal">vpath</code>
          åŠŸèƒ½ï¼š</p><p>Next, to help <em class="command">make</em> find the
          sources, we use the <code class="literal">vpath</code>
          feature:</p><a id="OEBPS/ch08.html.I_3_tt361"></a><pre class="programlisting">vpath %.y $(SOURCE_DIR)
vpath %.l $(SOURCE_DIR)
vpath %.c $(SOURCE_DIR)</pre><pre class="programlisting">vpath %.y $(SOURCE_DIR)
vpath %.l $(SOURCE_DIR)
vpath %.c $(SOURCE_DIR)</pre><p>è¿™å…è®¸æˆ‘ä»¬å¯¹æºæ–‡ä»¶å’Œè¾“å‡ºæ–‡ä»¶ä½¿ç”¨ç®€å•çš„ç›¸å¯¹è·¯å¾„ã€‚å½“<em class="command">make</em>éœ€è¦æºæ–‡ä»¶æ—¶ï¼Œ
          <code class="literal">SOURCE_DIR</code>å¦‚æžœåœ¨è¾“å‡ºæ ‘çš„å½“å‰ç›®å½•ä¸­æ‰¾ä¸åˆ°è¯¥æ–‡ä»¶ï¼Œå®ƒå°†è¿›è¡Œæœç´¢ã€‚æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¿…é¡»æ›´æ–°<code class="literal">include_dirs</code>
          å˜é‡ï¼š</p><p>This allows us to use simple relative paths for our source
          files as well as our output files. When <em class="command">make</em> needs a source file, it will search
          <code class="literal">SOURCE_DIR</code> if it cannot find the
          file in the current directory of the output tree. Next, we must
          update the <code class="literal">include_dirs</code>
          variable:</p><a id="OEBPS/ch08.html.I_3_tt362"></a><pre class="programlisting">include_dirs := lib $(SOURCE_DIR)/lib $(SOURCE_DIR)/include</pre><pre class="programlisting">include_dirs := lib $(SOURCE_DIR)/lib $(SOURCE_DIR)/include</pre><p>é™¤äº†æºç›®å½•ä¹‹å¤–ï¼Œè¯¥å˜é‡çŽ°åœ¨è¿˜åŒ…æ‹¬äºŒè¿›åˆ¶æ ‘ä¸­çš„<em class="filename">libç›®å½•ï¼Œå› ä¸ºç”Ÿæˆçš„</em><em class="command">yacc</em>å’Œ<em class="command">lex</em>å¤´æ–‡ä»¶å°†æ”¾ç½®åœ¨é‚£é‡Œã€‚</p><p>In addition to the source directories, this variable now
          includes the <em class="filename">lib</em> directory from
          the binary tree because the generated <em class="command">yacc</em> and <em class="command">lex</em> header files will be placed
          there.</p><p>å¿…é¡»æ›´æ–°makeæŒ‡ä»¤æ‰èƒ½ä»Žæºç›®å½•è®¿é—®<em class="filename">module.mkæ–‡ä»¶</em><em class="command">ï¼Œå› ä¸º</em> <em class="command">make</em>ä¸ä½¿ç”¨ æ¥æŸ¥æ‰¾åŒ…å«æ–‡ä»¶ï¼š<code class="literal">include</code><em class="filename"></em><em class="command"></em><code class="literal">vpath</code></p><p>The <em class="command">make</em> <code class="literal">include</code> directive must be updated to
          access the <em class="filename">module.mk</em> files from
          their source directories since <em class="command">make</em> does not use the <code class="literal">vpath</code> to find include files:</p><a id="OEBPS/ch08.html.I_3_tt363"></a><pre class="programlisting">åŒ…æ‹¬ $(patsubst %,$(SOURCE_DIR)/%/module.mk,$(modules))</pre><pre class="programlisting">include $(patsubst %,$(SOURCE_DIR)/%/module.mk,$(modules))</pre><p>æœ€åŽï¼Œæˆ‘ä»¬è‡ªå·±åˆ›å»ºè¾“å‡ºç›®å½•ï¼š</p><p>Finally, we create the output directories themselves:</p><a id="OEBPS/ch08.html.I_3_tt364"></a><pre class="programlisting">åˆ›å»ºè¾“å‡ºç›®å½• := \
        $($(æ¨¡å—) ä¸­çš„ f çš„ shell; \
                åš \
                  $(æµ‹è¯•) -d $$f || $(MKDIR) $$f; \
                å®Œæ¯•ï¼‰</pre><pre class="programlisting">create-output-directories :=                            \
        $(shell for f in $(modules);                    \
                do                                      \
                  $(TEST) -d $$f || $(MKDIR) $$f;       \
                done)</pre><p>æ­¤èµ‹å€¼åˆ›å»ºäº†ä¸€ä¸ªè™šæ‹Ÿå˜é‡ï¼Œå…¶å€¼ä»Žæœªä½¿ç”¨è¿‡ï¼Œä½†ç”±äºŽç®€å•çš„å˜é‡èµ‹å€¼ï¼Œæˆ‘ä»¬ä¿è¯åœ¨<em class="command">make</em>æ‰§è¡Œä»»ä½•å…¶ä»–å·¥ä½œä¹‹å‰å°†åˆ›å»ºç›®å½•ã€‚æˆ‘ä»¬å¿…é¡»â€œæ‰‹åŠ¨â€åˆ›å»ºç›®å½•ï¼Œå› ä¸º<em class="command">yacc</em>ã€<em class="command">lex</em>å’Œä¾èµ–æ–‡ä»¶ç”Ÿæˆæœ¬èº«ä¸ä¼šåˆ›å»ºè¾“å‡ºç›®å½•ã€‚</p><p>This assignment creates a dummy variable whose value is never
          used, but because of the simple variable assignment we are
          guaranteed that the directories will be created before <em class="command">make</em> performs any other work. We must
          create the directories "by hand" because <em class="command">yacc</em>, <em class="command">lex</em>, and the dependency file generation
          will not create the output directories themselves.</p><p>ç¡®ä¿åˆ›å»ºè¿™äº›ç›®å½•çš„å¦ä¸€ç§æ–¹æ³•æ˜¯å°†è¿™äº›ç›®å½•ä½œä¸ºå…ˆå†³æ¡ä»¶æ·»åŠ åˆ°ä¾èµ–é¡¹æ–‡ä»¶ï¼ˆ
           <em class="filename">.d</em>æ–‡ä»¶ï¼‰ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ªåä¸»æ„ï¼Œå› ä¸ºè¯¥ç›®å½•å¹¶ä¸æ˜¯çœŸæ­£çš„å…ˆå†³æ¡ä»¶ã€‚ yacc <em class="command">ã€</em> lexæˆ–ä¾èµ–æ–‡ä»¶ä¸ä¾èµ–äºŽç›®å½•çš„<span class="emphasis"><em>å†…å®¹</em></span><em class="command">ï¼Œä¹Ÿä¸åº”è¯¥ä»…ä»…å› ä¸ºç›®å½•æ—¶é—´æˆ³æ›´æ–°è€Œ</em>é‡æ–°ç”Ÿæˆå®ƒä»¬ã€‚äº‹å®žä¸Šï¼Œå¦‚æžœåœ¨è¾“å‡ºç›®å½•ä¸­æ·»åŠ æˆ–åˆ é™¤æ–‡ä»¶æ—¶é‡æ–°åˆ¶ä½œé¡¹ç›®ï¼Œè¿™å°†å¯¼è‡´æ•ˆçŽ‡æžä½Žã€‚<span class="emphasis"><em></em></span></p><p>Another way to ensure these directories are created is to add
          the directories as prerequisites to the dependency files (the
          <em class="filename">.d</em> files). This is a bad idea
          because the directory is not really a prerequisite. The <em class="command">yacc</em>, <em class="command">lex</em>, or dependency files do not depend on
          the <span class="emphasis"><em>contents</em></span> of the directory, nor should they
          be regenerated just because the directory timestamp is updated. In
          fact, this would be a source of great inefficiency if the project
          were remade when a file was added or removed from an output
          directory.</p><p><em class="filename">å¯¹module.mk</em>æ–‡ä»¶çš„ä¿®æ”¹å°±æ›´ç®€å•äº†ï¼š</p><p>The modifications to the <em class="filename">module.mk</em> file are even simpler:</p><a id="OEBPS/ch08.html.I_3_tt365"></a><pre class="programlisting">local_src := $(addprefix $(å­ç›®å½•)/,playlist.y Scanner.l)

$(eval $(è°ƒç”¨ make-library, $(å­ç›®å½•)/libdb.a, $(local_src)))

.SECONDARYï¼š$ï¼ˆè°ƒç”¨ç”Ÿæˆæºï¼Œ$ï¼ˆlocal_srcï¼‰ï¼‰

$(å­ç›®å½•)/scanner.d: $(å­ç›®å½•)/playlist.d</pre><pre class="programlisting">local_src := $(addprefix $(subdirectory)/,playlist.y scanner.l)

$(eval $(call make-library, $(subdirectory)/libdb.a, $(local_src)))

.SECONDARY: $(call generated-source, $(local_src))

$(subdirectory)/scanner.d: $(subdirectory)/playlist.d</pre><p>æ­¤ç‰ˆæœ¬çœç•¥äº†é€šé…ç¬¦æ¥æŸ¥æ‰¾æºã€‚æ¢å¤æ­¤åŠŸèƒ½æ˜¯ä¸€ä»¶ç®€å•çš„äº‹æƒ…ï¼Œç•™ç»™è¯»è€…ä½œä¸ºç»ƒä¹ ã€‚æœ‰ä¸€ä¸ªå°æ•…éšœä¼¼ä¹Žæ˜¯åŽŸå§‹<em class="filename">makefile</em>ä¸­çš„ä¸€ä¸ªé”™è¯¯ã€‚è¿è¡Œæ­¤ç¤ºä¾‹æ—¶ï¼Œæˆ‘å‘çŽ°<em class="filename">Scanner.d</em>ä¾èµ–æ–‡ä»¶æ˜¯åœ¨å®ƒæ‰€ä¾èµ–çš„<em class="filename">playlist.h</em>ä¹‹å‰ç”Ÿæˆçš„ã€‚åŽŸå§‹<em class="filename">makefile</em>ä¸­ç¼ºå°‘æ­¤ä¾èµ–é¡¹
          ï¼Œä½†å®ƒçš„å·¥ä½œæ— è®ºå¦‚ä½•çº¯ç²¹æ˜¯å¶ç„¶çš„ã€‚å³ä½¿åœ¨å°åž‹é¡¹ç›®ä¸­ï¼Œç¡®ä¿<span class="emphasis"><em>æ‰€æœ‰</em></span>ä¾èµ–å…³ç³»æ­£ç¡®ä¹Ÿæ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚</p><p>This version omits the wildcard to find the source. It is a
          straightforward matter to restore this feature and is left as an
          exercise for the reader. There is one glitch that appears to be a
          bug in the original <em class="filename">makefile</em>.
          When this example was run, I discovered that the <em class="filename">scanner.d</em> dependency file was being
          generated before <em class="filename">playlist.h</em>,
          which it depends upon. This dependency was missing from the original
          <em class="filename">makefile</em>, but it worked anyway
          purely by accident. Getting <span class="emphasis"><em>all</em></span> the
          dependencies right is a difficult task, even in small
          projects.</p><p>å‡è®¾æºä»£ç ä½äºŽå­ç›®å½•<em class="filename">mp3_playerä¸­ï¼Œä»¥ä¸‹æ˜¯æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨æ–°çš„</em><em class="filename">makefile</em>æž„å»ºé¡¹ç›®ï¼š</p><p>Assuming the source is in the subdirectory <em class="filename">mp3_player</em>, here is how we build our
          project with the new <em class="filename">makefile</em>:</p><a id="OEBPS/ch08.html.I_3_tt366"></a><pre class="programlisting">$ mkdir mp3_player_out
$ cd mp3_player_out
$ make --file=../mp3_player/makefile</pre><pre class="programlisting">$ mkdir mp3_player_out
$ cd mp3_player_out
$ make --file=../mp3_player/makefile</pre><p>makefileæ˜¯æ­£ç¡®çš„å¹¶ä¸”è¿è¡Œè‰¯å¥½ï¼Œä½†æ˜¯è¢«è¿«å°†ç›®å½•æ›´æ”¹ä¸ºè¾“å‡ºç›®å½•ï¼Œç„¶åŽè¢«è¿«æ·»åŠ 
          ( ) é€‰é¡¹ï¼Œ<em class="filename">è¿™</em>ç›¸å½“çƒ¦äººã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„ shell è„šæœ¬æ¥è§£å†³ï¼š<code class="option">â€”file</code><code class="option">-f</code></p><p>The <em class="filename">makefile</em> is correct
          and works well, but it is rather annoying to be forced to change
          directories to the output directory and then be forced to add the
          <code class="option">â€”file</code> (<code class="option">-f</code>) option. This can be
          cured with a simple shell script:</p><a id="OEBPS/ch08.html.I_3_tt367"></a><pre class="programlisting">#ï¼ /bin/bash
å¦‚æžœ [[ ï¼ -d $OUTPUT_DIR ]]
ç„¶åŽ
  å¦‚æžœ ï¼ mkdir -p $OUTPUT_DIR
  ç„¶åŽ
    echoâ€œæ— æ³•åˆ›å»ºè¾“å‡ºç›®å½•â€&gt; /dev/stderr
    1å·å‡ºå£
  è²
è²

cd $OUTPUT_DIR
make --file=$SOURCE_DIR/makefile "$@"</pre><pre class="programlisting">#! /bin/bash
if [[ ! -d $OUTPUT_DIR ]]
then
  if ! mkdir -p $OUTPUT_DIR
  then
    echo "Cannot create output directory" &gt; /dev/stderr
    exit 1
  fi
fi

cd $OUTPUT_DIR
make --file=$SOURCE_DIR/makefile "$@"</pre><p>è¯¥è„šæœ¬å‡è®¾æºç›®å½•å’Œè¾“å‡ºç›®å½•åˆ†åˆ«å­˜å‚¨åœ¨çŽ¯å¢ƒå˜é‡<code class="literal">SOURCE_DIR</code>å’Œä¸­<code class="literal">OUTPUT_DIR</code>ã€‚è¿™æ˜¯ä¸€ç§æ ‡å‡†åšæ³•ï¼Œå…è®¸å¼€å‘äººå‘˜è½»æ¾åˆ‡æ¢æ ‘ï¼Œä½†ä»é¿å…è¿‡äºŽé¢‘ç¹åœ°é”®å…¥è·¯å¾„ã€‚</p><p>This script assumes the source and output directories are
          stored in the environment variables <code class="literal">SOURCE_DIR</code> and <code class="literal">OUTPUT_DIR</code>, respectively. This is a
          standard practice that allows developers to switch trees easily but
          still avoid typing paths too frequently.</p><p>æœ€åŽä¸€ç‚¹è­¦å‘Šã€‚<em class="command">make</em>æˆ–<em class="filename">makefile</em>ä¸­æ²¡æœ‰ä»»ä½•å†…å®¹å¯ä»¥é˜»æ­¢å¼€å‘äººå‘˜ä»Žæºä»£ç â€‹â€‹æ ‘æ‰§è¡Œ makefile <em class="filename">ï¼Œ</em>å³ä½¿å®ƒåº”è¯¥ä»ŽäºŒè¿›åˆ¶æ ‘æ‰§è¡Œã€‚è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„é”™è¯¯ï¼ŒæŸäº›å‘½ä»¤è„šæœ¬å¯èƒ½è¡¨çŽ°ä¸ä½³ã€‚ä¾‹å¦‚ï¼Œ<code class="literal">clean</code>
          ç›®æ ‡ï¼š</p><p>One last caution. There is nothing in <em class="command">make</em> or our <em class="filename">makefile</em> to prevent a developer from
          executing the <em class="filename">makefile</em> from the
          source tree, even though it should be executed from the binary tree.
          This is a common mistake and some command scripts might behave
          badly. For instance, the <code class="literal">clean</code>
          target:</p><a id="OEBPS/ch08.html.I_3_tt368"></a><pre class="programlisting">.PHONYï¼šå¹²å‡€
å¹²å‡€çš„ï¼š
        $(RM) -r *</pre><pre class="programlisting">.PHONY: clean
clean:
        $(RM) -r *</pre><p>å°†åˆ é™¤ç”¨æˆ·çš„æ•´ä¸ªæºä»£ç æ ‘ï¼å“Žå‘€ã€‚åœ¨æœ€é«˜çº§åˆ«çš„<em class="filename">makefile</em>ä¸­æ·»åŠ å¯¹è¿™ç§å¯èƒ½æ€§çš„æ£€æŸ¥ä¼¼ä¹Žæ˜¯è°¨æ…Žçš„åšæ³•ã€‚è¿™æ˜¯ä¸€ä¸ªåˆç†çš„æ£€æŸ¥ï¼š</p><p>would delete the user's entire source tree! Oops. It seems
          prudent to add a check for this eventuality in the <em class="filename">makefile</em> at the highest level. Here is a
          reasonable check:</p><a id="OEBPS/ch08.html.I_3_tt369"></a><pre class="programlisting">$(å¦‚æžœ $(è¿‡æ»¤å™¨ $(notdir $(SOURCE_DIR)),$(notdir $(CURDIR))),\
  $(é”™è¯¯è¯·ä»ŽäºŒå‰æ ‘è¿è¡Œ makefileã€‚))</pre><pre class="programlisting">$(if $(filter $(notdir $(SOURCE_DIR)),$(notdir $(CURDIR))),\
  $(error Please run the makefile from the binary tree.))</pre><p>æ­¤ä»£ç æµ‹è¯•å½“å‰å·¥ä½œç›®å½• ( ) çš„åç§°æ˜¯å¦<code class="literal">$(notdir $(CURDIR))</code>ä¸Žæºç›®å½• ( ) ç›¸åŒ<code class="literal">$(notdir
          $(SOURCE_DIR))</code>ã€‚å¦‚æžœæ˜¯è¿™æ ·ï¼Œåˆ™æ‰“å°é”™è¯¯å¹¶é€€å‡ºã€‚ç”±äºŽ<code class="function">if</code>å’Œ<code class="function">error</code>å‡½æ•°æ‰©å±•ä¸ºç©ºï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸¤è¡Œç´§æŽ¥åœ¨ çš„å®šä¹‰ä¹‹åŽ<code class="literal">SOURCE_DIR</code>ã€‚</p><p>This code tests if the name of the current working directory
          (<code class="literal">$(notdir $(CURDIR))</code>) is the same
          as the source directory (<code class="literal">$(notdir
          $(SOURCE_DIR))</code>). If so, print the error and exit. Since
          the <code class="function">if</code> and <code class="function">error</code> functions expand to nothing, we can
          place these two lines immediately after the definition of <code class="literal">SOURCE_DIR</code>.</p></div><div class="sect2" title="è‰°éš¾çš„é“è·¯"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch08.html.make3-CHP-8-SECT-1.2"></a>è‰°éš¾çš„é“è·¯</h2><h2 class="title"><a></a>The Hard Way</h2></div></div></div><p>ä¸€äº›å¼€å‘äººå‘˜å‘çŽ°å¿…é¡»<em class="command">cd</em>è¿›å…¥äºŒå‰æ ‘éžå¸¸çƒ¦äººï¼Œä»¥è‡³äºŽä»–ä»¬ä¼šç«­å°½å…¨åŠ›é¿å…å®ƒï¼Œæˆ–è€…<em class="filename">makefile</em>ç»´æŠ¤è€…å¯èƒ½æ­£åœ¨ shell è„šæœ¬åŒ…è£…å™¨æˆ–åˆ«åä¸é€‚åˆçš„çŽ¯å¢ƒä¸­å·¥ä½œã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œéƒ½å¯ä»¥ä¿®æ”¹<em class="filename">makefileä»¥å…è®¸ä»Žæºä»£ç æ ‘è¿è¡Œ</em><em class="command">make</em> 
          ï¼Œå¹¶é€šè¿‡åœ¨æ‰€æœ‰è¾“å‡ºæ–‡ä»¶åå‰åŠ ä¸Šè·¯å¾„å‰ç¼€å°†äºŒè¿›åˆ¶æ–‡ä»¶æ”¾ç½®åœ¨å•ç‹¬çš„è¾“å‡ºæ ‘ä¸­ã€‚æ­¤æ—¶ï¼Œæˆ‘é€šå¸¸ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œå› ä¸ºè¿™æä¾›äº†æ›´å¤§çš„çµæ´»æ€§ï¼Œå°½ç®¡å®ƒç¡®å®žåŠ å‰§äº†å‘½ä»¤è¡Œé•¿åº¦é™åˆ¶çš„é—®é¢˜ã€‚è¾“å…¥æ–‡ä»¶ç»§ç»­ä½¿ç”¨<em class="filename">makefile</em>
          ç›®å½•ä¸­çš„ç®€å•ç›¸å¯¹è·¯å¾„ã€‚</p><p>Some developers find having to <em class="command">cd</em> into the binary tree so annoying that
          they will go to great lengths to avoid it, or maybe the <em class="filename">makefile</em> maintainer is working in an
          environment where shell script wrappers or aliases are unsuitable.
          In any case, the <em class="filename">makefile</em> can
          be modified to allow running <em class="command">make</em>
          from the source tree and placing binary files in a separate output
          tree by prefixing all the output filenames with a path. At this
          point I usually go with absolute paths since this provides more
          flexibility, although it does exacerbate problems with command-line
          length limits. The input files continue to use simple relative paths
          from the <em class="filename">makefile</em>
          directory.</p><p><a class="link" href="#OEBPS/ch08.html.make3-CHP-8-EX-1" title="ä¾‹8-1ã€‚ä¸€ä¸ªå°†æºä»£ç å’ŒäºŒè¿›åˆ¶æ–‡ä»¶åˆ†å¼€çš„ makefileï¼Œå¯ä»¥ä»Žæºä»£ç æ ‘æ‰§è¡Œ">ç¤ºä¾‹ 8-1</a>æ˜¾ç¤ºäº†
          ä¿®æ”¹åŽçš„<em class="filename">makefile</em>ï¼Œä»¥å…è®¸ä»Žæºä»£ç æ ‘æ‰§è¡Œ<em class="command">make</em>å¹¶å°†äºŒè¿›åˆ¶æ–‡ä»¶å†™å…¥äºŒè¿›åˆ¶æ ‘ã€‚</p><p><a class="link" href="#OEBPS/ch08.html.make3-CHP-8-EX-1" title="Example&nbsp;8-1.&nbsp;A makefile separating source and binary that can be executed from the source tree">Example 8-1</a> shows the
          <em class="filename">makefile</em> modified to allow
          executing <em class="command">make</em> from the source
          tree and writing binary files to a binary tree.</p><div class="example"><a id="OEBPS/ch08.html.make3-CHP-8-EX-1"></a><p class="title">ä¾‹8-1ã€‚ä¸€ä¸ªå°†æºä»£ç å’ŒäºŒè¿›åˆ¶æ–‡ä»¶åˆ†å¼€çš„ makefileï¼Œå¯ä»¥ä»Žæºä»£ç æ ‘æ‰§è¡Œ</p><p class="title">Example&nbsp;8-1.&nbsp;A makefile separating source and binary that can be
            executed from the source tree</p><div class="example-contents"><pre class="programlisting">SOURCE_DIR := /test/book/examples/ch07-separate-binaries-1
BINARY_DIR := /test/book/out/mp3_player_out

# $(è°ƒç”¨æºç›®å½•åˆ°äºŒè¿›åˆ¶ç›®å½•ï¼Œç›®å½•åˆ—è¡¨)
æºç›®å½•åˆ°äºŒè¿›åˆ¶ç›®å½• = $(addprefix $(BINARY_DIR)/, $1)

# $(è°ƒç”¨æºåˆ°å¯¹è±¡ï¼Œæºæ–‡ä»¶åˆ—è¡¨)
æºåˆ°å¯¹è±¡ = $(è°ƒç”¨æºç›®å½•åˆ°äºŒè¿›åˆ¶ç›®å½•ï¼Œ\
                     $(subst .c,.o,$(è¿‡æ»¤å™¨ %.c,$1)) \
                     $(subst .y,.o,$(è¿‡æ»¤å™¨ %.y,$1)) \
                     $(subst .l,.o,$(è¿‡æ»¤å™¨ %.l,$1)))

# $(å­ç›®å½•)
å­ç›®å½• = $(patsubst %/module.mk,%, \
                 $(å•è¯\
                   $(å•è¯$(MAKEFILE_LIST)),$(MAKEFILE_LIST)))

# $(è°ƒç”¨ make-library, åº“å, æºæ–‡ä»¶åˆ—è¡¨)
å®šä¹‰ make-library
  åº“ += $(BINARY_DIR)/$1
  æ¥æº += $2

  $(BINARY_DIR)/$1: $(è°ƒç”¨æºç›®å½•åˆ°äºŒè¿›åˆ¶ç›®å½•ï¼Œ\
                      $(subst .c,.o,$(è¿‡æ»¤å™¨ %.c,$2)) \
                      $(subst .y,.o,$(è¿‡æ»¤å™¨ %.y,$2)) \
                      $(subst .l,.o,$(è¿‡æ»¤å™¨ %.l,$2)))
        $(AR) $(ARFLAGS) $$@ $$^
æ©å¾·å¤«

# $(è°ƒç”¨ç”Ÿæˆæºï¼Œæºæ–‡ä»¶åˆ—è¡¨)
ç”Ÿæˆçš„æº = $(è°ƒç”¨æºç›®å½•åˆ°äºŒè¿›åˆ¶ç›®å½•ï¼Œ\
                     $(subst .y,.c,$(è¿‡æ»¤å™¨ %.y,$1)) \
                     $(subst .y,.h,$(è¿‡æ»¤å™¨ %.y,$1)) \
                     $(subst .l,.c,$(è¿‡æ»¤å™¨ %.l,$1))) \
                   $(è¿‡æ»¤%.c,$1)

# $(ç¼–è¯‘è§„åˆ™)
å®šä¹‰ç¼–è¯‘è§„åˆ™
  $(foreach f, $(local_src),\
    $(è°ƒç”¨å•ç¼–è¯‘è§„åˆ™,$(è°ƒç”¨æºåˆ°å¯¹è±¡,$f),$f))
æ©å¾·å¤«

# $(è°ƒç”¨å•ç¼–è¯‘è§„åˆ™ã€äºŒè¿›åˆ¶æ–‡ä»¶ã€æºæ–‡ä»¶)
å®šä¹‰ä¸€æ¬¡ç¼–è¯‘è§„åˆ™
  $1ï¼š$ï¼ˆè°ƒç”¨ç”Ÿæˆæºï¼Œ$2ï¼‰
        $(COMPILE.c) -o $$@ $$&lt;

  $(subst .o,.d,$1): $(è°ƒç”¨ç”Ÿæˆæº,$2)
        $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -M $$&lt; | \
        $(SED) 's,\($$(notdir $$*)\.o\) *:,$$(dir $$@)\1 $$@: ,' &gt; $$@.tmp
        $(MV) $$@.tmp $$@

æ©å¾·å¤«

æ¨¡å—ï¼š= lib /ç¼–è§£ç å™¨lib / db lib / uiåº”ç”¨ç¨‹åº/æ’­æ”¾å™¨
ç¨‹åº:=
åº“:=
æ¥æº:=

å¯¹è±¡ = $(è°ƒç”¨æºåˆ°å¯¹è±¡,$(æº))
ä¾èµ–é¡¹ = $(subst .o,.d,$(å¯¹è±¡))

include_dirs := $(BINARY_DIR)/lib lib åŒ…å«
CPPFLAGS += $(addprefix -I ,$(include_dirs))
vpath %.h $(include_dirs)

MKDIR := mkdir -p
MV := mv -f
RM := rm -f
SED := sed
æµ‹è¯•ï¼š=æµ‹è¯•

åˆ›å»ºè¾“å‡ºç›®å½• := \
        $(shell for f in $(call source-dir-to-binary-dir,$(modules)); \
                åš \
                  $(æµ‹è¯•) -d $$f || $(MKDIR) $$f; \
                å®Œæ¯•ï¼‰

å…¨éƒ¨ï¼š

åŒ…æ‹¬ $(addsuffix /module.mk,$(modules))

.PHONYï¼šå…¨éƒ¨
å…¨éƒ¨ï¼š$ï¼ˆç¨‹åºï¼‰

.PHONYï¼šåº“
å›¾ä¹¦é¦†ï¼š$ï¼ˆå›¾ä¹¦é¦†ï¼‰

.PHONYï¼šå¹²å‡€
å¹²å‡€çš„ï¼š
        $(RM) -r $(BINARY_DIR)

ifneq "$(MAKECMDGOALS)" "å¹²å‡€"
  åŒ…æ‹¬ $(ä¾èµ–é¡¹)
ä¸‡ä¸€</pre><pre class="programlisting">SOURCE_DIR := /test/book/examples/ch07-separate-binaries-1
BINARY_DIR := /test/book/out/mp3_player_out

# $(call source-dir-to-binary-dir, directory-list)
source-dir-to-binary-dir = $(addprefix $(BINARY_DIR)/, $1)

# $(call source-to-object, source-file-list)
source-to-object = $(call source-dir-to-binary-dir,     \
                     $(subst .c,.o,$(filter %.c,$1))    \
                     $(subst .y,.o,$(filter %.y,$1))    \
                     $(subst .l,.o,$(filter %.l,$1)))

# $(subdirectory)
subdirectory = $(patsubst %/module.mk,%,                \
                 $(word                                 \
                   $(words $(MAKEFILE_LIST)),$(MAKEFILE_LIST)))

# $(call make-library, library-name, source-file-list)
define make-library
  libraries += $(BINARY_DIR)/$1
  sources   += $2

  $(BINARY_DIR)/$1: $(call source-dir-to-binary-dir,    \
                      $(subst .c,.o,$(filter %.c,$2))   \
                      $(subst .y,.o,$(filter %.y,$2))   \
                      $(subst .l,.o,$(filter %.l,$2)))
        $(AR) $(ARFLAGS) $$@ $$^
endef

# $(call generated-source, source-file-list)
generated-source = $(call source-dir-to-binary-dir,     \
                     $(subst .y,.c,$(filter %.y,$1))    \
                     $(subst .y,.h,$(filter %.y,$1))    \
                     $(subst .l,.c,$(filter %.l,$1)))   \
                   $(filter %.c,$1)

# $(compile-rules)
define compile-rules
  $(foreach f, $(local_src),\
    $(call one-compile-rule,$(call source-to-object,$f),$f))
endef

# $(call one-compile-rule, binary-file, source-files)
define one-compile-rule
  $1: $(call generated-source,$2)
        $(COMPILE.c) -o $$@ $$&lt;

  $(subst .o,.d,$1): $(call generated-source,$2)
        $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -M $$&lt; | \
        $(SED) 's,\($$(notdir $$*)\.o\) *:,$$(dir $$@)\1 $$@: ,' &gt; $$@.tmp
        $(MV) $$@.tmp $$@

endef

modules      := lib/codec lib/db lib/ui app/player
programs     :=
libraries    :=
sources      :=

objects      =  $(call source-to-object,$(sources))
dependencies =  $(subst .o,.d,$(objects))

include_dirs := $(BINARY_DIR)/lib lib include
CPPFLAGS     += $(addprefix -I ,$(include_dirs))
vpath %.h $(include_dirs)

MKDIR := mkdir -p
MV    := mv -f
RM    := rm -f
SED   := sed
TEST  := test

create-output-directories :=                                            \
        $(shell for f in $(call source-dir-to-binary-dir,$(modules));   \
                do                                                      \
                  $(TEST) -d $$f || $(MKDIR) $$f;                       \
                done)

all:

include $(addsuffix /module.mk,$(modules))

.PHONY: all
all: $(programs)

.PHONY: libraries
libraries: $(libraries)

.PHONY: clean
clean:
        $(RM) -r $(BINARY_DIR)

ifneq "$(MAKECMDGOALS)" "clean"
  include $(dependencies)
endif</pre></div></div><p>åœ¨æ­¤ç‰ˆæœ¬ä¸­ï¼Œè¯¥<code class="function">source-to-object</code>å‡½æ•°è¢«ä¿®æ”¹ä¸ºå°†è·¯å¾„æ·»åŠ åˆ°äºŒå‰æ ‘çš„å‰é¢ã€‚è¿™ä¸ªå‰ç¼€æ“ä½œä¼šæ‰§è¡Œå¤šæ¬¡ï¼Œæ‰€ä»¥å°†å…¶å†™æˆä¸€ä¸ªå‡½æ•°ï¼š</p><p>In this version the <code class="function">source-to-object</code> function is modified to
          prepend the path to the binary tree. This prefixing operation is
          performed several times, so write it as a function:</p><a id="OEBPS/ch08.html.I_3_tt370"></a><pre class="programlisting">SOURCE_DIR := /test/book/examples/ch07-separate-binaries-1
BINARY_DIR := /test/book/out/mp3_player_out

# $(è°ƒç”¨æºç›®å½•åˆ°äºŒè¿›åˆ¶ç›®å½•ï¼Œç›®å½•åˆ—è¡¨)
æºç›®å½•åˆ°äºŒè¿›åˆ¶ç›®å½• = $(addprefix $(BINARY_DIR)/, $1)

# $(è°ƒç”¨æºåˆ°å¯¹è±¡ï¼Œæºæ–‡ä»¶åˆ—è¡¨)
æºåˆ°å¯¹è±¡ = $(è°ƒç”¨æºç›®å½•åˆ°äºŒè¿›åˆ¶ç›®å½•ï¼Œ\
                     $(subst .c,.o,$(è¿‡æ»¤å™¨ %.c,$1)) \
                     $(subst .y,.o,$(è¿‡æ»¤å™¨ %.y,$1)) \
                     $(subst .l,.o,$(è¿‡æ»¤å™¨ %.l,$1)))</pre><pre class="programlisting">SOURCE_DIR := /test/book/examples/ch07-separate-binaries-1
BINARY_DIR := /test/book/out/mp3_player_out

# $(call source-dir-to-binary-dir, directory-list)
source-dir-to-binary-dir = $(addprefix $(BINARY_DIR)/, $1)

# $(call source-to-object, source-file-list)
source-to-object = $(call source-dir-to-binary-dir,     \
                     $(subst .c,.o,$(filter %.c,$1))    \
                     $(subst .y,.o,$(filter %.y,$1))    \
                     $(subst .l,.o,$(filter %.l,$1)))</pre><p>è¯¥<code class="function">make-library</code>å‡½æ•°ä¹Ÿè¿›è¡Œäº†ç±»ä¼¼çš„æ›´æ”¹ï¼Œä»¥åœ¨è¾“å‡ºæ–‡ä»¶ä¸­æ·»åŠ å‰ç¼€<code class="literal">BINARY_DIR</code>.ç”±äºŽåŒ…å«è·¯å¾„å†æ¬¡æ˜¯ç®€å•çš„ç›¸å¯¹è·¯å¾„ï¼Œå› æ­¤è¯¥<code class="function">subdirectory</code>å‡½æ•°æ¢å¤åˆ°å…¶å…ˆå‰ç‰ˆæœ¬ã€‚ä¸€ä¸ªå°éšœç¢ï¼›<em class="command">make</em> 3.80ä¸­çš„ä¸€ä¸ªé”™è¯¯é˜»æ­¢<code class="function">source-to-object</code>åœ¨æ–°ç‰ˆæœ¬çš„<code class="function">make-library</code>.è¯¥é”™è¯¯å·²åœ¨ 3.81 ä¸­ä¿®å¤ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰‹åŠ¨æ‰©å±•åŠŸèƒ½æ¥è§£å†³è¯¥é”™è¯¯
          <code class="function">source-to-object</code>
          ã€‚</p><p>The <code class="function">make-library</code> function
          is similarly altered to prefix the output file with <code class="literal">BINARY_DIR</code>. The <code class="function">subdirectory</code> function is restored to its
          previous version since the include path is again a simple relative
          path. One small snag; a bug in <em class="command">make</em> 3.80 prevents calling <code class="function">source-to-object</code> within the new version
          of <code class="function">make-library</code>. This bug has
          been fixed in 3.81. We can work around the bug by hand expanding the
          <code class="function">source-to-object</code>
          function.</p><p>çŽ°åœ¨æˆ‘ä»¬åˆ°äº†çœŸæ­£ä¸‘é™‹çš„éƒ¨åˆ†ã€‚å½“è¾“å‡ºæ–‡ä»¶æ— æ³•ä»Ž<em class="filename">makefile</em>çš„ç›¸å¯¹è·¯å¾„ç›´æŽ¥è®¿é—®æ—¶ï¼Œéšå¼è§„åˆ™å°†ä¸å†è§¦å‘ã€‚ä¾‹å¦‚ï¼ŒåŸºæœ¬ç¼–è¯‘è§„åˆ™<code class="literal">%.o</code>ï¼š<code class="literal">%.c</code>å½“ä¸¤ä¸ªæ–‡ä»¶ä½äºŽåŒä¸€ç›®å½•ä¸­æ—¶ï¼Œæˆ–è€…å³ä½¿ C æ–‡ä»¶ä½äºŽå­ç›®å½•ä¸­ï¼ˆä¾‹å¦‚
          <em class="filename">lib/codec/codec.c</em>ï¼‰æ—¶ï¼Œæ•ˆæžœå¾ˆå¥½ã€‚å½“æºæ–‡ä»¶ä½äºŽè¿œç¨‹ç›®å½•ä¸­æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡ç¤º<em class="command">make</em>ä½¿ç”¨è¯¥åŠŸèƒ½æœç´¢æº
          <code class="literal">vpath</code>ã€‚ä½†æ˜¯ï¼Œå½“ç›®æ ‡æ–‡ä»¶ä½äºŽè¿œç¨‹ç›®å½•ä¸­æ—¶ï¼Œ<em class="command">make</em>æ— æ³•ç¡®å®šç›®æ ‡æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ï¼Œå¹¶ä¸”ç›®æ ‡/å…ˆå†³æ¡ä»¶é“¾ä¼šè¢«ç ´åã€‚</p><p>Now we get to the truly ugly part. When the output file is not
          directly accessible from a path relative to the <em class="filename">makefile</em>, the implicit rules no longer
          fire. For instance, the basic compile rule <code class="literal">%.o</code>: <code class="literal">%.c</code> works well when the two files live in
          the same directory, or even if the C file is in a subdirectory, say
          <em class="filename">lib/codec/codec.c</em>. When the
          source file lives in a remote directory, we can instruct <em class="command">make</em> to search for the source with the
          <code class="literal">vpath</code> feature. But when the
          object file lives in a remote directory, <em class="command">make</em> has no way of determining where the
          object file resides and the target/prerequisite chain is
          broken.</p><p><em class="command">é€šçŸ¥make</em>
          è¾“å‡ºæ–‡ä»¶ä½ç½®çš„å”¯ä¸€æ–¹æ³•æ˜¯æä¾›é“¾æŽ¥æºæ–‡ä»¶å’Œç›®æ ‡æ–‡ä»¶çš„æ˜¾å¼è§„åˆ™ï¼š</p><p>The only way to inform <em class="command">make</em>
          of the location of the output file is to provide an explicit rule
          linking the source and object files:</p><a id="OEBPS/ch08.html.I_3_tt371"></a><pre class="programlisting">$(BINARY_DIR)/lib/codec/codec.o: lib/codec/codec.c</pre><pre class="programlisting">$(BINARY_DIR)/lib/codec/codec.o: lib/codec/codec.c</pre><p>å¿…é¡»å¯¹æ¯ä¸ªç›®æ ‡æ–‡ä»¶æ‰§è¡Œæ­¤æ“ä½œã€‚</p><p>This must be done for every single object file.</p><p>æ›´ç³Ÿç³•çš„æ˜¯ï¼Œè¿™ä¸ªç›®æ ‡/å…ˆå†³æ¡ä»¶å¯¹ä¸Žéšå¼è§„åˆ™ä¸åŒ¹é…<code class="literal">%.o: %.c</code>ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬è¿˜å¿…é¡»æä¾›å‘½ä»¤è„šæœ¬ï¼Œå¤åˆ¶éšå¼æ•°æ®åº“ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œå¹¶å¯èƒ½å¤šæ¬¡é‡å¤è¯¥è„šæœ¬ã€‚è¿™ä¸ªé—®é¢˜ä¹Ÿé€‚ç”¨äºŽæˆ‘ä»¬ä¸€ç›´ä½¿ç”¨çš„è‡ªåŠ¨ä¾èµ–å…³ç³»ç”Ÿæˆè§„åˆ™ã€‚
          å¦‚æžœæ‰‹åŠ¨å®Œæˆï¼Œä¸º<em class="filename">makefile</em>ä¸­çš„æ¯ä¸ªç›®æ ‡æ–‡ä»¶æ·»åŠ ä¸¤ä¸ªæ˜¾å¼è§„åˆ™æ˜¯ç»´æŠ¤çš„å™©æ¢¦ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥ç”Ÿæˆè¿™äº›è§„åˆ™ï¼Œä»Žè€Œæœ€å¤§é™åº¦åœ°å‡å°‘ä»£ç é‡å¤å’Œç»´æŠ¤ï¼š</p><p>Worse, this target/prerequisite pair is not matched against
          the implicit rule, <code class="literal">%.o: %.c</code>. That
          means we must also provide the command script, duplicating whatever
          is in the implicit database and possibly repeating this script many
          times. The problem also applies to the automatic dependency
          generation rule we've been using. Adding two explicit rules for
          every object file in a <em class="filename">makefile</em>
          is a maintenance nightmare, if done by hand. However, we can
          minimize the code duplication and maintenance by writing a function
          to generate these rules:</p><a id="OEBPS/ch08.html.I_3_tt372"></a><pre class="programlisting"># $(è°ƒç”¨å•ç¼–è¯‘è§„åˆ™ã€äºŒè¿›åˆ¶æ–‡ä»¶ã€æºæ–‡ä»¶)
å®šä¹‰ä¸€æ¬¡ç¼–è¯‘è§„åˆ™
  $1ï¼š$ï¼ˆè°ƒç”¨ç”Ÿæˆæºï¼Œ$2ï¼‰
        $(COMPILE.c) $$@ $$&lt;

  $(subst .o,.d,$1): $(è°ƒç”¨ç”Ÿæˆæº,$2)
        $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -M $$&lt; | \
        $(SED) 's,\($$(notdir $$*)\.o\) *:,$$(dir $$@)\1 $$@: ,' &gt; $$@.tmp
        $(MV) $$@.tmp $$@

æ©å¾·å¤«</pre><pre class="programlisting"># $(call one-compile-rule, binary-file, source-files)
define one-compile-rule
  $1: $(call generated-source,$2)
        $(COMPILE.c) $$@ $$&lt;

  $(subst .o,.d,$1): $(call generated-source,$2)
        $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -M $$&lt; | \
        $(SED) 's,\($$(notdir $$*)\.o\) *:,$$(dir $$@)\1 $$@: ,' &gt; $$@.tmp
        $(MV) $$@.tmp $$@

endef</pre><p>è¯¥å‡½æ•°çš„å‰ä¸¤è¡Œæ˜¯å¯¹è±¡åˆ°æºä¾èµ–å…³ç³»çš„æ˜¾å¼è§„åˆ™ã€‚è§„åˆ™çš„å…ˆå†³æ¡ä»¶å¿…é¡»ä½¿ç”¨æˆ‘ä»¬åœ¨<a class="link" href="#OEBPS/ch06.html" title="ç¬¬ 6 ç« ç®¡ç†å¤§åž‹é¡¹ç›®">ç¬¬ 6 ç« </a><code class="function">generated-source</code>ä¸­ç¼–å†™çš„å‡½æ•°
          æ¥è®¡ç®—ï¼Œå› ä¸ºæŸäº›æºæ–‡ä»¶æ˜¯<em class="command">yacc</em>å’Œ
          <em class="command">lex</em>æ–‡ä»¶ï¼Œå½“å®ƒä»¬å‡ºçŽ°åœ¨å‘½ä»¤è„šæœ¬ä¸­ï¼ˆä¾‹å¦‚ï¼Œç”¨ æ‰©å±•ï¼‰æ—¶ï¼Œå®ƒä»¬ä¼šå¯¼è‡´ç¼–è¯‘å¤±è´¥ã€‚è‡ªåŠ¨å˜é‡è¢«å¼•ç”¨ï¼Œä»¥ä¾¿ç¨åŽåœ¨æ‰§è¡Œå‘½ä»¤è„šæœ¬æ—¶è€Œä¸æ˜¯åœ¨é€šè¿‡ æ±‚å€¼ç”¨æˆ·å®šä¹‰çš„å‡½æ•°æ—¶æ‰©å±•å®ƒä»¬ã€‚è¯¥å‡½æ•°å·²è¢«ä¿®æ”¹ä¸ºè¿”å›žæœªæ›´æ”¹çš„ C æ–‡ä»¶ä»¥åŠ<em class="command">yacc</em>å’Œ
          <em class="command">lex</em>çš„ç”Ÿæˆæºï¼š<a class="link" href="#OEBPS/ch06.html" title="ç¬¬ 6 ç« ç®¡ç†å¤§åž‹é¡¹ç›®"></a><em class="command"></em><em class="command"></em><code class="literal">$^</code><code class="function">eval</code><code class="function">generated-source</code><em class="command"></em><em class="command"></em></p><p>The first two lines of the function are the explicit rule for
          the object-to-source dependency. The prerequisites for the rule must
          be computed using the <code class="function">generated-source</code> function we wrote in
          <a class="link" href="#OEBPS/ch06.html" title="Chapter&nbsp;6.&nbsp;Managing Large Projects">Chapter 6</a> because some of the
          source files are <em class="command">yacc</em> and
          <em class="command">lex</em> files that will cause
          compilation failures when they appear in the command script
          (expanded with <code class="literal">$^</code>, for instance).
          The automatic variables are quoted so they are expanded later when
          the command script is executed rather than when the user-defined
          function is evaluated by <code class="function">eval</code>.
          The <code class="function">generated-source</code> function
          has been modified to return C files unaltered as well as the
          generated source for <em class="command">yacc</em> and
          <em class="command">lex</em>:</p><a id="OEBPS/ch08.html.I_3_tt373"></a><pre class="programlisting"># $(è°ƒç”¨ç”Ÿæˆæºï¼Œæºæ–‡ä»¶åˆ—è¡¨)
ç”Ÿæˆçš„æº = $(è°ƒç”¨æºç›®å½•åˆ°äºŒè¿›åˆ¶ç›®å½•ï¼Œ\
                     $(subst .y,.c,$(è¿‡æ»¤å™¨ %.y,$1)) \
                     $(subst .y,.h,$(è¿‡æ»¤å™¨ %.y,$1)) \
                     $(subst .l,.c,$(è¿‡æ»¤å™¨ %.l,$1))) \
                   $(è¿‡æ»¤%.c,$1)</pre><pre class="programlisting"># $(call generated-source, source-file-list)
generated-source = $(call source-dir-to-binary-dir,     \
                     $(subst .y,.c,$(filter %.y,$1))    \
                     $(subst .y,.h,$(filter %.y,$1))    \
                     $(subst .l,.c,$(filter %.l,$1)))   \
                   $(filter %.c,$1)</pre><p>ç»è¿‡æ­¤æ›´æ”¹ï¼Œè¯¥å‡½æ•°çŽ°åœ¨äº§ç”Ÿä»¥ä¸‹è¾“å‡ºï¼š</p><p>With this change, the function now produces this
          output:</p><a id="OEBPS/ch08.html.I_3_tt374"></a><pre class="programlisting">å‚æ•°ç»“æžœ
lib/db/playlist.y /c/mp3_player_out/lib/db/playlist.c
                       /c/mp3_player_out/lib/db/playlist.h
lib/db/scanner.l /c/mp3_player_out/lib/db/scanner.c
åº”ç”¨ç¨‹åº/æ’­æ”¾å™¨/play_mp3.c åº”ç”¨ç¨‹åº/æ’­æ”¾å™¨/play_mp3.c</pre><pre class="programlisting">Argument               Result
lib/db/playlist.y      /c/mp3_player_out/lib/db/playlist.c
                       /c/mp3_player_out/lib/db/playlist.h
lib/db/scanner.l       /c/mp3_player_out/lib/db/scanner.c
app/player/play_mp3.c  app/player/play_mp3.c</pre><p>ä¾èµ–å…³ç³»ç”Ÿæˆçš„æ˜¾å¼è§„åˆ™ç±»ä¼¼ã€‚å†æ¬¡æ³¨æ„ä¾èµ–è„šæœ¬æ‰€éœ€çš„é¢å¤–å¼•ç”¨ï¼ˆåŒç¾Žå…ƒç¬¦å·ï¼‰ã€‚</p><p>The explicit rule for dependency generation is similar. Again,
          note the extra quoting (double dollar signs) required by the
          dependency script.</p><p>çŽ°åœ¨å¿…é¡»ä¸ºæ¨¡å—ä¸­çš„æ¯ä¸ªæºæ–‡ä»¶æ‰©å±•æˆ‘ä»¬çš„æ–°å‡½æ•°ï¼š</p><p>Our new function must now be expanded for each source file in
          a module:</p><a id="OEBPS/ch08.html.I_3_tt375"></a><pre class="programlisting"># $(ç¼–è¯‘è§„åˆ™)
å®šä¹‰ç¼–è¯‘è§„åˆ™
  $(foreach f, $(local_src),\
    $(è°ƒç”¨å•ç¼–è¯‘è§„åˆ™,$(è°ƒç”¨æºåˆ°å¯¹è±¡,$f),$f))
æ©å¾·å¤«</pre><pre class="programlisting"># $(compile-rules)
define compile-rules
  $(foreach f, $(local_src),\
    $(call one-compile-rule,$(call source-to-object,$f),$f))
endef</pre><p><em class="filename">è¯¥å‡½æ•°ä¾èµ–äºŽmodule.mk</em><code class="literal">local_src</code>æ–‡ä»¶ä½¿ç”¨çš„å…¨å±€å˜é‡ã€‚æ›´é€šç”¨çš„æ–¹æ³•ä¼šå°†æ­¤æ–‡ä»¶åˆ—è¡¨ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œä½†åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ä¼¼ä¹Žæ²¡æœ‰å¿…è¦ã€‚è¿™äº›å‡½æ•°å¯ä»¥è½»æ¾æ·»åŠ åˆ°æˆ‘ä»¬çš„<em class="filename">module.mk</em>æ–‡ä»¶ä¸­ï¼š<em class="filename"></em><em class="filename"></em></p><p>This function relies on the global variable <code class="literal">local_src</code> used by the <em class="filename">module.mk</em> files. A more general approach
          would pass this file list as an argument, but in this project it
          seems unnecessary. These functions are easily added to our <em class="filename">module.mk</em> files:</p><a id="OEBPS/ch08.html.I_3_tt376"></a><pre class="programlisting">local_src := $(å­ç›®å½•)/codec.c

$(eval $(è°ƒç”¨ make-library,$(å­ç›®å½•)/libcodec.a,$(local_src)))

$(eval $(ç¼–è¯‘è§„åˆ™))</pre><pre class="programlisting">local_src := $(subdirectory)/codec.c

$(eval $(call make-library,$(subdirectory)/libcodec.a,$(local_src)))

$(eval $(compile-rules))</pre><p>æˆ‘ä»¬å¿…é¡»ä½¿ç”¨è¯¥å‡½æ•°<code class="function">eval</code>ï¼Œå› ä¸ºè¯¥<code class="function">compile-rules</code>å‡½æ•°ä¼šæ‰©å±•åˆ°ä¸æ­¢ä¸€è¡Œ<em class="command">make</em>ä»£ç ã€‚</p><p>We must use <code class="function">eval</code> because
          the <code class="function">compile-rules</code> function
          expands to more than one line of <em class="command">make</em> code.</p><p>è¿˜æœ‰æœ€åŽä¸€ä¸ªå¹¶å‘ç—‡ã€‚å¦‚æžœæ ‡å‡† C ç¼–è¯‘æ¨¡å¼è§„åˆ™æ— æ³•ä¸ŽäºŒè¿›åˆ¶è¾“å‡ºè·¯å¾„åŒ¹é…ï¼Œåˆ™<em class="command">lex</em>çš„éšå¼è§„åˆ™å’Œ<em class="command">yacc</em>çš„æ¨¡å¼è§„åˆ™ä¹Ÿå°†å¤±è´¥ã€‚æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æ‰‹åŠ¨æ›´æ–°è¿™äº›ã€‚ç”±äºŽå®ƒä»¬ä¸å†é€‚ç”¨äºŽå…¶ä»–<em class="command">lex</em>æˆ–<em class="command">yacc</em>æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬ç§»è‡³
          <em class="filename">lib/db/module.mk</em>ï¼š</p><p>There is one last complication. If the standard C compilation
          pattern rule fails to match with binary output paths, the implicit
          rule for <em class="command">lex</em> and our pattern rule
          for <em class="command">yacc</em> will also fail. We can
          update these by hand easily. Since they are no longer applicable to
          other <em class="command">lex</em> or <em class="command">yacc</em> files, we can move them into
          <em class="filename">lib/db/module.mk</em>:</p><a id="OEBPS/ch08.html.I_3_tt377"></a><pre class="programlisting">local_dir := $(BINARY_DIR)/$(å­ç›®å½•)
local_src := $(addprefix $(å­ç›®å½•)/,playlist.y Scanner.l)

$(eval $(è°ƒç”¨ make-library,$(å­ç›®å½•)/libdb.a,$(local_src)))

$(eval $(ç¼–è¯‘è§„åˆ™))

.SECONDARYï¼š$ï¼ˆè°ƒç”¨ç”Ÿæˆæºï¼Œ$ï¼ˆlocal_srcï¼‰ï¼‰

$(local_dir)/scanner.d: $(local_dir)/playlist.d

$(local_dir)/%.c $(local_dir)/%.h: $(å­ç›®å½•)/%.y
        $(YACC.y) --å®šä¹‰$&lt;
        $(MV) y.tab.c $(dir $@)$*.c
        $(MV) y.tab.h $(dir $@)$*.h

$(local_dir)/scanner.c: $(å­ç›®å½•)/scanner.l
        @$(RM)$@
        $(LEX.l) $&lt; &gt; $@</pre><pre class="programlisting">local_dir := $(BINARY_DIR)/$(subdirectory)
local_src := $(addprefix $(subdirectory)/,playlist.y scanner.l)

$(eval $(call make-library,$(subdirectory)/libdb.a,$(local_src)))

$(eval $(compile-rules))

.SECONDARY: $(call generated-source, $(local_src))

$(local_dir)/scanner.d: $(local_dir)/playlist.d

$(local_dir)/%.c $(local_dir)/%.h: $(subdirectory)/%.y
        $(YACC.y) --defines $&lt;
        $(MV) y.tab.c $(dir $@)$*.c
        $(MV) y.tab.h $(dir $@)$*.h

$(local_dir)/scanner.c: $(subdirectory)/scanner.l
        @$(RM) $@
        $(LEX.l) $&lt; &gt; $@</pre><p>lexè§„åˆ™å·²ä½œä¸ºæ™®é€šæ˜¾å¼è§„åˆ™å®žçŽ°ï¼Œä½†<em class="command">yacc</em><em class="command">è§„åˆ™</em>æ˜¯æ¨¡å¼è§„åˆ™ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸º<em class="command">yacc</em>è§„åˆ™ç”¨äºŽæž„å»ºä¸¤ä¸ªç›®æ ‡ï¼Œä¸€ä¸ªCæ–‡ä»¶å’Œä¸€ä¸ªå¤´æ–‡ä»¶ã€‚å¦‚æžœæˆ‘ä»¬ä½¿ç”¨æ­£å¸¸çš„æ˜¾å¼è§„åˆ™ï¼Œ<em class="command">make</em>å°†æ‰§è¡Œå‘½ä»¤è„šæœ¬ä¸¤æ¬¡ï¼Œä¸€æ¬¡ç”¨äºŽåˆ›å»º C æ–‡ä»¶ï¼Œä¸€æ¬¡ç”¨äºŽæ ‡å¤´ã€‚ä½†æ˜¯<em class="command">make</em>å‡è®¾å…·æœ‰å¤šä¸ªç›®æ ‡çš„æ¨¡å¼è§„åˆ™é€šè¿‡ä¸€æ¬¡æ‰§è¡Œæ›´æ–°ä¸¤ä¸ªç›®æ ‡ã€‚</p><p>The <em class="command">lex</em> rule has been
          implemented as a normal explicit rule, but the <em class="command">yacc</em> rule is a pattern rule. Why? Because
          the <em class="command">yacc</em> rule is used to build
          two targets, a C file and a header file. If we used a normal
          explicit rule, <em class="command">make</em> would execute
          the command script twice, once for the C file to be created and once
          for the header. But <em class="command">make</em> assumes
          that a pattern rule with multiple targets updates both targets with
          a single execution.</p><p>å¦‚æžœå¯èƒ½çš„è¯ï¼Œæˆ‘å°†ä½¿ç”¨æ›´ç®€å•çš„ä»ŽäºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œç¼–è¯‘çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯æœ¬èŠ‚ä¸­æ˜¾ç¤ºçš„<em class="filename">makefile</em><a id="OEBPS/ch08.html.make3-CHP-8-ITERM-1444" class="indexterm"></a> <a id="OEBPS/ch08.html.make3-CHP-8-ITERM-1445" class="indexterm"></a>æ ‘ã€‚æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œå½“å°è¯•ä»Žæºä»£ç æ ‘è¿›è¡Œç¼–è¯‘æ—¶ï¼Œå¤æ‚æ€§ç«‹å³å‡ºçŽ°ï¼ˆå¹¶ä¸”ä¼¼ä¹Žå˜å¾—è¶Šæ¥è¶Šç³Ÿï¼‰ã€‚</p><p>If possible, instead of the <em class="filename">makefile</em>s shown in this section, I would
          use the simpler approach of compiling from the binary <a class="indexterm"></a> <a class="indexterm"></a>tree. As you can see,
          complications arise immediately (and seem to get worse and worse)
          when trying to compile from the source tree.</p></div></div></div></div></div>
<div id="OEBPS/ch08s02.html"><div>
<div class="sect1" title="åªè¯»æº"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch08s02.html.make3-CHP-8-SECT-2"></a>åªè¯»æº</h1><h1 class="title"><a></a>Read-Only Source</h1></div></div></div><p>ä¸€æ—¦æºä»£ç å’ŒäºŒè¿›åˆ¶æ–‡ä»¶<a id="OEBPS/ch08s02.html.make3-CHP-8-ITERM-1446" class="indexterm"></a> <a id="OEBPS/ch08s02.html.make3-CHP-8-ITERM-1447" class="indexterm"></a>æ ‘æ˜¯åˆ†å¼€çš„ï¼Œå¦‚æžœæž„å»ºç”Ÿæˆçš„å”¯ä¸€æ–‡ä»¶æ˜¯æ”¾ç½®åœ¨è¾“å‡ºæ ‘ä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåˆ™å°†å‚è€ƒæºæ ‘è®¾ç½®ä¸ºåªè¯»çš„èƒ½åŠ›é€šå¸¸æ˜¯å…è´¹çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æžœç”Ÿæˆäº†æºæ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¿…é¡»æ³¨æ„å°†å®ƒä»¬æ”¾ç½®åœ¨äºŒå‰æ ‘ä¸­ã€‚</p><p>Once the source and binary <a class="indexterm"></a> <a class="indexterm"></a>trees are separate, the ability to make a reference
        source tree read-only often comes for free if the only files generated
        by the build are the binary files placed in the output tree. However,
        if source files are generated, then we must take care that they are
        placed in the binary tree.</p><p>åœ¨æ›´ç®€å•çš„â€œä»ŽäºŒå‰æ ‘ç¼–è¯‘â€æ–¹æ³•ä¸­ï¼Œç”Ÿæˆçš„æ–‡ä»¶ä¼šè‡ªåŠ¨å†™å…¥äºŒå‰æ ‘ï¼Œå› ä¸º<em class="command">yacc</em>å’Œ<em class="command">lex</em>ç¨‹åºæ˜¯ä»ŽäºŒå‰æ ‘æ‰§è¡Œçš„ã€‚åœ¨â€œä»Žæºæ ‘ç¼–è¯‘â€æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è¢«è¿«ä¸ºæºæ–‡ä»¶å’Œç›®æ ‡æ–‡ä»¶æä¾›æ˜¾å¼è·¯å¾„ï¼Œå› æ­¤æŒ‡å®šäºŒå‰æ ‘æ–‡ä»¶çš„è·¯å¾„ä¸éœ€è¦é¢å¤–çš„å·¥ä½œï¼Œåªæ˜¯æˆ‘ä»¬å¿…é¡»è®°ä½è¿™æ ·åšã€‚</p><p>In the simpler "compile from binary tree" approach, the
        generated files are written into the binary tree automatically because
        the <em class="command">yacc</em> and <em class="command">lex</em> programs are executed from the binary
        tree. In the "compile from source tree" approach, we are forced to
        provide explicit paths for our source and target files, so specifying
        the path to a binary tree file is no extra work, except that we must
        remember to do it.</p><p>ä½¿å‚è€ƒæºæ ‘åªè¯»çš„å…¶ä»–éšœç¢é€šå¸¸æ˜¯æˆ‘ä»¬è‡ªå·±è®¾ç½®çš„ã€‚é€šå¸¸ï¼Œé—ç•™æž„å»ºç³»ç»Ÿå°†åŒ…æ‹¬åœ¨æºæ ‘ä¸­åˆ›å»ºæ–‡ä»¶çš„æ“ä½œï¼Œå› ä¸ºåŽŸå§‹ä½œè€…æ²¡æœ‰è€ƒè™‘åªè¯»æºæ ‘çš„ä¼˜ç‚¹ã€‚ç¤ºä¾‹åŒ…æ‹¬ç”Ÿæˆçš„æ–‡æ¡£ã€æ—¥å¿—æ–‡ä»¶å’Œä¸´æ—¶æ–‡ä»¶ã€‚å°†è¿™äº›æ–‡ä»¶ç§»åŠ¨åˆ°è¾“å‡ºæ ‘æœ‰æ—¶å¯èƒ½å¾ˆå›°éš¾ï¼Œä½†å¦‚æžœéœ€è¦ä»Žå•ä¸ªæºæž„å»ºå¤šä¸ªäºŒå‰æ ‘ï¼Œåˆ™æ›¿ä»£æ–¹æ³•æ˜¯ç»´æŠ¤å¤šä¸ªç›¸åŒçš„æºæ ‘å¹¶ä½¿å®ƒä»¬ä¿æŒåŒæ­¥ã€‚</p><p>The other obstacles to making the reference source tree read
        only are usually self-imposed. Often a legacy build system will
        include actions that create files in the source tree because the
        original author had not considered the advantages to a read-only
        source tree. Examples include generated documentation, log files, and
        temporary files. Moving these files to the output tree can sometimes
        be arduous, but if building multiple binary trees from a single source
        is necessary, the alternative is to maintain multiple, identical
        source trees and keep them in sync.</p></div></div></div>
<div id="OEBPS/ch08s03.html"><div>
<div class="sect1" title="ä¾èµ–ç”Ÿæˆ"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch08s03.html.make3-CHP-8-SECT-3"></a>ä¾èµ–ç”Ÿæˆ</h1><h1 class="title"><a></a>Dependency Generation</h1></div></div></div><p>æˆ‘ä»¬ç®€å•ä»‹ç»äº†<a id="OEBPS/ch08s03.html.make3-CHP-8-ITERM-1448" class="indexterm"></a> <a id="OEBPS/ch08s03.html.make3-CHP-8-ITERM-1449" class="indexterm"></a><a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™">ç¬¬ 2 ç« </a><a class="link" href="#OEBPS/ch02s07.html" title="è‡ªåŠ¨ä¾èµ–ç”Ÿæˆ">2.7 èŠ‚</a>ä¸­çš„ä¾èµ–é¡¹ç”Ÿæˆï¼Œä½†å®ƒç•™ä¸‹äº†å‡ ä¸ªæœªè§£å†³çš„é—®é¢˜ã€‚å› æ­¤ï¼Œæœ¬èŠ‚ä¸ºå·²ç»æè¿°çš„ç®€å•è§£å†³æ–¹æ¡ˆæä¾›äº†ä¸€äº›æ›¿ä»£æ–¹æ¡ˆã€‚<sup>[ </sup><sup><a id="OEBPS/ch08s03.html.make3-CHP-8-FNOTE-1" href="#OEBPS/ch08s03.html.ftn.make3-CHP-8-FNOTE-1" class="footnote">1</a></sup><sup> ]</sup>ç‰¹åˆ«æ˜¯ï¼Œå‰é¢æè¿°çš„ç®€å•æ–¹æ³•å’Œ<acronym class="acronym">GNU </acronym><em class="command">make</em>
        æ‰‹å†Œä¸­å­˜åœ¨ä»¥ä¸‹ç¼ºé™·ï¼š<a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™"></a><sup><a id="OEBPS/ch08s03.html.make3-CHP-8-FNOTE-1" href="#OEBPS/ch08s03.html.ftn.make3-CHP-8-FNOTE-1" class="footnote"></a></sup><acronym class="acronym"></acronym> <em class="command"></em></p><p>We gave a brief introduction to <a class="indexterm"></a> <a class="indexterm"></a>dependency generation in the <a class="link" href="#OEBPS/ch02s07.html" title="Automatic Dependency Generation">Section 2.7</a> in <a class="link" href="#OEBPS/ch02.html" title="Chapter&nbsp;2.&nbsp;Rules">Chapter 2</a>, but it left several problems
        unaddressed. Therefore, this section offers some alternatives to the
        simple solution already described.<sup>[<a href="#OEBPS/ch08s03.html.ftn.make3-CHP-8-FNOTE-1" class="footnote">1</a>]</sup> In particular, the simple approach described earlier and
        in the <acronym class="acronym">GNU</acronym> <em class="command">make</em>
        manual suffer from these failings:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>è¿™æ˜¯ä½Žæ•ˆçš„ã€‚å½“<em class="command">make</em>å‘çŽ°ä¾èµ–æ–‡ä»¶ä¸¢å¤±æˆ–è¿‡æœŸæ—¶ï¼Œå®ƒä¼šæ›´æ–°<em class="filename">.d</em>æ–‡ä»¶å¹¶è‡ªè¡Œé‡æ–°å¯åŠ¨ã€‚å¦‚æžœåœ¨è¯»å– makefile
            <em class="filename">å’Œ</em>åˆ†æžä¾èµ–å…³ç³»å›¾æœŸé—´æ‰§è¡Œè®¸å¤šä»»åŠ¡ï¼Œåˆ™é‡æ–°è¯»å–<em class="filename">makefile çš„æ•ˆçŽ‡å¯èƒ½ä¼šå¾ˆä½Žã€‚</em><em class="filename"></em></p></li><li class="listitem"><p>It is inefficient. When <em class="command">make</em> discovers that a dependency file is
            missing or out of date, it updates the <em class="filename">.d</em> file and restarts itself. Rereading
            the <em class="filename">makefile</em> can be
            inefficient if it performs many tasks during the reading of the
            <em class="filename">makefile</em> and the analysis of
            the dependency graph.</p></li><li class="listitem"><p><em class="command"></em>å½“æ‚¨ç¬¬ä¸€æ¬¡æž„å»ºç›®æ ‡ä»¥åŠæ¯æ¬¡æ·»åŠ æ–°çš„æºæ–‡ä»¶æ—¶ï¼Œ<em class="command">make</em>éƒ½ä¼šç”Ÿæˆè­¦å‘Šã€‚æ­¤æ—¶ï¼Œä¸Žæ–°æºæ–‡ä»¶å…³è”çš„ä¾èµ–æ–‡ä»¶å°šä¸å­˜åœ¨ï¼Œå› æ­¤å½“<em class="command">make</em>å°è¯•è¯»å–ä¾èµ–æ–‡ä»¶æ—¶ï¼Œå®ƒå°†åœ¨ç”Ÿæˆä¾èµ–æ–‡ä»¶ä¹‹å‰ç”Ÿæˆä¸€æ¡è­¦å‘Šæ¶ˆæ¯ã€‚è¿™å¹¶ä¸è‡´å‘½ï¼Œåªæ˜¯ä»¤äººæ¼ç«ã€‚</p></li><li class="listitem"><p><em class="command">make</em> generates a warning
            when you build a target for the first time and each time you add
            new source files. At these times the dependency file associated
            with a new source file does not yet exist, so when <em class="command">make</em> attempts to read the dependency
            file it will produce a warning message before generating the
            dependency file. This is not fatal, merely irritating.</p></li><li class="listitem"><p>å¦‚æžœåˆ é™¤æºæ–‡ä»¶ï¼Œ<em class="command">make å°†</em>åœ¨åŽç»­æž„å»ºè¿‡ç¨‹ä¸­åœæ­¢å¹¶å‡ºçŽ°è‡´å‘½é”™è¯¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå­˜åœ¨ä¸€ä¸ªåŒ…å«å·²åˆ é™¤æ–‡ä»¶çš„ä¾èµ–æ–‡ä»¶ä½œä¸ºå…ˆå†³æ¡ä»¶ã€‚ç”±äºŽ<em class="command">make</em>æ‰¾ä¸åˆ°åˆ é™¤çš„æ–‡ä»¶å¹¶ä¸”ä¸çŸ¥é“å¦‚ä½•åˆ¶ä½œå®ƒï¼Œå› æ­¤<em class="command">make</em>æ‰“å°ä»¥ä¸‹æ¶ˆæ¯ï¼š</p><a id="OEBPS/ch08s03.html.I_3_tt378"></a><pre class="programlisting">make: *** æ²¡æœ‰è§„åˆ™å¯ä»¥ç”Ÿæˆ foo.d éœ€è¦çš„ç›®æ ‡ foo.hã€‚åœæ­¢ã€‚</pre></li><li class="listitem"><p>If you remove a source file, <em class="command">make</em> stops with a fatal error during
            subsequent builds. In this situation, there exists a dependency
            file containing the removed file as a prerequisite. Since <em class="command">make</em> cannot find the removed file and
            doesn't know how to make it, <em class="command">make</em> prints the message:</p><a></a><pre class="programlisting">make: *** No rule to make target foo.h, needed by foo.d.  Stop.</pre></li><li class="listitem"><p>æ­¤å¤–ï¼Œç”±äºŽæ­¤é”™è¯¯ï¼Œ<em class="command">make</em>æ— æ³•é‡å»ºä¾èµ–æ–‡ä»¶ã€‚å”¯ä¸€çš„åŠžæ³•æ˜¯æ‰‹åŠ¨åˆ é™¤ä¾èµ–æ–‡ä»¶ï¼Œä½†ç”±äºŽè¿™äº›æ–‡ä»¶é€šå¸¸å¾ˆéš¾æ‰¾åˆ°ï¼Œç”¨æˆ·é€šå¸¸ä¼šåˆ é™¤æ‰€æœ‰ä¾èµ–æ–‡ä»¶å¹¶æ‰§è¡Œå¹²å‡€çš„æž„å»ºã€‚æ–‡ä»¶é‡å‘½åæ—¶ä¹Ÿä¼šå‡ºçŽ°æ­¤é”™è¯¯ã€‚</p></li><li class="listitem"><p>Furthermore, <em class="command">make</em> cannot
            rebuild the dependency file because of this error. The only
            recourse is to remove the dependency file by hand, but since these
            files are often hard to find, users typically delete all the
            dependency files and perform a clean build. This error also occurs
            when files are renamed.</p></li><li class="listitem"><p><em class="filename">è¯·æ³¨æ„ï¼Œæ­¤é—®é¢˜åœ¨åˆ é™¤æˆ–é‡å‘½åå¤´æ–‡ä»¶è€Œä¸æ˜¯.c</em>æ–‡ä»¶æ—¶æœ€ä¸ºæ˜Žæ˜¾ã€‚è¿™æ˜¯å› ä¸º<em class="filename">.c</em>æ–‡ä»¶å°†è‡ªåŠ¨ä»Žä¾èµ–æ–‡ä»¶åˆ—è¡¨ä¸­åˆ é™¤ï¼Œä¸ä¼šå½±å“æž„å»ºã€‚</p></li><li class="listitem"><p>Note that this problem is most noticeable with removed or
            renamed header files rather than <em class="filename">.c</em> files. This is because <em class="filename">.c</em> files will be removed from the list
            of dependency files automatically and will not trouble the
            build.</p></li></ul></div><div class="sect2" title="ç‰¹ç½—ç±³ä¹‹è·¯"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch08s03.html.make3-CHP-8-SECT-3.1"></a>ç‰¹ç½—ç±³ä¹‹è·¯</h2><h2 class="title"><a></a>Tromey's Way</h2></div></div></div><p>è®©æˆ‘ä»¬åˆ†åˆ«è§£å†³è¿™äº›é—®é¢˜ã€‚</p><p>Let's address these problems individually.</p><p>æˆ‘ä»¬æ€Žæ ·æ‰èƒ½é¿å…é‡æ–°å¯åŠ¨<em class="command">make</em>å‘¢ï¼Ÿ</p><p>How can we avoid restarting <em class="command">make</em>?</p><p>ä»”ç»†è€ƒè™‘ä¸€ä¸‹ï¼Œæˆ‘ä»¬å‘çŽ°é‡æ–°å¯åŠ¨<em class="command">make</em>æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚å¦‚æžœæ›´æ–°äº†ä¾èµ–æ–‡ä»¶ï¼Œåˆ™æ„å‘³ç€è‡³å°‘å…¶å…ˆå†³æ¡ä»¶ä¹‹ä¸€å·²æ›´æ”¹ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»æ›´æ–°ç›®æ ‡ã€‚åœ¨æ‰§è¡Œ<em class="command">make</em>æ—¶ä¸éœ€è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œå› ä¸ºæ›´å¤šçš„ä¾èµ–ä¿¡æ¯ä¸ä¼šæ”¹å˜<em class="command">make</em>çš„è¡Œä¸ºã€‚ä½†æˆ‘ä»¬å¸Œæœ›æ›´æ–°ä¾èµ–æ–‡ä»¶ï¼Œä»¥ä¾¿ä¸‹æ¬¡è¿è¡Œ<em class="command">make</em>å°†å…·æœ‰å®Œæ•´çš„ä¾èµ–ä¿¡æ¯ã€‚</p><p>On careful consideration, we can see that restarting <em class="command">make</em> is unnecessary. If a dependency file
          is updated, it means that at least one of its prerequisites has
          changed, which means we must update the target. Knowing more than
          that isn't necessary in this execution of <em class="command">make</em> because more dependency information
          won't change <em class="command">make</em>'s behavior. But
          we want the dependency file updated so that the next run of <em class="command">make</em> will have complete dependency
          information.</p><p><em class="command">ç”±äºŽæˆ‘ä»¬åœ¨æ‰§è¡Œmake</em>æ—¶ä¸éœ€è¦ä¾èµ–æ–‡ä»¶
          ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨æ›´æ–°ç›®æ ‡çš„åŒæ—¶ç”Ÿæˆè¯¥æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™ç¼–è¯‘è§„åˆ™æ¥æ›´æ–°ä¾èµ–æ–‡ä»¶æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><p>Since we don't need the dependency file in this execution of
          <em class="command">make</em>, we could generate the file
          at the same time as we update the target. We can do this by
          rewriting the compilation rule to also update the dependency
          file.</p><a id="OEBPS/ch08s03.html.I_3_tt379"></a><pre class="programlisting"># $(è°ƒç”¨ make-depend,æºæ–‡ä»¶,ç›®æ ‡æ–‡ä»¶,ä¾èµ–æ–‡ä»¶)
å®šä¹‰ make-depend
  $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -M $1 | \
  $(SED) 's,\($$(notdir $2)\) *:,$$(dir $2) $3: ,' &gt; $3.tmp
  $(MV) $3.tmp $3
æ©å¾·å¤«

%.o: %.c
        $(è°ƒç”¨ make-depend,$&lt;,$@,$(subst .o,.d,$@))
        $(COMPILE.c) -o $@ $&lt;</pre><pre class="programlisting"># $(call make-depend,source-file,object-file,depend-file)
define make-depend
  $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -M $1 | \
  $(SED) 's,\($$(notdir $2)\) *:,$$(dir $2) $3: ,' &gt; $3.tmp
  $(MV) $3.tmp $3
endef

%.o: %.c
        $(call make-depend,$&lt;,$@,$(subst .o,.d,$@))
        $(COMPILE.c) -o $@ $&lt;</pre><p><code class="function">make-depend</code>æˆ‘ä»¬ä½¿ç”¨æŽ¥å—æºã€å¯¹è±¡å’Œä¾èµ–æ–‡ä»¶åçš„å‡½æ•°æ¥å®žçŽ°ä¾èµ–é¡¹ç”ŸæˆåŠŸèƒ½ã€‚å¦‚æžœæˆ‘ä»¬ç¨åŽéœ€è¦åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­é‡ç”¨è¯¥å‡½æ•°ï¼Œè¿™å¯ä»¥æä¾›æœ€å¤§çš„çµæ´»æ€§ã€‚å½“æˆ‘ä»¬è¿™æ ·ä¿®æ”¹ç¼–è¯‘è§„åˆ™æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»åˆ é™¤<code class="literal">%.d: %.c</code>æˆ‘ä»¬ç¼–å†™çš„æ¨¡å¼è§„åˆ™ï¼Œä»¥é¿å…ç”Ÿæˆä¸¤æ¬¡ä¾èµ–æ–‡ä»¶ã€‚</p><p>We implement the dependency generation feature with the
          function <code class="function">make-depend</code> that
          accepts the source, object, and dependency filenames. This provides
          maximum flexibility if we need to reuse the function later in a
          different context. When we modify our compilation rule this way, we
          must delete the <code class="literal">%.d: %.c</code> pattern
          rule we wrote to avoid generating the dependency files twice.</p><p>çŽ°åœ¨ï¼Œç›®æ ‡æ–‡ä»¶å’Œä¾èµ–æ–‡ä»¶åœ¨é€»è¾‘ä¸Šé“¾æŽ¥åœ¨ä¸€èµ·ï¼šå¦‚æžœä¸€ä¸ªå­˜åœ¨ï¼Œåˆ™å¦ä¸€ä¸ªä¹Ÿå¿…é¡»å­˜åœ¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¹¶ä¸çœŸæ­£å…³å¿ƒä¾èµ–æ–‡ä»¶æ˜¯å¦ä¸¢å¤±ã€‚å¦‚æžœæ˜¯ï¼Œåˆ™ç›®æ ‡æ–‡ä»¶ä¹Ÿä¸¢å¤±ï¼Œå¹¶ä¸”ä¸¤è€…éƒ½å°†åœ¨ä¸‹ä¸€ä¸ªæž„å»ºæ—¶æ›´æ–°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çŽ°åœ¨å¯ä»¥å¿½ç•¥å› ç¼ºå°‘<em class="filename">.d</em>æ–‡ä»¶è€Œå¯¼è‡´çš„ä»»ä½•è­¦å‘Šã€‚</p><p>Now, the object file and dependency file are logically linked:
          if one exists the other must exist. Therefore, we don't really care
          if a dependency file is missing. If it is, the object file is also
          missing and both will be updated by the next build. So we can now
          ignore any warnings that result from missing <em class="filename">.d</em> files.</p><p>åœ¨<a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®">ç¬¬ 3 ç« </a>
          çš„<a class="link" href="#OEBPS/ch03s07.html.make3-CHP-3-SECT-7.2" title="åŒ…å«å’Œä¾èµ–å…³ç³»">3.7.2 èŠ‚</a>ä¸­ï¼Œæˆ‘ä»‹ç»äº†
          æŒ‡ä»¤çš„å¦ä¸€ç§å½¢å¼ï¼ˆæˆ–ï¼‰ï¼Œå®ƒå¿½ç•¥é”™è¯¯å¹¶ä¸”ä¸ç”Ÿæˆè­¦å‘Šï¼š<a class="link" href="#OEBPS/ch03.html" title="ç¬¬ 3 ç« å˜é‡å’Œå®"></a><code class="literal">include</code><code class="literal">-include</code><code class="literal">sinclude</code></p><p>In <a class="link" href="#OEBPS/ch03s07.html.make3-CHP-3-SECT-7.2" title="include and Dependencies">Section 3.7.2</a>
          in <a class="link" href="#OEBPS/ch03.html" title="Chapter&nbsp;3.&nbsp;Variables and Macros">Chapter 3</a>, I introduced an
          alternate form of <code class="literal">include</code>
          directive, <code class="literal">-include</code> (or <code class="literal">sinclude</code>), that ignores errors and does
          not generate warnings:</p><a id="OEBPS/ch08s03.html.I_3_tt380"></a><pre class="programlisting">ifneq "$(MAKECMDGOALS)" "å¹²å‡€"
  -åŒ…æ‹¬$ï¼ˆä¾èµ–é¡¹ï¼‰
ä¸‡ä¸€</pre><pre class="programlisting">ifneq "$(MAKECMDGOALS)" "clean"
  -include $(dependencies)
endif</pre><p>è¿™è§£å†³äº†ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå³å½“ä¾èµ–æ–‡ä»¶å°šä¸å­˜åœ¨æ—¶å‡ºçŽ°çƒ¦äººçš„æ¶ˆæ¯ã€‚</p><p>This solves the second problem, that of an annoying message
          when a dependency file does not yet exist.</p><p>æœ€åŽï¼Œå½“å‘çŽ°ç¼ºå°‘å…ˆå†³æ¡ä»¶æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›æŠ€å·§æ¥é¿å…è­¦å‘Šã€‚è¯€çªæ˜¯ä¸ºä¸¢å¤±çš„æ–‡ä»¶åˆ›å»ºä¸€ä¸ªæ²¡æœ‰å…ˆå†³æ¡ä»¶å’Œå‘½ä»¤çš„ç›®æ ‡ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬çš„ä¾èµ–æ–‡ä»¶ç”Ÿæˆå™¨åˆ›å»ºäº†æ­¤ä¾èµ–é¡¹ï¼š</p><p>Finally, we can avoid the warning when missing prerequisites
          are discovered with a little trickery. The trick is to create a
          target for the missing file that has no prerequisites and no
          commands. For example, suppose our dependency file generator has
          created this dependency:</p><a id="OEBPS/ch08s03.html.I_3_tt381"></a><pre class="programlisting">target.o target.d: header.h</pre><pre class="programlisting">target.o target.d: header.h</pre><p>çŽ°åœ¨å‡è®¾ï¼Œç”±äºŽä»£ç é‡æž„ï¼Œ<em class="filename">header.h</em>ä¸å†å­˜åœ¨ã€‚ä¸‹æ¬¡æˆ‘ä»¬è¿è¡Œ<em class="filename">makefile</em>æ—¶ï¼Œæˆ‘ä»¬ä¼šæ”¶åˆ°é”™è¯¯ï¼š</p><p>Now suppose that, due to code refactoring, <em class="filename">header.h</em> no longer exists. The next time
          we run the <em class="filename">makefile</em> we'll get
          the error:</p><a id="OEBPS/ch08s03.html.I_3_tt382"></a><pre class="programlisting">make: *** æ²¡æœ‰è§„åˆ™å¯ä»¥ç”Ÿæˆ target.d æ‰€éœ€çš„ç›®æ ‡ header.hã€‚åœæ­¢ã€‚</pre><pre class="programlisting">make: *** No rule to make target header.h, needed by target.d.  Stop.</pre><p><em class="filename">ä½†å¦‚æžœæˆ‘ä»¬å°†ä¸€ä¸ªæ²¡æœ‰header.h</em>å‘½ä»¤çš„ç›®æ ‡æ·»åŠ åˆ°ä¾èµ–æ–‡ä»¶ä¸­ï¼Œåˆ™ä¸ä¼šå‡ºçŽ°é”™è¯¯ï¼š</p><p>But if we add a target with no command for <em class="filename">header.h</em> to the dependency file, the
          error does not occur:</p><a id="OEBPS/ch08s03.html.I_3_tt383"></a><pre class="programlisting">target.o target.d: header.h
æ ‡å¤´.hï¼š</pre><pre class="programlisting">target.o target.d: header.h
header.h:</pre><p>è¿™æ˜¯å› ä¸ºï¼Œå¦‚æžœ<em class="filename">header.h</em>ä¸å­˜åœ¨ï¼Œå®ƒå°†è¢«ç®€å•åœ°è§†ä¸ºè¿‡æ—¶ï¼Œå¹¶ä¸”ä½¿ç”¨å®ƒä½œä¸ºå…ˆå†³æ¡ä»¶çš„ä»»ä½•ç›®æ ‡éƒ½å°†è¢«æ›´æ–°ã€‚å› æ­¤ä¾èµ–æ–‡ä»¶å°†é‡æ–°ç”Ÿæˆï¼Œè€Œæ²¡æœ‰<em class="filename">header.hï¼Œ</em>
          å› ä¸ºå®ƒä¸å†è¢«å¼•ç”¨ã€‚å¦‚æžœ<em class="filename">header.h</em>ç¡®å®žå­˜åœ¨ï¼Œ<em class="command">make</em>ä¼šè®¤ä¸ºå®ƒæ˜¯æœ€æ–°çš„å¹¶ç»§ç»­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯ç¡®ä¿æ¯ä¸ªå…ˆå†³æ¡ä»¶éƒ½æœ‰ä¸€ä¸ªå…³è”çš„ç©ºè§„åˆ™ã€‚æ‚¨å¯èƒ½è¿˜è®°å¾—ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡é‡åˆ°è¿™ç§è§„åˆ™æ˜¯åœ¨<a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™">ç¬¬ 2 ç« çš„</a><a class="link" href="#OEBPS/ch02.html.make3-CHP-2-SECT-1.2" title="è™šå‡ç›®æ ‡">2.1.2 èŠ‚</a>ä¸­ã€‚è¿™æ˜¯æ·»åŠ æ–°ç›®æ ‡çš„ç‰ˆæœ¬
          ï¼š<a class="link" href="#OEBPS/ch02.html" title="ç¬¬ 2 ç«  è§„åˆ™"></a><code class="function">make-depend</code></p><p>This is because, if <em class="filename">header.h</em> does not exist, it will simply
          be considered out of date and any targets that use it as a
          prerequisite will be updated. So the dependency file will be
          regenerated without <em class="filename">header.h</em>
          because it is no longer referenced. If <em class="filename">header.h</em> does exist, <em class="command">make</em> considers it up to date and
          continues. So, all we need to do is ensure that every prerequisite
          has an associated empty rule. You may recall that we first
          encountered this kind of rule in <a class="link" href="#OEBPS/ch02.html.make3-CHP-2-SECT-1.2" title="Phony Targets">Section 2.1.2</a> in <a class="link" href="#OEBPS/ch02.html" title="Chapter&nbsp;2.&nbsp;Rules">Chapter 2</a>. Here is a version of
          <code class="function">make-depend</code> that adds the new
          targets:</p><a id="OEBPS/ch08s03.html.I_3_tt384"></a><pre class="programlisting"># $(è°ƒç”¨ make-depend,æºæ–‡ä»¶,ç›®æ ‡æ–‡ä»¶,ä¾èµ–æ–‡ä»¶)
å®šä¹‰ make-depend
  $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -M $1 | \
  $(SED) 's,\($$(notdir $2)\) *:,$$(dir $2) $3: ,' &gt; $3.tmp
  $(SED) -e 's/#.*//' \
         -e 's/^[^:]*: *//' \
         -e's/*\\$$$$//'\
         -e '/^$$$$/ d' \
         -e 's/$$$$/ :/' $3.tmp &gt;&gt; $3.tmp
  $(MV) $3.tmp $3
æ©å¾·å¤«</pre><pre class="programlisting"># $(call make-depend,source-file,object-file,depend-file)
define make-depend
  $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -M $1 |        \
  $(SED) 's,\($$(notdir $2)\) *:,$$(dir $2) $3: ,' &gt; $3.tmp
  $(SED) -e 's/#.*//'                                       \
         -e 's/^[^:]*: *//'                                 \
         -e 's/ *\\$$$$//'                                  \
         -e '/^$$$$/ d'                                     \
         -e 's/$$$$/ :/' $3.tmp &gt;&gt; $3.tmp
  $(MV) $3.tmp $3
endef</pre><p>æˆ‘ä»¬å¯¹ä¾èµ–æ–‡ä»¶æ‰§è¡Œæ–°çš„<em class="command">sed</em>
          å‘½ä»¤æ¥ç”Ÿæˆé™„åŠ è§„åˆ™ã€‚è¿™å—<em class="command">sed</em>ä»£ç æ‰§è¡Œäº”æ¬¡è½¬æ¢ï¼š</p><p>We execute a new <em class="command">sed</em>
          command on the dependency file to generate the additional rules.
          This chunk of <em class="command">sed</em> code performs
          five transformations:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>åˆ é™¤è¯„è®º</p></li><li class="listitem"><p>Deletes comments</p></li><li class="listitem"><p>åˆ é™¤ç›®æ ‡æ–‡ä»¶å’ŒåŽç»­ç©ºæ ¼</p></li><li class="listitem"><p>Deletes the target file(s) and subsequent spaces</p></li><li class="listitem"><p>åˆ é™¤å°¾éšç©ºæ ¼</p></li><li class="listitem"><p>Deletes trailing spaces</p></li><li class="listitem"><p>åˆ é™¤ç©ºè¡Œ</p></li><li class="listitem"><p>Deletes blank lines</p></li><li class="listitem"><p>åœ¨æ¯è¡Œæœ«å°¾æ·»åŠ ä¸€ä¸ªå†’å·</p></li><li class="listitem"><p>Adds a colon to the end of every line</p></li></ol></div><p>ï¼ˆ<acronym class="acronym">GNU </acronym> <em class="command">sed</em>
          èƒ½å¤Ÿåœ¨å•ä¸ªå‘½ä»¤è¡Œä¸­è¯»å–æ–‡ä»¶å¹¶é™„åŠ åˆ°è¯¥æ–‡ä»¶ï¼Œä»Žè€Œä½¿æˆ‘ä»¬ä¸å¿…ä½¿ç”¨ç¬¬äºŒä¸ªä¸´æ—¶æ–‡ä»¶ã€‚æ­¤åŠŸèƒ½å¯èƒ½æ— æ³•åœ¨å…¶ä»–ç³»ç»Ÿä¸Šå·¥ä½œã€‚ï¼‰æ–°çš„<em class="command">sed</em>å‘½ä»¤å°†æŽ¥å—çœ‹èµ·æ¥åƒçš„è¾“å…¥å–œæ¬¢ï¼š</p><p>(<acronym class="acronym">GNU</acronym> <em class="command">sed</em>
          is able to read from a file and append to it in a single command
          line, saving us from having to use a second temporary file. This
          feature may not work on other systems.) The new <em class="command">sed</em> command will take input that looks
          like:</p><a id="OEBPS/ch08s03.html.I_3_tt385"></a><pre class="programlisting">ï¼ƒ ä»»ä½•æ„è§
target.o target.d: prereq1 prereq2 prereq3 \
     å…ˆå†³æ¡ä»¶4</pre><pre class="programlisting"># any comments
target.o target.d: prereq1 prereq2 prereq3 \
     prereq4</pre><p>å¹¶å°†å…¶è½¬åŒ–ä¸ºï¼š</p><p>and transform it into:</p><a id="OEBPS/ch08s03.html.I_3_tt386"></a><pre class="programlisting">å…ˆå†³æ¡ä»¶1 å…ˆå†³æ¡ä»¶2 å…ˆå†³æ¡ä»¶3ï¼š
å…ˆå†³æ¡ä»¶4ï¼š</pre><pre class="programlisting">prereq1 prereq2 prereq3:
prereq4:</pre><p>å› æ­¤ï¼Œ<code class="function">make-depend</code>å°†è¿™ä¸ªæ–°è¾“å‡ºé™„åŠ åˆ°åŽŸå§‹ä¾èµ–æ–‡ä»¶ä¸­ã€‚è¿™è§£å†³äº†â€œæ²¡æœ‰è§„åˆ™æ¥åˆ›å»ºç›®æ ‡â€é”™è¯¯ã€‚</p><p>So <code class="function">make-depend</code> appends
          this new output to the original dependency file. This solves the "No
          rule to make target" error.</p></div><div class="sect2" title="ä¾èµ–ç¨‹åº"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch08s03.html.make3-CHP-8-SECT-3.2"></a>ä¾èµ–ç¨‹åº</h2><h2 class="title"><a></a>makedepend Programs</h2></div></div></div><p>åˆ°çŽ°åœ¨ä¸ºæ­¢æˆ‘ä»¬å·²ç»<a id="OEBPS/ch08s03.html.make3-CHP-8-ITERM-1450" class="indexterm"></a>å†…å®¹æ˜¯ä½¿ç”¨<code class="option">-M</code>å¤§å¤šæ•°ç¼–è¯‘å™¨æä¾›çš„é€‰é¡¹ï¼Œä½†æ˜¯å¦‚æžœè¿™ä¸ªé€‰é¡¹ä¸å­˜åœ¨æ€Žä¹ˆåŠžï¼Ÿæˆ–è€…ï¼Œè¿˜æœ‰æ¯”æˆ‘ä»¬çš„ç®€å•æ›´å¥½çš„é€‰æ‹©å—
          <code class="option">-M</code>ï¼Ÿ</p><p>Up to now we have been <a class="indexterm"></a>content to use the <code class="option">-M</code> option provided
          by most compilers, but what if this option doesn't exist?
          Alternatively, are there better options than our simple
          <code class="option">-M</code>?</p><p>å¦‚ä»Šï¼Œå¤§å¤šæ•° C ç¼–è¯‘å™¨éƒ½æ”¯æŒä»Žæºä»£ç ç”Ÿæˆ
          <em class="command">make</em>ä¾èµ–é¡¹ï¼Œä½†ä¸ä¹…å‰è¿™è¿˜ä¸æ˜¯çœŸçš„ã€‚åœ¨ X Window System é¡¹ç›®çš„æ—©æœŸï¼Œä»–ä»¬å®žçŽ°äº†ä¸€ä¸ªå·¥å…·<em class="command">makedepend</em>ï¼Œç”¨äºŽè®¡ç®—ä¸€ç»„ C æˆ– C++ æºä»£ç çš„ä¾èµ–å…³ç³»ã€‚è¯¥å·¥å…·å¯é€šè¿‡äº’è”ç½‘å…è´¹èŽ·å¾—ã€‚ä½¿ç”¨<em class="command">makedepend</em>æœ‰ç‚¹å°´å°¬ï¼Œå› ä¸ºå®ƒè¢«ç¼–å†™ä¸ºå°†å…¶è¾“å‡ºé™„åŠ åˆ°
          <em class="filename">makefile</em>ï¼Œè€Œæˆ‘ä»¬ä¸æƒ³è¿™æ ·åšã€‚<em class="command">makedepend</em>çš„è¾“å‡º
          å‡å®šç›®æ ‡æ–‡ä»¶ä¸Žæºæ–‡ä»¶ä½äºŽåŒä¸€ç›®å½•ä¸­ã€‚è¿™å†æ¬¡æ„å‘³ç€æˆ‘ä»¬çš„<em class="command">sed</em>
          è¡¨è¾¾å¼å¿…é¡»æ”¹å˜ï¼š</p><p>These days most C compilers have some support for generating
          <em class="command">make</em> dependencies from the
          source, but not long ago this wasn't true. In the early days of the
          X Window System project, they implemented a tool, <em class="command">makedepend</em>, that computes the dependencies
          from a set of C or C++ sources. This tool is freely available over
          the Internet. Using <em class="command">makedepend</em> is
          a little awkward because it is written to append its output to the
          <em class="filename">makefile</em>, which we do not want
          to do. The output of <em class="command">makedepend</em>
          assumes the object files reside in the same directory as the source.
          This means that, again, our <em class="command">sed</em>
          expression must change:</p><a id="OEBPS/ch08s03.html.I_3_tt387"></a><pre class="programlisting"># $(è°ƒç”¨ make-depend,æºæ–‡ä»¶,ç›®æ ‡æ–‡ä»¶,ä¾èµ–æ–‡ä»¶)
å®šä¹‰ make-depend
  $(MAKEDEPEND) -f- $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) $1 | \
  $(SED) 's,^.*/\([^/]*\.o\) *:,$(dir $2)\1 $3: ,' &gt; $3.tmp
  $(SED) -e 's/#.*//' \
         -e 's/^[^:]*: *//' \
         -e's/*\\$$$$//'\
         -e '/^$$$$/ d' \
         -e 's/$$$$/ :/' $3.tmp &gt;&gt; $3.tmp
  $(MV) $3.tmp $3
æ©å¾·å¤«</pre><pre class="programlisting"># $(call make-depend,source-file,object-file,depend-file)
define make-depend
  $(MAKEDEPEND) -f- $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) $1 | \
  $(SED) 's,^.*/\([^/]*\.o\) *:,$(dir $2)\1 $3: ,' &gt; $3.tmp
  $(SED) -e 's/#.*//'                                         \
         -e 's/^[^:]*: *//'                                   \
         -e 's/ *\\$$$$//'                                    \
         -e '/^$$$$/ d'                                       \
         -e 's/$$$$/ :/' $3.tmp &gt;&gt; $3.tmp
  $(MV) $3.tmp $3
endef</pre><p>è¯¥<code class="option">-f-</code>é€‰é¡¹å‘Šè¯‰<em class="command">makedepend</em>å°†å…¶ä¾èµ–å…³ç³»ä¿¡æ¯å†™å…¥æ ‡å‡†è¾“å‡ºã€‚</p><p>The <code class="option">-f-</code> option tells <em class="command">makedepend</em> to write its dependency
          information to the standard output.</p><p><em class="command">ä½¿ç”¨makedepend</em>æˆ–æœ¬æœºç¼–è¯‘å™¨çš„æ›¿ä»£æ–¹æ³•æ˜¯ä½¿ç”¨<em class="command">gcc</em>ã€‚å®ƒæä¾›äº†ä¸€ç»„ä»¤äººçœ¼èŠ±ç¼­ä¹±çš„é€‰é¡¹æ¥ç”Ÿæˆä¾èµ–æ€§ä¿¡æ¯ã€‚æœ€é€‚åˆæˆ‘ä»¬å½“å‰è¦æ±‚çš„æ˜¯ï¼š</p><p>An alternative to using <em class="command">makedepend</em> or your native compiler is to
          use <em class="command">gcc</em>. It sports a bewildering
          set of options for generating dependency information. The ones that
          seem most apropos for our current requirements are:</p><a id="OEBPS/ch08s03.html.I_3_tt388"></a><pre class="programlisting">ifneq "$(MAKECMDGOALS)" "å¹²å‡€"
  -åŒ…æ‹¬$ï¼ˆä¾èµ–é¡¹ï¼‰
ä¸‡ä¸€

# $(è°ƒç”¨ make-depend,æºæ–‡ä»¶,ç›®æ ‡æ–‡ä»¶,ä¾èµ–æ–‡ä»¶)
å®šä¹‰ make-depend
  $(GCC)-MM \
         -MF $3 \
         -MP \
         -MT $2 \
         $(CFLAGS) \
         $(CPPFLAGS) \
         $(TARGET_ARCH) \
         1 ç¾Žå…ƒ
æ©å¾·å¤«

%.o: %.c
        $(è°ƒç”¨ make-depend,$&lt;,$@,$(subst .o,.d,$@))
        $(COMPILE.c) $(OUTPUT_OPTION) $&lt;</pre><pre class="programlisting">ifneq "$(MAKECMDGOALS)" "clean"
  -include $(dependencies)
endif

# $(call make-depend,source-file,object-file,depend-file)
define make-depend
  $(GCC) -MM            \
         -MF $3         \
         -MP            \
         -MT $2         \
         $(CFLAGS)      \
         $(CPPFLAGS)    \
         $(TARGET_ARCH) \
         $1
endef

%.o: %.c
        $(call make-depend,$&lt;,$@,$(subst .o,.d,$@))
        $(COMPILE.c) $(OUTPUT_OPTION) $&lt;</pre><p>è¯¥<code class="option">-MM</code>é€‰é¡¹å¯¼è‡´<em class="command">gcc</em>ä»Žå…ˆå†³æ¡ä»¶åˆ—è¡¨ä¸­çœç•¥â€œç³»ç»Ÿâ€æ ‡å¤´ã€‚è¿™å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºè¿™äº›æ–‡ä»¶å¾ˆå°‘ï¼ˆå¦‚æžœæœ‰çš„è¯ï¼‰å‘ç”Ÿæ›´æ”¹ï¼Œå¹¶ä¸”éšç€æž„å»ºç³»ç»Ÿå˜å¾—æ›´åŠ å¤æ‚ï¼Œå‡å°‘æ··ä¹±ä¼šæœ‰æ‰€å¸®åŠ©ã€‚æœ€åˆï¼Œè¿™æ ·åšå¯èƒ½æ˜¯å‡ºäºŽæ€§èƒ½åŽŸå› ã€‚å¯¹äºŽå½“ä»Šçš„å¤„ç†å™¨ï¼Œæ€§èƒ½å·®å¼‚å‡ ä¹Žæ— æ³•è¡¡é‡ã€‚</p><p>The <code class="option">-MM</code> option causes <em class="command">gcc</em> to omit "system" headers from the
          prerequisites list. This is useful because these files rarely, if
          ever, change and, as the build system gets more complex, reducing
          the clutter helps. Originally, this may have been done for
          performance reasons. With today's processors, the performance
          difference is barely measurable.</p><p>è¯¥<code class="option">-MF</code>é€‰é¡¹æŒ‡å®šä¾èµ–æ–‡ä»¶åã€‚è¿™å°†æ˜¯å¯¹è±¡æ–‡ä»¶åï¼Œå…¶ä¸­<em class="filename">.d</em>åŽç¼€æ›¿æ¢<em class="filename">.o</em>ã€‚è¿˜æœ‰å¦ä¸€ä¸ª<em class="command">gcc</em>é€‰é¡¹<code class="option">-MD</code>æˆ–
          <code class="option">-MMD</code>ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„æ›¿æ¢è‡ªåŠ¨ç”Ÿæˆè¾“å‡ºæ–‡ä»¶åã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ›´æ„¿æ„ä½¿ç”¨æ­¤é€‰é¡¹ï¼Œä½†æ›¿æ¢æ— æ³•åŒ…å«ç›®æ ‡æ–‡ä»¶ç›®å½•çš„æ­£ç¡®ç›¸å¯¹è·¯å¾„ï¼Œè€Œæ˜¯å°†
          <em class="filename">.d</em>æ–‡ä»¶æ”¾ç½®åœ¨å½“å‰ç›®å½•ä¸­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¢«è¿«ä½¿ç”¨
          <code class="option">-MF</code>.</p><p>The <code class="option">-MF</code> option specifies the dependency
          filename. This will be the object filename with the <em class="filename">.d</em> suffix substituted for <em class="filename">.o</em>. There is another <em class="command">gcc</em> option, <code class="option">-MD</code> or
          <code class="option">-MMD</code>, that automatically generates the output
          filename using a similar substitution. Ideally we would prefer to
          use this option, but the substitution fails to include the proper
          relative path to the object file directory and instead places the
          <em class="filename">.d</em> file in the current
          directory. So, we are forced to do the job ourselves using
          <code class="option">-MF</code>.</p><p>è¯¥<code class="option">-MP</code>é€‰é¡¹æŒ‡ç¤º<em class="command">gcc</em>ä¸ºæ¯ä¸ªå…ˆå†³æ¡ä»¶åŒ…å«è™šå‡ç›®æ ‡ã€‚è¿™å®Œå…¨æ¶ˆé™¤äº†æˆ‘ä»¬å‡½æ•°ä¸­æ··ä¹±çš„äº”éƒ¨åˆ†
          <em class="command">sed</em><code class="function">make-depend</code>è¡¨è¾¾å¼ã€‚ä¼¼ä¹Žæ˜¯
          å‘æ˜Žå‡ç›®æ ‡æŠ€æœ¯çš„<em class="command">automake</em>å¼€å‘äººå‘˜å¯¼è‡´å°†æ­¤é€‰é¡¹æ·»åŠ åˆ°
          <em class="command">gcc</em>ä¸­ã€‚</p><p>The <code class="option">-MP</code> option instructs <em class="command">gcc</em> to include phony targets for each
          prerequisite. This completely eliminates the messy five-part
          <em class="command">sed</em> expression in our <code class="function">make-depend</code> function. It seems that the
          <em class="command">automake</em> developers who invented
          the phony target technique caused this option to be added to
          <em class="command">gcc</em>.</p><p>æœ€åŽï¼Œè¯¥<code class="option">-MT</code>é€‰é¡¹æŒ‡å®šç”¨äºŽä¾èµ–æ–‡ä»¶ä¸­çš„ç›®æ ‡çš„å­—ç¬¦ä¸²ã€‚åŒæ ·ï¼Œå¦‚æžœæ²¡æœ‰æ­¤é€‰é¡¹ï¼Œ<em class="command">gcc</em>å°†æ— æ³•åŒ…å«ç›®æ ‡æ–‡ä»¶è¾“å‡ºç›®å½•çš„ç›¸å¯¹è·¯å¾„ã€‚</p><p>Finally, the <code class="option">-MT</code> option specifies the string
          to use for the target in the dependency file. Again, without this
          option, <em class="command">gcc</em> fails to include the
          relative path to the object file output directory.</p><p>é€šè¿‡ä½¿ç”¨<em class="command">gcc</em>ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»¥å‰ç”Ÿæˆä¾èµ–é¡¹æ‰€éœ€çš„å››ä¸ªå‘½ä»¤å‡å°‘ä¸ºå•ä¸ªå‘½ä»¤ã€‚å³ä½¿ä½¿ç”¨ä¸“æœ‰ç¼–è¯‘å™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<em class="command">gcc</em>è¿›è¡Œä¾èµ–æ€§ç®¡ç†ã€‚</p><p>By using <em class="command">gcc</em>, we can reduce
          the four commands previously required for dependency generation to a
          single command. Even when proprietary compilers are used it may be
          possible to use <em class="command">gcc</em> for
          dependency management.</p></div><div class="footnotes"><br><br><hr><div class="footnote"><p><sup>[ <a id="OEBPS/ch08s03.html.ftn.make3-CHP-8-FNOTE-1" href="#OEBPS/ch08s03.html.make3-CHP-8-FNOTE-1" class="para">1</a> ]</sup>æœ¬èŠ‚ä¸­çš„å¤§éƒ¨åˆ†ææ–™æ˜¯ Tom Tromey ( <span class="email"><a class="email" href="#OEBPS/mailto:tromey@cygnus.com">tromey@cygnus.com</a></span> ) ä¸º
            <acronym class="acronym">GNU </acronym> <em class="command">automake</em>
            å®žç”¨ç¨‹åºå‘æ˜Žçš„ï¼Œå¹¶æ‘˜è‡ª Paul Smithï¼ˆ<acronym class="acronym">GNU </acronym> <em class="command">make</em>çš„ç»´æŠ¤è€…ï¼‰åœ¨ä»–çš„ç½‘ç«™<a class="ulink" href="http://make.paulandlesley.org/">httpä¸Šå‘è¡¨çš„ä¼˜ç§€æ€»ç»“æ–‡ç« ã€‚ ://make.paulandlesley.org</a>ã€‚</p><p><sup>[<a href="#OEBPS/ch08s03.html.make3-CHP-8-FNOTE-1" class="para">1</a>] </sup>Much of the material in this section was invented by Tom
            Tromey (<span class="email"><a class="email" href="#OEBPS/mailto:tromey@cygnus.com">tromey@cygnus.com</a></span>) for the
            <acronym class="acronym">GNU</acronym> <em class="command">automake</em>
            utility and is taken from the excellent summary article by Paul
            Smith (the maintainer of <acronym class="acronym">GNU</acronym> <em class="command">make</em>) from his web site <a class="ulink" href="http://make.paulandlesley.org">http://make.paulandlesley.org</a>.</p></div></div></div></div></div>
<div id="OEBPS/ch08s04.html"><div>
<div class="sect1" title="æ”¯æŒå¤šä¸ªäºŒå‰æ ‘"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch08s04.html.make3-CHP-8-SECT-4"></a>æ”¯æŒå¤šä¸ªäºŒå‰æ ‘</h1><h1 class="title"><a></a>Supporting Multiple Binary Trees</h1></div></div></div><p>ä¸€æ—¦<em class="filename">makefile</em>ä¿®æ”¹ä¸ºå†™å…¥<a id="OEBPS/ch08s04.html.make3-CHP-8-ITERM-1451" class="indexterm"></a>å°†äºŒè¿›åˆ¶æ–‡ä»¶æ”¾å…¥å•ç‹¬çš„æ ‘ä¸­ï¼Œæ”¯æŒè®¸å¤šæ ‘å˜å¾—ç›¸å½“ç®€å•ã€‚å¯¹äºŽäº¤äº’å¼æˆ–å¼€å‘äººå‘˜è°ƒç”¨çš„æž„å»ºï¼Œå¼€å‘äººå‘˜ä»Žé”®ç›˜å¯åŠ¨æž„å»ºï¼Œå‡ ä¹Žä¸éœ€è¦ä»»ä½•å‡†å¤‡ã€‚å¼€å‘äººå‘˜åˆ›å»ºè¾“å‡ºç›®å½•ï¼Œ<em class="command">é€šè¿‡ cd</em>è¿›å…¥è¯¥ç›®å½•å¹¶
        åœ¨<em class="filename">makefile</em>ä¸Šè°ƒç”¨<em class="command">make</em>ã€‚<em class="filename"></em></p><p>Once the <em class="filename">makefile</em> is
        modified to write <a class="indexterm"></a>binary files into a separate tree, supporting many trees
        becomes quite simple. For interactive or developer-invoked builds,
        where a developer initiates a build from the keyboard, there is little
        or no preparation required. The developer creates the output
        directory, <em class="command">cd</em>'s to it and invokes
        <em class="command">make</em> on the <em class="filename">makefile</em>.</p><a id="OEBPS/ch08s04.html.I_3_tt389"></a><pre class="programlisting">$$$<strong class="userinput"><code>mkdir -p ~/work/mp3_player_out</code></strong>
â€‹<strong class="userinput"><code>cd ~/work/mp3_player_out</code></strong>
â€‹<strong class="userinput"><code>make -f ~/work/mp3_player/makefile</code></strong></pre><pre class="programlisting">$<strong class="userinput"><code>mkdir -p ~/work/mp3_player_out</code></strong>
$ <strong class="userinput"><code>cd ~/work/mp3_player_out</code></strong>
$ <strong class="userinput"><code>make -f ~/work/mp3_player/makefile</code></strong></pre><p>å¦‚æžœè¿‡ç¨‹æ¯”è¿™æ›´å¤æ‚ï¼Œé‚£ä¹ˆ shell è„šæœ¬åŒ…è£…å™¨é€šå¸¸æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆã€‚è¯¥åŒ…è£…å™¨è¿˜å¯ä»¥è§£æžå½“å‰ç›®å½•å¹¶è®¾ç½®ä¸€ä¸ªçŽ¯å¢ƒå˜é‡ï¼Œä¾›<em class="filename">makefile</em><code class="literal">BINARY_DIR</code>ä½¿ç”¨ã€‚<em class="filename"></em></p><p>If the process is more involved than this, then a shell script
        wrapper is usually the best solution. This wrapper can also parse the
        current directory and set an environment variable like <code class="literal">BINARY_DIR</code> for use by the <em class="filename">makefile</em>.</p><a id="OEBPS/ch08s04.html.I_3_tt390"></a><pre class="programlisting">#ï¼ /bin/bash

# å‡è®¾æˆ‘ä»¬ä½äºŽæºç›®å½•ä¸­ã€‚
å½“å‰=$PWD
å¯¼å‡º SOURCE_DIR=$curr
è€Œ[[ $SOURCE_DIR ]]
åš
  if [[ -e $SOURCE_DIR/[Mm]akefile ]]
  ç„¶åŽ
    ä¼‘æ¯;
  è²
  SOURCE_DIR=${SOURCE_DIR%/*}
å®Œæ¯•

# å¦‚æžœæˆ‘ä»¬æ²¡æœ‰æ‰¾åˆ° makefileï¼Œåˆ™æ‰“å°é”™è¯¯ã€‚
å¦‚æžœ [[ ï¼ $SOURCE_DIR ]]
ç„¶åŽ
  printf "run-make: æ‰¾ä¸åˆ° makefile" &gt; /dev/stderr
  1å·å‡ºå£
è²

# å¦‚æžœæœªè®¾ç½®ï¼Œåˆ™å°†è¾“å‡ºç›®å½•è®¾ç½®ä¸ºé»˜è®¤å€¼ã€‚
å¦‚æžœ [[ ï¼ $BINARY_DIR ]]
ç„¶åŽ
  BINARY_DIR=${SOURCE_DIR}_out
è²

# åˆ›å»ºè¾“å‡ºç›®å½•
mkdir --parents $BINARY_DIR

# è¿è¡Œ make.
make --directory="$BINARY_DIR" "$@"</pre><pre class="programlisting">#! /bin/bash

# Assume we are in the source directory.
curr=$PWD
export SOURCE_DIR=$curr
while [[ $SOURCE_DIR ]]
do
  if [[ -e $SOURCE_DIR/[Mm]akefile ]]
  then
    break;
  fi
  SOURCE_DIR=${SOURCE_DIR%/*}
done

# Print an error if we haven't found a makefile.
if [[ ! $SOURCE_DIR ]]
then
  printf "run-make: Cannot find a makefile" &gt; /dev/stderr
  exit 1
fi

# Set the output directory to a default, if not set.
if [[ ! $BINARY_DIR ]]
then
  BINARY_DIR=${SOURCE_DIR}_out
fi

# Create the output directory
mkdir --parents $BINARY_DIR

# Run the make.
make --directory="$BINARY_DIR" "$@"</pre><p>è¿™ä¸ªç‰¹æ®Šçš„è„šæœ¬æœ‰ç‚¹å¥‡ç‰¹ã€‚å®ƒé¦–å…ˆåœ¨å½“å‰ç›®å½•ä¸­æœç´¢
        <em class="filename">makefile</em>ï¼Œç„¶åŽåœ¨æ ‘ä¸Šçš„çˆ¶ç›®å½•ä¸­æœç´¢ï¼Œç›´åˆ°
        æ‰¾åˆ°<em class="filename">makefile</em> ã€‚ç„¶åŽå®ƒæ£€æŸ¥äºŒå‰æ ‘çš„å˜é‡æ˜¯å¦å·²è®¾ç½®ã€‚å¦‚æžœæ²¡æœ‰ï¼Œåˆ™é€šè¿‡å°†â€œ_outâ€é™„åŠ åˆ°æºç›®å½•æ¥è®¾ç½®ã€‚ç„¶åŽè¯¥è„šæœ¬åˆ›å»ºè¾“å‡ºç›®å½•å¹¶æ‰§è¡Œ<em class="command">make</em>ã€‚</p><p>This particular script is a bit fancier. It searches for the
        <em class="filename">makefile</em> first in the current
        directory and then in the parent directory on up the tree until a
        <em class="filename">makefile</em> is found. It then checks
        that the variable for the binary tree is set. If not, it is set by
        appending "_out" to the source directory. The script then creates the
        output directory and executes <em class="command">make</em>.</p><p>å¦‚æžœæž„å»ºæ˜¯åœ¨ä¸åŒå¹³å°ä¸Šæ‰§è¡Œçš„ï¼Œåˆ™éœ€è¦æŸç§åŒºåˆ†å¹³å°çš„æ–¹æ³•ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯è¦æ±‚å¼€å‘äººå‘˜ä¸ºæ¯ç§ç±»åž‹çš„å¹³å°è®¾ç½®ä¸€ä¸ªçŽ¯å¢ƒå˜é‡ï¼Œå¹¶æ ¹æ®è¯¥å˜é‡åœ¨<em class="filename">makefile</em>å’Œæºä»£ç ä¸­æ·»åŠ æ¡ä»¶ã€‚æ›´å¥½çš„æ–¹æ³•æ˜¯æ ¹æ®<em class="command">uname</em>çš„è¾“å‡ºè‡ªåŠ¨è®¾ç½®å¹³å°ç±»åž‹ã€‚</p><p>If the build is being performed on different platforms, some
        method for differentiating between platforms is required. The simplest
        approach is to require the developer to set an environment variable
        for each type of platform and add conditionals to the <em class="filename">makefile</em> and source based on this variable.
        A better approach is to set the platform type automatically based on
        the output of <em class="command">uname</em>.</p><a id="OEBPS/ch08s04.html.I_3_tt391"></a><pre class="programlisting">ç©ºé—´ := $(ç©º) $(ç©º)
å¯¼å‡ºæœºå™¨ := $(subst $(ç©ºæ ¼),-,$(shell uname -smo))</pre><pre class="programlisting">space := $(empty) $(empty)
export MACHINE := $(subst $(space),-,$(shell uname -smo))</pre><p><em class="command">å¦‚æžœä»Žcron</em>è‡ªåŠ¨è°ƒç”¨æž„å»ºï¼Œæˆ‘å‘çŽ°è¾…åŠ© shell è„šæœ¬æ˜¯æ¯”è®©<em class="command">cron</em>è°ƒç”¨<em class="command">make</em>æœ¬èº«æ›´å¥½çš„æ–¹æ³•ã€‚åŒ…è£…å™¨è„šæœ¬ä¸ºè‡ªåŠ¨æž„å»ºçš„è®¾ç½®ã€é”™è¯¯æ¢å¤å’Œå®Œæˆæä¾›æ›´å¥½çš„æ”¯æŒã€‚è¯¥è„šæœ¬ä¹Ÿæ˜¯è®¾ç½®å˜é‡å’Œå‘½ä»¤è¡Œå‚æ•°çš„åˆé€‚ä½ç½®ã€‚</p><p>If the builds are being invoked automatically from <em class="command">cron</em>, I've found that a helper shell script
        is a better approach than having <em class="command">cron</em> invoke <em class="command">make</em> itself. A wrapper script provides
        better support for setup, error recovery, and finalization of an
        automated build. The script is also an appropriate place to set
        variables and command-line parameters.</p><p>æœ€åŽï¼Œå¦‚æžœé¡¹ç›®æ”¯æŒä¸€ç»„å›ºå®šçš„æ ‘å’Œå¹³å°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç›®å½•åç§°æ¥è‡ªåŠ¨è¯†åˆ«å½“å‰æž„å»ºã€‚ä¾‹å¦‚ï¼š</p><p>Finally, if a project supports a fixed set of trees and
        platforms, you can use directory names to automatically identify the
        current build. For example:</p><a id="OEBPS/ch08s04.html.I_3_tt392"></a><pre class="programlisting">ALL_TREES := /builds/hp-386-windows-optimized \
             /builds/hp-386-windows-debug \
             /builds/sgi-irix-optimzed \
             /builds/sgi-irix-debug \
             /builds/sun-solaris8-profiled \
             /builds/sun-solaris8-debug

BINARY_DIR := $(foreach t,$(ALL_TREES),\
                $(è¿‡æ»¤å™¨$(ALL_TREES)/%,$(CURDIR)))

BUILD_TYPE := $(notdir $(subst -,/,$(BINARY_DIR)))

MACHINE_TYPE := $(æ¡\
                  $(æ›¿æ¢/,-,\
                    $(patsubst %/,%, \
                      $(ç›®å½•\
                        $(æ›¿æ¢-,/,\
                          $(notdir $(BINARY_DIR)))))))</pre><pre class="programlisting">ALL_TREES := /builds/hp-386-windows-optimized \
             /builds/hp-386-windows-debug     \
             /builds/sgi-irix-optimzed        \
             /builds/sgi-irix-debug           \
             /builds/sun-solaris8-profiled    \
             /builds/sun-solaris8-debug

BINARY_DIR := $(foreach t,$(ALL_TREES),\
                $(filter $(ALL_TREES)/%,$(CURDIR)))

BUILD_TYPE := $(notdir $(subst -,/,$(BINARY_DIR)))

MACHINE_TYPE := $(strip                         \
                  $(subst /,-,                  \
                    $(patsubst %/,%,            \
                      $(dir                     \
                        $(subst -,/,            \
                          $(notdir $(BINARY_DIR)))))))</pre><p>è¯¥<code class="literal">ALL_TREES</code>å˜é‡ä¿å­˜ä¸€ä¸ª<a id="OEBPS/ch08s04.html.make3-CHP-8-ITERM-1452" class="indexterm"></a> <a id="OEBPS/ch08s04.html.make3-CHP-8-ITERM-1453" class="indexterm"></a> <a id="OEBPS/ch08s04.html.make3-CHP-8-ITERM-1454" class="indexterm"></a>æ‰€æœ‰æœ‰æ•ˆäºŒå‰æ ‘çš„åˆ—è¡¨ã€‚è¯¥<code class="function">foreach</code>å¾ªçŽ¯å°†å½“å‰ç›®å½•ä¸Žæ¯ä¸ªæœ‰æ•ˆçš„äºŒå‰æ ‘è¿›è¡ŒåŒ¹é…ã€‚åªæœ‰ä¸€ä¸ªå¯ä»¥åŒ¹é…ã€‚ä¸€æ—¦è¯†åˆ«äº†äºŒå‰æ ‘ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»Žæž„å»ºç›®å½•åç§°ä¸­æå–æž„å»ºç±»åž‹ï¼ˆä¾‹å¦‚ï¼Œä¼˜åŒ–ã€è°ƒè¯•æˆ–åˆ†æžï¼‰ã€‚æˆ‘ä»¬é€šè¿‡å°†ç ´æŠ˜å·åˆ†éš”çš„å•è¯è½¬æ¢ä¸ºæ–œæ åˆ†éš”çš„å•è¯å¹¶ä½¿ç”¨<code class="function">notdir</code>.èŽ·å–æœ€åŽä¸€ä¸ªå•è¯æ¥æ£€ç´¢ç›®å½•åç§°çš„æœ€åŽä¸€ä¸ªç»„æˆéƒ¨åˆ†ã€‚ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬é€šè¿‡æŠ“å–æœ€åŽä¸€ä¸ªå•è¯å¹¶ä½¿ç”¨ç›¸åŒçš„æŠ€æœ¯åˆ é™¤æœ€åŽä¸€ä¸ªç ´æŠ˜å·ç»„ä»¶æ¥æ£€ç´¢æœºå™¨ç±»åž‹ã€‚</p><p>The <code class="literal">ALL_TREES</code> variable holds
        a <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>list of all valid binary trees. The <code class="function">foreach</code> loop matches the current directory
        against each of the valid binary trees. Only one can match. Once the
        binary tree has been identified, we can extract the build type (e.g.,
        optimized, debug, or profiled) from the build directory name. We
        retrieve the last component of the directory name by transforming the
        dash-separated words into slash-separated words and grabbing the last
        word with <code class="function">notdir</code>. Similarly, we
        retrieve the machine type by grabbing the last word and using the same
        technique to remove the last dash component.</p></div></div></div>
<div id="OEBPS/ch08s05.html"><div>
<div class="sect1" title="éƒ¨åˆ†æºæ ‘"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch08s05.html.make3-CHP-8-SECT-5"></a>éƒ¨åˆ†æºæ ‘</h1><h1 class="title"><a></a>Partial Source Trees</h1></div></div></div><p>åœ¨çœŸæ­£çš„å¤§åž‹é¡¹ç›®ä¸­ï¼Œ<a id="OEBPS/ch08s05.html.make3-CHP-8-ITERM-1455" class="indexterm"></a> <a id="OEBPS/ch08s05.html.make3-CHP-8-ITERM-1456" class="indexterm"></a>ä»…ä»…æ£€æŸ¥å’Œç»´æŠ¤æºä»£ç å¯èƒ½ä¼šç»™å¼€å‘äººå‘˜å¸¦æ¥è´Ÿæ‹…ã€‚å¦‚æžœä¸€ä¸ªç³»ç»Ÿç”±è®¸å¤šæ¨¡å—ç»„æˆï¼Œå¹¶ä¸”ç‰¹å®šçš„å¼€å‘äººå‘˜åªä¿®æ”¹å…¶ä¸­çš„å±€éƒ¨éƒ¨åˆ†ï¼Œé‚£ä¹ˆæ£€æŸ¥å’Œç¼–è¯‘æ•´ä¸ªé¡¹ç›®å¯èƒ½ä¼šèŠ±è´¹å¤§é‡æ—¶é—´ã€‚ç›¸åï¼Œæ¯æ™šæ‰§è¡Œçš„é›†ä¸­ç®¡ç†æž„å»ºå¯ç”¨äºŽå¡«è¡¥å¼€å‘äººå‘˜çš„æºä»£ç å’ŒäºŒå‰æ ‘ä¸­çš„æ¼æ´žã€‚</p><p>On really large projects, <a class="indexterm"></a> <a class="indexterm"></a>just checking out and maintaining the source can be a
        burden on developers. If a system consists of many modules and a
        particular developer is modifying only a localized part of it,
        checking out and compiling the entire project can be a large time
        sink. Instead, a centrally managed build, performed nightly, can be
        used to fill in the holes in a developer's source and binary
        trees.</p><p>è¿™æ ·åšéœ€è¦ä¸¤ç§ç±»åž‹<a id="OEBPS/ch08s05.html.make3-CHP-8-ITERM-1457" class="indexterm"></a> <a id="OEBPS/ch08s05.html.make3-CHP-8-ITERM-1458" class="indexterm"></a> <a id="OEBPS/ch08s05.html.make3-CHP-8-ITERM-1459" class="indexterm"></a> <a id="OEBPS/ch08s05.html.make3-CHP-8-ITERM-1460" class="indexterm"></a>æœç´¢ã€‚é¦–å…ˆï¼Œå½“ç¼–è¯‘å™¨éœ€è¦ç¼ºå°‘çš„å¤´æ–‡ä»¶æ—¶ï¼Œå¿…é¡»æŒ‡ç¤ºå®ƒåœ¨å‚è€ƒæºä»£ç æ ‘ä¸­è¿›è¡Œæœç´¢ã€‚å…¶æ¬¡ï¼Œå½“<em class="filename">makefile</em>
        éœ€è¦ç¼ºå°‘çš„åº“æ—¶ï¼Œå¿…é¡»å‘Šè¯‰å®ƒåœ¨å¼•ç”¨äºŒå‰æ ‘ä¸­æœç´¢ã€‚ä¸ºäº†å¸®åŠ©ç¼–è¯‘å™¨æ‰¾åˆ°æºä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°åœ¨
        æŒ‡å®šæœ¬åœ°ç›®å½•çš„é€‰é¡¹<code class="option">-I</code>åŽé¢æ·»åŠ é™„åŠ é€‰é¡¹ã€‚<code class="option">-I</code>ä¸ºäº†å¸®åŠ©<em class="command">æŸ¥æ‰¾</em>åº“ï¼Œæˆ‘ä»¬å¯ä»¥å‘<code class="literal">vpath</code>.</p><p>Doing so requires two types of <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>search. First, when a missing header file is required by
        the compiler, it must be instructed to search in the reference source
        tree. Second, when the <em class="filename">makefile</em>
        requires a missing library, it must be told to search in the reference
        binary tree. To help the compiler find source, we can simply add
        additional <code class="option">-I</code> options after the <code class="option">-I</code>
        options specifying local directories. To help <em class="command">make</em> find libraries, we can add additional
        directories to the <code class="literal">vpath</code>.</p><a id="OEBPS/ch08s05.html.I_3_tt393"></a><pre class="programlisting">SOURCE_DIR := ../mp3_player
REF_SOURCE_DIR := /reftree/src/mp3_player
REF_BINARY_DIR := /binaries/mp3_player
...
include_dirs := lib $(SOURCE_DIR)/lib $(SOURCE_DIR)/include
CPPFLAGS += $(addprefix -I ,$(include_dirs)) \
                $(addprefix -I $(REF_SOURCE_DIR)/,$(include_dirs))
vpath %.h $(include_dirs) \
                $(addprefix $(REF_SOURCE_DIR)/,$(include_dirs))

vpath %.a $(addprefix $(REF_BINARY_DIR)/lib/ï¼Œç¼–è§£ç å™¨ db ui)</pre><pre class="programlisting">SOURCE_DIR     := ../mp3_player
REF_SOURCE_DIR := /reftree/src/mp3_player
REF_BINARY_DIR := /binaries/mp3_player
...
include_dirs := lib $(SOURCE_DIR)/lib $(SOURCE_DIR)/include
CPPFLAGS     += $(addprefix -I ,$(include_dirs))                  \
                $(addprefix -I $(REF_SOURCE_DIR)/,$(include_dirs))
vpath %.h       $(include_dirs)                                   \
                $(addprefix $(REF_SOURCE_DIR)/,$(include_dirs))

vpath %.a       $(addprefix $(REF_BINARY_DIR)/lib/, codec db ui)</pre><p>æ­¤æ–¹æ³•å‡è®¾ CVS ç­¾å‡ºçš„â€œç²’åº¦â€æ˜¯åº“æˆ–ç¨‹åºæ¨¡å—ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æžœå¼€å‘äººå‘˜é€‰æ‹©ä¸æ£€æŸ¥ä¸¢å¤±çš„åº“å’Œç¨‹åºç›®å½•ï¼Œåˆ™å¯ä»¥è®¾è®¡ä¸ºè·³è¿‡å®ƒä»¬<em class="command">ã€‚</em>å½“éœ€è¦ä½¿ç”¨è¿™äº›åº“æ—¶ï¼Œæœç´¢è·¯å¾„å°†è‡ªåŠ¨å¡«å……ä¸¢å¤±çš„æ–‡ä»¶ã€‚</p><p>This approach assumes that the "granularity" of a CVS check out
        is a library or program module. In this case, the <em class="command">make</em> can be contrived to skip missing
        library and program directories if a developer has chosen not to check
        them out. When it comes time to use these libraries, the search path
        will automatically fill in the missing files.</p><p>åœ¨<em class="filename">makefile</em>ä¸­ï¼Œè¯¥
        å˜é‡åˆ—å‡ºäº†è¦æœç´¢<em class="filename">module.mk</em><code class="literal">modules</code>æ–‡ä»¶çš„å­ç›®å½•é›†ã€‚å¦‚æžœæœªç­¾å‡ºå­ç›®å½•ï¼Œåˆ™å¿…é¡»ç¼–è¾‘æ­¤åˆ—è¡¨ä»¥åˆ é™¤å­ç›®å½•ã€‚æˆ–è€…ï¼Œ<em class="filename">æ¨¡å—</em>
        å˜é‡å¯ä»¥é€šè¿‡é€šé…ç¬¦è®¾ç½®ï¼š<em class="filename"></em><em class="filename"></em></p><p>In the <em class="filename">makefile</em>, the
        <code class="literal">modules</code> variable lists the set of
        subdirectories to be searched for <em class="filename">module.mk</em> files. If a subdirectory is not
        checked out, this list must be edited to remove the subdirectory.
        Alternatively, the <em class="filename">modules</em>
        variable can be set by wildcard:</p><a id="OEBPS/ch08s05.html.I_3_tt394"></a><pre class="programlisting">æ¨¡å— := $(dir $(é€šé…ç¬¦ lib/*/module.mk))</pre><pre class="programlisting">modules := $(dir $(wildcard lib/*/module.mk))</pre><p><em class="filename">è¯¥è¡¨è¾¾å¼å°†æŸ¥æ‰¾åŒ…å«module.mk</em>æ–‡ä»¶çš„æ‰€æœ‰å­ç›®å½•
        å¹¶è¿”å›žç›®å½•åˆ—è¡¨ã€‚è¯·æ³¨æ„ï¼Œç”±äºŽè¯¥<code class="function">dir</code>å‡½æ•°çš„å·¥ä½œåŽŸç†ï¼Œæ¯ä¸ªç›®å½•éƒ½å°†åŒ…å«ä¸€ä¸ªå°¾éƒ¨æ–œæ ã€‚</p><p>This expression will find all the subdirectories containing a
        <em class="filename">module.mk</em> file and return the
        directory list. Note that because of how the <code class="function">dir</code> function works, each directory will
        contain a trailing slash.</p><p><em class="command">make</em>è¿˜å¯ä»¥
        åœ¨å•â€‹â€‹ä¸ªæ–‡ä»¶çº§åˆ«ç®¡ç†éƒ¨åˆ†æºä»£ç æ ‘ï¼Œé€šè¿‡ä»Žæœ¬åœ°å¼€å‘äººå‘˜æ ‘ä¸­æ”¶é›†ä¸€äº›ç›®æ ‡æ–‡ä»¶å¹¶ä»Žå¼•ç”¨æ ‘ä¸­æ”¶é›†ä¸¢å¤±çš„æ–‡ä»¶æ¥æž„å»ºåº“ã€‚ç„¶è€Œï¼Œæ ¹æ®æˆ‘çš„ç»éªŒï¼Œè¿™ç›¸å½“æ··ä¹±ï¼Œå¼€å‘äººå‘˜å¯¹æ­¤å¹¶ä¸æ»¡æ„ã€‚</p><p>It is also possible for <em class="command">make</em>
        to manage partial source trees at the individual file level, building
        libraries by gathering some object files from a local developer tree
        and missing files from a reference tree. However, this is quite messy
        and developers are not happy with it, in my experience.</p></div></div></div>
<div id="OEBPS/ch08s06.html"><div>
<div class="sect1" title="å‚è€ƒç‰ˆæœ¬ã€åº“å’Œå®‰è£…ç¨‹åº"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch08s06.html.make3-CHP-8-SECT-6"></a>å‚è€ƒç‰ˆæœ¬ã€åº“å’Œå®‰è£…ç¨‹åº</h1><h1 class="title"><a></a>Reference Builds, Libraries, and Installers</h1></div></div></div><p>æ­¤æ—¶æˆ‘ä»¬å·²ç»å·®ä¸å¤šäº†<a id="OEBPS/ch08s06.html.make3-CHP-8-ITERM-1461" class="indexterm"></a> <a id="OEBPS/ch08s06.html.make3-CHP-8-ITERM-1462" class="indexterm"></a> <a id="OEBPS/ch08s06.html.make3-CHP-8-ITERM-1463" class="indexterm"></a> <a id="OEBPS/ch08s06.html.make3-CHP-8-ITERM-1464" class="indexterm"></a>æ¶µç›–äº†å®žçŽ°å‚è€ƒæž„å»ºæ‰€éœ€çš„ä¸€åˆ‡ã€‚è‡ªå®šä¹‰å•ä¸ªé¡¶çº§<em class="filename">makefile</em>ä»¥æ”¯æŒè¯¥åŠŸèƒ½éžå¸¸ç®€å•ã€‚åªéœ€å°†ç®€å•ä½œä¸šæ›¿æ¢ä¸º<code class="literal">SOURCE_DIR</code>å’Œ<code class="literal">BINARY_DIR</code>å³å¯<code class="literal">?=</code>ã€‚ä»Ž<em class="command">cron</em>è¿è¡Œçš„è„šæœ¬
        å¯ä»¥ä½¿ç”¨ä»¥ä¸‹åŸºæœ¬æ–¹æ³•ï¼š</p><p>At this point we've pretty much <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>covered everything needed to implement reference builds.
        Customizing the single top-level <em class="filename">makefile</em> to support the feature is
        straightforward. Simply replace the simple assignments to <code class="literal">SOURCE_DIR</code> and <code class="literal">BINARY_DIR</code> with <code class="literal">?=</code> assignments. The scripts you run from
        <em class="command">cron</em> can use this basic
        approach:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>é‡å®šå‘è¾“å‡ºå¹¶è®¾ç½®æ—¥å¿—æ–‡ä»¶çš„åç§°</p></li><li class="listitem"><p>Redirect output and set the names of log files</p></li><li class="listitem"><p>æ¸…ç†æ—§ç‰ˆæœ¬å¹¶æ¸…ç†å‚è€ƒæºæ ‘</p></li><li class="listitem"><p>Clean up old builds and clean the reference source
            tree</p></li><li class="listitem"><p>æŸ¥çœ‹æ–°é²œæ¥æº</p></li><li class="listitem"><p>Check out fresh source</p></li><li class="listitem"><p>è®¾ç½®æºå’ŒäºŒè¿›åˆ¶ç›®å½•å˜é‡</p></li><li class="listitem"><p>Set the source and binary directory variables</p></li><li class="listitem"><p>è°ƒç”¨<code class="literal">make</code></p></li><li class="listitem"><p>Invoke <code class="literal">make</code></p></li><li class="listitem"><p>æ‰«ææ—¥å¿—ä»¥æŸ¥æ‰¾é”™è¯¯</p></li><li class="listitem"><p>Scan the logs for errors</p></li><li class="listitem"><p>è®¡ç®—æ ‡ç­¾æ–‡ä»¶ï¼Œå¹¶å¯èƒ½æ›´æ–°å®šä½æ•°æ®åº“<sup>[ <a id="OEBPS/ch08s06.html.make3-CHP-8-FNOTE-2" href="#OEBPS/ch08s06.html.ftn.make3-CHP-8-FNOTE-2" class="footnote">2</a> ]</sup></p></li><li class="listitem"><p>Compute tags files, and possibly update the locate
            database<sup>[<a href="#OEBPS/ch08s06.html.ftn.make3-CHP-8-FNOTE-2" class="footnote">2</a>]</sup></p></li><li class="listitem"><p>å‘å¸ƒæœ‰å…³æž„å»ºæˆåŠŸæˆ–å¤±è´¥çš„ä¿¡æ¯</p></li><li class="listitem"><p>Post information on the success or failure of the
            build</p></li></ol></div><p>åœ¨å‚è€ƒæž„å»ºæ¨¡åž‹ä¸­ï¼Œç»´æŠ¤ä¸€ç»„æ—§æž„å»ºæ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä»¥é˜²æ¶æ„ç­¾å…¥ç ´åæ ‘ã€‚æˆ‘é€šå¸¸ä¿ç•™ 7 æˆ– 14 ä¸ªå¤œé—´æž„å»ºã€‚å½“ç„¶ï¼Œå¤œé—´æž„å»ºè„šæœ¬ä¼šå°†å…¶è¾“å‡ºè®°å½•åˆ°å­˜å‚¨åœ¨æž„å»ºæœ¬èº«é™„è¿‘çš„æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”è„šæœ¬ä¼šæ¸…é™¤æ—§çš„æž„å»ºå’Œæ—¥å¿—ã€‚æ‰«ææ—¥å¿—ä¸­çš„é”™è¯¯é€šå¸¸æ˜¯ä½¿ç”¨<em class="command">awk</em>è„šæœ¬å®Œæˆçš„ã€‚æœ€åŽï¼Œæˆ‘é€šå¸¸è®©è„šæœ¬ç»´æŠ¤<em class="filename">æœ€æ–°çš„</em>ç¬¦å·é“¾æŽ¥ã€‚ä¸ºäº†ç¡®å®šæž„å»ºæ˜¯å¦æœ‰æ•ˆï¼Œæˆ‘åœ¨æ¯ä¸ª<em class="filename">makefile</em><code class="literal">validate</code>ä¸­åŒ…å«ä¸€ä¸ªç›®æ ‡ã€‚è¯¥ç›®æ ‡æ‰§è¡Œç®€å•çš„éªŒè¯æ¥ç¡®å®šç›®æ ‡æ˜¯å¦å·²æž„å»ºã€‚<em class="filename"></em></p><p>It is convenient, in the reference build model, to maintain a
        set of old builds in case a rogue check-in corrupts the tree. I
        usually keep 7 or 14 nightly builds. Of course, the nightly build
        script logs its output to files stored near the builds themselves and
        the script purges old builds and logs. Scanning the logs for errors is
        usually done with an <em class="command">awk</em> script.
        Finally, I usually have the script maintain a <em class="filename">latest</em> symbolic link. To determine if the
        build is valid, I include a <code class="literal">validate</code> target in each <em class="filename">makefile</em>. This target performs simple
        validation that the targets were built.</p><a id="OEBPS/ch08s06.html.I_3_tt395"></a><pre class="programlisting">.PHONYï¼švalidate_build
éªŒè¯æž„å»ºï¼š
        æµ‹è¯• $(foreach f,$(RELEASE_FILES),-s $f -a) -e ã€‚</pre><pre class="programlisting">.PHONY: validate_build
validate_build:
        test $(foreach f,$(RELEASE_FILES),-s $f -a) -e .</pre><p>è¯¥å‘½ä»¤è„šæœ¬åªæ˜¯æµ‹è¯•ä¸€ç»„é¢„æœŸæ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶ä¸”ä¸ä¸ºç©ºã€‚å½“ç„¶ï¼Œè¿™å¹¶ä¸èƒ½å–ä»£æµ‹è¯•ï¼Œè€Œæ˜¯å¯¹æž„å»ºè¿›è¡Œæ–¹ä¾¿çš„å¥å…¨æ€§æ£€æŸ¥ã€‚å¦‚æžœæµ‹è¯•è¿”å›žå¤±è´¥ï¼Œåˆ™<em class="command">make</em>è¿”å›žå¤±è´¥ï¼Œå¹¶ä¸”å¤œé—´æž„å»ºè„šæœ¬å¯ä»¥ä¿ç•™æŒ‡å‘æ—§æž„å»ºçš„<em class="filename">æœ€æ–°ç¬¦å·é“¾æŽ¥ã€‚</em></p><p>This command script simply tests if a set of expected files
        exists and is not empty. Of course, this doesn't take the place of
        testing, but is a convenient sanity check for a build. If the test
        returns failure, the <em class="command">make</em> returns
        failure and the nightly build script can leave the <em class="filename">latest</em> symbolic link pointing to the old
        build.</p><p>ç¬¬ä¸‰æ–¹åº“æ€»æ˜¯æœ‰ç‚¹éº»çƒ¦<a id="OEBPS/ch08s06.html.make3-CHP-8-ITERM-1465" class="indexterm"></a>ç®¡ç†ã€‚æˆ‘åŒæ„ä¸€ä¸ªæ™®éçš„è§‚ç‚¹ï¼Œå³åœ¨ CVS ä¸­å­˜å‚¨å¤§åž‹äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯ä¸å¥½çš„ã€‚è¿™æ˜¯å› ä¸º CVS æ— æ³•å°†å¢žé‡å­˜å‚¨ä¸ºå·®å¼‚ï¼Œå¹¶ä¸”åº•å±‚ RCS æ–‡ä»¶å¯èƒ½ä¼šå¢žé•¿åˆ°å·¨å¤§çš„å¤§å°ã€‚ CVS å­˜å‚¨åº“ä¸­çš„éžå¸¸å¤§çš„æ–‡ä»¶å¯èƒ½ä¼šå‡æ…¢è®¸å¤šå¸¸è§çš„ CVS æ“ä½œï¼Œä»Žè€Œå½±å“æ‰€æœ‰å¼€å‘ã€‚</p><p>Third-party libraries are always a bit of a hassle <a class="indexterm"></a>to manage. I subscribe to the commonly held belief that
        it is bad to store large binary files in CVS. This is because CVS
        cannot store deltas as diffs and the underlying RCS files can grow to
        enormous size. Very large files in the CVS repository can slow down
        many common CVS operations, thus affecting all development.</p><p>å¦‚æžœç¬¬ä¸‰æ–¹åº“æœªå­˜å‚¨åœ¨ CVS ä¸­ï¼Œåˆ™å¿…é¡»ä»¥å…¶ä»–æ–¹å¼ç®¡ç†å®ƒä»¬ã€‚æˆ‘ç›®å‰çš„åå¥½æ˜¯åœ¨å¼•ç”¨æ ‘ä¸­åˆ›å»ºä¸€ä¸ªåº“ç›®å½•ï¼Œå¹¶åœ¨ç›®å½•åç§°ä¸­è®°å½•åº“ç‰ˆæœ¬å·ï¼Œå¦‚å›¾<a class="link" href="#OEBPS/ch08s06.html.make3-CHP-8-FIG-1" title="å›¾ 8-1ã€‚ç¬¬ä¸‰æ–¹åº“çš„ç›®å½•å¸ƒå±€">8-1</a>æ‰€ç¤ºã€‚</p><p>If third-party libraries are not stored in CVS, they must be
        managed some other way. My current preference is to create a library
        directory in the reference tree and record the library version number
        in the directory name, as shown in <a class="link" href="#OEBPS/ch08s06.html.make3-CHP-8-FIG-1" title="Figure&nbsp;8-1.&nbsp;Directory layout for third-party libraries">Figure 8-1</a>.</p><div class="figure"><a id="OEBPS/ch08s06.html.make3-CHP-8-FIG-1"></a><div class="figure-contents"><div class="mediaobject"><a id="OEBPS/ch08s06.html.I_3_tt396"></a><img src="data:image/png;base64,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" height="118" alt="ç¬¬ä¸‰æ–¹åº“çš„ç›®å½•å¸ƒå±€"></div></div><p class="title">å›¾ 8-1ã€‚ç¬¬ä¸‰æ–¹åº“çš„ç›®å½•å¸ƒå±€</p><p class="title">Figure&nbsp;8-1.&nbsp;Directory layout for third-party libraries</p></div><p><em class="filename">è¿™äº›ç›®å½•åç§°ç”±makefile</em>å¼•ç”¨ï¼š</p><p>These directory names are referenced by the <em class="filename">makefile</em>:</p><a id="OEBPS/ch08s06.html.I_3_tt397"></a><pre class="programlisting">ORACLE_9011_DIR ?= /reftree/third_party/oracle-9.0.1.1/Ora90
ORACLE_9011_JAR ?= $(ORACLE_9011_DIR)/jdbc/lib/classes12.jar</pre><pre class="programlisting">ORACLE_9011_DIR ?= /reftree/third_party/oracle-9.0.1.1/Ora90
ORACLE_9011_JAR ?= $(ORACLE_9011_DIR)/jdbc/lib/classes12.jar</pre><p>å½“ä¾›åº”å•†æ›´æ–°å…¶åº“æ—¶ï¼Œåœ¨å¼•ç”¨æ ‘ä¸­åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•å¹¶åœ¨<em class="filename">makefile</em>ä¸­å£°æ˜Žæ–°å˜é‡ã€‚è¿™æ ·<em class="filename">makefile</em>å§‹ç»ˆæ˜Žç¡®åæ˜ æ­£åœ¨ä½¿ç”¨çš„ç‰ˆæœ¬ã€‚</p><p>When the vendor updates its libraries, create a new directory in
        the reference tree and declare new variables in the <em class="filename">makefile</em>. This way the <em class="filename">makefile</em>, which is properly maintained with
        tags and branches, always explicitly reflects the versions being
        used.</p><p>å®‰è£…äººå‘˜ä¹Ÿæ˜¯ä¸€ä¸ªéš¾é¢˜ã€‚æˆ‘ç›¸ä¿¡å°†åŸºæœ¬æž„å»ºè¿‡ç¨‹ä¸Žåˆ›å»ºå®‰è£…ç¨‹åºæ˜ åƒåˆ†å¼€æ˜¯ä¸€ä»¶å¥½äº‹ã€‚å½“å‰çš„å®‰è£…å·¥å…·æ—¢å¤æ‚åˆè„†å¼±ã€‚å°†å®ƒä»¬æŠ˜å åˆ°ï¼ˆé€šå¸¸ä¹Ÿæ˜¯å¤æ‚ä¸”è„†å¼±çš„ï¼‰æž„å»ºç³»ç»Ÿä¸­ä¼šäº§ç”Ÿéš¾ä»¥ç»´æŠ¤çš„ç³»ç»Ÿã€‚ç›¸åï¼ŒåŸºæœ¬æž„å»ºå¯ä»¥å°†å…¶ç»“æžœå†™å…¥â€œå‘å¸ƒâ€ç›®å½•ï¼Œå…¶ä¸­åŒ…å«å®‰è£…ç¨‹åºæž„å»ºå·¥å…·æ‰€éœ€çš„æ‰€æœ‰ï¼ˆæˆ–å¤§éƒ¨åˆ†ï¼‰æ•°æ®ã€‚è¯¥å·¥å…·å¯ä»¥ç”±å…¶è‡ªå·±çš„<em class="filename">makefile</em>é©±åŠ¨ï¼Œæœ€ç»ˆç”Ÿæˆå¯æ‰§è¡Œçš„å®‰è£…æ˜ åƒã€‚</p><p>Installers are also a difficult issue. I believe that separating
        the basic build process from creating the installer image is a good
        thing. Current installer tools are complex and fragile. Folding them
        into the (also often complex and fragile) build system yields
        difficult-to-maintain systems. Instead, the basic build can write its
        results into a "release" directory that contains all (or most of) the
        data required by the installer build tool. This tool may be driven
        from its own <em class="filename">makefile</em> that
        ultimately yields an executable setup image.</p><div class="footnotes"><br><br><hr><div class="footnote"><p><sup>[ <a id="OEBPS/ch08s06.html.ftn.make3-CHP-8-FNOTE-2" href="#OEBPS/ch08s06.html.make3-CHP-8-FNOTE-2" class="para">2</a> ]</sup>å®šä½æ•°æ®åº“æ˜¯æ–‡ä»¶ç³»ç»Ÿä¸Šå­˜åœ¨çš„æ‰€æœ‰æ–‡ä»¶åçš„ç¼–è¯‘ã€‚è¿™æ˜¯ä¸€ç§æŒ‰åç§°æ‰§è¡Œ<em class="command">æŸ¥æ‰¾</em>çš„å¿«é€Ÿæ–¹æ³•ã€‚æˆ‘å‘çŽ°è¿™ä¸ªæ•°æ®åº“å¯¹äºŽç®¡ç†å¤§åž‹æºä»£ç æ ‘éžå¸¸æœ‰ä»·å€¼ï¼Œå¹¶ä¸”å–œæ¬¢åœ¨æž„å»ºå®ŒæˆåŽæ¯æ™šæ›´æ–°å®ƒã€‚</p><p><sup>[<a href="#OEBPS/ch08s06.html.make3-CHP-8-FNOTE-2" class="para">2</a>] </sup>The locate database is a compilation of all the
                filenames present on a filesystem. It is a fast way of
                performing a <em class="command">find</em> by name.
                I have found this database invaluable for managing large
                source trees and like to have it updated nightly after the
                build has completed.</p></div></div></div></div></div>
<div id="OEBPS/ch09.html"><div>
<div class="chapter" title="ç¬¬ 9 ç«  Java"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch09.html.make3-CHP-9"></a>ç¬¬ 9 ç«  Java</h1><h1 class="title"><a></a>Chapter&nbsp;9.&nbsp;Java</h1></div></div></div><p>è®¸å¤š Java å¼€å‘äººå‘˜å–œæ¬¢<a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1466" class="indexterm"></a> <a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1467" class="indexterm"></a>é›†æˆå¼€å‘çŽ¯å¢ƒ (IDE)ï¼Œä¾‹å¦‚ Eclipseã€‚é‰´äºŽ Java IDE å’Œ<em class="command">Ant</em>ç­‰ä¼—æ‰€å‘¨çŸ¥çš„æ›¿ä»£æ–¹æ¡ˆï¼Œè¯»è€…å¾ˆå¯èƒ½ä¼šé—®ä¸ºä»€ä¹ˆä»–ä»¬åº”è¯¥è€ƒè™‘åœ¨ Java é¡¹ç›®ä¸Šä½¿ç”¨<em class="command">make ã€‚æœ¬ç« æŽ¢è®¨äº†</em><em class="command">make</em>åœ¨è¿™äº›æƒ…å†µä¸‹çš„ä»·å€¼ï¼›ç‰¹åˆ«æ˜¯ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªé€šç”¨çš„<em class="filename">makefile</em> 
      ï¼Œåªéœ€æœ€å°‘çš„ä¿®æ”¹å³å¯å°†å…¶æ”¾å…¥å‡ ä¹Žä»»ä½• Java é¡¹ç›®ä¸­ï¼Œå¹¶æ‰§è¡Œæ‰€æœ‰æ ‡å‡†çš„é‡å»ºä»»åŠ¡ã€‚</p><p>Many Java developers like <a class="indexterm"></a> <a class="indexterm"></a>Integrated Development Environments (IDEs) such as
      Eclipse. Given such well-known alternatives as Java IDEs and <em class="command">Ant</em>, readers could well ask why they should
      even think of using <em class="command">make</em> on Java
      projects. This chapter explores the value of <em class="command">make</em> in these situations; in particular, it
      presents a generalized <em class="filename">makefile</em>
      that can be dropped into just about any Java project with minimal
      modification and carry out all the standard rebuilding tasks.</p><p>åœ¨ Java ä¸­ä½¿ç”¨<em class="command">makeä¼šå¼•å‘ä¸€äº›é—®é¢˜</em><a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1468" class="indexterm"></a>é—®é¢˜å¹¶ä»‹ç»äº†ä¸€äº›æœºä¼šã€‚è¿™ä¸»è¦æ˜¯ç”±äºŽä¸‰ä¸ªå› ç´ ï¼šJava ç¼–è¯‘å™¨<em class="command">javac</em>éžå¸¸å¿«ï¼›æ ‡å‡†Javaç¼–è¯‘å™¨æ”¯æŒ<code class="literal">@filename</code>
      ä»Žæ–‡ä»¶è¯»å–â€œå‘½ä»¤è¡Œå‚æ•°â€çš„è¯­æ³•ï¼›å¦‚æžœæŒ‡å®šäº† Java åŒ…ï¼Œåˆ™ Java è¯­è¨€ä¼šæŒ‡å®š<em class="filename">.class</em>æ–‡ä»¶çš„è·¯å¾„
      ã€‚</p><p>Using <em class="command">make</em> with Java raises
      several <a class="indexterm"></a>issues and introduces some opportunities. This is
      primarily due to three factors: the Java compiler, <em class="command">javac</em>, is extremely fast; the standard Java
      compiler supports the <code class="literal">@filename</code>
      syntax for reading "command-line parameters" from a file; and if a Java
      package is specified, the Java language specifies a path to the
      <em class="filename">.class</em> file.</p><p>æ ‡å‡† Java ç¼–è¯‘å™¨éžå¸¸å¿«ã€‚è¿™ä¸»è¦æ˜¯ç”±äºŽè¯¥æŒ‡ä»¤çš„å·¥ä½œæ–¹å¼é€ æˆçš„<code class="function">import</code>ã€‚ä¸Ž C ä¸­çš„ a ç±»ä¼¼<code class="function">#include</code>ï¼Œè¯¥ä¼ªæŒ‡ä»¤ç”¨äºŽå…è®¸è®¿é—®å¤–éƒ¨å®šä¹‰çš„ç¬¦å·ã€‚ç„¶è€Œï¼ŒJava ä¸æ˜¯é‡æ–°è¯»å–æºä»£ç ï¼ˆç„¶åŽéœ€è¦é‡æ–°è§£æžå’Œåˆ†æžï¼‰ï¼Œè€Œæ˜¯ç›´æŽ¥è¯»å–ç±»æ–‡ä»¶ã€‚ç”±äºŽç±»æ–‡ä»¶ä¸­çš„ç¬¦å·åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä¸èƒ½æ›´æ”¹ï¼Œå› æ­¤ç±»æ–‡ä»¶ç”±ç¼–è¯‘å™¨ç¼“å­˜ã€‚å³ä½¿åœ¨ä¸­åž‹é¡¹ç›®ä¸­ï¼Œè¿™ä¹Ÿæ„å‘³ç€ä¸Ž C ç›¸æ¯”ï¼ŒJava ç¼–è¯‘å™¨å¯ä»¥é¿å…é‡æ–°è¯»å–ã€è§£æžå’Œåˆ†æžæ•°ç™¾ä¸‡è¡Œä»£ç ã€‚æ€§èƒ½çš„æå‡å¹…åº¦è¾ƒå°ï¼Œè¿™æ˜¯ç”±äºŽå¤§å¤šæ•° Java ç¼–è¯‘å™¨æ‰§è¡Œäº†æœ€ä½Žé™åº¦çš„ä¼˜åŒ–ã€‚ç›¸åï¼ŒJava ä¾èµ–äºŽå¤æ‚çš„å³æ—¶ (JIT)<a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1469" class="indexterm"></a> <a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1470" class="indexterm"></a>ç”± Java è™šæ‹Ÿæœº (JVM) æœ¬èº«æ‰§è¡Œçš„ä¼˜åŒ–ã€‚</p><p>Standard Java compilers are very fast. This is primarily due to
      the way the <code class="function">import</code> directive works.
      Similar to a <code class="function">#include</code> in C, this
      directive is used to allow access to externally defined symbols.
      However, rather than rereading source code, which then needs to be
      reparsed and analyzed, Java reads the class files directly. Because the
      symbols in a class file cannot change during the compilation process,
      the class files are cached by the compiler. In even medium-sized
      projects, this means the Java compiler can avoid rereading, parsing, and
      analyzing literally millions of lines of code compared with C. A more
      modest performance improvement is due to the bare minimum of
      optimization performed by most Java compilers. Instead, Java relies on
      sophisticated just-in-time (JIT) <a class="indexterm"></a> <a class="indexterm"></a>optimizations performed by the Java virtual machine (JVM)
      itself.</p><p>å¤§å¤šæ•°å¤§åž‹ Java é¡¹ç›®éƒ½ä½¿<a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1471" class="indexterm"></a> <a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1472" class="indexterm"></a>å¹¿æ³›ä½¿ç”¨Javaçš„<em class="firstterm">åŒ…</em>
      ç‰¹æ€§ã€‚ä¸€ä¸ªç±»è¢«å£°æ˜Žä¸ºå°è£…åœ¨<code class="literal">package</code>å½¢æˆä¸€ä¸ª<a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1473" class="indexterm"></a>èŒƒå›´å›´ç»•æ–‡ä»¶å®šä¹‰çš„ç¬¦å·ã€‚åŒ…åç§°æ˜¯åˆ†å±‚çš„å¹¶éšå¼å®šä¹‰æ–‡ä»¶ç»“æž„ã€‚ä¾‹å¦‚ï¼Œè¯¥åŒ…<code class="literal">a.b.c</code>å°†éšå¼å®šä¹‰ç›®å½•ç»“æž„<em class="filename">a/b/c</em>ã€‚å£°æ˜Žåœ¨
      <code class="literal">a.b.c</code>åŒ…å†…çš„ä»£ç å°†è¢«ç¼–è¯‘ä¸º<em class="filename">a/b/c</em>ç›®å½•ä¸­çš„ç±»æ–‡ä»¶ã€‚è¿™æ„å‘³ç€<em class="command">make</em>å°†äºŒè¿›åˆ¶æ–‡ä»¶ä¸Žå…¶æºå…³è”çš„æ­£å¸¸ç®—æ³•å¤±è´¥ã€‚ä½†è¿™ä¹Ÿæ„å‘³ç€æ— éœ€æŒ‡å®š<code class="option">-o</code>é€‰é¡¹æ¥æŒ‡ç¤ºè¾“å‡ºæ–‡ä»¶åº”æ”¾ç½®çš„ä½ç½®ã€‚æŒ‡ç¤ºè¾“å‡ºæ ‘çš„æ ¹ï¼ˆå¯¹äºŽæ‰€æœ‰æ–‡ä»¶éƒ½ç›¸åŒï¼‰å°±è¶³å¤Ÿäº†ã€‚åè¿‡æ¥ï¼Œè¿™æ„å‘³ç€å¯ä»¥ä½¿ç”¨ç›¸åŒçš„å‘½ä»¤è¡Œè°ƒç”¨æ¥ç¼–è¯‘æ¥è‡ªä¸åŒç›®å½•çš„æºæ–‡ä»¶ã€‚</p><p>Most large Java projects make <a class="indexterm"></a> <a class="indexterm"></a>extensive use of Java's <em class="firstterm">package</em>
      feature. A class is declared to be encapsulated in a <code class="literal">package</code> that forms a <a class="indexterm"></a>scope around the symbols defined by the file. Package
      names are hierarchical and implicitly define a file structure. For
      instance, the package <code class="literal">a.b.c</code> would
      implicitly define a directory structure <em class="filename">a/b/c</em>. Code declared to be within the
      <code class="literal">a.b.c</code> package would be compiled to
      class files in the <em class="filename">a/b/c</em> directory.
      This means that <em class="command">make</em>'s normal
      algorithm for associating a binary file with its source fails. But it
      also means that there is no need to specify a <code class="option">-o</code> option
      to indicate where output files should be placed. Indicating the root of
      the output tree, which is the same for all files, is sufficient. This,
      in turn, means that source files from different directories can be
      compiled with the same command-line invocation.</p><p>æ ‡å‡†Javaç¼–è¯‘å™¨éƒ½æ”¯æŒ<code class="literal">@filename</code>å…è®¸ä»Žæ–‡ä»¶è¯»å–å‘½ä»¤è¡Œå‚æ•°çš„è¯­æ³•ã€‚è¿™ä¸ŽåŒ…åŠŸèƒ½ç»“åˆèµ·æ¥éžå¸¸é‡è¦ï¼Œå› ä¸ºè¿™æ„å‘³ç€å¯ä»¥é€šè¿‡ä¸€æ¬¡ Java ç¼–è¯‘å™¨çš„æ‰§è¡Œæ¥ç¼–è¯‘é¡¹ç›®çš„æ•´ä¸ª Java æºä»£ç ã€‚è¿™æ˜¯ä¸€ä¸ªé‡å¤§çš„æ€§èƒ½æ”¹è¿›ï¼Œå› ä¸ºåŠ è½½å’Œæ‰§è¡Œç¼–è¯‘å™¨æ‰€éœ€çš„æ—¶é—´æ˜¯æž„å»ºæ—¶é—´çš„ä¸»è¦è´¡çŒ®è€…ã€‚</p><p>The standard Java compilers all support the <code class="literal">@filename</code> syntax that allows command-line
      parameters to be read from a file. This is significant in conjunction
      with the package feature because it means that the entire Java source
      for a project can be compiled with a single execution of the Java
      compiler. This is a major performance improvement because the time it
      takes to load and execute the compiler is a major contributor to build
      times.</p><p>æ€»ä¹‹ï¼Œé€šè¿‡ç¼–å†™æ­£ç¡®çš„å‘½ä»¤è¡Œï¼Œåœ¨ 2.5 GHz Pentium 4 å¤„ç†å™¨ä¸Šç¼–è¯‘ 400,000 è¡Œ Java å¤§çº¦éœ€è¦ä¸‰åˆ†é’Ÿã€‚ç¼–è¯‘ä¸€ä¸ªç­‰æ•ˆçš„ C++ åº”ç”¨ç¨‹åºéœ€è¦å‡ ä¸ªå°æ—¶ã€‚</p><p>In summary, by composing the proper command line, compiling
      400,000 lines of Java takes about three minutes on a 2.5-GHz Pentium 4
      processor. Compiling an equivalent C++ application would require
      hours.</p><div class="sect1" title="æ›¿ä»£æ–¹æ¡ˆ"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch09.html.make3-CHP-9-SECT-1"></a>æ›¿ä»£æ–¹æ¡ˆ</h1><h1 class="title"><a></a>Alternatives to make</h1></div></div></div><p>å¦‚å‰æ‰€è¿°ï¼ŒJava å¼€å‘äººå‘˜ç¤¾åŒºçƒ­æƒ…åœ°é‡‡ç”¨æ–°æŠ€æœ¯ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å…¶ä¸­çš„ä¸¤ä¸ªï¼ˆ
         <em class="command">Antå’Œ IDEï¼‰å¦‚ä½•ä¸Ž</em><em class="command">make</em>ç›¸å…³ã€‚</p><p>As previously mentioned, the Java developer community
        enthusiastically adopts new technologies. Let's see how two of these,
        <em class="command">Ant</em> and IDEs, relate to <em class="command">make</em>.</p><div class="sect2" title="èš‚èš"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch09.html.make3-CHP-9-SECT-1.1"></a>èš‚èš</h2><h2 class="title"><a></a>Ant</h2></div></div></div><p>Java ç¤¾åŒºæ˜¯<a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1474" class="indexterm"></a> <a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1475" class="indexterm"></a>éžå¸¸æ´»è·ƒï¼Œä»¥ä»¤äººå°â€‹â€‹è±¡æ·±åˆ»çš„é€Ÿåº¦ç”Ÿäº§æ–°å·¥å…·å’Œ APIã€‚<em class="command">Ant</em>å°±æ˜¯è¿™äº›æ–°å·¥å…·ä¹‹ä¸€ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ—¨åœ¨å–ä»£
          Java å¼€å‘è¿‡ç¨‹ä¸­<em class="command">make çš„æž„å»ºå·¥å…·ã€‚ä¸Ž</em><em class="command">make</em>ä¸€æ ·ï¼Œ<em class="command">Ant</em>ä½¿ç”¨æè¿°æ–‡ä»¶æ¥æŒ‡ç¤ºé¡¹ç›®çš„ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶ã€‚ä¸Ž<em class="command">make</em>ä¸åŒï¼Œ<em class="command">Ant</em>æ˜¯ç”¨ Java å’Œ<em class="command">Antç¼–å†™çš„</em>æž„å»ºæ–‡ä»¶æ˜¯ç”¨ XML ç¼–å†™çš„ã€‚</p><p>The Java community is <a class="indexterm"></a> <a class="indexterm"></a>very active, producing new tools and APIs at an
          impressive rate. One of these new tools is <em class="command">Ant</em>, a build tool intended to replace
          <em class="command">make</em> in the Java development
          process. Like <em class="command">make</em>, <em class="command">Ant</em> uses a description file to indicate
          the targets and prerequisites of a project. Unlike <em class="command">make</em>, <em class="command">Ant</em> is written in Java and <em class="command">Ant</em> build files are written in XML.</p><p>è®©æ‚¨æ„Ÿå— XML æž„å»º<a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1476" class="indexterm"></a> <a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1477" class="indexterm"></a> <a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1478" class="indexterm"></a> <a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1479" class="indexterm"></a><em class="command">æ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯Ant</em>æž„å»ºæ–‡ä»¶çš„æ‘˜å½•ï¼š</p><p>To give you a feel for the XML build <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>file, here is an excerpt from the <em class="command">Ant</em> build file:</p><a id="OEBPS/ch09.html.I_4_tt398"></a><pre class="programlisting">&lt;ç›®æ ‡åç§°=â€œæž„å»ºâ€
        å–å†³äºŽ=â€œå‡†å¤‡ï¼Œæ£€æŸ¥å¯é€‰åŒ…â€
        description="--&gt; ç¼–è¯‘æºä»£ç "&gt;
  &lt;mkdir dir="${build.dir}"/&gt;
  &lt;mkdir dir="${build.classes}"/&gt;
  &lt;mkdir dir="${build.lib}"/&gt;

  &lt;javac srcdir="${java.dir}"
         destdir="${build.classes}"
         è°ƒè¯•=â€œ$ {è°ƒè¯•}â€
         å¼ƒç”¨=â€œ${å¼ƒç”¨}â€
         ç›®æ ‡=â€œ$ {javac.target}â€
         ä¼˜åŒ–=â€œ${ä¼˜åŒ–}â€&gt;
    &lt;classpath refid="classpath"/&gt;
  &lt;/javac&gt;

  ...

  &lt;copy todir="${build.classes}"&gt;
    &lt;æ–‡ä»¶é›†ç›®å½•=â€œ$ {java.dir}â€&gt;
      &lt;include name="**/*.properties"/&gt;
      &lt;include name="**/*.dtd"/&gt;
    &lt;/æ–‡ä»¶é›†&gt;
  &lt;/å¤åˆ¶&gt;
 &lt;/ç›®æ ‡&gt;</pre><pre class="programlisting">&lt;target name="build"
        depends="prepare, check_for_optional_packages"
        description="--&gt; compiles the source code"&gt;
  &lt;mkdir dir="${build.dir}"/&gt;
  &lt;mkdir dir="${build.classes}"/&gt;
  &lt;mkdir dir="${build.lib}"/&gt;

  &lt;javac srcdir="${java.dir}"
         destdir="${build.classes}"
         debug="${debug}"
         deprecation="${deprecation}"
         target="${javac.target}"
         optimize="${optimize}" &gt;
    &lt;classpath refid="classpath"/&gt;
  &lt;/javac&gt;

  ...

  &lt;copy todir="${build.classes}"&gt;
    &lt;fileset dir="${java.dir}"&gt;
      &lt;include name="**/*.properties"/&gt;
      &lt;include name="**/*.dtd"/&gt;
    &lt;/fileset&gt;
  &lt;/copy&gt;
 &lt;/target&gt;</pre><p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œç›®æ ‡æ˜¯é€šè¿‡ XML<code class="literal">&lt;target&gt;</code>æ ‡ç­¾å¼•å…¥çš„ã€‚æ¯ä¸ªç›®æ ‡éƒ½æœ‰ä¸€ä¸ªåˆ†åˆ«ç”¨<code class="literal">&lt;name&gt;</code>å’Œå±žæ€§æŒ‡å®šçš„åç§°å’Œä¾èµ–é¡¹åˆ—è¡¨<code class="literal">&lt;depends&gt;</code>ã€‚è¡ŒåŠ¨æ˜¯<a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1480" class="indexterm"></a> <a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1481" class="indexterm"></a> <a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1482" class="indexterm"></a>ç”±<em class="command">Antæ‰§è¡Œçš„</em>
          <em class="firstterm">ä»»åŠ¡</em>ã€‚ä»»åŠ¡ç”¨ Java ç¼–å†™å¹¶ç»‘å®šåˆ° XML æ ‡è®°ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡æ ‡ç­¾æŒ‡å®šåˆ›å»ºç›®å½•çš„ä»»åŠ¡<code class="literal">&lt;mkdir&gt;</code>
          ï¼Œå¹¶è§¦å‘Javaæ–¹æ³•çš„æ‰§è¡Œ<code class="function">Mkdir.execute</code>ï¼Œæœ€ç»ˆè°ƒç”¨
          <code class="function">File.mkdir</code>.æ‰€æœ‰ä»»åŠ¡éƒ½å°½å¯èƒ½ä½¿ç”¨Java API æ¥å®žçŽ°ã€‚</p><p>As you can see, a target is introduced with an XML <code class="literal">&lt;target&gt;</code> tag. Each target has a name
          and dependency list specified with <code class="literal">&lt;name&gt;</code> and <code class="literal">&lt;depends&gt;</code> attributes, respectively.
          Actions are <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>performed by <em class="command">Ant</em>
          <em class="firstterm">tasks</em>. A task is written in Java and bound to
          an XML tag. For instance, the task of creating a directory is
          specified with the <code class="literal">&lt;mkdir&gt;</code>
          tag and triggers the execution of the Java method <code class="function">Mkdir.execute</code>, which eventually calls
          <code class="function">File.mkdir</code>. As far as possible,
          all tasks are implemented using the Java API.</p><p><em class="command">ä½¿ç”¨make</em>è¯­æ³•çš„ç­‰æ•ˆæž„å»ºæ–‡ä»¶å°†æ˜¯ï¼š</p><p>An equivalent build file using <em class="command">make</em> syntax would be:</p><a id="OEBPS/ch09.html.I_4_tt399"></a><pre class="programlisting"># ç¼–è¯‘æºä»£ç 
æž„å»ºï¼š$(all_javas) å‡†å¤‡ check_for_Optional_packages
        $(MKDIR) -p $(build.dir) $(build.classes) $(build.lib)
        $(JAVAC) -sourcepath $(java.dir) \
                 -d $(build.classes) \
                 $ï¼ˆè°ƒè¯•ï¼‰\
                 $ï¼ˆå¼ƒç”¨ï¼‰\
                 -ç›®æ ‡ $(javac.target) \
                 $ï¼ˆä¼˜åŒ–ï¼‰\
                 -ç±»è·¯å¾„$(ç±»è·¯å¾„)\
                 @$&lt;
        ...
        $ï¼ˆæŸ¥æ‰¾ï¼‰ã€‚ \(-name '*.properties' -o -name '*.dtd' \) | \
        $(TAR) -c -f - -T - | $(TAR) $(TAR) -C $(build.classes) -x -f -</pre><pre class="programlisting"># compiles the source code
build: $(all_javas) prepare check_for_optional_packages
        $(MKDIR) -p $(build.dir) $(build.classes) $(build.lib)
        $(JAVAC) -sourcepath $(java.dir)                        \
                 -d $(build.classes)                            \
                 $(debug)                                       \
                 $(deprecation)                                 \
                 -target $(javac.target)                        \
                 $(optimize)                                    \
                 -classpath $(classpath)                        \
                 @$&lt;
        ...
        $(FIND) . \( -name '*.properties' -o -name '*.dtd' \) | \
        $(TAR) -c -f - -T - | $(TAR) -C $(build.classes) -x -f -</pre><p><em class="command">è¿™æ®µmake</em>ä»£ç ä½¿ç”¨äº†æœ¬ä¹¦å°šæœªè®¨è®ºçš„æŠ€æœ¯ã€‚å¯ä»¥è¯´ï¼Œå…ˆå†³æ¡ä»¶<em class="filename">all.javas ï¼ˆå³å˜é‡</em><em class="filename">all_javas</em>çš„å€¼ï¼‰åŒ…å«<code class="literal">java</code>è¦ç¼–è¯‘çš„æ‰€æœ‰æ–‡ä»¶çš„åˆ—è¡¨ã€‚ <em class="command">Ant</em>ä»»åŠ¡ã€<code class="literal">&lt;mkdir&gt;</code>ã€<code class="literal">&lt;javac&gt;</code>è¿˜<code class="literal">&lt;copy&gt;</code>æ‰§è¡Œä¾èµ–æ€§æ£€æŸ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœç›®å½•å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸ä¼šæ‰§è¡Œ<em class="command">mkdir</em> ã€‚åŒæ ·ï¼Œå¦‚æžœ Java ç±»æ–‡ä»¶æ¯”æºæ–‡ä»¶æ–°ï¼Œåˆ™ä¸ä¼šç¼–è¯‘æºæ–‡ä»¶ã€‚å°½ç®¡å¦‚æ­¤ï¼Œ<em class="command">make</em>å‘½ä»¤è„šæœ¬æ‰§è¡Œçš„åŠŸèƒ½æœ¬è´¨ä¸Šæ˜¯ç›¸åŒçš„ã€‚<em class="command">Ant</em>åŒ…å«ä¸€ä¸ªåä¸º çš„é€šç”¨ä»»åŠ¡<code class="literal">&lt;exec&gt;</code>æ¥è¿è¡Œæœ¬åœ°ç¨‹åºã€‚</p><p>This snippet of <em class="command">make</em> uses
          techniques that this book hasn't discussed yet. Suffice to say that
          the prerequisite <em class="filename">all.javas</em> ,
          which is the value of the variable <em class="filename">all_javas</em>,
          contains a list of all <code class="literal">java</code> files to be compiled.
          The <em class="command">Ant</em> tasks <code class="literal">&lt;mkdir&gt;</code>, <code class="literal">&lt;javac&gt;</code>, and <code class="literal">&lt;copy&gt;</code> also perform dependency
          checking. That is, if the directory already exists, <em class="command">mkdir</em> is not executed. Likewise, if the
          Java class files are newer than the source files, the source files
          are not compiled. Nevertheless, the <em class="command">make</em> command script performs essentially
          the same functions. <em class="command">Ant</em> includes
          a generic task, called <code class="literal">&lt;exec&gt;</code>, to run a local
          program.</p><p><em class="command">Ant</em>æ˜¯ä¸€ç§èªæ˜Žè€Œæ–°é¢–çš„æž„å»ºå·¥å…·æ–¹æ³•ï¼›ç„¶è€Œï¼Œå®ƒæå‡ºäº†ä¸€äº›å€¼å¾—è€ƒè™‘çš„é—®é¢˜ï¼š</p><p><em class="command">Ant</em> is a clever and fresh
          approach to build tools; however, it presents some issues worth
          considering:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>å°½ç®¡<em class="command">Ant</em>åœ¨ Java ç¤¾åŒºä¸­å¾—åˆ°äº†å¹¿æ³›æŽ¥å—ï¼Œä½†åœ¨å…¶ä»–åœ°æ–¹å®ƒä»ç„¶ç›¸å¯¹ä¸ä¸ºäººçŸ¥ã€‚æ­¤å¤–ï¼Œå®ƒçš„å—æ¬¢è¿Žç¨‹åº¦æ˜¯å¦ä¼šè¿œè¿œè¶…å‡º Java èŒƒå›´ä¼¼ä¹Žå€¼å¾—æ€€ç–‘ï¼ˆå‡ºäºŽæ­¤å¤„åˆ—å‡ºçš„åŽŸå› ï¼‰ã€‚
              å¦ä¸€æ–¹é¢ï¼Œ<em class="command">make</em>ä¸€ç›´è¢«åº”ç”¨äºŽå¹¿æ³›çš„é¢†åŸŸï¼ŒåŒ…æ‹¬è½¯ä»¶å¼€å‘ã€æ–‡æ¡£å¤„ç†å’ŒæŽ’ç‰ˆã€ç½‘ç«™å’Œå·¥ä½œç«™ç»´æŠ¤ç­‰ã€‚å¯¹äºŽéœ€è¦åœ¨å„ç§è½¯ä»¶ç³»ç»Ÿä¸Šå·¥ä½œçš„ä»»ä½•äººæ¥è¯´ï¼Œç†è§£<em class="command">makeéƒ½å¾ˆé‡è¦ã€‚</em></p></li><li class="listitem"><p>Although <em class="command">Ant</em> has found
              wide acceptance in the Java community, it is still relatively
              unknown elsewhere. Also, it seems doubtful that its popularity
              will spread much beyond Java (for the reasons listed here).
              <em class="command">make</em>, on the other hand, has
              consistently been applied to a broad range of fields including
              software development, document processing and typesetting, and
              web site and workstation maintenance, to name a few.
              Understanding <em class="command">make</em> is
              important for anyone who needs to work on a variety of software
              systems.</p></li><li class="listitem"><p>é€‰æ‹© XML ä½œä¸ºæè¿°è¯­è¨€é€‚åˆåŸºäºŽ Java çš„å·¥å…·ã€‚ä½† XML çš„ä¹¦å†™æˆ–é˜…è¯»å¹¶ä¸æ˜¯ç‰¹åˆ«ä»¤äººæ„‰å¿«ï¼ˆå¯¹äºŽè®¸å¤šäººæ¥è¯´ï¼‰ã€‚å¥½çš„ XML ç¼–è¾‘å™¨å¯èƒ½å¾ˆéš¾æ‰¾åˆ°ï¼Œè€Œä¸”é€šå¸¸ä¸èƒ½ä¸ŽçŽ°æœ‰å·¥å…·å¾ˆå¥½åœ°é›†æˆï¼ˆè¦ä¹ˆæˆ‘çš„é›†æˆå¼€å‘çŽ¯å¢ƒåŒ…å«ä¸€ä¸ªå¥½çš„ XML ç¼–è¾‘å™¨ï¼Œè¦ä¹ˆæˆ‘å¿…é¡»ç¦»å¼€ IDE å¹¶å¯»æ‰¾ä¸€ä¸ªå•ç‹¬çš„å·¥å…·ï¼‰ã€‚æ­£å¦‚æ‚¨ä»Žå‰é¢çš„ç¤ºä¾‹ä¸­çœ‹åˆ°çš„ï¼Œ
              ä¸Ž<em class="command">make</em>å’Œ shell è¯­æ³•ç›¸æ¯”ï¼ŒXML å’Œ<em class="command">Ant</em>æ–¹è¨€å°¤å…¶å†—é•¿ã€‚ XML å……æ»¡äº†å®ƒè‡ªå·±çš„ç‰¹æ€§ã€‚<em class="command"></em></p></li><li class="listitem"><p>The choice of XML as the description language is
              appropriate for a Java-based tool. But XML is not particularly
              pleasant to write or to read (for many). Good XML editors can be
              difficult to find and often do not integrate well with existing
              tools (either my integrated development environment includes a
              good XML editor or I must leave my IDE and find a separate
              tool). As you can see from the previous example, XML and the
              <em class="command">Ant</em> dialect, in particular,
              are verbose compared with <em class="command">make</em> and shell syntax. And the XML is
              filled with its own idiosyncrasies.</p></li><li class="listitem"><p>å½“ç¼–å†™<em class="command">Ant</em>æž„å»ºæ–‡ä»¶æ—¶ï¼Œæ‚¨<a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1483" class="indexterm"></a> <a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1484" class="indexterm"></a> <a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1485" class="indexterm"></a>å¿…é¡»ä¸Žå¦ä¸€å±‚é—´æŽ¥ç«žäº‰ã€‚<em class="command">Ant</em> ä»»åŠ¡<code class="literal">&lt;mkdir&gt;</code>ä¸ä¼šè°ƒç”¨ç³»ç»Ÿçš„åº•å±‚<em class="command">mkdir</em><code class="function">mkdir( )</code>ç¨‹åºã€‚ç›¸åï¼Œå®ƒæ‰§è¡Œç±»çš„Javaæ–¹æ³•<code class="function">java.io.File</code>ã€‚è¿™å¯èƒ½ä¼šæˆ–å¯èƒ½ä¸ä¼šè¾¾åˆ°æ‚¨çš„é¢„æœŸã€‚æœ¬è´¨ä¸Šï¼Œç¨‹åºå‘˜å‘<em class="command">Ant</em>æä¾›çš„æœ‰å…³å¸¸ç”¨å·¥å…·è¡Œä¸ºçš„ä»»ä½•çŸ¥è¯†éƒ½æ˜¯å¯ç–‘çš„ï¼Œå¿…é¡»æ ¹æ®<em class="command">Ant</em>æ–‡æ¡£ã€Java æ–‡æ¡£æˆ–<em class="command">Ant</em>
              æºä»£ç è¿›è¡Œæ£€æŸ¥ã€‚æ­¤å¤–ï¼Œä¾‹å¦‚ï¼Œä¸ºäº†è°ƒç”¨ Java ç¼–è¯‘å™¨ï¼Œæˆ‘å¯èƒ½è¢«è¿«æµè§ˆåå‡ ä¸ªæˆ–æ›´å¤šä¸ç†Ÿæ‚‰çš„ XML å±žæ€§ï¼Œä¾‹å¦‚<code class="literal">&lt;srcdir&gt;</code>ã€<code class="literal">&lt;debug&gt;</code>ç­‰ï¼Œè¿™äº›å±žæ€§åœ¨ç¼–è¯‘å™¨æ‰‹å†Œä¸­æ²¡æœ‰è®°å½•ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œ<em class="command">make</em>è„šæœ¬æ˜¯å®Œå…¨é€æ˜Žçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘é€šå¸¸å¯ä»¥å°†å‘½ä»¤ç›´æŽ¥é”®å…¥ shell ä¸­ä»¥æŸ¥çœ‹å®ƒä»¬çš„è¡Œä¸ºæ–¹å¼ã€‚</p></li><li class="listitem"><p>When writing <em class="command">Ant</em> build
              files you <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>must contend with another layer of indirection.
              The <em class="command">Ant</em> <code class="literal">&lt;mkdir&gt;</code> task does not invoke the
              underlying <em class="command">mkdir</em> program for
              your system. Instead, it executes the Java <code class="function">mkdir( )</code> method of the <code class="function">java.io.File</code> class. This may or may
              not do what you expect. Essentially, any knowledge a programmer
              brings to <em class="command">Ant</em> about the
              behavior of common tools is suspect and must be checked against
              the <em class="command">Ant</em> documentation, Java
              documentation, or the <em class="command">Ant</em>
              source. In addition, to invoke the Java compiler, for instance,
              I may be forced to navigate through a dozen or more unfamiliar
              XML attributes, such as <code class="literal">&lt;srcdir&gt;</code>, <code class="literal">&lt;debug&gt;</code>, etc., that are not
              documented in the compiler manual. In contrast, the <em class="command">make</em> script is completely transparent,
              that is, I can typically type the commands directly into a shell
              to see how they behave.</p></li><li class="listitem"><p>è™½ç„¶<em class="command">èš‚èš</em>è‚¯å®šæ˜¯<a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1486" class="indexterm"></a> <a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1487" class="indexterm"></a> <a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1488" class="indexterm"></a>ä¾¿æºï¼Œ<em class="command">make</em>ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å¦‚<a class="link" href="#OEBPS/ch07.html" title="ç¬¬ 7 ç« å¯ç§»æ¤ Makefile">ç¬¬ 7 ç« </a>æ‰€ç¤ºï¼Œç¼–å†™å¯ç§»æ¤
              <em class="filename">makefile</em>å°±åƒç¼–å†™å¯ç§»æ¤<em class="command">Ant</em>æ–‡ä»¶ä¸€æ ·ï¼Œéœ€è¦ç»éªŒå’ŒçŸ¥è¯†ã€‚ç¨‹åºå‘˜ç¼–å†™å¯ç§»æ¤
              <em class="filename">makefile</em>å·²ç»æœ‰äºŒåå¹´äº†ã€‚æ­¤å¤–ï¼Œ<em class="command">Ant</em>
              æ–‡æ¡£æŒ‡å‡ºï¼ŒUnix ä¸Šçš„ç¬¦å·é“¾æŽ¥å’Œ Windows ä¸Šçš„é•¿æ–‡ä»¶åå­˜åœ¨å¯ç§»æ¤æ€§é—®é¢˜ï¼ŒMacOS X æ˜¯å”¯ä¸€å—æ”¯æŒçš„ Apple æ“ä½œç³»ç»Ÿï¼Œå¹¶ä¸”ä¸ä¿è¯å¯¹å…¶ä»–å¹³å°çš„æ”¯æŒã€‚æ­¤å¤–ï¼Œè¯¸å¦‚è®¾ç½®æ–‡ä»¶æ‰§è¡Œä½ä¹‹ç±»çš„åŸºæœ¬æ“ä½œæ— æ³•ä»Ž Java API æ‰§è¡Œã€‚å¿…é¡»ä½¿ç”¨å¤–éƒ¨ç¨‹åºã€‚å¯ç§»æ¤æ€§ä»Žæ¥éƒ½ä¸æ˜¯ä¸€ä»¶å®¹æ˜“æˆ–å®Œå…¨çš„äº‹æƒ…ã€‚</p></li><li class="listitem"><p>Although <em class="command">Ant</em> is
              certainly <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>portable, so is <em class="command">make</em>. As shown in <a class="link" href="#OEBPS/ch07.html" title="Chapter&nbsp;7.&nbsp;Portable Makefiles">Chapter 7</a>, writing portable
              <em class="filename">makefile</em>s, like writing
              portable <em class="command">Ant</em> files, requires
              experience and knowledge. Programmers have been writing portable
              <em class="filename">makefile</em>s for two decades.
              Furthermore, the <em class="command">Ant</em>
              documentation notes that there are portability issues with
              symbolic links on Unix and long filenames on Windows, that MacOS
              X is the only supported Apple operating system, and that support
              for other platforms is not guaranteed. Also, basic operations
              like setting the execution bit on a file cannot be performed
              from the Java API. An external program must be used. Portability
              is never easy or complete.</p></li><li class="listitem"><p><em class="command">Ant</em>å·¥å…·æ²¡æœ‰å‡†ç¡®è§£é‡Šå®ƒåœ¨åšä»€ä¹ˆã€‚ç”±äºŽ<em class="command">Ant</em>ä»»åŠ¡é€šå¸¸ä¸æ˜¯é€šè¿‡æ‰§è¡Œ shell å‘½ä»¤æ¥å®žçŽ°çš„ï¼Œå› æ­¤<em class="command">Ant</em>å·¥å…·å¾ˆéš¾æ˜¾ç¤ºå…¶æ“ä½œã€‚é€šå¸¸ï¼Œæ˜¾ç¤ºå†…å®¹ç”±<code class="function">print</code>ä»»åŠ¡ä½œè€…æ·»åŠ çš„è¯­å¥ä¸­çš„è‡ªç„¶è¯­è¨€æ•£æ–‡ç»„æˆã€‚ç”¨æˆ·æ— æ³•ä»Ž shell æ‰§è¡Œè¿™äº›æ‰“å°è¯­å¥ã€‚ç›¸åï¼Œ<em class="command">make</em>å›žæ˜¾çš„è¡Œé€šå¸¸æ˜¯å‘½ä»¤è¡Œï¼Œç”¨æˆ·å¯ä»¥å°†å…¶å¤åˆ¶å¹¶ç²˜è´´åˆ° shell ä¸­ä»¥é‡æ–°æ‰§è¡Œã€‚è¿™æ„å‘³ç€<em class="command">Ant</em>æž„å»ºå¯¹äºŽè¯•å›¾äº†è§£æž„å»ºè¿‡ç¨‹å’Œå·¥å…·çš„å¼€å‘äººå‘˜æ¥è¯´ä¸å¤ªæœ‰ç”¨ã€‚æ­¤å¤–ï¼Œå¼€å‘äººå‘˜ä¸å¯èƒ½åœ¨é”®ç›˜ä¸Šå³å…´é‡å¤ä½¿ç”¨ä»»åŠ¡çš„éƒ¨åˆ†å†…å®¹ã€‚</p></li><li class="listitem"><p>The <em class="command">Ant</em> tool does not
              explain precisely what it is doing. Since <em class="command">Ant</em> tasks are not generally
              implemented by executing shell commands, the <em class="command">Ant</em> tool has a difficult time
              displaying its actions. Typically, the display consists of
              natural language prose from <code class="function">print</code> statements added by the task
              author. These print statements cannot be executed by a user from
              a shell. In contrast, the lines echoed by <em class="command">make</em> are usually command lines that a
              user can copy and paste into a shell for reexecution. This means
              the <em class="command">Ant</em> build is less useful
              to developers trying to understand the build process and tools.
              Also, it is not possible for a developer to reuse parts of a
              task, impromptu, at the keyboard.</p></li><li class="listitem"><p>æœ€åŽä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œ<em class="command">Ant</em>å°†æž„å»ºèŒƒä¾‹ä»Žè„šæœ¬åŒ–ç¼–ç¨‹è¯­è¨€è½¬å˜ä¸ºéžè„šæœ¬åŒ–ç¼–ç¨‹è¯­è¨€ã€‚<em class="command">Ant</em>ä»»åŠ¡æ˜¯ç”¨ Java ç¼–å†™çš„ã€‚å¦‚æžœä»»åŠ¡ä¸å­˜åœ¨æˆ–æ²¡æœ‰æ‰§è¡Œæ‚¨æƒ³è¦çš„æ“ä½œï¼Œæ‚¨å¿…é¡»ç”¨ Java ç¼–å†™è‡ªå·±çš„ä»»åŠ¡æˆ–ä½¿ç”¨è¯¥<code class="literal">&lt;exec&gt;</code>ä»»åŠ¡ã€‚ ï¼ˆå½“ç„¶ï¼Œå¦‚æžœæ‚¨ç»å¸¸ä½¿ç”¨è¯¥ä»»åŠ¡ï¼Œé‚£ä¹ˆç®€å•åœ°ä½¿ç”¨<em class="command">make</em>åŠå…¶å®ã€å‡½æ•°å’Œæ›´ç´§å‡‘çš„è¯­æ³•<code class="literal">&lt;exec&gt;</code>ä¼šæ›´å¥½ã€‚ï¼‰<em class="command"></em></p></li><li class="listitem"><p>Last and most importantly, <em class="command">Ant</em> shifts the build paradigm from a
              scripted to a nonscripted programming language. <em class="command">Ant</em> tasks are written in Java. If a
              task does not exist or does not do what you want, you must
              either write your own task in Java or use the <code class="literal">&lt;exec&gt;</code> task. (Of course, if you
              use the <code class="literal">&lt;exec&gt;</code> task
              often, you would do far better to simply use <em class="command">make</em> with its macros, functions, and
              more compact syntax.)</p></li><li class="listitem"><p>å¦ä¸€æ–¹é¢ï¼Œè„šæœ¬è¯­è¨€çš„å‘æ˜Žå’Œç¹è£æ­£æ˜¯ä¸ºäº†è§£å†³æ­¤ç±»é—®é¢˜ã€‚<em class="command">make</em>å·²ç»å­˜åœ¨äº†è¿‘ 30 å¹´ï¼Œå¯ä»¥åœ¨æœ€å¤æ‚çš„æƒ…â€‹â€‹å†µä¸‹ä½¿ç”¨ï¼Œè€Œæ— éœ€æ‰©å±•å…¶å®žçŽ°ã€‚å½“ç„¶ï¼Œè¿™ä¸‰åå¹´é‡Œä¹Ÿæœ‰è¿‡å‡ æ¬¡å»¶æœŸã€‚å…¶ä¸­è®¸å¤šæ˜¯åœ¨<acronym class="acronym">GNU </acronym> <em class="command">make</em>ä¸­æž„æ€å’Œå®žçŽ°çš„ã€‚</p></li><li class="listitem"><p>Scripting languages, on the other hand, were invented and
              flourish precisely to address this type of issue. <em class="command">make</em> has existed for nearly 30 years
              and can be used in the most complex situations without extending
              its implementation. Of course, there have been a handful of
              extensions in those 30 years. Many of them conceived and
              implemented in <acronym class="acronym">GNU</acronym> <em class="command">make</em>.</p></li></ul></div><p><em class="command">Ant</em>æ˜¯ä¸€ä¸ªåœ¨ Java ç¤¾åŒºä¸­è¢«å¹¿æ³›æŽ¥å—çš„å¥‡å¦™å·¥å…·ã€‚ä½†æ˜¯ï¼Œåœ¨å¼€å§‹æ–°é¡¹ç›®ä¹‹å‰ï¼Œè¯·ä»”ç»†è€ƒè™‘<em class="command">Ant</em>æ˜¯å¦é€‚åˆæ‚¨çš„å¼€å‘çŽ¯å¢ƒã€‚æœ¬ç« å°†æœ‰å¸Œæœ›å‘æ‚¨è¯æ˜Ž<em class="command">make</em>å¯ä»¥æœ‰åŠ›åœ°æ»¡è¶³æ‚¨çš„ Java æž„å»ºéœ€æ±‚ã€‚</p><p><em class="command">Ant</em> is a marvelous tool
          that is widely accepted in the Java community. However, before
          embarking on a new project, consider carefully if <em class="command">Ant</em> is appropriate for your development
          environment. This chapter will hopefully prove to you that <em class="command">make</em> can powerfully meet your Java build
          needs.</p></div><div class="sect2" title="IDE"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch09.html.make3-CHP-9-SECT-1.2"></a>IDE</h2><h2 class="title"><a></a>IDEs</h2></div></div></div><p>è®¸å¤š Java å¼€å‘äººå‘˜ä½¿ç”¨ Integrated<a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1489" class="indexterm"></a> <a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1490" class="indexterm"></a>å°†ç¼–è¾‘å™¨ã€ç¼–è¯‘å™¨ã€è°ƒè¯•å™¨å’Œä»£ç æµè§ˆå™¨æ†ç»‘åœ¨å•ä¸ªï¼ˆé€šå¸¸ï¼‰å›¾å½¢çŽ¯å¢ƒä¸­çš„å¼€å‘çŽ¯å¢ƒ (IDE)ã€‚ç¤ºä¾‹åŒ…æ‹¬å¼€æº<a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1491" class="indexterm"></a>Eclipse ( <a class="ulink" href="http://www.eclipse.org/">http://www.eclipse.org</a> ) å’Œ Emacs JDEE ( <a class="ulink" href="http://jdee.sunsite.dk/">http://jdee.sunsite.dk</a> )ï¼Œä»¥åŠï¼Œæ¥è‡ª<a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1492" class="indexterm"></a> <a id="OEBPS/ch09.html.make3-CHP-9-ITERM-1493" class="indexterm"></a>å•†ä¸šä¾›åº”å•†ï¼ŒSun Java Studio ( <a class="ulink" href="http://wwws.sun.com/software/sundev/jde">http://wwws.sun.com/software/sundev/jde</a> ) å’Œ JBuilder ( <a class="ulink" href="http://www.borland.com/jbuilder">http://www.borland.com/jbuilder</a> )ã€‚è¿™äº›çŽ¯å¢ƒé€šå¸¸å…·æœ‰é¡¹ç›®æž„å»ºè¿‡ç¨‹çš„æ¦‚å¿µï¼Œè¯¥è¿‡ç¨‹ç¼–è¯‘å¿…è¦çš„æ–‡ä»¶å¹¶å¯ç”¨åº”ç”¨ç¨‹åºæ‰§è¡Œã€‚</p><p>Many Java developers use Integrated <a class="indexterm"></a> <a class="indexterm"></a>Development Environments (IDEs) that bundle an editor,
          compiler, debugger, and code browser in a single (typically)
          graphical environment. Examples include the open source <a class="indexterm"></a>Eclipse (<a class="ulink" href="http://www.eclipse.org">http://www.eclipse.org</a>)
          and Emacs JDEE (<a class="ulink" href="http://jdee.sunsite.dk">http://jdee.sunsite.dk</a>), and,
          from <a class="indexterm"></a> <a class="indexterm"></a>commercial vendors, Sun Java Studio (<a class="ulink" href="http://wwws.sun.com/software/sundev/jde">http://wwws.sun.com/software/sundev/jde</a>) and JBuilder
          (<a class="ulink" href="http://www.borland.com/jbuilder">http://www.borland.com/jbuilder</a>). These
          environments typically have the notion of a project-build process
          that compiles the necessary files and enables the application
          execution.</p><p>å¦‚æžœ IDE æ”¯æŒæ‰€æœ‰è¿™äº›ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è€ƒè™‘ä½¿ç”¨
          <em class="command">make</em>ï¼Ÿæœ€æ˜Žæ˜¾çš„åŽŸå› æ˜¯ä¾¿æºæ€§ã€‚å¦‚æžœéœ€è¦åœ¨å¦ä¸€ä¸ªå¹³å°ä¸Šæž„å»ºé¡¹ç›®ï¼Œåˆ™åœ¨ç§»æ¤åˆ°æ–°ç›®æ ‡æ—¶æž„å»ºå¯èƒ½ä¼šå¤±è´¥ã€‚å°½ç®¡ Java æœ¬èº«å¯ä»¥è·¨å¹³å°ç§»æ¤ï¼Œä½†æ”¯æŒå·¥å…·å´å¸¸å¸¸ä¸èƒ½ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœé¡¹ç›®çš„é…ç½®æ–‡ä»¶åŒ…å« Unix æˆ– Windows æ ·å¼çš„è·¯å¾„ï¼Œåˆ™å½“æž„å»ºåœ¨å…¶ä»–æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œæ—¶ï¼Œè¿™äº›è·¯å¾„å¯èƒ½ä¼šç”Ÿæˆé”™è¯¯ã€‚ä½¿ç”¨<em class="command">make çš„</em>ç¬¬äºŒä¸ªåŽŸå› æ˜¯æ”¯æŒæ— äººå€¼å®ˆæž„å»ºã€‚æœ‰äº› IDE æ”¯æŒæ‰¹é‡æž„å»ºï¼Œæœ‰äº›åˆ™ä¸æ”¯æŒã€‚æ­¤åŠŸèƒ½çš„æ”¯æŒè´¨é‡ä¹Ÿå„ä¸ç›¸åŒã€‚æœ€åŽï¼Œæ‰€åŒ…å«çš„æž„å»ºæ”¯æŒé€šå¸¸æ˜¯æœ‰é™çš„ã€‚å¦‚æžœæ‚¨å¸Œæœ›å®žçŽ°å®šåˆ¶çš„å‘å¸ƒç›®å½•ç»“æž„ã€é›†æˆå¤–éƒ¨åº”ç”¨ç¨‹åºçš„å¸®åŠ©æ–‡ä»¶ã€æ”¯æŒè‡ªåŠ¨åŒ–æµ‹è¯•ä»¥åŠå¤„ç†åˆ†æ”¯å’Œå¹¶è¡Œå¼€å‘çº¿ï¼Œæ‚¨å¯èƒ½ä¼šå‘çŽ°é›†æˆæž„å»ºæ”¯æŒä¸è¶³ã€‚</p><p>If the IDEs support all this, why should we consider using
          <em class="command">make</em>? The most obvious reason is
          portability. If there is ever a need to build the project on another
          platform, the build may fail when ported to the new target. Although
          Java itself is portable across platforms, the support tools are
          often not. For instance, if the configuration files for your project
          include Unix- or Windows-style paths, these may generate errors when
          the build is run on the other operating system. A second reason to
          use <em class="command">make</em> is to support unattended
          builds. Some IDEs support batch building and some do not. The
          quality of support for this feature also varies. Finally, the build
          support included is often limited. If you hope to implement
          customized release directory structures, integrate help files from
          external applications, support automated testing, and handle
          branching and parallel lines of development, you may find the
          integrated build support inadequate.</p><p>æ ¹æ®æˆ‘è‡ªå·±çš„ç»éªŒï¼Œæˆ‘å‘çŽ° IDE é€‚åˆå°è§„æ¨¡æˆ–æœ¬åœ°åŒ–å¼€å‘ï¼Œä½†ç”Ÿäº§æž„å»ºéœ€è¦<em class="command">make</em>å¯ä»¥æä¾›çš„æ›´å…¨é¢çš„æ”¯æŒã€‚æˆ‘é€šå¸¸ä½¿ç”¨ IDE æ¥ç¼–å†™å’Œè°ƒè¯•ä»£ç ï¼Œå¹¶ä¸ºç”Ÿäº§æž„å»ºå’Œå‘å¸ƒç¼–å†™<em class="filename">makefile</em> ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä½¿ç”¨ IDE å°†é¡¹ç›®ç¼–è¯‘åˆ°é€‚åˆè°ƒè¯•çš„çŠ¶æ€ã€‚ä½†æ˜¯ï¼Œå¦‚æžœæˆ‘æ›´æ”¹è®¸å¤šæ–‡ä»¶æˆ–ä¿®æ”¹è¾“å…¥åˆ°ä»£ç ç”Ÿæˆå™¨çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä¼šè¿è¡Œ<em class="filename">makefile</em>ã€‚æˆ‘ä½¿ç”¨çš„ IDE å¯¹å¤–éƒ¨æºä»£ç ç”Ÿæˆå·¥å…·æ²¡æœ‰å¾ˆå¥½çš„æ”¯æŒã€‚é€šå¸¸ï¼ŒIDE æž„å»ºçš„ç»“æžœä¸é€‚åˆå‘å¸ƒç»™å†…éƒ¨æˆ–å¤–éƒ¨å®¢æˆ·ã€‚å¯¹äºŽè¯¥ä»»åŠ¡ï¼Œæˆ‘ä½¿ç”¨<em class="command">make</em>ã€‚</p><p>In my own experience, I have found the IDEs to be fine for
          small scale or localized development, but production builds require
          the more comprehensive support that <em class="command">make</em> can provide. I typically use an IDE
          to write and debug code, and write a <em class="filename">makefile</em> for production builds and
          releases. During development I use the IDE to compile the project to
          a state suitable for debugging. But if I change many files or modify
          files that are input to code generators, then I run the <em class="filename">makefile</em>. The IDEs I've used do not have
          good support for external source code generation tools. Usually the
          result of an IDE build is not suitable for release to internal or
          external customers. For that task I use <em class="command">make</em>.</p></div></div></div></div></div>
<div id="OEBPS/ch09s02.html"><div>
<div class="sect1" title="é€šç”¨ Java Makefile"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch09s02.html.make3-CHP-9-SECT-2"></a>é€šç”¨ Java Makefile</h1><h1 class="title"><a></a>A Generic Java Makefile</h1></div></div></div><p><a class="link" href="#OEBPS/ch09s02.html.make3-CHP-9-EX-1" title="ä¾‹ 9-1ã€‚ Java çš„é€šç”¨ makefile">ä¾‹ 9-1</a>æ˜¾ç¤ºäº†ä¸€ä¸ªé€šç”¨çš„<em class="filename">makefile</em><a id="OEBPS/ch09s02.html.make3-CHP-9-ITERM-1494" class="indexterm"></a> <a id="OEBPS/ch09s02.html.make3-CHP-9-ITERM-1495" class="indexterm"></a>çˆªå“‡ï¼›æˆ‘å°†åœ¨æœ¬ç« åŽé¢è§£é‡Šå®ƒçš„æ¯ä¸ªéƒ¨åˆ†ã€‚</p><p><a class="link" href="#OEBPS/ch09s02.html.make3-CHP-9-EX-1" title="Example&nbsp;9-1.&nbsp;Generic makefile for Java">Example 9-1</a> shows a
        generic <em class="filename">makefile</em> for <a class="indexterm"></a> <a class="indexterm"></a>Java; I'll explain each of its parts later in the
        chapter.</p><div class="example"><a id="OEBPS/ch09s02.html.make3-CHP-9-EX-1"></a><p class="title">ä¾‹ 9-1ã€‚ Java çš„é€šç”¨ makefile</p><p class="title">Example&nbsp;9-1.&nbsp;Generic makefile for Java</p><div class="example-contents"><pre class="programlisting"># Java é¡¹ç›®çš„é€šç”¨ makefileã€‚

VERSION_NUMBER := 1.0

# æ ‘æœ¨çš„ä½ç½®ã€‚
SOURCE_DIR := src
OUTPUT_DIR := ç±»

# Unix å·¥å…·
AWK := awk
æŸ¥æ‰¾ := /bin/æŸ¥æ‰¾
MKDIR := mkdir -p
RM := rm -rf
å¤–å£³:= /bin/bash

# æ”¯æŒå·¥å…·çš„è·¯å¾„
JAVA_HOME := /opt/j2sdk1.4.2_03
AXIS_HOME := /opt/axis-1_1
TOMCAT_HOME := /opt/jakarta-tomcat-5.0.18
XERCES_HOME := /opt/xerces-1_4_4
JUNIT_HOME := /opt/junit3.8.1

# Java å·¥å…·
JAVA := $(JAVA_HOME)/bin/java
JAVAC := $(JAVA_HOME)/bin/javac

JFLAGS := -æºè·¯å¾„ $(SOURCE_DIR) \
               -d $(OUTPUT_DIR) \
               -æ¥æº1.4

JVMFLAGS := -ea \
               -æ¬§ç©ºå±€\
               -Xæœªæ¥

JVM := $(JAVA) $(JVMFLAGS)

JAR := $(JAVA_HOME)/bin/jar
ç½å­æ ‡å¿— := cf

JAVADOC := $(JAVA_HOME)/bin/javadoc
JDFLAGS := -æºè·¯å¾„ $(SOURCE_DIR) \
               -d $(OUTPUT_DIR) \
               -é“¾æŽ¥http://java.sun.com/products/jdk/1.4/docs/api

# ç½å­
COMMONS_LOGGING_JAR := $(AXIS_HOME)/lib/commons-logging.jar
LOG4J_JAR := $(AXIS_HOME)/lib/log4j-1.2.8.jar
XERCES_JAR := $(XERCES_HOME)/xerces.jar
JUNIT_JAR := $(JUNIT_HOME)/junit.jar

# è®¾ç½®Javaç±»è·¯å¾„
ç±»è·¯å¾„ := è¾“å‡ºç›®å½• \
              XERCES_JAR \
              COMMONS_LOGGING_JAR \
              LOG4J_JAR \
              JUNIT_JAR

# ç©ºæ ¼ - ç©ºæ ¼
ç©ºé—´ := $(ç©º) $(ç©º)

# $(è°ƒç”¨æž„å»ºç±»è·¯å¾„ï¼Œå˜é‡åˆ—è¡¨)
å®šä¹‰æž„å»ºç±»è·¯å¾„
$(æ¡\
  $(patsubst :%,%, \
    $(æ›¿æ¢:,:,\
      $(æ¡\
        $(foreach j,$1,$(è°ƒç”¨ get-file,$j):)))))
æ©å¾·å¤«

# $(è°ƒç”¨ get-file, å˜é‡å)
å®šä¹‰èŽ·å–æ–‡ä»¶
  $(æ¡\
    $($1) \
    $(å¦‚æžœ$(è°ƒç”¨æ–‡ä»¶å­˜åœ¨-eval,$1),, \
      $(è­¦å‘Šå˜é‡å¼•ç”¨çš„æ–‡ä»¶\
                æ‰¾ä¸åˆ°â€œ$1â€ï¼ˆ$(â€‹â€‹$1))ï¼‰ï¼‰ï¼‰
æ©å¾·å¤«

# $(è°ƒç”¨æ–‡ä»¶å­˜åœ¨è¯„ä¼°ï¼Œå˜é‡åç§°)
å®šä¹‰æ–‡ä»¶å­˜åœ¨è¯„ä¼°
  $(æ¡\
    $(å¦‚æžœ $($1),,$(è­¦å‘Š '$1' æ²¡æœ‰å€¼)) \
    $(é€šé…ç¬¦$($1)))
æ©å¾·å¤«

# $(è°ƒç”¨ç®€è¦å¸®åŠ©ï¼Œmakefile)
å®šä¹‰ç®€çŸ­å¸®åŠ©
  $(AWK) '$$1 ~ /^[^.][-A-Za-z0-9]*:/ \
         { æ‰“å° substr($$1, 1, é•¿åº¦($$1)-1) }' $1 | \
  æŽ’åº| \
  pr -T -w 80 -4
æ©å¾·å¤«

# $(è°ƒç”¨æ–‡ä»¶å­˜åœ¨ï¼Œé€šé…ç¬¦æ¨¡å¼)
æ–‡ä»¶å­˜åœ¨= $(é€šé…ç¬¦$1)

# $(è°ƒç”¨æ£€æŸ¥æ–‡ä»¶ï¼Œæ–‡ä»¶åˆ—è¡¨)
å®šä¹‰æ£€æŸ¥æ–‡ä»¶
  $(foreach f, $1, \
    $(å¦‚æžœ$(è°ƒç”¨æ–‡ä»¶å­˜åœ¨,$($f)),,\
      $ï¼ˆè­¦å‘Š$fï¼ˆ$ï¼ˆ$fï¼‰ï¼‰ä¸¢å¤±ï¼‰ï¼‰ï¼‰
æ©å¾·å¤«

# #(è°ƒç”¨ make-temp-dir, root-opt)
å®šä¹‰ make-temp-dir
  mktemp -t $(if $1,$1,make).XXXXXXXXXX
æ©å¾·å¤«

# MANIFEST_TEMPLATE - m4 å®å¤„ç†å™¨çš„æ¸…å•è¾“å…¥
MANIFEST_TEMPLATE := src/manifest/manifest.mf
TMP_JAR_DIR := $(è°ƒç”¨ make-temp-dir)
TMP_MANIFEST := $(TMP_JAR_DIR)/manifest.mf

# $(è°ƒç”¨ add-manifestã€jarã€jar-nameã€manifest-file-opt)
å®šä¹‰æ·»åŠ æ¸…å•
  $(RM) $(ç›®å½• $(TMP_MANIFEST))
  $(MKDIR) $(ç›®å½• $(TMP_MANIFEST))
  m4 --define=NAME="$(notdir $2)" \
     --define=IMPL_VERSION=$(VERSION_NUMBER) \
     --define=SPEC_VERSION=$(VERSION_NUMBER) \
     $(å¦‚æžœ$3,$3,$(MANIFEST_TEMPLATE)) \
     &gt; $(TMP_MANIFEST)
  $(JAR) -ufm $1 $(TMP_MANIFEST)
  $(RM) $(ç›®å½• $(TMP_MANIFEST))
æ©å¾·å¤«

# $(è°ƒç”¨ make-jar,jar-variable-prefix)
å®šä¹‰ make-jar
  .PHONYï¼š$1 $$($1_name)
  $1ï¼š$($1_åç§°)
  $$ï¼ˆ$1_åç§°ï¼‰ï¼š
        cd $(OUTPUT_DIR); \
        $(JAR) $(JARFLAGS) $$(notdir $$@) $$($1_packages)
        $$ï¼ˆè°ƒç”¨æ·»åŠ æ¸…å•ï¼Œ$$@ï¼Œ$$ï¼ˆ$1_nameï¼‰ï¼Œ$$ï¼ˆ$1_manifestï¼‰ï¼‰
æ©å¾·å¤«

# è®¾ç½®ç±»è·¯å¾„
å¯¼å‡º CLASSPATH := $(è°ƒç”¨æž„å»ºç±»è·¯å¾„ï¼Œ$(class_path))

# make-directories - ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨ã€‚
make-directories := $(shell $(MKDIR) $(OUTPUT_DIR))

# help - é»˜è®¤ç›®æ ‡
.PHONYï¼šå¸®åŠ©
å¸®åŠ©ï¼š
        @$(è°ƒç”¨ç®€çŸ­å¸®åŠ©ï¼Œ$(CURDIR)/Makefile)

# all - æ‰§è¡Œå®Œæ•´æž„å»ºçš„æ‰€æœ‰ä»»åŠ¡
.PHONYï¼šå…¨éƒ¨
allï¼šç¼–è¯‘jar javadoc

# all_javas - ç”¨äºŽä¿å­˜æºæ–‡ä»¶åˆ—è¡¨çš„ä¸´æ—¶æ–‡ä»¶
all_javas := $(OUTPUT_DIR)/all.javas

#compile - ç¼–è¯‘æºä»£ç 
.PHONYï¼šç¼–è¯‘
ç¼–è¯‘ï¼š$(all_javas)
        $(JAVAC) $(JFLAGS) @$&lt;

# all_javas - æ”¶é›†æºæ–‡ä»¶åˆ—è¡¨
.INTERMEDIATEï¼š$(all_javas)
$(all_javas):
        $(FIND) $(SOURCE_DIR) -name '*.java' &gt; $@

# jar_list - è¦åˆ›å»ºçš„æ‰€æœ‰ jar çš„åˆ—è¡¨
jar_list := server_jar ui_jar

# jars - åˆ›å»ºæ‰€æœ‰ jars
.PHONYï¼šç½å­
ç½å­ï¼š$(jar_list)

# server_jar - åˆ›å»º $(server_jar)
server_jar_name := $(OUTPUT_DIR)/lib/a.jar
server_jar_manifest := src/com/company/manifest/foo.mf
server_jar_packages := com/company/m com/company/n

# ui_jar - åˆ›å»º $(ui_jar)
ui_jar_name := $(OUTPUT_DIR)/lib/b.jar
ui_jar_manifest := src/com/company/manifest/bar.mf
ui_jar_packages := com/company/o com/company/p

# ä¸ºæ¯ä¸ª jar åˆ›å»ºæ˜Žç¡®çš„è§„åˆ™
# $(foreach j, $(jar_list), $(eval $(call make-jar,$j)))
$(eval $(è°ƒç”¨ make-jar,server_jar))
$(eval $(è°ƒç”¨ make-jar,ui_jar))

# javadoc - ä»Žæºç”Ÿæˆ Java æ–‡æ¡£
.PHONYï¼šjavadoc
javadocï¼š$(all_javas)
        $(JAVADOC) $(JDFLAGS) @$&lt;

.PHONYï¼šå¹²å‡€
å¹²å‡€çš„ï¼š
        $(RM) $(OUTPUT_DIR)

.PHONYï¼šç±»è·¯å¾„
ç±»è·¯å¾„ï¼š
        @echo CLASSPATH='$(CLASSPATH)'

.PHONYï¼šæ£€æŸ¥é…ç½®
æ£€æŸ¥é…ç½®ï¼š
        @echo æ­£åœ¨æ£€æŸ¥é…ç½®...
        $(è°ƒç”¨æ£€æŸ¥æ–‡ä»¶, $(class_path) JAVA_HOME)

.PHONYï¼šæ‰“å°
æ‰“å°ï¼š
        $(foreach v, $(V), \
          $(è­¦å‘Š$v = $($v)))</pre><pre class="programlisting"># A generic makefile for a Java project.

VERSION_NUMBER := 1.0

# Location of trees.
SOURCE_DIR  := src
OUTPUT_DIR  := classes

# Unix tools
AWK         := awk
FIND        := /bin/find
MKDIR       := mkdir -p
RM          := rm -rf
SHELL       := /bin/bash

# Path to support tools
JAVA_HOME   := /opt/j2sdk1.4.2_03
AXIS_HOME   := /opt/axis-1_1
TOMCAT_HOME := /opt/jakarta-tomcat-5.0.18
XERCES_HOME := /opt/xerces-1_4_4
JUNIT_HOME  := /opt/junit3.8.1

# Java tools
JAVA        := $(JAVA_HOME)/bin/java
JAVAC       := $(JAVA_HOME)/bin/javac

JFLAGS      := -sourcepath $(SOURCE_DIR)        \
               -d $(OUTPUT_DIR)                 \
               -source 1.4

JVMFLAGS    := -ea                              \
               -esa                             \
               -Xfuture

JVM         := $(JAVA) $(JVMFLAGS)

JAR         := $(JAVA_HOME)/bin/jar
JARFLAGS    := cf

JAVADOC     := $(JAVA_HOME)/bin/javadoc
JDFLAGS     := -sourcepath $(SOURCE_DIR)        \
               -d $(OUTPUT_DIR)                 \
               -link http://java.sun.com/products/jdk/1.4/docs/api

# Jars
COMMONS_LOGGING_JAR   := $(AXIS_HOME)/lib/commons-logging.jar
LOG4J_JAR             := $(AXIS_HOME)/lib/log4j-1.2.8.jar
XERCES_JAR            := $(XERCES_HOME)/xerces.jar
JUNIT_JAR             := $(JUNIT_HOME)/junit.jar

# Set the Java classpath
class_path := OUTPUT_DIR                \
              XERCES_JAR                \
              COMMONS_LOGGING_JAR       \
              LOG4J_JAR                 \
              JUNIT_JAR

# space - A blank space
space := $(empty) $(empty)

# $(call build-classpath, variable-list)
define build-classpath
$(strip                                         \
  $(patsubst :%,%,                              \
    $(subst : ,:,                               \
      $(strip                                   \
        $(foreach j,$1,$(call get-file,$j):)))))
endef

# $(call get-file, variable-name)
define get-file
  $(strip                                       \
    $($1)                                       \
    $(if $(call file-exists-eval,$1),,          \
      $(warning The file referenced by variable \
                '$1' ($($1)) cannot be found)))
endef

# $(call file-exists-eval, variable-name)
define file-exists-eval
  $(strip                                       \
    $(if $($1),,$(warning '$1' has no value))   \
    $(wildcard $($1)))
endef

# $(call brief-help, makefile)
define brief-help
  $(AWK) '$$1 ~ /^[^.][-A-Za-z0-9]*:/                   \
         { print substr($$1, 1, length($$1)-1) }' $1 |  \
  sort |                                                \
  pr -T -w 80 -4
endef

# $(call file-exists, wildcard-pattern)
file-exists = $(wildcard $1)

# $(call check-file, file-list)
define check-file
  $(foreach f, $1,                              \
    $(if $(call file-exists, $($f)),,           \
      $(warning $f ($($f)) is missing)))
endef

# #(call make-temp-dir, root-opt)
define make-temp-dir
  mktemp -t $(if $1,$1,make).XXXXXXXXXX
endef

# MANIFEST_TEMPLATE - Manifest input to m4 macro processor
MANIFEST_TEMPLATE := src/manifest/manifest.mf
TMP_JAR_DIR       := $(call make-temp-dir)
TMP_MANIFEST      := $(TMP_JAR_DIR)/manifest.mf

# $(call add-manifest, jar, jar-name, manifest-file-opt)
define add-manifest
  $(RM) $(dir $(TMP_MANIFEST))
  $(MKDIR) $(dir $(TMP_MANIFEST))
  m4 --define=NAME="$(notdir $2)"                       \
     --define=IMPL_VERSION=$(VERSION_NUMBER)            \
     --define=SPEC_VERSION=$(VERSION_NUMBER)            \
     $(if $3,$3,$(MANIFEST_TEMPLATE))                   \
     &gt; $(TMP_MANIFEST)
  $(JAR) -ufm $1 $(TMP_MANIFEST)
  $(RM) $(dir $(TMP_MANIFEST))
endef

# $(call make-jar,jar-variable-prefix)
define make-jar
  .PHONY: $1 $$($1_name)
  $1: $($1_name)
  $$($1_name):
        cd $(OUTPUT_DIR); \
        $(JAR) $(JARFLAGS) $$(notdir $$@) $$($1_packages)
        $$(call add-manifest, $$@, $$($1_name), $$($1_manifest))
endef

# Set the CLASSPATH
export CLASSPATH := $(call build-classpath, $(class_path))

# make-directories - Ensure output directory exists.
make-directories := $(shell $(MKDIR) $(OUTPUT_DIR))

# help - The default goal
.PHONY: help
help:
        @$(call brief-help, $(CURDIR)/Makefile)

# all - Perform all tasks for a complete build
.PHONY: all
all: compile jars javadoc

# all_javas - Temp file for holding source file list
all_javas := $(OUTPUT_DIR)/all.javas

# compile - Compile the source
.PHONY: compile
compile: $(all_javas)
        $(JAVAC) $(JFLAGS) @$&lt;

# all_javas - Gather source file list
.INTERMEDIATE: $(all_javas)
$(all_javas):
        $(FIND) $(SOURCE_DIR) -name '*.java' &gt; $@

# jar_list - List of all jars to create
jar_list := server_jar ui_jar

# jars - Create all jars
.PHONY: jars
jars: $(jar_list)

# server_jar - Create the $(server_jar)
server_jar_name     := $(OUTPUT_DIR)/lib/a.jar
server_jar_manifest := src/com/company/manifest/foo.mf
server_jar_packages := com/company/m com/company/n

# ui_jar - create the $(ui_jar)
ui_jar_name     := $(OUTPUT_DIR)/lib/b.jar
ui_jar_manifest := src/com/company/manifest/bar.mf
ui_jar_packages := com/company/o com/company/p

# Create an explicit rule for each jar
# $(foreach j, $(jar_list), $(eval $(call make-jar,$j)))
$(eval $(call make-jar,server_jar))
$(eval $(call make-jar,ui_jar))

# javadoc - Generate the Java doc from sources
.PHONY: javadoc
javadoc: $(all_javas)
        $(JAVADOC) $(JDFLAGS) @$&lt;

.PHONY: clean
clean:
        $(RM) $(OUTPUT_DIR)

.PHONY: classpath
classpath:
        @echo CLASSPATH='$(CLASSPATH)'

.PHONY: check-config
check-config:
        @echo Checking configuration...
        $(call check-file, $(class_path) JAVA_HOME)

.PHONY: print
print:
        $(foreach v, $(V), \
          $(warning $v = $($v)))</pre></div></div></div></div></div>
<div id="OEBPS/ch09s03.html"><div>
<div class="sect1" title="ç¼–è¯‘Java"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch09s03.html.make3-CHP-9-SECT-3"></a>ç¼–è¯‘Java</h1><h1 class="title"><a></a>Compiling Java</h1></div></div></div><p>Java å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ä½¿ç”¨<em class="command">make</em>è¿›è¡Œç¼–è¯‘ï¼šä¼ ç»Ÿæ–¹æ³•ï¼Œæ¯ä¸ªæºæ–‡ä»¶æ‰§è¡Œä¸€æ¬¡<em class="command">javac</em> ï¼›æˆ–å‰é¢æ¦‚è¿°çš„ä½¿ç”¨è¯­æ³•çš„å¿«é€Ÿæ–¹æ³•<code class="literal">@filename</code>ã€‚</p><p>Java can be compiled with <em class="command">make</em> in two ways: the traditional approach,
        one <em class="command">javac</em> execution per source
        file; or the fast approach outlined previously using the <code class="literal">@filename</code> syntax.</p><div class="sect2" title="å¿«é€Ÿæ–¹æ³•ï¼šä¸€ä½“åŒ–ç¼–è¯‘"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch09s03.html.make3-CHP-9-SECT-3.1"></a>å¿«é€Ÿæ–¹æ³•ï¼šä¸€ä½“åŒ–ç¼–è¯‘</h2><h2 class="title"><a></a>The Fast Approach: All-in-One Compile</h2></div></div></div><p>è®©æˆ‘ä»¬ä»Žå¿«é€Ÿæ–¹æ³•å¼€å§‹ã€‚æ­£å¦‚æ‚¨åœ¨é€šç”¨<em class="filename">makefile</em>ä¸­çœ‹åˆ°çš„ï¼š</p><p>Let's start with the fast approach. As you can see in the
          generic <em class="filename">makefile</em>:</p><a id="OEBPS/ch09s03.html.I_4_tt400"></a><pre class="programlisting"># all_javas - ç”¨äºŽä¿å­˜æºæ–‡ä»¶åˆ—è¡¨çš„ä¸´æ—¶æ–‡ä»¶
all_javas := $(OUTPUT_DIR)/all.javas

#compile - ç¼–è¯‘æºä»£ç 
.PHONYï¼šç¼–è¯‘
ç¼–è¯‘ï¼š$(all_javas)
        $(JAVAC) $(JFLAGS) @$&lt;

# all_javas - æ”¶é›†æºæ–‡ä»¶åˆ—è¡¨
.INTERMEDIATEï¼š$(all_javas)
$(all_javas):
        $(FIND) $(SOURCE_DIR) -name '*.java' &gt; $@</pre><pre class="programlisting"># all_javas - Temp file for holding source file list
all_javas := $(OUTPUT_DIR)/all.javas

# compile - Compile the source
.PHONY: compile
compile: $(all_javas)
        $(JAVAC) $(JFLAGS) @$&lt;

# all_javas - Gather source file list
.INTERMEDIATE: $(all_javas)
$(all_javas):
        $(FIND) $(SOURCE_DIR) -name '*.java' &gt; $@</pre><p>è™šå‡ç›®æ ‡<code class="literal">compile</code>
          è°ƒç”¨<em class="command">javac</em>ä¸€æ¬¡æ¥ç¼–è¯‘é¡¹ç›®çš„æ‰€æœ‰æºä»£ç ã€‚</p><p>The phony target <code class="literal">compile</code>
          invokes <em class="command">javac</em> once to compile all
          the source of the project.</p><p>å…ˆå†³<code class="literal">$(all_javas)</code>
          æ¡ä»¶æ˜¯ä¸€ä¸ªæ–‡ä»¶<em class="filename">all.javas</em>ï¼Œå…¶ä¸­åŒ…å« Java æ–‡ä»¶åˆ—è¡¨ï¼Œæ¯è¡Œä¸€ä¸ªæ–‡ä»¶åã€‚æ¯ä¸ªæ–‡ä»¶ä¸å¿…éƒ½åœ¨è‡ªå·±çš„è¡Œä¸Šï¼Œä½†è¿™æ ·<code class="literal">grep -v</code>åœ¨éœ€è¦æ—¶å¯ä»¥æ›´å®¹æ˜“åœ°è¿‡æ»¤æ–‡ä»¶ã€‚åˆ›å»º<em class="filename">all.javas</em>çš„è§„åˆ™è¢«æ ‡è®°<code class="literal">.INTERMEDIATE</code>ï¼Œä»¥ä¾¿<em class="command">make</em>å°†åœ¨æ¯æ¬¡è¿è¡ŒåŽåˆ é™¤è¯¥æ–‡ä»¶ï¼Œä»Žè€Œåœ¨æ¯æ¬¡ç¼–è¯‘å‰åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ã€‚åˆ›å»ºæ–‡ä»¶çš„å‘½ä»¤è„šæœ¬å¾ˆç®€å•ã€‚ä¸ºäº†èŽ·å¾—æœ€å¤§çš„å¯ç»´æŠ¤æ€§ï¼Œæˆ‘ä»¬ä½¿ç”¨<em class="command">find</em>å‘½ä»¤æ¥æ£€ç´¢æ‰€æœ‰<em class="command">java</em>æºæ ‘ä¸­çš„æ–‡ä»¶ã€‚è¯¥å‘½ä»¤å¯èƒ½æœ‰ç‚¹æ…¢ï¼Œä½†ä¿è¯åœ¨æºæ ‘å‘ç”Ÿå˜åŒ–æ—¶å‡ ä¹Žæ— éœ€ä¿®æ”¹å³å¯æ­£ç¡®å·¥ä½œã€‚</p><p>The <code class="literal">$(all_javas)</code>
          prerequisite is a file, <em class="filename">all.javas</em>, containing a list of Java
          files, one filename per line. It is not necessary for each file to
          be on its own line, but this way it is much easier to filter files
          with <code class="literal">grep -v</code> if the need ever
          arises. The rule to create <em class="filename">all.javas</em> is marked <code class="literal">.INTERMEDIATE</code> so that <em class="command">make</em> will remove the file after each run
          and thus create a new one before each compile. The command script to
          create the file is straightforward. For maximum maintainability we
          use the <em class="command">find</em> command to retrieve
          all the <em class="command">java</em> files in the source
          tree. This command can be a bit slow, but is guaranteed to work
          correctly with virtually no modification as the source tree
          changes.</p><p><em class="filename">å¦‚æžœmakefile</em>ä¸­æœ‰å¯ç”¨çš„æºç›®å½•åˆ—è¡¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ›´å¿«çš„å‘½ä»¤è„šæœ¬æ¥æž„å»º<em class="filename">all.javas</em>ã€‚å¦‚æžœæºç›®å½•åˆ—è¡¨çš„é•¿åº¦ä¸­ç­‰ï¼Œä»¥ä¾¿å‘½ä»¤è¡Œçš„é•¿åº¦ä¸è¶…è¿‡æ“ä½œç³»ç»Ÿçš„é™åˆ¶ï¼Œåˆ™è¿™ä¸ªç®€å•çš„è„šæœ¬å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><p>If you have a list of source directories readily available in
          the <em class="filename">makefile</em>, you can use
          faster command scripts to build <em class="filename">all.javas</em>. If the list of source
          directories is of medium length so that the length of the command
          line does not exceed the operating system's limits, this simple
          script will do:</p><a id="OEBPS/ch09s03.html.I_4_tt401"></a><pre class="programlisting">$(all_javas):
        shopt -s nullglobï¼› \
        printf "%s\n" $(addsuffix /*.java,$(PACKAGE_DIRS)) &gt; $@</pre><pre class="programlisting">$(all_javas):
        shopt -s nullglob; \
        printf "%s\n" $(addsuffix /*.java,$(PACKAGE_DIRS)) &gt; $@</pre><p>è¯¥è„šæœ¬ä½¿ç”¨ shell é€šé…ç¬¦æ¥ç¡®å®šæ¯ä¸ªç›®å½•ä¸­çš„ Java æ–‡ä»¶åˆ—è¡¨ã€‚ä½†æ˜¯ï¼Œå¦‚æžœç›®å½•ä¸åŒ…å« Java æ–‡ä»¶ï¼Œæˆ‘ä»¬å¸Œæœ›é€šé…ç¬¦äº§ç”Ÿç©ºå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯åŽŸå§‹çš„é€šé…ç¬¦æ¨¡å¼ï¼ˆè®¸å¤š shell çš„é»˜è®¤è¡Œä¸ºï¼‰ã€‚ä¸ºäº†è¾¾åˆ°æ­¤æ•ˆæžœï¼Œæˆ‘ä»¬ä½¿ç”¨<em class="command">bash</em>é€‰é¡¹<em class="command">shopt -s nullglob</em>ã€‚å¤§å¤šæ•°å…¶ä»– shell éƒ½æœ‰ç±»ä¼¼çš„é€‰é¡¹ã€‚æœ€åŽï¼Œæˆ‘ä»¬ä½¿ç”¨ globbing å’Œ<em class="command">printf</em>è€Œä¸æ˜¯<em class="command">ls -1ï¼Œ</em>å› ä¸ºå®ƒä»¬å†…ç½®äºŽ
          <em class="command">bash</em>ä¸­ï¼Œå› æ­¤æ— è®ºåŒ…ç›®å½•çš„æ•°é‡å¦‚ä½•ï¼Œæˆ‘ä»¬çš„å‘½ä»¤è„šæœ¬éƒ½åªæ‰§è¡Œå•ä¸ªç¨‹åºã€‚</p><p>This script uses shell wildcards to determine the list of Java
          files in each directory. If, however, a directory contains no Java
          files, we want the wildcard to yield the empty string, not the
          original globbing pattern (the default behavior of many shells). To
          achieve this effect, we use the <em class="command">bash</em> option <em class="command">shopt
          -s nullglob</em>. Most other shells have similar options.
          Finally, we use globbing and <em class="command">printf</em> rather than <em class="command">ls -1</em> because these are built-in to
          <em class="command">bash</em>, so our command script
          executes only a single program regardless of the number of package
          directories.</p><p>æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ¥é¿å… shell é€šé…<code class="function">wildcard</code>ï¼š</p><p>Alternately, we can avoid shell globbing by using <code class="function">wildcard</code>:</p><a id="OEBPS/ch09s03.html.I_4_tt402"></a><pre class="programlisting">$(all_javas):
        æ‰“å°â€œ%s\nâ€$(é€šé…ç¬¦\
                       $(addsuffix /*.java,$(PACKAGE_DIRS))) &gt; $@</pre><pre class="programlisting">$(all_javas):
        print "%s\n" $(wildcard \
                       $(addsuffix /*.java,$(PACKAGE_DIRS))) &gt; $@</pre><p>å¦‚æžœæ‚¨æœ‰éžå¸¸å¤šçš„æºç›®å½•ï¼ˆæˆ–éžå¸¸é•¿çš„è·¯å¾„ï¼‰ï¼Œä¸Šè¿°è„šæœ¬å¯èƒ½ä¼šè¶…å‡ºæ“ä½œç³»ç»Ÿçš„å‘½ä»¤è¡Œé•¿åº¦é™åˆ¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»¥ä¸‹è„šæœ¬å¯èƒ½æ›´åˆé€‚ï¼š</p><p>If you have very many source directories (or very long paths),
          the above script may exceed the command-line length limit of the
          operating system. In that case, the following script may be
          preferable:</p><a id="OEBPS/ch09s03.html.I_4_tt403"></a><pre class="programlisting">.INTERMEDIATEï¼š$(all_javas)
$(all_javas):
        shopt -s nullglobï¼› \
        for f in $(PACKAGE_DIRS); \
        åš \
          printf "%s\n" $$f/*.java; \
        å®Œæˆ &gt; $@</pre><pre class="programlisting">.INTERMEDIATE: $(all_javas)
$(all_javas):
        shopt -s nullglob;            \
        for f in $(PACKAGE_DIRS);     \
        do                            \
          printf "%s\n" $$f/*.java;   \
        done &gt; $@</pre><p>è¯·æ³¨æ„ï¼Œ<code class="literal">compile</code>
          ç›®æ ‡å’Œæ”¯æŒè§„åˆ™éµå¾ªéžé€’å½’<em class="command">make</em>æ–¹æ³•ã€‚ä¸ç®¡æœ‰å¤šå°‘ä¸ªå­ç›®å½•ï¼Œæˆ‘ä»¬ä»ç„¶æœ‰ä¸€ä¸ª<em class="filename">makefile</em>å’Œä¸€ä¸ªç¼–è¯‘å™¨çš„æ‰§è¡Œã€‚å¦‚æžœæ‚¨æƒ³ç¼–è¯‘æ‰€æœ‰æºä»£ç ï¼Œè¿™å·²ç»æ˜¯æœ€å¿«çš„äº†ã€‚</p><p>Notice that the <code class="literal">compile</code>
          target and the supporting rule follow the nonrecursive <em class="command">make</em> approach. No matter how many
          subdirectories there are, we still have one <em class="filename">makefile</em> and one execution of the
          compiler. If you want to compile all of the source, this is as fast
          as it gets.</p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬å®Œå…¨ä¸¢å¼ƒäº†æ‰€æœ‰ä¾èµ–ä¿¡æ¯ã€‚æœ‰äº†è¿™äº›è§„åˆ™ï¼Œ<em class="command">make</em>æ—¢ä¸çŸ¥é“ä¹Ÿä¸å…³å¿ƒå“ªä¸ªæ–‡ä»¶æ¯”å“ªä¸ªæ–‡ä»¶æ–°ã€‚å®ƒåªæ˜¯åœ¨æ¯æ¬¡è°ƒç”¨æ—¶ç¼–è¯‘æ‰€æœ‰å†…å®¹ã€‚ä½œä¸ºä¸€ä¸ªé¢å¤–çš„å¥½å¤„ï¼Œæˆ‘ä»¬å¯ä»¥ä»Žæºä»£ç æ ‘è€Œä¸æ˜¯äºŒå‰æ ‘æ‰§è¡Œ<em class="filename">makefile</em> ã€‚
          è€ƒè™‘åˆ°<em class="command">make</em>ç®¡ç†ä¾èµ–å…³ç³»çš„èƒ½åŠ›ï¼Œè¿™ä¼¼ä¹Žæ˜¯ä¸€ç§æ„šè ¢çš„ç»„ç»‡ makefile çš„æ–¹æ³•<em class="filename">ï¼Œä½†è¯·è€ƒè™‘ä¸€ä¸‹ï¼š</em><em class="command"></em></p><p>Also, we completely discarded all dependency information. With
          these rules, <em class="command">make</em> neither knows
          nor cares about which file is newer than which. It simply compiles
          everything on every invocation. As an added benefit, we can execute
          the <em class="filename">makefile</em> from the source
          tree, instead of the binary tree. This may seem like a silly way to
          organize the <em class="filename">makefile</em>
          considering <em class="command">make</em>'s abilities to
          manage dependencies, but consider this:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>å¦ä¸€ç§æ–¹æ³•ï¼ˆæˆ‘ä»¬å°†å¾ˆå¿«æŽ¢è®¨ï¼‰ä½¿ç”¨æ ‡å‡†ä¾èµ–æ–¹æ³•ã€‚è¿™ä¼šä¸ºæ¯ä¸ªæ–‡ä»¶è°ƒç”¨ä¸€ä¸ªæ–°çš„<em class="command">javac</em>è¿›ç¨‹ï¼Œå¢žåŠ å¤§é‡å¼€é”€ã€‚ä½†æ˜¯ï¼Œå¦‚æžœé¡¹ç›®å¾ˆå°ï¼Œç¼–è¯‘æ‰€æœ‰æºæ–‡ä»¶ä¸ä¼šæ¯”ç¼–è¯‘å‡ ä¸ªæ–‡ä»¶èŠ±è´¹æ›´é•¿çš„æ—¶é—´ï¼Œå› ä¸º<em class="command">javac</em>
              ç¼–è¯‘å™¨éžå¸¸å¿«ï¼Œè€Œè¿›ç¨‹åˆ›å»ºé€šå¸¸å¾ˆæ…¢ã€‚ä»»ä½•èŠ±è´¹æ—¶é—´å°‘äºŽ 15 ç§’çš„æž„å»ºåŸºæœ¬ä¸Šæ˜¯ç­‰æ•ˆçš„ï¼Œæ— è®ºå®ƒåšäº†å¤šå°‘å·¥ä½œã€‚ä¾‹å¦‚ï¼Œåœ¨æˆ‘çš„ 1.8 GHz Pentium 4ã€512 MB RAM ä¸Šç¼–è¯‘å¤§çº¦ 500 ä¸ªæºæ–‡ä»¶ï¼ˆæ¥è‡ª Ant å‘è¡Œç‰ˆï¼‰éœ€è¦ 14 ç§’ã€‚ç¼–è¯‘ä¸€ä¸ªæ–‡ä»¶éœ€è¦äº”ç§’é’Ÿã€‚</p></li><li class="listitem"><p>The alternative (which we will explore shortly) uses the
              standard dependency approach. This invokes a new <em class="command">javac</em> process for each file, adding a
              lot of overhead. But, if the project is small, compiling all the
              source files will not take significantly longer than compiling a
              few files because the <em class="command">javac</em>
              compiler is so fast and process creation is typically slow. Any
              build that takes less than 15 seconds is basically equivalent
              regardless of how much work it does. For instance, compiling
              approximately 500 source files (from the Ant distribution) takes
              14 seconds on my 1.8-GHz Pentium 4 with 512 MB of RAM. Compiling
              one file takes five seconds.</p></li><li class="listitem"><p>å¤§å¤šæ•°å¼€å‘äººå‘˜å°†ä½¿ç”¨æŸç§ä¸ºå•ä¸ªæ–‡ä»¶æä¾›å¿«é€Ÿç¼–è¯‘çš„å¼€å‘çŽ¯å¢ƒã€‚å½“æ›´æ”¹æ›´å¹¿æ³›ã€éœ€è¦å®Œå…¨é‡å»ºæˆ–éœ€è¦æ— äººå€¼å®ˆæž„å»ºæ—¶ï¼Œå¾ˆå¯èƒ½ä¼šä½¿ç”¨makefile <em class="filename">ã€‚</em></p></li><li class="listitem"><p>Most developers will be using some kind of development
              environment that provides fast compilation for individual files.
              The <em class="filename">makefile</em> will most
              likely be used when changes are more extensive, complete
              rebuilds are required, or unattended builds are
              necessary.</p></li><li class="listitem"><p>æ­£å¦‚æˆ‘ä»¬å°†çœ‹åˆ°çš„ï¼Œå®žçŽ°å’Œç»´æŠ¤ä¾èµ–é¡¹æ‰€æ¶‰åŠçš„å·¥ä½œç›¸å½“äºŽ C/C++ çš„å•ç‹¬æºä»£ç å’ŒäºŒå‰æ ‘æž„å»ºï¼ˆ<a class="link" href="#OEBPS/ch08.html" title="ç¬¬ 8 ç«  C å’Œ C++">ç¬¬ 8 ç« </a>ä¸­æè¿°ï¼‰ã€‚è¿™æ˜¯ä¸€é¡¹ä¸å¯ä½Žä¼°çš„ä»»åŠ¡ã€‚</p></li><li class="listitem"><p>As we shall see, the effort involved in implementing and
              maintaining dependencies is equal to the separate source and
              binary tree builds for C/C++ (described in <a class="link" href="#OEBPS/ch08.html" title="Chapter&nbsp;8.&nbsp;C and C++">Chapter 8</a>). Not a task to be
              underestimated.</p></li></ul></div><p>æ­£å¦‚æˆ‘ä»¬å°†åœ¨åŽé¢çš„ç¤ºä¾‹ä¸­çœ‹åˆ°çš„ï¼Œè¯¥å˜é‡é™¤äº†ç®€å•åœ°æž„å»º<em class="filename">all.javas</em><code class="literal">PACKAGE_DIRS</code>æ–‡ä»¶ä¹‹å¤–è¿˜æœ‰å…¶ä»–ç”¨é€”
          ã€‚ä½†ç»´æŒè¿™äº›å˜é‡å¯èƒ½æ˜¯ä¸€ä¸ªåŠ³åŠ¨å¯†é›†åž‹ä¸”å¯èƒ½å¾ˆå›°éš¾çš„æ­¥éª¤ã€‚å¯¹äºŽè¾ƒå°çš„é¡¹ç›®ï¼Œå¯ä»¥åœ¨<em class="filename">makefile</em>ä¸­æ‰‹åŠ¨ç»´æŠ¤ç›®å½•åˆ—è¡¨ï¼Œä½†æ˜¯å½“ç›®å½•æ•°é‡è¶…è¿‡ä¸€ç™¾ä¸ªæ—¶ï¼Œæ‰‹åŠ¨ç¼–è¾‘å°±å˜å¾—å®¹æ˜“å‡ºé”™ä¸”ä»¤äººåŽŒçƒ¦ã€‚æ­¤æ—¶ï¼Œè°¨æ…Žçš„åšæ³•å¯èƒ½æ˜¯ä½¿ç”¨<em class="command">find</em>æ¥æ‰«æè¿™äº›ç›®å½•ï¼š<em class="filename"></em><em class="filename"></em><em class="command"></em></p><p>As we will see in later examples, the <code class="literal">PACKAGE_DIRS</code> variable has uses other than
          simply building the <em class="filename">all.javas</em>
          file. But maintaining this variables can be a labor-intensive, and
          potentially difficult, step. For smaller projects, the list of
          directories can be maintained by hand in the <em class="filename">makefile</em>, but when the number grows
          beyond a hundred directories, hand editing becomes error-prone and
          irksome. At this point, it might be prudent to use <em class="command">find</em> to scan for these directories:</p><a id="OEBPS/ch09s03.html.I_4_tt404"></a><pre class="programlisting"># $(è°ƒç”¨ find-compilation-dirs, æ ¹ç›®å½•)
æŸ¥æ‰¾ç¼–è¯‘ç›®å½•= \
  $(patsubst %/,%, \
    $(æŽ’åº\
      $(ç›®å½•\
        $(shell $(FIND) $1 -name '*.java'))))

PACKAGE_DIRS := $(è°ƒç”¨ find-compilation-dirs, $(SOURCE_DIR))</pre><pre class="programlisting"># $(call find-compilation-dirs, root-directory)
find-compilation-dirs =                       \
  $(patsubst %/,%,                            \
    $(sort                                    \
      $(dir                                   \
        $(shell $(FIND) $1 -name '*.java'))))

PACKAGE_DIRS := $(call find-compilation-dirs, $(SOURCE_DIR))</pre><p>findå‘½ä»¤è¿”å›žæ–‡ä»¶åˆ—è¡¨ï¼Œä¸¢å¼ƒæ–‡ä»¶åªç•™ä¸‹ç›®å½•ï¼Œ<em class="command">ä»Ž</em>åˆ—è¡¨ä¸­åˆ é™¤é‡å¤é¡¹ï¼Œå¹¶åŽ»æŽ‰å°¾éƒ¨æ–œæ ã€‚è¯·æ³¨æ„ï¼ŒæŸ¥æ‰¾è¦ç¼–è¯‘çš„æ–‡ä»¶åˆ—è¡¨æ—¶ï¼Œä»…ä¸¢å¼ƒæ–‡ä»¶åï¼Œç„¶åŽ<em class="filename">all.javas</em>è§„åˆ™ä½¿ç”¨é€šé…ç¬¦æ¥æ¢å¤æ–‡ä»¶åã€‚è¿™çœ‹èµ·æ¥å¾ˆæµªè´¹ï¼Œä½†æˆ‘ç»å¸¸å‘çŽ°åŒ…å«æºä»£ç çš„åŒ…åˆ—è¡¨åœ¨æž„å»ºçš„å…¶ä»–éƒ¨åˆ†éžå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚æ‰«æ EJB é…ç½®æ–‡ä»¶ã€‚å¦‚æžœæ‚¨çš„æƒ…å†µä¸éœ€è¦åŒ…åˆ—è¡¨ï¼Œé‚£ä¹ˆè¯·åŠ¡å¿…ä½¿ç”¨å‰é¢æåˆ°çš„æ›´ç®€å•çš„æ–¹æ³•ä¹‹ä¸€æ¥æž„å»º<em class="filename">all.javas</em>ã€‚<code class="function">dir</code><code class="function">sort</code><code class="function">patsubst</code><code class="function">find-compilation-dirs</code><em class="filename"></em><em class="filename"></em></p><p>The <em class="command">find</em> command returns a
          list of files, <code class="function">dir</code> discards the
          file leaving only the directory, <code class="function">sort</code> removes duplicates from the list,
          and <code class="function">patsubst</code> strips the
          trailing slash. Notice that <code class="function">find-compilation-dirs</code> finds the list of
          files to compile, only to discard the filenames, then the <em class="filename">all.javas</em> rule uses wildcards to restore
          the filenames. This seems wasteful, but I have often found that a
          list of the packages containing source code is very useful in other
          parts of the build, for instance to scan for EJB configuration
          files. If your situation does not require a list of packages, then
          by all means use one of the simpler methods previously mentioned to
          build <em class="filename">all.javas</em>.</p></div><div class="sect2" title="ä½¿ç”¨ä¾èµ–é¡¹è¿›è¡Œç¼–è¯‘"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch09s03.html.make3-CHP-9-SECT-3.2"></a>ä½¿ç”¨ä¾èµ–é¡¹è¿›è¡Œç¼–è¯‘</h2><h2 class="title"><a></a>Compiling with Dependencies</h2></div></div></div><p>ä»¥å®Œå…¨ä¾èµ–çš„æ–¹å¼ç¼–è¯‘<a id="OEBPS/ch09s03.html.make3-CHP-9-ITERM-1496" class="indexterm"></a> <a id="OEBPS/ch09s03.html.make3-CHP-9-ITERM-1497" class="indexterm"></a>æ£€æŸ¥æ—¶ï¼Œæ‚¨é¦–å…ˆéœ€è¦ä¸€ä¸ªå·¥å…·æ¥ä»Ž Java æºæ–‡ä»¶ä¸­æå–ä¾èµ–å…³ç³»ä¿¡æ¯ï¼Œç±»ä¼¼äºŽ
          <code class="literal">cc -M</code>. Jikes ( <a class="ulink" href="http://www.ibm.com/developerworks/opensource/jikes">http://www.ibm.com/developerworks/opensource/jikes</a> ) æ˜¯ä¸€ä¸ªå¼€æº Java ç¼–è¯‘å™¨ï¼Œå®ƒé€šè¿‡
          <code class="option">-makefile</code>æˆ–<code class="option">+M</code>é€‰é¡¹æ”¯æŒæ­¤åŠŸèƒ½ã€‚ Jikes å¯¹äºŽå•ç‹¬çš„æºä»£ç å’ŒäºŒè¿›åˆ¶ç¼–è¯‘æ¥è¯´å¹¶ä¸ç†æƒ³ï¼Œå› ä¸ºå®ƒæ€»æ˜¯å°†ä¾èµ–æ–‡ä»¶å†™å…¥ä¸Žæºæ–‡ä»¶ç›¸åŒçš„ç›®å½•ä¸­ï¼Œä½†å®ƒæ˜¯å…è´¹æä¾›çš„å¹¶ä¸”å¯ä»¥å·¥ä½œã€‚ä»Žå¥½çš„æ–¹é¢æ¥è¯´ï¼Œå®ƒåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆä¾èµ–æ–‡ä»¶ï¼Œé¿å…äº†å•ç‹¬çš„ä¼ é€’ã€‚</p><p>To compile with full dependency <a class="indexterm"></a> <a class="indexterm"></a>checking, you first need a tool to extract dependency
          information from the Java source files, something similar to
          <code class="literal">cc -M</code>. Jikes (<a class="ulink" href="http://www.ibm.com/developerworks/opensource/jikes">http://www.ibm.com/developerworks/opensource/jikes</a>)
          is an open source Java compiler that supports this feature with the
          <code class="option">-makefile</code> or <code class="option">+M</code> option. Jikes is
          not ideal for separate source and binary compilation because it
          always writes the dependency file in the same directory as the
          source file, but it is freely available and it works. On the plus
          side, it generates the dependency file while compiling, avoiding a
          separate pass.</p><p>è¿™æ˜¯ä¸€ä¸ªä¾èµ–å¤„ç†å‡½æ•°å’Œä½¿ç”¨å®ƒçš„è§„åˆ™ï¼š</p><p>Here is a dependency processing function and a rule to use
          it:</p><a id="OEBPS/ch09s03.html.I_4_tt405"></a><pre class="programlisting">%.class: %.java
        $(JAVAC) $(JFLAGS) +M $&lt;
        $(è°ƒç”¨ java-process-depend,$&lt;,$@)

# $(è°ƒç”¨ java-process-depend, æºæ–‡ä»¶, å¯¹è±¡æ–‡ä»¶)
å®šä¹‰javaè¿›ç¨‹ä¾èµ–
  $(SED) -e 's/^.*\.class *:/$2 $(subst .class,.d,$2):/' \
         $(subst .java,.u,$1) &gt; $(subst .class,.tmp,$2)
  $(SED) -e 's/#.*//' \
         -e 's/^[^:]*: *//' \
         -e's/*\\$$$$//'\
         -e '/^$$$$/ d' \
         -e 's/$$$$/ :/' $(subst .class,.tmp,$2) \
         &gt;&gt; $(subst .class,.tmp,$2)
  $(MV) $(subst .class,.tmp,$2).tmp $(subst .class,.d,$2)
æ©å¾·å¤«</pre><pre class="programlisting">%.class: %.java
        $(JAVAC) $(JFLAGS) +M $&lt;
        $(call java-process-depend,$&lt;,$@)

# $(call java-process-depend, source-file, object-file)
define java-process-depend
  $(SED) -e 's/^.*\.class *:/$2 $(subst .class,.d,$2):/'   \
         $(subst .java,.u,$1) &gt; $(subst .class,.tmp,$2)
  $(SED) -e 's/#.*//'                                      \
         -e 's/^[^:]*: *//'                                \
         -e 's/ *\\$$$$//'                                 \
         -e '/^$$$$/ d'                                    \
         -e 's/$$$$/ :/' $(subst .class,.tmp,$2)           \
         &gt;&gt;  $(subst .class,.tmp,$2)
  $(MV) $(subst .class,.tmp,$2).tmp  $(subst .class,.d,$2)
endef</pre><p>è¿™è¦æ±‚<em class="filename">makefile</em>ä»ŽäºŒå‰æ ‘æ‰§è¡Œï¼Œå¹¶è®¾ç½®<code class="literal">vpath</code>ä¸ºæŸ¥æ‰¾æºã€‚å¦‚æžœæ‚¨åªæƒ³ä½¿ç”¨ Jikes ç¼–è¯‘å™¨ç”Ÿæˆä¾èµ–é¡¹ï¼Œè€Œä½¿ç”¨ä¸åŒçš„ç¼–è¯‘å™¨æ¥ç”Ÿæˆå®žé™…ä»£ç ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¯¥<code class="option">+B</code>é€‰é¡¹æ¥é˜»æ­¢ Jikes ç”Ÿæˆå­—èŠ‚ç ã€‚</p><p>This requires that the <em class="filename">makefile</em> be executed from the binary tree
          and that the <code class="literal">vpath</code> be set to find
          the source. If you want to use the Jikes compiler only for
          dependency generation, resorting to a different compiler for actual
          code generation, you can use the <code class="option">+B</code> option to
          prevent Jikes from generating bytecodes.</p><p>åœ¨ç¼–è¯‘ 223 ä¸ª Java æ–‡ä»¶çš„ç®€å•è®¡æ—¶æµ‹è¯•ä¸­ï¼Œå‰é¢æè¿°çš„å¿«é€Ÿæ–¹æ³•å•è¡Œç¼–è¯‘åœ¨æˆ‘çš„æœºå™¨ä¸Šéœ€è¦ 9.9 ç§’ã€‚ä½¿ç”¨å•ç‹¬çš„ç¼–è¯‘è¡Œç¼–è¯‘ç›¸åŒçš„ 223 ä¸ªæ–‡ä»¶éœ€è¦ 411.6 ç§’ï¼Œå³ 41.5 å€ã€‚æ­¤å¤–ï¼Œé€šè¿‡å•ç‹¬ç¼–è¯‘ï¼Œä»»ä½•éœ€è¦ç¼–è¯‘å››ä¸ªä»¥ä¸Šæ–‡ä»¶çš„æž„å»ºéƒ½æ¯”ä½¿ç”¨å•ä¸ªç¼–è¯‘è¡Œç¼–è¯‘æ‰€æœ‰æºæ–‡ä»¶è¦æ…¢ã€‚å¦‚æžœä¾èµ–é¡¹ç”Ÿæˆå’Œç¼–è¯‘ç”±å•ç‹¬çš„ç¨‹åºæ‰§è¡Œï¼Œåˆ™å·®å¼‚å°†ä¼šå¢žåŠ ã€‚</p><p>In a simple timing test compiling 223 Java files, the single
          line compile described previously as the fast approach required 9.9
          seconds on my machine. The same 223 files compiled with individual
          compilation lines required 411.6 seconds or 41.5 times longer.
          Furthermore, with separate compilation, any build that required
          compiling more than four files was slower than compiling all the
          source files with a single compile line. If the dependency
          generation and compilation were performed by separate programs, the
          discrepancy would increase.</p><p>å½“ç„¶ï¼Œå¼€å‘çŽ¯å¢ƒä¼šæœ‰æ‰€ä¸åŒï¼Œä½†ä»”ç»†è€ƒè™‘æ‚¨çš„ç›®æ ‡å¾ˆé‡è¦ã€‚æœ€å¤§é™åº¦åœ°å‡å°‘ç¼–è¯‘æ–‡ä»¶çš„æ•°é‡å¹¶ä¸æ€»æ˜¯èƒ½æœ€å¤§é™åº¦åœ°ç¼©çŸ­æž„å»ºç³»ç»Ÿæ‰€éœ€çš„æ—¶é—´ã€‚ç‰¹åˆ«æ˜¯å¯¹äºŽ Javaï¼Œå®Œæ•´çš„ä¾èµ–æ€§æ£€æŸ¥å’Œæœ€å°åŒ–ç¼–è¯‘æ–‡ä»¶çš„æ•°é‡å¯¹äºŽæ­£å¸¸çš„ç¨‹åºå¼€å‘æ¥è¯´ä¼¼ä¹Žå¹¶ä¸æ˜¯å¿…éœ€çš„ã€‚</p><p>Of course, development environments vary, but it is important
          to carefully consider your goals. Minimizing the number of files
          compiled will not always minimize the time it takes to build a
          system. For Java in particular, full dependency checking and
          minimizing the number of files compiled does not appear to be
          necessary for normal program development.</p></div><div class="sect2" title="è®¾ç½®ç±»è·¯å¾„"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch09s03.html.make3-CHP-9-SECT-3.3"></a>è®¾ç½®ç±»è·¯å¾„</h2><h2 class="title"><a></a>Setting CLASSPATH</h2></div></div></div><p>æœ€é‡è¦çš„é—®é¢˜ä¹‹ä¸€<a id="OEBPS/ch09s03.html.make3-CHP-9-ITERM-1498" class="indexterm"></a> <a id="OEBPS/ch09s03.html.make3-CHP-9-ITERM-1499" class="indexterm"></a> <a id="OEBPS/ch09s03.html.make3-CHP-9-ITERM-1500" class="indexterm"></a>ä½¿ç”¨ Java å¼€å‘è½¯ä»¶æ—¶æ­£ç¡®è®¾ç½®
          <code class="literal">CLASSPATH</code>å˜é‡ã€‚è¯¥å˜é‡ç¡®å®šè§£æžç±»å¼•ç”¨æ—¶åŠ è½½å“ªäº›ä»£ç ã€‚è¦æ­£ç¡®ç¼–è¯‘ Java åº”ç”¨ç¨‹åºï¼Œ<em class="filename">makefile</em>å¿…é¡»åŒ…å«æ­£ç¡®çš„<code class="literal">CLASSPATH</code>.<code class="literal">CLASSPATH</code>éšç€ Java åŒ…ã€API å’Œæ”¯æŒå·¥å…·è¢«æ·»åŠ åˆ°ç³»ç»Ÿä¸­ï¼Œå®ƒä»¬å¾ˆå¿«å°±ä¼šå˜å¾—åˆé•¿åˆå¤æ‚ã€‚å¦‚æžœ<code class="literal">CLASSPATH</code>å¾ˆéš¾æ­£ç¡®è®¾ç½®ï¼Œåˆ™å°†å…¶è®¾ç½®åœ¨ä¸€å¤„æ˜¯æœ‰æ„ä¹‰çš„ã€‚</p><p>One of the most important issues <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>when developing software with Java is setting the
          <code class="literal">CLASSPATH</code> variable correctly.
          This variable determines which code is loaded when a class reference
          is resolved. To compile a Java application correctly, the <em class="filename">makefile</em> must include the proper <code class="literal">CLASSPATH</code>. The <code class="literal">CLASSPATH</code> can quickly become long and
          complex as Java packages, APIs, and support tools are added to a
          system. If the <code class="literal">CLASSPATH</code> can be
          difficult to set properly, it makes sense to set it in one
          place.</p><p>æˆ‘å‘çŽ°æœ‰ç”¨çš„ä¸€é¡¹æŠ€æœ¯æ˜¯ä½¿ç”¨<em class="filename">makefile</em>æ¥è®¾ç½®<code class="literal">CLASSPATH</code>è‡ªèº«å’Œå…¶ä»–ç¨‹åºã€‚ä¾‹å¦‚ï¼Œç›®æ ‡<code class="literal">classpath</code>
          å¯ä»¥å°†è°ƒç”¨<em class="filename">makefile</em><code class="literal">CLASSPATH</code>è¿”å›žåˆ° shell ï¼š<em class="filename"></em></p><p>A technique I've found useful is to use the <em class="filename">makefile</em> to set the <code class="literal">CLASSPATH</code> for itself and other programs.
          For instance, a target <code class="literal">classpath</code>
          can return the <code class="literal">CLASSPATH</code> to the
          shell invoking the <em class="filename">makefile</em>:</p><a id="OEBPS/ch09s03.html.I_4_tt406"></a><pre class="programlisting">.PHONYï¼šç±»è·¯å¾„
ç±»è·¯å¾„ï¼š
        @echoâ€œå¯¼å‡º CLASSPATH='$(CLASSPATH)'â€</pre><pre class="programlisting">.PHONY: classpath
classpath:
        @echo "export CLASSPATH='$(CLASSPATH)'"</pre><p>å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨<code class="literal">CLASSPATH</code>æ­¤è®¾ç½®ï¼ˆå¦‚æžœä»–ä»¬ä½¿ç”¨<em class="command">bash</em>ï¼‰ï¼š</p><p>Developers can set their <code class="literal">CLASSPATH</code> with this (if they use <em class="command">bash</em>):</p><a id="OEBPS/ch09s03.html.I_4_tt407"></a><pre class="programlisting">$ eval $(åˆ›å»ºç±»è·¯å¾„)</pre><pre class="programlisting">$ eval $(make classpath)</pre><p><code class="literal">CLASSPATH</code>Windows çŽ¯å¢ƒä¸­çš„ å¯ä»¥é€šè¿‡ä»¥ä¸‹è°ƒç”¨è¿›è¡Œè®¾ç½®ï¼š</p><p>The <code class="literal">CLASSPATH</code> in the
          Windows environment can be set with this invocation:</p><a id="OEBPS/ch09s03.html.I_4_tt408"></a><pre class="programlisting">.PHONYï¼šwindows_classpath
windows_classpathï¼š
        regtool set /user/Environment/CLASSPATH "$(subst /,\\,$(CLASSPATH))"
        æŽ§åˆ¶ sysdm.cpl,@1,3 &amp;
        @echoâ€œçŽ°åœ¨å•å‡»çŽ¯å¢ƒå˜é‡ï¼Œç„¶åŽå•å‡»ç¡®å®šï¼Œç„¶åŽå†æ¬¡å•å‡»ç¡®å®šã€‚â€</pre><pre class="programlisting">.PHONY: windows_classpath
windows_classpath:
        regtool set /user/Environment/CLASSPATH "$(subst /,\\,$(CLASSPATH))"
        control sysdm.cpl,@1,3 &amp;
        @echo "Now click Environment Variables, then OK, then OK again."</pre><p><em class="command">regtool</em>ç¨‹åºæ˜¯ä¸€ä¸ª
          <a id="OEBPS/ch09s03.html.make3-CHP-9-ITERM-1501" class="indexterm"></a> <a id="OEBPS/ch09s03.html.make3-CHP-9-ITERM-1502" class="indexterm"></a>Cygwin å¼€å‘ç³»ç»Ÿä¸­ç”¨äºŽæ“ä½œ Windows æ³¨å†Œè¡¨çš„å®žç”¨ç¨‹åºã€‚ä½†æ˜¯ï¼Œä»…è®¾ç½®æ³¨å†Œè¡¨ä¸ä¼šå¯¼è‡´ Windows è¯»å–æ–°å€¼ã€‚æ‰§è¡Œæ­¤æ“ä½œçš„ä¸€ç§æ–¹æ³•æ˜¯è®¿é—®â€œçŽ¯å¢ƒå˜é‡â€å¯¹è¯æ¡†ï¼Œç„¶åŽå•å‡»â€œç¡®å®šâ€é€€å‡ºã€‚</p><p>The program <em class="command">regtool</em> is a
          <a class="indexterm"></a> <a class="indexterm"></a>utility in the Cygwin development system that
          manipulates the Windows Registry. Simply setting the Registry
          doesn't cause the new values to be read by Windows, however. One way
          to do this is to visit the Environment Variable dialog box and
          simply exit by clicking OK.</p><p>å‘½ä»¤è„šæœ¬çš„ç¬¬äºŒè¡Œä½¿ Windows æ˜¾ç¤ºâ€œç³»ç»Ÿå±žæ€§â€å¯¹è¯æ¡†ï¼Œå…¶ä¸­â€œé«˜çº§â€é€‰é¡¹å¡å¤„äºŽæ´»åŠ¨çŠ¶æ€ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¯¥å‘½ä»¤æ— æ³•æ˜¾ç¤ºâ€œçŽ¯å¢ƒå˜é‡â€å¯¹è¯æ¡†æˆ–æ¿€æ´»â€œç¡®å®šâ€æŒ‰é’®ï¼Œå› æ­¤æœ€åŽä¸€è¡Œæç¤ºç”¨æˆ·å®Œæˆä»»åŠ¡ã€‚</p><p>The second line of the command script causes Windows to
          display the System Properties dialog box with the Advanced tab
          active. Unfortunately, the command cannot display the Environment
          Variables dialog box or activate the OK button, so the last line
          prompts the user to complete the task.</p><p>å°†å…¶å¯¼å‡º<code class="literal">CLASSPATH</code>åˆ°å…¶ä»–ç¨‹åºï¼ˆä¾‹å¦‚ Emacs JDEE æˆ– JBuilder é¡¹ç›®æ–‡ä»¶ï¼‰å¹¶ä¸å›°éš¾ã€‚</p><p>Exporting the <code class="literal">CLASSPATH</code> to
          other programs, such as Emacs JDEE or JBuilder project files, is not
          difficult.</p><p>è®¾ç½®æœ¬èº«ä¹Ÿå¯ä»¥é€šè¿‡<em class="command">make</em><code class="literal">CLASSPATH</code>
          æ¥ç®¡ç†ã€‚ä»¥æ˜Žæ˜¾çš„æ–¹å¼è®¾ç½®å˜é‡å½“ç„¶æ˜¯åˆç†çš„ï¼š<em class="command"></em><code class="literal">CLASSPATH</code></p><p>Setting the <code class="literal">CLASSPATH</code>
          itself can also be managed by <em class="command">make</em>. It is certainly reasonable to set
          the <code class="literal">CLASSPATH</code> variable in the
          obvious way with:</p><a id="OEBPS/ch09s03.html.I_4_tt409"></a><pre class="programlisting">CLASSPATH = /third_party/toplink-2.5/TopLink.jar:/third_party/...</pre><pre class="programlisting">CLASSPATH = /third_party/toplink-2.5/TopLink.jar:/third_party/...</pre><p>ä¸ºäº†å¯ç»´æŠ¤æ€§ï¼Œæœ€å¥½ä½¿ç”¨å˜é‡ï¼š</p><p>For maintainability, using variables is preferred:</p><a id="OEBPS/ch09s03.html.I_4_tt410"></a><pre class="programlisting">ç±»è·¯å¾„ = $(TOPLINK_25_JAR):$(TOPLINKX_25_JAR):...</pre><pre class="programlisting">CLASSPATH = $(TOPLINK_25_JAR):$(TOPLINKX_25_JAR):...</pre><p>ä½†æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ã€‚æ­£å¦‚æ‚¨åœ¨é€šç”¨<em class="filename">makefile</em>ä¸­çœ‹åˆ°çš„
          ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†ä¸¤ä¸ªé˜¶æ®µæž„å»º
          <code class="literal">CLASSPATH</code>ï¼šé¦–å…ˆå°†è·¯å¾„ä¸­çš„å…ƒç´ åˆ—ä¸º<em class="command">make</em>å˜é‡ï¼Œç„¶åŽå°†è¿™äº›å˜é‡è½¬æ¢ä¸ºçŽ¯å¢ƒå˜é‡çš„å­—ç¬¦ä¸²å€¼ï¼š</p><p>But we can do better than this. As you can see in the generic
          <em class="filename">makefile</em>, we can build the
          <code class="literal">CLASSPATH</code> in two stages: first
          list the elements in the path as <em class="command">make</em> variables, then transform those
          variables into the string value of the environment variable:</p><a id="OEBPS/ch09s03.html.I_4_tt411"></a><pre class="programlisting"># è®¾ç½®Javaç±»è·¯å¾„
ç±»è·¯å¾„ := è¾“å‡ºç›®å½• \
              XERCES_JAR \
              COMMONS_LOGGING_JAR \
              LOG4J_JAR \
              JUNIT_JAR
...
# è®¾ç½®ç±»è·¯å¾„
å¯¼å‡º CLASSPATH := $(è°ƒç”¨æž„å»ºç±»è·¯å¾„ï¼Œ$(class_path))</pre><pre class="programlisting"># Set the Java classpath
class_path := OUTPUT_DIR                \
              XERCES_JAR                \
              COMMONS_LOGGING_JAR       \
              LOG4J_JAR                 \
              JUNIT_JAR
...
# Set the CLASSPATH
export CLASSPATH := $(call build-classpath, $(class_path))</pre><p>ï¼ˆ<a class="link" href="#OEBPS/ch09s02.html.make3-CHP-9-EX-1" title="ä¾‹ 9-1ã€‚ Java çš„é€šç”¨ makefile">ç¤ºä¾‹ 9-1</a><code class="literal">CLASSPATH</code>ä¸­çš„æ—¨åœ¨è¯´æ˜Žæ€§å¤šäºŽæœ‰ç”¨æ€§ã€‚ï¼‰ç¼–å†™è‰¯å¥½çš„å‡½æ•°å¯ä»¥è§£å†³å‡ ä¸ªä»¤äººçƒ¦æ¼çš„é—®é¢˜ï¼š<a class="link" href="#OEBPS/ch09s02.html.make3-CHP-9-EX-1" title="ä¾‹ 9-1ã€‚ Java çš„é€šç”¨ makefile"></a><code class="function">build-classpath</code></p><p>(The <code class="literal">CLASSPATH</code> in <a class="link" href="#OEBPS/ch09s02.html.make3-CHP-9-EX-1" title="Example&nbsp;9-1.&nbsp;Generic makefile for Java">Example 9-1</a> is meant to be more
          illustrative than useful.) A well-written <code class="function">build-classpath</code> function solves several
          irritating problems:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">CLASSPATH</code>ç»„æˆä¸€ä¸ªç‰‡æ®µæ˜¯éžå¸¸å®¹æ˜“çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœä½¿ç”¨ä¸åŒçš„åº”ç”¨ç¨‹åºæœåŠ¡å™¨ï¼Œåˆ™<code class="literal">CLASSPATH</code>å¯èƒ½éœ€è¦æ›´æ”¹ã€‚ç„¶åŽå¯ä»¥å°†ä¸åŒç‰ˆæœ¬çš„ç‰ˆæœ¬<code class="literal">CLASSPATH</code>åŒ…å«åœ¨
              å„ä¸ªéƒ¨åˆ†ä¸­ï¼Œå¹¶é€šè¿‡è®¾ç½®<em class="command">make</em><code class="literal">ifdef</code>å˜é‡æ¥é€‰æ‹©
              ã€‚<em class="command"></em></p></li><li class="listitem"><p>It is very easy to compose a <code class="literal">CLASSPATH</code> in pieces. For instance, if
              different applications servers are used, the <code class="literal">CLASSPATH</code> might need to change. The
              different versions of the <code class="literal">CLASSPATH</code> could then be enclosed in
              <code class="literal">ifdef</code> sections and selected
              by setting a <em class="command">make</em>
              variable.</p></li><li class="listitem"><p><em class="filename">makefile</em>çš„ä¸´æ—¶ç»´æŠ¤è€…ä¸å¿…æ‹…å¿ƒåµŒå…¥çš„ç©ºç™½ã€æ¢è¡Œç¬¦æˆ–è¡Œç»§ç»­ï¼Œå› ä¸º
              <code class="function">build-classpath</code>å‡½æ•°ä¼šå¤„ç†å®ƒä»¬ã€‚</p></li><li class="listitem"><p>Casual maintainers of the <em class="filename">makefile</em> do not have to worry about
              embedded blanks, newlines, or line continuation, because the
              <code class="function">build-classpath</code> function
              handles them.</p></li><li class="listitem"><p>è¯¥åŠŸèƒ½å¯ä»¥è‡ªåŠ¨é€‰æ‹©è·¯å¾„åˆ†éš”ç¬¦
              <code class="function">build-classpath</code>ã€‚å› æ­¤ï¼Œæ— è®ºåœ¨Unixè¿˜æ˜¯Windowsä¸Šè¿è¡Œéƒ½æ˜¯æ­£ç¡®çš„ã€‚</p></li><li class="listitem"><p>The path separator can be selected automatically by the
              <code class="function">build-classpath</code> function.
              Thus, it is correct whether run on Unix or Windows.</p></li><li class="listitem"><p>è¯¥å‡½æ•°å¯ä»¥éªŒè¯è·¯å¾„å…ƒç´ çš„æœ‰æ•ˆæ€§
              <code class="function">build-classpath</code>ã€‚ç‰¹åˆ«æ˜¯ï¼Œ<em class="command">make</em>çš„ä¸€ä¸ªä»¤äººæ¼ç«çš„é—®é¢˜æ˜¯æœªå®šä¹‰çš„å˜é‡ä¼šå´©æºƒä¸ºç©ºå­—ç¬¦ä¸²è€Œä¸ä¼šå‡ºçŽ°é”™è¯¯ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™éžå¸¸æœ‰ç”¨ï¼Œä½†æœ‰æ—¶å®ƒä¼šäº§ç”Ÿé˜»ç¢ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä¼šæ‚„æ‚„åœ°ä¸ºå˜é‡ç”Ÿæˆä¸€ä¸ªè™šå‡å€¼<code class="literal">CLASSPATH</code>ã€‚<sup>[ <a id="OEBPS/ch09s03.html.make3-CHP-9-FNOTE-1" href="#OEBPS/ch09s03.html.ftn.make3-CHP-9-FNOTE-1" class="footnote">1</a> ]</sup>æˆ‘ä»¬å¯ä»¥é€šè¿‡è®©<code class="function">build-classpath</code>å‡½æ•°æ£€æŸ¥ç©ºå€¼å…ƒç´ å¹¶è­¦å‘Šæˆ‘ä»¬æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¯¥å‡½æ•°è¿˜å¯ä»¥æ£€æŸ¥æ¯ä¸ªæ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚</p></li><li class="listitem"><p>The validity of path elements can be verified by the
              <code class="function">build-classpath</code> function.
              In particular, one irritating problem with <em class="command">make</em> is that undefined variables
              collapse to the empty string without an error. In most cases
              this is very useful, but occasionally it gets in the way. In
              this case, it quietly yields a bogus value for the <code class="literal">CLASSPATH</code> variable.<sup>[<a href="#OEBPS/ch09s03.html.ftn.make3-CHP-9-FNOTE-1" class="footnote">1</a>]</sup> We can solve this problem by having the <code class="function">build-classpath</code> function check for
              the empty valued elements and warn us. The function can also
              check that each file or directory exists.</p></li><li class="listitem"><p>æœ€åŽï¼Œæ‹¥æœ‰ä¸€ä¸ªå¤„ç† çš„é’©å­<code class="literal">CLASSPATH</code>å¯¹äºŽæ›´é«˜çº§çš„åŠŸèƒ½å¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚å¸®åŠ©å®¹çº³è·¯å¾„åå’Œæœç´¢è·¯å¾„ä¸­çš„åµŒå…¥ç©ºæ ¼ã€‚</p></li><li class="listitem"><p>Finally, having a hook to process the <code class="literal">CLASSPATH</code> can be useful for more
              advanced features, such as help accommodating embedded spaces in
              path names and search paths.</p></li></ul></div><p><code class="function">build-classpath</code>è¿™æ˜¯å¤„ç†å‰ä¸‰ä¸ªé—®é¢˜çš„å®žçŽ°ï¼š</p><p>Here is an implementation of <code class="function">build-classpath</code> that handles the first
          three issues:</p><a id="OEBPS/ch09s03.html.I_4_tt412"></a><pre class="programlisting"># $(è°ƒç”¨æž„å»ºç±»è·¯å¾„ï¼Œå˜é‡åˆ—è¡¨)
å®šä¹‰æž„å»ºç±»è·¯å¾„
$(æ¡\
  $(patsubst %:,%, \
    $(æ›¿æ¢:,:,\
      $(æ¡\
        $(foreach c,$1,$(è°ƒç”¨ get-file,$c):)))))
æ©å¾·å¤«

# $(è°ƒç”¨ get-file, å˜é‡å)
å®šä¹‰èŽ·å–æ–‡ä»¶
  $(æ¡\
    $($1) \
    $(å¦‚æžœ$(è°ƒç”¨æ–‡ä»¶å­˜åœ¨-eval,$1),, \
      $(è­¦å‘Šå˜é‡å¼•ç”¨çš„æ–‡ä»¶\
                æ‰¾ä¸åˆ°â€œ$1â€ï¼ˆ$(â€‹â€‹$1))ï¼‰ï¼‰ï¼‰
æ©å¾·å¤«

# $(è°ƒç”¨æ–‡ä»¶å­˜åœ¨è¯„ä¼°ï¼Œå˜é‡åç§°)
å®šä¹‰æ–‡ä»¶å­˜åœ¨è¯„ä¼°
  $(æ¡\
    $(å¦‚æžœ $($1),,$(è­¦å‘Š '$1' æ²¡æœ‰å€¼)) \
    $(é€šé…ç¬¦$($1)))
æ©å¾·å¤«</pre><pre class="programlisting"># $(call build-classpath, variable-list)
define build-classpath
$(strip                                          \
  $(patsubst %:,%,                               \
    $(subst : ,:,                                \
      $(strip                                    \
        $(foreach c,$1,$(call get-file,$c):)))))
endef

# $(call get-file, variable-name)
define get-file
  $(strip                                       \
    $($1)                                       \
    $(if $(call file-exists-eval,$1),,          \
      $(warning The file referenced by variable \
                '$1' ($($1)) cannot be found)))
endef

# $(call file-exists-eval, variable-name)
define file-exists-eval
  $(strip                                        \
    $(if $($1),,$(warning '$1' has no value))    \
    $(wildcard $($1)))
endef</pre><p>è¿™<code class="function">build-classpath</code>
          <a id="OEBPS/ch09s03.html.make3-CHP-9-ITERM-1503" class="indexterm"></a> <a id="OEBPS/ch09s03.html.make3-CHP-9-ITERM-1504" class="indexterm"></a>å‡½æ•°è¿­ä»£å…¶å‚æ•°ä¸­çš„å•è¯ï¼ŒéªŒè¯æ¯ä¸ªå…ƒç´ å¹¶å°†å®ƒä»¬ä¸Žè·¯å¾„åˆ†éš”ç¬¦ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸ºï¼šï¼‰è¿žæŽ¥èµ·æ¥ã€‚çŽ°åœ¨è‡ªåŠ¨é€‰æ‹©è·¯å¾„åˆ†éš”ç¬¦å¾ˆå®¹æ˜“ã€‚ç„¶åŽï¼Œè¯¥å‡½æ•°ä¼šåŽ»é™¤<code class="function">get-file</code>å‡½æ•°å’Œ
          <code class="function">foreach</code>å¾ªçŽ¯æ·»åŠ çš„ç©ºæ ¼ã€‚æŽ¥ä¸‹æ¥ï¼Œå®ƒåˆ é™¤ foreach å¾ªçŽ¯æ·»åŠ çš„æœ€ç»ˆåˆ†éš”ç¬¦ã€‚æœ€åŽï¼Œæ•´ä¸ªå†…å®¹è¢«åŒ…è£¹åœ¨ä¸€ä¸ª<code class="function">strip</code>ç”±è¡Œå»¶ç»­å¼•å…¥çš„é”™è¯¯ç©ºæ ¼ä¸­è¢«åˆ é™¤ã€‚</p><p>The <code class="function">build-classpath</code>
          <a class="indexterm"></a> <a class="indexterm"></a>function iterates through the words in its argument,
          verifying each element and concatenating them with the path
          separator (: in this case). Selecting the path separator
          automatically is easy now. The function then strips spaces added by
          the <code class="function">get-file</code> function and
          <code class="function">foreach</code> loop. Next, it strips
          the final separator added by the foreach loop. Finally, the whole
          thing is wrapped in a <code class="function">strip</code> so
          errant spaces introduced by line continuation are removed.</p><p>è¯¥<code class="function">get-file</code>å‡½æ•°è¿”å›žå…¶æ–‡ä»¶åå‚æ•°ï¼Œç„¶åŽæµ‹è¯•è¯¥å˜é‡æ˜¯å¦å¼•ç”¨çŽ°æœ‰æ–‡ä»¶ã€‚å¦‚æžœä¸å­˜åœ¨ï¼Œåˆ™ä¼šç”Ÿæˆè­¦å‘Šã€‚æ— è®ºæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå®ƒéƒ½ä¼šè¿”å›žå˜é‡çš„å€¼ï¼Œå› ä¸ºè¯¥å€¼å¯èƒ½å¯¹è°ƒç”¨è€…æœ‰ç”¨ã€‚æœ‰æ—¶ï¼Œ
          <code class="function">get-file</code>å¯èƒ½ä¸Žå°†è¦ç”Ÿæˆä½†å°šä¸å­˜åœ¨çš„æ–‡ä»¶ä¸€èµ·ä½¿ç”¨ã€‚</p><p>The <code class="function">get-file</code> function
          returns its filename argument, then tests whether the variable
          refers to an existing file. If it does not, it generates a warning.
          It returns the value of the variable regardless of the existence of
          the file because the value may be useful to the caller. On occasion,
          <code class="function">get-file</code> may be used with a
          file that will be generated, but does not yet exist.</p><p>æœ€åŽä¸€ä¸ªå‡½æ•°<code class="function">file-exists-eval</code>æŽ¥å—åŒ…å«æ–‡ä»¶å¼•ç”¨çš„å˜é‡åã€‚å¦‚æžœå˜é‡ä¸ºç©ºï¼Œåˆ™å‘å‡ºè­¦å‘Šï¼›å¦åˆ™ï¼Œè¯¥<code class="function">wildcard</code>
          å‡½æ•°ç”¨äºŽå°†å€¼è§£æžä¸ºæ–‡ä»¶ï¼ˆæˆ–ä¸Žæ­¤ç›¸å…³çš„æ–‡ä»¶åˆ—è¡¨ï¼‰ã€‚</p><p>The last function, <code class="function">file-exists-eval</code>, accepts a variable name
          containing a file reference. If the variable is empty, a warning is
          issued; otherwise, the <code class="function">wildcard</code>
          function is used to resolve the value into a file (or a list of
          files for that matter).</p><p>å½“è¯¥<code class="function">build-classpath</code>
          å‡½æ•°ä¸Žä¸€äº›åˆé€‚çš„è™šå‡å€¼ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä»¥ä¸‹é”™è¯¯ï¼š</p><p>When the <code class="function">build-classpath</code>
          function is used with some suitable bogus values, we see these
          errors:</p><a id="OEBPS/ch09s03.html.I_4_tt413"></a><pre class="programlisting">Makefile:37: å˜é‡â€œTOPLINKX_25_JARâ€å¼•ç”¨çš„æ–‡ä»¶
             æ‰¾ä¸åˆ°ï¼ˆ/usr/java/toplink-2.5/TopLinkX.jarï¼‰
...
Makefile:37: 'XERCES_142_JAR' æ²¡æœ‰å€¼
Makefile:37: å˜é‡å¼•ç”¨çš„æ–‡ä»¶
             æ‰¾ä¸åˆ°â€œXERCES_142_JARâ€( )</pre><pre class="programlisting">Makefile:37: The file referenced by variable 'TOPLINKX_25_JAR'
             (/usr/java/toplink-2.5/TopLinkX.jar) cannot be found
...
Makefile:37: 'XERCES_142_JAR' has no value
Makefile:37: The file referenced by variable
             'XERCES_142_JAR' ( ) cannot be found</pre><p>ä¸Žæˆ‘ä»¬é€šè¿‡ç®€å•æ–¹æ³•èŽ·å¾—çš„æ²‰é»˜ç›¸æ¯”ï¼Œè¿™ä»£è¡¨äº†ä¸€ä¸ªå·¨å¤§çš„æ”¹è¿›ã€‚</p><p>This represents a great improvement over the silence we would
          get from the simple approach.</p><p>è¯¥å‡½æ•°çš„å­˜åœ¨<code class="function">get-file</code>è¡¨æ˜Žæˆ‘ä»¬å¯ä»¥æ¦‚æ‹¬è¾“å…¥æ–‡ä»¶çš„æœç´¢ã€‚</p><p>The existence of the <code class="function">get-file</code> function suggests that we could
          generalize the search for input files.</p><a id="OEBPS/ch09s03.html.I_4_tt414"></a><pre class="programlisting"># $(è°ƒç”¨ get-jar, å˜é‡å)
å®šä¹‰ get-jar
  $(æ¡\
    $(å¦‚æžœ $($1),,$(è­¦å‘Š '$1' ä¸ºç©º)) \
    $(å¦‚æžœ $(JAR_PATH),,$(è­¦å‘Š JAR_PATH ä¸ºç©º)) \
    $(foreach d, $(dir $($1)) $(JAR_PATH), \
      $(if $(é€šé…ç¬¦ $d/$(notdir $($1))), \
        $(å¦‚æžœ $(get-jar-return),, \
          $(eval get-jar-return := $d/$(notdir $($1)))))) \
    $(å¦‚æžœ$(get-jar-return), \
      $(get-jar-return) \
      $(eval get-jar-return :=), \
      $($1) \
      $(è­¦å‘Š get-jar: åœ¨ $(JAR_PATH)) ä¸­æœªæ‰¾åˆ°æ–‡ä»¶â€œ$1â€))
æ©å¾·å¤«</pre><pre class="programlisting"># $(call get-jar, variable-name)
define get-jar
  $(strip                                                     \
    $(if $($1),,$(warning '$1' is empty))                     \
    $(if $(JAR_PATH),,$(warning JAR_PATH is empty))           \
    $(foreach d, $(dir $($1)) $(JAR_PATH),                    \
      $(if $(wildcard $d/$(notdir $($1))),                    \
        $(if $(get-jar-return),,                              \
          $(eval get-jar-return := $d/$(notdir $($1))))))     \
    $(if $(get-jar-return),                                   \
      $(get-jar-return)                                       \
      $(eval get-jar-return :=),                              \
      $($1)                                                   \
      $(warning get-jar: File not found '$1' in $(JAR_PATH))))
endef</pre><p>è¿™é‡Œæˆ‘ä»¬å®šä¹‰å˜é‡<code class="literal">JAR_PATH</code>æ¥åŒ…å«æ–‡ä»¶çš„æœç´¢è·¯å¾„ã€‚è¿”å›žæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚è¯¥å‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªåŒ…å« jar è·¯å¾„çš„å˜é‡åã€‚æˆ‘ä»¬å¸Œæœ›é¦–å…ˆåœ¨å˜é‡ç»™å®šçš„è·¯å¾„ä¸­æŸ¥æ‰¾ jar æ–‡ä»¶ï¼Œç„¶åŽåœ¨<code class="literal">JAR_PATH</code>.jaræ–‡ä»¶ä¸­æŸ¥æ‰¾ã€‚ä¸ºäº†å®žçŽ°è¿™ä¸€ç‚¹ï¼Œå¾ªçŽ¯ä¸­çš„ç›®å½•åˆ—è¡¨<code class="function">foreach</code>ç”±å˜é‡ä¸­çš„ç›®å½•ç»„æˆï¼ŒåŽè·Ÿ<code class="literal">JAR_PATH</code>.è¯¥å‚æ•°çš„å…¶ä»–ä¸¤ç§ç”¨æ³•åŒ…å«åœ¨<code class="function">notdir</code>è°ƒç”¨ä¸­ï¼Œå› æ­¤ jar åç§°å¯ä»¥ä»Žæ­¤åˆ—è¡¨ä¸­çš„è·¯å¾„ç»„æˆã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ— æ³•é€€å‡ºå¾ªçŽ¯<code class="function">foreach</code>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨<code class="function">eval</code>è®¾ç½®ä¸€ä¸ªå˜é‡<code class="literal">get-jar-return</code>æ¥è®°ä½æˆ‘ä»¬æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚å¾ªçŽ¯ç»“æŸåŽï¼Œæˆ‘ä»¬è¿”å›žä¸´æ—¶å˜é‡çš„å€¼ï¼Œæˆ–è€…å¦‚æžœæ²¡æœ‰æ‰¾åˆ°ä»»ä½•å†…å®¹ï¼Œåˆ™å‘å‡ºè­¦å‘Šã€‚æˆ‘ä»¬å¿…é¡»è®°ä½åœ¨ç»ˆæ­¢å®ä¹‹å‰é‡ç½®è¿”å›žå€¼å˜é‡ã€‚</p><p>Here we define the variable <code class="literal">JAR_PATH</code> to contain a search path for
          files. The first file found is returned. The parameter to the
          function is a variable name containing the path to a jar. We want to
          look for the jar file first in the path given by the variable, then
          in the <code class="literal">JAR_PATH</code>. To accomplish
          this, the directory list in the <code class="function">foreach</code> loop is composed of the directory
          from the variable, followed by the <code class="literal">JAR_PATH</code>. The two other uses of the
          parameter are enclosed in <code class="function">notdir</code> calls so the jar name can be
          composed from a path from this list. Notice that we cannot exit from
          a <code class="function">foreach</code> loop. Instead,
          therefore, we use <code class="function">eval</code> to set a
          variable, <code class="literal">get-jar-return</code>, to
          remember the first file we found. After the loop, we return the
          value of our temporary variable or issue a warning if nothing was
          found. We must remember to reset our return value variable before
          terminating the macro.</p><p>è¿™æœ¬è´¨ä¸Šæ˜¯<code class="literal">vpath</code>åœ¨è®¾ç½®<code class="literal">CLASSPATH</code>.è¦ç†è§£è¿™ä¸€ç‚¹ï¼Œè¯·å›žæƒ³ä¸€ä¸‹ï¼Œè¿™æ˜¯<em class="command">make</em><code class="literal">vpath</code>éšå¼ä½¿ç”¨çš„æœç´¢è·¯å¾„ï¼Œç”¨äºŽæŸ¥æ‰¾æ— æ³•é€šè¿‡ç›¸å¯¹è·¯å¾„ä»Žå½“å‰ç›®å½•æ‰¾åˆ°çš„å…ˆå†³æ¡ä»¶ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œ
           <em class="command">make</em>æœç´¢å…ˆå†³æ¡ä»¶æ–‡ä»¶å¹¶å°†å®Œæ•´çš„è·¯å¾„æ’å…¥åˆ°ã€å’Œè‡ªåŠ¨å˜é‡ä¸­ã€‚ä¸ºäº†è®¾ç½®ï¼Œæˆ‘ä»¬å¸Œæœ›
          <em class="command">make</em>æœç´¢æ¯ä¸ª jar æ–‡ä»¶çš„è·¯å¾„å¹¶å°†å®Œæ•´çš„è·¯å¾„æ’å…¥åˆ°å˜é‡ä¸­ã€‚ç”±äºŽ<em class="command">make</em>å¯¹æ­¤æ²¡æœ‰å†…ç½®æ”¯æŒï¼Œå› æ­¤æˆ‘ä»¬æ·»åŠ äº†è‡ªå·±çš„æ”¯æŒã€‚å½“ç„¶ï¼Œæ‚¨å¯ä»¥ç®€å•åœ°ä½¿ç”¨é€‚å½“çš„ jar æ–‡ä»¶åæ‰©å±• jar è·¯å¾„å˜é‡ï¼Œç„¶åŽè®© Java è¿›è¡Œæœç´¢ï¼Œä½†å¾ˆå¿«å°±ä¼šå˜å¾—å¾ˆé•¿ã€‚åœ¨æŸäº›æ“ä½œç³»ç»Ÿä¸Šï¼ŒçŽ¯å¢ƒå˜é‡ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œlongå­˜åœ¨è¢«æˆªæ–­çš„å±é™©ã€‚åœ¨ Windows XP ä¸Šï¼Œå•ä¸ªçŽ¯å¢ƒå˜é‡çš„é•¿åº¦é™åˆ¶ä¸º 1023 ä¸ªå­—ç¬¦ã€‚å¦å¤–ï¼Œå³ä½¿ä¸è¢«æˆªæ–­ï¼ŒJavaè™šæ‹Ÿæœºåœ¨åŠ è½½ç±»æ—¶ä¹Ÿå¿…é¡»æœç´¢theï¼Œä»Žè€Œå‡æ…¢åº”ç”¨ç¨‹åºçš„é€Ÿåº¦ã€‚<em class="command"></em><em class="command"></em><code class="literal">vpath</code><code class="literal">$^</code><code class="literal">$?</code><code class="literal">$+</code><code class="literal">CLASSPATH</code><em class="command"></em><code class="literal">CLASSPATH</code><em class="command"></em><code class="literal">CLASSPATH</code><code class="literal">CLASSPATH</code><code class="literal">CLASSPATH</code><code class="literal">CLASSPATH</code></p><p>This is essentially reimplementing the <code class="literal">vpath</code> feature in the context of setting
          the <code class="literal">CLASSPATH</code>. To understand
          this, recall that the <code class="literal">vpath</code> is a
          search path used implicitly by <em class="command">make</em> to find prerequisites that cannot be
          found from the current directory by a relative path. In these cases,
          <em class="command">make</em> searches the <code class="literal">vpath</code> for the prerequisite file and
          inserts the completed path into the <code class="literal">$^</code>, <code class="literal">$?</code>,
          and <code class="literal">$+</code> automatic variables. To
          set the <code class="literal">CLASSPATH</code>, we want
          <em class="command">make</em> to search a path for each
          jar file and insert the completed path into the <code class="literal">CLASSPATH</code> variable. Since <em class="command">make</em> has no built-in support for this,
          we've added our own. You could, of course, simply expand the jar
          path variable with the appropriate jar filenames and let Java do the
          searching, but <code class="literal">CLASSPATH</code>s already
          get long quickly. On some operating systems, environment variable
          space is limited and long <code class="literal">CLASSPATH</code>s are in danger of being
          truncated. On Windows XP, there is a limit of 1023 characters for a
          single environment variable. In addition, even if the <code class="literal">CLASSPATH</code> is not truncated, the Java
          virtual machine must search the <code class="literal">CLASSPATH</code> when loading classes, thus
          slowing down the application.</p></div><div class="footnotes"><br><br><hr><div class="footnote"><p><sup>[ <a id="OEBPS/ch09s03.html.ftn.make3-CHP-9-FNOTE-1" href="#OEBPS/ch09s03.html.make3-CHP-9-FNOTE-1" class="para">1</a> ]</sup>æˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨è¯¥
                  <code class="option">â€”warn-undefined-variables</code>é€‰é¡¹æ¥è¯†åˆ«è¿™ç§æƒ…å†µï¼Œä½†è¿™ä¹Ÿæ ‡è®°äº†è®¸å¤šå…¶ä»–éœ€è¦çš„ç©ºå˜é‡ã€‚</p><p><sup>[<a href="#OEBPS/ch09s03.html.make3-CHP-9-FNOTE-1" class="para">1</a>] </sup>We could try using the
                  <code class="option">â€”warn-undefined-variables</code> option to
                  identify this situation, but this also flags many other
                  empty variables that are desirable.</p></div></div></div></div></div>
<div id="OEBPS/ch09s04.html"><div>
<div class="sect1" title="ç®¡ç†ç½å­"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch09s04.html.make3-CHP-9-SECT-4"></a>ç®¡ç†ç½å­</h1><h1 class="title"><a></a>Managing Jars</h1></div></div></div><p>åœ¨ Java ä¸­æž„å»ºå’Œç®¡ç† jar å‘ˆçŽ°<a id="OEBPS/ch09s04.html.make3-CHP-9-ITERM-1505" class="indexterm"></a> <a id="OEBPS/ch09s04.html.make3-CHP-9-ITERM-1506" class="indexterm"></a> <a id="OEBPS/ch09s04.html.make3-CHP-9-ITERM-1507" class="indexterm"></a>ä¸Ž C/C++ åº“ä¸åŒçš„é—®é¢˜ã€‚è¿™æœ‰ä¸‰ä¸ªåŽŸå› ã€‚é¦–å…ˆï¼Œjar çš„æˆå‘˜åŒ…å«ç›¸å¯¹è·¯å¾„ï¼Œå› æ­¤å¿…é¡»ä»”ç»†æŽ§åˆ¶ä¼ é€’ç»™<em class="command">jar</em>ç¨‹åºçš„ç²¾ç¡®æ–‡ä»¶åã€‚å…¶æ¬¡ï¼Œåœ¨ Java ä¸­å­˜åœ¨åˆå¹¶ jar çš„è¶‹åŠ¿ï¼Œä»¥ä¾¿å¯ä»¥å‘å¸ƒå•ä¸ª jar æ¥ä»£è¡¨ä¸€ä¸ªç¨‹åºã€‚æœ€åŽï¼Œjar åŒ…å«ç±»ä¹‹å¤–çš„å…¶ä»–æ–‡ä»¶ï¼Œä¾‹å¦‚æ¸…å•ã€å±žæ€§æ–‡ä»¶å’Œ XMLã€‚</p><p>Building and managing jars in Java presents <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>different issues from C/C++ libraries. There are three
        reasons for this. First, the members of a jar include a relative path,
        so the precise filenames passed to the <em class="command">jar</em> program must be carefully controlled.
        Second, in Java there is a tendency to merge jars so that a single jar
        can be released to represent a program. Finally, jars include other
        files than classes, such as manifests, property files, and XML.</p><p><acronym class="acronym">åœ¨GNU </acronym>
        <em class="command">make</em>ä¸­åˆ›å»º jar çš„åŸºæœ¬å‘½ä»¤æ˜¯ï¼š</p><p>The basic command to create a jar in <acronym class="acronym">GNU</acronym>
        <em class="command">make</em> is:</p><a id="OEBPS/ch09s04.html.I_4_tt415"></a><pre class="programlisting">JAR := ç½å­
JARFLAGS := -cf

$(FOO_JAR)ï¼šå…ˆå†³æ¡ä»¶...
        $(JAR) $(JARFLAGS) $@ $^</pre><pre class="programlisting">JAR      := jar
JARFLAGS := -cf

$(FOO_JAR): prerequisites...
        $(JAR) $(JARFLAGS) $@ $^</pre><p><em class="command">jar</em>ç¨‹åºå¯ä»¥æŽ¥å—ç›®å½•è€Œä¸æ˜¯æ–‡ä»¶åï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç›®å½•æ ‘ä¸­çš„æ‰€æœ‰æ–‡ä»¶éƒ½åŒ…å«åœ¨ jar ä¸­ã€‚è¿™éžå¸¸æ–¹ä¾¿ï¼Œå°¤å…¶æ˜¯ä¸Ž<code class="option">-C</code>æ›´æ”¹ç›®å½•çš„é€‰é¡¹ä¸€èµ·ä½¿ç”¨æ—¶ï¼š</p><p>The <em class="command">jar</em> program can accept
        directories instead of filenames, in which case, all the files in the
        directory trees are included in the jar. This can be very convenient,
        especially when used with the <code class="option">-C</code> option for changing
        directories:</p><a id="OEBPS/ch09s04.html.I_4_tt416"></a><pre class="programlisting">JAR := ç½å­
JARFLAGS := -cf

.PHONY: $(FOO_JAR)
$(FOO_JAR):
        $(JAR) $(JARFLAGS) $@ -C $(OUTPUT_DIR) com</pre><pre class="programlisting">JAR      := jar
JARFLAGS := -cf

.PHONY: $(FOO_JAR)
$(FOO_JAR):
        $(JAR) $(JARFLAGS) $@ -C $(OUTPUT_DIR) com</pre><p>è¿™é‡Œå£°æ˜Žäº† jar æœ¬èº«<code class="literal">.PHONY</code>ã€‚å¦åˆ™ï¼ŒåŽç»­è¿è¡Œ makefile
        <em class="filename">å°†</em>ä¸ä¼šé‡æ–°åˆ›å»ºè¯¥æ–‡ä»¶ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å…ˆå†³æ¡ä»¶ã€‚ä¸Žå‰é¢ç« èŠ‚ä¸­æè¿°çš„<em class="command">ar</em>å‘½ä»¤ä¸€æ ·ï¼Œä½¿ç”¨æ›´æ–°æ ‡å¿— ä¼¼ä¹Žæ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œ
        <code class="option">-u</code>å› ä¸ºå®ƒéœ€è¦ä¸Žä»Žå¤´å¼€å§‹é‡æ–°åˆ›å»º jar ç›¸åŒæˆ–æ›´é•¿çš„æ—¶é—´ï¼Œè‡³å°‘å¯¹äºŽå¤§å¤šæ•°æ›´æ–°æ¥è¯´æ˜¯è¿™æ ·ã€‚</p><p>Here the jar itself is declared <code class="literal">.PHONY</code>. Otherwise subsequent runs of the
        <em class="filename">makefile</em> would not recreate the
        file, because it has no prerequisites. As with the <em class="command">ar</em> command described in an earlier chapter,
        there seems little point in using the update flag,
        <code class="option">-u</code>, since it takes the same amount of time or longer
        as recreating the jar from scratch, at least for most updates.</p><p>jar é€šå¸¸åŒ…å«ä¸€ä¸ªæ¸…å•ï¼Œç”¨äºŽæ ‡è¯† jar å®žçŽ°çš„ä¾›åº”å•†ã€API å’Œç‰ˆæœ¬å·ã€‚ä¸€ä¸ªç®€å•çš„æ¸…å•å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>A jar often includes a manifest that identifies the vendor, API
        and version number the jar implements. A simple manifest might look
        like:</p><a id="OEBPS/ch09s04.html.I_4_tt417"></a><pre class="programlisting">åç§°ï¼šJAR_NAME
è§„èŒƒæ ‡é¢˜ï¼šSPEC_NAME
å®žçŽ°ç‰ˆæœ¬ï¼šIMPL_VERSION
è§„æ ¼ä¾›åº”å•†ï¼šGeneric Innovative Company, Inc.</pre><pre class="programlisting">Name: JAR_NAME
Specification-Title: SPEC_NAME
Implementation-Version: IMPL_VERSION
Specification-Vendor: Generic Innovative Company, Inc.</pre><p>æ­¤æ¸…å•åŒ…å«ä¸‰ä¸ªå ä½ç¬¦ ã€<code class="literal">JAR_NAME</code>å’Œ<code class="literal">SPEC_NAME</code>ï¼Œ<code class="literal">IMPL_VERSION</code>å¯ä»¥åœ¨åˆ›å»º jar æ—¶é€šè¿‡<em class="command">make</em>ä½¿ç”¨
        <em class="command">sed</em>ã€<em class="command">m4</em>æˆ–æ‚¨æœ€å–œæ¬¢çš„æµç¼–è¾‘å™¨æ¥æ›¿æ¢å®ƒä»¬ã€‚è¿™æ˜¯ä¸€ä¸ªå¤„ç†æ¸…å•çš„å‡½æ•°ï¼š</p><p>This manifest includes three placeholders, <code class="literal">JAR_NAME</code>, <code class="literal">SPEC_NAME</code>, and <code class="literal">IMPL_VERSION</code>, that can be replaced at jar
        creation time by <em class="command">make</em> using
        <em class="command">sed</em>, <em class="command">m4</em>, or your favorite stream editor. Here is
        a function to process a manifest:</p><a id="OEBPS/ch09s04.html.I_4_tt418"></a><pre class="programlisting">MANIFEST_TEMPLATE := src/manifests/default.mf
TMP_JAR_DIR := $(è°ƒç”¨ make-temp-dir)
TMP_MANIFEST := $(TMP_JAR_DIR)/manifest.mf

# $(è°ƒç”¨ add-manifestã€jarã€jar-nameã€manifest-file-opt)
å®šä¹‰æ·»åŠ æ¸…å•
  $(RM) $(ç›®å½• $(TMP_MANIFEST))
  $(MKDIR) $(ç›®å½• $(TMP_MANIFEST))
  m4 --define=NAME="$(notdir $2)" \
     --define=IMPL_VERSION=$(VERSION_NUMBER) \
     --define=SPEC_VERSION=$(VERSION_NUMBER) \
     $(å¦‚æžœ$3,$3,$(MANIFEST_TEMPLATE)) \
     &gt; $(TMP_MANIFEST)
  $(JAR) -ufm $1 $(TMP_MANIFEST)
  $(RM) $(ç›®å½• $(TMP_MANIFEST))
æ©å¾·å¤«</pre><pre class="programlisting">MANIFEST_TEMPLATE := src/manifests/default.mf
TMP_JAR_DIR       := $(call make-temp-dir)
TMP_MANIFEST      := $(TMP_JAR_DIR)/manifest.mf

# $(call add-manifest, jar, jar-name, manifest-file-opt)
define add-manifest
  $(RM) $(dir $(TMP_MANIFEST))
  $(MKDIR) $(dir $(TMP_MANIFEST))
  m4 --define=NAME="$(notdir $2)"                       \
     --define=IMPL_VERSION=$(VERSION_NUMBER)            \
     --define=SPEC_VERSION=$(VERSION_NUMBER)            \
     $(if $3,$3,$(MANIFEST_TEMPLATE))                   \
     &gt; $(TMP_MANIFEST)
  $(JAR) -ufm $1 $(TMP_MANIFEST)
  $(RM) $(dir $(TMP_MANIFEST))
endef</pre><p>è¯¥<code class="function">add-manifest</code>å‡½æ•°è¿è¡Œ<a id="OEBPS/ch09s04.html.make3-CHP-9-ITERM-1508" class="indexterm"></a> <a id="OEBPS/ch09s04.html.make3-CHP-9-ITERM-1509" class="indexterm"></a>ç±»ä¼¼äºŽå‰é¢æ˜¾ç¤ºçš„æ¸…å•æ–‡ä»¶ã€‚è¯¥å‡½æ•°é¦–å…ˆåˆ›å»ºä¸€ä¸ªä¸´æ—¶ç›®å½•ï¼Œç„¶åŽå±•å¼€ç¤ºä¾‹æ¸…å•ã€‚æŽ¥ä¸‹æ¥ï¼Œå®ƒæ›´æ–° jarï¼Œæœ€åŽåˆ é™¤ä¸´æ—¶ç›®å½•ã€‚è¯·æ³¨æ„ï¼Œè¯¥å‡½æ•°çš„æœ€åŽä¸€ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ã€‚å¦‚æžœæ¸…å•æ–‡ä»¶è·¯å¾„ä¸ºç©ºï¼Œåˆ™è¯¥å‡½æ•°ä½¿ç”¨ ä¸­çš„å€¼<code class="literal">MANIFEST_TEMPLATE</code>ã€‚</p><p>The <code class="function">add-manifest</code> function
        operates <a class="indexterm"></a> <a class="indexterm"></a>on a manifest file similar to the one shown previously.
        The function first creates a temporary directory, then expands the
        sample manifest. Next, it updates the jar, and finally deletes the
        temporary directory. Notice that the last parameter to the function is
        optional. If the manifest file path is empty, the function uses the
        value from <code class="literal">MANIFEST_TEMPLATE</code>.</p><p>é€šç”¨<em class="filename">makefile</em>
        å°†è¿™äº›æ“ä½œæ†ç»‘åˆ°ä¸€ä¸ªé€šç”¨å‡½æ•°ä¸­ï¼Œä»¥ç¼–å†™ç”¨äºŽåˆ›å»º jar çš„æ˜¾å¼è§„åˆ™ï¼š</p><p>The generic <em class="filename">makefile</em>
        bundles these operations into a generic function to write an explicit
        rule for creating a jar:</p><a id="OEBPS/ch09s04.html.I_4_tt419"></a><pre class="programlisting"># $(è°ƒç”¨ make-jar,jar-variable-prefix)
å®šä¹‰ make-jar
  .PHONYï¼š$1 $$($1_name)
  $1ï¼š$($1_åç§°)
  $$ï¼ˆ$1_åç§°ï¼‰ï¼š
        cd $(OUTPUT_DIR); \
        $(JAR) $(JARFLAGS) $$(notdir $$@) $$($1_packages)
        $$ï¼ˆè°ƒç”¨æ·»åŠ æ¸…å•ï¼Œ$$@ï¼Œ$$ï¼ˆ$1_nameï¼‰ï¼Œ$$ï¼ˆ$1_manifestï¼‰ï¼‰
æ©å¾·å¤«</pre><pre class="programlisting"># $(call make-jar,jar-variable-prefix)
define make-jar
  .PHONY: $1 $$($1_name)
  $1: $($1_name)
  $$($1_name):
        cd $(OUTPUT_DIR); \
        $(JAR) $(JARFLAGS) $$(notdir $$@) $$($1_packages)
        $$(call add-manifest, $$@, $$($1_name), $$($1_manifest))
endef</pre><p><em class="command">å®ƒæŽ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³make</em>å˜é‡çš„å‰ç¼€ï¼Œè¯¥å‚æ•°æ ‡è¯†ä¸€ç»„æè¿°å››ä¸ª jar å‚æ•°çš„å˜é‡ï¼šç›®æ ‡åç§°ã€jar åç§°ã€jar ä¸­çš„åŒ…ä»¥åŠ jar çš„æ¸…å•æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¯¹äºŽåä¸º<em class="filename">ui.jar</em>çš„ jar ï¼Œæˆ‘ä»¬å°†ç¼–å†™ï¼š</p><p>It accepts a single argument, the prefix of a <em class="command">make</em> variable, that identifies a set of
        variables describing four jar parameters: the target name, the jar
        name, the packages in the jar, and the jar's manifest file. For
        example, for a jar named <em class="filename">ui.jar</em>,
        we would write:</p><a id="OEBPS/ch09s04.html.I_4_tt420"></a><pre class="programlisting">ui_jar_name := $(OUTPUT_DIR)/lib/ui.jar
ui_jar_manifest := src/com/company/ui/manifest.mf
ui_jar_packages := src/com/company/ui \
                   src/com/company/lib

$(eval $(è°ƒç”¨ make-jar,ui_jar))</pre><pre class="programlisting">ui_jar_name     := $(OUTPUT_DIR)/lib/ui.jar
ui_jar_manifest := src/com/company/ui/manifest.mf
ui_jar_packages := src/com/company/ui \
                   src/com/company/lib

$(eval $(call make-jar,ui_jar))</pre><p>é€šè¿‡ä½¿ç”¨å˜é‡åç»„åˆï¼Œæˆ‘ä»¬å¯ä»¥ç¼©çŸ­å‡½æ•°çš„è°ƒç”¨é¡ºåºï¼Œå¹¶å…è®¸éžå¸¸çµæ´»çš„å‡½æ•°å®žçŽ°ã€‚</p><p>By using variable name composition, we can shorten the calling
        sequence of our function and allow for a very flexible implementation
        of the function.</p><p>å¦‚æžœæˆ‘ä»¬è¦åˆ›å»ºè®¸å¤š jar æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°† jar åç§°æ”¾å…¥å˜é‡ä¸­æ¥è¿›ä¸€æ­¥è‡ªåŠ¨åŒ–æ­¤æ“ä½œï¼š</p><p>If we have many jar files to create, we can automate this
        further by placing the jar names in a variable:</p><a id="OEBPS/ch09s04.html.I_4_tt421"></a><pre class="programlisting">jar_list := server_jar ui_jar

.PHONY: jars $(jar_list)
ç½å­ï¼š$(jar_list)

$(foreach j, $(jar_list),\
  $(eval $(è°ƒç”¨ make-jar,$j)))</pre><pre class="programlisting">jar_list := server_jar ui_jar

.PHONY: jars $(jar_list)
jars: $(jar_list)

$(foreach j, $(jar_list),\
  $(eval $(call make-jar,$j)))</pre><p>æœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°† jar æ–‡ä»¶æ‰©å±•åˆ°ä¸´æ—¶ç›®å½•ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼š</p><p>Occasionally, we need to expand a jar file into a temporary
        directory. Here is a simple function to do that:</p><a id="OEBPS/ch09s04.html.I_4_tt422"></a><pre class="programlisting"># $(è°ƒç”¨burst-jar, jar-file, ç›®æ ‡ç›®å½•)
å®šä¹‰burst-jar
  $(è°ƒç”¨ make-dir,$2)
  å…‰ç›˜2ç¾Žå…ƒï¼› $(JAR) -xf $1
æ©å¾·å¤«</pre><pre class="programlisting"># $(call burst-jar, jar-file, target-directory)
define burst-jar
  $(call make-dir,$2)
  cd $2; $(JAR) -xf $1
endef</pre></div></div></div>
<div id="OEBPS/ch09s05.html"><div>
<div class="sect1" title="å‚è€ƒæ ‘å’Œç¬¬ä¸‰æ–¹ Jar"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch09s05.html.make3-CHP-9-SECT-5"></a>å‚è€ƒæ ‘å’Œç¬¬ä¸‰æ–¹ Jar</h1><h1 class="title"><a></a>Reference Trees and Third-Party Jars</h1></div></div></div><p>è¦ä½¿ç”¨å•ä¸ªï¼Œ<a id="OEBPS/ch09s05.html.make3-CHP-9-ITERM-1510" class="indexterm"></a> <a id="OEBPS/ch09s05.html.make3-CHP-9-ITERM-1511" class="indexterm"></a> <a id="OEBPS/ch09s05.html.make3-CHP-9-ITERM-1512" class="indexterm"></a>å…±äº«å¼•ç”¨æ ‘ä¸ºå¼€å‘äººå‘˜æ”¯æŒéƒ¨åˆ†æºä»£ç æ ‘ï¼Œåªéœ€è®©å¤œé—´æž„å»ºä¸ºé¡¹ç›®åˆ›å»º jar å¹¶å°†è¿™äº› jar åŒ…å«åœ¨<code class="literal">CLASSPATH</code>Java ç¼–è¯‘å™¨ä¸­ã€‚å¼€å‘äººå‘˜å¯ä»¥æ£€æŸ¥ä»–éœ€è¦çš„æºæ ‘éƒ¨åˆ†å¹¶è¿è¡Œç¼–è¯‘ï¼ˆå‡è®¾æºæ–‡ä»¶åˆ—è¡¨æ˜¯ç”±<em class="command">find</em>ä¹‹ç±»çš„ä¸œè¥¿åŠ¨æ€åˆ›å»ºçš„ï¼‰ã€‚å½“ Java ç¼–è¯‘å™¨éœ€è¦ç¼ºå°‘æºæ–‡ä»¶ä¸­çš„ç¬¦å·æ—¶ï¼Œå®ƒå°†æœç´¢<code class="literal">CLASSPATH</code>å¹¶å‘çŽ°
        jar ä¸­çš„<em class="filename">.classæ–‡ä»¶ã€‚</em></p><p>To use a single, <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>shared reference tree to support partial source trees
        for developers, simply have the nightly build create jars for the
        project and include those jars in the <code class="literal">CLASSPATH</code> of the Java compiler. The
        developer can check out the parts of the source tree he needs and run
        the compile (assuming the source file list is dynamically created by
        something like <em class="command">find</em>). When the Java
        compiler requires symbols from a missing source file, it will search
        the <code class="literal">CLASSPATH</code> and discover the
        <em class="filename">.class</em> file in the jar.</p><p>ä»Žå‚è€ƒæ ‘ä¸­é€‰æ‹©ç¬¬ä¸‰æ–¹ jar ä¹Ÿå¾ˆç®€å•ã€‚åªéœ€å°† jar çš„è·¯å¾„æ”¾å…¥<code class="literal">CLASSPATH</code>.å¦‚å‰æ‰€è¿°ï¼Œ<em class="filename">makefile</em>æ˜¯ç®¡ç†æ­¤è¿‡ç¨‹çš„å®è´µå·¥å…·ã€‚å½“ç„¶ï¼Œè¯¥<code class="function">get-file</code>åŠŸèƒ½å¯ä»¥é€šè¿‡ç®€å•åœ°è®¾ç½®å˜é‡æ¥è‡ªåŠ¨é€‰æ‹© beta æˆ– stableã€æœ¬åœ°æˆ–è¿œç¨‹ jar <code class="literal">JAR_PATH</code>
        ã€‚</p><p>Selecting third-party jars from a reference tree is also simple.
        Just place the path to the jar in the <code class="literal">CLASSPATH</code>. The <em class="filename">makefile</em> can be a valuable tool for
        managing this process as previously noted. Of course, the <code class="function">get-file</code> function can be used to
        automatically select beta or stable, local or remote jars by simply
        setting the <code class="literal">JAR_PATH</code>
        variable.</p></div></div></div>
<div id="OEBPS/ch09s06.html"><div>
<div class="sect1" title="ä¼ä¸šJavaBean"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch09s06.html.make3-CHP-9-SECT-6"></a>ä¼ä¸šJavaBean</h1><h1 class="title"><a></a>Enterprise JavaBeans</h1></div></div></div><p>Enterprise JavaBeansâ„¢ æ˜¯<a id="OEBPS/ch09s06.html.make3-CHP-9-ITERM-1513" class="indexterm"></a> <a id="OEBPS/ch09s06.html.make3-CHP-9-ITERM-1514" class="indexterm"></a>åœ¨è¿œç¨‹æ–¹æ³•è°ƒç”¨æ¡†æž¶ä¸­å°è£…å’Œé‡ç”¨ä¸šåŠ¡é€»è¾‘çš„å¼ºå¤§æŠ€æœ¯ã€‚ EJB è®¾ç½®ç”¨äºŽå®žçŽ°æœ€ç»ˆç”±è¿œç¨‹å®¢æˆ·ç«¯ä½¿ç”¨çš„æœåŠ¡å™¨ API çš„ Java ç±»ã€‚è¿™äº›å¯¹è±¡å’ŒæœåŠ¡æ˜¯ä½¿ç”¨åŸºäºŽ XML çš„æŽ§åˆ¶æ–‡ä»¶è¿›è¡Œé…ç½®çš„ã€‚ä¸€æ—¦ç¼–å†™äº† Java ç±»å’Œ XML æŽ§åˆ¶æ–‡ä»¶ï¼Œå°±å¿…é¡»å°†å®ƒä»¬æ†ç»‘åœ¨ä¸€ä¸ª jar ä¸­ã€‚ç„¶åŽï¼Œä¸€ä¸ªç‰¹æ®Šçš„ EJB ç¼–è¯‘å™¨æž„å»ºå­˜æ ¹å’Œè¿žæŽ¥æ¥å®žçŽ° RPC æ”¯æŒä»£ç ã€‚</p><p>Enterprise JavaBeansâ„¢ is a <a class="indexterm"></a> <a class="indexterm"></a>powerful technique to encapsulate and reuse business
        logic in the framework of remote method invocation. EJB sets up Java
        classes used to implement server APIs that are ultimately used by
        remote clients. These objects and services are configured using
        XML-based control files. Once the Java classes and XML control files
        are written, they must be bundled together in a jar. Then a special
        EJB compiler builds stubs and ties to implement the RPC support
        code.</p><p>å¯ä»¥å°†ä»¥ä¸‹ä»£ç æ’å…¥<a class="link" href="#OEBPS/ch09s02.html.make3-CHP-9-EX-1" title="ä¾‹ 9-1ã€‚ Java çš„é€šç”¨ makefile">ç¤ºä¾‹ 9-1</a>ä¸­ä»¥æä¾›é€šç”¨ EJB æ”¯æŒï¼š</p><p>The following code can be plugged into <a class="link" href="#OEBPS/ch09s02.html.make3-CHP-9-EX-1" title="Example&nbsp;9-1.&nbsp;Generic makefile for Java">Example 9-1</a> to provide generic EJB
        support:</p><a id="OEBPS/ch09s06.html.I_4_tt423"></a><pre class="programlisting">EJB_TMP_JAR = $(EJB_TMP_DIR)/temp.jar
META_INF = $(EJB_TMP_DIR)/META-INF

# $(è°ƒç”¨ç¼–è¯‘ bean, jar åç§°,
# bean-files-wildcard, æ¸…å•åç§°-opt)
å®šä¹‰ç¼–è¯‘bean
  $(eval EJB_TMP_DIR := $(shell mktemp -d $(TMPDIR)/compile-bean.XXXXXXXXX))
  $(MKDIR) $(META_INF)
  $(if $(è¿‡æ»¤å™¨ %.xml, $2),cp $(è¿‡æ»¤å™¨ %.xml, $2) $(META_INF))
  cd $(OUTPUT_DIR) &amp;&amp; \
  $(JAR) -cf0 $(EJB_TMP_JAR) \
         $(è°ƒç”¨ jar-file-arg,$(META_INF)) \
         $(è¿‡æ»¤æŽ‰%.xml, $2)
  $(JVM) weblogic.ejbc $(EJB_TMP_JAR) $1
  $(è°ƒç”¨ add-manifest,$(if $3,$3,$1),,)
  $(RM) $(EJB_TMP_DIR)
æ©å¾·å¤«

# $(è°ƒç”¨ jar-file-arg, jar-file)
jar-file-arg = -C "$(patsubst %/,%,$(dir $1))" $(notdir $1)</pre><pre class="programlisting">EJB_TMP_JAR = $(EJB_TMP_DIR)/temp.jar
META_INF    = $(EJB_TMP_DIR)/META-INF

# $(call compile-bean, jar-name,
#                      bean-files-wildcard, manifest-name-opt)
define compile-bean
  $(eval EJB_TMP_DIR := $(shell mktemp -d $(TMPDIR)/compile-bean.XXXXXXXX))
  $(MKDIR) $(META_INF)
  $(if $(filter %.xml, $2),cp $(filter %.xml, $2) $(META_INF))
  cd $(OUTPUT_DIR) &amp;&amp;                            \
  $(JAR) -cf0 $(EJB_TMP_JAR)                     \
         $(call jar-file-arg,$(META_INF))        \
         $(filter-out %.xml, $2)
  $(JVM) weblogic.ejbc $(EJB_TMP_JAR) $1
  $(call add-manifest,$(if $3,$3,$1),,)
  $(RM) $(EJB_TMP_DIR)
endef

# $(call jar-file-arg, jar-file)
jar-file-arg = -C "$(patsubst %/,%,$(dir $1))" $(notdir $1)</pre><p>åŠŸèƒ½<code class="function">compile-bean</code>â€‹
        <a id="OEBPS/ch09s06.html.make3-CHP-9-ITERM-1515" class="indexterm"></a> <a id="OEBPS/ch09s06.html.make3-CHP-9-ITERM-1516" class="indexterm"></a>æŽ¥å—ä¸‰ä¸ªå‚æ•°ï¼šè¦åˆ›å»ºçš„ jar çš„åç§°ã€jar ä¸­çš„æ–‡ä»¶åˆ—è¡¨ä»¥åŠå¯é€‰çš„æ¸…å•æ–‡ä»¶ã€‚è¯¥å‡½æ•°é¦–å…ˆä½¿ç”¨<em class="command">mktemp</em>ç¨‹åºåˆ›å»ºä¸€ä¸ªå¹²å‡€çš„ä¸´æ—¶ç›®å½•ï¼Œå¹¶å°†ç›®å½•åç§°ä¿å­˜åœ¨å˜é‡ ä¸­<code class="literal">EJB_TMP_DIR</code>ã€‚é€šè¿‡å°†åˆ†é…åµŒå…¥åˆ° ä¸­<code class="function">eval</code>ï¼Œæˆ‘ä»¬ç¡®ä¿<code class="literal">EJB_TMP_DIR</code>æ¯æ¬¡æ‰©å±• æ—¶éƒ½ä¼šé‡ç½®åˆ°æ–°çš„ä¸´æ—¶ç›®å½•<code class="function">compile-bean</code>ã€‚ç”±äºŽ<code class="function">compile-bean</code>è¢«ç”¨åœ¨è§„åˆ™çš„å‘½ä»¤è„šæœ¬éƒ¨åˆ†ï¼Œå› æ­¤åªæœ‰åœ¨æ‰§è¡Œå‘½ä»¤è„šæœ¬æ—¶æ‰ä¼šæ‰©å±•è¯¥åŠŸèƒ½ã€‚æŽ¥ä¸‹æ¥ï¼Œå®ƒå°† bean æ–‡ä»¶åˆ—è¡¨ä¸­çš„æ‰€æœ‰ XML æ–‡ä»¶å¤åˆ¶åˆ°<em class="filename">META-INF</em>ç›®å½•ä¸­ã€‚è¿™æ˜¯ EJB é…ç½®æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ã€‚ç„¶åŽï¼Œè¯¥å‡½æ•°æž„å»ºä¸€ä¸ªä¸´æ—¶ jarï¼Œç”¨ä½œ EJB ç¼–è¯‘å™¨çš„è¾“å…¥ã€‚è¯¥å‡½æ•°å°†<em class="filename">dir1/dir2/dir3</em><code class="function">jar-file-arg</code>æ ¼å¼çš„æ–‡ä»¶åè½¬æ¢ä¸º
        jar ä¸­æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„æ˜¯æ­£ç¡®çš„ã€‚è¿™æ˜¯
        å‘ jar å‘½ä»¤æŒ‡ç¤º<em class="filename">META-INF</em>ç›®å½•çš„é€‚å½“æ ¼å¼ã€‚ beanæ–‡ä»¶åˆ—è¡¨åŒ…å«å·²ç»æ”¾ç½®åœ¨<em class="filename">META-INFç›®å½•ä¸­çš„</em><em class="filename">.xml</em>æ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬è¿‡æ»¤æŽ‰è¿™äº›æ–‡ä»¶ã€‚æž„å»ºä¸´æ—¶ jar åŽï¼Œå°†è°ƒç”¨ WebLogic EJB ç¼–è¯‘å™¨ï¼Œç”Ÿæˆè¾“å‡º jarã€‚ç„¶åŽå°†æ¸…å•æ·»åŠ åˆ°ç¼–è¯‘çš„ jar ä¸­ã€‚æœ€åŽï¼Œæˆ‘ä»¬çš„ä¸´æ—¶ç›®å½•è¢«åˆ é™¤ã€‚<em class="filename"></em><code class="literal">-C dir1/dir2 dir3</code><em class="filename"></em><em class="filename"></em><em class="filename"></em></p><p>The <code class="function">compile-bean</code> function
        <a class="indexterm"></a> <a class="indexterm"></a>accepts three parameters: the name of the jar to create,
        the list of files in the jar, and an optional manifest file. The
        function first creates a clean temporary directory using the <em class="command">mktemp</em> program and saves the directory name
        in the variable <code class="literal">EJB_TMP_DIR</code>. By
        embedding the assignment in an <code class="function">eval</code>, we ensure that <code class="literal">EJB_TMP_DIR</code> is reset to a new temporary
        directory once for each expansion of <code class="function">compile-bean</code>. Since <code class="function">compile-bean</code> is used in the command script
        part of a rule, the function is expanded only when the command script
        is executed. Next, it copies any XML files in the bean file list into
        the <em class="filename">META-INF</em> directory. This is
        where EJB configuration files live. Then, the function builds a
        temporary jar that is used as input to the EJB compiler. The <code class="function">jar-file-arg</code> function converts filenames of
        the form <em class="filename">dir1/dir2/dir3</em> into
        <code class="literal">-C dir1/dir2 dir3</code> so the relative
        path to the file in the jar is correct. This is the appropriate format
        for indicating the <em class="filename">META-INF</em>
        directory to the jar command. The bean file list contains <em class="filename">.xml</em> files that have already been placed in
        the <em class="filename">META-INF</em> directory, so we
        filter these files out. After building the temporary jar, the WebLogic
        EJB compiler is invoked, generating the output jar. A manifest is then
        added to the compiled jar. Finally, our temporary directory is
        removed.</p><p>ä½¿ç”¨æ–°å‡½æ•°éžå¸¸ç®€å•ï¼š</p><p>Using the new function is straightforward:</p><a id="OEBPS/ch09s06.html.I_4_tt424"></a><pre class="programlisting">bean_files = com/company/bean/FooInterface.class \
             com/company/bean/FooHome.class \
             src/com/company/bean/ejb-jar.xml \
             src/com/company/bean/weblogic-ejb-jar.xml

.PHONY: ejb_jar $(EJB_JAR)
ejb_jar: $(EJB_JAR)
$(EJB_JAR):
        $ï¼ˆè°ƒç”¨ç¼–è¯‘beanï¼Œ$ @ï¼Œ$ï¼ˆbean_filesï¼‰ï¼Œweblogic.mfï¼‰</pre><pre class="programlisting">bean_files = com/company/bean/FooInterface.class       \
             com/company/bean/FooHome.class            \
             src/com/company/bean/ejb-jar.xml          \
             src/com/company/bean/weblogic-ejb-jar.xml

.PHONY: ejb_jar $(EJB_JAR)
ejb_jar: $(EJB_JAR)
$(EJB_JAR):
        $(call compile-bean, $@, $(bean_files), weblogic.mf)</pre><p>è¯¥<code class="literal">bean_files</code>åˆ—è¡¨æœ‰ç‚¹ä»¤äººå›°æƒ‘ã€‚å®ƒå¼•ç”¨çš„<em class="filename">.classæ–‡ä»¶å°†ç›¸å¯¹äºŽ</em><em class="filename">classes</em>ç›®å½•
        è¿›è¡Œè®¿é—®ï¼Œè€Œ<em class="filename">.xmlæ–‡ä»¶å°†ç›¸å¯¹äºŽ</em><em class="filename">makefile</em>çš„ç›®å½•è¿›è¡Œè®¿é—®ã€‚</p><p>The <code class="literal">bean_files</code> list is a
        little confusing. The <em class="filename">.class</em>
        files it references will be accessed relative to the <em class="filename">classes</em> directory, while the <em class="filename">.xml</em> files will be accessed relative to the
        directory of the <em class="filename">makefile</em>.</p><p>è¿™å¾ˆå¥½ï¼Œä½†æ˜¯å¦‚æžœä½ çš„ bean jar ä¸­æœ‰å¾ˆå¤š bean æ–‡ä»¶æ€Žä¹ˆåŠžï¼Ÿæˆ‘ä»¬å¯ä»¥è‡ªåŠ¨æž„å»ºæ–‡ä»¶åˆ—è¡¨å—ï¼Ÿå½“ç„¶ï¼š</p><p>This is fine, but what if you have lots of bean files in your
        bean jar. Can we build the file list automatically? Certainly:</p><a id="OEBPS/ch09s06.html.I_4_tt425"></a><pre class="programlisting">src_dirs := $(SOURCE_DIR)/com/company/...

bean_files = \
  $(patsubst $(SOURCE_DIR)/%,%, \
    $(addsuffix /*.class, \
      $(æŽ’åº\
        $(ç›®å½•\
          $(é€šé…ç¬¦\
            $(addsuffix /*Home.java,$(src_dirs)))))))
src/com/company/bean/ejb-jar.xml \
src/com/company/bean/weblogic-ejb-jar.xml

.PHONY: ejb_jar $(EJB_JAR)
ejb_jar: $(EJB_JAR)
$(EJB_JAR):
        $ï¼ˆè°ƒç”¨ç¼–è¯‘beanï¼Œ$ @ï¼Œ$ï¼ˆbean_filesï¼‰ï¼Œweblogic.mfï¼‰</pre><pre class="programlisting">src_dirs := $(SOURCE_DIR)/com/company/...

bean_files =                                          \
  $(patsubst $(SOURCE_DIR)/%,%,                       \
    $(addsuffix /*.class,                             \
      $(sort                                          \
        $(dir                                         \
          $(wildcard                                  \
            $(addsuffix /*Home.java,$(src_dirs)))))))
src/com/company/bean/ejb-jar.xml \
src/com/company/bean/weblogic-ejb-jar.xml

.PHONY: ejb_jar $(EJB_JAR)
ejb_jar: $(EJB_JAR)
$(EJB_JAR):
        $(call compile-bean, $@, $(bean_files), weblogic.mf)</pre><p>è¿™å‡å®šæ‰€æœ‰å…·æœ‰ EJB æºä»£ç çš„ç›®å½•éƒ½åŒ…å«åœ¨è¯¥<code class="literal">src_dirs</code>å˜é‡ä¸­ï¼ˆä¹Ÿå¯èƒ½å­˜åœ¨ä¸åŒ…å« EJB æºä»£ç çš„ç›®å½•ï¼‰ï¼Œå¹¶ä¸”ä»»ä½•ä»¥<em class="filename">Home.java</em>ç»“å°¾çš„æ–‡ä»¶
        éƒ½æ ‡è¯†åŒ…å« EJB ä»£ç çš„åŒ…ã€‚è®¾ç½®å˜é‡çš„è¡¨è¾¾å¼<code class="literal">bean_files</code>é¦–å…ˆå°†é€šé…ç¬¦åŽç¼€æ·»åŠ åˆ°ç›®å½•ï¼Œç„¶åŽè°ƒç”¨ä»¥æ”¶é›†<em class="filename">Home.java</em>æ–‡ä»¶<code class="function">wildcard</code>çš„åˆ—è¡¨ã€‚æ–‡ä»¶åå°†è¢«ä¸¢å¼ƒä»¥ä¿ç•™ç›®å½•ï¼Œç›®å½•å°†è¢«æŽ’åºä»¥åˆ é™¤é‡å¤é¡¹ã€‚æ·»åŠ é€šé…ç¬¦
        åŽç¼€ä»¥ä¾¿ shell å°†åˆ—è¡¨æ‰©å±•åˆ°å®žé™…çš„ç±»æ–‡ä»¶ã€‚æœ€åŽï¼Œæºç›®å½•å‰ç¼€ï¼ˆåœ¨<em class="filename">ç±»</em>æ ‘ä¸­æ— æ•ˆï¼‰è¢«åˆ é™¤ã€‚ä½¿ç”¨ Shell é€šé…ç¬¦æ‰©å±•è€Œä¸æ˜¯<em class="command">make çš„</em>æ‰©å±•æ˜¯å› ä¸ºåœ¨ç¼–è¯‘ç±»æ–‡ä»¶åŽæˆ‘ä»¬ä¸èƒ½ä¾èµ–<em class="command">make</em>æ¥æ‰§è¡Œå…¶æ‰©å±•ã€‚å¦‚æžœ<em class="command">make</em>è¿‡æ—©è¯„ä¼°è¯¥å‡½æ•°ï¼Œå®ƒå°†æ‰¾ä¸åˆ°ä»»ä½•æ–‡ä»¶ï¼Œå¹¶ä¸”ç›®å½•ç¼“å­˜å°†é˜»æ­¢å®ƒå†æ¬¡æŸ¥æ‰¾ã€‚æºä»£ç æ ‘ä¸­çš„æ˜¯å®Œå…¨å®‰å…¨çš„ï¼Œå› ä¸ºï¼ˆæˆ‘ä»¬å‡è®¾ï¼‰ <em class="command">make</em>è¿è¡Œæ—¶ä¸ä¼šæ·»åŠ æºæ–‡ä»¶ã€‚<em class="filename"></em><code class="literal">/*.class</code><em class="filename"></em><em class="command"></em><code class="function">wildcard</code><em class="command"></em><em class="command"></em><code class="function">wildcard</code><code class="function">wildcard</code><em class="command"></em></p><p>This assumes that all the directories with EJB source are
        contained in the <code class="literal">src_dirs</code> variable
        (there can also be directories that do not contain EJB source) and
        that any file ending in <em class="filename">Home.java</em>
        identifies a package containing EJB code. The expression for setting
        the <code class="literal">bean_files</code> variable first adds
        the wildcard suffix to the directories, then invokes <code class="function">wildcard</code> to gather the list of <em class="filename">Home.java</em> files. The filenames are
        discarded to leave the directories, which are sorted to remove
        duplicates. The wildcard <code class="literal">/*.class</code>
        suffix is added so that the shell will expand the list to the actual
        class files. Finally, the source directory prefix (which is not valid
        in the <em class="filename">classes</em> tree) is removed.
        Shell wildcard expansion is used instead of <em class="command">make</em>'s <code class="function">wildcard</code> because we can't rely on <em class="command">make</em> to perform its expansion after the
        class files have been compiled. If <em class="command">make</em> evaluated the <code class="function">wildcard</code> function too early it would find
        no files and directory caching would prevent it from ever looking
        again. The <code class="function">wildcard</code> in the source
        tree is perfectly safe because (we assume) no source files will be
        added while <em class="command">make</em> is running.</p><p>å½“æˆ‘ä»¬çš„bean jaræ•°é‡è¾ƒå°‘æ—¶ï¼Œä¸Šé¢çš„ä»£ç æ˜¯æœ‰æ•ˆçš„ã€‚å¦ä¸€ç§å¼€å‘é£Žæ ¼å°†æ¯ä¸ª EJB æ”¾åœ¨è‡ªå·±çš„ jar ä¸­ã€‚å¤§åž‹é¡¹ç›®å¯èƒ½æœ‰å‡ åä¸ª jarã€‚ä¸ºäº†è‡ªåŠ¨å¤„ç†è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ª EJB jar ç”Ÿæˆä¸€ä¸ªæ˜¾å¼è§„åˆ™ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼ŒEJB æºä»£ç æ˜¯ç‹¬ç«‹çš„ï¼šæ¯ä¸ª EJB åŠå…¶å…³è”çš„ XML æ–‡ä»¶éƒ½ä½äºŽå•ä¸ªç›®å½•ä¸­ã€‚ EJB ç›®å½•å¯ä»¥é€šè¿‡ä»¥<em class="filename">Session.java</em>ç»“å°¾çš„æ–‡ä»¶æ¥æ ‡è¯†ã€‚</p><p>The above code works when we have a small number of bean jars.
        Another style of development places each EJB in its own jar. Large
        projects may have dozens of jars. To handle this case automatically,
        we need to generate an explicit rule for each EJB jar. In this
        example, EJB source code is self-contained: each EJB is located in a
        single directory with its associated XML files. EJB directories can be
        identified by files that end with <em class="filename">Session.java</em>.</p><p>åŸºæœ¬æ–¹æ³•æ˜¯åœ¨æºæ ‘ä¸­æœç´¢ EJBï¼Œç„¶åŽæž„å»ºæ˜¾å¼è§„åˆ™æ¥åˆ›å»ºæ¯ä¸ª EJB å¹¶å°†è¿™äº›è§„åˆ™å†™å…¥æ–‡ä»¶ä¸­ã€‚ç„¶åŽï¼ŒEJB è§„åˆ™æ–‡ä»¶å°†åŒ…å«åœ¨æˆ‘ä»¬çš„<em class="filename">makefile</em>ä¸­ã€‚ EJB è§„åˆ™æ–‡ä»¶çš„åˆ›å»ºæ˜¯ç”±<em class="command">make</em>è‡ªå·±çš„åŒ…å«æ–‡ä»¶ä¾èµ–æ€§å¤„ç†è§¦å‘çš„ã€‚</p><p>The basic approach is to search the source tree for EJBs, then
        build an explicit rule to create each EJB and write these rules into a
        file. The EJB rules file is then included in our <em class="filename">makefile</em>. The creation of the EJB rules
        file is triggered by <em class="command">make</em>'s own
        dependency handling of include files.</p><a id="OEBPS/ch09s06.html.I_4_tt426"></a><pre class="programlisting"># session_jars - EJB jar åŠå…¶ç›¸å¯¹æºè·¯å¾„ã€‚
ä¼šè¯ç½=
  $(subst .java,.jar, \
    $(é€šé…ç¬¦\
      $(addsuffix /*Session.java, $(COMPILATION_DIRS))))

# EJBS - æˆ‘ä»¬éœ€è¦æž„å»ºçš„æ‰€æœ‰ EJB jar çš„åˆ—è¡¨ã€‚
EJBS = $(addprefix $(TMP_DIR)/,$(notdir $(session_jars)))

# ejbs - åˆ›å»ºæ‰€æœ‰ EJB jar æ–‡ä»¶ã€‚
.PHONYï¼šejb
ejbï¼š$(EJBS)
$ï¼ˆEJBSï¼‰ï¼š
        $(è°ƒç”¨ç¼–è¯‘bean,$@,$^,)</pre><pre class="programlisting"># session_jars - The EJB jars with their relative source path.
session_jars =
  $(subst .java,.jar,                         \
    $(wildcard                                \
      $(addsuffix /*Session.java, $(COMPILATION_DIRS))))

# EJBS - A list of all EJB jars we need to build.
EJBS = $(addprefix $(TMP_DIR)/,$(notdir $(session_jars)))

# ejbs - Create all EJB jar files.
.PHONY: ejbs
ejbs: $(EJBS)
$(EJBS):
        $(call compile-bean,$@,$^,)</pre><p>æˆ‘ä»¬é€šè¿‡åœ¨æ‰€æœ‰ç¼–è¯‘ç›®å½•ä¸Š
        è°ƒç”¨ aæ¥æ‰¾åˆ°<em class="filename">Session.javaæ–‡ä»¶ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œjar æ–‡ä»¶æ˜¯å¸¦æœ‰</em><em class="filename">.jar</em><code class="function">wildcard</code>åŽç¼€çš„ Session æ–‡ä»¶çš„åç§°ã€‚ jar æœ¬èº«å°†è¢«æ”¾ç½®åœ¨ä¸´æ—¶äºŒè¿›åˆ¶ç›®å½•ä¸­ã€‚è¿™<em class="filename"></em><code class="literal">EJBS</code> <a id="OEBPS/ch09s06.html.make3-CHP-9-ITERM-1517" class="indexterm"></a> <a id="OEBPS/ch09s06.html.make3-CHP-9-ITERM-1518" class="indexterm"></a>å˜é‡åŒ…å« jar åˆ—è¡¨åŠå…¶äºŒè¿›åˆ¶ç›®å½•è·¯å¾„ã€‚è¿™äº› EJB jar æ˜¯æˆ‘ä»¬è¦æ›´æ–°çš„ç›®æ ‡ã€‚å®žé™…çš„å‘½ä»¤è„šæœ¬æ˜¯æˆ‘ä»¬çš„<code class="function">compile-bean</code>å‡½æ•°ã€‚æ£˜æ‰‹çš„éƒ¨åˆ†æ˜¯æ–‡ä»¶åˆ—è¡¨è®°å½•åœ¨æ¯ä¸ª jar æ–‡ä»¶çš„å…ˆå†³æ¡ä»¶ä¸­ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•åˆ›å»ºçš„ã€‚</p><p>We find the <em class="filename">Session.java</em>
        files by calling a <code class="function">wildcard</code> on
        all the compilation directories. In this example, the jar file is the
        name of the Session file with the <em class="filename">.jar</em> suffix. The jars themselves will be
        placed in a temporary binary directory. The <code class="literal">EJBS</code> <a class="indexterm"></a> <a class="indexterm"></a>variable contains the list of jars with their binary
        directory path. These EJB jars are the targets we want to update. The
        actual command script is our <code class="function">compile-bean</code> function. The tricky part is
        that the file list is recorded in the prerequisites for each jar file.
        Let's see how they are created.</p><a id="OEBPS/ch09s06.html.I_4_tt427"></a><pre class="programlisting">-åŒ…æ‹¬$(OUTPUT_DIR)/ejb.d

# $(è°ƒç”¨ ejb è§„åˆ™ï¼Œejb åç§°)
ejb è§„åˆ™ = $(TMP_DIR)/$(notdir $1): \
            $(addprefix $(OUTPUT_DIR)/, \
              $(subst .java,.class,\
                $(é€šé…ç¬¦$(dir $1)*.java))) \
            $(é€šé…ç¬¦$(dir $1)*.xml)

# ejb.d - EJB ä¾èµ–é¡¹æ–‡ä»¶ã€‚
$(OUTPUT_DIR)/ejb.dï¼šMakefile
        @echo è®¡ç®— ejb ä¾èµ–é¡¹...
        @for f in $(session_jars); \
        åš \
          echo "\$$(è°ƒç”¨ ejb-rule,$$f)"; \
        å®Œæˆ &gt; $@</pre><pre class="programlisting">-include $(OUTPUT_DIR)/ejb.d

# $(call ejb-rule, ejb-name)
ejb-rule = $(TMP_DIR)/$(notdir $1):           \
            $(addprefix $(OUTPUT_DIR)/,       \
              $(subst .java,.class,           \
                $(wildcard $(dir $1)*.java))) \
            $(wildcard $(dir $1)*.xml)

# ejb.d - EJB dependencies file.
$(OUTPUT_DIR)/ejb.d: Makefile
        @echo Computing ejb dependencies...
        @for f in $(session_jars);            \
        do                                    \
          echo "\$$(call ejb-rule,$$f)";      \
        done &gt; $@</pre><p>æ¯ä¸ª EJB jar çš„ä¾èµ–é¡¹éƒ½è®°å½•åœ¨å•ç‹¬çš„æ–‡ä»¶<em class="filename">ejb.d</em>ä¸­ï¼Œè¯¥æ–‡ä»¶åŒ…å«åœ¨<em class="filename">makefile</em>ä¸­ã€‚ç¬¬ä¸€æ¬¡
        <em class="command">make</em>æŸ¥æ‰¾è¯¥åŒ…å«æ–‡ä»¶æ—¶ï¼Œå®ƒä¸å­˜åœ¨ã€‚å› æ­¤<em class="command">make</em>è°ƒç”¨æ›´æ–°åŒ…å«æ–‡ä»¶çš„è§„åˆ™ã€‚è¯¥è§„åˆ™ä¸ºæ¯ä¸ª EJB å†™å…¥ä¸€è¡Œï¼Œç±»ä¼¼äºŽï¼š</p><p>The dependencies for each EJB jar are recorded in a separate
        file, <em class="filename">ejb.d</em>, that is included by
        the <em class="filename">makefile</em>. The first time
        <em class="command">make</em> looks for this include file it
        does not exist. So <em class="command">make</em> invokes the
        rule for updating the include file. This rule writes one line for each
        EJB, something like:</p><a id="OEBPS/ch09s06.html.I_4_tt428"></a><pre class="programlisting">$(è°ƒç”¨ ejb-rule,src/com/company/foo/FooSession.jar)</pre><pre class="programlisting">$(call ejb-rule,src/com/company/foo/FooSession.jar)</pre><p>åŠŸèƒ½<code class="function">ejb-rule</code>
        <a id="OEBPS/ch09s06.html.make3-CHP-9-ITERM-1519" class="indexterm"></a> <a id="OEBPS/ch09s06.html.make3-CHP-9-ITERM-1520" class="indexterm"></a>å°†æ‰©å±•åˆ°ç›®æ ‡ jar åŠå…¶å…ˆå†³æ¡ä»¶åˆ—è¡¨ï¼Œä¾‹å¦‚ï¼š</p><p>The function <code class="function">ejb-rule</code>
        <a class="indexterm"></a> <a class="indexterm"></a>will expand to the target jar and its list of
        prerequisites, something like:</p><a id="OEBPS/ch09s06.html.I_4_tt429"></a><pre class="programlisting">ç±»/lib/FooSession.jarï¼šç±»/com/company/foo/FooHome.class \
            ç±»/com/company/foo/FooInterface.class \
            ç±»/com/company/foo/FooSession.class \
            src/com/company/foo/ejb-jar.xml \
            src/com/company/foo/ejb-weblogic-jar.xml</pre><pre class="programlisting">classes/lib/FooSession.jar: classes/com/company/foo/FooHome.class \
            classes/com/company/foo/FooInterface.class           \
            classes/com/company/foo/FooSession.class             \
            src/com/company/foo/ejb-jar.xml                     \
            src/com/company/foo/ejb-weblogic-jar.xml</pre><p><em class="command">é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥åœ¨make</em>ä¸­ç®¡ç†å¤§é‡çš„ jar ï¼Œè€Œä¸ä¼šäº§ç”Ÿæ‰‹åŠ¨ç»´æŠ¤ä¸€ç»„æ˜¾å¼è§„åˆ™çš„å¼€é”€ã€‚</p><p>In this way, a large number of jars can be managed in <em class="command">make</em> without incurring the overhead of
        maintaining a set of explicit rules by hand.</p></div></div></div>
<div id="OEBPS/ch10.html"><div>
<div class="chapter" title="ç¬¬ 10 ç« æé«˜ make çš„æ€§èƒ½"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch10.html.make3-CHP-10"></a>ç¬¬ 10 ç« æé«˜ make çš„æ€§èƒ½</h1><h1 class="title"><a></a>Chapter&nbsp;10.&nbsp;Improving the Performance of make</h1></div></div></div><p><em class="command">make</em>åœ¨å¼€å‘è¿‡ç¨‹ä¸­èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚å®ƒç»“åˆäº†é¡¹ç›®çš„å…ƒç´ æ¥åˆ›å»ºåº”ç”¨ç¨‹åºï¼ŒåŒæ—¶å…è®¸å¼€å‘äººå‘˜é¿å…ç”±äºŽæ„å¤–çœç•¥æž„å»ºæ­¥éª¤è€Œå¯¼è‡´çš„ç»†å¾®é”™è¯¯ã€‚ç„¶è€Œï¼Œå¦‚æžœå¼€å‘äººå‘˜å› ä¸ºè§‰å¾—<em class="filename">makefile</em>å¤ªæ…¢è€Œé¿å…ä½¿ç”¨<em class="command">make ï¼Œ</em><em class="command">é‚£ä¹ˆ make</em>çš„æ‰€æœ‰å¥½å¤„éƒ½ä¼šä¸§å¤±ã€‚å› æ­¤ï¼Œç¡®ä¿<em class="filename">makefile çš„</em>è®¾è®¡å°½å¯èƒ½é«˜æ•ˆéžå¸¸é‡è¦ã€‚<em class="filename"></em><em class="command"></em><em class="filename"></em></p><p><em class="command">make</em> plays a critical role in
      the development process. It combines the elements of a project to create
      an application while allowing the developer to avoid the subtle errors
      caused by accidentally omitting steps of the build. However, if
      developers avoid using <em class="command">make</em>, because
      they feel the <em class="filename">makefile</em> is too slow,
      all the benefits of <em class="command">make</em> are lost. It
      is important, therefore, to ensure that the <em class="filename">makefile</em> be crafted to be as efficient as
      possible.</p><p>æ€§èƒ½é—®é¢˜æ˜¯<a id="OEBPS/ch10.html.make3-CHP-10-ITERM-1521" class="indexterm"></a>æ€»æ˜¯å¾ˆæ£˜æ‰‹ï¼Œä½†å½“è€ƒè™‘åˆ°ç”¨æˆ·çš„æ„ŸçŸ¥å’Œä»£ç çš„ä¸åŒè·¯å¾„æ—¶ï¼Œæƒ…å†µå˜å¾—æ›´åŠ æ£˜æ‰‹ã€‚å¹¶éž<em class="filename">makefile</em>çš„æ¯ä¸ªç›®æ ‡éƒ½å€¼å¾—ä¼˜åŒ–ã€‚æ ¹æ®æ‚¨çš„çŽ¯å¢ƒï¼Œå³ä½¿æ˜¯å½»åº•çš„ä¼˜åŒ–ä¹Ÿå¯èƒ½ä¸å€¼å¾—ã€‚ä¾‹å¦‚ï¼Œå°†æ“ä½œæ—¶é—´ä»Ž 90 åˆ†é’Ÿå‡å°‘åˆ° 45 åˆ†é’Ÿå¯èƒ½å¹¶ä¸é‡è¦ï¼Œå› ä¸ºå³ä½¿æ›´å¿«çš„æ—¶é—´ä¹Ÿæ˜¯â€œåŽ»åƒåˆé¤â€æ“ä½œã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æžœå¼€å‘äººå‘˜åœ¨è¿™æ®µæ—¶é—´æ— æ‰€äº‹äº‹ï¼Œé‚£ä¹ˆå°†ä»»åŠ¡ä»Ž 2 åˆ†é’Ÿå‡å°‘åˆ° 1 åˆ†é’Ÿå¯èƒ½ä¼šå—åˆ°æ¬¢å‘¼ã€‚</p><p>Performance issues are <a class="indexterm"></a>always tricky, but become even more so when the perception
      of users and different paths through the code are considered. Not every
      target of a <em class="filename">makefile</em> is worth
      optimizing. Even radical optimizations might not be worth the effort
      depending on your environment. For instance, reducing the time of an
      operation from 90 minutes to 45 minutes may be immaterial since even the
      faster time is a "go get lunch" operation. On the other hand, reducing a
      task from 2 minutes to 1 might be received with cheers if developers are
      twiddling their thumbs during that time.</p><p>åœ¨ç¼–å†™<em class="filename">makefile</em>ä»¥å®žçŽ°é«˜æ•ˆæ‰§è¡Œæ—¶ï¼Œäº†è§£å„ç§æ“ä½œçš„æˆæœ¬ä»¥åŠæ­£åœ¨æ‰§è¡Œå“ªäº›æ“ä½œéžå¸¸é‡è¦ã€‚åœ¨ä¸‹é¢çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†æ‰§è¡Œä¸€äº›ç®€å•çš„åŸºå‡†æµ‹è¯•æ¥é‡åŒ–è¿™äº›ä¸€èˆ¬æ€§è¯„è®ºï¼Œå¹¶æä¾›å¸®åŠ©è¯†åˆ«ç“¶é¢ˆçš„æŠ€æœ¯ã€‚</p><p>When writing a <em class="filename">makefile</em> for
      efficient execution, it is important to know the costs of various
      operations and to know what operations are being performed. In the
      following sections, we will perform some simple benchmarking to quantify
      these general comments and present techniques to help identify
      bottlenecks.</p><p>æé«˜æ€§èƒ½çš„è¡¥å……æ–¹æ³•æ˜¯åˆ©ç”¨å¹¶è¡Œæ€§å’Œæœ¬åœ°ç½‘ç»œæ‹“æ‰‘ã€‚é€šè¿‡ä¸€æ¬¡è¿è¡Œå¤šä¸ªå‘½ä»¤è„šæœ¬ï¼ˆå³ä½¿åœ¨å•å¤„ç†å™¨ä¸Šï¼‰ï¼Œå¯ä»¥å‡å°‘æž„å»ºæ—¶é—´ã€‚</p><p>A complementary approach to improving performance is to take
      advantage of parallelism and local network topology. By running more
      than one command script at a time (even on a uniprocessor), build times
      can be reduced.</p><div class="sect1" title="æ ‡æ†ç®¡ç†"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch10.html.make3-CHP-10-SECT-1"></a>æ ‡æ†ç®¡ç†</h1><h1 class="title"><a></a>Benchmarking</h1></div></div></div><p>è¿™é‡Œæˆ‘ä»¬æµ‹é‡æ€§èƒ½<a id="OEBPS/ch10.html.make3-CHP-10-ITERM-1522" class="indexterm"></a> <a id="OEBPS/ch10.html.make3-CHP-10-ITERM-1523" class="indexterm"></a><em class="command">make</em>ä¸­çš„ä¸€äº›åŸºæœ¬æ“ä½œã€‚<a class="link" href="#OEBPS/ch10.html.make3-CHP-10-TABLE-1" title="è¡¨ 10-1ã€‚è¿è¥æˆæœ¬">è¡¨ 10-1</a>æ˜¾ç¤ºäº†è¿™äº›æµ‹é‡çš„ç»“æžœã€‚æˆ‘ä»¬å°†è§£é‡Šæ¯ä¸ªæµ‹è¯•å¹¶å»ºè®®å®ƒä»¬å¦‚ä½•å½±å“æ‚¨ç¼–å†™çš„<em class="filename">makefile ã€‚</em></p><p>Here we measure the performance <a class="indexterm"></a> <a class="indexterm"></a>of some basic operations in <em class="command">make</em>. <a class="link" href="#OEBPS/ch10.html.make3-CHP-10-TABLE-1" title="Table&nbsp;10-1.&nbsp;Cost of operations">Table 10-1</a> shows the results of
        these measurements. We'll explain each test and suggest how they might
        affect <em class="filename">makefile</em>s you
        write.</p><div class="table"><a id="OEBPS/ch10.html.make3-CHP-10-TABLE-1"></a><p class="title">è¡¨ 10-1ã€‚è¿è¥æˆæœ¬</p><p class="title">Table&nbsp;10-1.&nbsp;Cost of operations</p><div class="table-contents"><table summary="Cost of operations" style="border-collapse:collapse;border-top:0.5pt solid;border-bottom:0.5pt solid;border-left:0.5pt solid;border-right:0.5pt solid"><colgroup><col><col><col><col><col><col></colgroup><thead><tr><th style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>æ‰‹æœ¯</p><p>Operation</p></th><th style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>å¤„å†³</p><p>Executions</p></th><th style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>æ¯æ¬¡æ‰§è¡Œçš„ç§’æ•° (Windows)</p><p>Seconds per execution (Windows)</p></th><th style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>æ¯ç§’æ‰§è¡Œæ¬¡æ•° (Windows)</p><p>Executions per second (Windows)</p></th><th style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>æ¯æ¬¡æ‰§è¡Œçš„ç§’æ•° (Linux)</p><p>Seconds per execution (Linux)</p></th><th style="border-bottom:0.5pt solid"><p>æ¯ç§’æ‰§è¡Œæ¬¡æ•° (Linux)</p><p>Executions per second (Linux)</p></th></tr></thead><tbody><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <code class="literal">make</code>
                ï¼ˆé‡å‡»ï¼‰</p><p> <code class="literal">make</code>
                (bash)</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>1000</p><p>1000</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0436</p><p>0.0436</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>22</p><p>22</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0162</p><p>0.0162</p></td><td style="border-bottom:0.5pt solid"><p>61</p><p>61</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <code class="literal">make</code>
                ï¼ˆç°ï¼‰</p><p> <code class="literal">make</code>
                (ash)</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>1000</p><p>1000</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0413</p><p>0.0413</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>24</p><p>24</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0151</p><p>0.0151</p></td><td style="border-bottom:0.5pt solid"><p>66</p><p>66</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <code class="literal">make</code>
                ï¼ˆå˜˜ï¼‰</p><p> <code class="literal">make</code>
                (sh)</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>1000</p><p>1000</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0452</p><p>0.0452</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>22</p><p>22</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0159</p><p>0.0159</p></td><td style="border-bottom:0.5pt solid"><p>62</p><p>62</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <code class="literal">assignment</code>
                </p><p> <code class="literal">assignment</code>
                </p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>10,000</p><p>10,000</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0001</p><p>0.0001</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>8130</p><p>8130</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0001</p><p>0.0001</p></td><td style="border-bottom:0.5pt solid"><p>10,989</p><p>10,989</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <code class="literal">subst</code>
                ï¼ˆçŸ­çš„ï¼‰</p><p> <code class="literal">subst</code>
                (short)</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>10,000</p><p>10,000</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0003</p><p>0.0003</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>3891</p><p>3891</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0003</p><p>0.0003</p></td><td style="border-bottom:0.5pt solid"><p>3846</p><p>3846</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <code class="literal">subst</code>
                ï¼ˆé•¿çš„ï¼‰</p><p> <code class="literal">subst</code>
                (long)</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>10,000</p><p>10,000</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0018</p><p>0.0018</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>ç¬¬547ç« </p><p>547</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0014</p><p>0.0014</p></td><td style="border-bottom:0.5pt solid"><p>ç¬¬704ç« </p><p>704</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <code class="literal">sed</code>
                ï¼ˆé‡å‡»ï¼‰</p><p> <code class="literal">sed</code>
                (bash)</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>, 1000</p><p>, 1000</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0910</p><p>0.0910</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>10</p><p>10</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0342</p><p>0.0342</p></td><td style="border-bottom:0.5pt solid"><p>29</p><p>29</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <code class="literal">sed</code>
                ï¼ˆç°ï¼‰</p><p> <code class="literal">sed</code>
                (ash)</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>1000</p><p>1000</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0699</p><p>0.0699</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>14</p><p>14</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0069</p><p>0.0069</p></td><td style="border-bottom:0.5pt solid"><p>144</p><p>144</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <code class="literal">sed</code>
                ï¼ˆå˜˜ï¼‰</p><p> <code class="literal">sed</code>
                (sh)</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>1000</p><p>1000</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0911</p><p>0.0911</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>10</p><p>10</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0139</p><p>0.0139</p></td><td style="border-bottom:0.5pt solid"><p>71</p><p>71</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <code class="literal">shell</code>
                ï¼ˆé‡å‡»ï¼‰</p><p> <code class="literal">shell</code>
                (bash)</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>1000</p><p>1000</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0398</p><p>0.0398</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>25</p><p>25</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0261</p><p>0.0261</p></td><td style="border-bottom:0.5pt solid"><p>38</p><p>38</p></td></tr><tr><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p> <code class="literal">shell</code>
                ï¼ˆç°ï¼‰</p><p> <code class="literal">shell</code>
                (ash)</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>1000</p><p>1000</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0253</p><p>0.0253</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>39</p><p>39</p></td><td style="border-right:0.5pt solid;border-bottom:0.5pt solid"><p>0.0018</p><p>0.0018</p></td><td style="border-bottom:0.5pt solid"><p>ç¬¬555ç« </p><p>555</p></td></tr><tr><td style="border-right:0.5pt solid"><p> <code class="literal">shell</code>
                ï¼ˆå˜˜ï¼‰</p><p> <code class="literal">shell</code>
                (sh)</p></td><td style="border-right:0.5pt solid"><p>1000</p><p>1000</p></td><td style="border-right:0.5pt solid"><p>0.0399</p><p>0.0399</p></td><td style="border-right:0.5pt solid"><p>25</p><p>25</p></td><td style="border-right:0.5pt solid"><p>0.0050</p><p>0.0050</p></td><td style=""><p>198</p><p>198</p></td></tr></tbody></table></div></div><p>Windows æµ‹è¯•åœ¨è¿è¡Œ Windows XP çš„ 1.9 GHz Pentium 4ï¼ˆå¤§çº¦ 3578 BogoMipsï¼‰<sup>[ <a id="OEBPS/ch10.html.make3-CHP-10-FNOTE-1" href="#OEBPS/ch10.html.ftn.make3-CHP-10-FNOTE-1" class="footnote">1</a> ]</sup>å’Œ 512 MB RAM ä¸Šè¿è¡Œã€‚ä½¿ç”¨äº†<em class="command">make</em> 3.80çš„ Cygwin ç‰ˆæœ¬ï¼Œä»Ž<em class="command">rxvt</em>çª—å£å¯åŠ¨ã€‚ Linux æµ‹è¯•åœ¨è¿è¡Œ Linux RedHat 9ã€å…·æœ‰ 256 MB RAM çš„ 450 MHz Pentium 2 (891 BogoMips) ä¸Šè¿è¡Œã€‚</p><p>The Windows tests were run on a 1.9-GHz Pentium 4 (approximately
        3578 BogoMips)<sup>[<a href="#OEBPS/ch10.html.ftn.make3-CHP-10-FNOTE-1" class="footnote">1</a>]</sup> with 512 MB RAM running Windows XP. The Cygwin version
        of <em class="command">make</em> 3.80 was used, started from
        an <em class="command">rxvt</em> window. The Linux tests
        were run on a 450-MHz Pentium 2 (891 BogoMips) with 256 MB of RAM
        running Linux RedHat 9.</p><p><em class="command">make</em>ä½¿ç”¨çš„å­shellå¯ä»¥å¯¹<em class="filename">makefile</em>çš„æ•´ä½“æ€§èƒ½äº§ç”Ÿé‡å¤§å½±å“ã€‚ bash shell<em class="command">â€‹</em><a id="OEBPS/ch10.html.make3-CHP-10-ITERM-1524" class="indexterm"></a> <a id="OEBPS/ch10.html.make3-CHP-10-ITERM-1525" class="indexterm"></a>æ˜¯ä¸€ä¸ªå¤æ‚çš„ã€åŠŸèƒ½é½å…¨çš„ shellï¼Œå› æ­¤å¾ˆå¤§ã€‚<em class="command">ash</em>å¤–å£³è¦å°å¾—å¤šï¼ŒåŠŸèƒ½ä¹Ÿè¾ƒå°‘ï¼Œä½†è¶³ä»¥æ»¡è¶³å¤§å¤šæ•°ä»»åŠ¡ã€‚æ›´å¤æ‚çš„æ˜¯ï¼Œå¦‚æžœä»Žæ–‡ä»¶å<span class="emphasis"><em>/bin/sh</em></span>è°ƒç”¨<em class="command">bash</em>ï¼Œå®ƒä¼šæ˜¾ç€æ”¹å˜å…¶è¡Œä¸ºä»¥æ›´ç¬¦åˆæ ‡å‡† shellã€‚åœ¨å¤§å¤šæ•° Linux ç³»ç»Ÿä¸Šï¼Œæ–‡ä»¶<em class="filename">/bin/shæ˜¯</em><em class="command">bash</em>çš„ç¬¦å·é“¾æŽ¥ï¼Œè€Œåœ¨ Cygwin ä¸­<span class="emphasis"><em>/bin/sh</em></span>å®žé™…ä¸Šæ˜¯<em class="filename">ash</em>ã€‚ä¸ºäº†è§£å†³è¿™äº›å·®å¼‚ï¼Œä¸€äº›æµ‹è¯•è¿è¡Œäº†ä¸‰æ¬¡ï¼Œæ¯æ¬¡éƒ½ä½¿ç”¨ä¸åŒçš„ shellã€‚ä½¿ç”¨çš„å¤–å£³åœ¨æ‹¬å·ä¸­æŒ‡ç¤ºã€‚å½“å‡ºçŽ°â€œ(sh)â€æ—¶ï¼Œè¡¨ç¤º<em class="command">bashå·²é“¾æŽ¥åˆ°åä¸º</em><em class="filename">/bin/sh</em>çš„æ–‡ä»¶ã€‚<span class="emphasis"><em></em></span><em class="filename"></em><em class="command"></em><span class="emphasis"><em></em></span><em class="filename"></em><em class="command"></em><em class="filename"></em></p><p>The subshell used by <em class="command">make</em> can
        have a significant effect on the overall performance of the <em class="filename">makefile</em>. The <em class="command">bash</em> shell <a class="indexterm"></a> <a class="indexterm"></a>is a complex, fully featured shell, and therefore large.
        The <em class="command">ash</em> shell is a much smaller,
        with fewer features but adequate for most tasks. To complicate
        matters, if <em class="command">bash</em> is invoked from
        the filename <span class="emphasis"><em>/bin/sh</em></span>, it alters its behavior
        significantly to conform more closely to the standard shell. On most
        Linux systems the file <em class="filename">/bin/sh</em> is
        a symbolic link to <em class="command">bash</em>, while in
        Cygwin <span class="emphasis"><em>/bin/sh</em></span> is really <em class="filename">ash</em>. To account for these differences, some
        of the tests were run three times, each time using a different shell.
        The shell used is indicated in parentheses. When "(sh)" appears, it
        means that <em class="command">bash</em> was linked to the
        file named <em class="filename">/bin/sh</em>.</p><p>å‰ä¸‰ä¸ªæµ‹è¯•ï¼ˆæ ‡è®°ä¸º makeï¼‰è¡¨æ˜Žæ— äº‹å¯åšæ—¶è¿è¡Œ<em class="command">make çš„</em>æˆæœ¬æœ‰å¤šå¤§ã€‚ç”Ÿæˆ<em class="filename">æ–‡ä»¶</em>åŒ…å«ï¼š</p><p>The first three tests, labeled make, give an indication of how
        expensive it is to run <em class="command">make</em> if
        there is nothing to do. The <em class="filename">makefile</em> contains:</p><a id="OEBPS/ch10.html.I_5_tt430"></a><pre class="programlisting">å¤–å£³:= /bin/bash
.å‡å†’ï¼šx
Xï¼š
        $(MAKE) --no-print-directory --silent --question make-bash.mk; \
        â€¦â€¦<em class="replaceable"><code>this command repeated 99 more times</code></em>â€‹</pre><pre class="programlisting">SHELL := /bin/bash
.PHONY: x
x:
        $(MAKE) --no-print-directory --silent --question make-bash.mk; \
        ...<em class="replaceable"><code>this command repeated 99 more times</code></em>...</pre><p>æ ¹æ®éœ€è¦å°†å•è¯â€œbashâ€æ›¿æ¢ä¸ºé€‚å½“çš„ shell åç§°ã€‚</p><p>The word "bash" is replaced with the appropriate shell name as
        required.</p><p>æˆ‘ä»¬ä½¿ç”¨<code class="option">â€”no-print-directory</code>å’Œ
        <code class="option">â€”silent</code>å‘½ä»¤æ¥æ¶ˆé™¤ä¸å¿…è¦çš„è®¡ç®—ï¼Œè¿™äº›è®¡ç®—å¯èƒ½ä¼šå½±å“æ—¶åºæµ‹è¯•ï¼Œå¹¶é¿å…æ—¶åºè¾“å‡ºå€¼ä¸Žä¸ç›¸å…³çš„æ–‡æœ¬æ··æ·†ã€‚è¯¥<code class="option">â€”question</code>
        é€‰é¡¹å‘Šè¯‰<em class="command">make</em>åªéœ€æ£€æŸ¥ä¾èµ–å…³ç³»è€Œä¸æ‰§è¡Œä»»ä½•å‘½ä»¤ï¼Œå¦‚æžœæ–‡ä»¶æ˜¯æœ€æ–°çš„ï¼Œåˆ™è¿”å›žé€€å‡ºçŠ¶æ€ä¸ºé›¶ã€‚è¿™ä½¿å¾—<em class="command">make</em>å¯ä»¥åšå°½å¯èƒ½å°‘çš„å·¥ä½œã€‚æ­¤<em class="filename">makefile</em>ä¸ä¼šæ‰§è¡Œä»»ä½•å‘½ä»¤ï¼Œå¹¶ä¸”ä»…å­˜åœ¨ä¸€ä¸ª<code class="literal">.PHONY</code>ç›®æ ‡çš„ä¾èµ–å…³ç³»ã€‚å‘½ä»¤è„šæœ¬æ‰§è¡Œ<em class="command">make</em> 100 æ¬¡ã€‚è¿™ä¸ªåä¸º<em class="filename">make-bash.mkçš„</em><em class="filename">makefileç”±çˆ¶</em><em class="filename">makefile</em>ä½¿ç”¨ä»¥ä¸‹ä»£ç æ‰§è¡Œ 10 æ¬¡ï¼š<em class="filename"></em><em class="filename"></em></p><p>We use the <code class="option">â€”no-print-directory</code> and
        <code class="option">â€”silent</code> commands to eliminate unnecessary computation
        that might skew the timing test and to avoid cluttering the timing
        output values with irrelevant text. The <code class="option">â€”question</code>
        option tells <em class="command">make</em> to simply check
        the dependencies without executing any commands and return an exit
        status of zero if the files are up to date. This allows <em class="command">make</em> to do as little work as possible. No
        commands will be executed by this <em class="filename">makefile</em> and dependencies exist for only
        one <code class="literal">.PHONY</code> target. The command
        script executes <em class="command">make</em> 100 times.
        This <em class="filename">makefile</em>, called <em class="filename">make-bash.mk</em>, is executed 10 times by a
        parent <em class="filename">makefile</em> with this
        code:</p><a id="OEBPS/ch10.html.I_5_tt431"></a><pre class="programlisting">å®šä¹‰åæ¬¡
  æµ‹è¯• += 1 ç¾Žå…ƒ
  .å‡è´§ï¼š1ç¾Žå…ƒ
  1 ç¾Žå…ƒï¼š
        @echo $(MAKE) --no-print-directory --silent $2; \
        æ—¶é—´ $(MAKE) --no-print-directory --silent $2; \
        æ—¶é—´ $(MAKE) --no-print-directory --silent $2; \
        æ—¶é—´ $(MAKE) --no-print-directory --silent $2; \
        æ—¶é—´ $(MAKE) --no-print-directory --silent $2; \
        æ—¶é—´ $(MAKE) --no-print-directory --silent $2; \
        æ—¶é—´ $(MAKE) --no-print-directory --silent $2; \
        æ—¶é—´ $(MAKE) --no-print-directory --silent $2; \
        æ—¶é—´ $(MAKE) --no-print-directory --silent $2; \
        æ—¶é—´ $(MAKE) --no-print-directory --silent $2; \
        æ—¶é—´ $(MAKE) --no-print-directory --silent $2
æ©å¾·å¤«

.PHONYï¼šå…¨éƒ¨
å…¨éƒ¨ï¼š

$(eval $(è°ƒç”¨åæ¬¡, make-bash, -f make-bash.mk))

å…¨éƒ¨ï¼š$ï¼ˆæµ‹è¯•ï¼‰</pre><pre class="programlisting">define ten-times
  TESTS += $1
  .PHONY: $1
  $1:
        @echo $(MAKE) --no-print-directory --silent $2; \
        time $(MAKE) --no-print-directory --silent $2; \
        time $(MAKE) --no-print-directory --silent $2; \
        time $(MAKE) --no-print-directory --silent $2; \
        time $(MAKE) --no-print-directory --silent $2; \
        time $(MAKE) --no-print-directory --silent $2; \
        time $(MAKE) --no-print-directory --silent $2; \
        time $(MAKE) --no-print-directory --silent $2; \
        time $(MAKE) --no-print-directory --silent $2; \
        time $(MAKE) --no-print-directory --silent $2; \
        time $(MAKE) --no-print-directory --silent $2
endef

.PHONY: all
all:

$(eval $(call ten-times, make-bash, -f make-bash.mk))

all: $(TESTS)</pre><p>ç„¶åŽå¯¹è¿™ 1,000 æ¬¡æ‰§è¡Œçš„æ—¶é—´è¿›è¡Œå¹³å‡ã€‚</p><p>The time for these 1,000 executions is then averaged.</p><p>ä»Žè¡¨ä¸­å¯ä»¥çœ‹å‡ºï¼ŒCygwin çš„<em class="command">å“ç‰Œ</em>è¿è¡Œäº†<a id="OEBPS/ch10.html.make3-CHP-10-ITERM-1526" class="indexterm"></a> <a id="OEBPS/ch10.html.make3-CHP-10-ITERM-1527" class="indexterm"></a>æ¯ç§’å¤§çº¦æ‰§è¡Œ 22 æ¬¡æˆ–æ¯æ¬¡è¿è¡Œ 0.044 ç§’ï¼Œè€Œ Linux ç‰ˆæœ¬ï¼ˆå³ä½¿åœ¨é€Ÿåº¦æ…¢å¾—å¤šçš„ CPU ä¸Šï¼‰æ¯ç§’å¤§çº¦æ‰§è¡Œ 61 æ¬¡æˆ–æ¯æ¬¡è¿è¡Œ 0.016 ç§’ã€‚ä¸ºäº†éªŒè¯è¿™äº›ç»“æžœï¼Œè¿˜æµ‹è¯•äº†æœ¬æœº Windows ç‰ˆæœ¬çš„<em class="command">make</em>ï¼Œä½†æ²¡æœ‰äº§ç”Ÿä»»ä½•æ˜¾ç€çš„åŠ é€Ÿã€‚ç»“è®ºï¼šè™½ç„¶ Cygwin
         <em class="command">makeä¸­çš„è¿›ç¨‹åˆ›å»ºæ¯”æœ¬æœº Windows </em><em class="command">make</em>ç¨æ…¢ï¼Œä½†ä¸¤è€…éƒ½æ¯” Linux æ…¢å¾—å¤šã€‚å®ƒè¿˜è¡¨æ˜Žï¼Œ
        åœ¨ Windows å¹³å°ä¸Šä½¿ç”¨é€’å½’<em class="command">makeçš„æ‰§è¡Œé€Ÿåº¦å¯èƒ½ä¼šæ¯”åœ¨ Linux ä¸Šè¿è¡Œç›¸åŒæž„å»ºçš„é€Ÿåº¦æ…¢å¾—å¤šã€‚</em></p><p>As you can see from the table, the Cygwin <em class="command">make</em> ran <a class="indexterm"></a> <a class="indexterm"></a>at roughly 22 executions per second or 0.044 seconds per
        run, while the Linux version (even on a drastically slower CPU)
        performed roughly 61 executions per second or 0.016 seconds per run.
        To verify these results, the native Windows version of <em class="command">make</em> was also tested and did not yield any
        dramatic speed up. Conclusion: while process creation in Cygwin
        <em class="command">make</em> is slightly slower than a
        native Windows <em class="command">make</em>, both are
        dramatically slower than Linux. It also suggests that use of recursive
        <em class="command">make</em> on a Windows platform may
        perform significantly slower than the same build run on Linux.</p><p>æ­£å¦‚æ‚¨æ‰€æœŸæœ›çš„ï¼Œæ­¤æµ‹è¯•ä¸­ä½¿ç”¨çš„ shell å¯¹æ‰§è¡Œæ—¶é—´æ²¡æœ‰å½±å“ã€‚ç”±äºŽå‘½ä»¤è„šæœ¬ä¸åŒ…å« shell ç‰¹æ®Šå­—ç¬¦ï¼Œå› æ­¤æ ¹æœ¬ä¸ä¼šè°ƒç”¨ shellã€‚ç›¸åï¼Œ<em class="command">make</em>ç›´æŽ¥æ‰§è¡Œå‘½ä»¤ã€‚è¿™å¯ä»¥é€šè¿‡å°†<code class="literal">SHELL</code>å˜é‡è®¾ç½®ä¸ºå®Œå…¨è™šå‡çš„å€¼å¹¶æ³¨æ„æµ‹è¯•ä»ç„¶æ­£ç¡®è¿è¡Œæ¥éªŒè¯ã€‚ä¸‰ä¸ª shell ä¹‹é—´çš„æ€§èƒ½å·®å¼‚å¿…é¡»å½’å› äºŽæ­£å¸¸çš„ç³»ç»Ÿå·®å¼‚ã€‚</p><p>As you would expect, the shell used in this test had no effect
        on execution time. Because the command script contained no shell
        special characters, the shell was not invoked at all. Rather, <em class="command">make</em> executed the commands directly. This
        can be verified by setting the <code class="literal">SHELL</code> variable to a completely bogus value
        and noting that the test still runs correctly. The difference in
        performance between the three shells must be attributed to normal
        system variance.</p><p>ä¸‹ä¸€ä¸ªåŸºå‡†æŽªæ–½<a id="OEBPS/ch10.html.make3-CHP-10-ITERM-1528" class="indexterm"></a> <a id="OEBPS/ch10.html.make3-CHP-10-ITERM-1529" class="indexterm"></a>å˜é‡èµ‹å€¼çš„é€Ÿåº¦ã€‚è¿™æ ¡å‡†äº†æœ€åŸºæœ¬çš„<em class="command">make</em>æ“ä½œã€‚ makefile
        ç§°ä¸º<em class="filename">allocate.mk </em><em class="filename">ï¼Œ</em>åŒ…å«ï¼š</p><p>The next benchmark measures <a class="indexterm"></a> <a class="indexterm"></a>the speed of variable assignment. This calibrates the
        most elementary <em class="command">make</em> operation. The
        <em class="filename">makefile</em>, called <em class="filename">assign.mk</em>, contains:</p><a id="OEBPS/ch10.html.I_5_tt432"></a><pre class="programlisting"># 10000 ä¸ªä½œä¸š
z := 10<em class="replaceable"><code>...repeated 10000 times...</code></em>
.å‡å†’ï¼šx
Xï¼š ;</pre><pre class="programlisting"># 10000 assignments
z := 10<em class="replaceable"><code>...repeated 10000 times...</code></em>
.PHONY: x
x: ;</pre><p>ç„¶åŽä½¿ç”¨çˆ¶<em class="filename">makefile</em>ä¸­çš„å‡½æ•°è¿è¡Œè¯¥<em class="filename">makefile</em>ã€‚<code class="function">ten-times</code><em class="filename"></em></p><p>This <em class="filename">makefile</em> is then run
        using our <code class="function">ten-times</code> function in
        the parent <em class="filename">makefile</em>.</p><p>ä»»åŠ¡æ˜¾ç„¶å¾ˆå¿«ã€‚ Cygwin <em class="command">make</em>æ¯ç§’å°†æ‰§è¡Œ 8130 æ¬¡åˆ†é…ï¼Œè€Œ Linux ç³»ç»Ÿå¯ä»¥æ‰§è¡Œ 10,989 æ¬¡ã€‚æˆ‘ç›¸ä¿¡ Windows å¯¹äºŽå¤§å¤šæ•°è¿™äº›æ“ä½œçš„æ€§èƒ½å®žé™…ä¸Šæ¯”åŸºå‡†æµ‹è¯•æ˜¾ç¤ºçš„è¦å¥½ï¼Œå› ä¸ºåˆ›å»º10 æ¬¡<em class="command">make</em>è¿›ç¨‹çš„æˆæœ¬æ— æ³•å¯é åœ°ä»Žæ—¶é—´ä¸­æ‰£é™¤ã€‚ç»“è®ºï¼šç”±äºŽå¹³å‡<em class="filename">makefile</em>ä¸å¤ªå¯èƒ½æ‰§è¡Œ 10,000 æ¬¡èµ‹å€¼ï¼Œå› æ­¤å¹³å‡<em class="filename">makefile</em>ä¸­å˜é‡èµ‹å€¼çš„æˆæœ¬
        å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</p><p>The assignment is obviously very fast. Cygwin <em class="command">make</em> will execute 8130 assignments per
        second while the Linux system can do 10,989. I believe the performance
        of Windows for most of these operations is actually better than the
        benchmark indicates because the cost of creating the <em class="command">make</em> process 10 times cannot be reliably
        factored out of the time. Conclusion: because it is unlikely that the
        average <em class="filename">makefile</em> would perform
        10,000 assignments, the cost of variable assignment in an average
        <em class="filename">makefile</em> is negligible.</p><p>æŽ¥ä¸‹æ¥çš„ä¸¤ä¸ªåŸºå‡†è¡¡é‡<a id="OEBPS/ch10.html.make3-CHP-10-ITERM-1530" class="indexterm"></a>å‡½æ•°è°ƒç”¨çš„æˆæœ¬<code class="function">subst</code>
        ã€‚ç¬¬ä¸€ä¸ªä½¿ç”¨ 10 ä¸ªå­—ç¬¦çš„çŸ­å­—ç¬¦ä¸²ï¼Œå¹¶è¿›è¡Œä¸‰ä¸ªæ›¿æ¢ï¼š</p><p>The next two benchmarks measure the <a class="indexterm"></a>cost of a <code class="function">subst</code>
        function call. The first uses a short 10-character string with three
        substitutions:</p><a id="OEBPS/ch10.html.I_5_tt433"></a><pre class="programlisting"># 10 ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ä¸Šæœ‰ 10000 ä¸ª subst
ç›®å½• := ab/cd/ef/g
x := $(subst /, ,$(dir))<em class="replaceable"><code>...repeated 10000 times...</code></em>
.å‡å†’ï¼šx
Xï¼š ;</pre><pre class="programlisting"># 10000 subst on a 10 char string
dir := ab/cd/ef/g
x := $(subst /, ,$(dir))<em class="replaceable"><code>...repeated 10000 times...</code></em>
.PHONY: x
x: ;</pre><p>æ­¤æ“ä½œå¤§çº¦éœ€è¦ä¸¤å€äºŽç®€å•åˆ†é…çš„æ—¶é—´ï¼Œå³ Windows ä¸Šæ¯ç§’ 3891 æ¬¡æ“ä½œã€‚åŒæ ·ï¼ŒLinux ç³»ç»Ÿçš„æ€§èƒ½ä¼¼ä¹Žå¤§å¹…ä¼˜äºŽ Windows ç³»ç»Ÿã€‚ ï¼ˆè¯·è®°ä½ï¼ŒLinux ç³»ç»Ÿçš„è¿è¡Œæ—¶é’Ÿé€Ÿåº¦ä¸åˆ° Windows ç³»ç»Ÿçš„å››åˆ†ä¹‹ä¸€ã€‚ï¼‰</p><p>This operation takes roughly twice as long as a simple
        assignment, or 3891 operations per second on Windows. Again, the Linux
        system appears to outperform the Windows system by a wide margin.
        (Remember, the Linux system is running at less than one quarter the
        clock speed of the Windows system.)</p><p>è¾ƒé•¿çš„æ›¿æ¢å¯¹ 1000 ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²è¿›è¡Œæ“ä½œï¼Œå¤§çº¦è¿›è¡Œ 100 æ¬¡æ›¿æ¢ï¼š</p><p>The longer substitution operates on a 1000-character string with
        roughly 100 substitutions:</p><a id="OEBPS/ch10.html.I_5_tt434"></a><pre class="programlisting"># åä¸ªå­—ç¬¦æ–‡ä»¶
ç›®å½• := ab/cd/ef/g
# 1000 ä¸ªå­—ç¬¦è·¯å¾„
p100 := $(ç›®å½•);$(ç›®å½•);$(ç›®å½•);$(ç›®å½•);$(ç›®å½•);...
p1000 := $(p100)$(p100)$(p100)$(p100)$(p100)...

# 1000 ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ä¸Šæœ‰ 10000 ä¸ª subst
x := $(subst ;, ,$(p1000))<em class="replaceable"><code>...repeated 10000 times...</code></em>
.å‡å†’ï¼šx
Xï¼š ;</pre><pre class="programlisting"># Ten character file
dir := ab/cd/ef/g
# 1000 character path
p100 := $(dir);$(dir);$(dir);$(dir);$(dir);...
p1000 := $(p100)$(p100)$(p100)$(p100)$(p100)...

# 10000 subst on a 1000 char string
x := $(subst ;, ,$(p1000))<em class="replaceable"><code>...repeated 10000 times...</code></em>
.PHONY: x
x: ;</pre><p><em class="command">æŽ¥ä¸‹æ¥çš„ä¸‰ä¸ªåŸºå‡†æµ‹è¯•ä½¿ç”¨sed</em>æµ‹é‡ç›¸åŒæ›¿æ¢çš„é€Ÿåº¦ã€‚è¯¥åŸºå‡†åŒ…å«ï¼š</p><p>The next three benchmarks measure the speed of the same
        substitution using <em class="command">sed</em>. The
        benchmark contains:</p><a id="OEBPS/ch10.html.I_5_tt435"></a><pre class="programlisting"># 100 ä½¿ç”¨ bash çš„ sed
å¤–å£³:= /bin/bash
.PHONYï¼šsed-bash
sed-bashï¼š
        å›žå£°'$(p1000)'| sed 's/;/ /g' &gt; /dev/null<em class="replaceable"><code> ...repeated 100 times...</code></em></pre><pre class="programlisting"># 100 sed using bash
SHELL := /bin/bash
.PHONY: sed-bash
sed-bash:
        echo '$(p1000)' | sed 's/;/ /g' &gt; /dev/null<em class="replaceable"><code> ...repeated 100 times...</code></em></pre><p>åƒå¾€å¸¸ä¸€æ ·ï¼Œè¿™ä¸ª<em class="filename">makefile</em>æ˜¯ä½¿ç”¨<code class="function">ten-times</code>
        å‡½æ•°æ‰§è¡Œçš„ã€‚åœ¨ Windows ä¸Šï¼Œ<em class="command">sed çš„</em>æ‰§è¡Œæ—¶é—´æ¯”å‡½æ•°é•¿å¤§çº¦ 50 å€<code class="function">subst</code>ã€‚åœ¨æˆ‘ä»¬çš„ Linux ç³»ç»Ÿä¸Šï¼Œ
         <em class="command">sed</em>ä»…æ…¢ 24 å€ã€‚</p><p>As usual, this <em class="filename">makefile</em> is
        executed using the <code class="function">ten-times</code>
        function. On Windows, <em class="command">sed</em> execution
        takes about 50 times longer than the <code class="function">subst</code> function. On our Linux system,
        <em class="command">sed</em> is only 24 times slower.</p><p>å½“æˆ‘ä»¬è€ƒè™‘åˆ° shell çš„æˆæœ¬æ—¶ï¼Œæˆ‘ä»¬å‘çŽ°Windows ä¸Šçš„<em class="command">ash</em>ç¡®å®žæä¾›äº†æœ‰ç”¨çš„åŠ é€Ÿã€‚ä½¿ç”¨<em class="command">ash</em>ï¼Œ<em class="command">sed</em>åªæ¯” subst æ…¢ 39 å€ï¼ ï¼ˆçœ¨çœ¼ï¼‰åœ¨ Linux ä¸Šï¼Œæ‰€ä½¿ç”¨çš„ shell å…·æœ‰æ›´æ·±è¿œçš„å½±å“ã€‚ä½¿ç”¨
        <em class="command">ash</em>ï¼Œ<em class="command">sed</em>ä»…æ¯” æ…¢äº”å€<code class="function">subst</code>ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬è¿˜æ³¨æ„åˆ°å°†<em class="command">bash</em>é‡å‘½åä¸º<em class="command">sh</em>çš„å¥‡æ€ªæ•ˆæžœã€‚åœ¨ Cygwin ä¸Šï¼Œåä¸º<em class="command">/bin/bash çš„</em><em class="command">bash</em>å’Œåä¸º<em class="command">/bin/sh</em>çš„ bashä¹‹é—´æ²¡æœ‰åŒºåˆ«ï¼Œä½†åœ¨ Linux ä¸Šï¼Œé“¾æŽ¥åˆ°<em class="command">/bin/sh çš„</em><em class="command">bash</em>æ€§èƒ½æ˜Žæ˜¾æ›´å¥½ã€‚<em class="command"></em><em class="command"></em><em class="command"></em><em class="command"></em></p><p>When we factor in the cost of the shell, we see that <em class="command">ash</em> on Windows does provide a useful
        speed-up. With <em class="command">ash</em>, the <em class="command">sed</em> is only 39 times slower than subst!
        (wink) On Linux, the shell used has a much more profound effect. Using
        <em class="command">ash</em>, the <em class="command">sed</em> is only five times slower than <code class="function">subst</code>. Here we also notice the curious
        effect of renaming <em class="command">bash</em> to <em class="command">sh</em>. On Cygwin, there is no difference
        between a <em class="command">bash</em> named <em class="command">/bin/bash</em> and one named <em class="command">/bin/sh</em>, but on Linux, a <em class="command">bash</em> linked to <em class="command">/bin/sh</em> performs significantly
        better.</p><p>æœ€ç»ˆçš„åŸºå‡†å¾ˆç®€å•<a id="OEBPS/ch10.html.make3-CHP-10-ITERM-1531" class="indexterm"></a>è°ƒç”¨<em class="command">make</em>
        <code class="function">shell</code>å‘½ä»¤æ¥è¯„ä¼°è¿è¡Œå­ shell çš„æˆæœ¬ã€‚ç”Ÿæˆ<em class="filename">æ–‡ä»¶</em>åŒ…å«ï¼š</p><p>The final benchmark simply <a class="indexterm"></a>invokes the <em class="command">make</em>
        <code class="function">shell</code> command to evaluate the
        cost of running a subshell. The <em class="filename">makefile</em> contains:</p><a id="OEBPS/ch10.html.I_5_tt436"></a><pre class="programlisting"># 100 $(shell ) ä½¿ç”¨ bash
å¤–å£³:= /bin/bash
x := $(å¤–å£³:)<em class="replaceable"><code>...repeated 100 times...</code></em>
.å‡å†’ï¼šx
Xï¼š ;</pre><pre class="programlisting"># 100 $(shell ) using bash
SHELL := /bin/bash
x := $(shell :)<em class="replaceable"><code>...repeated 100 times...</code></em>
.PHONY: x
x: ;</pre><p>è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆæƒŠå–œã€‚ Windowsç³»ç»Ÿæ¯”Linuxæ…¢ï¼Œ<em class="command">ashæ¯”</em><em class="command">bash</em>æœ‰ä¼˜åŠ¿
        ã€‚<em class="command">ash</em>çš„æ€§èƒ½æå‡
        æ›´ä¸ºæ˜Žæ˜¾ï¼Œå¤§çº¦<code class="literal">%</code>å¿« 50 å€ã€‚ Linux ç³»ç»Ÿä½¿ç”¨<em class="command">ash</em>æ—¶æ€§èƒ½æœ€ä½³ï¼Œä½¿ç”¨<em class="command">bash</em>ï¼ˆå½“å‘½åä¸ºâ€œbashâ€æ—¶ï¼‰æ—¶æ€§èƒ½æœ€æ…¢ã€‚</p><p>There are no surprises here. The Windows system is slower than
        Linux, with <em class="command">ash</em> having an edge over
        <em class="command">bash</em>. The performance gain of
        <em class="command">ash</em> is more pronouncedâ€”about
        50<code class="literal">%</code> faster. The Linux system
        performs best with <em class="command">ash</em> and slowest
        with <em class="command">bash</em> (when named
        "bash").</p><p>åŸºå‡†æµ‹è¯•æ˜¯ä¸€é¡¹æ°¸æ— æ­¢å¢ƒçš„ä»»åŠ¡ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬æ‰€åšçš„æµ‹é‡å¯ä»¥æä¾›ä¸€äº›æœ‰ç”¨çš„è§è§£ã€‚åˆ›å»ºå°½å¯èƒ½å¤šçš„å˜é‡ï¼Œåªè¦å®ƒä»¬æœ‰åŠ©äºŽé˜æ˜Ž<em class="filename">makefile</em>çš„ç»“æž„ï¼Œå› ä¸ºå®ƒä»¬æœ¬è´¨ä¸Šæ˜¯å…è´¹çš„ã€‚å³ä½¿ä»£ç ç»“æž„è¦æ±‚æ‚¨é‡å¤åœ°é‡æ–°æ‰§è¡Œ<em class="command">make</em>å‡½æ•°ï¼Œå†…ç½®<em class="command">make</em>å‡½æ•°ä¹Ÿä¼˜äºŽè¿è¡Œå‘½ä»¤ã€‚é¿å…åœ¨ Windows ä¸Šè¿›è¡Œé€’å½’
        <em class="command">make</em>æˆ–ä¸å¿…è¦çš„è¿›ç¨‹åˆ›å»ºã€‚åœ¨ Linux ä¸Šï¼Œå¦‚æžœè¦åˆ›å»ºè®¸å¤šè¿›ç¨‹ï¼Œè¯·ä½¿ç”¨<em class="command">ash ã€‚</em><em class="command"></em><em class="command"></em><em class="command"></em></p><p>Benchmarking is a never-ending task, however, the measurements
        we've made can provide some useful insight. Create as many variables
        as you like if they help clarify the structure of the <em class="filename">makefile</em> because they are essentially free.
        Built-in <em class="command">make</em> functions are
        preferred over running commands even if you are required by the
        structure of your code to reexecute the <em class="command">make</em> function repeatedly. Avoid recursive
        <em class="command">make</em> or unnecessary process
        creation on Windows. While on Linux, use <em class="command">ash</em> if you are creating many
        processes.</p><p>æœ€åŽï¼Œè¯·è®°ä½ï¼Œåœ¨å¤§å¤šæ•°<em class="filename">makefileä¸­ï¼Œ </em><em class="filename">makefile</em>è¿è¡Œæ‰€éœ€çš„æ—¶é—´å‡ ä¹Žå®Œå…¨å–å†³äºŽç¨‹åºè¿è¡Œçš„æˆæœ¬ï¼Œè€Œä¸æ˜¯<em class="command">makeæˆ–</em><em class="filename">makefile</em>çš„ç»“æž„ã€‚é€šå¸¸ï¼Œå‡å°‘è¿è¡Œçš„ç¨‹åºæ•°é‡å¯¹äºŽå‡å°‘
        <em class="filename">makefile</em>çš„æ‰§è¡Œæ—¶é—´æœ€æœ‰å¸®åŠ©ã€‚</p><p>Finally, remember that in most <em class="filename">makefile</em>s, the time a <em class="filename">makefile</em> takes to run is due almost
        entirely to the cost of the programs run, not <em class="command">make</em> or the structure of the <em class="filename">makefile</em>. Usually, reducing the number of
        programs run will be most helpful in reducing the execution time of a
        <em class="filename">makefile</em>.</p></div><div class="footnotes"><br><br><hr><div class="footnote"><p><sup>[ <a id="OEBPS/ch10.html.ftn.make3-CHP-10-FNOTE-1" href="#OEBPS/ch10.html.make3-CHP-10-FNOTE-1" class="para">1</a> ]</sup>è¯·å‚é˜…<a class="ulink" href="http://www.clifton.nl/bogomips.html">http://www.clifton.nl/bogomips.html</a>äº†è§£ BogoMips çš„è¯´æ˜Žã€‚</p><p><sup>[<a href="#OEBPS/ch10.html.make3-CHP-10-FNOTE-1" class="para">1</a>] </sup>See <a class="ulink" href="http://www.clifton.nl/bogomips.html">http://www.clifton.nl/bogomips.html</a> for an
            explanation of BogoMips.</p></div></div></div></div></div>
<div id="OEBPS/ch10s02.html"><div>
<div class="sect1" title="è¯†åˆ«å’Œå¤„ç†ç“¶é¢ˆ"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch10s02.html.make3-CHP-10-SECT-2"></a>è¯†åˆ«å’Œå¤„ç†ç“¶é¢ˆ</h1><h1 class="title"><a></a>Identifying and Handling Bottlenecks</h1></div></div></div><p><em class="filename">makefile</em>ä¸­å‡ºçŽ°ä¸å¿…è¦çš„å»¶è¿Ÿ<a id="OEBPS/ch10s02.html.make3-CHP-10-ITERM-1532" class="indexterm"></a> <a id="OEBPS/ch10s02.html.make3-CHP-10-ITERM-1533" class="indexterm"></a>æœ‰å‡ ä¸ªæ¥æºï¼š<em class="filename">makefile</em>çš„ç»“æž„ä¸è‰¯ã€ä¾èµ–æ€§åˆ†æžä¸è‰¯ä»¥åŠ<em class="command">make</em>å‡½æ•°å’Œå˜é‡çš„ä½¿ç”¨ä¸è‰¯ã€‚è¿™äº›é—®é¢˜å¯ä»¥é€šè¿‡<em class="command">make</em>å‡½æ•°æ¥æŽ©ç›–ï¼Œä¾‹å¦‚<code class="function">shell</code>è°ƒç”¨å‘½ä»¤è€Œä¸å›žæ˜¾å‘½ä»¤ï¼Œä»Žè€Œå¾ˆéš¾æ‰¾åˆ°å»¶è¿Ÿçš„æ ¹æºã€‚</p><p>Unnecessary delays in <em class="filename">makefile</em>s come <a class="indexterm"></a> <a class="indexterm"></a>from several sources: poor structuring of the <em class="filename">makefile</em>, poor dependency analysis, and
        poor use of <em class="command">make</em> functions and
        variables. These problems can be masked by <em class="command">make</em> functions such as <code class="function">shell</code> that invoke commands without echoing
        them, making it difficult to find the source of the delay.</p><p>ä¾èµ–æ€§åˆ†æžæ˜¯ä¸€æŠŠåŒåˆƒå‰‘ã€‚ä¸€æ–¹é¢ï¼Œå¦‚æžœæ‰§è¡Œå®Œæ•´çš„ä¾èµ–æ€§åˆ†æžï¼Œåˆ™åˆ†æžæœ¬èº«å¯èƒ½ä¼šå¯¼è‡´æ˜¾ç€çš„å»¶è¿Ÿã€‚å¦‚æžœæ²¡æœ‰ç‰¹æ®Šçš„ç¼–è¯‘å™¨æ”¯æŒï¼ˆä¾‹å¦‚<em class="command">gcc</em>æˆ–<em class="command">jikes</em>æä¾›çš„æ”¯æŒï¼‰ï¼Œåˆ›å»ºä¾èµ–æ–‡ä»¶éœ€è¦è¿è¡Œå¦ä¸€ä¸ªç¨‹åºï¼Œè¿™å‡ ä¹Žä½¿ç¼–è¯‘æ—¶é—´å¢žåŠ äº†ä¸€å€ã€‚<sup>[ <a id="OEBPS/ch10s02.html.make3-CHP-10-FNOTE-2" href="#OEBPS/ch10s02.html.ftn.make3-CHP-10-FNOTE-2" class="footnote">2</a> ]</sup>å®Œæ•´çš„ä¾èµ–åˆ†æžçš„ä¼˜ç‚¹æ˜¯å®ƒå…è®¸<em class="command">make</em>æ‰§è¡Œæ›´å°‘çš„ç¼–è¯‘ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå¼€å‘äººå‘˜å¯èƒ½ä¸ç›¸ä¿¡è¿™ä¸ªå¥½å¤„å·²ç»å®žçŽ°ï¼Œå¹¶ä¸”ç¼–å†™äº†åŒ…å«ä¸å¤ªå®Œæ•´çš„ä¾èµ–ä¿¡æ¯çš„<em class="filename">makefile</em> ã€‚è¿™ç§å¦¥åå‡ ä¹Žæ€»æ˜¯ä¼šå¯¼è‡´å¼€å‘é—®é¢˜çš„å¢žåŠ ï¼Œå¯¼è‡´å…¶ä»–å¼€å‘äººå‘˜é€šè¿‡ç¼–è¯‘æ¯”åŽŸå§‹å®Œæ•´ä¾èµ–ä¿¡æ¯æ‰€éœ€çš„æ›´å¤šä»£ç æ¥è¿›è¡Œè¿‡åº¦è¡¥å¿ã€‚</p><p>Dependency analysis is a two-edged sword. On the one hand, if
        complete dependency analysis is performed, the analysis itself may
        incur significant delays. Without special compiler support, such as
        supplied by <em class="command">gcc</em> or <em class="command">jikes</em>, creating a dependency file requires
        running another program, nearly doubling compilation time.<sup>[<a href="#OEBPS/ch10s02.html.ftn.make3-CHP-10-FNOTE-2" class="footnote">2</a>]</sup> The advantage of complete dependency analysis is that it
        allows <em class="command">make</em> to perform fewer
        compiles. Unfortunately, developers may not believe this benefit is
        realized and write <em class="filename">makefile</em>s with
        less complete dependency information. This compromise almost always
        leads to an increase in development problems, leading other developers
        to overcompensate by compiling more code than would be required with
        the original, complete dependency information.</p><p>åˆ¶å®šä¾èµ–å…³ç³»<a id="OEBPS/ch10s02.html.make3-CHP-10-ITERM-1534" class="indexterm"></a> <a id="OEBPS/ch10s02.html.make3-CHP-10-ITERM-1535" class="indexterm"></a>åˆ†æžç­–ç•¥ï¼Œé¦–å…ˆè¦äº†è§£é¡¹ç›®å›ºæœ‰çš„ä¾èµ–å…³ç³»ã€‚äº†è§£å®Œæ•´çš„ä¾èµ–å…³ç³»ä¿¡æ¯åŽï¼Œæ‚¨å¯ä»¥é€‰æ‹©åœ¨
        <em class="filename">makefile</em>ä¸­è¡¨ç¤ºå¤šå°‘å†…å®¹ï¼ˆè®¡ç®—çš„æˆ–ç¡¬ç¼–ç çš„ï¼‰ä»¥åŠåœ¨æž„å»ºè¿‡ç¨‹ä¸­å¯ä»¥é‡‡ç”¨å“ªäº›å¿«æ·æ–¹å¼ã€‚è™½ç„¶è¿™ä¸€åˆ‡éƒ½ä¸æ˜¯é‚£ä¹ˆç®€å•ï¼Œä½†å®ƒå¾ˆç®€å•ã€‚</p><p>To formulate a dependency <a class="indexterm"></a> <a class="indexterm"></a>analysis strategy, begin by understanding the
        dependencies inherent in the project. Once complete dependency
        information is understood, you can choose how much to represent in the
        <em class="filename">makefile</em> (computed or hardcoded)
        and what shortcuts can be taken during the build. Although none of
        this is exactly simple, it is straightforward.</p><p>ä¸€æ—¦ç¡®å®šäº†<em class="filename">makefile</em>ç»“æž„å’Œå¿…è¦çš„ä¾èµ–å…³ç³»ï¼Œå®žçŽ°é«˜æ•ˆçš„<em class="filename">makefile</em>é€šå¸¸å°±æ˜¯é¿å…ä¸€äº›ç®€å•é™·é˜±çš„é—®é¢˜ã€‚</p><p>Once you've determined your <em class="filename">makefile</em> structure and necessary
        dependencies, implementing an efficient <em class="filename">makefile</em> is usually a matter of avoiding
        some simple pitfalls.</p><div class="sect2" title="ç®€å•å˜é‡ä¸Žé€’å½’"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch10s02.html.make3-CHP-10-SECT-2.1"></a>ç®€å•å˜é‡ä¸Žé€’å½’</h2><h2 class="title"><a></a>Simple Variables Versus Recursive</h2></div></div></div><p>æœ€å¸¸è§çš„ä¸€ç§<a id="OEBPS/ch10s02.html.make3-CHP-10-ITERM-1536" class="indexterm"></a> <a id="OEBPS/ch10s02.html.make3-CHP-10-ITERM-1537" class="indexterm"></a> <a id="OEBPS/ch10s02.html.make3-CHP-10-ITERM-1538" class="indexterm"></a> <a id="OEBPS/ch10s02.html.make3-CHP-10-ITERM-1539" class="indexterm"></a> <a id="OEBPS/ch10s02.html.make3-CHP-10-ITERM-1540" class="indexterm"></a> <a id="OEBPS/ch10s02.html.make3-CHP-10-ITERM-1541" class="indexterm"></a>ä¸Žæ€§èƒ½ç›¸å…³çš„é—®é¢˜æ˜¯ä½¿ç”¨é€’å½’å˜é‡è€Œä¸æ˜¯ç®€å•å˜é‡ã€‚ä¾‹å¦‚ï¼Œç”±äºŽä»¥ä¸‹ä»£ç ä½¿ç”¨<code class="literal">=</code>
          è¿ç®—ç¬¦è€Œä¸æ˜¯ï¼Œå› æ­¤æ¯æ¬¡ä½¿ç”¨è¯¥å˜é‡æ—¶<code class="literal">:=</code>éƒ½ä¼šæ‰§è¡Œ<em class="command">dateå‘½ä»¤ï¼š</em><code class="literal">DATE</code></p><p>One of the most common <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>performance-related problems is using recursive
          variables instead of simple variables. For example, because the
          following code uses the <code class="literal">=</code>
          operator instead of <code class="literal">:=</code>, it will
          execute the <em class="command">date</em> command every
          time the <code class="literal">DATE</code> variable is
          used:</p><a id="OEBPS/ch10s02.html.I_5_tt437"></a><pre class="programlisting">æ—¥æœŸ = $(å¤–å£³æ—¥æœŸ +%F)</pre><pre class="programlisting">DATE = $(shell date +%F)</pre><p>è¯¥<code class="literal">+%F</code>é€‰é¡¹æŒ‡ç¤º
          <em class="command">date</em>ä»¥â€œyyyy-mm-ddâ€æ ¼å¼è¿”å›žæ—¥æœŸï¼Œå› æ­¤å¯¹äºŽå¤§å¤šæ•°ç”¨æˆ·æ¥è¯´ï¼Œ
          æ°¸è¿œä¸ä¼šæ³¨æ„åˆ°<em class="command">date</em>çš„é‡å¤æ‰§è¡Œã€‚å½“ç„¶ï¼Œåœ¨åˆå¤œå·¥ä½œçš„å¼€å‘äººå‘˜å¯èƒ½ä¼šæ„Ÿåˆ°æƒŠè®¶ï¼</p><p>The <code class="literal">+%F</code> option instructs
          <em class="command">date</em> to return the date in
          "yyyy-mm-dd" format, so for most users the repeated execution of
          <em class="command">date</em> would never be noticed. Of
          course, developers working around midnight might get a
          surprise!</p><p>ç”±äºŽ<em class="command">make</em>ä¸ä¼šå›žæ˜¾ä»Ž<code class="function">shell</code>å‡½æ•°æ‰§è¡Œçš„å‘½ä»¤ï¼Œå› æ­¤å¾ˆéš¾ç¡®å®šå®žé™…æ­£åœ¨è¿è¡Œçš„å†…å®¹ã€‚é€šè¿‡å°†<code class="literal">SHELL</code>å˜é‡é‡ç½®ä¸º<code class="literal">/bin/sh -x</code>ï¼Œæ‚¨å¯ä»¥æ¬ºéª—<em class="command">make</em>æ˜¾ç¤ºå®ƒæ‰§è¡Œçš„æ‰€æœ‰å‘½ä»¤ã€‚</p><p>Because <em class="command">make</em> doesn't echo
          commands executed from the <code class="function">shell</code> function, it can be difficult to
          determine what is actually being run. By resetting the <code class="literal">SHELL</code> variable to <code class="literal">/bin/sh -x</code>, you can trick <em class="command">make</em> into revealing all the commands it
          executes.</p><p>è¯¥<em class="filename">makefile</em>åœ¨æ‰§è¡Œä»»ä½•æ“ä½œä¹‹å‰åˆ›å»ºå…¶è¾“å‡ºç›®å½•ã€‚è¾“å‡ºç›®å½•çš„åç§°ç”±å•è¯â€œoutâ€å’Œæ—¥æœŸç»„æˆï¼š</p><p>This <em class="filename">makefile</em> creates its
          output directory before performing any actions. The name of the
          output directory is composed of the word "out" and the date:</p><a id="OEBPS/ch10s02.html.I_5_tt438"></a><pre class="programlisting">æ—¥æœŸ = $(å¤–å£³æ—¥æœŸ +%F)
OUTPUT_DIR = è¾“å‡º-$(æ—¥æœŸ)

make-directories := $(shell [ -d $(OUTPUT_DIR) ] || mkdir -p $(OUTPUT_DIR))

å…¨éƒ¨ï¼š ;</pre><pre class="programlisting">DATE = $(shell date +%F)
OUTPUT_DIR = out-$(DATE)

make-directories := $(shell [ -d $(OUTPUT_DIR) ] || mkdir -p $(OUTPUT_DIR))

all: ;</pre><p>å½“ä½¿ç”¨è°ƒè¯• shell è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p><p>When run with a debugging shell, we can see:</p><a id="OEBPS/ch10s02.html.I_5_tt439"></a><pre class="programlisting">$ make SHELL='/bin/sh -x'
+ æ—¥æœŸ +%F
+ æ—¥æœŸ +%F
+ '[' -d out-2004-03-30 ']'
+ mkdir -p è¾“å‡º-2004-03-30
makeï¼šä¸€åˆ‡éƒ½æ˜¯æœ€æ–°çš„ã€‚</pre><pre class="programlisting">$ make SHELL='/bin/sh -x'
+ date +%F
+ date +%F
+ '[' -d out-2004-03-30 ']'
+ mkdir -p out-2004-03-30
make: all is up to date.</pre><p>è¿™æ¸…æ¥šåœ°å‘æˆ‘ä»¬è¡¨æ˜Ž<em class="command">date</em>å‘½ä»¤è¢«æ‰§è¡Œäº†ä¸¤æ¬¡ã€‚å¦‚æžœæ‚¨éœ€è¦ç»å¸¸æ‰§è¡Œè¿™ç§ shell è·Ÿè¸ªï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä½¿å…¶æ›´å®¹æ˜“è®¿é—®ï¼š</p><p>This clearly shows us that the <em class="command">date</em> command was executed twice. If you
          need to perform this kind of shell trace often, you can make it
          easier to access with:</p><a id="OEBPS/ch10s02.html.I_5_tt440"></a><pre class="programlisting">ifdef DEBUG_SHELL
  å¤–å£³ = /bin/sh -x
ä¸‡ä¸€</pre><pre class="programlisting">ifdef DEBUG_SHELL
  SHELL = /bin/sh -x
endif</pre></div><div class="sect2" title="ç¦ç”¨@"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch10s02.html.make3-CHP-10-SECT-2.2"></a>ç¦ç”¨@</h2><h2 class="title"><a></a>Disabling @</h2></div></div></div><p>å‘½ä»¤çš„å¦ä¸€ç§æ–¹å¼æ˜¯<a id="OEBPS/ch10s02.html.make3-CHP-10-ITERM-1542" class="indexterm"></a> <a id="OEBPS/ch10s02.html.make3-CHP-10-ITERM-1543" class="indexterm"></a>éšè—æ˜¯é€šè¿‡ä½¿ç”¨é™é»˜å‘½ä»¤ä¿®é¥°ç¬¦<code class="literal">@</code>.æœ‰æ—¶èƒ½å¤Ÿç¦ç”¨æ­¤åŠŸèƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚æ‚¨å¯ä»¥é€šè¿‡å®šä¹‰å˜é‡<code class="literal">QUIET</code>æ¥ä¿å­˜ @ ç¬¦å·å¹¶åœ¨å‘½ä»¤ä¸­ä½¿ç”¨è¯¥å˜é‡æ¥ç®€åŒ–æ­¤æ“ä½œï¼š</p><p>Another way commands are <a class="indexterm"></a> <a class="indexterm"></a>hidden is through the use of the silent command
          modifier, <code class="literal">@</code>. It can be useful at
          times to be able to disable this feature. You can make this easy by
          defining a variable, <code class="literal">QUIET</code>, to
          hold the @ sign and use the variable in commands:</p><a id="OEBPS/ch10s02.html.I_5_tt441"></a><pre class="programlisting">ifndef è¯¦ç»†ä¿¡æ¯
  å®‰é™:=@
ä¸‡ä¸€
...
ç›®æ ‡ï¼š
        $(QUIET) echo å»ºç«‹ç›®æ ‡...</pre><pre class="programlisting">ifndef VERBOSE
  QUIET := @
endif
...
target:
        $(QUIET) echo Building target...</pre><p>å½“éœ€è¦æŸ¥çœ‹é™é»˜ä¿®é¥°ç¬¦éšè—çš„å‘½ä»¤æ—¶ï¼Œåªéœ€<code class="literal">VERBOSE</code>
          åœ¨å‘½ä»¤è¡Œä¸Šå®šä¹‰ï¼š</p><p>When it becomes necessary to see commands hidden by the silent
          modifier, simply define <code class="literal">VERBOSE</code>
          on the command line:</p><a id="OEBPS/ch10s02.html.I_5_tt442"></a><pre class="programlisting">$ ä½¿è¯¦ç»†=1
echo å»ºç«‹ç›®æ ‡...
å»ºç«‹ç›®æ ‡...</pre><pre class="programlisting">$ make VERBOSE=1
echo Building target...
Building target...</pre></div><div class="sect2" title="å»¶è¿Ÿåˆå§‹åŒ–"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch10s02.html.make3-CHP-10-SECT-2.3"></a>å»¶è¿Ÿåˆå§‹åŒ–</h2><h2 class="title"><a></a>Lazy Initialization</h2></div></div></div><p>å½“ç®€å•å˜é‡<a id="OEBPS/ch10s02.html.make3-CHP-10-ITERM-1544" class="indexterm"></a> <a id="OEBPS/ch10s02.html.make3-CHP-10-ITERM-1545" class="indexterm"></a>ä¸Žå‡½æ•°ç»“åˆä½¿ç”¨<code class="function">shell</code>ï¼Œ<em class="command">make</em><code class="function">shell</code>åœ¨è¯»å–
          <em class="filename">makefile</em>æ—¶è¯„ä¼°æ‰€æœ‰å‡½æ•°è°ƒç”¨ã€‚å¦‚æžœå…¶ä¸­æœ‰å¾ˆå¤šï¼Œæˆ–è€…å®ƒä»¬æ‰§è¡Œæ˜‚è´µçš„è®¡ç®—ï¼Œåˆ™<em class="command">make</em>å¯èƒ½ä¼šæ„Ÿè§‰ç¼“æ…¢ã€‚<em class="command">make</em>çš„å“åº”èƒ½åŠ›å¯ä»¥é€šè¿‡åœ¨ä½¿ç”¨ä¸å­˜åœ¨çš„ç›®æ ‡è°ƒç”¨æ—¶è®¡æ—¶<em class="command">make</em>æ¥æµ‹é‡
          ï¼š</p><p>When simple variables <a class="indexterm"></a> <a class="indexterm"></a>are used in conjunction with the <code class="function">shell</code> function, <em class="command">make</em> evaluates all the <code class="function">shell</code> function calls as it reads the
          <em class="filename">makefile</em>. If there are many of
          these, or if they perform expensive computations, <em class="command">make</em> can feel sluggish. The responsiveness
          of <em class="command">make</em> can be measured by timing
          <em class="command">make</em> when invoked with a
          nonexistent target:</p><a id="OEBPS/ch10s02.html.I_5_tt443"></a><pre class="programlisting">$<strong class="userinput"><code>time make no-such-target</code></strong>
make: *** æ²¡æœ‰è§„åˆ™å¯ä»¥ä½¿ç›®æ ‡ no-such-targetã€‚åœæ­¢ã€‚

å®žé™…0m0.058s
ç”¨æˆ·0m0.062s
ç³»ç»Ÿ0m0.015s</pre><pre class="programlisting">$<strong class="userinput"><code>time make no-such-target</code></strong>
make: *** No rule to make target no-such-target.  Stop.

real    0m0.058s
user    0m0.062s
sys     0m0.015s</pre><p><em class="command">æ­¤ä»£ç ä¹˜ä»¥make</em>å°†æ·»åŠ åˆ°æ‰§è¡Œçš„ä»»ä½•å‘½ä»¤ï¼ˆç”šè‡³æ˜¯çç¢Žæˆ–é”™è¯¯çš„å‘½ä»¤ï¼‰çš„å¼€é”€ã€‚</p><p>This code times the overhead that <em class="command">make</em> will add to any command executed,
          even trivial or erroneous commands.</p><p>ç”±äºŽé€’å½’å˜é‡æ¯æ¬¡æ‰©å±•æ—¶éƒ½ä¼šé‡æ–°è®¡ç®—å…¶å³ä¾§ï¼Œå› æ­¤å€¾å‘äºŽå°†å¤æ‚çš„è®¡ç®—è¡¨ç¤ºä¸ºç®€å•å˜é‡ã€‚ä½†æ˜¯ï¼Œè¿™ä¼šé™ä½Ž<em class="command">make</em>å¯¹æ‰€æœ‰ç›®æ ‡çš„å“åº”èƒ½åŠ›ã€‚ä¼¼ä¹Žéœ€è¦å¦ä¸€ç§å˜é‡ï¼Œå…¶å³ä¾§ä»…åœ¨ç¬¬ä¸€æ¬¡è¯„ä¼°å˜é‡æ—¶è¯„ä¼°ä¸€æ¬¡ï¼Œè€Œä¸æ˜¯ä¹‹å‰ã€‚</p><p>Because recursive variables reevaluate their righthand side
          every time they are expanded, there is a tendency to express complex
          calculations as simple variables. However, this decreases the
          responsiveness of <em class="command">make</em> for all
          targets. It seems that there is a need for another kind of variable,
          one whose righthand side is evaluated only once the first time the
          variable is evaluated, but not before.</p><p>è¯´æ˜Žæ­¤ç±»åˆå§‹åŒ–éœ€æ±‚çš„ç¤ºä¾‹æ˜¯<a class="link" href="#OEBPS/ch09.html" title="ç¬¬ 9 ç«  Java">ç¬¬ 9 ç« </a><a class="link" href="#OEBPS/ch09s03.html.make3-CHP-9-SECT-3.1" title="å¿«é€Ÿæ–¹æ³•ï¼šä¸€ä½“åŒ–ç¼–è¯‘">9.3.1 èŠ‚</a>ä¸­
          <code class="function">find-compilation-dirs</code>ä»‹ç»çš„å‡½æ•°ï¼š<a class="link" href="#OEBPS/ch09s03.html.make3-CHP-9-SECT-3.1" title="å¿«é€Ÿæ–¹æ³•ï¼šä¸€ä½“åŒ–ç¼–è¯‘"></a><a class="link" href="#OEBPS/ch09.html" title="ç¬¬ 9 ç«  Java"></a></p><p>An example illustrating the need for this type of
          initialization is the <code class="function">find-compilation-dirs</code> function introduced
          in the <a class="link" href="#OEBPS/ch09s03.html.make3-CHP-9-SECT-3.1" title="The Fast Approach: All-in-One Compile">Section 9.3.1</a> in
          <a class="link" href="#OEBPS/ch09.html" title="Chapter&nbsp;9.&nbsp;Java">Chapter 9</a>:</p><a id="OEBPS/ch10s02.html.I_5_tt444"></a><pre class="programlisting"># $(è°ƒç”¨ find-compilation-dirs, æ ¹ç›®å½•)
æŸ¥æ‰¾ç¼–è¯‘ç›®å½•= \
  $(patsubst %/,%, \
    $(æŽ’åº\
      $(ç›®å½•\
        $(shell $(FIND) $1 -name '*.java'))))

PACKAGE_DIRS := $(è°ƒç”¨ find-compilation-dirs, $(SOURCE_DIR))</pre><pre class="programlisting"># $(call find-compilation-dirs, root-directory)
find-compilation-dirs =                       \
  $(patsubst %/,%,                            \
    $(sort                                    \
      $(dir                                   \
        $(shell $(FIND) $1 -name '*.java'))))

PACKAGE_DIRS := $(call find-compilation-dirs, $(SOURCE_DIR))</pre><p>ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›æ¯æ¬¡æ‰§è¡Œæ—¶åªæ‰§è¡Œä¸€æ¬¡<em class="command">æŸ¥æ‰¾</em>æ“ä½œï¼Œä½†ä»…åœ¨<code class="literal">PACKAGE_DIRS</code>
          å®žé™…ä½¿ç”¨å˜é‡æ—¶æ‰§è¡Œã€‚è¿™å¯èƒ½ç§°ä¸º<em class="firstterm">å»¶è¿Ÿåˆå§‹åŒ–</em>ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æž„å»ºè¿™æ ·çš„å˜é‡
          <code class="function">eval</code>ï¼š</p><p>Ideally, we would like to perform this <em class="command">find</em> operation only once per execution,
          but only when the <code class="literal">PACKAGE_DIRS</code>
          variable is actually used. This might be called <em class="firstterm">lazy
          initialization</em>. We can build such a variable using
          <code class="function">eval</code> like this:</p><a id="OEBPS/ch10s02.html.I_5_tt445"></a><pre class="programlisting">PACKAGE_DIRS = $(é‡æ–°å®šä¹‰åŒ…ç›®å½•) $(PACKAGE_DIRS)

é‡æ–°å®šä¹‰åŒ…ç›®å½• = \
   $(eval PACKAGE_DIRS := $(è°ƒç”¨ find-compilation-dirs, $(SOURCE_DIR)))</pre><pre class="programlisting">PACKAGE_DIRS = $(redefine-package-dirs) $(PACKAGE_DIRS)

redefine-package-dirs = \
   $(eval PACKAGE_DIRS := $(call find-compilation-dirs, $(SOURCE_DIR)))</pre><p>åŸºæœ¬æ–¹æ³•æ˜¯<code class="literal">PACKAGE_DIRS</code>é¦–å…ˆå°†å…¶å®šä¹‰ä¸ºé€’å½’å˜é‡ã€‚å±•å¼€æ—¶ï¼Œå˜é‡ä¼šè®¡ç®—æ˜‚è´µçš„å‡½æ•°ï¼ˆæ­¤å¤„ï¼‰ï¼Œ<code class="function">find-compilation-dirs</code>å¹¶å°†å…¶è‡ªèº«é‡æ–°å®šä¹‰ä¸ºç®€å•å˜é‡ã€‚æœ€åŽï¼Œï¼ˆçŽ°åœ¨å¾ˆç®€å•ï¼‰å˜é‡å€¼ä»ŽåŽŸå§‹é€’å½’å˜é‡å®šä¹‰ä¸­è¿”å›žã€‚</p><p>The basic approach is to define <code class="literal">PACKAGE_DIRS</code> first as a recursive
          variable. When expanded, the variable evaluates the expensive
          function, here <code class="function">find-compilation-dirs</code>, and redefines
          itself as a simple variable. Finally, the (now simple) variable
          value is returned from the original recursive variable
          definition.</p><p>è®©æˆ‘ä»¬è¯¦ç»†è®¨è®ºä¸€ä¸‹ï¼š</p><p>Let's go over this in detail:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>å½“<em class="command">make</em>è¯»å–è¿™äº›å˜é‡æ—¶ï¼Œå®ƒåªæ˜¯è®°å½•å®ƒä»¬çš„å³ä¾§ï¼Œå› ä¸ºè¿™äº›å˜é‡æ˜¯é€’å½’çš„ã€‚</p></li><li class="listitem"><p>When <em class="command">make</em> reads these
              variables, it simply records their righthand side because the
              variables are recursive.</p></li><li class="listitem"><p>ç¬¬ä¸€æ¬¡<code class="literal">PACKAGE_DIRS</code>ä½¿ç”¨è¯¥å˜é‡æ—¶ï¼Œ
               <em class="command">make</em>æ£€ç´¢å³ä¾§å¹¶æ‰©å±•ç¬¬ä¸€ä¸ªå˜é‡<code class="function">redefine-package-dirs</code>ã€‚</p></li><li class="listitem"><p>The first time the <code class="literal">PACKAGE_DIRS</code> variable is used,
              <em class="command">make</em> retrieves the righthand
              side and expands the first variable, <code class="function">redefine-package-dirs</code>.</p></li><li class="listitem"><p>çš„å€¼<code class="literal">redefine-package-dirs</code>æ˜¯å•ä¸ªå‡½æ•°è°ƒç”¨ï¼Œ<code class="function">eval</code>ã€‚</p></li><li class="listitem"><p>The value of <code class="literal">redefine-package-dirs</code> is a single
              function call, <code class="function">eval</code>.</p></li><li class="listitem"><p>å‡½æ•°ä½“<code class="function">eval</code>
              å°†é€’å½’å˜é‡ é‡æ–°å®šä¹‰<code class="literal">PACKAGE_DIRS</code>ä¸ºä¸€ä¸ªç®€å•å˜é‡ï¼Œå…¶å€¼æ˜¯ æ‰€è¿”å›žçš„ç›®å½•é›†<code class="function">find-compilation-dirs</code>ã€‚çŽ°åœ¨<code class="literal">PACKAGE_DIRS</code>å·²ç»ç”¨ç›®å½•åˆ—è¡¨åˆå§‹åŒ–äº†ã€‚</p></li><li class="listitem"><p>The body of the <code class="function">eval</code>
              redefines the recursive variable, <code class="literal">PACKAGE_DIRS</code>, as a simple variable
              whose value is the set of directories returned by <code class="function">find-compilation-dirs</code>. Now <code class="literal">PACKAGE_DIRS</code> has been initialized with
              the directory list.</p></li><li class="listitem"><p>è¯¥<code class="function">redefine-package-dirs</code>å˜é‡æ‰©å±•ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆå› ä¸º eval æ‰©å±•ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰ã€‚</p></li><li class="listitem"><p>The <code class="function">redefine-package-dirs</code> variable is
              expanded to the empty string (because eval expands to the empty
              string).</p></li><li class="listitem"><p>çŽ°åœ¨<em class="command">make</em>ç»§ç»­æ‰©å±•åŽŸæ¥çš„å³ä¾§<code class="literal">PACKAGE_DIRS</code>ã€‚å‰©ä¸‹è¦åšçš„å”¯ä¸€ä¸€ä»¶äº‹å°±æ˜¯æ‰©å±•å˜é‡<code class="literal">PACKAGE_DIRS</code>ã€‚<em class="command">make</em>æŸ¥æ‰¾å˜é‡çš„å€¼ï¼Œçœ‹åˆ°ä¸€ä¸ªç®€å•å˜é‡ï¼Œç„¶åŽè¿”å›žå®ƒçš„å€¼ã€‚</p></li><li class="listitem"><p>Now <em class="command">make</em> continues to
              expand the original righthand side of <code class="literal">PACKAGE_DIRS</code>. The only thing left to
              do is expand the variable <code class="literal">PACKAGE_DIRS</code>. <em class="command">make</em> looks up the value of the
              variable, sees a simple variable, and returns its value.</p></li></ol></div><p>è¯¥ä»£ç å”¯ä¸€çœŸæ­£æ£˜æ‰‹çš„éƒ¨åˆ†æ˜¯ä¾èµ–
          <em class="command">make</em>ä»Žå·¦åˆ°å³è¯„ä¼°é€’å½’å˜é‡çš„å³ä¾§ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœ
          <em class="command">make</em>å†³å®šè¯„ä¼°<code class="literal">$(PACKAGE_DIRS)</code>before <code class="literal">$(redefine-package-dirs)</code>ï¼Œåˆ™ä»£ç å°†ä¼šå¤±è´¥ã€‚</p><p>The only really tricky part of this code is relying on
          <em class="command">make</em> to evaluate the righthand
          side of a recursive variable from left to right. If, for instance,
          <em class="command">make</em> decided to evaluate <code class="literal">$(PACKAGE_DIRS)</code> before <code class="literal">$(redefine-package-dirs)</code>, the code would
          fail.</p><p>æˆ‘åˆšæ‰æè¿°çš„è¿‡ç¨‹å¯ä»¥é‡æž„ä¸ºä¸€ä¸ªå‡½æ•°<code class="function">lazy-init</code>ï¼š</p><p>The procedure I just described can be refactored into a
          function, <code class="function">lazy-init</code>:</p><a id="OEBPS/ch10s02.html.I_5_tt446"></a><pre class="programlisting"># $(è°ƒç”¨æƒ°æ€§åˆå§‹åŒ–,å˜é‡å,å€¼)
å®šä¹‰æƒ°æ€§åˆå§‹åŒ–
  $1 = $$(é‡æ–°å®šä¹‰-$1) $$($1)
  é‡æ–°å®šä¹‰-$1 = $$(eval $1 := $2)
æ©å¾·å¤«

# PACKAGE_DIRS - ç›®å½•çš„æƒ°æ€§åˆ—è¡¨
$(è¯„ä¼°\
  $(è°ƒç”¨æƒ°æ€§åˆå§‹åŒ–ï¼ŒPACKAGE_DIRSï¼Œ\
    $$(è°ƒç”¨ find-compilation-dirs,$(SOURCE_DIRS))))</pre><pre class="programlisting"># $(call lazy-init,variable-name,value)
define lazy-init
  $1 = $$(redefine-$1) $$($1)
  redefine-$1 = $$(eval $1 := $2)
endef

# PACKAGE_DIRS - a lazy list of directories
$(eval                           \
  $(call lazy-init,PACKAGE_DIRS, \
    $$(call find-compilation-dirs,$(SOURCE_DIRS))))</pre></div><div class="footnotes"><br><br><hr><div class="footnote"><p><sup>[ <a id="OEBPS/ch10s02.html.ftn.make3-CHP-10-FNOTE-2" href="#OEBPS/ch10s02.html.make3-CHP-10-FNOTE-2" class="para">2</a> ]</sup>å®žé™…ä¸Šï¼Œç¼–è¯‘æ—¶é—´éšç€è¾“å…¥æ–‡æœ¬çš„å¤§å°çº¿æ€§å¢žé•¿ï¼Œå¹¶ä¸”è¿™ä¸ªæ—¶é—´å‡ ä¹Žæ€»æ˜¯ç”±ç£ç›˜ I/O ä¸»å¯¼ã€‚åŒæ ·ï¼Œä½¿ç”¨ç®€å•é€‰é¡¹è®¡ç®—ä¾èµ–å…³ç³»çš„æ—¶é—´
            <code class="option">-M</code>æ˜¯çº¿æ€§çš„ï¼Œå¹¶ä¸”å—ç£ç›˜ I/O çš„é™åˆ¶ã€‚</p><p><sup>[<a href="#OEBPS/ch10s02.html.make3-CHP-10-FNOTE-2" class="para">2</a>] </sup>In practice, compilation time grows linearly with the size
            of the input text and this time is almost always dominated by disk
            I/O. Similarly, the time to compute dependencies using the simple
            <code class="option">-M</code> option is linear and bound by disk I/O.</p></div></div></div></div></div>
<div id="OEBPS/ch10s03.html"><div>
<div class="sect1" title="å¹¶è¡Œåˆ¶ä½œ"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch10s03.html.make3-CHP-10-SECT-3"></a>å¹¶è¡Œåˆ¶ä½œ</h1><h1 class="title"><a></a>Parallel make</h1></div></div></div><p>å¦ä¸€ç§æ–¹å¼<a id="OEBPS/ch10s03.html.make3-CHP-10-ITERM-1546" class="indexterm"></a> <a id="OEBPS/ch10s03.html.make3-CHP-10-ITERM-1547" class="indexterm"></a>æé«˜æž„å»ºçš„æ€§èƒ½æ˜¯åˆ©ç”¨ makefile<em class="filename">æ­£åœ¨</em>è§£å†³çš„é—®é¢˜ä¸­å›ºæœ‰çš„å¹¶è¡Œæ€§ã€‚å¤§å¤šæ•°<em class="filename">makefile</em>æ‰§è¡Œè®¸å¤šå¯ä»¥è½»æ¾å¹¶è¡Œæ‰§è¡Œçš„ä»»åŠ¡ï¼Œä¾‹å¦‚å°† C æºä»£ç ç¼–è¯‘ä¸ºç›®æ ‡æ–‡ä»¶æˆ–ä»Žç›®æ ‡æ–‡ä»¶åˆ›å»ºåº“ã€‚æ­¤å¤–ï¼Œç¼–å†™è‰¯å¥½çš„<em class="filename">makefile</em>çš„ç»“æž„æœ¬èº«æä¾›äº†è‡ªåŠ¨æŽ§åˆ¶å¹¶å‘è¿›ç¨‹æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><p>Another way to <a class="indexterm"></a> <a class="indexterm"></a>improve the performance of a build is to take advantage
        of the parallelism inherent in the problem the <em class="filename">makefile</em> is solving. Most <em class="filename">makefile</em>s perform many tasks that are
        easily carried out in parallel, such as compiling C source to object
        files or creating libraries out of object files. Furthermore, the very
        structure of a well-written <em class="filename">makefile</em> provides all the information
        necessary to automatically control the concurrent processes.</p><p><a class="link" href="#OEBPS/ch10s03.html.make3-CHP-10-EX-1" title="ä¾‹10-1ã€‚å½“ â€”jobs = 2 æ—¶ make çš„è¾“å‡º">ç¤ºä¾‹ 10-1</a>æ˜¾ç¤ºäº†
        <code class="literal">mp3_player</code>ä½¿ç”¨ jobs é€‰é¡¹<code class="option">â€”jobs</code> <code class="literal">=2</code>ï¼ˆæˆ–<code class="option">-j</code> <code class="literal">2</code>ï¼‰æ‰§è¡Œçš„ç¨‹åºã€‚<a class="link" href="#OEBPS/ch10s03.html.make3-CHP-10-FIG-1" title="å›¾ 10-1ã€‚å½“ â€”jobs = 2 æ—¶ make çš„ç¤ºæ„å›¾">å›¾ 10-1</a>æ˜¾ç¤ºäº†ä¼ª UML åºåˆ—å›¾ä¸­ç›¸åŒçš„
        <em class="command">make</em>è¿è¡Œã€‚ä½¿ç”¨<code class="option">â€”jobs</code>=2 å‘Šè¯‰<em class="command">make</em>åœ¨å¯èƒ½çš„æƒ…å†µä¸‹å¹¶è¡Œæ›´æ–°ä¸¤ä¸ªç›®æ ‡ã€‚å½“<em class="command">make</em>å¹¶è¡Œæ›´æ–°ç›®æ ‡æ—¶ï¼Œå®ƒä¼šæŒ‰ç…§å‘½ä»¤çš„æ‰§è¡Œé¡ºåºå›žæ˜¾å‘½ä»¤ï¼Œå¹¶å°†å®ƒä»¬äº¤é”™åœ¨è¾“å‡ºä¸­ã€‚è¿™ä¼šä½¿è¯»å–å¹¶è¡Œè¾“å‡º<em class="command">å˜å¾—</em>æ›´åŠ å›°éš¾ã€‚è®©æˆ‘ä»¬æ›´ä»”ç»†åœ°çœ‹çœ‹è¿™ä¸ªè¾“å‡ºã€‚</p><p><a class="link" href="#OEBPS/ch10s03.html.make3-CHP-10-EX-1" title="Example&nbsp;10-1.&nbsp;Output of make when â€”jobs = 2">Example 10-1</a> shows our
        <code class="literal">mp3_player</code> program executed with
        the jobs option, <code class="option">â€”jobs</code> <code class="literal">=2</code> (or <code class="option">-j</code> <code class="literal">2</code>). <a class="link" href="#OEBPS/ch10s03.html.make3-CHP-10-FIG-1" title="Figure&nbsp;10-1.&nbsp;Diagram of make when â€”jobs = 2">Figure 10-1</a> shows the same
        <em class="command">make</em> run in a pseudo UML sequence
        diagram. Using <code class="option">â€”jobs</code>=2 tells <em class="command">make</em> to update two targets in parallel when
        that is possible. When <em class="command">make</em> updates
        targets in parallel, it echos commands in the order in which they are
        executed, interleaving them in the output. This can make reading the
        output from parallel <em class="command">make</em> more
        difficult. Let's look at this output more carefully.</p><div class="example"><a id="OEBPS/ch10s03.html.make3-CHP-10-EX-1"></a><p class="title">ä¾‹10-1ã€‚å½“ â€”jobs = 2 æ—¶ make çš„è¾“å‡º</p><p class="title">Example&nbsp;10-1.&nbsp;Output of make when â€”jobs = 2</p><div class="example-contents"><pre class="programlisting">  $<strong class="userinput"><code>make -f ../ch07-separate-binaries/makefile --jobs=2</code></strong>

é‡Žç‰› -y --å®šä¹‰ ../ch07-separate-binaries/lib/db/playlist.y

flex -t ../ch07-separate-binaries/lib/db/scanner.l &gt; lib/db/scanner.c

gcc -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-M ../ch07-separate-binaries/app/player/play_mp3.c | \
    sed 's,\(play_mp3\.o\) *:,app/player/\1 app/player/play_mp3.d: ,' &gt; app/player/
play_mp3.d.tmp

mv -f y.tab.c lib/db/playlist.c

mv -f y.tab.h lib/db/playlist.h

gcc -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-M ../ch07-separate-binaries/lib/codec/codec.c | -M ../ch07-separate-binaries/lib/codec/codec.c | \
    sed 's,\(codec\.o\) *:,lib/codec/\1 lib/codec/codec.d: ,' &gt; lib/codec/codec.d.tmp

mv -f åº”ç”¨ç¨‹åº/æ’­æ”¾å™¨/play_mp3.d.tmp åº”ç”¨ç¨‹åº/æ’­æ”¾å™¨/play_mp3.d

gcc -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-M lib/db/playlist.c | | -M lib/db/playlist.c | \
    sed 's,\(playlist\.o\) *:,lib/db/\1 lib/db/playlist.d: ,' &gt; lib/db/playlist.d.tmp

mv -f lib/codec/codec.d.tmp lib/codec/codec.d

gcc -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-M ../ch07-separate-binaries/lib/ui/ui.c | \
    sed 's,\(ui\.o\) *:,lib/ui/\1 lib/ui/ui.d: ,' &gt; lib/ui/ui.d.tmp

mv -f lib/db/playlist.d.tmp lib/db/playlist.d

gcc -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-M lib/db/scanner.c | -M lib/db/scanner.c | \
    sed 's,\(scanner\.o\) *:,lib/db/\1 lib/db/scanner.d: ,' &gt; lib/db/scanner.d.tmp

mv -f lib/ui/ui.d.tmp lib/ui/ui.d

mv -f lib/db/scanner.d.tmp lib/db/scanner.d

gcc -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-c -o åº”ç”¨ç¨‹åº/æ’­æ”¾å™¨/play_mp3.o ../ch07-separate-binaries/åº”ç”¨ç¨‹åº/æ’­æ”¾å™¨/play_mp3.c

gcc -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-c -o lib/codec/codec.o ../ch07-separate-binaries/lib/codec/codec.c

gcc -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-c -o lib/db/playlist.o lib/db/playlist.c

gcc -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-c -o lib/db/scanner.o lib/db/scanner.c
    ../ch07-separate-binaries/lib/db/scanner.lï¼šåœ¨å‡½æ•° yylex ä¸­ï¼š
    ../ch07-separate-binaries/lib/db/scanner.l:9ï¼šè­¦å‘Šï¼šè¿”å›žä½¿æ•´æ•°æ¥è‡ª
ä¸å¸¦å¼ºåˆ¶è½¬æ¢çš„æŒ‡é’ˆ

gcc -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-c -o lib/ui/ui.o ../ch07-separate-binaries/lib/ui/ui.c

ar rv lib/codec/libcodec.a lib/codec/codec.o
    arï¼šåˆ›å»º lib/codec/libcodec.a
    a - lib/codec/codec.o

ar rv lib/db/libdb.a lib/db/playlist.o lib/db/scanner.o
    arï¼šåˆ›å»º lib/db/libdb.a
    a - lib/db/playlist.o
    a-lib/db/scanner.o

ar rv lib/ui/libui.a lib/ui/ui.o
    arï¼šåˆ›å»º lib/ui/libui.a
    a-lib/ui/ui.o

gcc app/player/play_mp3.o lib/codec/libcodec.a lib/db/libdb.a lib/ui/libui.a -o app/
æ’­æ”¾å™¨/play_mp3</pre><pre class="programlisting">  $<strong class="userinput"><code>make -f ../ch07-separate-binaries/makefile --jobs=2</code></strong>

bison -y  --defines ../ch07-separate-binaries/lib/db/playlist.y

flex  -t ../ch07-separate-binaries/lib/db/scanner.l &gt; lib/db/scanner.c

gcc  -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-M ../ch07-separate-binaries/app/player/play_mp3.c | \
    sed 's,\(play_mp3\.o\) *:,app/player/\1 app/player/play_mp3.d: ,' &gt; app/player/
play_mp3.d.tmp

mv -f y.tab.c lib/db/playlist.c

mv -f y.tab.h lib/db/playlist.h

gcc  -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-M ../ch07-separate-binaries/lib/codec/codec.c | \
    sed 's,\(codec\.o\) *:,lib/codec/\1 lib/codec/codec.d: ,' &gt; lib/codec/codec.d.tmp

mv -f app/player/play_mp3.d.tmp app/player/play_mp3.d

gcc  -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-M lib/db/playlist.c | \
    sed 's,\(playlist\.o\) *:,lib/db/\1 lib/db/playlist.d: ,' &gt; lib/db/playlist.d.tmp

mv -f lib/codec/codec.d.tmp lib/codec/codec.d

gcc  -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-M ../ch07-separate-binaries/lib/ui/ui.c | \
    sed 's,\(ui\.o\) *:,lib/ui/\1 lib/ui/ui.d: ,' &gt; lib/ui/ui.d.tmp

mv -f lib/db/playlist.d.tmp lib/db/playlist.d

gcc  -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-M lib/db/scanner.c | \
    sed 's,\(scanner\.o\) *:,lib/db/\1 lib/db/scanner.d: ,' &gt; lib/db/scanner.d.tmp

mv -f lib/ui/ui.d.tmp lib/ui/ui.d

mv -f lib/db/scanner.d.tmp lib/db/scanner.d

gcc  -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-c -o app/player/play_mp3.o ../ch07-separate-binaries/app/player/play_mp3.c

gcc  -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-c -o lib/codec/codec.o ../ch07-separate-binaries/lib/codec/codec.c

gcc  -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-c -o lib/db/playlist.o lib/db/playlist.c

gcc  -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-c -o lib/db/scanner.o lib/db/scanner.c
    ../ch07-separate-binaries/lib/db/scanner.l: In function yylex:
    ../ch07-separate-binaries/lib/db/scanner.l:9: warning: return makes integer from 
pointer without a cast

gcc  -I lib -I ../ch07-separate-binaries/lib -I ../ch07-separate-binaries/include  
-c -o lib/ui/ui.o ../ch07-separate-binaries/lib/ui/ui.c

ar rv lib/codec/libcodec.a lib/codec/codec.o
    ar: creating lib/codec/libcodec.a
    a - lib/codec/codec.o

ar rv lib/db/libdb.a lib/db/playlist.o lib/db/scanner.o
    ar: creating lib/db/libdb.a
    a - lib/db/playlist.o
    a - lib/db/scanner.o

ar rv lib/ui/libui.a lib/ui/ui.o
    ar: creating lib/ui/libui.a
    a - lib/ui/ui.o

gcc   app/player/play_mp3.o lib/codec/libcodec.a lib/db/libdb.a lib/ui/libui.a   -o app/
player/play_mp3</pre></div></div><div class="figure"><a id="OEBPS/ch10s03.html.make3-CHP-10-FIG-1"></a><div class="figure-contents"><div class="mediaobject"><a id="OEBPS/ch10s03.html.I_5_tt447"></a><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANUAAAFWCAMAAADJzShzAAABgFBMVEUAAACvr6+fn5+Pj4/+/v78/Pz6+vr4+Pj29vb09PTy8vLw8PDu7u7s7Ozq6uro6Ojm5ubk5OTi4uLg4ODe3t7c3Nza2trY2NjW1tbU1NTS0tLQ0NDOzs7MzMzKysrIyMjGxsbAwMCwsLCgoKCQkJCAgIBwcHBgYGBQUFD////9/f37+/v5+fn39/f19fXz8/NAQEDx8fHv7+/t7e3r6+vp6enn5+fl5eXj4+MwMDDh4eHf39/d3d3b29vZ2dnX19fV1dXT09MgICDR0dHPz8/Nzc3Ly8vJycnHx8fFxcUQEBC/v78ALQBkAACoh3JILWUDAG6cAGKsFQDgQAAEfgBYOAAAAADEMAAAfAAAAAAYYAAAAQAAAAAAMABwxADt+wAB7QAxAQBkAgAAAgAAAAAAAADQAAAAJADpAABI6QAU0AAAcwCbAABItgAA8AAoAAAAIgAAAAAAAAAAAAAAAAAAWwAAJAAAAQAAAAAEMAA0DAAAqACoAAAAAAD/3HIA+GEGwN8RAAAACXBIWXMAAABIAAAASABGyWs+AAANa0lEQVR42u2dC7uUuBnHmdWjnm27tfZee5uBBFBXc7K9pand7SxbK/n+36cJlzNkPAPJGxICzv959JlRAvwGEsJ7S1JuUcnSJ+CLKm0+pFX7D5XlDtrWuP0iuF3jfbN91e6DizmpSPMBNfvk+dFyB2Twd4qIHVZ7UIHU3xQXaFYqiqoSZRmVu6bEmqpCtCSH9vcWdicmqbJDKTDig99mLqp8x0qU4wyyZ1KSXVGSjDS3bppaUqWoqAT7oijVfXKYlYrI3SPRXiZrKnl51B52zVVi1JKKyMsr98Dklz3xQVU6UTX3HsrsGt9TNUe1vvtHqKg6p5yjHc8BVJTIZnIPVN17wva0sMh5mgrcURWzUaXsUKYsL3PMKnsq1TpnaVkURN57hBGrfkXkUMPkD6L2IH8SZvtUuUw1146i0okKO+3HqbXboUeptqStU7l1VafWs40Sn1K5PSycWs/2nPpcqOxmcOdyau126FGqLSl+KiFs30XX8BRGR7SHU0U7WgB2vVkqTIbCJUfqku+Reu1GKD3/uFf2Cfkyxc8/+moBoyL1AKomJW26JxeCqq5anX+U/1cJUXabDT76aqGoLGcfSfOWM7jctr8MSoaybC0Bhnp4I7nPzNLyNQMVOulo2Vr/SS48ZUhp3bdmoHJojZLBlcovUFXro7r05UxXqvVQhR8DQ1BZan1UE88BnSplYhVUp4fByFvZPdUBrYNKXatHySPDa1WuhUqBJRMOvCtVHFQVInVSEzT2grw6KjlasBzlLKlHvEoro+IsKVrHHycJuegCPFFxugIqUp/8kVly0d+1rqdwlpxuOyobXHK5zkSFSQ6nQq0vb5qK16f9V5KP1X6pJFcFpqKUmVHtTiN6xu6/y7fV/UHvYjFQdW7uaSqUdCdP81odjjc3pGCCn43zc1G1PzeMqjoa3oGkM19Q1k0C695Bv+f7A6JZVao/81HhA5xKjteGVP3u8270O/bBFEigImM7pgJi6GxUhwLUugcxvAPx/RbtnUgTdKISTdgHEbmYjapuQ5FgVLtdYUaVJvo7sUh251THxlo6E5VojJQwKpohakZVJXrwV57wcyrW/IeiOjpY9MI+hQvtYomkdaYMqVJWdFQu1tewVLQehH/R4/HSRDBpLNoD2frTw84DD8n9RPBQ1xffstZ1reQlYAlBggtEkpGwJ0XFBpeKRU6lfI/Nr38cixpd15y9FVUhmqNbrJFqWleqNVKlaItUxRqoHuuapGp85rFTPb7RNUmVizVQvdY1RZUWOdnHT/VE1xQVF49yyBtS3FR94srWqCgHUjnMIrVgDeKDqlXY2BijKJIlqLjT25mlglEF1eM3unxThcmoCE3ldImNG2+HitSn9KdXT3WNUTnZLfxrcEYWVCkaavaI+VmpvtY1QnUedwuKNxUuEapiMkLVnuo87tYuNpgkhDB155JjkjBsF01MEkbIfWMyGU386pmuMSrHuYX+m8AbHy/MLeQ+s1yEpnJobTS7VfvscsZfvdW1Yio1fqW7rVEpdb5Fa6qo7RaomzXf3OqapCIi4oif/jF6807XJFUBO6+w78LWVHVebZCqrJgTVQX2C/fZcCZUX+qapuoKQcCoaIHhPnzUBjKZUN3pmqKiZVU4ULW3L/gObGL+PFBVJHeID6RFjh2oqGG8hTVVLxiVOFK8g1NlhnFM5esf6fJMhdqZGpCKGEaRlK+pLr9UlLTVfWBUbWmX+KhUSAp8ZEe7SKmArW2fwq9/rGu9VMOM9dff6Bqjijs6a5ixbkMVecTPYJ8WVG4KSvXkJ7pGqHBvSQFlrJMzKksbk041ZWOyoHLLWM/PqKzsgfkZ1SV7IO/ehZ/8RdcYVdxjoKISXRG+bVGp2okN1Ve6Vkwl7759wUNT+bbdKnVWzid/1eWNKj0bQR0aXz70rrNIB6Pq28GaGTauujlTaKowdc7e/FTXJFXa+imtqfYhfXpv/qZriqoqwDYm3xVWhlTPdU1RcTjV4Iv9yG4XG2NLJSf8oAyqABVWHKg4qQjkHT3su/Cbv+uaokKiTYPeFtUhFyu4Vk9/pmuKSs5JoPGBMVMBzysw1T90+aYSICt95FQYH+FWTguqF7o8UzG4RZrKaRYtsBnVP3V5piJw7wH6ApV5JdHioypwDvaJNKX05YwtPip5auDqAm0pfWJC9fXPdfmmgvlfram4Ls9UKcz/OrgD87mpagd7ygxPYUmFVKjcvFTYxZ4yAxXft/Y+E6pf6Bqh6s/IEmc2qge/XKD6l67PlQpoSAlK9eyXuqapgPJONYzS3w7VsGvYUwHzV8JSvdc1QrUiX+OzX+kaoXL1NeoZgF58jfdU/9Y1RuU4Y3LKADS8AzufSDAqpwxAo2xN5RdmgamcZGSRll0txy3V21/r8k3l1X9VsbaQ37ao+vKa5dtvdXmj6voVc8msnX5UtstVlm9/o8sbldMYaCtbqlT+GGIfOmPd1itnSVUUosQYxe6Ve/udrgmqpjuKBajsvHK3v9UVK9WlL58V1X90XakipvqdrikqtRS0WpN5W1TQ82rORa2ZkBJC/VN9r8srVbtmwi7zTvXupS6vVKUTlZzScGRmu31X6QpARTiISk1p5FyLx0l1wHDvQVNcO0Yqrmq2gqlwYXYH/l6Xd6qiUEYuKJWqaR0dFafK0gXrV9065kb+q3c/6PJLBW3dU9GyMBotvvyDrjGqhTOV5JQGKwfBzFSRZyrBqPozssRZhOq/ujZC9Udd01RAXancqT7omqYCZg8Epbr7k65pKnC/cqpgaUn1P10eqXz7r5yogJEJnfk1A/qvfFMtIVsr592fdXmjcvQ12lmk7anAkQnuOT3M1Htw91HXNNUSY6DtoQNSDU8vOiqg5qAy1pWq1RIzJttDX/vVlqlcYjmbdTkrMJXxoYOOFliFGdE6xtHCgYorizQiMVK5xHJKKorhVMaHDjtaKMsrh1NFOgZKqqMKA42PCqiB/yrGfnWlOqfqFR/VNucW26RaIvfA9tDXfrVlqiXyr2wPfR0ttkwFtlu4+MoNDk3IKVcu4GjhO559sM9gVP4Fo3LLles+Hq1bDI5xHG0Bo3LLles+Mpd1epjpOj02VE4RP508rlVG1IXbh6Xyv1oeOWEHo/I/BqqSMig4lYP/Si8+OLK++C4LTeXQ2tiDujKqS1/OtsN0g1S9LKl4XqnsgWpbVBiLElR7KGoqZdEjkPOKngoTQJx99FRlWQD7lcrpKQ/yNShKKnUbQqhUTo9QOeURUu12EEt5b2fP1YMSQiUKJG9+ZlS9zZZqz2mWATI97qnqDMMylQ5N7kFqVGkv7FNYUjE1uYZnVBRGeSLBqYhaxQpMxc1yeoJTpUVxgFNlZhkVYalUvIWqDA+mImWEVNDWPVWzAta2qCgvueHKhiuievDLlepzolq4LqcfqqXrcvqh6s/IEudKtQCVa7ZmyJweCyqnzFqntV+iHdmdZJ39EpgK5unpLvRx0s6+EJXTJfbhw1++Jl18VEFr0q3DfxUxlUtrv1TKJ1KFt0j3zTxRKZ8Iozi0p8f3yK5sXzS3r5EStioigEoct+gTIQLqE4mYql3TfmtUnIgc6OlR/quKMWDlIo9Ue95mUYH9VwUXODqqXg7eA6hPJGYqnKUbpKLZYYN3YKmKeoHqB5JclSqP0yvHC0Ct0m5RuqqgaRYfFaclha+WhytWUqP1r9bxJtJ6epjxql4rosKHDVIdCrUwYoW35ROpMeKHghhVRVyPT0SoSHblKvfiPVhFnTNrKqCuVCGpVlSXM5inJ1r/ldPzSjd+Xf1XV6qFqGBPu2ipHPvVYLJ2jIjKaQxMtcnadON1zNl7ONMN7ahowdImBHtb/iv11nYIv/ZLAKoFVrTp5KNqR3MqKiFiMSpvPnzCN0iFVTbk1vpVVSunLJgqRbRdlCYuKtqU0KWAOHtFRXe7ohQg71crH3U553gKNwMOwFPZHTROKtq4K3cbo1KzWspimzE5UlWqUQHxv1oqJBVlcpjJMKR1xFSVeonABJCD2snbjMmFyqF11+xKtRoqY63DduuRKnWJs4+Wqj8j2IFi7VebprrW5ZyZylgBqdzrB3qkAtfldM89GD00qV2qIrr9zE6tien/fvZUs1RFzFyqIuJYqyJ6bAGkWs7XaCR5RiorYgkqv/0qb4u3bYlKdjWG00WoPNblbLDJIlR+VdB8g1QcBa6K2Ak437JsbJsB2DwcILWz+l/DhcqTNYZijEvksNJOlFTdnh2onMr3+vP0yAuWQTIAg8qWKlWlnrZGRZkaOtnG+hUR3d63RCXkywglDJCVEzPV4ABb6ldXqgcV6fPKkWqb/WqbVFHO2Z2pwuhKFb/dYimq+EaLOSoqRUfl5u0Oqg2tFOVE5bbETnQzpk7R+q+uVJ9QuQ0T0c2YVqQrVSunOY//GdPNndTzMyr1b3c3Y1Sxjxb848N68cC266Eqv/nwANOHu4c2XVO/un35CdTLpw9uuSaq8ubbM6j3Nw9vuCqqsnyhQT2/tNmK+lWju1Pn+nB7cau1UZVP+8718ubyRqt5Xt3r5n0Dxce2WVm/aiSfxR++Gt1ijVTl7cfb8Q3+D9rtyIgEHrlZAAAAAElFTkSuQmCC" width="213" alt="å½“ â€”jobs = 2 æ—¶ make çš„ç¤ºæ„å›¾"></div></div><p class="title">å›¾ 10-1ã€‚å½“ â€”jobs = 2 æ—¶ make çš„ç¤ºæ„å›¾</p><p class="title">Figure&nbsp;10-1.&nbsp;Diagram of make when â€”jobs = 2</p></div><p>é¦–å…ˆï¼Œ<em class="command">make</em>å¿…é¡»æž„å»ºç”Ÿæˆçš„æºæ–‡ä»¶å’Œä¾èµ–æ–‡ä»¶ã€‚ç”Ÿæˆçš„ä¸¤ä¸ªæºæ–‡ä»¶æ˜¯<em class="command">yacc</em>å’Œ<em class="command">lex</em>çš„è¾“å‡ºã€‚è¿™è¯´æ˜Žäº†å‘½ä»¤ 1 å’Œ 2ã€‚ç¬¬ä¸‰ä¸ªå‘½ä»¤ç”Ÿæˆ<em class="filename">play_mp3.c</em>çš„ä¾èµ–æ–‡ä»¶ï¼Œå¹¶ä¸”æ˜¾ç„¶æ˜¯åœ¨<em class="filename">playlist.c</em>æˆ–<em class="filename">Scanner.c</em>çš„ä¾èµ–æ–‡ä»¶å®Œæˆä¹‹å‰å¼€å§‹çš„ï¼ˆé€šè¿‡å‘½ä»¤ 4ã€5ã€8ã€9ã€12ï¼‰å’Œ 14)ã€‚å› æ­¤ï¼Œå³ä½¿å‘½ä»¤è¡Œé€‰é¡¹è¯·æ±‚ä¸¤ä¸ªä½œä¸šï¼Œæ­¤<em class="command">makeä¹Ÿä¼šå¹¶è¡Œè¿è¡Œä¸‰ä¸ªä½œä¸šã€‚</em></p><p>First, <em class="command">make</em> must build the
        generated source and dependency files. The two generated source files
        are the output of <em class="command">yacc</em> and <em class="command">lex</em>. This accounts for commands 1 and 2. The
        third command generates the dependency file for <em class="filename">play_mp3.c</em> and is clearly begun before the
        dependency files for either <em class="filename">playlist.c</em> or <em class="filename">scanner.c</em> are completed (by commands 4, 5,
        8, 9, 12, and 14). Therefore, this <em class="command">make</em> is running three jobs in parallel, even
        though the command-line option requests two jobs.</p><p><em class="command">mv</em>å‘½ä»¤4 å’Œ 5 å®Œæˆä»Žå‘½ä»¤ 1 å¼€å§‹çš„<em class="filename">playlist.c</em>æºä»£ç ç”Ÿæˆã€‚å‘½ä»¤ 6 å¼€å§‹å¦ä¸€ä¸ªä¾èµ–æ–‡ä»¶ã€‚æ¯ä¸ªå‘½ä»¤è„šæœ¬å§‹ç»ˆç”±å•ä¸ª
        <em class="command">make</em>æ‰§è¡Œï¼Œä½†æ¯ä¸ªç›®æ ‡å’Œå…ˆå†³æ¡ä»¶å½¢æˆä¸€ä¸ªå•ç‹¬çš„ä½œä¸šã€‚å› æ­¤ï¼Œå‘½ä»¤ 7ï¼ˆä¾èµ–é¡¹ç”Ÿæˆè„šæœ¬çš„ç¬¬äºŒä¸ªå‘½ä»¤ï¼‰ç”±ä¸Žå‘½ä»¤ 3 ç›¸åŒçš„<em class="command">make</em>è¿›ç¨‹æ‰§è¡Œã€‚è€Œå‘½ä»¤ 6 å¯èƒ½ç”±æ‰§è¡Œå‘½ä»¤ 1 çš„<em class="command">make</em>å®ŒæˆåŽç«‹å³ç”Ÿæˆçš„<em class="command">make</em>æ‰§è¡Œã€‚ -4-5ï¼ˆå¤„ç†<em class="command">yacc</em>è¯­æ³•ï¼‰ï¼Œä½†åœ¨å‘½ä»¤ 8 ä¸­ç”Ÿæˆä¾èµ–æ–‡ä»¶ä¹‹å‰ã€‚<em class="command"></em><em class="command"></em></p><p>The <em class="command">mv</em> commands, 4 and 5,
        complete the <em class="filename">playlist.c</em> source
        code generation started with command 1. Command 6 begins another
        dependency file. Each command script is always executed by a single
        <em class="command">make</em>, but each target and
        prerequisite forms a separate job. Therefore, command 7, which is the
        second command of the dependency generation script, is being executed
        by the same <em class="command">make</em> process as command
        3. While command 6 is probably being executed by a <em class="command">make</em> spawned immediately following the
        completion of the <em class="command">make</em> that
        executed commands 1-4-5 (processing the <em class="command">yacc</em> grammar), but before the generation of
        the dependency file in command 8.</p><p>ä¾èµ–é¡¹ç”Ÿæˆä»¥è¿™ç§æ–¹å¼ç»§ç»­ï¼Œç›´åˆ°å‘½ä»¤ 14ã€‚æ‰€æœ‰ä¾èµ–é¡¹æ–‡ä»¶å¿…é¡»å…ˆå®Œæˆï¼Œç„¶åŽ<em class="command">make</em>æ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ªå¤„ç†é˜¶æ®µï¼Œé‡æ–°è¯»å–<em class="filename">makefile</em>ã€‚è¿™å½¢æˆäº†ä¸€ä¸ªè‡ªç„¶çš„åŒæ­¥ç‚¹ï¼Œ<em class="command">ä½¿äºº</em>
        è‡ªåŠ¨æœä»Žã€‚</p><p>The dependency generation continues in this fashion until
        command 14. All dependency files must be complete before <em class="command">make</em> can move on to the next phase of
        processing, re-reading the <em class="filename">makefile</em>. This forms a natural
        synchronization point that <em class="command">make</em>
        automatically obeys.</p><p>ä¸€æ—¦ä½¿ç”¨ä¾èµ–ä¿¡æ¯é‡æ–°è¯»å–<em class="filename">makefile ï¼Œ </em><em class="command">make</em>å°±å¯ä»¥å†æ¬¡å¹¶è¡Œåœ°ç»§ç»­æž„å»ºè¿‡ç¨‹ã€‚è¿™æ¬¡<em class="command">make</em>
        é€‰æ‹©åœ¨æž„å»ºæ¯ä¸ªå½’æ¡£åº“ä¹‹å‰ç¼–è¯‘æ‰€æœ‰ç›®æ ‡æ–‡ä»¶ã€‚è¿™ä¸ªé¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœ
        å†æ¬¡è¿è¡Œ<em class="filename">makefile ï¼Œåˆ™å¯èƒ½ä¼šåœ¨ç¼–è¯‘</em><em class="filename">playlist.c</em>ä¹‹å‰æž„å»º<em class="filename">libcodec.a</em>åº“ï¼Œå› ä¸ºè¯¥åº“ä¸éœ€è¦é™¤
        <em class="filename">codec.o</em>ä¹‹å¤–çš„ä»»ä½•å¯¹è±¡ã€‚å› æ­¤ï¼Œè¯¥ç¤ºä¾‹ä»£è¡¨äº†å¤šç§å¯èƒ½çš„æ‰§è¡Œé¡ºåºä¸­çš„ä¸€ç§ã€‚<em class="filename"></em><em class="filename"></em></p><p>Once the <em class="filename">makefile</em> is reread
        with the dependency information, <em class="command">make</em> can continue the build process in
        parallel again. This time <em class="command">make</em>
        chooses to compile all the object files before building each of the
        archive libraries. This order is nondeterministic. That is, if the
        <em class="filename">makefile</em> is run again, it may be
        that the <em class="filename">libcodec.a</em> library might
        be built before the <em class="filename">playlist.c</em> is
        compiled, since that library doesn't require any objects other than
        <em class="filename">codec.o</em>. Thus, the example
        represents one possible execution order amongst many.</p><p>æœ€åŽå°†ç¨‹åºé“¾æŽ¥èµ·æ¥ã€‚å¯¹äºŽè¿™ä¸ª<em class="filename">makefile</em>ï¼Œé“¾æŽ¥é˜¶æ®µä¹Ÿæ˜¯ä¸€ä¸ªè‡ªç„¶çš„åŒæ­¥ç‚¹ï¼Œå¹¶ä¸”æ€»æ˜¯æœ€åŽå‘ç”Ÿã€‚ä½†æ˜¯ï¼Œå¦‚æžœç›®æ ‡ä¸æ˜¯å•ä¸ªç¨‹åºè€Œæ˜¯è®¸å¤šç¨‹åºæˆ–åº“ï¼Œåˆ™æœ€åŽæ‰§è¡Œçš„å‘½ä»¤ä¹Ÿå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚</p><p>Finally, the program is linked. For this <em class="filename">makefile</em>, the link phase is also a natural
        synchronization point and will always occur last. If, however, the
        goal was not a single program but many programs or libraries, the last
        command executed might also vary.</p><p>åœ¨å¤šå¤„ç†å™¨ä¸Šè¿è¡Œå¤šä¸ªä½œä¸šæ˜¾ç„¶æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä½†åœ¨å•å¤„ç†å™¨ä¸Šè¿è¡Œå¤šä¸ªä½œä¸šä¹Ÿéžå¸¸æœ‰ç”¨ã€‚è¿™æ˜¯å› ä¸ºå¤§å¤šæ•°ç³»ç»Ÿä¸Šçš„ç£ç›˜ I/O å»¶è¿Ÿå’Œå¤§é‡ç¼“å­˜æ‰€è‡´ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœä¸€ä¸ªè¿›ç¨‹ï¼ˆä¾‹å¦‚
        <em class="command">gcc</em>ï¼‰ç©ºé—²ç­‰å¾…ç£ç›˜ I/Oï¼Œåˆ™å¦ä¸€ä¸ªä»»åŠ¡ï¼ˆä¾‹å¦‚<em class="command">mv</em>ã€<em class="command">yacc</em>æˆ–<em class="command">ar ï¼‰</em>çš„æ•°æ®å½“å‰å¯èƒ½ä½äºŽå†…å­˜ä¸­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½å…è®¸å…·æœ‰å¯ç”¨æ•°æ®çš„ä»»åŠ¡ç»§ç»­è¿›è¡Œã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨å•å¤„ç†å™¨ä¸Šè¿è¡Œå¸¦æœ‰ä¸¤ä¸ªä½œä¸šçš„<em class="command">make</em>
        å‡ ä¹Žæ€»æ˜¯æ¯”è¿è¡Œä¸€ä¸ªä½œä¸šå¿«ï¼Œå¹¶ä¸”ä¸‰ä¸ªç”šè‡³å››ä¸ªä»»åŠ¡æ¯”ä¸¤ä¸ªä»»åŠ¡å¿«çš„æƒ…å†µå¹¶ä¸ç½•è§ã€‚</p><p>Running multiple jobs on a multiprocessor obviously makes sense,
        but running more than one job on a uniprocessor can also be very
        useful. This is because of the latency of disk I/O and the large
        amount of cache on most systems. For instance, if a process, such as
        <em class="command">gcc</em>, is idle waiting for disk I/O
        it may be that data for another task such as <em class="command">mv</em>, <em class="command">yacc</em>,
        or <em class="command">ar</em> is currently in memory. In
        this case, it would be good to allow the task with available data to
        proceed. In general, running <em class="command">make</em>
        with two jobs on a uniprocessor is almost always faster than running
        one job, and it is not uncommon for three or even four tasks to be
        faster than two.</p><p>è¯¥<code class="option">â€”jobs</code>é€‰é¡¹æ— éœ€ç¼–å·å³å¯ä½¿ç”¨ã€‚å¦‚æžœæ˜¯è¿™æ ·ï¼Œ<em class="command">make</em>å°†äº§ç”Ÿä¸Žè¦æ›´æ–°çš„ç›®æ ‡ä¸€æ ·å¤šçš„ä½œä¸šã€‚è¿™é€šå¸¸æ˜¯ä¸€ä¸ªåä¸»æ„ï¼Œå› ä¸ºå¤§é‡ä½œä¸šé€šå¸¸ä¼šæ·¹æ²¡å¤„ç†å™¨ï¼Œå¹¶ä¸”è¿è¡Œé€Ÿåº¦å¯èƒ½æ¯”å•ä¸ªä½œä¸šæ…¢å¾—å¤šã€‚</p><p>The <code class="option">â€”jobs</code> option can be used without a number.
        If so, <em class="command">make</em> will spawn as many jobs
        as there are targets to be updated. This is usually a bad idea,
        because a large number of jobs will usually swamp a processor and can
        run much slower than even a single job.</p><p>ç®¡ç†å¤šä¸ªä½œä¸šçš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ç³»ç»Ÿå¹³å‡è´Ÿè½½ä½œä¸ºæŒ‡å¯¼ã€‚å¹³å‡è´Ÿè½½æ˜¯ä¸€æ®µæ—¶é—´å†…ï¼ˆé€šå¸¸ä¸º 1 åˆ†é’Ÿã€5 åˆ†é’Ÿå’Œ 15 åˆ†é’Ÿï¼‰å†…å¹³å‡çš„å¯è¿è¡Œè¿›ç¨‹æ•°ã€‚è´Ÿè½½å¹³å‡å€¼ä»¥æµ®ç‚¹æ•°è¡¨ç¤ºã€‚<code class="option">â€”load-average</code>(æˆ–
        <code class="option">-l</code>) é€‰é¡¹ç»™å‡ºäº†ä¸€ä¸ª<em class="command">é˜ˆ</em>å€¼ï¼Œè¶…è¿‡è¯¥é˜ˆå€¼å°±æ— æ³•ç”Ÿæˆæ–°ä½œä¸šã€‚ä¾‹å¦‚ï¼Œå‘½ä»¤ï¼š</p><p>Another way to manage multiple jobs is to use the system load
        average as a guide. The load average is the number of runnable
        processes averaged over some period of time, typically 1 minute, 5
        minutes, and 15 minutes. The load average is expressed as a floating
        point number. The <code class="option">â€”load-average</code> (or
        <code class="option">-l</code>) option gives <em class="command">make</em> a threshold above which new jobs cannot
        be spawned. For example, the command:</p><a id="OEBPS/ch10s03.html.I_5_tt448"></a><pre class="programlisting">$ make --load-average=3.5</pre><pre class="programlisting">$ make --load-average=3.5</pre><p>å‘Šè¯‰<em class="command">make</em>ä»…å½“å¹³å‡è´Ÿè½½å°äºŽæˆ–ç­‰äºŽ 3.5 æ—¶æ‰ç”Ÿæˆæ–°ä½œä¸šã€‚å¦‚æžœå¹³å‡è´Ÿè½½è¾ƒå¤§ï¼Œ<em class="command">åˆ™ make ä¼š</em>ç­‰å¾…ï¼Œç›´åˆ°å¹³å‡è´Ÿè½½ä½ŽäºŽæ­¤æ•°å­—ï¼Œæˆ–è€…ç›´åˆ°æ‰€æœ‰å…¶ä»–ä½œä¸šå®Œæˆã€‚</p><p>tells <em class="command">make</em> to spawn new jobs
        only when the load average is less than or equal to 3.5. If the load
        average is greater, <em class="command">make</em> waits
        until the average drops below this number, or until all the other jobs
        finish.</p><p>åœ¨ç¼–å†™å¹¶è¡Œæ‰§è¡Œçš„<em class="filename">makefile</em>æ—¶ï¼Œæ³¨æ„é€‚å½“çš„å…ˆå†³æ¡ä»¶æ›´ä¸ºé‡è¦ã€‚å¦‚å‰æ‰€è¿°ï¼Œå½“<code class="option">â€”jobs</code>ä¸º 1 æ—¶ï¼Œé€šå¸¸ä¼šä»Žå·¦åˆ°å³è¯„ä¼°å…ˆå†³æ¡ä»¶åˆ—è¡¨ã€‚å½“<code class="option">â€”jobs</code>å¤§äºŽ 1 æ—¶ï¼Œå¯ä»¥å¹¶è¡Œè¯„ä¼°è¿™äº›å…ˆå†³æ¡ä»¶ã€‚å› æ­¤ï¼Œå¹¶è¡Œè¿è¡Œæ—¶ï¼Œç”±é»˜è®¤çš„ä»Žå·¦åˆ°å³è®¡ç®—é¡ºåºéšå¼å¤„ç†çš„ä»»ä½•ä¾èµ–å…³ç³»éƒ½å¿…é¡»æ˜Žç¡®ã€‚</p><p>When writing a <em class="filename">makefile</em> for
        parallel execution, attention to proper prerequisites is even more
        important. As mentioned previously, when <code class="option">â€”jobs</code> is 1,
        a list of prerequisites will usually be evaluated from left to right.
        When <code class="option">â€”jobs</code> is greater than 1, these prerequisites may
        be evaluated in parallel. Therefore, any dependency relationship that
        was implicitly handled by the default left to right evaluation order
        must be made explicit when run in parallel.</p><p><em class="command">å¹¶è¡Œmake</em>çš„å¦ä¸€ä¸ªå±å®³æ˜¯å…±äº«ä¸­é—´æ–‡ä»¶çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœä¸€ä¸ªç›®å½•åŒæ—¶åŒ…å«<em class="filename">foo.y</em>å’Œ<em class="filename">bar.y</em>ï¼Œåˆ™å¹¶è¡Œè¿è¡Œ<em class="command">yacc</em>ä¸¤æ¬¡å¯èƒ½ä¼šå¯¼è‡´å…¶ä¸­ä¸€ä¸ªèŽ·å¾—å¦ä¸€ä¸ª<em class="filename">y.tab.c</em>æˆ–<em class="filename">y.tab.h</em>çš„å®žä¾‹ï¼Œæˆ–è€…ä¸¤è€…éƒ½ç§»åŠ¨åˆ°è‡ªå·±çš„ ä¸­
        <em class="filename">ã€‚ c</em>æˆ–<em class="filename">.h</em>æ–‡ä»¶ã€‚å¯¹äºŽå°†ä¸´æ—¶ä¿¡æ¯å­˜å‚¨åœ¨å…·æœ‰å›ºå®šåç§°çš„ä¸´æ—¶æ–‡ä»¶ä¸­çš„ä»»ä½•è¿‡ç¨‹ï¼Œæ‚¨éƒ½ä¼šé¢ä¸´ç±»ä¼¼çš„å±é™©ã€‚</p><p>Another hazard of parallel <em class="command">make</em> is the problem of shared intermediate
        files. For example, if a directory contains both <em class="filename">foo.y</em> and <em class="filename">bar.y</em>, running <em class="command">yacc</em> twice in parallel could result in one
        of them getting the other's instance of <em class="filename">y.tab.c</em> or <em class="filename">y.tab.h</em> or both moved into its own
        <em class="filename">.c</em> or <em class="filename">.h</em> file. You face a similar hazard with any
        procedure that stores temporary information in a scratch file that has
        a fixed name.</p><p>é˜»ç¢å¹¶è¡Œæ‰§è¡Œçš„å¦ä¸€ä¸ªå¸¸è§ä¹ æƒ¯ç”¨æ³•æ˜¯ä»Ž shell
         <em class="command">for</em>å¾ªçŽ¯è°ƒç”¨é€’å½’<em class="command">make ï¼š</em><em class="command"></em></p><p>Another common idiom that hinders parallel execution is invoking
        a recursive <em class="command">make</em> from a shell
        <em class="command">for</em> loop:</p><a id="OEBPS/ch10s03.html.I_5_tt449"></a><pre class="programlisting">ç›®å½•ï¼š
        å¯¹äºŽ $(SUBDIRS) ä¸­çš„ dï¼› \
        åš \
          $(MAKE) --ç›®å½•=$$d; \
        å®Œæ¯•</pre><pre class="programlisting">dir:
        for d in $(SUBDIRS);       \
        do                         \
          $(MAKE) --directory=$$d; \
        done</pre><p><a class="link" href="#OEBPS/ch06.html" title="ç¬¬ 6 ç« ç®¡ç†å¤§åž‹é¡¹ç›®">æ­£å¦‚ç¬¬ 6</a><a class="link" href="#OEBPS/ch06.html.make3-CHP-6-SECT-1" title="é€’å½’make">ç«  6.1 èŠ‚</a>æ‰€è¿°ï¼Œmake<em class="command">æ— æ³•</em>å¹¶è¡Œæ‰§è¡Œè¿™äº›é€’å½’è°ƒç”¨ã€‚è¦å®žçŽ°å¹¶è¡Œæ‰§è¡Œï¼Œè¯·å£°æ˜Žç›®å½•å¹¶ä½¿å®ƒä»¬æˆä¸ºç›®æ ‡ï¼š<a class="link" href="#OEBPS/ch06.html" title="ç¬¬ 6 ç« ç®¡ç†å¤§åž‹é¡¹ç›®"></a><em class="command"></em><code class="literal">.PHONY</code></p><p>As mentioned in <a class="link" href="#OEBPS/ch06.html.make3-CHP-6-SECT-1" title="Recursive make">Section
        6.1</a> in <a class="link" href="#OEBPS/ch06.html" title="Chapter&nbsp;6.&nbsp;Managing Large Projects">Chapter 6</a>, <em class="command">make</em> cannot execute these recursive
        invocations in parallel. To achieve parallel execution, declare the
        directories <code class="literal">.PHONY</code> and make them
        targets:</p><a id="OEBPS/ch10s03.html.I_5_tt450"></a><pre class="programlisting">.PHONY: $(å­ç›®å½•)
$ï¼ˆå­ç›®å½•ï¼‰ï¼š
        $(MAKE) --ç›®å½•=$@</pre><pre class="programlisting">.PHONY: $(SUBDIRS)
$(SUBDIRS):
        $(MAKE) --directory=$@</pre></div></div></div>
<div id="OEBPS/ch10s04.html"><div>
<div class="sect1" title="åˆ†å¸ƒå¼åˆ¶ä½œ"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch10s04.html.make3-CHP-10-SECT-4"></a>åˆ†å¸ƒå¼åˆ¶ä½œ</h1><h1 class="title"><a></a>Distributed make</h1></div></div></div><p><acronym class="acronym">GNU </acronym> <em class="command">make</em>
        æ”¯æŒä¸€ç‚¹<a id="OEBPS/ch10s04.html.make3-CHP-10-ITERM-1548" class="indexterm"></a> <a id="OEBPS/ch10s04.html.make3-CHP-10-ITERM-1549" class="indexterm"></a>ç”¨äºŽç®¡ç†é€šè¿‡ç½‘ç»œä½¿ç”¨å¤šä¸ªç³»ç»Ÿçš„æž„å»ºçš„å·²çŸ¥ï¼ˆä¸”ä»…ç»è¿‡è½»å¾®æµ‹è¯•ï¼‰æž„å»ºé€‰é¡¹ã€‚è¯¥åŠŸèƒ½ä¾èµ–äºŽéš<em class="command">Pmake</em>åˆ†å‘çš„ Customs åº“ã€‚<em class="command">Pmake</em>æ˜¯Adam de Boor äºŽ 1989 å¹´å·¦å³ä¸º Sprite æ“ä½œç³»ç»Ÿç¼–å†™çš„<em class="command">make</em>çš„æ›¿ä»£ç‰ˆæœ¬ï¼ˆæ­¤åŽç”± Andreas Stolcke ç»´æŠ¤ï¼‰ã€‚ Customs åº“æœ‰åŠ©äºŽåœ¨å¤šå°æœºå™¨ä¸Šå¹¶è¡Œåˆ†å‘<em class="command">make</em>æ‰§è¡Œã€‚ä»Žç‰ˆæœ¬ 3.77 å¼€å§‹ï¼Œ<acronym class="acronym">GNU </acronym> <em class="command">makeå·²åŒ…å«å¯¹ç”¨äºŽåˆ†å‘</em><em class="command">make çš„</em>Customs åº“çš„æ”¯æŒã€‚</p><p><acronym class="acronym">GNU</acronym> <em class="command">make</em>
        supports a little <a class="indexterm"></a> <a class="indexterm"></a>known (and only slightly tested) build option for
        managing builds that uses multiple systems over a network. The feature
        relies upon the Customs library distributed with <em class="command">Pmake</em>. <em class="command">Pmake</em> is an alternate version of <em class="command">make</em> written in about 1989 by Adam de Boor
        (and maintained ever since by Andreas Stolcke) for the Sprite
        operating system. The Customs library helps to distribute a <em class="command">make</em> execution across many machines in
        parallel. As of version 3.77, <acronym class="acronym">GNU</acronym> <em class="command">make</em> has included support for the Customs
        library for distributing <em class="command">make</em>.</p><p>è¦å¯ç”¨ Customs åº“æ”¯æŒï¼Œæ‚¨å¿…é¡»ä»Žæºé‡å»º<em class="command">make</em> ã€‚æ­¤è¿‡ç¨‹çš„è¯´æ˜Žä½äºŽ<em class="command">makeå‘è¡Œç‰ˆçš„</em><em class="filename">README.customs</em>
        æ–‡ä»¶ä¸­ã€‚é¦–å…ˆï¼Œæ‚¨å¿…é¡»ä¸‹è½½å¹¶æž„å»º<em class="command">pmake</em>å‘è¡Œç‰ˆï¼ˆURL ä½äºŽ README ä¸­ï¼‰ï¼Œç„¶åŽä½¿ç”¨è¯¥
        é€‰é¡¹æž„å»º<em class="command">make</em>ã€‚<em class="command"></em><em class="command"></em><em class="command"></em><code class="option">â€”with-customs</code></p><p>To enable Customs library support, you must rebuild <em class="command">make</em> from sources. The instructions for this
        process are in the <em class="filename">README.customs</em>
        file in the <em class="command">make</em> distribution.
        First, you must download and build the <em class="command">pmake</em> distribution (the URL is in the
        README), then build <em class="command">make</em> with the
        <code class="option">â€”with-customs</code> option.</p><p>Customs åº“çš„æ ¸å¿ƒæ˜¯åœ¨å‚ä¸Žåˆ†å¸ƒå¼<em class="command">make</em>ç½‘ç»œçš„æ¯ä¸ªä¸»æœºä¸Šè¿è¡Œçš„ Customs å®ˆæŠ¤è¿›ç¨‹ã€‚è¿™äº›ä¸»æœºå¿…é¡»å…±äº«æ–‡ä»¶ç³»ç»Ÿçš„å…¬å…±è§†å›¾ï¼Œä¾‹å¦‚ NFS æä¾›çš„ã€‚æµ·å…³å®ˆæŠ¤è¿›ç¨‹çš„ä¸€ä¸ªå®žä¾‹è¢«æŒ‡å®šä¸ºä¸»è¿›ç¨‹ã€‚ Master ç›‘æŽ§å‚ä¸Žä¸»æœºåˆ—è¡¨ä¸­çš„ä¸»æœºï¼Œå¹¶å°†ä½œä¸šåˆ†é…ç»™æ¯ä¸ªæˆå‘˜ã€‚å½“<em class="command">make</em><code class="option">â€”jobs</code>ä»¥å¤§äºŽ 1 çš„æ ‡å¿—è¿è¡Œ
        æ—¶ï¼Œ <em class="command">make</em>ä¼šè”ç³» masterï¼Œå®ƒä»¬ä¸€èµ·åœ¨ç½‘ç»œä¸­çš„å¯ç”¨ä¸»æœºä¸Šç”Ÿæˆä½œä¸šã€‚</p><p>The heart of the Customs library is the customs daemon that runs
        on each host participating in the distributed <em class="command">make</em> network. These hosts must all share a
        common view of the filesystem, such as NFS provides. One instance of
        the customs daemon is designated the master. The master monitors hosts
        in the participating hosts list and allocates jobs to each member.
        When <em class="command">make</em> is run with the
        <code class="option">â€”jobs</code> flag greater than 1, <em class="command">make</em> contacts the master and together they
        spawn jobs on available hosts in the network.</p><p>Customs åº“æ”¯æŒå¤šç§åŠŸèƒ½ã€‚ä¸»æœºå¯ä»¥æŒ‰ä½“ç³»ç»“æž„åˆ†ç»„å¹¶è¿›è¡Œæ€§èƒ½è¯„çº§ã€‚å¯ä»¥å°†ä»»æ„å±žæ€§åˆ†é…ç»™ä¸»æœºï¼Œå¹¶ä¸”å¯ä»¥åŸºäºŽå±žæ€§å’Œå¸ƒå°”è¿ç®—ç¬¦çš„ç»„åˆå°†ä½œä¸šåˆ†é…ç»™ä¸»æœºã€‚æ­¤å¤–ï¼Œåœ¨å¤„ç†ä½œä¸šæ—¶ï¼Œè¿˜å¯ä»¥è€ƒè™‘ä¸»æœºçŠ¶æ€ï¼Œä¾‹å¦‚ç©ºé—²æ—¶é—´ã€å¯ç”¨ç£ç›˜ç©ºé—´ã€å¯ç”¨äº¤æ¢ç©ºé—´å’Œå½“å‰å¹³å‡è´Ÿè½½ã€‚</p><p>The Customs library supports a wide range of features. Hosts can
        be grouped by architecture and rated for performance. Arbitrary
        attributes can be assigned to hosts and jobs can be allocated to hosts
        based on combinations of attributes and boolean operators.
        Additionally, host status such as idle time, free disk space, free
        swap space, and current load average can also be accounted for when
        processing jobs.</p><p>å¦‚æžœæ‚¨çš„é¡¹ç›®æ˜¯ç”¨ Cã€C++ æˆ– Objective-C å®žçŽ°çš„ï¼Œæ‚¨è¿˜åº”è¯¥è€ƒè™‘ä½¿ç”¨<em class="command">distcc</em> ( <a class="ulink" href="http://distcc.samba.org/">http://distcc.samba.org</a> ) åœ¨å¤šä¸ªä¸»æœºä¸Šåˆ†å‘ç¼–è¯‘ã€‚<em class="command">distcc</em>æ˜¯ç”± Martin Pool å’Œå…¶ä»–äººç¼–å†™çš„ï¼Œæ—¨åœ¨åŠ é€Ÿ Samba æž„å»ºã€‚å¯¹äºŽç”¨ Cã€C++ æˆ– Objective-C ç¼–å†™çš„é¡¹ç›®æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”å®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚ä½¿ç”¨è¯¥å·¥å…·åªéœ€å°† C ç¼–è¯‘å™¨æ›¿æ¢ä¸º<em class="command">distcc</em>ç¨‹åºå³å¯ï¼š</p><p>If your project is implemented in C, C++, or Objective-C you
        should also consider <em class="command">distcc</em> (<a class="ulink" href="http://distcc.samba.org">http://distcc.samba.org</a>) for distributing compiles
        across several hosts. <em class="command">distcc</em> was
        written by Martin Pool and others to speedup Samba builds. It is a
        robust and complete solution for projects written in C, C++, or
        Objective-C. The tool is used by simply replacing the C compiler with
        the <em class="command">distcc</em> program:</p><a id="OEBPS/ch10s04.html.I_5_tt451"></a><pre class="programlisting">$<strong class="userinput"><code>make --jobs=8 CC=distcc</code></strong></pre><pre class="programlisting">$<strong class="userinput"><code>make --jobs=8 CC=distcc</code></strong></pre><p>å¯¹äºŽæ¯æ¬¡ç¼–è¯‘ï¼Œ<em class="command">distcc</em>
        ä½¿ç”¨æœ¬åœ°ç¼–è¯‘å™¨æ¥é¢„å¤„ç†è¾“å‡ºï¼Œç„¶åŽå°†æ‰©å±•æºå‘é€åˆ°å¯ç”¨çš„è¿œç¨‹è®¡ç®—æœºè¿›è¡Œç¼–è¯‘ã€‚æœ€åŽï¼Œè¿œç¨‹ä¸»æœºå°†ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶è¿”å›žç»™ä¸»æœºã€‚è¿™ç§æ–¹æ³•æ¶ˆé™¤äº†å…±äº«æ–‡ä»¶ç³»ç»Ÿçš„å¿…è¦æ€§ï¼Œæžå¤§åœ°ç®€åŒ–äº†å®‰è£…å’Œé…ç½®ã€‚</p><p>For each compilation, <em class="command">distcc</em>
        uses the local compiler to preprocess the output, then ships the
        expanded source to an available remote machine for compilation.
        Finally, the remote host returns the resulting object file to the
        master. This approach removes the necessity for having a shared
        filesystem, greatly simplifying installation and configuration.</p><p>å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æŒ‡å®šå·¥ä½œäººå‘˜æˆ–<em class="firstterm">å¿—æ„¿è€…</em>ä¸»æœºé›†ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯åœ¨å¯åŠ¨<em class="command">distcc</em>ä¹‹å‰åœ¨çŽ¯å¢ƒå˜é‡ä¸­åˆ—å‡ºå¿—æ„¿è€…ä¸»æœºï¼š</p><p>The set of worker or <em class="firstterm">volunteer</em> hosts can
        be specified in several ways. The simplest is to list the volunteer
        hosts in an environment variable before starting <em class="command">distcc</em>:</p><a id="OEBPS/ch10s04.html.I_5_tt452"></a><pre class="programlisting">$<strong class="userinput"><code>export DISTCC_HOSTS='localhost wasatch oops'</code></strong></pre><pre class="programlisting">$<strong class="userinput"><code>export DISTCC_HOSTS='localhost wasatch oops'</code></strong></pre><p><em class="command">distcc</em>æ˜¯éžå¸¸å¯é…ç½®çš„ï¼Œå…·æœ‰ç”¨äºŽå¤„ç†ä¸»æœºåˆ—è¡¨ã€ä¸Žæœ¬æœºç¼–è¯‘å™¨é›†æˆã€ç®¡ç†åŽ‹ç¼©ã€æœç´¢è·¯å¾„ä»¥åŠå¤„ç†æ•…éšœå’Œæ¢å¤çš„é€‰é¡¹ã€‚</p><p><em class="command">distcc</em> is very configurable
        with options for handling host lists, integrating with the native
        compiler, managing compression, search paths, and handling failure and
        recovery.</p><p><em class="command">ccache</em>æ˜¯å¦ä¸€ä¸ªæé«˜ç¼–è¯‘æ€§èƒ½çš„å·¥å…·ï¼Œç”± Samba é¡¹ç›®è´Ÿè´£äºº Andrew Tridgell ç¼–å†™ã€‚æƒ³æ³•å¾ˆç®€å•ï¼Œç¼“å­˜ä¹‹å‰ç¼–è¯‘çš„ç»“æžœã€‚åœ¨æ‰§è¡Œç¼–è¯‘ä¹‹å‰ï¼Œæ£€æŸ¥ç¼“å­˜æ˜¯å¦å·²åŒ…å«ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶ã€‚è¿™ä¸éœ€è¦å¤šä¸ªä¸»æœºï¼Œç”šè‡³ä¸éœ€è¦ç½‘ç»œã€‚ä½œè€…æŠ¥å‘Šè¯´ï¼Œæ™®é€šç¼–è¯‘çš„é€Ÿåº¦æé«˜äº† 5 åˆ° 10 å€ã€‚ä½¿ç”¨<em class="command">ccache</em>æœ€ç®€å•çš„æ–¹æ³•æ˜¯åœ¨ç¼–è¯‘å™¨å‘½ä»¤å‰åŠ ä¸Š<em class="command">ccache</em>å‰ç¼€ï¼š</p><p><em class="command">ccache</em> is another tool for
        improving compilation performance, written by Samba project leader
        Andrew Tridgell. The idea is simple, cache the results of previous
        compiles. Before performing a compile, check if the cache already
        contains the resulting object files. This does not require multiple
        hosts, or even a network. The author reports a 5 to 10 times speed up
        in common compilations. The easiest way to use <em class="command">ccache</em> is to prefix your compiler command
        with <em class="command">ccache</em>:</p><a id="OEBPS/ch10s04.html.I_5_tt453"></a><pre class="programlisting">$<strong class="userinput"><code>make CC='ccache gcc'</code></strong></pre><pre class="programlisting">$<strong class="userinput"><code>make CC='ccache gcc'</code></strong></pre><p><em class="command">ccacheå¯ä»¥ä¸Ž</em><em class="command">distcc</em>ä¸€èµ·ä½¿ç”¨ï¼Œä»¥å®žçŽ°æ›´å¤§çš„æ€§èƒ½æ”¹è¿›ã€‚æ­¤å¤–ï¼Œè¿™ä¸¤ä¸ªå·¥å…·éƒ½å¯ä»¥åœ¨ Cygwin å·¥å…·é›†ä¸­ä½¿ç”¨ã€‚</p><p><em class="command">ccache</em> can be used together
        with <em class="command">distcc</em> for even greater
        performance improvements. In addition, both tools are available in the
        Cygwin tool set.</p></div></div></div>
<div id="OEBPS/ch11.html"><div>
<div class="chapter" title="ç¬¬ 11 ç«  Makefile ç¤ºä¾‹"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch11.html.make3-CHP-11"></a>ç¬¬ 11 ç«  Makefile ç¤ºä¾‹</h1><h1 class="title"><a></a>Chapter&nbsp;11.&nbsp;Example Makefiles</h1></div></div></div><p>æœ¬ä¹¦ä¸­æ˜¾ç¤ºçš„makefileå…·æœ‰å·¥ä¸šå¼ºåº¦ï¼Œéžå¸¸é€‚åˆé€‚åº”æ‚¨æœ€é«˜çº§çš„éœ€æ±‚<em class="filename">ã€‚</em>ä½†ä»ç„¶å€¼å¾—æŸ¥çœ‹çŽ°å®žé¡¹ç›®ä¸­çš„ä¸€äº›<em class="filename">makefile</em> ï¼Œçœ‹çœ‹äººä»¬åœ¨æä¾›å¯äº¤ä»˜æˆæžœçš„åŽ‹åŠ›ä¸‹ä½¿ç”¨<em class="command">make</em>åšäº†ä»€ä¹ˆã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¯¦ç»†è®¨è®ºå‡ ä¸ªç¤ºä¾‹<em class="filename">makefile</em> ã€‚ç¬¬ä¸€ä¸ªç¤ºä¾‹æ˜¯
      æž„å»ºæœ¬ä¹¦çš„<em class="filename">makefile</em> ã€‚ç¬¬äºŒä¸ªæ˜¯ç”¨äºŽæž„å»º 2.6.7 Linux å†…æ ¸çš„<em class="filename">makefile ã€‚</em></p><p>The <em class="filename">makefile</em>s shown
      throughout this book are industrial strength and quite suitable for
      adapting to your most advanced needs. But it's still worthwhile looking
      at some <em class="filename">makefile</em>s from real-life
      projects to see what people have done with <em class="command">make</em> under the stress of providing
      deliverables. Here, we discuss several example <em class="filename">makefile</em>s in detail. The first example is the
      <em class="filename">makefile</em> to build this book. The
      second is the <em class="filename">makefile</em> used to
      build the 2.6.7 Linux kernel.</p><div class="sect1" title="æœ¬ä¹¦ Makefile"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch11.html.make3-CHP-11-SECT-1"></a>æœ¬ä¹¦ Makefile</h1><h1 class="title"><a></a>The Book Makefile</h1></div></div></div><p>å†™ä¸€æœ¬å…³äºŽç¼–ç¨‹çš„ä¹¦æ˜¯åœ¨<a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1550" class="indexterm"></a> <a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1551" class="indexterm"></a>æœ¬èº«å°±æ˜¯æž„å»ºç³»ç»Ÿçš„ä¸€ä¸ªæœ‰è¶£çš„ç»ƒä¹ ã€‚æœ¬ä¹¦çš„æ–‡æœ¬ç”±è®¸å¤šæ–‡ä»¶ç»„æˆï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½éœ€è¦å„ç§é¢„å¤„ç†æ­¥éª¤ã€‚è¿™äº›ç¤ºä¾‹æ˜¯çœŸå®žçš„ç¨‹åºï¼Œåº”è¯¥è¿è¡Œï¼Œå¹¶æ”¶é›†å…¶è¾“å‡ºã€è¿›è¡ŒåŽå¤„ç†å¹¶åŒ…å«åœ¨æ­£æ–‡ä¸­ï¼ˆè¿™æ ·å°±ä¸å¿…å‰ªåˆ‡å’Œç²˜è´´å®ƒä»¬ï¼Œä»Žè€Œé¿å…å¼•å…¥é”™è¯¯çš„é£Žé™©ï¼‰ã€‚åœ¨æ’°å†™è¿‡ç¨‹ä¸­ï¼Œèƒ½å¤Ÿä»¥ä¸åŒæ ¼å¼æŸ¥çœ‹æ–‡æœ¬éžå¸¸æœ‰ç”¨ã€‚æœ€åŽï¼Œè¿é€ææ–™éœ€è¦åŒ…è£…ã€‚å½“ç„¶ï¼Œæ‰€æœ‰è¿™äº›éƒ½å¿…é¡»æ˜¯å¯é‡å¤çš„å¹¶ä¸”ç›¸å¯¹æ˜“äºŽç»´æŠ¤ã€‚</p><p>Writing a book on programming is in <a class="indexterm"></a> <a class="indexterm"></a>itself an interesting exercise in building systems. The
        text of the book consists of many files, each of which needs various
        preprocessing steps. The examples are real programs that should be run
        and their output collected, post-processed, and included in the main
        text (so that they don't have to be cut and pasted, with the risk of
        introducing errors). During composition, it is useful to be able to
        view the text in different formats. Finally, delivering the material
        requires packaging. Of course, all of this must be repeatable and
        relatively easy to maintain.</p><p><em class="command">å¬èµ·æ¥åƒæ˜¯ä¸€ä»½make</em>çš„å·¥ä½œï¼è¿™æ˜¯<em class="command">make</em>çš„ä¸€å¤§ä¼˜ç‚¹ã€‚å®ƒå¯ä»¥åº”ç”¨äºŽè§£å†³å„ç§å„æ ·çš„é—®é¢˜ã€‚æœ¬ä¹¦ä»¥ DocBook æ ¼å¼ï¼ˆå³ XMLï¼‰ç¼–å†™ã€‚ä½¿ç”¨<em class="command">make</em>åˆ° TEXã€LATEX æˆ–<em class="command">troff</em>æ˜¯ä½¿ç”¨è¿™äº›å·¥å…·æ—¶çš„æ ‡å‡†ç¨‹åºã€‚</p><p>Sounds like a job for <em class="command">make</em>!
        This is one of the great beauties of <em class="command">make</em>. It can be applied to an amazing
        variety of problems. This book was written in DocBook format (i.e.,
        XML). Applying <em class="command">make</em> to TEX, LATEX,
        or <em class="command">troff</em> is standard procedure when
        using those tools.</p><p><a class="link" href="#OEBPS/ch11.html.make3-CHP-11-EX-1" title="ä¾‹11-1ã€‚æž„å»ºæœ¬ä¹¦çš„ makefile">ä¾‹ 11-1</a>æ˜¾ç¤ºäº†æœ¬ä¹¦çš„æ•´ä¸ª<em class="filename">makefile</em> ã€‚å®ƒå¤§çº¦æœ‰ 440 è¡Œé•¿ã€‚ makefileåˆ†ä¸ºä»¥ä¸‹åŸºæœ¬ä»»åŠ¡<em class="filename">ï¼š</em></p><p><a class="link" href="#OEBPS/ch11.html.make3-CHP-11-EX-1" title="Example&nbsp;11-1.&nbsp;The makefile to build the book">Example 11-1</a> shows the
        entire <em class="filename">makefile</em> for the book. It
        is about 440 lines long. The <em class="filename">makefile</em> is divided into these basic
        tasks:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>ç®¡ç†ç¤ºä¾‹</p></li><li class="listitem"><p>Managing the examples</p></li><li class="listitem"><p>é¢„å¤„ç† XML</p></li><li class="listitem"><p>Preprocessing the XML</p></li><li class="listitem"><p>ç”Ÿæˆå„ç§è¾“å‡ºæ ¼å¼</p></li><li class="listitem"><p>Generating various output formats</p></li><li class="listitem"><p>éªŒè¯æ¥æº</p></li><li class="listitem"><p>Validating the source</p></li><li class="listitem"><p>åŸºæœ¬ç»´æŠ¤</p></li><li class="listitem"><p>Basic maintenance</p></li></ul></div><div class="example"><a id="OEBPS/ch11.html.make3-CHP-11-EX-1"></a><p class="title">ä¾‹11-1ã€‚æž„å»ºæœ¬ä¹¦çš„ makefile</p><p class="title">Example&nbsp;11-1.&nbsp;The makefile to build the book</p><div class="example-contents"><pre class="programlisting"># åˆ¶ä½œè¿™æœ¬ä¹¦ï¼
#
# è¯¥æ–‡ä»¶ä¸­çš„ä¸»è¦ç›®æ ‡æ˜¯ï¼š
#
# show_pdf ç”Ÿæˆ pdf å¹¶å¯åŠ¨æŸ¥çœ‹å™¨
# pdf ç”Ÿæˆ pdf
# print æ‰“å°pdf
# show_html ç”Ÿæˆ html å¹¶å¯åŠ¨æŸ¥çœ‹å™¨
# html ç”Ÿæˆ html
# xml ç”Ÿæˆ xml
#release åˆ¶ä½œä¸€ä¸ªå‘å¸ƒ tarball
# clean æ¸…ç†ç”Ÿæˆçš„æ–‡ä»¶
#

BOOK_DIR := /æµ‹è¯•/ä¹¦
SOURCE_DIR := æ–‡æœ¬
OUTPUT_DIR := è¾“å‡º
Examples_DIR := ç¤ºä¾‹

å®‰é™=@

å¤–å£³ = bash
AWK := awk
CP := CP
EGREP := egrep
HTML_VIEWER := cygstart
æ€æ­» := /bin/kill
M4 := m4
MV := MV
PDF_VIEWER := cygstart
RM := rm -f
MKDIR := mkdir -p
LNDIR := lndir
SED := sed
æŽ’åº := æŽ’åº
è§¦æ‘¸ := è§¦æ‘¸
XMLTO := xmlto
XMLTO_FLAGS = -o $(OUTPUT_DIR) $(XML_VERBOSE)
è¿›ç¨‹ pgm := bin/è¿›ç¨‹åŒ…å«
make-depend := bin/make-depend

m4-å® := æ–‡æœ¬/å®.m4

# $(è°ƒç”¨è¿‡ç¨‹-åŒ…å«ã€è¾“å…¥æ–‡ä»¶ã€è¾“å‡ºæ–‡ä»¶)
# åˆ é™¤é€‰é¡¹å¡ã€å±•å¼€å®å¹¶å¤„ç†åŒ…å«æŒ‡ä»¤ã€‚
å®šä¹‰æµç¨‹åŒ…æ‹¬
  å±•å¼€ $1 | \
  $(M4) --prefix-builtins --include=text $(m4-å®) - | \
  $(è¿›ç¨‹-PGM) &gt; $2
æ©å¾·å¤«

# $(è°ƒç”¨æ–‡ä»¶å­˜åœ¨ï¼Œæ–‡ä»¶å)
# å¦‚æžœæ–‡ä»¶å­˜åœ¨åˆ™è¿”å›žéžç©ºã€‚
æ–‡ä»¶å­˜åœ¨= $(é€šé…ç¬¦$1)

# $(è°ƒç”¨ Maybe-mkdir, ç›®å½•åç§°-opt)
# å¦‚æžœç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ªã€‚
# å¦‚æžœçœç•¥äº†directory-name-optï¼Œåˆ™ä½¿ç”¨$@ ä½œä¸ºç›®å½•åã€‚
ä¹Ÿè®¸-mkdir = $(å¦‚æžœ$(è°ƒç”¨æ–‡ä»¶å­˜åœ¨ï¼Œ\
                     $(å¦‚æžœ $1,$1,$(dir $@))),, \
                $(MKDIR) $(å¦‚æžœ $1,$1,$(dir $@)))

# $(kill-acroread)
# ç»ˆæ­¢ acrobat readerã€‚
å®šä¹‰kill-acroread
  $(å®‰é™) ps -W | \
  $(AWK) 'å¼€å§‹ { FieldWIDTHS = "9 47 100" } \
          /AcroRd32/ { \
                       æ‰“å°â€œæ€æ­»â€$$3ï¼› \
                       ç³»ç»Ÿ(â€œ$(KILL)-fâ€$$1)\
                     }'
æ©å¾·å¤«

# $(è°ƒç”¨æºåˆ°è¾“å‡ºï¼Œæ–‡ä»¶å)
# å°†æºæ ‘å¼•ç”¨è½¬æ¢ä¸ºè¾“å‡ºæ ‘å¼•ç”¨ã€‚
å®šä¹‰æºåˆ°è¾“å‡º
$(subst $(SOURCE_DIR),$(OUTPUT_DIR),$1)
æ©å¾·å¤«

# $(è°ƒç”¨è¿è¡Œè„šæœ¬ç¤ºä¾‹ã€è„šæœ¬åç§°ã€è¾“å‡ºæ–‡ä»¶)
# è¿è¡Œç¤ºä¾‹ makefileã€‚
å®šä¹‰è¿è¡Œè„šæœ¬ç¤ºä¾‹
  ( cd $(dir $1); \
    $(notdir $1) 2&gt;&amp;1 | $(notdir $1) 2&gt;&amp;1 | \
    if $(EGREP) --silent '\$$\(MAKE\)' [mM]akefile; \
    ç„¶åŽ \
      $(SED) -e 's/^++*/$$/'; \
    åˆ«çš„ \
      $(SED) -e 's/^++*/$$/' \
             -e '/ing ç›®å½• /d' \
             -e 's/\[[0-9]\]//'; \
    ï¼‰\
  &gt; $(TMP)/out.$$$$ &amp; \
  $(MV) $(TMP)/è¾“å‡ºã€‚$$$$ $2
æ©å¾·å¤«

# $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œç¤ºä¾‹ç›®å½•)
# åˆ›å»ºè§„åˆ™æ¥æž„å»ºé€šç”¨ç¤ºä¾‹ã€‚
å®šä¹‰é€šç”¨ç¨‹åºç¤ºä¾‹
  $(eval $1_dir := $(OUTPUT_DIR)/$1)
  $(eval $1_make_out := $($1_dir)/make.out)
  $(eval $1_run_out := $($1_dir)/run.out)
  $(eval $1_clean := $($1_dir)/clean)
  $(eval $1_run_make := $($1_dir)/run-make)
  $(eval $1_run_run := $($1_dir)/run-run)
  $(eval $1_sources := $(è¿‡æ»¤å‡º %/CVS, $(é€šé…ç¬¦ $(EXAMPLES_DIR)/$1/*)))

  $($1_run_out): $($1_make_out) $($1_run_run)
        $$(è°ƒç”¨è¿è¡Œè„šæœ¬ç¤ºä¾‹ï¼Œ$($1_run_run)ï¼Œ$$@)

  $($1_make_out): $($1_clean) $($1_run_make)
        $$(è°ƒç”¨è¿è¡Œè„šæœ¬ç¤ºä¾‹ï¼Œ$($1_run_make)ï¼Œ$$@)

  $($1_clean): $($1_sources) Makefile
        $(RM) -r $($1_dir)
        $(MKDIR) $($1_dir)
        $(LNDIR) -silent ../../$(EXAMPLES_DIR)/$1 $($1_dir)
        $ï¼ˆè§¦æ‘¸ï¼‰$$@

  $($1_run_make):
        printf "#! /bin/bash -x\nmake\n" &gt; $$@
æ©å¾·å¤«


# ä¹¦ç±è¾“å‡ºæ ¼å¼ã€‚
BOOK_XML_OUT := $(OUTPUT_DIR)/book.xml
BOOK_HTML_OUT := $(subst xml,html,$(BOOK_XML_OUT))
BOOK_FO_OUT := $(subst xml,fo,$(BOOK_XML_OUT))
BOOK_PDF_OUT := $(subst xml,pdf,$(BOOK_XML_OUT))
ALL_XML_SRC := $(é€šé…ç¬¦ $(SOURCE_DIR)/*.xml)
ALL_XML_OUT := $(è°ƒç”¨æºåˆ°è¾“å‡º,$(ALL_XML_SRC))
DEPENDENCY_FILES := $(è°ƒç”¨æºåˆ°è¾“å‡º,$(subst .xml,.d,$(ALL_XML_SRC)))


# xml/html/pdf - ä¸ºæœ¬ä¹¦ç”Ÿæˆæ‰€éœ€çš„è¾“å‡ºæ ¼å¼ã€‚
.PHONYï¼šxml html pdf
xml: $(OUTPUT_DIR)/éªŒè¯
html: $(BOOK_HTML_OUT)
pdfï¼š$(BOOK_PDF_OUT)

# show_pdf - ç”Ÿæˆ pdf æ–‡ä»¶å¹¶æ˜¾ç¤ºå®ƒã€‚
.PHONYï¼šshow_pdf show_html æ‰“å°
æ˜¾ç¤º_pdfï¼š$(BOOK_PDF_OUT)
        $(kill-acroread)
        $(PDF_VIEWER) $(BOOK_PDF_OUT)

# show_html - ç”Ÿæˆ html æ–‡ä»¶å¹¶æ˜¾ç¤ºå®ƒã€‚
show_htmlï¼š$ï¼ˆBOOK_HTML_OUTï¼‰
        $(HTML_VIEWER) $(BOOK_HTML_OUT)

# print - æ‰“å°ä¹¦ä¸­çš„æŒ‡å®šé¡µé¢ã€‚
æ‰“å°ï¼š$(BOOK_FO_OUT)
        $(kill-acroread)
        java -Dstart=15 -Dend=15 $(FOP) $&lt; -print &gt; /dev/null

# $(BOOK_PDF_OUT) - ç”Ÿæˆ pdf æ–‡ä»¶ã€‚
$(BOOK_PDF_OUT): $(BOOK_FO_OUT) ç”Ÿæˆæ–‡ä»¶

# $(BOOK_HTML_OUT) - ç”Ÿæˆ html æ–‡ä»¶ã€‚
$(BOOK_HTML_OUT): $(ALL_XML_OUT) $(OUTPUT_DIR)/éªŒè¯ Makefile

# $(BOOK_FO_OUT) - ç”Ÿæˆ fo ä¸­é—´è¾“å‡ºæ–‡ä»¶ã€‚
.INTERMEDIATEï¼š$(BOOK_FO_OUT)
$(BOOK_FO_OUT): $(ALL_XML_OUT) $(OUTPUT_DIR)/éªŒè¯ Makefile

# $(BOOK_XML_OUT) - å¤„ç†æ‰€æœ‰ xml è¾“å…¥æ–‡ä»¶ã€‚
$(BOOK_XML_OUT): ç”Ÿæˆæ–‡ä»¶

#################################################### ##############
# FOP æ”¯æŒ
#
FOP := org.apache.fop.apps.Fop

# DEBUG_FOP - å®šä¹‰å®ƒä»¥æŸ¥çœ‹ fop å¤„ç†å™¨è¾“å‡ºã€‚
ifndef è°ƒè¯•_FOP
  FOP_FLAGS := -q
  FOP_è¾“å‡ºï¼š= | $(SED) -e '/æœªå®žçŽ°/d' \
                         -e '/ç›¸å¯¹å¯¹é½/d' \
                         -e '/xsl-è„šæ³¨åˆ†éš”ç¬¦/d'
ä¸‡ä¸€

# CLASSPATH - ä¸º fop è®¡ç®—é€‚å½“çš„ CLASSPATHã€‚
å¯¼å‡ºç±»è·¯å¾„
ç±»è·¯å¾„ = $(patsubst %;,%, \
              $(subst ; ,;, \
                $(addprefix c:/usr/xslt-process-2.2/java/, \
                  $(æ·»åŠ åŽç¼€.jar;,\
                    å¤å…°\
                    xercesImpl \
                    èœ¡æŸ“\
                    ç¦æ™®\
                    å‰ç±³-1.0 \
                    Avalon-framework-cvs-20020315))))

# %.pdf - ä»Ž fo è¾“å…¥ç”Ÿæˆ pdf è¾“å‡ºçš„æ¨¡å¼è§„åˆ™ã€‚
%.pdf: %.fo
        $(kill-acroread)
        java -Xmx128M $(FOP) $(FOP_FLAGS) $&lt; $@ $(FOP_OUTPUT)

# %.fo - ä»Ž xml è¾“å…¥ç”Ÿæˆ fo è¾“å‡ºçš„æ¨¡å¼è§„åˆ™ã€‚
PAPER_SIZE := å­—æ¯
%.fo: %.xml
        XSLT_FLAGS="--stringparam paper.type $(PAPER_SIZE)" \
        $(XMLTO) $(XMLTO_FLAGS) fo $&lt;

# %.html - ä»Ž xml è¾“å…¥ç”Ÿæˆ html è¾“å‡ºçš„æ¨¡å¼è§„åˆ™ã€‚
%.html: %.xml
        $(XMLTO) $(XMLTO_FLAGS) html-nochunks $&lt;

# fop_help - æ˜¾ç¤º fop å¤„ç†å™¨å¸®åŠ©æ–‡æœ¬ã€‚
.PHONYï¼šfop_help
fop_å¸®åŠ©ï¼š
        -java org.apache.fop.apps.Fop -help
        -java org.apache.fop.apps.Fop -æ‰“å°å¸®åŠ©

#################################################### ##############
# release - åˆ¶ä½œæœ¬ä¹¦çš„ç‰ˆæœ¬ã€‚
#
RELEASE_TAR := mpwm-$(shell æ—¥æœŸ +%F).tar.gz
RELEASE_FILES := README Makefile *.pdf bin ç¤ºä¾‹è¾“å‡ºæ–‡æœ¬

.PHONYï¼šå‘å¸ƒ
å‘å¸ƒï¼š$(BOOK_PDF_OUT)
        ln -sf $(BOOK_PDF_OUT) ã€‚
        ç„¦æ²¹â€”â€”åˆ›å»º\
            --gzip\
            --file=$(RELEASE_TAR) \
            --æŽ’é™¤=CVS \
            --exclude=semantic.cache \
            --æŽ’é™¤=*~ \
            $(RELEASE_FILES)
        ls -l $(RELEASE_TAR)

#################################################### ##############
# ç¬¬ 1 ç« ç¤ºä¾‹çš„è§„åˆ™ã€‚
#

# è¿™æ˜¯æ‰€æœ‰ç¤ºä¾‹ç›®å½•ã€‚
ä¾‹å­:= \
                ch01-ä¼ªé€ æ ‡ç­¾ \
                ch01-cw1 \
                ch01-ä½ å¥½\
                ch01-cw2 \
                ch01-cw2a \
                ch02-cw3 \
                ch02-cw4 \
                ch02-cw4a \
                ch02-cw5 \
                ch02-cw5a \
                ch02-cw5b \
                ch02-cw6 \
                ch02-make-clean \
                ch03-æ–­è¨€-éžç©º \
                ch03-è°ƒè¯•-è·Ÿè¸ª \
                ch03-è°ƒè¯•-è·Ÿè¸ª-1 \
                ch03-è°ƒè¯•-è·Ÿè¸ª-2 \
                ch03-è¿‡æ»¤å™¨æ•…éšœ \
                ch03-æŸ¥æ‰¾ç¨‹åº-1 \
                ch03-æŸ¥æ‰¾ç¨‹åº-2 \
                ch03-findstring-1 \
                ch03-grep \
                ch03-åŒ…æ‹¬\
                ch03-æ— æ•ˆå˜é‡ \
                ch03-kill-acroread \
                ch03-kill-ç¨‹åº \
                ch03-å­—æ¯ \
                ch03-ç¨‹åºå˜é‡-1 \
                ch03-ç¨‹åºå˜é‡-2 \
                ch03-ç¨‹åºå˜é‡-3 \
                ch03-ç¨‹åºå˜é‡-5 \
                ch03-èŒƒå›´é—®é¢˜ \
                ch03-å¤–å£³ \
                ch03-å°¾éšç©ºæ ¼ \
                ch04-èŒƒå›´ \
                ch04-for-loop-1 \
                ch04-for-loop-2 \
                ch04-for-loop-3 \
                ch06-ç®€å• \
                appb-defstruct \
                appb ç®—æœ¯

# æˆ‘çœŸçš„å¾ˆæƒ³ä½¿ç”¨è¿™ä¸ª foreach å¾ªçŽ¯ï¼Œä½†æ˜¯ 3.80 ä¸­æœ‰ä¸€ä¸ªé”™è¯¯
# äº§ç”Ÿè‡´å‘½é”™è¯¯ã€‚
#$(foreach e,$(ç¤ºä¾‹),$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹,$e)))

# ç›¸åï¼Œæˆ‘åœ¨è¿™é‡Œæ‰‹åŠ¨æ‰©å±•äº† foreachã€‚
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch01-bogus-tab))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch01-cw1))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch01-hello))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch01-cw2))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch01-cw2a))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch02-cw3))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch02-cw4))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch02-cw4a))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch02-cw5))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch02-cw5a))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch02-cw5b))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch02-cw6))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch02-make-clean))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-assert-not-null))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-è°ƒè¯•è·Ÿè¸ª))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-debug-trace-1))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-debug-trace-2))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-è¿‡æ»¤å™¨å¤±è´¥))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-find-program-1))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-find-program-2))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-findstring-1))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-grep))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-include))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-æ— æ•ˆå˜é‡))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-kill-acroread))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-kill-program))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-å­—æ¯))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-ç¨‹åºå˜é‡-1))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-ç¨‹åºå˜é‡-2))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-ç¨‹åºå˜é‡-3))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-ç¨‹åºå˜é‡-5))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-èŒƒå›´é—®é¢˜))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-shell))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch03-å°¾éšç©ºæ ¼))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch04-èŒƒå›´))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch04-for-loop-1))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch04-for-loop-2))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch04-for-loop-3))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch06-ç®€å•))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch10-echo-bash))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œappb-defstruct))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œappb-ç®—æœ¯))


#################################################### ##############
ï¼ƒ è¯å®ž
#
# æ£€æŸ¥ 1) æœªå±•å¼€çš„ m4 å®ï¼› b) æ ‡ç­¾ï¼› c) FIXME æ„è§ï¼› d)
# RMï¼šå¯¹å®‰è¿ªçš„å›žåº”ï¼› e) é‡å¤çš„ m4 å®
#
validation_checks := $(OUTPUT_DIR)/chk_macros_tabs \
                     $(OUTPUT_DIR)/chk_fixme \
                     $(OUTPUT_DIR)/chk_duplicate_macros \
                     $(OUTPUT_DIR)/chk_orphaned_examples

.PHONYï¼šä»…éªŒè¯
ä»…éªŒè¯ï¼š$(OUTPUT_DIR)/éªŒè¯
$(OUTPUT_DIR)/éªŒè¯ï¼š$(validation_checks)
        $ï¼ˆè§¦æ‘¸ï¼‰$@

$(OUTPUT_DIR)/chk_macros_tabs: $(ALL_XML_OUT)
        # å¯»æ‰¾å®å’Œé€‰é¡¹å¡...
        $ï¼ˆå®‰é™ï¼‰ï¼ $(EGREP) --å¿½ç•¥å¤§å°å†™ \
                           - ç”µè¯å·ç  \
                           --regexp='\b(m4_|mp_)' \
                           --regexp='\011' \
                           $^
        $ï¼ˆè§¦æ‘¸ï¼‰$@

$(OUTPUT_DIR)/chk_fixme: $(ALL_XML_OUT)
        # å¯»æ‰¾ RM: å’Œ FIXME...
        $ï¼ˆå®‰é™ï¼‰$ï¼ˆAWKï¼‰\
                '/FIXME/ { printf "%s:%s: %s\n", æ–‡ä»¶å, NR, $$0 } \
                 /^ *RM:/ { \
                           if ( $$0 !~ /RM: å®Œæˆ/ ) \
                           printf "%s:%s: %s\n", æ–‡ä»¶å, NR, $$0 \
                         }' $(subst $(OUTPUT_DIR)/,$(SOURCE_DIR)/,$^)
        $ï¼ˆè§¦æ‘¸ï¼‰$@

$(OUTPUT_DIR)/chk_duplicate_macros: $(SOURCE_DIR)/macros.m4
        # å¯»æ‰¾é‡å¤çš„å®...
        $ï¼ˆå®‰é™ï¼‰ï¼ $(EGREP) --ä»…åŒ¹é… \
              "\`[^']+'," $&lt; | \
        $ï¼ˆæŽ’åºï¼‰| \
        uniq-c| \
        $(AWK) '$$1 &gt; 1 { printf "$&lt;:0: %s\n", $$0 }' | \
        $(EGREP)â€œ^â€
        $ï¼ˆè§¦æ‘¸ï¼‰$@

ALL_EXAMPLES := $(TMP)/all_examples

$(OUTPUT_DIR)/chk_orphaned_examples: $(ALL_EXAMPLES) $(DEPENDENCY_FILES)
        $(å®‰é™)$(AWK) -F/ '/(ç¤ºä¾‹|è¾“å‡º)_DIR/ { print $$3 }' \
                $(è¿‡æ»¤%.d,$^) | \
        $(æŽ’åº) -u | \
        é€šè®¯ -13 - $(è¿‡æ»¤æŽ‰ %.d,$^)
        $ï¼ˆè§¦æ‘¸ï¼‰$@

.INTERMEDIATEï¼š$(ALL_EXAMPLES)
$ï¼ˆæ‰€æœ‰ç¤ºä¾‹ï¼‰ï¼š
        # å¯»æ‰¾æœªä½¿ç”¨çš„ç¤ºä¾‹...
        $(å®‰é™) ls -p $(EXAMPLES_DIR) | \
        $(AWK) '/CVS/ { ä¸‹ä¸€ä¸ª } \
                /\// { print substr($$0, 1, é•¿åº¦ - 1) }' &gt; $@

#################################################### ##############
ï¼ƒ å¹²å‡€çš„
#
å¹²å‡€çš„ï¼š
        $(kill-acroread)
        $(RM) -r $(OUTPUT_DIR)
        $(RM) $(SOURCE_DIR)/*~ $(SOURCE_DIR)/*.logè¯­ä¹‰.cache
        $(RM) ä¹¦.pdf

#################################################### ##############
# ä¾èµ–ç®¡ç†
#
# å¦‚æžœæˆ‘ä»¬æ­£åœ¨è¿›è¡Œæ¸…ç†ï¼Œè¯·ä¸è¦é˜…è¯»æˆ–é‡åˆ¶åŒ…å«å†…å®¹ã€‚
#
ifneq "$(MAKECMDGOALS)" "å¹²å‡€"
  -åŒ…æ‹¬$(DEPENDENCY_FILES)
ä¸‡ä¸€

vpath%.xml $(SOURCE_DIR)
vpath%.tif $(SOURCE_DIR)
vpath %.eps $(SOURCE_DIR)

$(OUTPUT_DIR)/%.xml: %.xml $(process-pgm) $(m4-macros)
        $(è°ƒç”¨è¿‡ç¨‹-åŒ…æ‹¬, $&lt;, $@)

$(OUTPUT_DIR)/%.tif: %.tif
        $(CP) $&lt; $@

$(OUTPUT_DIR)/%.eps: %.eps
        $(CP) $&lt; $@

$(OUTPUT_DIR)/%.d: %.xml $(make-depend)
        $(make-depend) $&lt; &gt; $@

#################################################### ##############
# åˆ›å»ºè¾“å‡ºç›®å½•
#
# å¦‚æœ‰å¿…è¦ï¼Œåˆ›å»ºè¾“å‡ºç›®å½•ã€‚
#
DOCBOOK_IMAGES := $(OUTPUT_DIR)/release/images
DRAFT_PNG := /usr/share/docbook-xsl/images/draft.png

ifneq "$(MAKECMDGOALS)" "å¹²å‡€"
  _CREATE_OUTPUT_DIR := \
    $(å¤–å£³\
      $(MKDIR) $(DOCBOOK_IMAGES) &amp; \
      $(CP) $(DRAFT_PNG) $(DOCBOOK_IMAGES); \
      å¦‚æžœ ï¼ [[ $(foreach d, \
                $(éžç›®å½•\
                  $(é€šé…ç¬¦$(EXAMPLES_DIR)/ch*)), \
                -e $(OUTPUT_DIR)/$d &amp;) -e ã€‚ ]]; \
      ç„¶åŽ \
        echo é“¾æŽ¥ç¤ºä¾‹... &gt; /dev/stderr; \
        $(LNDIR) $(BOOK_DIR)/$(EXAMPLES_DIR) $(BOOK_DIR)/$(OUTPUT_DIR); \
      è²)
ä¸‡ä¸€</pre><pre class="programlisting"># Build the book!
#
# The primary targets in this file are:
#
# show_pdf      Generate the pdf and start a viewer
# pdf           Generate the pdf
# print         Print the pdf
# show_html     Generate the html and start a viewer
# html          Generate the html
# xml           Generate the xml
# release       Make a release tarball
# clean         Clean up generated files
#

BOOK_DIR     := /test/book
SOURCE_DIR   := text
OUTPUT_DIR   := out
EXAMPLES_DIR := examples

QUIET            = @

SHELL            =  bash
AWK              := awk
CP               := cp
EGREP            := egrep
HTML_VIEWER      := cygstart
KILL             := /bin/kill
M4               := m4
MV               := mv
PDF_VIEWER       := cygstart
RM               := rm -f
MKDIR            := mkdir -p
LNDIR            := lndir
SED              := sed
SORT             := sort
TOUCH            := touch
XMLTO            := xmlto
XMLTO_FLAGS      =  -o $(OUTPUT_DIR) $(XML_VERBOSE)
process-pgm      := bin/process-includes
make-depend      := bin/make-depend

m4-macros        := text/macros.m4

# $(call process-includes, input-file, output-file)
#   Remove tabs, expand macros, and process include directives.
define process-includes
  expand $1 |                                                   \
  $(M4) --prefix-builtins --include=text $(m4-macros) - |       \
  $(process-pgm) &gt; $2
endef

# $(call file-exists, file-name)
#   Return non-null if a file exists.
file-exists = $(wildcard $1)

# $(call maybe-mkdir, directory-name-opt)
#   Create a directory if it doesn't exist.
#   If directory-name-opt is omitted use $@ for the directory-name.
maybe-mkdir = $(if $(call file-exists,          \
                     $(if $1,$1,$(dir $@))),,   \
                $(MKDIR) $(if $1,$1,$(dir $@)))

# $(kill-acroread)
#   Terminate the acrobat reader.
define kill-acroread
  $(QUIET) ps -W |                                      \
  $(AWK) 'BEGIN { FIELDWIDTHS = "9 47 100" }            \
          /AcroRd32/ {                                  \
                       print "Killing " $$3;            \
                       system( "$(KILL) -f " $$1 )      \
                     }'
endef

# $(call source-to-output, file-name)
#   Transform a source tree reference to an output tree reference.
define source-to-output
$(subst $(SOURCE_DIR),$(OUTPUT_DIR),$1)
endef

# $(call run-script-example, script-name, output-file)
#   Run an example makefile.
define run-script-example
  ( cd $(dir $1);                                       \
    $(notdir $1) 2&gt;&amp;1 |                                 \
    if $(EGREP) --silent '\$$\(MAKE\)' [mM]akefile;     \
    then                                                \
      $(SED) -e 's/^++*/$$/';                           \
    else                                                \
      $(SED) -e 's/^++*/$$/'                            \
             -e '/ing directory /d'                     \
             -e 's/\[[0-9]\]//';                        \
    fi )                                                \
  &gt; $(TMP)/out.$$$$ &amp;                                  \
  $(MV) $(TMP)/out.$$$$ $2
endef

# $(call generic-program-example,example-directory)
#   Create the rules to build a generic example.
define generic-program-example
  $(eval $1_dir      := $(OUTPUT_DIR)/$1)
  $(eval $1_make_out := $($1_dir)/make.out)
  $(eval $1_run_out  := $($1_dir)/run.out)
  $(eval $1_clean    := $($1_dir)/clean)
  $(eval $1_run_make := $($1_dir)/run-make)
  $(eval $1_run_run  := $($1_dir)/run-run)
  $(eval $1_sources  := $(filter-out %/CVS, $(wildcard $(EXAMPLES_DIR)/$1/*)))

  $($1_run_out): $($1_make_out) $($1_run_run)
        $$(call run-script-example, $($1_run_run), $$@)

  $($1_make_out): $($1_clean) $($1_run_make)
        $$(call run-script-example, $($1_run_make), $$@)

  $($1_clean): $($1_sources) Makefile
        $(RM) -r $($1_dir)
        $(MKDIR) $($1_dir)
        $(LNDIR) -silent ../../$(EXAMPLES_DIR)/$1 $($1_dir)
        $(TOUCH) $$@

  $($1_run_make):
        printf "#! /bin/bash -x\nmake\n" &gt; $$@
endef


# Book output formats.
BOOK_XML_OUT     := $(OUTPUT_DIR)/book.xml
BOOK_HTML_OUT    := $(subst xml,html,$(BOOK_XML_OUT))
BOOK_FO_OUT      := $(subst xml,fo,$(BOOK_XML_OUT))
BOOK_PDF_OUT     := $(subst xml,pdf,$(BOOK_XML_OUT))
ALL_XML_SRC      := $(wildcard $(SOURCE_DIR)/*.xml)
ALL_XML_OUT      := $(call source-to-output,$(ALL_XML_SRC))
DEPENDENCY_FILES := $(call source-to-output,$(subst .xml,.d,$(ALL_XML_SRC)))


# xml/html/pdf - Produce the desired output format for the book.
.PHONY: xml html pdf
xml:  $(OUTPUT_DIR)/validate
html: $(BOOK_HTML_OUT)
pdf:  $(BOOK_PDF_OUT)

# show_pdf - Generate a pdf file and display it.
.PHONY: show_pdf show_html print
show_pdf: $(BOOK_PDF_OUT)
        $(kill-acroread)
        $(PDF_VIEWER) $(BOOK_PDF_OUT)

# show_html - Generate an html file and display it.
show_html: $(BOOK_HTML_OUT)
        $(HTML_VIEWER) $(BOOK_HTML_OUT)

# print - Print specified pages from the book.
print: $(BOOK_FO_OUT)
        $(kill-acroread)
        java -Dstart=15 -Dend=15 $(FOP) $&lt; -print &gt; /dev/null

# $(BOOK_PDF_OUT) - Generate the pdf file.
$(BOOK_PDF_OUT): $(BOOK_FO_OUT) Makefile

# $(BOOK_HTML_OUT) - Generate the html file.
$(BOOK_HTML_OUT): $(ALL_XML_OUT) $(OUTPUT_DIR)/validate Makefile

# $(BOOK_FO_OUT) - Generate the fo intermediate output file.
.INTERMEDIATE: $(BOOK_FO_OUT)
$(BOOK_FO_OUT): $(ALL_XML_OUT) $(OUTPUT_DIR)/validate Makefile

# $(BOOK_XML_OUT) - Process all the xml input files.
$(BOOK_XML_OUT): Makefile

#################################################################
# FOP Support
#
FOP := org.apache.fop.apps.Fop

# DEBUG_FOP - Define this to see fop processor output.
ifndef DEBUG_FOP
  FOP_FLAGS  := -q
  FOP_OUTPUT := | $(SED) -e '/not implemented/d'        \
                         -e '/relative-align/d'         \
                         -e '/xsl-footnote-separator/d'
endif

# CLASSPATH - Compute the appropriate CLASSPATH for fop.
export CLASSPATH
CLASSPATH = $(patsubst %;,%,                                    \
              $(subst ; ,;,                                     \
                $(addprefix c:/usr/xslt-process-2.2/java/,      \
                  $(addsuffix .jar;,                            \
                    xalan                                       \
                    xercesImpl                                  \
                    batik                                       \
                    fop                                         \
                    jimi-1.0                                    \
                    avalon-framework-cvs-20020315))))

# %.pdf - Pattern rule to produce pdf output from fo input.
%.pdf: %.fo
        $(kill-acroread)
        java -Xmx128M $(FOP) $(FOP_FLAGS) $&lt; $@ $(FOP_OUTPUT)

# %.fo - Pattern rule to produce fo output from xml input.
PAPER_SIZE := letter
%.fo: %.xml
        XSLT_FLAGS="--stringparam paper.type $(PAPER_SIZE)" \
        $(XMLTO) $(XMLTO_FLAGS) fo $&lt;

# %.html - Pattern rule to produce html output from xml input.
%.html: %.xml
        $(XMLTO) $(XMLTO_FLAGS) html-nochunks $&lt;

# fop_help - Display fop processor help text.
.PHONY: fop_help
fop_help:
        -java org.apache.fop.apps.Fop -help
        -java org.apache.fop.apps.Fop -print help

#################################################################
# release - Produce a release of the book.
#
RELEASE_TAR   := mpwm-$(shell date +%F).tar.gz
RELEASE_FILES := README Makefile *.pdf bin examples out text

.PHONY: release
release: $(BOOK_PDF_OUT)
        ln -sf $(BOOK_PDF_OUT) .
        tar --create                            \
            --gzip                              \
            --file=$(RELEASE_TAR)               \
            --exclude=CVS                       \
            --exclude=semantic.cache            \
            --exclude=*~                        \
            $(RELEASE_FILES)
        ls -l $(RELEASE_TAR)

#################################################################
# Rules for Chapter 1 examples.
#

# Here are all the example directories.
EXAMPLES :=                                     \
                ch01-bogus-tab                  \
                ch01-cw1                        \
                ch01-hello                      \
                ch01-cw2                        \
                ch01-cw2a                       \
                ch02-cw3                        \
                ch02-cw4                        \
                ch02-cw4a                       \
                ch02-cw5                        \
                ch02-cw5a                       \
                ch02-cw5b                       \
                ch02-cw6                        \
                ch02-make-clean                 \
                ch03-assert-not-null            \
                ch03-debug-trace                \
                ch03-debug-trace-1              \
                ch03-debug-trace-2              \
                ch03-filter-failure             \
                ch03-find-program-1             \
                ch03-find-program-2             \
                ch03-findstring-1               \
                ch03-grep                       \
                ch03-include                    \
                ch03-invalid-variable           \
                ch03-kill-acroread              \
                ch03-kill-program               \
                ch03-letters                    \
                ch03-program-variables-1        \
                ch03-program-variables-2        \
                ch03-program-variables-3        \
                ch03-program-variables-5        \
                ch03-scoping-issue              \
                ch03-shell                      \
                ch03-trailing-space             \
                ch04-extent                     \
                ch04-for-loop-1                 \
                ch04-for-loop-2                 \
                ch04-for-loop-3                 \
                ch06-simple                     \
                appb-defstruct                  \
                appb-arithmetic

# I would really like to use this foreach loop, but a bug in 3.80
# generates a fatal error.
#$(foreach e,$(EXAMPLES),$(eval $(call generic-program-example,$e)))

# Instead I expand the foreach by hand here.
$(eval $(call generic-program-example,ch01-bogus-tab))
$(eval $(call generic-program-example,ch01-cw1))
$(eval $(call generic-program-example,ch01-hello))
$(eval $(call generic-program-example,ch01-cw2))
$(eval $(call generic-program-example,ch01-cw2a))
$(eval $(call generic-program-example,ch02-cw3))
$(eval $(call generic-program-example,ch02-cw4))
$(eval $(call generic-program-example,ch02-cw4a))
$(eval $(call generic-program-example,ch02-cw5))
$(eval $(call generic-program-example,ch02-cw5a))
$(eval $(call generic-program-example,ch02-cw5b))
$(eval $(call generic-program-example,ch02-cw6))
$(eval $(call generic-program-example,ch02-make-clean))
$(eval $(call generic-program-example,ch03-assert-not-null))
$(eval $(call generic-program-example,ch03-debug-trace))
$(eval $(call generic-program-example,ch03-debug-trace-1))
$(eval $(call generic-program-example,ch03-debug-trace-2))
$(eval $(call generic-program-example,ch03-filter-failure))
$(eval $(call generic-program-example,ch03-find-program-1))
$(eval $(call generic-program-example,ch03-find-program-2))
$(eval $(call generic-program-example,ch03-findstring-1))
$(eval $(call generic-program-example,ch03-grep))
$(eval $(call generic-program-example,ch03-include))
$(eval $(call generic-program-example,ch03-invalid-variable))
$(eval $(call generic-program-example,ch03-kill-acroread))
$(eval $(call generic-program-example,ch03-kill-program))
$(eval $(call generic-program-example,ch03-letters))
$(eval $(call generic-program-example,ch03-program-variables-1))
$(eval $(call generic-program-example,ch03-program-variables-2))
$(eval $(call generic-program-example,ch03-program-variables-3))
$(eval $(call generic-program-example,ch03-program-variables-5))
$(eval $(call generic-program-example,ch03-scoping-issue))
$(eval $(call generic-program-example,ch03-shell))
$(eval $(call generic-program-example,ch03-trailing-space))
$(eval $(call generic-program-example,ch04-extent))
$(eval $(call generic-program-example,ch04-for-loop-1))
$(eval $(call generic-program-example,ch04-for-loop-2))
$(eval $(call generic-program-example,ch04-for-loop-3))
$(eval $(call generic-program-example,ch06-simple))
$(eval $(call generic-program-example,ch10-echo-bash))
$(eval $(call generic-program-example,appb-defstruct))
$(eval $(call generic-program-example,appb-arithmetic))


#################################################################
# validate
#
# Check for 1) unexpanded m4 macros; b) tabs; c) FIXME comments; d)
# RM: responses to Andy; e) duplicate m4 macros
#
validation_checks := $(OUTPUT_DIR)/chk_macros_tabs              \
                     $(OUTPUT_DIR)/chk_fixme                    \
                     $(OUTPUT_DIR)/chk_duplicate_macros         \
                     $(OUTPUT_DIR)/chk_orphaned_examples

.PHONY: validate-only
validate-only: $(OUTPUT_DIR)/validate
$(OUTPUT_DIR)/validate: $(validation_checks)
        $(TOUCH) $@

$(OUTPUT_DIR)/chk_macros_tabs: $(ALL_XML_OUT)
        # Looking for macros and tabs...
        $(QUIET)! $(EGREP) --ignore-case                                \
                           --line-number                                \
                           --regexp='\b(m4_|mp_)'                       \
                           --regexp='\011'                              \
                           $^
        $(TOUCH) $@

$(OUTPUT_DIR)/chk_fixme: $(ALL_XML_OUT)
        # Looking for RM: and FIXME...
        $(QUIET)$(AWK)                                                  \
                '/FIXME/ { printf "%s:%s: %s\n", FILENAME, NR, $$0 }    \
                 /^ *RM:/  {                                            \
                           if ( $$0 !~ /RM: Done/ )                     \
                           printf "%s:%s: %s\n", FILENAME, NR, $$0      \
                         }' $(subst $(OUTPUT_DIR)/,$(SOURCE_DIR)/,$^)
        $(TOUCH) $@

$(OUTPUT_DIR)/chk_duplicate_macros: $(SOURCE_DIR)/macros.m4
        # Looking for duplicate macros...
        $(QUIET)! $(EGREP) --only-matching              \
              "\`[^']+'," $&lt; |                          \
        $(SORT) |                                       \
        uniq -c |                                       \
        $(AWK) '$$1 &gt; 1 { printf "$&lt;:0: %s\n", $$0 }' | \
        $(EGREP) "^"
        $(TOUCH) $@

ALL_EXAMPLES := $(TMP)/all_examples

$(OUTPUT_DIR)/chk_orphaned_examples: $(ALL_EXAMPLES) $(DEPENDENCY_FILES)
        $(QUIET)$(AWK) -F/ '/(EXAMPLES|OUTPUT)_DIR/ { print $$3 }'      \
                $(filter %.d,$^) |                                      \
        $(SORT) -u |                                                    \
        comm -13 - $(filter-out %.d,$^)
        $(TOUCH) $@

.INTERMEDIATE: $(ALL_EXAMPLES)
$(ALL_EXAMPLES):
        # Looking for unused examples...
        $(QUIET) ls -p $(EXAMPLES_DIR) |        \
        $(AWK) '/CVS/ { next }                  \
                /\//  { print substr($$0, 1, length - 1) }' &gt; $@

#################################################################
# clean
#
clean:
        $(kill-acroread)
        $(RM) -r $(OUTPUT_DIR)
        $(RM) $(SOURCE_DIR)/*~ $(SOURCE_DIR)/*.log semantic.cache
        $(RM) book.pdf

#################################################################
# Dependency Management
#
# Don't read or remake includes if we are doing a clean.
#
ifneq "$(MAKECMDGOALS)" "clean"
  -include $(DEPENDENCY_FILES)
endif

vpath %.xml $(SOURCE_DIR)
vpath %.tif $(SOURCE_DIR)
vpath %.eps $(SOURCE_DIR)

$(OUTPUT_DIR)/%.xml: %.xml $(process-pgm) $(m4-macros)
        $(call process-includes, $&lt;, $@)

$(OUTPUT_DIR)/%.tif: %.tif
        $(CP) $&lt; $@

$(OUTPUT_DIR)/%.eps: %.eps
        $(CP) $&lt; $@

$(OUTPUT_DIR)/%.d: %.xml $(make-depend)
        $(make-depend) $&lt; &gt; $@

#################################################################
# Create Output Directory
#
# Create the output directory if necessary.
#
DOCBOOK_IMAGES := $(OUTPUT_DIR)/release/images
DRAFT_PNG      := /usr/share/docbook-xsl/images/draft.png

ifneq "$(MAKECMDGOALS)" "clean"
  _CREATE_OUTPUT_DIR :=                                                 \
    $(shell                                                             \
      $(MKDIR) $(DOCBOOK_IMAGES) &amp;                                     \
      $(CP) $(DRAFT_PNG) $(DOCBOOK_IMAGES);                             \
      if ! [[ $(foreach d,                                              \
                $(notdir                                                \
                  $(wildcard $(EXAMPLES_DIR)/ch*)),                     \
                -e $(OUTPUT_DIR)/$d &amp;) -e . ]];                        \
      then                                                              \
        echo Linking examples... &gt; /dev/stderr;                         \
        $(LNDIR) $(BOOK_DIR)/$(EXAMPLES_DIR) $(BOOK_DIR)/$(OUTPUT_DIR); \
      fi)
endif</pre></div></div><p>makefileè¢«ç¼–å†™ä¸ºåœ¨ Cygwin ä¸‹è¿è¡Œ<em class="filename">ï¼Œ</em>å¹¶æ²¡æœ‰è®¤çœŸå°è¯•å¯ç§»æ¤åˆ° Unixã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ç›¸ä¿¡ä¸Ž Unix çš„ä¸å…¼å®¹æ€§å¾ˆå°‘ï¼ˆå¦‚æžœæœ‰çš„è¯ï¼‰æ— æ³•é€šè¿‡é‡æ–°å®šä¹‰å˜é‡æˆ–å¯èƒ½å¼•å…¥é™„åŠ å˜é‡æ¥è§£å†³ã€‚</p><p>The <em class="filename">makefile</em> is written to
        run under Cygwin with no serious attempt at portability to Unix.
        Nevertheless, I believe there are few, if any, incompatibilities with
        Unix that cannot be resolved by redefining a variable or possibly
        introducing an additional variable.</p><p>å…¨å±€å˜é‡éƒ¨åˆ†é¦–å…ˆå®šä¹‰äº†æ ¹ç›®å½•çš„ä½ç½®ä»¥åŠæ–‡æœ¬ã€ç¤ºä¾‹çš„ç›¸å¯¹ä½ç½®ï¼Œ
        <a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1552" class="indexterm"></a>
        <a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1553" class="indexterm"></a>å’Œè¾“å‡ºç›®å½•ã€‚<em class="filename">makefile</em>ä½¿ç”¨çš„æ¯ä¸ªé‡è¦ç¨‹åºéƒ½è¢«å®šä¹‰ä¸ºå˜é‡ã€‚</p><p>The global variables section first defines the location of the
        root directory and the relative locations of the text, examples,
        <a class="indexterm"></a>
        <a class="indexterm"></a>and output directories.
        Each nontrivial program used by the <em class="filename">makefile</em> is defined as a variable.</p><div class="sect2" title="ç®¡ç†ç¤ºä¾‹"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch11.html.make3-CHP-11-SECT-1.1"></a>ç®¡ç†ç¤ºä¾‹</h2><h2 class="title"><a></a>Managing Examples</h2></div></div></div><p>ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯ç®¡ç†ç¤ºä¾‹ï¼Œå®ƒæ˜¯æœ€å¤æ‚çš„ã€‚æ¯ä¸ªç¤ºä¾‹éƒ½å­˜å‚¨åœ¨<em class="filename">book/examples/ch </em>
          <em class="filename">-&lt;title&gt;</em>ä¸‹è‡ªå·±çš„ç›®å½•ä¸­ã€‚ç¤ºä¾‹ç”±
          <em class="filename">makefile</em>ä»¥åŠä»»ä½•æ”¯æŒæ–‡ä»¶å’Œç›®å½•ç»„æˆã€‚ä¸ºäº†å¤„ç†ç¤ºä¾‹ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªæŒ‡å‘è¾“å‡ºæ ‘çš„ç¬¦å·é“¾æŽ¥ç›®å½•å¹¶åœ¨é‚£é‡Œå·¥ä½œï¼Œä»¥ä¾¿åœ¨æºæ ‘ä¸­ä¸ä¼šç•™ä¸‹è¿è¡Œ<em class="filename">makefile</em>çš„å·¥ä»¶ã€‚æ­¤å¤–ï¼Œå¤§å¤šæ•°ç¤ºä¾‹éœ€è¦å°†å½“å‰å·¥ä½œç›®å½•è®¾ç½®ä¸º<em class="filename">makefile</em>çš„å·¥ä½œç›®å½•ï¼Œä»¥ä¾¿ç”Ÿæˆé¢„æœŸçš„è¾“å‡ºã€‚å¯¹æºä»£ç è¿›è¡Œç¬¦å·é“¾æŽ¥åŽï¼Œæˆ‘ä»¬æ‰§è¡Œ shell è„šæœ¬<em class="command">run-make</em>ï¼Œä»¥
          ä½¿ç”¨é€‚å½“çš„å‚æ•°è°ƒç”¨<em class="filename">makefile</em> ã€‚å¦‚æžœæºä»£ç æ ‘ä¸­ä¸å­˜åœ¨ shell è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆé»˜è®¤ç‰ˆæœ¬ã€‚<em class="command">run-make</em>è„šæœ¬çš„è¾“å‡ºä¿å­˜åœ¨<em class="filename">make.out</em>ä¸­ã€‚æŸäº›ç¤ºä¾‹ä¼šç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¹Ÿå¿…é¡»è¿è¡Œè¯¥å¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿™æ˜¯é€šè¿‡è¿è¡Œè„šæœ¬<em class="command">run-run</em>å¹¶å°†å…¶è¾“å‡ºä¿å­˜åœ¨æ–‡ä»¶<em class="filename">run.out</em>ä¸­æ¥å®Œæˆçš„ã€‚<em class="replaceable"><code>n</code></em> <em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="filename"></em><em class="command"></em><em class="filename"></em><em class="command"></em><em class="filename"></em><em class="command"></em><em class="filename"></em></p><p>The first task, managing the examples, is the most complex.
          Each example is stored in its own directory under <em class="filename">book/examples/ch</em>
          <em class="replaceable"><code>n</code></em> <em class="filename">-&lt;title&gt;</em>. Examples consist of a
          <em class="filename">makefile</em> along with any
          supporting files and directories. To process an example we first
          create a directory of symbolic links to the output tree and work
          there so that no artifacts of running the <em class="filename">makefile</em> are left in the source tree.
          Furthermore, most of the examples require setting the current
          working directory to that of the <em class="filename">makefile</em>, in order to generate the
          expected output. After symlinking the source, we execute a shell
          script, <em class="command">run-make</em>, to invoke the
          <em class="filename">makefile</em> with the appropriate
          arguments. If no shell script is present in the source tree, we can
          generate a default version. The output of the <em class="command">run-make</em> script is saved in <em class="filename">make.out</em>. Some examples produce an
          executable, which must also be run. This is accomplished by running
          the script <em class="command">run-run</em> and saving its
          output in the file <em class="filename">run.out</em>.</p><p><em class="filename">åˆ›å»ºç¬¦å·é“¾æŽ¥æ ‘æ˜¯ç”±makefile</em>æœ«å°¾çš„ä»¥ä¸‹ä»£ç æ‰§è¡Œçš„ï¼š</p><p>Creating the tree of symbolic links is performed by this code
          at the end of the <em class="filename">makefile</em>:</p><a id="OEBPS/ch11.html.I_6_tt454"></a><pre class="programlisting">ifneq "$(MAKECMDGOALS)" "å¹²å‡€"
  _CREATE_OUTPUT_DIR := \
    $(å¤–å£³\
      ...
      å¦‚æžœ ï¼ [[ $(foreach d, \
                $(éžç›®å½•\
                  $(é€šé…ç¬¦$(EXAMPLES_DIR)/ch*)), \
                -e $(OUTPUT_DIR)/$d &amp;&amp;) -e ã€‚ ]]; \
      ç„¶åŽ \
        echo é“¾æŽ¥ç¤ºä¾‹... &gt; /dev/stderr; \
        $(LNDIR) $(BOOK_DIR)/$(EXAMPLES_DIR) $(BOOK_DIR)/$(OUTPUT_DIR); \
      è²)
ä¸‡ä¸€</pre><pre class="programlisting">ifneq "$(MAKECMDGOALS)" "clean"
  _CREATE_OUTPUT_DIR :=                                                 \
    $(shell                                                             \
      ...
      if ! [[ $(foreach d,                                              \
                $(notdir                                                \
                  $(wildcard $(EXAMPLES_DIR)/ch*)),                     \
                -e $(OUTPUT_DIR)/$d &amp;&amp;) -e . ]];                        \
      then                                                              \
        echo Linking examples... &gt; /dev/stderr;                         \
        $(LNDIR) $(BOOK_DIR)/$(EXAMPLES_DIR) $(BOOK_DIR)/$(OUTPUT_DIR); \
      fi)
endif</pre><p>è¯¥ä»£ç ç”±åŒ…è£¹åœ¨æ¡ä»¶ä¸­çš„å•ä¸ªç®€å•å˜é‡èµ‹å€¼ç»„æˆ<code class="literal">ifneq</code>ã€‚æ¡ä»¶æ˜¯ä¸ºäº†é˜²æ­¢<em class="command">make</em>åœ¨<code class="literal">make clean</code>.å®žé™…å˜é‡æ˜¯ä¸€ä¸ªè™šæ‹Ÿå˜é‡ï¼Œå…¶å€¼ä»Žæœªè¢«ä½¿ç”¨è¿‡ã€‚ç„¶è€Œï¼Œå½“<em class="command">make</em>è¯»å–<em class="filename">makefile</em><code class="function">shell</code>æ—¶ï¼Œå³ä¾§çš„å‡½æ•°ä¼šç«‹å³æ‰§è¡Œã€‚è¯¥å‡½æ•°æ£€æŸ¥è¾“å‡ºæ ‘ä¸­æ˜¯å¦å­˜åœ¨æ¯ä¸ªç¤ºä¾‹ç›®å½•ã€‚å¦‚æžœç¼ºå°‘ä»»ä½•ä¸€ä¸ªï¼Œåˆ™è°ƒç”¨<em class="command">lndir</em>å‘½ä»¤æ¥æ›´æ–°ç¬¦å·é“¾æŽ¥æ ‘ã€‚<em class="command"></em><em class="filename"></em><code class="function">shell</code><em class="command"></em></p><p>The code consists of a single, simple variable assignment
          wrapped in an <code class="literal">ifneq</code> conditional.
          The conditional is there to prevent <em class="command">make</em> from creating the output directory
          structure during a <code class="literal">make clean</code>.
          The actual variable is a dummy whose value is never used. However,
          the <code class="function">shell</code> function on the
          right-hand side is executed immediately when <em class="command">make</em> reads the <em class="filename">makefile</em>. The <code class="function">shell</code> function checks if each example
          directory exists in the output tree. If any is missing, the <em class="command">lndir</em> command is invoked to update the
          tree of symbolic links.</p><p>æ‰€ä½¿ç”¨çš„æµ‹è¯•<code class="function">if</code>
          å€¼å¾—æ›´ä»”ç»†åœ°ç ”ç©¶ã€‚æµ‹è¯•æœ¬èº«ç”±
          <code class="literal">-e</code>æ¯ä¸ªç¤ºä¾‹ç›®å½•çš„ä¸€ä¸ªæµ‹è¯•ï¼ˆå³æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Ÿï¼‰ç»„æˆã€‚å®žé™…çš„ä»£ç æ˜¯è¿™æ ·çš„ï¼š use<code class="function">wildcard</code>ç¡®å®šæ‰€æœ‰ç¤ºä¾‹å¹¶ç”¨ å‰¥ç¦»å®ƒä»¬çš„ç›®å½•éƒ¨åˆ†
          <code class="function">notdir</code>ï¼Œç„¶åŽä¸ºæ¯ä¸ªç¤ºä¾‹ç›®å½•ç”Ÿæˆæ–‡æœ¬ã€‚çŽ°åœ¨ï¼Œè¿žæŽ¥æ‰€æœ‰è¿™äº›éƒ¨åˆ†ï¼Œå¹¶å°†å®ƒä»¬åµŒå…¥åˆ°<em class="command">bash</em>æµ‹è¯•ä¸­ã€‚æœ€åŽå¯¹ç»“æžœè¿›è¡Œå¦å®šã€‚åŒ…å«ä¸€ä¸ªé¢å¤–çš„æµ‹è¯•.ï¼Œä»¥å…è®¸
          å¾ªçŽ¯ç®€å•åœ°æ·»åŠ åˆ°æ¯ä¸ªå­å¥ã€‚<code class="literal">-e</code>
          <code class="literal">$(OUTPUT_DIR)/</code>
          <em class="replaceable"><code>dir</code></em> <code class="literal">&amp;&amp;</code><em class="command"></em>
          <code class="literal">[[...]]</code><code class="literal">-e </code><code class="function">foreach</code><code class="literal">&amp;&amp;</code></p><p>The test used by the <code class="function">if</code>
          is worth examining more closely. The test itself consists of one
          <code class="literal">-e</code> test (i.e., does the file
          exist?) for each example directory. The actual code goes something
          like this: use <code class="function">wildcard</code> to
          determine all the examples and strip their directory part with
          <code class="function">notdir</code>, then for each example
          directory produce the text <code class="literal">-e</code>
          <code class="literal">$(OUTPUT_DIR)/</code>
          <em class="replaceable"><code>dir</code></em> <code class="literal">&amp;&amp;</code>. Now, concatenate all these
          pieces, and embed them in a <em class="command">bash</em>
          <code class="literal">[[...]]</code> test. Finally, negate the
          result. One extra test, <code class="literal">-e </code>., is
          included to allow the <code class="function">foreach</code>
          loop to simply add <code class="literal">&amp;&amp;</code> to
          every clause.</p><p>è¿™è¶³ä»¥ç¡®ä¿åœ¨å‘çŽ°æ–°ç›®å½•æ—¶å§‹ç»ˆå°†å…¶æ·»åŠ åˆ°æž„å»ºä¸­ã€‚</p><p>This is sufficient to ensure that new directories are always
          added to the build when they are discovered.</p><p>ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºå°†æ›´æ–°ä¸¤ä¸ªè¾“å‡ºæ–‡ä»¶<em class="filename">make.out</em>å’Œ
          <em class="filename">run.out</em>çš„è§„åˆ™ã€‚è¿™æ˜¯ä½¿ç”¨ç”¨æˆ·å®šä¹‰å‡½æ•°å¯¹æ¯ä¸ªç¤ºä¾‹<em class="filename">.outæ–‡ä»¶å®Œæˆçš„ï¼š</em></p><p>The next step is to create rules that will update the two
          output files, <em class="filename">make.out</em> and
          <em class="filename">run.out</em>. This is done for each
          example <em class="filename">.out</em> file with a
          user-defined function:</p><a id="OEBPS/ch11.html.I_6_tt455"></a><pre class="programlisting"># $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œç¤ºä¾‹ç›®å½•)
# åˆ›å»ºè§„åˆ™æ¥æž„å»ºé€šç”¨ç¤ºä¾‹ã€‚
å®šä¹‰é€šç”¨ç¨‹åºç¤ºä¾‹
  $(eval $1_dir := $(OUTPUT_DIR)/$1)
  $(eval $1_make_out := $($1_dir)/make.out)
  $(eval $1_run_out := $($1_dir)/run.out)
  $(eval $1_clean := $($1_dir)/clean)
  $(eval $1_run_make := $($1_dir)/run-make)
  $(eval $1_run_run := $($1_dir)/run-run)
  $(eval $1_sources := $(è¿‡æ»¤å‡º %/CVS, $(é€šé…ç¬¦ $(EXAMPLES_DIR)/$1/*)))

  $($1_run_out): $($1_make_out) $($1_run_run)
        $$(è°ƒç”¨è¿è¡Œè„šæœ¬ç¤ºä¾‹ï¼Œ$($1_run_run)ï¼Œ$$@)

  $($1_make_out): $($1_clean) $($1_run_make)
        $$(è°ƒç”¨è¿è¡Œè„šæœ¬ç¤ºä¾‹ï¼Œ$($1_run_make)ï¼Œ$$@)

  $($1_clean): $($1_sources) Makefile
        $(RM) -r $($1_dir)
        $(MKDIR) $($1_dir)
        $(LNDIR) -silent ../../$(EXAMPLES_DIR)/$1 $($1_dir)
        $ï¼ˆè§¦æ‘¸ï¼‰$$@

  $($1_run_make):
        printf "#! /bin/bash -x\nmake\n" &gt; $$@
æ©å¾·å¤«</pre><pre class="programlisting"># $(call generic-program-example,example-directory)
#   Create the rules to build a generic example.
define generic-program-example
  $(eval $1_dir      := $(OUTPUT_DIR)/$1)
  $(eval $1_make_out := $($1_dir)/make.out)
  $(eval $1_run_out  := $($1_dir)/run.out)
  $(eval $1_clean    := $($1_dir)/clean)
  $(eval $1_run_make := $($1_dir)/run-make)
  $(eval $1_run_run  := $($1_dir)/run-run)
  $(eval $1_sources  := $(filter-out %/CVS, $(wildcard $(EXAMPLES_DIR)/$1/*)))

  $($1_run_out): $($1_make_out) $($1_run_run)
        $$(call run-script-example, $($1_run_run), $$@)

  $($1_make_out): $($1_clean) $($1_run_make)
        $$(call run-script-example, $($1_run_make), $$@)

  $($1_clean): $($1_sources) Makefile
        $(RM) -r $($1_dir)
        $(MKDIR) $($1_dir)
        $(LNDIR) -silent ../../$(EXAMPLES_DIR)/$1 $($1_dir)
        $(TOUCH) $$@

  $($1_run_make):
        printf "#! /bin/bash -x\nmake\n" &gt; $$@
endef</pre><p>è¯¥å‡½æ•°æ—¨åœ¨ä¸ºæ¯ä¸ªç¤ºä¾‹ç›®å½•è°ƒç”¨ä¸€æ¬¡ï¼š</p><p>This function is intended to be invoked once for each example
          directory:</p><a id="OEBPS/ch11.html.I_6_tt456"></a><pre class="programlisting">$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch01-bogus-tab))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch01-cw1))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch01-hello))
$(eval $(è°ƒç”¨é€šç”¨ç¨‹åºç¤ºä¾‹ï¼Œch01-cw2))</pre><pre class="programlisting">$(eval $(call generic-program-example,ch01-bogus-tab))
$(eval $(call generic-program-example,ch01-cw1))
$(eval $(call generic-program-example,ch01-hello))
$(eval $(call generic-program-example,ch01-cw2))</pre><p>å‡½æ•°å¼€å¤´çš„å˜é‡å®šä¹‰ä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿å’Œæé«˜å¯è¯»æ€§ã€‚è¿›ä¸€æ­¥çš„æ”¹è¿›æ¥è‡ªäºŽæ‰§è¡Œå†…éƒ¨èµ‹å€¼ï¼Œ<code class="function">eval</code>å› æ­¤å®å¯ä»¥ç«‹å³ä½¿ç”¨å®ƒä»¬çš„å€¼ï¼Œè€Œæ— éœ€é¢å¤–å¼•ç”¨ã€‚</p><p>The variable definitions at the beginning of the function are
          mostly for convenience and to improve readability. Further
          improvement comes from performing the assignments inside <code class="function">eval</code> so their value can be used
          immediately by the macro without extra quoting.</p><p>è¯¥å‡½æ•°çš„æ ¸å¿ƒæ˜¯å‰ä¸¤ä¸ªç›®æ ‡ï¼š<code class="literal">$($1_run_out)</code>å’Œ<code class="literal">$($1_make_out)</code>ã€‚å®ƒä»¬åˆ†åˆ«æ›´æ–°æ¯ä¸ªç¤ºä¾‹çš„<em class="filename">run.out</em>å’Œ<em class="filename">make.out</em>ç›®æ ‡ã€‚å˜é‡åç§°ç”±ç¤ºä¾‹ç›®å½•åç§°å’ŒæŒ‡ç¤ºçš„åŽç¼€<em class="filename">_run_out</em>æˆ–<em class="filename">_make_out</em>ç»„æˆã€‚</p><p>The heart of the function is the first two targets: <code class="literal">$($1_run_out)</code> and <code class="literal">$($1_make_out)</code>. These update the <em class="filename">run.out</em> and <em class="filename">make.out</em> targets for each example,
          respectively. The variable names are composed from the example
          directory name and the indicated suffix, <em class="filename">_run_out</em> or <em class="filename">_make_out</em>.</p><p>ç¬¬ä¸€æ¡è§„åˆ™è¡¨ç¤º<em class="filename">run.out</em>å–å†³äºŽ<em class="filename">make.out</em>å’Œ<em class="filename">run-run</em>è„šæœ¬ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœ<em class="command">make</em>å·²è¿è¡Œæˆ–<em class="filename">è¿è¡Œ-è¿è¡Œ</em>æŽ§åˆ¶è„šæœ¬å·²æ›´æ–°ï¼Œåˆ™é‡æ–°è¿è¡Œç¤ºä¾‹ç¨‹åºã€‚ä½¿ç”¨ä»¥ä¸‹å‡½æ•°æ›´æ–°ç›®æ ‡<code class="function">run-script-example</code>ï¼š</p><p>The first rule says that <em class="filename">run.out</em> depends upon <em class="filename">make.out</em> and the <em class="filename">run-run</em> script. That is, rerun the
          example program if <em class="command">make</em> has been
          run or the <em class="filename">run-run</em> control
          script has been updated. The target is updated with the <code class="function">run-script-example</code> function:</p><a id="OEBPS/ch11.html.I_6_tt457"></a><pre class="programlisting"># $(è°ƒç”¨è¿è¡Œè„šæœ¬ç¤ºä¾‹ã€è„šæœ¬åç§°ã€è¾“å‡ºæ–‡ä»¶)
# è¿è¡Œç¤ºä¾‹ makefileã€‚
å®šä¹‰è¿è¡Œè„šæœ¬ç¤ºä¾‹
  ( cd $(dir $1); \
    $(notdir $1) 2&gt;&amp;1 | $(notdir $1) 2&gt;&amp;1 | \
    if $(EGREP) --silent '\$$\(MAKE\)' [mM]akefile; \
    ç„¶åŽ \
      $(SED) -e 's/^++*/$$/'; \
    åˆ«çš„ \
      $(SED) -e 's/^++*/$$/' \
             -e '/ing ç›®å½• /d' \
             -e 's/\[[0-9]\]//'; \
    ï¼‰\
  &gt; $(TMP)/out.$$$$ &amp;&amp; \
  $(MV) $(TMP)/è¾“å‡ºã€‚$$$$ $2
æ©å¾·å¤«</pre><pre class="programlisting"># $(call run-script-example, script-name, output-file)
#   Run an example makefile.
define run-script-example
  ( cd $(dir $1);                                       \
    $(notdir $1) 2&gt;&amp;1 |                                 \
    if $(EGREP) --silent '\$$\(MAKE\)' [mM]akefile;     \
    then                                                \
      $(SED) -e 's/^++*/$$/';                           \
    else                                                \
      $(SED) -e 's/^++*/$$/'                            \
             -e '/ing directory /d'                     \
             -e 's/\[[0-9]\]//';                        \
    fi )                                                \
  &gt; $(TMP)/out.$$$$ &amp;&amp;                                  \
  $(MV) $(TMP)/out.$$$$ $2
endef</pre><p>æ­¤å‡½æ•°éœ€è¦è„šæœ¬çš„è·¯å¾„å’Œè¾“å‡ºæ–‡ä»¶åã€‚å®ƒæ›´æ”¹åˆ°è„šæœ¬çš„ç›®å½•å¹¶è¿è¡Œè„šæœ¬ï¼Œé€šè¿‡è¿‡æ»¤å™¨ä¼ è¾“æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºä»¥æ¸…ç†å®ƒä»¬ã€‚<sup>[ <a id="OEBPS/ch11.html.make3-CHP-11-FNOTE-1" href="#OEBPS/ch11.html.ftn.make3-CHP-11-FNOTE-1" class="footnote">1</a> ]</sup></p><p>This function requires the path to the script and the output
          filename. It changes to the script's directory and runs the script,
          piping both the standard output and error output through a filter to
          clean them up.<sup>[<a href="#OEBPS/ch11.html.ftn.make3-CHP-11-FNOTE-1" class="footnote">1</a>]</sup></p><p><em class="filename">make.out</em>ç›®æ ‡ç±»ä¼¼ï¼Œä½†å¢žåŠ äº†å¤æ‚æ€§ã€‚å¦‚æžœå°†æ–°æ–‡ä»¶æ·»åŠ åˆ°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›æ£€æµ‹æƒ…å†µå¹¶é‡å»ºç¤ºä¾‹ã€‚ä»…å½“å‘çŽ°æ–°ç›®å½•æ—¶ï¼Œä»£ç <code class="literal">_CREATE_OUTPUT_DIR</code>
          æ‰ä¼šé‡å»ºç¬¦å·é“¾æŽ¥ï¼Œè€Œä¸æ˜¯åœ¨æ·»åŠ æ–°æ–‡ä»¶æ—¶ã€‚ä¸ºäº†æ£€æµ‹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªç¤ºä¾‹ç›®å½•ä¸­æ”¾ç½®ä¸€ä¸ªæ—¶é—´æˆ³æ–‡ä»¶ï¼ŒæŒ‡ç¤ºæœ€åŽä¸€æ¬¡
          <em class="command">lndir</em>æ‰§è¡Œçš„æ—¶é—´ã€‚ç›®æ ‡<code class="literal">$($1_clean)</code>æ›´æ–°æ­¤æ—¶é—´æˆ³æ–‡ä»¶ï¼Œå¹¶å–å†³äºŽç¤ºä¾‹ç›®å½•ä¸­çš„å®žé™…æºæ–‡ä»¶ï¼ˆè€Œä¸æ˜¯è¾“å‡ºç›®å½•ä¸­çš„ç¬¦å·é“¾æŽ¥ï¼‰ã€‚å¦‚æžœ<em class="command">makeçš„ä¾èµ–æ€§åˆ†æžåœ¨ç¤ºä¾‹ç›®å½•ä¸­å‘çŽ°æ¯”</em><em class="filename">å¹²å‡€</em>æ—¶é—´æˆ³æ–‡ä»¶æ›´æ–°çš„æ–‡ä»¶ï¼Œåˆ™å‘½ä»¤è„šæœ¬å°†åˆ é™¤ç¬¦å·é“¾æŽ¥è¾“å‡ºç›®å½•ï¼Œé‡æ–°åˆ›å»ºå®ƒï¼Œå¹¶åˆ é™¤æ–°çš„<em class="filename">å¹²å‡€</em>æ—¶é—´æˆ³æ–‡ä»¶ã€‚å½“<em class="filename">makefile</em>æœ¬èº«è¢«ä¿®æ”¹æ—¶ä¹Ÿä¼šæ‰§è¡Œæ­¤æ“ä½œã€‚</p><p>The <em class="filename">make.out</em> target is
          similar but has an added complication. If new files are added to an
          example, we would like to detect the situation and rebuild the
          example. The <code class="literal">_CREATE_OUTPUT_DIR</code>
          code rebuilds symlinks only if a new directory is discovered, not
          when new files are added. To detect this situation, we drop a
          timestamp file in each example directory indicating when the last
          <em class="command">lndir</em> was performed. The <code class="literal">$($1_clean)</code> target updates this timestamp
          file and depends upon the actual source files in the examples
          directory (not the symlinks in the output directory). If <em class="command">make</em>'s dependency analysis discovers a
          newer file in the examples directory than the <em class="filename">clean</em> timestamp file, the command script
          will delete the symlinked output directory, recreate it, and drop a
          new <em class="filename">clean</em> timestamp file. This
          action is also performed when the <em class="filename">makefile</em> itself is modified.</p><p>æœ€åŽï¼Œ<em class="filename">run-make</em> 
          shellè„šæœ¬<a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1554" class="indexterm"></a>è°ƒç”¨æ¥è¿è¡Œ<em class="filename">makefile</em>é€šå¸¸æ˜¯ä¸€ä¸ªä¸¤è¡Œè„šæœ¬ã€‚</p><p>Finally, the <em class="filename">run-make</em>
          shell script <a class="indexterm"></a>invoked to run the <em class="filename">makefile</em> is typically a two-line
          script.</p><a id="OEBPS/ch11.html.I_6_tt458"></a><pre class="programlisting">#ï¼ /bin/bash -x
åˆ¶ä½œ</pre><pre class="programlisting">#! /bin/bash -x
make</pre><p>ç”Ÿæˆè¿™äº›æ ·æ¿è„šæœ¬å¾ˆå¿«å°±å˜å¾—ä¹å‘³ï¼Œå› æ­¤<code class="literal">$($1_run_make)</code>
          æ·»åŠ ç›®æ ‡ä½œä¸º<code class="literal">$($1_make_out)</code>åˆ›å»ºå®ƒçš„å…ˆå†³æ¡ä»¶ã€‚å¦‚æžœç¼ºå°‘å…ˆå†³æ¡ä»¶ï¼Œ<em class="filename">makefile</em>å°†åœ¨è¾“å‡ºæ ‘ä¸­ç”Ÿæˆå®ƒã€‚</p><p>It quickly became tedious to produce these boilerplate
          scripts, so the <code class="literal">$($1_run_make)</code>
          target was added as a prerequisite to <code class="literal">$($1_make_out)</code> to create it. If the
          prerequisite is missing, the <em class="filename">makefile</em> generates it in the output
          tree.</p><p>å½“ä¸ºæ¯ä¸ªç¤ºä¾‹ç›®å½•æ‰§è¡Œè¯¥<code class="function">generic-program-example</code>å‡½æ•°æ—¶ï¼Œå®ƒä¼šåˆ›å»ºç”¨äºŽè¿è¡Œç¤ºä¾‹å¹¶å‡†å¤‡è¾“å‡ºä»¥åŒ…å«åœ¨ XML æ–‡ä»¶ä¸­çš„æ‰€æœ‰è§„åˆ™ã€‚è¿™äº›è§„åˆ™ç”±<em class="filename">makefile</em>ä¸­åŒ…å«çš„è®¡ç®—ä¾èµ–å…³ç³»è§¦å‘ã€‚ä¾‹å¦‚ï¼Œ<a class="link" href="#OEBPS/ch01.html" title="ç¬¬ 1 ç«  å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile">ç¬¬ 1 ç« </a>çš„ä¾èµ–æ–‡ä»¶
          æ˜¯ï¼š</p><p>The <code class="function">generic-program-example</code> function, when
          executed for each example directory, creates all the rules for
          running examples and preparing the output for inclusion in the XML
          files. These rules are triggered by computed dependencies included
          in the <em class="filename">makefile</em>. For example,
          the dependency file for <a class="link" href="#OEBPS/ch01.html" title="Chapter&nbsp;1.&nbsp;How to Write a Simple Makefile">Chapter 1</a>
          is:</p><a id="OEBPS/ch11.html.I_6_tt459"></a><pre class="programlisting">out/ch01.xml: $(EXAMPLES_DIR)/ch01-hello/Makefile
out/ch01.xml: $(OUTPUT_DIR)/ch01-hello/make.out
out/ch01.xml: $(EXAMPLES_DIR)/ch01-cw1/count_words.c
out/ch01.xml: $(EXAMPLES_DIR)/ch01-cw1/lexer.l
out/ch01.xml: $(EXAMPLES_DIR)/ch01-cw1/Makefile
out/ch01.xml: $(OUTPUT_DIR)/ch01-cw1/make.out
out/ch01.xml: $(EXAMPLES_DIR)/ch01-cw2/lexer.l
out/ch01.xml: $(OUTPUT_DIR)/ch01-cw2/make.out
out/ch01.xml: $(OUTPUT_DIR)/ch01-cw2/run.out
out/ch01.xml: $(OUTPUT_DIR)/ch01-bogus-tab/make.out</pre><pre class="programlisting">out/ch01.xml: $(EXAMPLES_DIR)/ch01-hello/Makefile
out/ch01.xml: $(OUTPUT_DIR)/ch01-hello/make.out
out/ch01.xml: $(EXAMPLES_DIR)/ch01-cw1/count_words.c
out/ch01.xml: $(EXAMPLES_DIR)/ch01-cw1/lexer.l
out/ch01.xml: $(EXAMPLES_DIR)/ch01-cw1/Makefile
out/ch01.xml: $(OUTPUT_DIR)/ch01-cw1/make.out
out/ch01.xml: $(EXAMPLES_DIR)/ch01-cw2/lexer.l
out/ch01.xml: $(OUTPUT_DIR)/ch01-cw2/make.out
out/ch01.xml: $(OUTPUT_DIR)/ch01-cw2/run.out
out/ch01.xml: $(OUTPUT_DIR)/ch01-bogus-tab/make.out</pre><p>è¿™äº›ä¾èµ–é¡¹æ˜¯ç”±ä¸€ä¸ªç®€å•çš„<em class="command">awk</em>è„šæœ¬ç”Ÿæˆçš„ï¼Œå¯Œæœ‰æƒ³è±¡åŠ›åœ°å‘½åä¸º<em class="command">make-depend</em>ï¼š</p><p>These dependencies are generated by a simple <em class="command">awk</em> script, imaginatively named <em class="command">make-depend</em>:</p><a id="OEBPS/ch11.html.I_6_tt460"></a><pre class="programlisting">#ï¼ /bin/awk -f

å‡½æ•°generate_dependencyï¼ˆå…ˆå†³æ¡ä»¶ï¼‰
{
  æ–‡ä»¶å = æ–‡ä»¶å
  å­ï¼ˆ/æ–‡æœ¬/ï¼Œâ€œè¾“å‡ºâ€ï¼Œæ–‡ä»¶åï¼‰
  æ‰“å°æ–‡ä»¶åâ€œï¼šâ€å…ˆå†³æ¡ä»¶
}

/^ *åŒ…å«ç¨‹åº/ {
  generate_dependency(â€œ$(EXAMPLES_DIR)/â€$2)
}

/^ *mp_program\(/ {
  åŒ¹é…( $0, /\((.*)\)/, åç§° )
  generate_dependency( "$(EXAMPLES_DIR)/" åç§°[1] )
}

/^ *åŒ…å«è¾“å‡º/ {
  ç”Ÿæˆ_ä¾èµ–ï¼ˆâ€œ$ï¼ˆOUTPUT_DIRï¼‰/â€$ 2ï¼‰
}

/^ *mp_output\(/ {
  åŒ¹é…( $0, /\((.*)\)/, åç§° )
  generate_dependency( "$(OUTPUT_DIR)/" åç§°[1] )
}

/å›¾å½¢æ–‡ä»¶å‚è€ƒ/ {
  åŒ¹é…( $0, /"(.*)"/, out_file )
  ç”Ÿæˆä¾èµ–ï¼ˆout_file[1]ï¼‰ï¼›
}</pre><pre class="programlisting">#! /bin/awk -f

function generate_dependency( prereq )
{
  filename = FILENAME
  sub( /text/, "out", filename )
  print filename ": " prereq
}

/^ *include-program/ {
  generate_dependency( "$(EXAMPLES_DIR)/" $2 )
}

/^ *mp_program\(/ {
  match( $0, /\((.*)\)/, names )
  generate_dependency( "$(EXAMPLES_DIR)/" names[1] )
}

/^ *include-output/ {
  generate_dependency( "$(OUTPUT_DIR)/" $2 )
}

/^ *mp_output\(/ {
  match( $0, /\((.*)\)/, names )
  generate_dependency( "$(OUTPUT_DIR)/" names[1] )
}

/graphic fileref/ {
  match( $0, /"(.*)"/, out_file )
  generate_dependency( out_file[1] );
}</pre><p>è¯¥è„šæœ¬æœç´¢å¦‚ä¸‹æ¨¡å¼ï¼š</p><p>The script searches for patterns like:</p><a id="OEBPS/ch11.html.I_6_tt461"></a><pre class="programlisting">mp_program(ch01-hello/Makefile)
mp_output(ch01-hello/make.out)</pre><pre class="programlisting">mp_program(ch01-hello/Makefile)
mp_output(ch01-hello/make.out)</pre><p>ï¼ˆ<code class="literal">mp_program</code>å®ä½¿ç”¨ç¨‹åºåˆ—è¡¨æ ¼å¼ï¼Œè€Œ<code class="literal">mp_output</code>å®ä½¿ç”¨ç¨‹åºè¾“å‡ºæ ¼å¼ã€‚ï¼‰è„šæœ¬æ ¹æ®æºæ–‡ä»¶åå’Œæ–‡ä»¶åå‚æ•°ç”Ÿæˆä¾èµ–é¡¹ã€‚</p><p>(The <code class="literal">mp_program</code> macro uses
          the program listing format, while the <code class="literal">mp_output</code> macro uses the program output
          format.) The script generates the dependency from the source
          filename and the filename parameter.</p><p>æœ€åŽï¼Œä¾èµ–æ–‡ä»¶çš„ç”Ÿæˆç”±
          <em class="command">make</em> include è¯­å¥ä»¥é€šå¸¸çš„æ–¹å¼è§¦å‘ï¼š</p><p>Finally, the generation of dependency files is triggered by a
          <em class="command">make</em> include statement, in the
          usual fashion:</p><a id="OEBPS/ch11.html.I_6_tt462"></a><pre class="programlisting"># $(è°ƒç”¨æºåˆ°è¾“å‡ºï¼Œæ–‡ä»¶å)
# å°†æºæ ‘å¼•ç”¨è½¬æ¢ä¸ºè¾“å‡ºæ ‘å¼•ç”¨ã€‚
å®šä¹‰æºåˆ°è¾“å‡º
$(subst $(SOURCE_DIR),$(OUTPUT_DIR),$1)
æ©å¾·å¤«
 ã€‚ ã€‚ ã€‚
ALL_XML_SRC := $(é€šé…ç¬¦ $(SOURCE_DIR)/*.xml)
DEPENDENCY_FILES := $(è°ƒç”¨æºåˆ°è¾“å‡º,$(subst .xml,.d,$(ALL_XML_SRC)))
 ã€‚ ã€‚ ã€‚
ifneq "$(MAKECMDGOALS)" "å¹²å‡€"
  -åŒ…æ‹¬$(DEPENDENCY_FILES)
ä¸‡ä¸€

vpath%.xml $(SOURCE_DIR)
 ã€‚ ã€‚ ã€‚
$(OUTPUT_DIR)/%.d: %.xml $(make-depend)
        $(make-depend) $&lt; &gt; $@</pre><pre class="programlisting"># $(call source-to-output, file-name)
#   Transform a source tree reference to an output tree reference.
define source-to-output
$(subst $(SOURCE_DIR),$(OUTPUT_DIR),$1)
endef
 . . . 
ALL_XML_SRC      := $(wildcard $(SOURCE_DIR)/*.xml)
DEPENDENCY_FILES := $(call source-to-output,$(subst .xml,.d,$(ALL_XML_SRC)))
 . . . 
ifneq "$(MAKECMDGOALS)" "clean"
  -include $(DEPENDENCY_FILES)
endif

vpath %.xml $(SOURCE_DIR)
 . . . 
$(OUTPUT_DIR)/%.d: %.xml $(make-depend)
        $(make-depend) $&lt; &gt; $@</pre><p>è¿™æ ·å°±å®Œæˆäº†å¤„ç†ç¤ºä¾‹çš„ä»£ç ã€‚å¤§å¤šæ•°å¤æ‚æ€§æºäºŽå¸Œæœ›åŒ…å«
          <em class="filename">makefile</em>çš„å®žé™…æºä»¥åŠ<em class="command">make</em>å’Œç¤ºä¾‹ç¨‹åºçš„å®žé™…è¾“å‡ºã€‚æˆ‘æ€€ç–‘è¿™é‡Œä¹Ÿæœ‰ä¸€ç‚¹â€œè¦ä¹ˆå¿å—ï¼Œè¦ä¹ˆé—­å˜´â€ç»¼åˆç—‡ã€‚å¦‚æžœæˆ‘ç›¸ä¿¡<em class="command">make</em>å¦‚æ­¤å¼ºå¤§ï¼Œå®ƒåº”è¯¥èƒ½å¤Ÿå¤„ç†è¿™ä¸ªå¤æ‚çš„ä»»åŠ¡ï¼Œå¤©å“ªï¼Œå®ƒç¡®å®žå¯ä»¥ã€‚</p><p>This completes the code for handling examples. Most of the
          complexity stems from the desire to include the actual source of the
          <em class="filename">makefile</em>s as well as the actual
          output from <em class="command">make</em> and the example
          programs. I suspect there is also a little bit of the "put up or
          shut up" syndrome here. If I believe <em class="command">make</em> is so great, it should be able to
          handle this complex task and, by golly, it can.</p></div><div class="sect2" title="XMLé¢„å¤„ç†"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch11.html.make3-CHP-11-SECT-1.2"></a>XMLé¢„å¤„ç†</h2><h2 class="title"><a></a>XML Preprocessing</h2></div></div></div><p>å†’ç€å“ç‰Œé£Žé™©<a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1555" class="indexterm"></a> <a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1556" class="indexterm"></a> <a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1557" class="indexterm"></a>ä½œä¸ºåŽä¸–çš„åº¸äººï¼Œæˆ‘å¿…é¡»æ‰¿è®¤æˆ‘ä¸å¤ªå–œæ¬¢ XMLã€‚æˆ‘è§‰å¾—å®ƒå¾ˆå°´å°¬è€Œä¸”å†—é•¿ã€‚å› æ­¤ï¼Œå½“æˆ‘å‘çŽ°æ‰‹ç¨¿å¿…é¡»ç”¨ DocBook ç¼–å†™æ—¶ï¼Œæˆ‘å¯»æ‰¾æ›´ä¼ ç»Ÿçš„å·¥å…·æ¥å¸®åŠ©å‡è½»ç—›è‹¦ã€‚<em class="command">m4</em>å®å¤„ç†å™¨
          å’Œ<em class="command">awk</em>æ˜¯ä¸¤ä¸ªæœ‰å¾ˆå¤§å¸®åŠ©çš„å·¥å…·ã€‚</p><p>At the risk of branding <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>myself as a philistine for all posterity, I must admit
          I don't like XML very much. I find it awkward and verbose. So, when
          I discovered that the manuscript must be written in DocBook, I
          looked for more traditional tools that would help ease the pain. The
          <em class="command">m4</em> macro processor and <em class="command">awk</em> were two tools that helped
          immensely.</p><p><em class="command">m4</em>éžå¸¸é€‚åˆè§£å†³DocBook å’Œ XML çš„ä¸¤ä¸ªé—®é¢˜ï¼šé¿å… XML çš„å†—é•¿è¯­æ³•å’Œç®¡ç†äº¤å‰å¼•ç”¨ä¸­ä½¿ç”¨çš„ XML æ ‡è¯†ç¬¦ã€‚ä¾‹å¦‚ï¼Œè¦å¼ºè°ƒ DocBook ä¸­çš„æŸä¸ªå•è¯ï¼Œæ‚¨å¿…é¡»ç¼–å†™ï¼š</p><p>There were two problems with DocBook and XML that <em class="command">m4</em> was perfect for: avoiding the verbose
          syntax of XML and managing the XML identifiers used in
          cross-referencing. For instance, to emphasize a word in DocBook, you
          must write:</p><a id="OEBPS/ch11.html.I_6_tt463"></a><pre class="programlisting">&lt;å¼ºè°ƒ&gt;ä¸æ˜¯&lt;/å¼ºè°ƒ&gt;</pre><pre class="programlisting">&lt;emphasis&gt;not&lt;/emphasis&gt;</pre><p>ä½¿ç”¨<em class="command">m4</em>ï¼Œæˆ‘ç¼–å†™äº†ä¸€ä¸ªç®€å•çš„å®ï¼Œå®ƒå…è®¸æˆ‘ç¼–å†™ï¼š</p><p>Using <em class="command">m4</em>, I wrote a simple
          macro that allowed me to instead write:</p><a id="OEBPS/ch11.html.I_6_tt464"></a><pre class="programlisting">mp_emï¼ˆä¸æ˜¯ï¼‰</pre><pre class="programlisting">mp_em(not)</pre><p>å•Šï¼Œè¿™æ ·æ„Ÿè§‰å¥½å¤šäº†ã€‚æ­¤å¤–ï¼Œæˆ‘è¿˜ä»‹ç»äº†è®¸å¤šé€‚åˆè¯¥ææ–™çš„ç¬¦å·æ ¼å¼æ ·å¼ï¼Œä¾‹å¦‚
          <code class="literal">mp_variable</code>å’Œ<code class="literal">mp_target</code>ã€‚è¿™ä½¿æˆ‘èƒ½å¤Ÿé€‰æ‹©ä¸€ç§ç®€å•çš„æ ¼å¼ï¼Œä¾‹å¦‚æ–‡å­—ï¼Œå¹¶ç¨åŽå°†å…¶æ›´æ”¹ä¸ºç”Ÿäº§éƒ¨é—¨å–œæ¬¢çš„ä»»ä½•æ ¼å¼ï¼Œè€Œæ— éœ€æ‰§è¡Œå…¨å±€æœç´¢å’Œæ›¿æ¢ã€‚</p><p>Ahh, that feels better. In addition, I introduced many
          symbolic formatting styles appropriate for the material, such as
          <code class="literal">mp_variable</code> and <code class="literal">mp_target</code>. This allowed me to select a
          trivial format, such as literal, and change it later to whatever the
          production department preferred without having to perform a global
          search and replace.</p><p>æˆ‘ç¡®ä¿¡ XML çˆ±å¥½è€…å¯èƒ½ä¼šå‘æˆ‘å‘é€å¤§é‡ç”µå­é‚®ä»¶ï¼Œå‘Šè¯‰æˆ‘å¦‚ä½•ä½¿ç”¨å®žä½“æˆ–ç±»ä¼¼çš„ä¸œè¥¿æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½†è¯·è®°ä½ Unix æ˜¯ç”¨æ‰‹å¤´çš„å·¥å…·å®Œæˆå·¥ä½œï¼Œæ­£å¦‚ Larry Wall å–œæ¬¢è¯´çš„ï¼Œâ€œæœ‰ä¸æ­¢ä¸€ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚â€æ­¤å¤–ï¼Œæˆ‘æ‹…å¿ƒå­¦å¤ªå¤š XML ä¼šè…èš€æˆ‘çš„å¤§è„‘ã€‚</p><p>I'm sure the XML aficionados will probably send me boat loads
          of email telling me how to do this with entities or some such, but
          remember Unix is about getting the job done now with the tools at
          hand, and as Larry Wall loves to say, "there's more than one way to
          do it." Besides, I'm afraid learning too much XML will rot my
          brain.</p><p><em class="command">m4</em>çš„ç¬¬äºŒä¸ªä»»åŠ¡æ˜¯
          <a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1558" class="indexterm"></a> <a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1559" class="indexterm"></a> <a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1560" class="indexterm"></a>å¤„ç†ç”¨äºŽäº¤å‰å¼•ç”¨çš„ XML æ ‡è¯†ç¬¦ã€‚æ¯ä¸ªç« èŠ‚ã€ç¤ºä¾‹å’Œè¡¨æ ¼éƒ½æ ‡æœ‰æ ‡è¯†ç¬¦ï¼š</p><p>The second task for <em class="command">m4</em> was
          <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>handling the XML identifiers used for
          cross-referencing. Each chapter, section, example, and table is
          labeled with an identifier:</p><a id="OEBPS/ch11.html.I_6_tt465"></a><pre class="programlisting">&lt;sect1 id="MPWM-CH-7-SECT-1"&gt;</pre><pre class="programlisting">&lt;sect1 id="MPWM-CH-7-SECT-1"&gt;</pre><p>å¯¹ç« èŠ‚çš„å¼•ç”¨å¿…é¡»ä½¿ç”¨æ­¤æ ‡è¯†ç¬¦ã€‚ä»Žç¼–ç¨‹çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚æ ‡è¯†ç¬¦æ˜¯æ•£å¸ƒåœ¨æ•´ä¸ªâ€œä»£ç â€ä¸­çš„å¤æ‚å¸¸é‡ã€‚æ­¤å¤–ï¼Œç¬¦å·æœ¬èº«æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚æˆ‘ä¸çŸ¥é“
          <a class="link" href="#OEBPS/ch07.html" title="ç¬¬ 7 ç« å¯ç§»æ¤ Makefile">ç¬¬ 7 ç« </a>ç¬¬ 1 èŠ‚æ˜¯å…³äºŽä»€ä¹ˆçš„ã€‚é€šè¿‡ä½¿ç”¨<em class="command">m4</em>ï¼Œæˆ‘å¯ä»¥é¿å…é‡å¤å¤æ‚çš„æ–‡å­—ï¼Œå¹¶æä¾›æ›´æœ‰æ„ä¹‰çš„åç§°ï¼š</p><p>References to a chapter must use this identifier. This is
          clearly an issue from a programming standpoint. The identifiers are
          complex constants sprinkled throughout the "code." Furthermore, the
          symbols themselves have no meaning. I have no idea what section 1 of
          <a class="link" href="#OEBPS/ch07.html" title="Chapter&nbsp;7.&nbsp;Portable Makefiles">Chapter 7</a> might have been about.
          By using <em class="command">m4</em>, I could avoid
          duplicating complex literals, and provide a more meaningful
          name:</p><a id="OEBPS/ch11.html.I_6_tt466"></a><pre class="programlisting">&lt;sect1 id="mp_se_makedepend"&gt;</pre><pre class="programlisting">&lt;sect1 id="mp_se_makedepend"&gt;</pre><p>æœ€é‡è¦çš„æ˜¯ï¼Œå¦‚æžœç« èŠ‚å‘ç”Ÿå˜åŒ–ï¼ˆå°±åƒå¾ˆå¤šæ¬¡ä¸€æ ·ï¼‰ï¼Œå¯ä»¥é€šè¿‡æ›´æ”¹å•ä¸ªæ–‡ä»¶ä¸­çš„ä¸€äº›å¸¸é‡æ¥æ›´æ–°æ–‡æœ¬ã€‚å½“ç« èŠ‚ä¸­çš„ç« èŠ‚é‡æ–°ç¼–å·æ—¶ï¼Œä¼˜åŠ¿æœ€ä¸ºæ˜Žæ˜¾ã€‚å¦‚æžœæˆ‘æ²¡æœ‰ä½¿ç”¨ç¬¦å·å¼•ç”¨ï¼Œè¿™æ ·çš„æ“ä½œå¯èƒ½éœ€è¦å¯¹æ‰€æœ‰æ–‡ä»¶è¿›è¡Œå…­æ¬¡å…¨å±€æœç´¢å’Œæ›¿æ¢æ“ä½œã€‚</p><p>Most importantly, if chapters or sections shift, as they did
          many times, the text could be updated by changing a few constants in
          a single file. The advantage was most noticeable when sections were
          renumbered in a chapter. Such an operation might require a half
          dozen global search and replace operations across all files if I
          hadn't used symbolic references.</p><p><em class="command">ä¸‹é¢æ˜¯å‡ ä¸ªm4</em>å®çš„ç¤ºä¾‹<sup>[ <a id="OEBPS/ch11.html.make3-CHP-11-FNOTE-2" href="#OEBPS/ch11.html.ftn.make3-CHP-11-FNOTE-2" class="footnote">2</a> ]</sup>ï¼š</p><p>Here is an example of several <em class="command">m4</em> macros<sup>[<a href="#OEBPS/ch11.html.ftn.make3-CHP-11-FNOTE-2" class="footnote">2</a>]</sup>:</p><a id="OEBPS/ch11.html.I_6_tt467"></a><pre class="programlisting">m4_define(`mp_tag', `&lt;$1&gt;`$2'&lt;/$1&gt;')
m4_define(`mp_lit', `mp_tag(æ–‡å­—, `$1')')

m4_define(`mp_cmd', `mp_tag(å‘½ä»¤,`$1')')
m4_define(`mp_target', `mp_lit($1)')

m4_define(`mp_all', `mp_target(å…¨éƒ¨)')
m4_define(`mp_bash', `mp_cmd(bash)')

m4_define(`mp_ch_examples', `MPWM-CH-11')
m4_define(`mp_se_book', `MPWM-CH-11.1')
m4_define(`mp_ex_book_makefile',`MPWM-CH-11-EX-1')</pre><pre class="programlisting">m4_define(`mp_tag',    `&lt;$1&gt;`$2'&lt;/$1&gt;')
m4_define(`mp_lit',    `mp_tag(literal, `$1')')

m4_define(`mp_cmd',    `mp_tag(command,`$1')')
m4_define(`mp_target', `mp_lit($1)')

m4_define(`mp_all',    `mp_target(all)')
m4_define(`mp_bash',   `mp_cmd(bash)')

m4_define(`mp_ch_examples',     `MPWM-CH-11')
m4_define(`mp_se_book',         `MPWM-CH-11.1')
m4_define(`mp_ex_book_makefile',`MPWM-CH-11-EX-1')</pre><p>å¦ä¸€ä¸ªé¢„å¤„ç†ä»»åŠ¡æ˜¯åœ¨å‰é¢è®¨è®ºçš„ç¤ºä¾‹æ–‡æœ¬ä¸­å®žçŽ°åŒ…å«åŠŸèƒ½ã€‚è¯¥æ–‡æœ¬éœ€è¦å°†å…¶åˆ¶è¡¨ç¬¦è½¬æ¢ä¸ºç©ºæ ¼ï¼ˆå› ä¸º O'Reilly çš„ DocBook è½¬æ¢å™¨æ— æ³•å¤„ç†åˆ¶è¡¨ç¬¦ï¼Œå¹¶ä¸”<em class="filename">makefile</em>æœ‰å¾ˆå¤šåˆ¶è¡¨ç¬¦ï¼ï¼‰ï¼Œå¿…é¡»ç”¨ a åŒ…è£¹<code class="literal">[CDATA[...]]</code>ä»¥ä¿æŠ¤ç‰¹æ®Šå­—ç¬¦ï¼Œæœ€åŽï¼Œå¿…é¡»ä¿®å‰ªå¤šä½™çš„æ¢è¡Œç¬¦ç¤ºä¾‹çš„å¼€å¤´å’Œç»“å°¾ã€‚æˆ‘ç”¨å¦ä¸€ä¸ª<em class="command">awk</em>å°ç¨‹åºå®Œæˆäº†è¿™ä¸ªä»»åŠ¡<code class="literal">process-includes</code>ï¼š</p><p>The other preprocessing task was to implement an include
          feature for slurping in the example text previously discussed. This
          text needed to have its tabs converted to spaces (since O'Reilly's
          DocBook converter cannot handle tabs and <em class="filename">makefile</em>s have lots of tabs!), must be
          wrapped in a <code class="literal">[CDATA[...]]</code> to
          protect special characters, and finally, has to trim the extra
          newlines at the beginning and end of examples. I accomplished this
          with another little <em class="command">awk</em> program
          called <code class="literal">process-includes</code>:</p><a id="OEBPS/ch11.html.I_6_tt468"></a><pre class="programlisting">#ï¼ /usr/bin/awk -f
å‡½æ•° Expand_cdata( ç›®å½• )
{
  start_place = match( $1, "include-" )
  å¦‚æžœï¼ˆèµ·å§‹ä½ç½®&gt; 0ï¼‰
  {
    å‰ç¼€ = substr( $1, 1, èµ·å§‹ä½ç½® - 1 )
  }
  åˆ«çš„
  {
    print "ä¼ªé€ çš„ include '" $0 "'" &gt; "/dev/stderr"
  }

  end_place = match( $2, "(&lt;/(programlisting|screen)&gt;.*)$", æ ‡ç­¾ )
  å¦‚æžœï¼ˆç»“æŸåœ°ç‚¹ &gt; 0ï¼‰
  {
    æ–‡ä»¶ = dir substr( $2, 1, end_place - 1 )
  }
  åˆ«çš„
  {
    print "ä¼ªé€ çš„ include '" $0 "'" &gt; "/dev/stderr"
  }

  å‘½ä»¤=â€œå±•å¼€â€æ–‡ä»¶

  printf "%s&gt;&amp;33;&amp;91;CDATA[", å‰ç¼€
  å°¾éƒ¨ = 0
  å‰ä¸€è¡Œ=â€œâ€
  while ( (å‘½ä»¤ | getline è¡Œ) &gt; 0 )
  {
    å¦‚æžœï¼ˆå°¾éƒ¨ï¼‰
      æ‰“å°å‰ä¸€è¡Œï¼›

    å°¾éƒ¨ = 1
    å‰ä¸€è¡Œ = è¡Œ
  }

  printf "%s&amp;93;&amp;93;&amp;62;%s\n", previous_line, tag[1]
  å…³é—­ï¼ˆå‘½ä»¤ï¼‰
}

/åŒ…æ‹¬ç¨‹åº/ {
  Expand_cdata(â€œç¤ºä¾‹/â€)
  ä¸‹ä¸€ä¸ª;
}

/åŒ…æ‹¬è¾“å‡º/ {
  å±•å¼€_cdata(â€œè¾“å‡º/â€)
  ä¸‹ä¸€ä¸ª;
}

/&lt;(èŠ‚ç›®åˆ—è¡¨|å±å¹•)&gt; *$/ {
  # æ‰¾åˆ°å½“å‰çš„ç¼©è¿›ã€‚
  åç§» = åŒ¹é…( $0, "&lt;(èŠ‚ç›®åˆ—è¡¨|å±å¹•)&gt;" )

  # ä»Žæ ‡ç­¾ä¸­åˆ é™¤æ¢è¡Œç¬¦ã€‚
  æ‰“å° $0

  # é˜…è¯»ç¨‹åº...
  å°¾éƒ¨ = 0
  å‰ä¸€è¡Œ=â€œâ€
  while ( (getline è¡Œ) &gt; 0 )
  {
    if ( line ~ "&lt;/(programlisting|screen)&gt;" )
    {
      gsub( /^ */, "", è¡Œ )
      ä¼‘æ¯
    }

    å¦‚æžœï¼ˆå°¾éƒ¨ï¼‰
      æ‰“å°å‰ä¸€è¡Œ

    å°¾éƒ¨ = 1
    previous_line = substr( è¡Œï¼Œåç§»é‡ + 1 )
  }

  printf "%s%s\n", previous_line, è¡Œ

  ä¸‹ä¸€ä¸ª
}

{
  æ‰“å°
}</pre><pre class="programlisting">#! /usr/bin/awk -f
function expand_cdata( dir )
{
  start_place = match( $1, "include-" )
  if ( start_place &gt; 0 )
  {
    prefix = substr( $1, 1, start_place - 1 )
  }
  else
  {
    print "Bogus include '" $0 "'" &gt; "/dev/stderr"
  }

  end_place = match( $2, "(&lt;/(programlisting|screen)&gt;.*)$", tag )
  if ( end_place &gt; 0 )
  {
    file = dir substr( $2, 1, end_place - 1 )
  }
  else
  {
    print "Bogus include '" $0 "'" &gt; "/dev/stderr"
  }

  command = "expand " file

  printf "%s&gt;&amp;33;&amp;91;CDATA[", prefix
  tail = 0
  previous_line = ""
  while ( (command | getline line) &gt; 0 )
  {
    if ( tail )
      print previous_line;

    tail = 1
    previous_line = line
  }

  printf "%s&amp;93;&amp;93;&amp;62;%s\n", previous_line, tag[1]
  close( command )
}

/include-program/ {
  expand_cdata( "examples/" )
  next;
}

/include-output/ {
  expand_cdata( "out/" )
  next;
}

/&lt;(programlisting|screen)&gt; *$/ {
  # Find the current indentation.
  offset = match( $0, "&lt;(programlisting|screen)&gt;" )

  # Strip newline from tag.
  printf $0

  # Read the program...
  tail = 0
  previous_line = ""
  while ( (getline line) &gt; 0 )
  {
    if ( line ~ "&lt;/(programlisting|screen)&gt;" )
    {
      gsub( /^ */, "", line )
      break
    }

    if ( tail )
      print previous_line

    tail = 1
    previous_line = substr( line, offset + 1 )
  }

  printf "%s%s\n", previous_line, line

  next
}

{
  print
}</pre><p>åœ¨<em class="filename">makefile</em>ä¸­ï¼Œæˆ‘ä»¬å°† XML æ–‡ä»¶ä»Žæºæ ‘å¤åˆ¶åˆ°è¾“å‡ºæ ‘ï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­è½¬æ¢é€‰é¡¹å¡ã€å®å’ŒåŒ…å«æ–‡ä»¶ï¼š</p><p>In the <em class="filename">makefile</em>, we copy
          the XML files from the source tree to the output tree, transforming
          tabs, macros, and include files in the process:</p><a id="OEBPS/ch11.html.I_6_tt469"></a><pre class="programlisting">è¿›ç¨‹ pgm := bin/è¿›ç¨‹åŒ…å«
m4-å® := æ–‡æœ¬/å®.m4

# $(è°ƒç”¨è¿‡ç¨‹-åŒ…å«ã€è¾“å…¥æ–‡ä»¶ã€è¾“å‡ºæ–‡ä»¶)
# åˆ é™¤é€‰é¡¹å¡ã€å±•å¼€å®å¹¶å¤„ç†åŒ…å«æŒ‡ä»¤ã€‚
å®šä¹‰æµç¨‹åŒ…æ‹¬
  å±•å¼€ $1 | \
  $(M4) --prefix-builtins --include=text $(m4-å®) - | \
  $(è¿›ç¨‹-PGM) &gt; $2
æ©å¾·å¤«

vpath%.xml $(SOURCE_DIR)

$(OUTPUT_DIR)/%.xml: %.xml $(process-pgm) $(m4-macros)
        $(è°ƒç”¨è¿‡ç¨‹-åŒ…æ‹¬, $&lt;, $@)</pre><pre class="programlisting">process-pgm := bin/process-includes
m4-macros   := text/macros.m4

# $(call process-includes, input-file, output-file)
#   Remove tabs, expand macros, and process include directives.
define process-includes
  expand $1 |                                             \
  $(M4) --prefix-builtins --include=text $(m4-macros) - | \
  $(process-pgm) &gt; $2
endef

vpath %.xml $(SOURCE_DIR)

$(OUTPUT_DIR)/%.xml: %.xml $(process-pgm) $(m4-macros)
        $(call process-includes, $&lt;, $@)</pre><p>æ¨¡å¼è§„åˆ™æŒ‡ç¤ºå¦‚ä½•å°† XML æ–‡ä»¶ä»Žæºæ ‘èŽ·å–åˆ°è¾“å‡ºæ ‘ã€‚å®ƒè¿˜è¡¨ç¤ºï¼Œå¦‚æžœå®æˆ–åŒ…å«å¤„ç†å™¨å‘ç”Ÿæ›´æ”¹ï¼Œåˆ™åº”é‡æ–°ç”Ÿæˆæ‰€æœ‰è¾“å‡º XML æ–‡ä»¶ã€‚</p><p>The pattern rule indicates how to get an XML file from the
          source tree into the output tree. It also says that all the output
          XML files should be regenerated if the macros or the include
          processor change.</p></div><div class="sect2" title="ç”Ÿæˆè¾“å‡º"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch11.html.make3-CHP-11-SECT-1.3"></a>ç”Ÿæˆè¾“å‡º</h2><h2 class="title"><a></a>Generating Output</h2></div></div></div><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰€æ¶µç›–çš„å†…å®¹éƒ½æ²¡æœ‰<a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1561" class="indexterm"></a> <a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1562" class="indexterm"></a> <a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1563" class="indexterm"></a>å®žé™…ä¸Šæ ¼å¼åŒ–ä»»ä½•æ–‡æœ¬æˆ–åˆ›å»ºä»»ä½•å¯ä»¥æ‰“å°æˆ–æ˜¾ç¤ºçš„å†…å®¹ã€‚æ˜¾ç„¶ï¼Œå¦‚æžœ<em class="filename">makefile</em>æ˜¯æ ¼å¼åŒ–ä¸€æœ¬ä¹¦ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªéžå¸¸é‡è¦çš„åŠŸèƒ½ã€‚æˆ‘å¯¹ä¸¤ç§æ ¼å¼æ„Ÿå…´è¶£ï¼šHTML å’Œ PDFã€‚</p><p>So far, nothing we've covered has<a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> actually formatted any text or created anything that
          can be printed or displayed. Obviously, a very important feature if
          the <em class="filename">makefile</em> is to format a
          book. There were two formats that I was interested in: HTML and
          PDF.</p><p>æˆ‘å…ˆå¼„æ¸…æ¥šå¦‚ä½•æ ¼å¼åŒ–ä¸º HTMLã€‚æœ‰ä¸€ä¸ªå¾ˆæ£’çš„å°ç¨‹åº<em class="command">xsltproc</em>åŠå…¶å¸®åŠ©ç¨‹åºè„šæœ¬<em class="command">xmlto</em>ï¼Œæˆ‘ç”¨å®ƒæ¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œè¿‡ç¨‹ç›¸å½“ç®€å•ï¼š</p><p>I figured out how to format to HTML first. There's a great
          little program, <em class="command">xsltproc</em>, and its
          helper script, <em class="command">xmlto</em>, that I used
          to do the job. Using these tools, the process was fairly
          simple:</p><a id="OEBPS/ch11.html.I_6_tt470"></a><pre class="programlisting"># ä¹¦ç±è¾“å‡ºæ ¼å¼ã€‚
BOOK_XML_OUT := $(OUTPUT_DIR)/book.xml
BOOK_HTML_OUT := $(subst xml,html,$(BOOK_XML_OUT))
ALL_XML_SRC := $(é€šé…ç¬¦ $(SOURCE_DIR)/*.xml)
ALL_XML_OUT := $(è°ƒç”¨æºåˆ°è¾“å‡º,$(ALL_XML_SRC))

# html - ä¸ºæœ¬ä¹¦ç”Ÿæˆæ‰€éœ€çš„è¾“å‡ºæ ¼å¼ã€‚
.PHONYï¼šhtml
html: $(BOOK_HTML_OUT)

# show_html - ç”Ÿæˆ html æ–‡ä»¶å¹¶æ˜¾ç¤ºå®ƒã€‚
.PHONYï¼šshow_html
show_htmlï¼š$ï¼ˆBOOK_HTML_OUTï¼‰
        $(HTML_VIEWER) $(BOOK_HTML_OUT)

# $(BOOK_HTML_OUT) - ç”Ÿæˆ html æ–‡ä»¶ã€‚
$(BOOK_HTML_OUT): $(ALL_XML_OUT) $(OUTPUT_DIR)/éªŒè¯ Makefile

# %.html - ä»Ž xml è¾“å…¥ç”Ÿæˆ html è¾“å‡ºçš„æ¨¡å¼è§„åˆ™ã€‚
%.html: %.xml
        $(XMLTO) $(XMLTO_FLAGS) html-nochunks $&lt;</pre><pre class="programlisting"># Book output formats.
BOOK_XML_OUT     := $(OUTPUT_DIR)/book.xml
BOOK_HTML_OUT    := $(subst xml,html,$(BOOK_XML_OUT))
ALL_XML_SRC      := $(wildcard $(SOURCE_DIR)/*.xml)
ALL_XML_OUT      := $(call source-to-output,$(ALL_XML_SRC))

# html - Produce the desired output format for the book.
.PHONY: html
html: $(BOOK_HTML_OUT)

# show_html - Generate an html file and display it.
.PHONY: show_html
show_html: $(BOOK_HTML_OUT)
        $(HTML_VIEWER) $(BOOK_HTML_OUT)

# $(BOOK_HTML_OUT) - Generate the html file.
$(BOOK_HTML_OUT): $(ALL_XML_OUT) $(OUTPUT_DIR)/validate Makefile

# %.html - Pattern rule to produce html output from xml input.
%.html: %.xml
        $(XMLTO) $(XMLTO_FLAGS) html-nochunks $&lt;</pre><p>æ¨¡å¼è§„åˆ™å®Œæˆå°† XML æ–‡ä»¶è½¬æ¢ä¸º HTML æ–‡ä»¶çš„å¤§éƒ¨åˆ†å·¥ä½œã€‚è¿™æœ¬ä¹¦è¢«ç»„ç»‡ä¸ºä¸€ä¸ªé¡¶çº§æ–‡ä»¶<em class="filename">book.xml</em>ï¼Œå…¶ä¸­åŒ…æ‹¬æ¯ä¸€ç« ã€‚é¡¶çº§æ–‡ä»¶ç”± è¡¨ç¤º<code class="literal">BOOK_XML_OUT</code>ã€‚ HTML å¯¹åº”é¡¹æ˜¯
          <code class="literal">BOOK_HTML_OUT</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªç›®æ ‡ã€‚è¯¥<code class="literal">BOOK_HTML_OUT</code>æ–‡ä»¶å…·æœ‰å…¶åŒ…å«çš„ XML æ–‡ä»¶çš„å…ˆå†³æ¡ä»¶ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæœ‰ä¸¤ä¸ªè™šå‡ç›®æ ‡<code class="literal">html</code>å’Œ<code class="literal">show_html</code>ï¼Œåˆ†åˆ«åˆ›å»º HTML æ–‡ä»¶å¹¶å°†å…¶æ˜¾ç¤ºåœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ã€‚</p><p>The pattern rule does most of the work of converting an XML
          file into an HTML file. The book is organized as a single top-level
          file, <em class="filename">book.xml</em>, that includes
          each chapter. The top-level file is represented by <code class="literal">BOOK_XML_OUT</code>. The HTML counterpart is
          <code class="literal">BOOK_HTML_OUT</code>, which is a target.
          The <code class="literal">BOOK_HTML_OUT</code> file has its
          included XML files a prerequisites. For convenience, there are two
          phony targets, <code class="literal">html</code> and <code class="literal">show_html</code>, that create the HTML file and
          display it in the local browser, respectively.</p><p>è™½ç„¶åŽŸåˆ™ä¸Šå¾ˆç®€å•ï¼Œä½†ç”Ÿæˆ PDF å´è¦å¤æ‚å¾—å¤šã€‚<em class="command">xsltproc</em>ç¨‹åº
          èƒ½å¤Ÿç›´æŽ¥ç”Ÿæˆ PDFï¼Œä½†æˆ‘æ— æ³•è®©å®ƒå·¥ä½œã€‚æ‰€æœ‰è¿™äº›å·¥ä½œéƒ½æ˜¯åœ¨ Windows ä¸Šä½¿ç”¨ Cygwin å®Œæˆçš„ï¼Œ <em class="command">xsltproc</em>çš„ Cygwin ç‰ˆæœ¬éœ€è¦ POSIX è·¯å¾„ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯ DocBook çš„è‡ªå®šä¹‰ç‰ˆæœ¬ï¼Œæ‰‹ç¨¿æœ¬èº«åŒ…å« Windows ç‰¹å®šçš„è·¯å¾„ã€‚æˆ‘ç›¸ä¿¡ï¼Œè¿™ç§å·®å¼‚ä½¿<em class="command">xsltproc</em>æ„Ÿåˆ°æ— æ³•å¹³æ¯ã€‚ç›¸åï¼Œæˆ‘é€‰æ‹©ä½¿ç”¨<em class="command">xsltproc</em>ç”Ÿæˆ XML æ ¼å¼åŒ–å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ Java ç¨‹åº FOP ( <a class="ulink" href="http://xml.apache.org/fop">http://xml.apache.org/fop</a> ) ç”Ÿæˆ PDFã€‚</p><p>Although easy in principle, generating PDF was considerably
          more complex. The <em class="command">xsltproc</em>
          program is able to produce PDF directly, but I was unable to get it
          to work. All this work was done on Windows with Cygwin and the
          Cygwin version of <em class="command">xsltproc</em> wanted
          POSIX paths. The custom version of DocBook I was using and the
          manuscript itself contained Windows-specific paths. This difference,
          I believe, gave <em class="command">xsltproc</em> fits
          that I could not quell. Instead, I chose to use <em class="command">xsltproc</em> to generate XML formatting
          objects and the Java program FOP (<a class="ulink" href="http://xml.apache.org/fop">http://xml.apache.org/fop</a>) for generating the
          PDF.</p><p>å› æ­¤ï¼Œç”Ÿæˆ PDF çš„ä»£ç æœ‰ç‚¹é•¿ï¼š</p><p>Thus, the code to generate PDF is somewhat longer:</p><a id="OEBPS/ch11.html.I_6_tt471"></a><pre class="programlisting"># ä¹¦ç±è¾“å‡ºæ ¼å¼ã€‚
BOOK_XML_OUT := $(OUTPUT_DIR)/book.xml
BOOK_FO_OUT := $(subst xml,fo,$(BOOK_XML_OUT))
BOOK_PDF_OUT := $(subst xml,pdf,$(BOOK_XML_OUT))
ALL_XML_SRC := $(é€šé…ç¬¦ $(SOURCE_DIR)/*.xml)
ALL_XML_OUT := $(è°ƒç”¨æºåˆ°è¾“å‡º,$(ALL_XML_SRC))

# pdf - ä¸ºä¹¦ç±ç”Ÿæˆæ‰€éœ€çš„è¾“å‡ºæ ¼å¼ã€‚
.PHONYï¼špdf
pdfï¼š$(BOOK_PDF_OUT)

# show_pdf - ç”Ÿæˆ pdf æ–‡ä»¶å¹¶æ˜¾ç¤ºå®ƒã€‚
.PHONYï¼šshow_pdf
æ˜¾ç¤º_pdfï¼š$(BOOK_PDF_OUT)
        $(kill-acroread)
        $(PDF_VIEWER) $(BOOK_PDF_OUT)

# $(BOOK_PDF_OUT) - ç”Ÿæˆ pdf æ–‡ä»¶ã€‚
$(BOOK_PDF_OUT): $(BOOK_FO_OUT) ç”Ÿæˆæ–‡ä»¶

# $(BOOK_FO_OUT) - ç”Ÿæˆ fo ä¸­é—´è¾“å‡ºæ–‡ä»¶ã€‚
.INTERMEDIATEï¼š$(BOOK_FO_OUT)
$(BOOK_FO_OUT): $(ALL_XML_OUT) $(OUTPUT_DIR)/éªŒè¯ Makefile

# FOP æ”¯æŒ
FOP := org.apache.fop.apps.Fop

# DEBUG_FOP - å®šä¹‰å®ƒä»¥æŸ¥çœ‹ fop å¤„ç†å™¨è¾“å‡ºã€‚
ifndef è°ƒè¯•_FOP
  FOP_FLAGS := -q
  FOP_è¾“å‡ºï¼š= | $(SED) -e '/æœªå®žçŽ°/d' \
                         -e '/ç›¸å¯¹å¯¹é½/d' \
                         -e '/xsl-è„šæ³¨åˆ†éš”ç¬¦/d'
ä¸‡ä¸€

# CLASSPATH - ä¸º fop è®¡ç®—é€‚å½“çš„ CLASSPATHã€‚
å¯¼å‡ºç±»è·¯å¾„
ç±»è·¯å¾„ = $(patsubst %;,%, \
              $(subst ; ,;, \
                $(addprefix c:/usr/xslt-process-2.2/java/, \
                  $(æ·»åŠ åŽç¼€.jar;,\
                    å¤å…°\
                    xercesImpl \
                    èœ¡æŸ“\
                    ç¦æ™®\
                    å‰ç±³-1.0 \
                    Avalon-framework-cvs-20020315))))

# %.pdf - ä»Ž fo è¾“å…¥ç”Ÿæˆ pdf è¾“å‡ºçš„æ¨¡å¼è§„åˆ™ã€‚
%.pdf: %.fo
        $(kill-acroread)
        java -Xmx128M $(FOP) $(FOP_FLAGS) $&lt; $@ $(FOP_OUTPUT)

# %.fo - ä»Ž xml è¾“å…¥ç”Ÿæˆ fo è¾“å‡ºçš„æ¨¡å¼è§„åˆ™ã€‚
PAPER_SIZE := å­—æ¯
%.fo: %.xml
        XSLT_FLAGS="--stringparam paper.type $(PAPER_SIZE)" \
        $(XMLTO) $(XMLTO_FLAGS) fo $&lt;

# fop_help - æ˜¾ç¤º fop å¤„ç†å™¨å¸®åŠ©æ–‡æœ¬ã€‚
.PHONYï¼šfop_help
fop_å¸®åŠ©ï¼š
        -java org.apache.fop.apps.Fop -help
        -java org.apache.fop.apps.Fop -æ‰“å°å¸®åŠ©</pre><pre class="programlisting"># Book output formats.
BOOK_XML_OUT     := $(OUTPUT_DIR)/book.xml
BOOK_FO_OUT      := $(subst xml,fo,$(BOOK_XML_OUT))
BOOK_PDF_OUT     := $(subst xml,pdf,$(BOOK_XML_OUT))
ALL_XML_SRC      := $(wildcard $(SOURCE_DIR)/*.xml)
ALL_XML_OUT      := $(call source-to-output,$(ALL_XML_SRC))

# pdf - Produce the desired output format for the book.
.PHONY: pdf
pdf:  $(BOOK_PDF_OUT)

# show_pdf - Generate a pdf file and display it.
.PHONY: show_pdf
show_pdf: $(BOOK_PDF_OUT)
        $(kill-acroread)
        $(PDF_VIEWER) $(BOOK_PDF_OUT)

# $(BOOK_PDF_OUT) - Generate the pdf file.
$(BOOK_PDF_OUT): $(BOOK_FO_OUT) Makefile

# $(BOOK_FO_OUT) - Generate the fo intermediate output file.
.INTERMEDIATE: $(BOOK_FO_OUT)
$(BOOK_FO_OUT): $(ALL_XML_OUT) $(OUTPUT_DIR)/validate Makefile

# FOP Support
FOP := org.apache.fop.apps.Fop

# DEBUG_FOP - Define this to see fop processor output.
ifndef DEBUG_FOP
  FOP_FLAGS  := -q
  FOP_OUTPUT := | $(SED) -e '/not implemented/d'        \
                         -e '/relative-align/d'         \
                         -e '/xsl-footnote-separator/d'
endif

# CLASSPATH - Compute the appropriate CLASSPATH for fop.
export CLASSPATH
CLASSPATH = $(patsubst %;,%,                                    \
              $(subst ; ,;,                                     \
                $(addprefix c:/usr/xslt-process-2.2/java/,      \
                  $(addsuffix .jar;,                            \
                    xalan                                       \
                    xercesImpl                                  \
                    batik                                       \
                    fop                                         \
                    jimi-1.0                                    \
                    avalon-framework-cvs-20020315))))

# %.pdf - Pattern rule to produce pdf output from fo input.
%.pdf: %.fo
        $(kill-acroread)
        java -Xmx128M $(FOP) $(FOP_FLAGS) $&lt; $@ $(FOP_OUTPUT)

# %.fo - Pattern rule to produce fo output from xml input.
PAPER_SIZE := letter
%.fo: %.xml
        XSLT_FLAGS="--stringparam paper.type $(PAPER_SIZE)" \
        $(XMLTO) $(XMLTO_FLAGS) fo $&lt;

# fop_help - Display fop processor help text.
.PHONY: fop_help
fop_help:
        -java org.apache.fop.apps.Fop -help
        -java org.apache.fop.apps.Fop -print help</pre><p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼ŒçŽ°åœ¨æœ‰ä¸¤ä¸ªæ¨¡å¼è§„åˆ™åæ˜ äº†æˆ‘ä½¿ç”¨çš„ä¸¤é˜¶æ®µè¿‡ç¨‹ã€‚ .xml<em class="filename">åˆ°</em><em class="filename">.fo</em>è§„åˆ™è°ƒç”¨<em class="command">xmlto</em>ã€‚<em class="filename">.fo</em>åˆ°<em class="filename">.pdf</em>è§„åˆ™é¦–å…ˆç»ˆæ­¢æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ Acrobat é˜…è¯»å™¨ï¼ˆå› ä¸ºè¯¥ç¨‹åºé”å®š PDF æ–‡ä»¶ï¼Œé˜»æ­¢ FOP å†™å…¥è¯¥æ–‡ä»¶ï¼‰ï¼Œç„¶åŽè¿è¡Œ â€‹â€‹FOPã€‚ FOP æ˜¯ä¸€ä¸ªéžå¸¸å•°å—¦çš„ç¨‹åºï¼Œæ»šåŠ¨æµè§ˆæ•°ç™¾è¡Œæ¯«æ— æ„ä¹‰çš„è­¦å‘Šå¾ˆå¿«å°±ä¼šè¿‡æ—¶ï¼Œå› æ­¤æˆ‘æ·»åŠ äº†ä¸€ä¸ªç®€å•çš„<em class="command">sed</em>
          è¿‡æ»¤å™¨<code class="literal">FOP_OUTPUT</code>æ¥åˆ é™¤æ¼äººçš„è­¦å‘Šã€‚ç„¶è€Œï¼Œæœ‰æ—¶è¿™äº›è­¦å‘Šä¸­åŒ…å«ä¸€äº›çœŸå®žæ•°æ®ï¼Œå› æ­¤æˆ‘æ·»åŠ äº†ä¸€ä¸ªè°ƒè¯•åŠŸèƒ½<code class="literal">DEBUG_FOP</code>æ¥ç¦ç”¨æˆ‘çš„è¿‡æ»¤å™¨ã€‚æœ€åŽï¼Œä¸Ž HTML ç‰ˆæœ¬ä¸€æ ·ï¼Œæˆ‘æ·»åŠ äº†ä¸¤ä¸ªä¾¿åˆ©ç›®æ ‡<code class="literal">pdf</code>å’Œ<code class="literal">show_pdf</code>ï¼Œä»¥å¯åŠ¨æ•´ä¸ªè¿‡ç¨‹ã€‚</p><p>As you can see, there are now two pattern rules reflecting the
          two-stage process I used. The <em class="filename">.xml</em> to <em class="filename">.fo</em> rule invokes <em class="command">xmlto</em>. The <em class="filename">.fo</em> to <em class="filename">.pdf</em> rule first kills any running Acrobat
          reader (because the program locks the PDF file, preventing FOP from
          writing the file), then runs FOP. FOP is a very chatty program, and
          scrolling through hundreds of lines of pointless warnings got old
          fast, so I added a simple <em class="command">sed</em>
          filter, <code class="literal">FOP_OUTPUT</code>, to remove the
          irritating warnings. Occasionally, however, those warnings had some
          real data in them, so I added a debugging feature, <code class="literal">DEBUG_FOP</code>, to disable my filter. Finally,
          like the HTML version, I added two convenience targets, <code class="literal">pdf</code> and <code class="literal">show_pdf</code>, to kick the whole thing
          off.</p></div><div class="sect2" title="éªŒè¯æ¥æº"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch11.html.make3-CHP-11-SECT-1.4"></a>éªŒè¯æ¥æº</h2><h2 class="title"><a></a>Validating the Source</h2></div></div></div><p>DocBook å¯¹ä»€ä¹ˆè¿‡æ•<a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1564" class="indexterm"></a> <a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1565" class="indexterm"></a> <a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1566" class="indexterm"></a> <a id="OEBPS/ch11.html.make3-CHP-11-ITERM-1567" class="indexterm"></a>é€‰é¡¹å¡ã€å®å¤„ç†å™¨ã€åŒ…å«æ–‡ä»¶å’Œç¼–è¾‘å™¨çš„æ³¨é‡Šï¼Œç¡®ä¿æºæ–‡æœ¬æ­£ç¡®ä¸”å®Œæ•´å¹¶ä¸å®¹æ˜“ã€‚ä¸ºäº†æä¾›å¸®åŠ©ï¼Œæˆ‘å®žçŽ°äº†å››ä¸ªéªŒè¯ç›®æ ‡æ¥æ£€æŸ¥å„ç§å½¢å¼çš„æ­£ç¡®æ€§ã€‚</p><p>What with DocBook's allergy to <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>tabs, macro processors, include files and comments
          from editors, making sure the source text is correct and complete is
          not easy. To help, I implemented four validation targets that check
          for various forms of correctness.</p><a id="OEBPS/ch11.html.I_6_tt472"></a><pre class="programlisting">validation_checks := $(OUTPUT_DIR)/chk_macros_tabs \
                     $(OUTPUT_DIR)/chk_fixme \
                     $(OUTPUT_DIR)/chk_duplicate_macros \
                     $(OUTPUT_DIR)/chk_orphaned_examples

.PHONYï¼šä»…éªŒè¯
ä»…éªŒè¯ï¼š$(OUTPUT_DIR)/éªŒè¯
$(OUTPUT_DIR)/éªŒè¯ï¼š$(validation_checks)
        $ï¼ˆè§¦æ‘¸ï¼‰$@</pre><pre class="programlisting">validation_checks := $(OUTPUT_DIR)/chk_macros_tabs         \
                     $(OUTPUT_DIR)/chk_fixme               \
                     $(OUTPUT_DIR)/chk_duplicate_macros    \
                     $(OUTPUT_DIR)/chk_orphaned_examples

.PHONY: validate-only
validate-only: $(OUTPUT_DIR)/validate
$(OUTPUT_DIR)/validate: $(validation_checks)
        $(TOUCH) $@</pre><p>æ¯ä¸ªç›®æ ‡éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ—¶é—´æˆ³æ–‡ä»¶ï¼Œå®ƒä»¬éƒ½æ˜¯é¡¶çº§æ—¶é—´æˆ³æ–‡ä»¶<em class="filename">validate</em>çš„å…ˆå†³æ¡ä»¶ã€‚</p><p>Each target generates a timestamp file, and they are all
          prerequisites of a top-level timestamp file, <em class="filename">validate</em>.</p><a id="OEBPS/ch11.html.I_6_tt473"></a><pre class="programlisting">$(OUTPUT_DIR)/chk_macros_tabs: $(ALL_XML_OUT)
        # å¯»æ‰¾å®å’Œé€‰é¡¹å¡...
        $ï¼ˆå®‰é™ï¼‰ï¼ $(EGREP) --å¿½ç•¥å¤§å°å†™ \
                           - ç”µè¯å·ç  \
                           --regexp='\b(m4_|mp_)' \
                           --regexp='\011' \
                           $^
        $ï¼ˆè§¦æ‘¸ï¼‰$@</pre><pre class="programlisting">$(OUTPUT_DIR)/chk_macros_tabs: $(ALL_XML_OUT)
        # Looking for macros and tabs...
        $(QUIET)! $(EGREP) --ignore-case            \
                           --line-number            \
                           --regexp='\b(m4_|mp_)'   \
                           --regexp='\011'          \
                           $^
        $(TOUCH) $@</pre><p>ç¬¬ä¸€ä¸ªæ£€æŸ¥æŸ¥æ‰¾åœ¨é¢„å¤„ç†æœŸé—´æœªæ‰©å±•çš„<em class="command">m4</em>å®ã€‚è¿™è¡¨ç¤ºå®æ‹¼å†™é”™è¯¯æˆ–å®ä»Žæœªå®šä¹‰è¿‡ã€‚è¯¥æ£€æŸ¥è¿˜ä¼šæ‰«æåˆ¶è¡¨ç¬¦ã€‚å½“ç„¶ï¼Œè¿™ä¸¤ç§æƒ…å†µéƒ½ä¸åº”è¯¥å‘ç”Ÿï¼Œä½†å®ƒä»¬ç¡®å®žå‘ç”Ÿäº†ï¼å‘½ä»¤è„šæœ¬ä¸­ä¸€ä¸ªæœ‰è¶£çš„åœ°æ–¹æ˜¯ åŽé¢çš„æ„Ÿå¹å·<code class="literal">$(QUIET)</code>ã€‚ç›®çš„æ˜¯å–æ¶ˆ<em class="command">egrep</em>çš„é€€å‡ºçŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ
          å¦‚æžœ<em class="command">egrep</em><span class="emphasis"><em>ç¡®å®ž</em></span>æ‰¾åˆ°äº†å…¶ä¸­ä¸€ç§æ¨¡å¼ï¼Œé‚£ä¹ˆ<em class="command">make</em>åº”è¯¥è®¤ä¸ºè¯¥å‘½ä»¤å¤±è´¥ã€‚<em class="command"></em>
          <span class="emphasis"><em></em></span></p><p>This first check looks for <em class="command">m4</em> macros that were not expanded during
          preprocessing. This indicates either a misspelled macro or a macro
          that has never been defined. The check also scans for tab
          characters. Of course, neither of these situations should ever
          happen, but they did! One interesting bit in the command script is
          the exclamation point after <code class="literal">$(QUIET)</code>. The purpose is to negate the
          exit status of <em class="command">egrep</em>. That is,
          <em class="command">make</em> should consider the command
          a failure if <em class="command">egrep</em>
          <span class="emphasis"><em>does</em></span> find one of the patterns.</p><a id="OEBPS/ch11.html.I_6_tt474"></a><pre class="programlisting">$(OUTPUT_DIR)/chk_fixme: $(ALL_XML_OUT)
        # å¯»æ‰¾ RM: å’Œ FIXME...
        $ï¼ˆå®‰é™ï¼‰$ï¼ˆAWKï¼‰\
                '/FIXME/ { printf "%s:%s: %s\n", æ–‡ä»¶å, NR, $$0 } \
                 /^ *RM:/ { \
                           if ( $$0 !~ /RM: å®Œæˆ/ ) \
                           printf "%s:%s: %s\n", æ–‡ä»¶å, NR, $$0 \
                         }' $(subst $(OUTPUT_DIR)/,$(SOURCE_DIR)/,$^)
        $ï¼ˆè§¦æ‘¸ï¼‰$@</pre><pre class="programlisting">$(OUTPUT_DIR)/chk_fixme: $(ALL_XML_OUT)
        # Looking for RM: and FIXME...
        $(QUIET)$(AWK)                                                  \
                '/FIXME/ { printf "%s:%s: %s\n", FILENAME, NR, $$0 }    \
                 /^ *RM:/  {                                            \
                           if ( $$0 !~ /RM: Done/ )                     \
                           printf "%s:%s: %s\n", FILENAME, NR, $$0      \
                         }' $(subst $(OUTPUT_DIR)/,$(SOURCE_DIR)/,$^)
        $(TOUCH) $@</pre><p>è¿™å¼ æ”¯ç¥¨æ˜¯ä¸ºäº†ç»™æˆ‘è‡ªå·±ç•™ä¸‹æœªè§£å†³çš„ç¬”è®°ã€‚æ˜¾ç„¶ï¼Œä»»ä½•å¸¦æœ‰æ ‡ç­¾çš„æ–‡æœ¬éƒ½<code class="literal">FIXME</code>åº”è¯¥è¢«ä¿®å¤å¹¶åˆ é™¤æ ‡ç­¾ã€‚æ­¤å¤–ï¼Œä»»ä½•å‡ºçŽ°<code class="literal">RM</code>: ä¸”åŽé¢æ²¡æœ‰ç´§è·Ÿç€çš„ :
          çš„æƒ…å†µéƒ½<code class="literal">Done</code>åº”è¯¥è¢«æ ‡è®°ã€‚è¯·æ³¨æ„<em class="command">printf</em>å‡½æ•°çš„æ ¼å¼å¦‚ä½•
          éµå¾ªç¼–è¯‘å™¨é”™è¯¯çš„æ ‡å‡†æ ¼å¼ã€‚è¿™æ ·ï¼Œè¯†åˆ«ç¼–è¯‘å™¨é”™è¯¯çš„æ ‡å‡†å·¥å…·å°†æ­£ç¡®å¤„ç†è¿™äº›è­¦å‘Šã€‚</p><p>This check is for unresolved notes to myself. Obviously, any
          text labeled <code class="literal">FIXME</code> should be
          fixed and the label removed. In addition, any occurrence of <code class="literal">RM</code>: that is not followed immediately by
          <code class="literal">Done</code> should be flagged. Notice
          how the format of the <em class="command">printf</em>
          function follows the standard format for compiler errors. This way,
          standard tools that recognize compiler errors will properly process
          these warnings.</p><a id="OEBPS/ch11.html.I_6_tt475"></a><pre class="programlisting">$(OUTPUT_DIR)/chk_duplicate_macros: $(SOURCE_DIR)/macros.m4
        # å¯»æ‰¾é‡å¤çš„å®...
        $ï¼ˆå®‰é™ï¼‰ï¼ $(EGREP) --ä»…åŒ¹é… \
              "\[^]+'," $&lt; | \
        $ï¼ˆæŽ’åºï¼‰| \
        uniq-c| \
        $(AWK) '$$1 &gt; 1 { printf "$&gt;:0: %s\n", $$0 }' | \
        $(EGREP)â€œ^â€
        $ï¼ˆè§¦æ‘¸ï¼‰$@</pre><pre class="programlisting">$(OUTPUT_DIR)/chk_duplicate_macros: $(SOURCE_DIR)/macros.m4
        # Looking for duplicate macros...
        $(QUIET)! $(EGREP) --only-matching              \
              "\[^]+'," $&lt; |                            \
        $(SORT) |                                       \
        uniq -c |                                       \
        $(AWK) '$$1 &gt; 1 { printf "$&gt;:0: %s\n", $$0 }' | \
        $(EGREP) "^"
        $(TOUCH) $@</pre><p>è¿™ä¼šæ£€æŸ¥<em class="command">m4</em>å®æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨é‡å¤çš„å®å®šä¹‰ã€‚<em class="command">m4</em>å¤„ç†å™¨ä¸è®¤ä¸ºé‡å®šä¹‰æ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œæ‰€ä»¥æˆ‘æ·»åŠ äº†ä¸€ä¸ªç‰¹æ®Šçš„æ£€æŸ¥ã€‚ç®¡é“æ˜¯è¿™æ ·çš„ï¼šæŠ“å–æ¯ä¸ªå®ä¸­å®šä¹‰çš„ç¬¦å·ï¼ŒæŽ’åºï¼Œè®¡ç®—é‡å¤é¡¹ï¼Œè¿‡æ»¤æŽ‰è®¡æ•°ä¸º 1 çš„æ‰€æœ‰è¡Œï¼Œç„¶åŽæœ€åŽä¸€æ¬¡ä½¿ç”¨ e <em class="command">grep</em>çº¯ç²¹æ˜¯ä¸ºäº†å…¶é€€å‡ºçŠ¶æ€ã€‚å†æ¬¡æ³¨æ„ï¼Œä»…å½“å‘çŽ°æŸäº›å†…å®¹æ—¶ï¼Œé€€å‡ºçŠ¶æ€æ‰ä¼šäº§ç”Ÿ<em class="command">makeé”™è¯¯ã€‚</em></p><p>This checks for duplicate macro definitions in the <em class="command">m4</em> macro file. The <em class="command">m4</em> processor does not consider
          redefinition to be an error, so I added a special check. The
          pipeline goes like this: grab the defined symbol in each macro,
          sort, count duplicates, filter out all lines with a count of one,
          then use e<em class="command">grep</em> one last time
          purely for its exit status. Again, note the negation of the exit
          status to produce a <em class="command">make</em> error
          only when something is found.</p><a id="OEBPS/ch11.html.I_6_tt476"></a><pre class="programlisting">ALL_EXAMPLES := $(TMP)/all_examples

$(OUTPUT_DIR)/chk_orphaned_examples: $(ALL_EXAMPLES) $(DEPENDENCY_FILES)
        $(å®‰é™)$(AWK) -F/ '/(ç¤ºä¾‹|è¾“å‡º)_DIR/ { print $$3 }' \
                $(è¿‡æ»¤%.d,$^) | \
        $(æŽ’åº) -u | \
        é€šè®¯ -13 - $(è¿‡æ»¤æŽ‰ %.d,$^)
        $ï¼ˆè§¦æ‘¸ï¼‰$@

.INTERMEDIATEï¼š$(ALL_EXAMPLES)
$ï¼ˆæ‰€æœ‰ç¤ºä¾‹ï¼‰ï¼š
        # å¯»æ‰¾æœªä½¿ç”¨çš„ç¤ºä¾‹...
        $(å®‰é™) ls -p $(EXAMPLES_DIR) | \
        $(AWK) '/CVS/ { ä¸‹ä¸€ä¸ª } \
                /\// { print substr($$0, 1, é•¿åº¦ - 1) }' &gt; $@</pre><pre class="programlisting">ALL_EXAMPLES := $(TMP)/all_examples

$(OUTPUT_DIR)/chk_orphaned_examples: $(ALL_EXAMPLES) $(DEPENDENCY_FILES)
        $(QUIET)$(AWK) -F/ '/(EXAMPLES|OUTPUT)_DIR/ { print $$3 }' \
                $(filter %.d,$^) |                                 \
        $(SORT) -u |                                               \
        comm -13 - $(filter-out %.d,$^)
        $(TOUCH) $@

.INTERMEDIATE: $(ALL_EXAMPLES)
$(ALL_EXAMPLES):
        # Looking for unused examples...
        $(QUIET) ls -p $(EXAMPLES_DIR) |        \
        $(AWK) '/CVS/ { next }                  \
                /\//  { print substr($$0, 1, length - 1) }' &gt; $@</pre><p>æœ€ç»ˆæ£€æŸ¥ä¼šæŸ¥æ‰¾æ–‡æœ¬ä¸­æœªå¼•ç”¨çš„ç¤ºä¾‹ã€‚è¿™ä¸ªç›®æ ‡ä½¿ç”¨äº†ä¸€ä¸ªæœ‰è¶£çš„æŠ€å·§ã€‚å®ƒéœ€è¦ä¸¤ç»„è¾“å…¥æ–‡ä»¶ï¼šæ‰€æœ‰ç¤ºä¾‹ç›®å½•å’Œæ‰€æœ‰ XML ä¾èµ–æ–‡ä»¶ã€‚å…ˆå†³æ¡ä»¶åˆ—è¡¨ä½¿ç”¨<code class="function">filter</code>å’Œåˆ†ä¸ºè¿™ä¸¤ç»„
          <code class="function">filter-out</code>ã€‚ç¤ºä¾‹ç›®å½•åˆ—è¡¨æ˜¯é€šè¿‡ä½¿ç”¨<em class="command">ls</em> <code class="option">-p</code>ï¼ˆè¿™ä¼šå‘æ¯ä¸ªç›®å½•é™„åŠ æ–œæ ï¼‰å¹¶æ‰«ææ–œæ æ¥ç”Ÿæˆçš„ã€‚ç®¡é“é¦–å…ˆä»Žå…ˆå†³æ¡ä»¶åˆ—è¡¨ä¸­èŽ·å– XML ä¾èµ–é¡¹æ–‡ä»¶ï¼Œè¾“å‡ºåœ¨å…¶ä¸­æ‰¾åˆ°çš„ç¤ºä¾‹ç›®å½•ï¼Œå¹¶åˆ é™¤æ‰€æœ‰é‡å¤é¡¹ã€‚è¿™äº›æ˜¯æ–‡æœ¬ä¸­å®žé™…å¼•ç”¨çš„ç¤ºä¾‹ã€‚è¯¥åˆ—è¡¨è¢«æä¾›ç»™<em class="command">comm</em>çš„æ ‡å‡†è¾“å…¥ï¼Œè€Œæ‰€æœ‰å·²çŸ¥ç¤ºä¾‹ç›®å½•çš„åˆ—è¡¨è¢«ä½œä¸ºç¬¬äºŒä¸ªæ–‡ä»¶æä¾›ã€‚è¯¥<code class="option">-13</code>é€‰é¡¹æŒ‡ç¤º<em class="command">comm</em>åº”ä»…æ‰“å°ç¬¬äºŒåˆ—ä¸­æ‰¾åˆ°çš„è¡Œï¼ˆå³æœªä»Žä¾èµ–æ–‡ä»¶å¼•ç”¨çš„ç›®å½•ï¼‰ã€‚</p><p>The final check looks for examples that are not referenced in
          the text. This target uses a funny trick. It requires two sets of
          input files: all the example directories, and all the XML dependency
          files. The prerequisites list is separated into these two sets using
          <code class="function">filter</code> and <code class="function">filter-out</code>. The list of example
          directories is generated by using <em class="command">ls</em> <code class="option">-p</code> (this appends a
          slash to each directory) and scanning for slashes. The pipeline
          first grabs the XML dependency files from the prerequisite list,
          outputs the example directories it finds in them, and removes any
          duplicates. These are the examples actually referenced in the text.
          This list is fed to <em class="command">comm</em>'s
          standard input, while the list of all known example directories is
          fed as the second file. The <code class="option">-13</code> option indicates
          that <em class="command">comm</em> should print only lines
          found in column two (that is, directories that are not referenced
          from a dependency file).</p></div></div><div class="footnotes"><br><br><hr><div class="footnote"><p><sup>[ <a id="OEBPS/ch11.html.ftn.make3-CHP-11-FNOTE-1" href="#OEBPS/ch11.html.make3-CHP-11-FNOTE-1" class="para">1</a> ]</sup>æ¸…æ´è¿‡ç¨‹å˜å¾—å¤æ‚ã€‚ run <em class="filename">-run</em>å’Œ<em class="filename">run-make</em>è„šæœ¬é€šå¸¸ç”¨äºŽ<code class="literal">bash -x</code>å…è®¸å›žæ˜¾å®žé™…çš„<em class="command">make</em>å‘½ä»¤è¡Œã€‚è¯¥
              <code class="option">-x</code>é€‰é¡¹æ”¾åœ¨<code class="literal">++</code>è¾“å‡ºä¸­æ¯ä¸ªå‘½ä»¤ä¹‹å‰ï¼Œæ¸…ç†è„šæœ¬å°†å…¶è½¬æ¢ä¸º<code class="literal">$</code>è¡¨ç¤º shell æç¤ºç¬¦çš„ç®€å•å½¢å¼ã€‚ä½†æ˜¯ï¼Œå‘½ä»¤å¹¶ä¸æ˜¯è¾“å‡ºä¸­å‡ºçŽ°çš„å”¯ä¸€ä¿¡æ¯ã€‚å› ä¸º<em class="command">make</em>æ­£åœ¨è¿è¡Œè¯¥ç¤ºä¾‹å¹¶æœ€ç»ˆå¯åŠ¨å¦ä¸€ä¸ª<em class="command">make</em>ï¼Œæ‰€ä»¥ç®€å•çš„<em class="filename">makefile</em>åŒ…å«é¢å¤–çš„ã€ä¸éœ€è¦çš„è¾“å‡ºï¼Œä¾‹å¦‚ messages <code class="literal">Entering
              directory</code>ã€‚ ã€‚ ã€‚å’Œ<code class="literal">Leaving</code> <code class="literal">directory</code>ã€‚ ã€‚ ã€‚ä»¥åŠåœ¨æ¶ˆæ¯ä¸­æ˜¾ç¤º<em class="command">åˆ¶é€ </em>çº§åˆ«ç¼–å·ã€‚å¯¹äºŽä¸é€’å½’è°ƒç”¨<em class="command">make çš„ç®€å•</em><em class="filename">makefile ï¼Œæˆ‘ä»¬ä¼šåˆ é™¤æ­¤ä¸é€‚å½“çš„è¾“å‡ºï¼Œä»¥å‘ˆçŽ°</em><em class="command">make</em>çš„è¾“å‡ºï¼Œå°±å¥½åƒå®ƒæ˜¯ä»Žé¡¶çº§ shell è¿è¡Œä¸€æ ·ã€‚<em class="command"></em><em class="command"></em></p><p><sup>[<a href="#OEBPS/ch11.html.make3-CHP-11-FNOTE-1" class="para">1</a>] </sup>The cleaning process gets complex. The <em class="filename">run-run</em> and <em class="filename">run-make</em> scripts often use <code class="literal">bash -x</code> to allow the actual <em class="command">make</em> command line to be echoed. The
              <code class="option">-x</code> option puts <code class="literal">++</code> before each command in the output,
              which the cleaning script transforms into a simple <code class="literal">$</code> representing the shell prompt.
              However, commands are not the only information to appear in the
              output. Because <em class="command">make</em> is
              running the example and eventually starts another <em class="command">make</em>, simple <em class="filename">makefile</em>s include extra, unwanted
              output such as the messages <code class="literal">Entering
              directory</code> . . . and <code class="literal">Leaving</code> <code class="literal">directory</code> . . . as well as displaying
              a <em class="command">make</em> level number in
              messages. For simple <em class="filename">makefile</em>s that do not recursively
              invoke <em class="command">make</em>, we strip this
              inappropriate output to present the output of <em class="command">make</em> as if it were run from a
              top-level shell.</p></div><div class="footnote"><p><sup>[ <a id="OEBPS/ch11.html.ftn.make3-CHP-11-FNOTE-2" href="#OEBPS/ch11.html.make3-CHP-11-FNOTE-2" class="para">2</a> ]</sup>å‰ç¼€<code class="literal">mp</code>ä»£è¡¨ç®¡ç†é¡¹ç›®ï¼ˆä¹¦åï¼‰ã€å®å¤„ç†å™¨æˆ– make beautifulã€‚éšä½ æŒ‘é€‰ã€‚</p><p><sup>[<a href="#OEBPS/ch11.html.make3-CHP-11-FNOTE-2" class="para">2</a>] </sup>The <code class="literal">mp</code> prefix stands
              for Managing Projects (the book's title), macro processor, or
              make pretty. Take your pick.</p></div></div></div></div></div>
<div id="OEBPS/ch11s02.html"><div>
<div class="sect1" title="Linux å†…æ ¸ Makefile"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch11s02.html.make3-CHP-11-SECT-2"></a>Linux å†…æ ¸ Makefile</h1><h1 class="title"><a></a>The Linux Kernel Makefile</h1></div></div></div><p>Linux å†…æ ¸<em class="filename">makefile</em>
        æ˜¯ä¸€ä¸ª<a id="OEBPS/ch11s02.html.make3-CHP-11-ITERM-1568" class="indexterm"></a> <a id="OEBPS/ch11s02.html.make3-CHP-11-ITERM-1569" class="indexterm"></a>åœ¨å¤æ‚çš„æž„å»ºçŽ¯å¢ƒä¸­ä½¿ç”¨<em class="command">make</em>çš„ç»ä½³ç¤ºä¾‹ã€‚è™½ç„¶è§£é‡Š Linux å†…æ ¸æ˜¯å¦‚ä½•æž„é€ å’Œæž„å»ºçš„è¶…å‡ºäº†æœ¬ä¹¦çš„èŒƒå›´ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç ”ç©¶
        å†…æ ¸æž„å»ºç³»ç»Ÿæ‰€ä½¿ç”¨çš„<em class="command">make</em>çš„å‡ ä¸ªæœ‰è¶£çš„ç”¨æ³•ã€‚
        æœ‰å…³ 2.5/2.6 å†…æ ¸æž„å»ºè¿‡ç¨‹åŠå…¶ä»Ž 2.4 æ–¹æ³•çš„æ¼”å˜çš„æ›´å®Œæ•´è®¨è®ºï¼Œè¯·å‚é˜…<a class="ulink" href="http://archive.linuxsymposium.org/ols2003/Proceedings/All-Reprints/Reprint-Germaschewski-OLS2003.pdf">http://archive.linuxsymposium.org/ols2003/Proceedings/All-Reprints/Reprint-Germaschewski-OLS2003.pdf ã€‚</a></p><p>The Linux kernel <em class="filename">makefile</em>
        is an <a class="indexterm"></a> <a class="indexterm"></a>excellent example of using <em class="command">make</em> in a complex build environment. While
        it is beyond the scope of this book to explain how the Linux kernel is
        structured and built, we can examine several interesting uses of
        <em class="command">make</em> employed by the kernel build
        system. See <a class="ulink" href="http://archive.linuxsymposium.org/ols2003/Proceedings/All-Reprints/Reprint-Germaschewski-OLS2003.pdf">http://archive.linuxsymposium.org/ols2003/Proceedings/All-Reprints/Reprint-Germaschewski-OLS2003.pdf</a>
        for a more complete discussion of the 2.5/2.6 kernel build process and
        its evolution from the 2.4 approach.</p><p>ç”±äºŽ<em class="filename">makefile</em>æœ‰å¾ˆå¤šæ–¹é¢ï¼Œæˆ‘ä»¬å°†ä»…è®¨è®ºé€‚ç”¨äºŽå„ç§åº”ç”¨ç¨‹åºçš„å‡ ä¸ªåŠŸèƒ½ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨å•å­—æ¯
        <em class="command">make</em>å˜é‡æ¥æ¨¡æ‹Ÿå•å­—æ¯å‘½ä»¤è¡Œé€‰é¡¹ã€‚æˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä»¥å…è®¸ç”¨æˆ·ä»Žæºæ ‘è°ƒç”¨<em class="command">make</em>çš„æ–¹å¼åˆ†ç¦»æºæ ‘å’ŒäºŒå‰æ ‘
        ã€‚æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ£€æŸ¥<em class="filename">makefile</em>æŽ§åˆ¶è¾“å‡ºè¯¦ç»†ç¨‹åº¦çš„æ–¹å¼ã€‚ç„¶åŽæˆ‘ä»¬å°†å›žé¡¾æœ€æœ‰è¶£çš„ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼Œå¹¶äº†è§£å®ƒä»¬å¦‚ä½•å‡å°‘ä»£ç é‡å¤ã€æé«˜å¯è¯»æ€§å¹¶æä¾›å°è£…ã€‚æœ€åŽï¼Œæˆ‘ä»¬å°†äº†è§£<em class="filename">makefile</em>å®žçŽ°ç®€å•å¸®åŠ©å·¥å…·çš„æ–¹å¼ã€‚</p><p>Since the <em class="filename">makefile</em> has so
        many facets, we will discuss just a few features that are applicable
        to a variety of applications. First, we'll look at how single-letter
        <em class="command">make</em> variables are used to simulate
        single-letter command-line options. We'll see how the source and
        binary trees are separated in a way that allows users to invoke
        <em class="command">make</em> from the source tree. Next,
        we'll examine the way the <em class="filename">makefile</em> controls the verboseness of the
        output. Then we'll review the most interesting user-defined functions
        and see how they reduce code duplication, improve readability, and
        provide encapsulation. Finally, we'll look at the way the <em class="filename">makefile</em> implements a simple help
        facility.</p><p>Linux å†…æ ¸æž„å»ºéµå¾ªæˆ‘æœ€è‡ªç”±çš„è½¯ä»¶æ‰€ä½¿ç”¨çš„ç†Ÿæ‚‰çš„é…ç½®ã€æž„å»ºã€å®‰è£…æ¨¡å¼ã€‚è™½ç„¶è®¸å¤šå…è´¹å’Œå¼€æ”¾çš„è½¯ä»¶åŒ…ä½¿ç”¨å•ç‹¬çš„<em class="filename">é…ç½®è„šæœ¬ï¼ˆé€šå¸¸ç”±</em><em class="command">autoconf</em>æž„å»º
        ï¼‰ï¼Œä½† Linux å†…æ ¸
        <em class="filename">makefileä½¿ç”¨</em><em class="command">make</em>æ¥å®žçŽ°é…ç½®ï¼Œé—´æŽ¥è°ƒç”¨è„šæœ¬å’Œå¸®åŠ©ç¨‹åºã€‚</p><p>The Linux kernel build follows the familiar configure, build,
        install pattern used by my most free software. While many free and
        open software packages use a separate <em class="filename">configure</em> script (typically built by
        <em class="command">autoconf</em>), the Linux kernel
        <em class="filename">makefile</em> implements configuration
        with <em class="command">make</em>, invoking scripts and
        helper programs indirectly.</p><p>é…ç½®é˜¶æ®µå®ŒæˆåŽï¼Œç®€å•çš„<em class="command">make</em>æˆ–<em class="command">make </em> <em class="command">all</em>
        å°†æž„å»ºè£¸å†…æ ¸ã€æ‰€æœ‰æ¨¡å—ï¼Œå¹¶ç”ŸæˆåŽ‹ç¼©çš„å†…æ ¸æ˜ åƒï¼ˆåˆ†åˆ«æ˜¯<code class="literal">vmlinux</code>ã€<code class="literal">modules</code>å’Œ<code class="literal">bzImage</code>ç›®æ ‡ï¼‰ã€‚æ¯ä¸ªå†…æ ¸ç‰ˆæœ¬åœ¨é“¾æŽ¥åˆ°å†…æ ¸çš„æ–‡ä»¶<em class="filename">version.o</em>ä¸­éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç‰ˆæœ¬å·ã€‚è¯¥ç¼–å·ï¼ˆä»¥åŠ<em class="filename">version.oæ–‡ä»¶ï¼‰ç”±</em><em class="filename">makefile</em>æœ¬èº«æ›´æ–°
        ã€‚</p><p>When the configuration phase is complete, a simple <em class="command">make</em> or <em class="command">make</em> <em class="command">all</em>
        will build the bare kernel, all the modules, and produce a compressed
        kernel image (these are the <code class="literal">vmlinux</code>, <code class="literal">modules</code>, and <code class="literal">bzImage</code> targets, respectively). Each kernel
        build is given a unique version number in the file <em class="filename">version.o</em> linked into the kernel. This
        number (and the <em class="filename">version.o</em> file)
        are updated by the <em class="filename">makefile</em>
        itself.</p><p>æ‚¨å¯èƒ½å¸Œæœ›é€‚åº”è‡ªå·±çš„<em class="filename">makefile çš„</em>ä¸€äº›<em class="filename">makefile</em>åŠŸèƒ½åŒ…æ‹¬ï¼šå¤„ç†å‘½ä»¤è¡Œé€‰é¡¹ã€åˆ†æžå‘½ä»¤è¡Œç›®æ ‡ã€åœ¨æž„å»ºä¹‹é—´ä¿å­˜æž„å»ºçŠ¶æ€ä»¥åŠç®¡ç†<em class="command">make</em>çš„è¾“å‡ºã€‚<em class="filename"></em><em class="command"></em></p><p>Some <em class="filename">makefile</em> features you
        might want to adapt to your own <em class="filename">makefile</em> are: the handling of command line
        options, analyzing command-line goals, saving build status between
        builds, and managing the output of <em class="command">make</em>.</p><div class="sect2" title="å‘½ä»¤è¡Œé€‰é¡¹"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch11s02.html.make3-CHP-11-SECT-2.1"></a>å‘½ä»¤è¡Œé€‰é¡¹</h2><h2 class="title"><a></a>Command-Line Options</h2></div></div></div><p>ç¬¬ä¸€éƒ¨åˆ†<a id="OEBPS/ch11s02.html.make3-CHP-11-ITERM-1570" class="indexterm"></a> <a id="OEBPS/ch11s02.html.make3-CHP-11-ITERM-1571" class="indexterm"></a> <a id="OEBPS/ch11s02.html.make3-CHP-11-ITERM-1572" class="indexterm"></a><em class="filename">makefile</em>çš„
          åŒ…å«ç”¨äºŽä»Žå‘½ä»¤è¡Œè®¾ç½®å¸¸è§æž„å»ºé€‰é¡¹çš„ä»£ç ã€‚ä»¥ä¸‹æ˜¯æŽ§åˆ¶è¯¦ç»†æ ‡å¿—çš„æ‘˜å½•ï¼š</p><p>The first part <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>of the <em class="filename">makefile</em>
          contains code for setting common build options from the command
          line. Here is an excerpt that controls the verbose flag:</p><a id="OEBPS/ch11s02.html.I_6_tt477"></a><pre class="programlisting"># ä¸ºäº†æ›´åŠ å…³æ³¨è­¦å‘Šï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸è¦é‚£ä¹ˆå†—é•¿
# ä½¿ç”¨â€œmake V=1â€æŸ¥çœ‹å®Œæ•´å‘½ä»¤
å¦‚æžœå®šä¹‰V
  ifeq("$(origin V)","å‘½ä»¤è¡Œ")
    KBUILD_VERBOSE = $(V)
  ä¸‡ä¸€
ä¸‡ä¸€
ifndef KBUILD_VERBOSE
  KBUILD_VERBOSE = 0
ä¸‡ä¸€</pre><pre class="programlisting"># To put more focus on warnings, be less verbose as default
# Use 'make V=1' to see the full commands
ifdef V
  ifeq ("$(origin V)", "command line")
    KBUILD_VERBOSE = $(V)
  endif
endif
ifndef KBUILD_VERBOSE
  KBUILD_VERBOSE = 0
endif</pre><p>åµŒå¥—çš„<code class="literal">ifdef</code>/<code class="literal">ifeq</code>å¯¹ç¡®ä¿ä»…å½“åœ¨å‘½ä»¤è¡Œä¸Šè®¾ç½®<code class="literal">KBUILD_VERBOSE</code>æ—¶æ‰è®¾ç½®å˜é‡
          ã€‚çŽ¯å¢ƒæˆ–
          <em class="filename">makefile</em><code class="literal">V</code>ä¸­çš„è®¾ç½®æ²¡æœ‰æ•ˆæžœã€‚å¦‚æžœå°šæœªè®¾ç½®ï¼Œä»¥ä¸‹æ¡ä»¶å°†å…³é—­è¯¦ç»†é€‰é¡¹ã€‚è¦ä»ŽçŽ¯å¢ƒæˆ–<em class="filename">makefile</em>è®¾ç½®è¯¦ç»†é€‰é¡¹ï¼Œæ‚¨å¿…é¡»è®¾ç½®and not ã€‚<code class="literal">V</code><em class="filename"></em><code class="literal">ifndef</code><code class="literal">KBUILD_VERBOSE</code><em class="filename"></em><code class="literal">KBUILD_VERBOSE</code><code class="literal">V</code></p><p>The nested <code class="literal">ifdef</code>/<code class="literal">ifeq</code> pair ensures that the <code class="literal">KBUILD_VERBOSE</code> variable is set only if
          <code class="literal">V</code> is set on the command line.
          Setting <code class="literal">V</code> in the environment or
          <em class="filename">makefile</em> has no effect. The
          following <code class="literal">ifndef</code> conditional will
          then turn off the verbose option if <code class="literal">KBUILD_VERBOSE</code> has not yet been set. To
          set the verbose option from either the environment or <em class="filename">makefile</em>, you must set <code class="literal">KBUILD_VERBOSE</code> and not <code class="literal">V</code>.</p><p>ä½†è¯·æ³¨æ„ï¼Œ<code class="literal">KBUILD_VERBOSE</code>ç›´æŽ¥åœ¨å‘½ä»¤è¡Œä¸Šè¿›è¡Œè®¾ç½®æ˜¯å…è®¸çš„ï¼Œå¹¶ä¸”å¯ä»¥æŒ‰é¢„æœŸå·¥ä½œã€‚è¿™åœ¨ç¼–å†™ shell è„šæœ¬ï¼ˆæˆ–åˆ«åï¼‰æ¥è°ƒç”¨<em class="filename">makefile</em>æ—¶éžå¸¸æœ‰ç”¨ã€‚è¿™äº›è„šæœ¬å°†æ›´åŠ è‡ªè®°å½•ï¼Œç±»ä¼¼äºŽä½¿ç”¨<acronym class="acronym">GNU</acronym>é•¿é€‰é¡¹ã€‚</p><p>Notice, however, that setting <code class="literal">KBUILD_VERBOSE</code> directly on the command
          line is allowed and works as expected. This can be useful when
          writing shell scripts (or aliases) to invoke the <em class="filename">makefile</em>. These scripts would then be
          more self-documenting, similar to using <acronym class="acronym">GNU</acronym> long
          options.</p><p>å…¶ä»–å‘½ä»¤è¡Œé€‰é¡¹ï¼Œç¨€ç–æ£€æŸ¥ ( <code class="option">C</code>) å’Œå¤–éƒ¨æ¨¡å— ( <code class="option">M</code>)ï¼Œéƒ½ä½¿ç”¨ç›¸åŒçš„ä»”ç»†æ£€æŸ¥ä»¥é¿å…åœ¨<em class="filename">makefile</em>ä¸­æ„å¤–è®¾ç½®å®ƒä»¬ã€‚</p><p>The other command-line options, sparse checking
          (<code class="option">C</code>) and external modules (<code class="option">M</code>), both
          use the same careful checking to avoid accidentally setting them
          from within the <em class="filename">makefile</em>.</p><p><em class="filename">makefile</em>çš„ä¸‹ä¸€éƒ¨åˆ†å¤„ç†è¾“å‡ºç›®å½•é€‰é¡¹ ( <code class="option">O</code>)ã€‚è¿™æ˜¯ä¸€æ®µç›¸å½“å¤æ‚çš„ä»£ç ã€‚ä¸ºäº†çªå‡ºå…¶ç»“æž„ï¼Œæˆ‘ä»¬ç”¨çœç•¥å·æ›¿æ¢äº†æ­¤æ‘˜å½•çš„æŸäº›éƒ¨åˆ†ï¼š</p><p>The next section of the <em class="filename">makefile</em> handles the output directory
          option (<code class="option">O</code>). This is a fairly involved piece of
          code. To highlight its structure, we've replaced some parts of this
          excerpt with ellipses:</p><a id="OEBPS/ch11s02.html.I_6_tt478"></a><pre class="programlisting"># kbuild æ”¯æŒå°†è¾“å‡ºæ–‡ä»¶ä¿å­˜åœ¨å•ç‹¬çš„ç›®å½•ä¸­ã€‚
# è¦åœ¨å•ç‹¬çš„ç›®å½•ä¸­å®šä½è¾“å‡ºæ–‡ä»¶ï¼Œæ”¯æŒä¸¤ç§è¯­æ³•ã€‚
# åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œå·¥ä½œç›®å½•å¿…é¡»æ˜¯å†…æ ¸ src çš„æ ¹ç›®å½•ã€‚
# 1) O=
# ä½¿ç”¨â€œmake O=dir/to/store/output/files/â€
#
# 2) è®¾ç½® KBUILD_OUTPUT
# è®¾ç½®çŽ¯å¢ƒå˜é‡KBUILD_OUTPUTæŒ‡å‘è¯¥ç›®å½•
# è¾“å‡ºæ–‡ä»¶åº”æ”¾ç½®çš„ä½ç½®ã€‚
# å¯¼å‡º KBUILD_OUTPUT=dir/to/store/output/files/
ï¼ƒ åˆ¶ä½œ
#
# O= åˆ†é…ä¼˜å…ˆäºŽ KBUILD_OUTPUT çŽ¯å¢ƒå˜é‡ã€‚
# KBUILD_SRC åœ¨ OBJ ç›®å½•ä¸­è°ƒç”¨ make æ—¶è®¾ç½®
# KBUILD_SRC ä¸é€‚åˆæ™®é€šç”¨æˆ·ä½¿ç”¨ï¼ˆç›®å‰ï¼‰
ifeq ($(KBUILD_SRC),)

  # OKï¼Œåœ¨å†…æ ¸srcæ‰€åœ¨ç›®å½•ä¸­è°ƒç”¨Make
  # æˆ‘ä»¬æ˜¯å¦æƒ³å°†è¾“å‡ºæ–‡ä»¶æ”¾ç½®åœ¨å•ç‹¬çš„ç›®å½•ä¸­ï¼Ÿ
  å¦‚æžœå®šä¹‰O
    ifeq("$(åŽŸç‚¹O)","å‘½ä»¤è¡Œ")
      KBUILD_è¾“å‡º := $(O)
    ä¸‡ä¸€
  ä¸‡ä¸€
  ...
  ifneq ($(KBUILD_OUTPUT),)
    ...
    .PHONYï¼š$(MAKECMDGOALS)

    $ï¼ˆè¿‡æ»¤æŽ‰_allï¼Œ$ï¼ˆMAKECMDGOALSï¼‰ï¼‰_allï¼š
            $(if $(KBUILD_VERBOSE:1=),@)$(MAKE) -C $(KBUILD_OUTPUT) \
            KBUILD_SRC=$(CURDIR) KBUILD_VERBOSE=$(KBUILD_VERBOSE) \
            KBUILD_CHECK=$(KBUILD_CHECK) KBUILD_EXTMOD="$(KBUILD_EXTMOD)" \
            -f $(CURDIR)/Makefile $@
    # å°†å¤„ç†ç•™ç»™ä¸Šé¢çš„ make è°ƒç”¨
    è·³è¿‡ç”Ÿæˆæ–‡ä»¶ := 1
  endif # ifneq ($(KBUILD_OUTPUT),)
endif # ifeq ($(KBUILD_SRC),)

# å¦‚æžœè¿™æ˜¯ make çš„æœ€ç»ˆè°ƒç”¨ï¼Œæˆ‘ä»¬å°†å¤„ç† Makefile çš„å…¶ä½™éƒ¨åˆ†
ifeq ($(è·³è¿‡ makefile),)
  â€¦â€¦<em class="replaceable"><code>the rest of the makefile here</code></em>â€‹
endif # è·³è¿‡ makefile</pre><pre class="programlisting"># kbuild supports saving output files in a separate directory.
# To locate output files in a separate directory two syntax'es are supported.
# In both cases the working directory must be the root of the kernel src.
# 1) O=
# Use "make O=dir/to/store/output/files/"
#
# 2) Set KBUILD_OUTPUT
# Set the environment variable KBUILD_OUTPUT to point to the directory
# where the output files shall be placed.
# export KBUILD_OUTPUT=dir/to/store/output/files/
# make
#
# The O= assigment takes precedence over the KBUILD_OUTPUT environment variable.
# KBUILD_SRC is set on invocation of make in OBJ directory
# KBUILD_SRC is not intended to be used by the regular user (for now)
ifeq ($(KBUILD_SRC),)

  # OK, Make called in directory where kernel src resides
  # Do we want to locate output files in a separate directory?
  ifdef O
    ifeq ("$(origin O)", "command line")
      KBUILD_OUTPUT := $(O)
    endif
  endif
  ...
  ifneq ($(KBUILD_OUTPUT),)
    ...
    .PHONY: $(MAKECMDGOALS)

    $(filter-out _all,$(MAKECMDGOALS)) _all:
            $(if $(KBUILD_VERBOSE:1=),@)$(MAKE) -C $(KBUILD_OUTPUT)        \
            KBUILD_SRC=$(CURDIR)         KBUILD_VERBOSE=$(KBUILD_VERBOSE)  \
            KBUILD_CHECK=$(KBUILD_CHECK) KBUILD_EXTMOD="$(KBUILD_EXTMOD)"  \
            -f $(CURDIR)/Makefile $@
    # Leave processing to above invocation of make
    skip-makefile := 1
  endif # ifneq ($(KBUILD_OUTPUT),)
endif # ifeq ($(KBUILD_SRC),)

# We process the rest of the Makefile if this is the final invocation of make
ifeq ($(skip-makefile),)
  ...<em class="replaceable"><code>the rest of the makefile here</code></em>...
endif   # skip-makefile</pre><p>æœ¬è´¨ä¸Šï¼Œè¿™è¡¨ç¤ºå¦‚æžœ<code class="literal">KBUILD_OUTPUT</code>è®¾ç½®äº†ï¼Œåˆ™åœ¨ . å®šä¹‰çš„è¾“å‡ºç›®å½•ä¸­é€’å½’è°ƒç”¨<em class="command">make</em><code class="literal">KBUILD_OUTPUT</code>ã€‚è®¾ç½®
          ä¸ºæœ€åˆæ‰§è¡Œ<em class="command">make çš„</em><code class="literal">KBUILD_SRC</code>ç›®å½•
          ï¼Œå¹¶ä»Žé‚£é‡ŒèŽ·å–<em class="filename">makefile ã€‚ </em><em class="filename">make æ–‡ä»¶çš„</em>å…¶ä½™éƒ¨åˆ†å°†ä¸ä¼šè¢«<em class="command">make</em>
          çœ‹åˆ°ï¼Œå› ä¸º
          å°†è¢«è®¾ç½®ã€‚é€’å½’<em class="command">make</em>å°†å†æ¬¡é‡æ–°è¯»å–åŒä¸€ä¸ª<em class="filename">makefile</em>ï¼Œåªæœ‰è¿™ä¸€æ¬¡ä¼šè¢«è®¾ç½®ï¼Œå› æ­¤
          å°†æ˜¯æœªå®šä¹‰çš„ï¼Œå¹¶ä¸”<em class="filename">makefile</em>çš„å…¶ä½™éƒ¨åˆ†
          å°†è¢«è¯»å–å’Œå¤„ç†ã€‚<em class="command"></em><em class="filename"></em><em class="filename"></em><em class="command"></em><code class="literal">skip-makefile</code><em class="command"></em><em class="filename"></em><code class="literal">KBUILD_SRC</code><code class="literal">skip-makefile</code><em class="filename"></em></p><p>Essentially, this says that if <code class="literal">KBUILD_OUTPUT</code> is set, invoke <em class="command">make</em> recursively in the output directory
          defined by <code class="literal">KBUILD_OUTPUT</code>. Set
          <code class="literal">KBUILD_SRC</code> to the directory where
          <em class="command">make</em> was originally executed, and
          grab the <em class="filename">makefile</em> from there as
          well. The rest of the <em class="filename">makefile</em>
          will not be seen by <em class="command">make</em>, since
          <code class="literal">skip-makefile</code> will be set. The
          recursive <em class="command">make</em> will reread this
          same <em class="filename">makefile</em> again, only this
          time <code class="literal">KBUILD_SRC</code> will be set, so
          <code class="literal">skip-makefile</code> will be undefined,
          and the rest of the <em class="filename">makefile</em>
          will be read and processed.</p><p>å‘½ä»¤è¡Œé€‰é¡¹çš„å¤„ç†åˆ°æ­¤ç»“æŸã€‚<em class="filename">ç”Ÿæˆæ–‡ä»¶</em>çš„å¤§éƒ¨åˆ†å†…å®¹åœ¨æœ¬<code class="literal">ifeq ($(skip-makefile),)</code>
          èŠ‚ä¸­ã€‚</p><p>This concludes the processing of command-line options. The
          bulk of the <em class="filename">makefile</em> follows in
          the <code class="literal">ifeq ($(skip-makefile),)</code>
          section.</p></div><div class="sect2" title="é…ç½®ä¸Žæž„å»º"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch11s02.html.make3-CHP-11-SECT-2.2"></a>é…ç½®ä¸Žæž„å»º</h2><h2 class="title"><a></a>Configuration Versus Building</h2></div></div></div><p>makefile<em class="filename">åŒ…å«</em>é…ç½®<a id="OEBPS/ch11s02.html.make3-CHP-11-ITERM-1573" class="indexterm"></a> <a id="OEBPS/ch11s02.html.make3-CHP-11-ITERM-1574" class="indexterm"></a> <a id="OEBPS/ch11s02.html.make3-CHP-11-ITERM-1575" class="indexterm"></a> <a id="OEBPS/ch11s02.html.make3-CHP-11-ITERM-1576" class="indexterm"></a>ç›®æ ‡å’Œæž„å»ºç›®æ ‡ã€‚é…ç½®ç›®æ ‡çš„å½¢å¼ä¸º<code class="literal">menuconfig</code>ã€
          <code class="literal">defconfig</code>ç­‰ã€‚ç»´æŠ¤ç›®æ ‡<code class="literal">clean</code>ä¹Ÿè¢«è§†ä¸ºé…ç½®ç›®æ ‡ã€‚å…¶ä»–ç›®æ ‡ï¼ˆä¾‹å¦‚<code class="literal">all</code>ã€<code class="literal">vmlinux</code>å’Œ ï¼‰<code class="literal">modules</code>æ˜¯æž„å»ºç›®æ ‡ã€‚è°ƒç”¨é…ç½®ç›®æ ‡çš„ä¸»è¦ç»“æžœæ˜¯ä¸¤ä¸ªæ–‡ä»¶ï¼š<em class="filename">.config</em>å’Œ<em class="filename">.config.cmd</em>ã€‚è¿™ä¸¤ä¸ªæ–‡ä»¶åŒ…å«åœ¨æž„å»ºç›®æ ‡çš„<em class="filename">makefile</em>ä¸­ï¼Œä½†ä¸åŒ…å«åœ¨é…ç½®ç›®æ ‡ä¸­ï¼ˆå› ä¸ºé…ç½®ç›®æ ‡åˆ›å»ºäº†å®ƒä»¬ï¼‰ã€‚è¿˜å¯ä»¥åœ¨å•â€‹â€‹ä¸ª<em class="command">make</em>è°ƒç”¨ä¸­æ··åˆé…ç½®ç›®æ ‡å’Œæž„å»ºç›®æ ‡ï¼Œä¾‹å¦‚ï¼š</p><p>The <em class="filename">makefile</em> contains
          configuration <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>targets and build targets. The configuration targets
          have the form <code class="literal">menuconfig</code>,
          <code class="literal">defconfig</code>, etc. Maintenance
          targets like <code class="literal">clean</code> are treated as
          configuration targets as well. Other targets such as <code class="literal">all</code>, <code class="literal">vmlinux</code>, and <code class="literal">modules</code> are build targets. The primary
          result of invoking a configuration target is two files: <em class="filename">.config</em> and <em class="filename">.config.cmd</em>. These two files are included
          by the <em class="filename">makefile</em> for build
          targets but are not included for configuration targets (since the
          configuration target creates them). It is also possible to mix both
          configuration targets and build targets on a single <em class="command">make</em> invocation, such as:</p><a id="OEBPS/ch11s02.html.I_6_tt479"></a><pre class="programlisting">$ å…¨éƒ¨è®¾ç½®oldconfig</pre><pre class="programlisting">$ make oldconfig all</pre><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<em class="filename">makefile</em>ä¼šé€’å½’åœ°è°ƒç”¨è‡ªèº«æ¥å•ç‹¬å¤„ç†æ¯ä¸ªç›®æ ‡ï¼Œä»Žè€Œå°†é…ç½®ç›®æ ‡ä¸Žæž„å»ºç›®æ ‡åˆ†å¼€å¤„ç†ã€‚</p><p>In this case, the <em class="filename">makefile</em> invokes itself recursively
          handling each target individually, thus handling configuration
          targets separately from build targets.</p><p>æŽ§åˆ¶é…ç½®ã€æž„å»ºå’Œæ··åˆç›®æ ‡çš„ä»£ç å¼€å¤´ä¸ºï¼š</p><p>The code controlling configuration, build, and mixed targets
          begins with:</p><a id="OEBPS/ch11s02.html.I_6_tt480"></a><pre class="programlisting"># ç¡®ä¿æˆ‘ä»¬ä¸åŒ…å«ä»»ä½• *config ç›®æ ‡çš„ .config
# å°½æ—©æ•èŽ·å®ƒä»¬ï¼Œå¹¶å°†å®ƒä»¬äº¤ç»™scripts/kconfig/Makefile
# è°ƒç”¨makeæ—¶å…è®¸æŒ‡å®šæ›´å¤šç›®æ ‡ï¼ŒåŒ…æ‹¬
# æ··åˆ*é…ç½®ç›®æ ‡å’Œæž„å»ºç›®æ ‡ã€‚
# ä¾‹å¦‚'make oldconfig all'ã€‚
# æ£€æµ‹ä½•æ—¶æŒ‡å®šæ··åˆç›®æ ‡ï¼Œå¹¶è¿›è¡Œç¬¬äºŒæ¬¡è°ƒç”¨
# of make so .config ä¹Ÿä¸åŒ…å«åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ˆå¯¹äºŽ *configï¼‰ã€‚
no-dot-config-targets := clean mrproper distclean \
                         cscope TAGS æ ‡ç­¾å¸®åŠ©%docs check%

é…ç½®ç›®æ ‡ := 0
æ··åˆç›®æ ‡ := 0
ç‚¹é…ç½® := 1</pre><pre class="programlisting"># To make sure we do not include .config for any of the *config targets
# catch them early, and hand them over to scripts/kconfig/Makefile
# It is allowed to specify more targets when calling make, including
# mixing *config targets and build targets.
# For example 'make oldconfig all'.
# Detect when mixed targets is specified, and make a second invocation
# of make so .config is not included in this case either (for *config).
no-dot-config-targets := clean mrproper distclean \
                         cscope TAGS tags help %docs check%

config-targets := 0
mixed-targets  := 0
dot-config     := 1</pre><p>è¯¥å˜é‡<code class="literal">no-dot-config-targets</code>åˆ—å‡ºäº†ä¸éœ€è¦<em class="filename">.config</em>æ–‡ä»¶çš„å…¶ä»–ç›®æ ‡ã€‚ç„¶åŽä»£ç åˆå§‹åŒ–<code class="literal">config-targets</code>ã€<code class="literal">mixed-targets</code>å’Œ<code class="literal">dot-config</code>å˜é‡ã€‚<code class="literal">config-targets</code>å¦‚æžœå‘½ä»¤è¡Œä¸Šæœ‰ä»»ä½•é…ç½®ç›®æ ‡ï¼Œåˆ™è¯¥å˜é‡ä¸º 1ã€‚<code class="literal">dot-config</code>å¦‚æžœå‘½ä»¤è¡Œä¸Šæœ‰æž„å»ºç›®æ ‡ï¼Œåˆ™è¯¥å˜é‡ä¸º 1ã€‚æœ€åŽï¼Œ<code class="literal">mixed-targets</code>å¦‚æžœåŒæ—¶å­˜åœ¨é…ç½®å’Œæž„å»ºç›®æ ‡ï¼Œåˆ™ä¸º 1ã€‚</p><p>The variable <code class="literal">no-dot-config-targets</code> lists additional
          targets that do not require a <em class="filename">.config</em> file. The code then initializes
          the <code class="literal">config-targets</code>, <code class="literal">mixed-targets</code>, and <code class="literal">dot-config</code> variables. The <code class="literal">config-targets</code> variable is 1 if there are
          any configuration targets on the command line. The <code class="literal">dot-config</code> variable is 1 if there are
          build targets on the command line. Finally, <code class="literal">mixed-targets</code> is 1 if there are both
          configuration and build targets.</p><p>è¦è®¾ç½®çš„ä»£ç <code class="literal">dot-config</code>
          æ˜¯ï¼š</p><p>The code to set <code class="literal">dot-config</code>
          is:</p><a id="OEBPS/ch11s02.html.I_6_tt481"></a><pre class="programlisting">ifneq ($(è¿‡æ»¤å™¨ $(no-dot-config-targets), $(MAKECMDGOALS)),)
  ifeq ($(è¿‡æ»¤æŽ‰ $(no-dot-config-targets), $(MAKECMDGOALS)),)
    ç‚¹é…ç½® := 0
  ä¸‡ä¸€
ä¸‡ä¸€</pre><pre class="programlisting">ifneq ($(filter $(no-dot-config-targets), $(MAKECMDGOALS)),)
  ifeq ($(filter-out $(no-dot-config-targets), $(MAKECMDGOALS)),)
    dot-config := 0
  endif
endif</pre><p>å¦‚æžœ ä¸­å­˜åœ¨é…ç½®ç›®æ ‡ï¼Œåˆ™è¡¨è¾¾å¼<code class="function">filter</code>éžç©º<code class="literal">MAKECMDGOALS</code>ã€‚å¦‚æžœè¡¨è¾¾å¼ä¸ä¸ºç©ºï¼Œåˆ™è¯¥<code class="literal">ifneq</code>éƒ¨åˆ†ä¸º true ã€‚<code class="function">filter</code>è¯¥ä»£ç å¾ˆéš¾ç†è§£ï¼Œéƒ¨åˆ†åŽŸå› æ˜¯å®ƒåŒ…å«åŒé‡å¦å®šã€‚å¦‚æžœä»…åŒ…å«é…ç½®ç›®æ ‡ï¼Œåˆ™è¡¨è¾¾å¼
          <code class="literal">ifeq</code>ä¸º true
           ã€‚<code class="literal">MAKECMDGOALS</code>å› æ­¤ï¼Œ<code class="literal">dot-config</code>å¦‚æžœ .conf ä¸­æœ‰é…ç½®ç›®æ ‡å¹¶ä¸”åªæœ‰é…ç½®ç›®æ ‡ï¼Œåˆ™å°†è®¾ç½®ä¸º 0 <code class="literal">MAKECMDGOALS</code>ã€‚æ›´è¯¦ç»†çš„å®žçŽ°å¯èƒ½ä¼šä½¿è¿™ä¸¤ä¸ªæ¡ä»¶çš„å«ä¹‰æ›´åŠ æ¸…æ™°ï¼š</p><p>The <code class="function">filter</code> expression is
          non-empty if there are configuration targets in <code class="literal">MAKECMDGOALS</code>. The <code class="literal">ifneq</code> part is true if the <code class="function">filter</code> expression is not empty. The code
          is hard to follow partly because it contains a double negative. The
          <code class="literal">ifeq</code> expression is true if
          <code class="literal">MAKECMDGOALS</code> contains only
          configuration targets. So, <code class="literal">dot-config</code> will be set to 0 if there are
          configuration targets and only configuration targets in <code class="literal">MAKECMDGOALS</code>. A more verbose
          implementation might make the meaning of these two conditionals more
          clear:</p><a id="OEBPS/ch11s02.html.I_6_tt482"></a><pre class="programlisting">é…ç½®ç›®æ ‡åˆ—è¡¨ := clean mrproper distclean \
                         cscope TAGS æ ‡ç­¾å¸®åŠ©%docs check%

é…ç½®ç›®æ ‡ç›®æ ‡ := $(è¿‡æ»¤å™¨ $(é…ç½®ç›®æ ‡åˆ—è¡¨), $(MAKECMDGOALS))
æž„å»ºç›®æ ‡ç›®æ ‡ := $(è¿‡æ»¤å‡º $(config-target-list), $(MAKECMDGOALS))

ifdef é…ç½®ç›®æ ‡ç›®æ ‡
  ifndef æž„å»ºç›®æ ‡
    ç‚¹é…ç½® := 0
  ä¸‡ä¸€
ä¸‡ä¸€</pre><pre class="programlisting">config-target-list := clean mrproper distclean \
                         cscope TAGS tags help %docs check%

config-target-goal := $(filter $(config-target-list), $(MAKECMDGOALS))
build-target-goal := $(filter-out $(config-target-list), $(MAKECMDGOALS))

ifdef config-target-goal
  ifndef build-target-goal
    dot-config := 0
  endif
endif</pre><p>å¯ä»¥ä½¿ç”¨ çš„å½¢å¼<code class="literal">ifdef</code>ä»£æ›¿<code class="literal">ifneq</code>ï¼Œå› ä¸ºç©ºå˜é‡è¢«è§†ä¸ºæœªå®šä¹‰ï¼Œä½†å¿…é¡»æ³¨æ„ç¡®ä¿å˜é‡ä¸åªåŒ…å«ä¸€ä¸²ç©ºæ ¼ï¼ˆè¿™å°†å¯¼è‡´å®ƒè¢«å®šä¹‰ï¼‰ã€‚</p><p>The <code class="literal">ifdef</code> form can be used
          instead of <code class="literal">ifneq</code>, because empty
          variables are treated as undefined, but care must be taken to ensure
          a variable does not contain merely a string of blanks (which would
          cause it to be defined).</p><p><code class="literal">config-targets</code>å’Œ
          å˜é‡<code class="literal">mixed-targets</code>åœ¨ä¸‹ä¸€ä¸ªä»£ç å—ä¸­è®¾ç½®ï¼š</p><p>The <code class="literal">config-targets</code> and
          <code class="literal">mixed-targets</code> variables are set
          in the next code block:</p><a id="OEBPS/ch11s02.html.I_6_tt483"></a><pre class="programlisting">ifeq ($(KBUILD_EXTMOD),)
  ifneq ($(è¿‡æ»¤å™¨é…ç½®%config,$(MAKECMDGOALS)),)
    é…ç½®ç›®æ ‡ := 1
    ifneq ($(è¿‡æ»¤æŽ‰é…ç½®%config,$(MAKECMDGOALS)),)
      æ··åˆç›®æ ‡ := 1
    ä¸‡ä¸€
  ä¸‡ä¸€
ä¸‡ä¸€</pre><pre class="programlisting">ifeq ($(KBUILD_EXTMOD),)
  ifneq ($(filter config %config,$(MAKECMDGOALS)),)
    config-targets := 1
    ifneq ($(filter-out config %config,$(MAKECMDGOALS)),)
      mixed-targets := 1
    endif
  endif
endif</pre><p><code class="literal">KBUILD_EXTMOD</code>åœ¨æž„å»ºå¤–éƒ¨æ¨¡å—æ—¶å°†ä¸ºéžç©ºï¼Œä½†åœ¨æ­£å¸¸æž„å»ºæœŸé—´ä¸ä¼šã€‚å½“
          åŒ…å«å¸¦æœ‰åŽç¼€çš„ç›®æ ‡æ—¶ï¼Œç¬¬ä¸€ä¸ª<code class="literal">ifneq</code>
          ä¸ºçœŸ
          ã€‚å½“ä¹ŸåŒ…å«éžé…ç½®ç›®æ ‡æ—¶ï¼Œç¬¬äºŒä¸ªä¹Ÿæ˜¯å¦‚æ­¤ã€‚<code class="literal">MAKECMDGOALS</code><code class="literal">config</code><code class="literal">ifneq</code><code class="literal">MAKECMDGOALS</code></p><p><code class="literal">KBUILD_EXTMOD</code> will be
          non-empty when external modules are being built, but not during
          normal builds. The first <code class="literal">ifneq</code>
          will be true when <code class="literal">MAKECMDGOALS</code>
          contains a goal with the <code class="literal">config</code>
          suffix. The second <code class="literal">ifneq</code> will be
          true when <code class="literal">MAKECMDGOALS</code> contains
          nonconfig targets, too.</p><p>ä¸€æ—¦è®¾ç½®äº†å˜é‡ï¼Œå®ƒä»¬å°±ä¼šåœ¨å…·æœ‰å››ä¸ªåˆ†æ”¯çš„é“¾ä¸­<code class="function">if</code>ä½¿ç”¨<code class="literal">else</code>ã€‚è¯¥ä»£ç ç»è¿‡åŽ‹ç¼©å’Œç¼©è¿›ä»¥çªå‡ºå…¶ç»“æž„ï¼š</p><p>Once the variables are set, they are used in an <code class="function">if</code>-<code class="literal">else</code> chain with four branches. The code
          has been condensed and indented to highlight its structure:</p><a id="OEBPS/ch11s02.html.I_6_tt484"></a><pre class="programlisting">ifeq ($(æ··åˆç›®æ ‡),1)
  # æˆ‘ä»¬è¢«ç§°ä¸ºæ··åˆç›®æ ‡ï¼ˆ*é…ç½®å’Œæž„å»ºç›®æ ‡ï¼‰ã€‚
  # ä¸€ä¸€å¤„ç†ã€‚
  ï¼…ï¼šï¼š åŠ›é‡
        $(Q)$(MAKE) -C $(srctree) KBUILD_SRC= $@
åˆ«çš„
  ifeq ($(é…ç½®ç›®æ ‡),1)
    # *ä»…é…ç½®ç›®æ ‡ - ç¡®ä¿å…ˆå†³æ¡ä»¶å·²æ›´æ–°ï¼Œç„¶åŽä¸‹é™
    # åœ¨scripts/kconfig ä¸­åˆ›å»º*config ç›®æ ‡
    ï¼…configï¼šscripts_basic FORCE
            $(Q)$(MAKE) $(build)=è„šæœ¬/kconfig $@
  åˆ«çš„
    # ä»…æž„å»ºç›®æ ‡ - è¿™åŒ…æ‹¬ vmlinuxã€arch ç‰¹å®šç›®æ ‡ã€clean
    # ç›®æ ‡å’Œå…¶ä»–ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé™¤ *config ç›®æ ‡ä¹‹å¤–çš„æ‰€æœ‰ç›®æ ‡ã€‚
    ...
    ifeq ($(ç‚¹é…ç½®),1)
      # åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬éœ€è¦.config
      # è¯»å–æ‰€æœ‰ Kconfig* æ–‡ä»¶çš„ä¾èµ–å…³ç³»ï¼Œç¡®ä¿è¿è¡Œ
      # oldconfig å¦‚æžœæ£€æµ‹åˆ°æ›´æ”¹ã€‚
      -åŒ…æ‹¬.config.cmd
      åŒ…å«.config

      # å¦‚æžœ.configéœ€è¦æ›´æ–°ï¼Œå°†é€šè¿‡ä¾èµ–é¡¹å®Œæˆ
      # autoconf åœ¨ .config ä¸­ã€‚
      # ä¸ºäº†é¿å…å‡ºçŽ°ä»»ä½•éšå¼è§„åˆ™ï¼Œè¯·å®šä¹‰ä¸€ä¸ªç©ºå‘½ä»¤
      .config: ;

      # å¦‚æžœ .config æ¯” include/linux/autoconf.h æ–°ï¼Œæœ‰äººä¿®æ”¹äº†
      # ä½¿ç”¨å®ƒå¹¶å¿˜è®°è¿è¡Œ make oldconfig
      åŒ…å«/linux/autoconf.hï¼š.config
              $(Q)$(MAKE) -f $(srctree)/Makefilesilentoldconfig
    åˆ«çš„
      # éœ€è¦è™šæ‹Ÿç›®æ ‡ï¼Œå› ä¸ºç”¨ä½œå…ˆå†³æ¡ä»¶
      åŒ…æ‹¬/linux/autoconf.h: ;
    ä¸‡ä¸€

    åŒ…æ‹¬$(srctree)/arch/$(ARCH)/Makefile<em class="replaceable"><code>... lots more make code ...</code></em>
  endif #ifeq ($(é…ç½®ç›®æ ‡),1)
endif #ifeq ($(æ··åˆç›®æ ‡),1)</pre><pre class="programlisting">ifeq ($(mixed-targets),1)
  # We're called with mixed targets (*config and build targets).
  # Handle them one by one.
  %:: FORCE
        $(Q)$(MAKE) -C $(srctree) KBUILD_SRC= $@
else
  ifeq ($(config-targets),1)
    # *config targets only - make sure prerequisites are updated, and descend
    # in scripts/kconfig to make the *config target
    %config: scripts_basic FORCE
            $(Q)$(MAKE) $(build)=scripts/kconfig $@
  else
    # Build targets only - this includes vmlinux, arch specific targets, clean
    # targets and others. In general all targets except *config targets.
    ...
    ifeq ($(dot-config),1)
      # In this section, we need .config
      # Read in dependencies to all Kconfig* files, make sure to run
      # oldconfig if changes are detected.
      -include .config.cmd
      include .config

      # If .config needs to be updated, it will be done via the dependency
      # that autoconf has on .config.
      # To avoid any implicit rule to kick in, define an empty command
      .config: ;

      # If .config is newer than include/linux/autoconf.h, someone tinkered
      # with it and forgot to run make oldconfig
      include/linux/autoconf.h: .config
              $(Q)$(MAKE) -f $(srctree)/Makefile silentoldconfig
    else
      # Dummy target needed, because used as prerequisite
      include/linux/autoconf.h: ;
    endif

    include $(srctree)/arch/$(ARCH)/Makefile<em class="replaceable"><code>... lots more make code ...</code></em>
  endif #ifeq ($(config-targets),1)
endif #ifeq ($(mixed-targets),1)</pre><p>ç¬¬ä¸€ä¸ªåˆ†æ”¯<code class="literal">ifeq
          ($(mixed-targets),1)</code>å¤„ç†æ··åˆå‘½ä»¤è¡Œå‚æ•°ã€‚è¯¥åˆ†æ”¯ä¸­çš„å”¯ä¸€ç›®æ ‡æ˜¯å®Œå…¨é€šç”¨çš„æ¨¡å¼è§„åˆ™ã€‚ç”±äºŽæ²¡æœ‰å¤„ç†ç›®æ ‡çš„ç‰¹å®šè§„åˆ™ï¼ˆè¿™äº›è§„åˆ™ä½äºŽå¦ä¸€ä¸ªæ¡ä»¶åˆ†æ”¯ä¸­ï¼‰ï¼Œå› æ­¤æ¯ä¸ªç›®æ ‡éƒ½ä¼šè°ƒç”¨æ¨¡å¼è§„åˆ™ä¸€æ¬¡ã€‚è¿™å°±æ˜¯å…·æœ‰é…ç½®ç›®æ ‡å’Œæž„å»ºç›®æ ‡çš„å‘½ä»¤è¡Œè¢«åˆ†æˆæ›´ç®€å•çš„å‘½ä»¤è¡Œçš„æ–¹å¼ã€‚é€šç”¨æ¨¡å¼è§„åˆ™çš„å‘½ä»¤è„šæœ¬å¯¹æ¯ä¸ªç›®æ ‡é€’å½’è°ƒç”¨<em class="command">make</em>ï¼Œå¯¼è‡´åº”ç”¨ç›¸åŒçš„é€»è¾‘ï¼Œåªæ˜¯è¿™æ¬¡æ²¡æœ‰æ··åˆå‘½ä»¤è¡Œç›®æ ‡ã€‚ä½¿ç”¨å…ˆå†³<code class="literal">FORCE</code>æ¡ä»¶è€Œä¸æ˜¯
          <code class="literal">.PHONY</code>ï¼Œå› ä¸ºæ¨¡å¼è§„åˆ™å¦‚ä¸‹ï¼š</p><p>The first branch, <code class="literal">ifeq
          ($(mixed-targets),1)</code>, handles mixed command-line
          arguments. The only target in this branch is a completely generic
          pattern rule. Since there are no specific rules to handle targets
          (those rules are in another conditional branch), each target invokes
          the pattern rule once. This is how a command line with both
          configuration targets and build targets is separated into a simpler
          command line. The command script for the generic pattern rule
          invokes <em class="command">make</em> recursively for each
          target, causing this same logic to be applied, only this time with
          no mixed command-line targets. The <code class="literal">FORCE</code> prerequisite is used instead of
          <code class="literal">.PHONY</code>, because pattern rules
          like:</p><a id="OEBPS/ch11s02.html.I_6_tt485"></a><pre class="programlisting">ï¼…ï¼šï¼š åŠ›é‡</pre><pre class="programlisting">%:: FORCE</pre><p>ä¸èƒ½ç”³æŠ¥<code class="literal">.PHONY</code>ã€‚å› æ­¤ï¼Œåœ¨ä»»ä½•åœ°æ–¹ä¸€è‡´ä½¿ç”¨ä¼¼ä¹Žæ˜¯åˆç†çš„<code class="literal">FORCE</code>ã€‚</p><p>cannot be declared <code class="literal">.PHONY</code>.
          So it seems reasonable to use <code class="literal">FORCE</code> consistently everywhere.</p><p>å½“å‘½ä»¤è¡Œä¸Šåªæœ‰é…ç½®ç›®æ ‡æ—¶ï¼Œå°†è°ƒç”¨<code class="function">if</code>-<code class="literal">else</code>é“¾çš„ç¬¬äºŒä¸ªåˆ†æ”¯ã€‚<code class="literal">ifeq</code> <code class="literal">($(config-targets),1)</code>è¿™é‡Œåˆ†æ”¯ä¸­çš„ä¸»è¦ç›®æ ‡æ˜¯æ¨¡å¼è§„åˆ™<code class="literal">%config</code>ï¼ˆå…¶ä»–ç›®æ ‡å·²è¢«çœç•¥ï¼‰ã€‚å‘½ä»¤è„šæœ¬
          åœ¨<em class="filename">scripts/kconfigå­ç›®å½•ä¸­é€’å½’è°ƒç”¨</em><em class="command">make</em>å¹¶ä¼ é€’ç›®æ ‡ã€‚è¿™ä¸ªå¥‡æ€ªçš„æž„é€ æ˜¯åœ¨<em class="filename">makefile</em>çš„æœ«å°¾å®šä¹‰çš„ï¼š<em class="filename"></em><code class="literal">$(build)</code><em class="filename"></em></p><p>The second branch of the <code class="function">if</code>-<code class="literal">else</code> chain, <code class="literal">ifeq</code> <code class="literal">($(config-targets),1)</code>, is invoked when
          there are only configuration targets on the command line. Here the
          primary target in the branch is the pattern rule <code class="literal">%config</code> (other targets have been omitted).
          The command script invokes <em class="command">make</em>
          recursively in the <em class="filename">scripts/kconfig</em> subdirectory and passes
          along the target. The curious <code class="literal">$(build)</code> construct is defined at the end
          of the <em class="filename">makefile</em>:</p><a id="OEBPS/ch11s02.html.I_6_tt486"></a><pre class="programlisting"># $(Q)$(MAKE) -f scripts/Makefile.build obj=dir çš„ç®€å†™
ï¼ƒ ç”¨æ³•ï¼š
# $(Q)$(MAKE) $(build)=dir
æž„å»º := -f $(if $(KBUILD_SRC),$(srctree)/)scripts/Makefile.build obj</pre><pre class="programlisting"># Shorthand for $(Q)$(MAKE) -f scripts/Makefile.build obj=dir
# Usage:
# $(Q)$(MAKE) $(build)=dir
build := -f $(if $(KBUILD_SRC),$(srctree)/)scripts/Makefile.build obj</pre><p>å¦‚æžœ<code class="literal">KBUILD_SRC</code>è®¾ç½®ï¼Œåˆ™ä¸ºè¯¥
          <code class="option">-f</code>é€‰é¡¹æä¾›<em class="filename">è„šæœ¬</em> <em class="filename">makefile</em>çš„å®Œæ•´è·¯å¾„ï¼Œå¦åˆ™ä½¿ç”¨ç®€å•çš„ç›¸å¯¹è·¯å¾„ã€‚æŽ¥ä¸‹æ¥ï¼Œ<code class="literal">obj</code>
          å˜é‡è¢«è®¾ç½®åˆ°ç­‰å·çš„å³ä¾§ã€‚</p><p>If <code class="literal">KBUILD_SRC</code> is set, the
          <code class="option">-f</code> option is given a full path to the <em class="filename">scripts</em> <em class="filename">makefile</em>, otherwise a simple relative
          path is used. Next, the <code class="literal">obj</code>
          variable is set to the righthand side of the equals sign.</p><p>ç¬¬ä¸‰ä¸ªåˆ†æ”¯<code class="literal">ifeq</code>
          <code class="literal">($(dot-config),1)</code>å¤„ç†éœ€è¦åŒ…å«ä¸¤ä¸ªç”Ÿæˆçš„é…ç½®æ–‡ä»¶<em class="filename">.config</em>å’Œ<em class="filename">.config.cmd çš„</em>æž„å»ºç›®æ ‡ã€‚æœ€åŽä¸€ä¸ªåˆ†æ”¯ä»…åŒ…å«<em class="filename">autoconf.h</em>çš„è™šæ‹Ÿç›®æ ‡ï¼Œä»¥å…è®¸å°†å…¶ç”¨ä½œå…ˆå†³æ¡ä»¶ï¼Œå³ä½¿å®ƒä¸å­˜åœ¨ã€‚</p><p>The third branch, <code class="literal">ifeq</code>
          <code class="literal">($(dot-config),1)</code>, handles build
          targets that require including the two generated configuration
          files, <em class="filename">.config</em> and <em class="filename">.config.cmd</em>. The final branch merely
          includes a dummy target for <em class="filename">autoconf.h</em> to allow it to be used as a
          prerequisite, even if it doesn't exist.</p><p><em class="filename">makefile</em>çš„å…¶ä½™éƒ¨åˆ†å¤§éƒ¨åˆ†éµå¾ªç¬¬ä¸‰å’Œç¬¬å››åˆ†æ”¯ã€‚å®ƒåŒ…å«æž„å»ºå†…æ ¸å’Œæ¨¡å—çš„ä»£ç ã€‚</p><p>Most of the remainder of the <em class="filename">makefile</em> follows the third and fourth
          branches. It contains the code for building the kernel and
          modules.</p></div><div class="sect2" title="ç®¡ç†å‘½ä»¤å›žæ˜¾"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch11s02.html.make3-CHP-11-SECT-2.3"></a>ç®¡ç†å‘½ä»¤å›žæ˜¾</h2><h2 class="title"><a></a>Managing Command Echo</h2></div></div></div><p>å†…æ ¸<em class="filename">makefile</em>ä½¿ç”¨æ–°é¢–<a id="OEBPS/ch11s02.html.make3-CHP-11-ITERM-1577" class="indexterm"></a> <a id="OEBPS/ch11s02.html.make3-CHP-11-ITERM-1578" class="indexterm"></a>ç”¨äºŽç®¡ç†å‘½ä»¤å“åº”çš„è¯¦ç»†ç¨‹åº¦çš„æŠ€æœ¯ã€‚æ¯é¡¹é‡è¦ä»»åŠ¡éƒ½ä»¥è¯¦ç»†ç‰ˆæœ¬å’Œå®‰é™ç‰ˆæœ¬è¡¨ç¤ºã€‚è¯¦ç»†ç‰ˆæœ¬åªæ˜¯ä»¥å…¶è‡ªç„¶å½¢å¼æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¹¶å­˜å‚¨åœ¨åä¸º çš„å˜é‡ä¸­
          <code class="literal">cmd_</code>
          <em class="replaceable"><code>action</code></em>ã€‚ç®€çŸ­ç‰ˆæœ¬æ˜¯æè¿°æ“ä½œçš„çŸ­æ¶ˆæ¯ï¼Œå­˜å‚¨åœ¨åä¸º çš„å˜é‡ä¸­
          <code class="literal">quiet_cmd_</code>
          <em class="replaceable"><code>action</code></em>ã€‚ä¾‹å¦‚ï¼Œç”Ÿæˆ<em class="command">emacs</em>æ ‡ç­¾çš„å‘½ä»¤æ˜¯ï¼š</p><p>The kernel <em class="filename">makefile</em>s use
          a novel <a class="indexterm"></a> <a class="indexterm"></a>technique for managing the level of detail echoed by
          commands. Each significant task is represented in both a verbose and
          a quiet version. The verbose version is simply the command to be
          executed in its natural form and is stored in a variable named
          <code class="literal">cmd_</code>
          <em class="replaceable"><code>action</code></em>. The brief version is a short
          message describing the action and is stored in a variable named
          <code class="literal">quiet_cmd_</code>
          <em class="replaceable"><code>action</code></em>. For example, the command to
          produce <em class="command">emacs</em> tags is:</p><a id="OEBPS/ch11s02.html.I_6_tt487"></a><pre class="programlisting">Quiet_cmd_TAGS = åˆ¶ä½œ $@
      cmd_TAGS = $(æ‰€æœ‰æ¥æº) |ç”µå­æ ‡ç­¾-</pre><pre class="programlisting">quiet_cmd_TAGS = MAKE $@
      cmd_TAGS = $(all-sources) | etags -</pre><p>é€šè¿‡è°ƒç”¨å‡½æ•°æ¥æ‰§è¡Œå‘½ä»¤<code class="function">cmd</code>ï¼š</p><p>A command is executed by calling the <code class="function">cmd</code> function:</p><a id="OEBPS/ch11s02.html.I_6_tt488"></a><pre class="programlisting"># å¦‚æžœè®¾ç½®äº†å®‰é™ï¼Œåˆ™ä»…æ‰“å°å‘½ä»¤çš„ç®€çŸ­ç‰ˆæœ¬
cmd = @$(å¦‚æžœ$($(å®‰é™)cmd_$(1)),\
         echo ' $($(quiet)cmd_$(1))' &amp;&amp;) $(cmd_$(1))</pre><pre class="programlisting"># If quiet is set, only print short version of command
cmd = @$(if $($(quiet)cmd_$(1)),\
         echo '  $($(quiet)cmd_$(1))' &amp;&amp;) $(cmd_$(1))</pre><p><em class="command">è¦è°ƒç”¨æž„å»ºemacs</em>æ ‡ç­¾çš„ä»£ç ï¼Œ<em class="filename">makefile</em>å°†åŒ…å«ï¼š</p><p>To invoke the code for building <em class="command">emacs</em> tags, the <em class="filename">makefile</em> would contain:</p><a id="OEBPS/ch11s02.html.I_6_tt489"></a><pre class="programlisting">æ ‡ç­¾ï¼š
        $(è°ƒç”¨cmd,æ ‡ç­¾)</pre><pre class="programlisting">TAGS:
        $(call cmd,TAGS)</pre><p>è¯·æ³¨æ„ï¼Œè¯¥<code class="function">cmd</code>å‡½æ•°ä»¥ å¼€å¤´<code class="literal">@</code>ï¼Œå› æ­¤è¯¥å‡½æ•°å›žæ˜¾çš„å”¯ä¸€æ–‡æœ¬æ˜¯æ¥è‡ª<em class="command">echo</em>å‘½ä»¤çš„æ–‡æœ¬ã€‚åœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œå˜é‡
          ä¸ºç©ºï¼Œå¹¶ä¸” , ,<code class="literal">quiet</code>ä¸­çš„æµ‹è¯•æ‰©å±•ä¸ºã€‚ç”±äºŽè¯¥å˜é‡ä¸ä¸ºç©ºï¼Œå› æ­¤æ•´ä¸ªå‡½æ•°æ‰©å±•ä¸ºï¼š<code class="function">if</code><code class="literal">$($(quiet)cmd_$(1))</code><code class="literal">$(cmd_TAGS)</code></p><p>Notice the <code class="function">cmd</code> function
          begins with an <code class="literal">@</code>, so the only
          text echoed by the function is text from the <em class="command">echo</em> command. In normal mode, the variable
          <code class="literal">quiet</code> is empty, and the test in
          the <code class="function">if</code>, <code class="literal">$($(quiet)cmd_$(1))</code>, expands to <code class="literal">$(cmd_TAGS)</code>. Since this variable is not
          empty, the entire function expands to:</p><a id="OEBPS/ch11s02.html.I_6_tt490"></a><pre class="programlisting">echo ' $(æ‰€æœ‰æ¥æº) | etags -' &amp;&amp; $(æ‰€æœ‰æ¥æº) |ç”µå­æ ‡ç­¾-</pre><pre class="programlisting">echo '  $(all-sources) | etags -' &amp;&amp; $(all-sources) | etags -</pre><p>å¦‚æžœéœ€è¦å®‰é™ç‰ˆæœ¬ï¼Œå˜é‡<code class="literal">quiet</code>åŒ…å«å€¼<code class="literal">quiet_</code>å¹¶ä¸”å‡½æ•°æ‰©å±•ä¸ºï¼š</p><p>If the quiet version is desired, the variable <code class="literal">quiet</code> contains the value <code class="literal">quiet_</code> and the function expands to:</p><a id="OEBPS/ch11s02.html.I_6_tt491"></a><pre class="programlisting">echo ' MAKE $@' &amp;&amp; $(æ‰€æœ‰æ¥æº) |ç”µå­æ ‡ç­¾-</pre><pre class="programlisting">echo '  MAKE $@' &amp;&amp; $(all-sources) | etags -</pre><p>è¯¥å˜é‡ä¹Ÿå¯ä»¥è®¾ç½®ä¸º<code class="literal">silent_</code>ã€‚ç”±äºŽæ²¡æœ‰ command
           <code class="literal">silent_cmd_TAGS</code>ï¼Œè¯¥å€¼å¯¼è‡´<code class="function">cmd</code>å‡½æ•°æ ¹æœ¬ä¸å›žæ˜¾ä»»ä½•å†…å®¹ã€‚</p><p>The variable can also be set to <code class="literal">silent_</code>. Since there is no command
          <code class="literal">silent_cmd_TAGS</code>, this value
          causes the <code class="function">cmd</code> function to echo
          nothing at all.</p><p>å›žæ˜¾å‘½ä»¤æœ‰æ—¶ä¼šå˜å¾—æ›´åŠ å¤æ‚ï¼Œç‰¹åˆ«æ˜¯å½“å‘½ä»¤åŒ…å«å•å¼•å·æ—¶ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œ
           <em class="filename">makefile</em>åŒ…å«ä»¥ä¸‹ä»£ç ï¼š</p><p>Echoing the command sometimes becomes more complex,
          particularly if commands contain single quotes. In these cases, the
          <em class="filename">makefile</em> contains this
          code:</p><a id="OEBPS/ch11s02.html.I_6_tt492"></a><pre class="programlisting">$(if $($(quiet)cmd_$(1)),echo ' $(subst ','\'',$($(quiet)cmd_$(1)))';)</pre><pre class="programlisting">$(if $($(quiet)cmd_$(1)),echo '  $(subst ','\'',$($(quiet)cmd_$(1)))';)</pre><p>è¿™é‡Œçš„<em class="command">echo</em>å‘½ä»¤åŒ…å«ä¸€ä¸ªæ›¿æ¢ï¼Œç”¨è½¬ä¹‰çš„å•å¼•å·æ›¿æ¢å•å¼•å·ï¼Œä»¥å…è®¸å®ƒä»¬æ­£ç¡®åœ°å›žæ˜¾ã€‚</p><p>Here the <em class="command">echo</em> command
          contains a substitution that replaces single quotes with escaped
          single quotes to allow them to be properly echoed.</p><p>ä¸ä¿è¯ç¼–å†™éº»çƒ¦çš„æ¬¡è¦å‘½ä»¤
          <code class="literal">cmd_</code>å’Œ<code class="literal">quiet_cmd_</code>å˜é‡ä»¥ ä¸ºå‰ç¼€
          <code class="literal">$(Q)</code>ï¼Œå…¶ä¸­ä¸åŒ…å«ä»»ä½•å†…å®¹æˆ–<code class="literal">@</code>ï¼š</p><p>Minor commands that do not warrant the trouble of writing
          <code class="literal">cmd_</code> and <code class="literal">quiet_cmd_</code> variables are prefixed with
          <code class="literal">$(Q)</code>, which contains either
          nothing or <code class="literal">@</code>:</p><a id="OEBPS/ch11s02.html.I_6_tt493"></a><pre class="programlisting">ifeq ($(KBUILD_VERBOSE),1)
  å®‰é™=
  Q=
åˆ«çš„
  å®‰é™=å®‰é™_
  é—®=@
ä¸‡ä¸€

# å¦‚æžœç”¨æˆ·æ­£åœ¨è¿è¡Œ make -s ï¼ˆé™é»˜æ¨¡å¼ï¼‰ï¼Œåˆ™æŠ‘åˆ¶å›žæ˜¾
# å‘½ä»¤

ifneq ($(findstring s,$(MAKEFLAGS)),)
  å®‰é™=å®‰é™_
ä¸‡ä¸€</pre><pre class="programlisting">ifeq ($(KBUILD_VERBOSE),1)
  quiet =
  Q =
else
  quiet=quiet_
  Q = @
endif

# If the user is running make -s (silent mode), suppress echoing of
# commands

ifneq ($(findstring s,$(MAKEFLAGS)),)
  quiet=silent_
endif</pre></div><div class="sect2" title="ç”¨æˆ·å®šä¹‰å‡½æ•°"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch11s02.html.make3-CHP-11-SECT-2.4"></a>ç”¨æˆ·å®šä¹‰å‡½æ•°</h2><h2 class="title"><a></a>User-Defined Functions</h2></div></div></div><p>å†…æ ¸<em class="filename">makefile</em>
          å®šä¹‰äº†ä¸€ä¸ª<a id="OEBPS/ch11s02.html.make3-CHP-11-ITERM-1579" class="indexterm"></a> <a id="OEBPS/ch11s02.html.make3-CHP-11-ITERM-1580" class="indexterm"></a> <a id="OEBPS/ch11s02.html.make3-CHP-11-ITERM-1581" class="indexterm"></a> <a id="OEBPS/ch11s02.html.make3-CHP-11-ITERM-1582" class="indexterm"></a>åŠŸèƒ½æ•°é‡ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä»‹ç»æœ€æœ‰è¶£çš„ã€‚ä»£ç å·²é‡æ–°æ ¼å¼åŒ–ä»¥æé«˜å¯è¯»æ€§ã€‚</p><p>The kernel <em class="filename">makefile</em>
          defines a <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>number of functions. Here we cover the most
          interesting ones. The code has been reformatted to improve
          readability.</p><p>è¯¥<code class="function">check_gcc</code>å‡½æ•°ç”¨äºŽé€‰æ‹©<em class="command">gcc</em>å‘½ä»¤è¡Œé€‰é¡¹ã€‚</p><p>The <code class="function">check_gcc</code> function is
          used to select a <em class="command">gcc</em> command-line
          option.</p><a id="OEBPS/ch11s02.html.I_6_tt494"></a><pre class="programlisting"># $(è°ƒç”¨ check_gcc,é¦–é€‰é€‰é¡¹,å¤‡ç”¨é€‰é¡¹)
æ£€æŸ¥_gcc = \
    $(shell if $(CC) $(CFLAGS) $(1) -S -o /dev/null \
               -xc /dev/null &gt; /dev/null 2&gt;&amp;1; \
            ç„¶åŽ \
              å›žæ˜¾â€œ$ï¼ˆ1ï¼‰â€ï¼› \
            åˆ«çš„ \
              å›žæ˜¾â€œ$ï¼ˆ2ï¼‰â€ï¼› \
            è² ;)</pre><pre class="programlisting"># $(call check_gcc,preferred-option,alternate-option)
check_gcc =                                         \
    $(shell if $(CC) $(CFLAGS) $(1) -S -o /dev/null \
               -xc /dev/null &gt; /dev/null 2&gt;&amp;1;      \
            then                                    \
              echo "$(1)";                          \
            else                                    \
              echo "$(2)";                          \
            fi ;)</pre><p>è¯¥å‡½æ•°çš„å·¥ä½œåŽŸç†æ˜¯ä½¿ç”¨é¦–é€‰å‘½ä»¤è¡Œé€‰é¡¹åœ¨ç©ºè¾“å…¥æ–‡ä»¶ä¸Šè°ƒç”¨<em class="command">gcc</em> ã€‚è¾“å‡ºæ–‡ä»¶ã€æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯æ–‡ä»¶å°†è¢«ä¸¢å¼ƒã€‚å¦‚æžœ<em class="command">gcc</em>å‘½ä»¤æˆåŠŸï¼Œåˆ™æ„å‘³ç€é¦–é€‰å‘½ä»¤è¡Œé€‰é¡¹å¯¹æ­¤ä½“ç³»ç»“æž„æœ‰æ•ˆï¼Œå¹¶ç”±å‡½æ•°è¿”å›žã€‚å¦åˆ™ï¼Œè¯¥é€‰é¡¹æ— æ•ˆå¹¶è¿”å›žå¤‡ç”¨é€‰é¡¹ã€‚å¯ä»¥åœ¨<em class="filename">arch/i386/Makefile</em>ä¸­æ‰¾åˆ°ç¤ºä¾‹ä½¿ç”¨
          ï¼š</p><p>The function works by invoking <em class="command">gcc</em> on a null input file with the
          preferred command-line option. The output file, standard output, and
          standard error files are discarded. If the <em class="command">gcc</em> command succeeds, it means the
          preferred command-line option is valid for this architecture and is
          returned by the function. Otherwise, the option is invalid and the
          alternate option is returned. An example use can be found in
          <em class="filename">arch/i386/Makefile</em>:</p><a id="OEBPS/ch11s02.html.I_6_tt495"></a><pre class="programlisting"># é˜²æ­¢ gcc ä¿æŒå †æ ˆ 16 å­—èŠ‚å¯¹é½
CFLAGS += $(è°ƒç”¨ check_gcc,-mpreferred-stack-boundary=2,)</pre><pre class="programlisting"># prevent gcc from keeping the stack 16 byte aligned
CFLAGS += $(call check_gcc,-mpreferred-stack-boundary=2,)</pre><p>è¯¥<code class="function">if_changed_dep</code>
          å‡½æ•°ä½¿ç”¨ä¸€ç§å‡ºè‰²çš„æŠ€æœ¯ç”Ÿæˆä¾èµ–æ€§ä¿¡æ¯ã€‚</p><p>The <code class="function">if_changed_dep</code>
          function generates dependency information using a remarkable
          technique.</p><a id="OEBPS/ch11s02.html.I_6_tt496"></a><pre class="programlisting"># æ‰§è¡Œå‘½ä»¤å¹¶è¿›è¡ŒåŽå¤„ç†ç”Ÿæˆ
# .d ä¾èµ–æ–‡ä»¶
if_changed_dep = \
    $(å¦‚æžœ\
      $(åŽ»æŽ‰$?\
        $(è¿‡æ»¤æŽ‰ FORCE $(é€šé…ç¬¦ $^),$^) \
        $(è¿‡æ»¤æŽ‰$(cmd_$(1)),$(cmd_$@)) \
        $(è¿‡æ»¤æŽ‰$(cmd_$@),$(cmd_$(1)))), \
      @è®¾ç½®-eï¼› \
      $(å¦‚æžœ$($(å®‰é™)cmd_$(1)), \
        echo ' $(subst ','\'',$($(quiet)cmd_$(1)))';) \
      $(cmd_$(1)); \
      è„šæœ¬/åŸºæœ¬/fixdep \
         $(depfile) \
         $@\
         '$(subst $$,$$$$,$(subst ','\'',$(cmd_$(1))))' \
         &gt; $(@D)/.$(@F).tmp; \
      rm -f $(depfile); \
      mv -f $(@D)/.$(@F).tmp $(@D)/.$(@F).cmd)</pre><pre class="programlisting"># execute the command and also postprocess generated
# .d dependencies file
if_changed_dep =                                        \
    $(if                                                \
      $(strip $?                                        \
        $(filter-out FORCE $(wildcard $^),$^)           \
        $(filter-out $(cmd_$(1)),$(cmd_$@))             \
        $(filter-out $(cmd_$@),$(cmd_$(1)))),           \
      @set -e;                                          \
      $(if $($(quiet)cmd_$(1)),                         \
        echo '  $(subst ','\'',$($(quiet)cmd_$(1)))';)  \
      $(cmd_$(1));                                      \
      scripts/basic/fixdep                              \
         $(depfile)                                     \
         $@                                             \
         '$(subst $$,$$$$,$(subst ','\'',$(cmd_$(1))))' \
         &gt; $(@D)/.$(@F).tmp;                            \
      rm -f $(depfile);                                 \
      mv -f $(@D)/.$(@F).tmp $(@D)/.$(@F).cmd)</pre><p>è¯¥å‡½æ•°ç”±ä¸€ä¸ª<code class="function">if</code>å­å¥ç»„æˆã€‚æµ‹è¯•çš„ç»†èŠ‚ç›¸å½“æ¨¡ç³Šï¼Œä½†å¾ˆæ˜Žæ˜¾ï¼Œå¦‚æžœåº”è¯¥é‡æ–°ç”Ÿæˆä¾èµ–æ–‡ä»¶ï¼Œåˆ™å…¶æ„å›¾æ˜¯éžç©ºã€‚æ­£å¸¸çš„ä¾èµ–ä¿¡æ¯ä¸Žæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´æˆ³æœ‰å…³ã€‚å†…æ ¸æž„å»ºç³»ç»Ÿç»™è¿™ä¸ªä»»åŠ¡å¢žåŠ äº†å¦ä¸€ä¸ªéš¾é¢˜ã€‚å†…æ ¸æž„å»ºä½¿ç”¨å¤šç§ç¼–è¯‘å™¨é€‰é¡¹æ¥æŽ§åˆ¶ç»„ä»¶çš„æž„é€ å’Œè¡Œä¸ºã€‚ä¸ºäº†ç¡®ä¿åœ¨æž„å»ºè¿‡ç¨‹ä¸­æ­£ç¡®è€ƒè™‘å‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®žçŽ°äº†<em class="filename">makefile</em>ï¼Œä»¥ä¾¿å¦‚æžœç”¨äºŽç‰¹å®šç›®æ ‡çš„å‘½ä»¤è¡Œé€‰é¡¹å‘ç”Ÿæ›´æ”¹ï¼Œåˆ™é‡æ–°ç¼–è¯‘è¯¥æ–‡ä»¶ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯å¦‚ä½•å®žçŽ°çš„ã€‚</p><p>The function consists of a single <code class="function">if</code> clause. The details of the test are
          pretty obscure, but it is clear the intent is to be non-empty if the
          dependency file should be regenerated. Normal dependency information
          is concerned with the modification timestamps on files. The kernel
          build system adds another wrinkle to this task. The kernel build
          uses a wide variety of compiler options to control the construction
          and behavior of components. To ensure that command-line options are
          properly accounted for during a build, the <em class="filename">makefile</em> is implemented so that if
          command-line options used for a particular target change, the file
          is recompiled. Let's see how this is accomplished.</p><p>æœ¬è´¨ä¸Šï¼Œç”¨äºŽç¼–è¯‘å†…æ ¸ä¸­æ¯ä¸ªæ–‡ä»¶çš„å‘½ä»¤éƒ½ä¿å­˜åœ¨<em class="filename">.cmd</em>æ–‡ä»¶ä¸­ã€‚å½“æ‰§è¡ŒåŽç»­æž„å»ºæ—¶ï¼Œ<em class="command">make</em>ä¼šè¯»å–<em class="filename">.cmd</em>æ–‡ä»¶å¹¶å°†å½“å‰ç¼–è¯‘å‘½ä»¤ä¸Žæœ€åŽä¸€ä¸ªå‘½ä»¤è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æžœå®ƒä»¬ä¸åŒï¼Œåˆ™
          é‡æ–°ç”Ÿæˆ<em class="filename">.cmd</em>ä¾èµ–æ–‡ä»¶ï¼Œä»Žè€Œå¯¼è‡´é‡å»ºç›®æ ‡æ–‡ä»¶ã€‚<em class="filename">.cmd</em>æ–‡ä»¶é€šå¸¸åŒ…å«ä¸¤é¡¹ï¼šè¡¨ç¤ºç›®æ ‡æ–‡ä»¶çš„å®žé™…æ–‡ä»¶çš„ä¾èµ–é¡¹å’Œè®°å½•å‘½ä»¤è¡Œé€‰é¡¹çš„å•ä¸ªå˜é‡ã€‚ä¾‹å¦‚ï¼Œæ–‡ä»¶<em class="filename">arch/i386/kernel/cpu/mtrr/if.c</em>ç”Ÿæˆä»¥ä¸‹ï¼ˆç¼©å†™ï¼‰æ–‡ä»¶ï¼š</p><p>In essence, the command used to compile each file in the
          kernel is saved in a <em class="filename">.cmd</em> file.
          When a subsequent build is executed, <em class="command">make</em> reads the <em class="filename">.cmd</em> files and compares the current
          compile command with the last command. If they are different, the
          <em class="filename">.cmd</em> dependency file is
          regenerated causing the object file to be rebuilt. The <em class="filename">.cmd</em> file usually contains two items: the
          dependencies that represent actual files for the target file and a
          single variable recording the command-line options. For example, the
          file <em class="filename">arch/i386/kernel/cpu/mtrr/if.c</em> yields
          this (abbreviated) file:</p><a id="OEBPS/ch11s02.html.I_6_tt497"></a><pre class="programlisting">cmd_arch/i386/kernel/cpu/mtrr/if.o := gcc -Wp,-MD ...;å¦‚æžœc

deps_arch/i386/kernel/cpu/mtrr/if.o := \
  æ‹±é—¨/i386/å†…æ ¸/cpu/mtrr/if.c \
  ...

æ‹±é—¨/i386/å†…æ ¸/cpu/mtrr/if.o: $(deps_arch/i386/kernel/cpu/mtrr/if.o)
$(deps_arch/i386/kernel/cpu/mtrr/if.o):</pre><pre class="programlisting">cmd_arch/i386/kernel/cpu/mtrr/if.o := gcc -Wp,-MD ...; if.c

deps_arch/i386/kernel/cpu/mtrr/if.o := \
  arch/i386/kernel/cpu/mtrr/if.c \
  ...

arch/i386/kernel/cpu/mtrr/if.o: $(deps_arch/i386/kernel/cpu/mtrr/if.o)
$(deps_arch/i386/kernel/cpu/mtrr/if.o):</pre><p>å›žåˆ°<code class="function">if_changed_dep</code>å‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°<code class="function">strip</code>åªæ˜¯æ¯”ç›®æ ‡æ›´æ–°çš„å…ˆå†³æ¡ä»¶ï¼ˆå¦‚æžœæœ‰ï¼‰ã€‚ç¬¬äºŒä¸ªå‚æ•°<code class="function">strip</code>æ˜¯é™¤ files å’Œç©º target ä¹‹å¤–çš„æ‰€æœ‰å…ˆå†³æ¡ä»¶<code class="literal">FORCE</code>ã€‚çœŸæ­£æ™¦æ¶©çš„éƒ¨åˆ†æ˜¯æœ€åŽä¸¤ä¸ª<code class="function">filter-out</code>è°ƒç”¨ï¼š</p><p>Getting back to the <code class="function">if_changed_dep</code> function, the first
          argument to the <code class="function">strip</code> is simply
          the prerequisites that are newer than the target, if any. The second
          argument to <code class="function">strip</code> is all the
          prerequisites other than files and the empty target <code class="literal">FORCE</code>. The really obscure bit is the last
          two <code class="function">filter-out</code> calls:</p><a id="OEBPS/ch11s02.html.I_6_tt498"></a><pre class="programlisting">$(è¿‡æ»¤æŽ‰$(cmd_$(1)),$(cmd_$@))
$(è¿‡æ»¤æŽ‰$(cmd_$@),$(cmd_$(1)))</pre><pre class="programlisting">$(filter-out $(cmd_$(1)),$(cmd_$@))
$(filter-out $(cmd_$@),$(cmd_$(1)))</pre><p>å¦‚æžœå‘½ä»¤è¡Œé€‰é¡¹å·²æ›´æ”¹ï¼Œåˆ™è¿™äº›è°ƒç”¨ä¸­çš„ä¸€ä¸ªæˆ–ä¸¤ä¸ªå°†æ‰©å±•ä¸ºéžç©ºå­—ç¬¦ä¸²ã€‚å®<code class="literal">$(cmd_$(1))</code>æ˜¯å½“å‰å‘½ä»¤ï¼Œä¹Ÿ
          <code class="literal">$(cmd_$@)</code>å°†æ˜¯ä¸Šä¸€ä¸ªå‘½ä»¤ï¼Œä¾‹å¦‚<code class="literal">cmd_arch/i386/kernel/cpu/mtrr/if.o</code>åˆšåˆšæ˜¾ç¤ºçš„å˜é‡ã€‚å¦‚æžœæ–°å‘½ä»¤åŒ…å«å…¶ä»–é€‰é¡¹ï¼Œç¬¬ä¸€ä¸ª
          <code class="function">filter-out</code>å°†ä¸ºç©ºï¼Œç¬¬äºŒä¸ªå°†æ‰©å±•åˆ°æ–°é€‰é¡¹ã€‚å¦‚æžœæ–°å‘½ä»¤åŒ…å«çš„é€‰é¡¹è¾ƒå°‘ï¼Œåˆ™ç¬¬ä¸€ä¸ªå‘½ä»¤å°†åŒ…å«å·²åˆ é™¤çš„é€‰é¡¹ï¼Œç¬¬äºŒä¸ªå‘½ä»¤å°†ä¸ºç©ºã€‚æœ‰è¶£çš„æ˜¯ï¼Œç”±äºŽ<code class="function">filter-out</code>æŽ¥å—å•è¯åˆ—è¡¨ï¼ˆæ¯ä¸ªå•è¯è¢«è§†ä¸ºç‹¬ç«‹æ¨¡å¼ï¼‰ï¼Œå› æ­¤é€‰é¡¹çš„é¡ºåºå¯ä»¥æ›´æ”¹ï¼Œå¹¶ä¸”<code class="function">filter-out</code>ä»ç„¶å¯ä»¥å‡†ç¡®åœ°è¯†åˆ«æ·»åŠ æˆ–åˆ é™¤çš„é€‰é¡¹ã€‚ç›¸å½“æ¼‚äº®ã€‚</p><p>One or both of these calls will expand to a non-empty string
          if the command-line options have changed. The macro <code class="literal">$(cmd_$(1))</code> is the current command and
          <code class="literal">$(cmd_$@)</code> will be the previous
          command, for instance the variable <code class="literal">cmd_arch/i386/kernel/cpu/mtrr/if.o</code> just
          shown. If the new command contains additional options, the first
          <code class="function">filter-out</code> will be empty, and
          the second will expand to the new options. If the new command
          contains fewer options, the first command will contain the deleted
          options and the second will be empty. Interestingly, since <code class="function">filter-out</code> accepts a list of words (each
          treated as an independent pattern), the order of options can change
          and the <code class="function">filter-out</code> will still
          accurately identify added or removed options. Pretty nifty.</p><p>å‘½ä»¤è„šæœ¬ä¸­çš„ç¬¬ä¸€æ¡è¯­å¥è®¾ç½® shell é€‰é¡¹ä»¥åœ¨å‡ºé”™æ—¶ç«‹å³é€€å‡ºã€‚è¿™å¯ä»¥é˜²æ­¢å¤šè¡Œè„šæœ¬åœ¨å‡ºçŽ°é—®é¢˜æ—¶æŸåæ–‡ä»¶ã€‚å¯¹äºŽç®€å•çš„è„šæœ¬ï¼Œå®žçŽ°æ­¤æ•ˆæžœçš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨åˆ†å·
          <code class="literal">&amp;&amp;</code>è€Œä¸æ˜¯è¿žæŽ¥è¯­å¥ã€‚</p><p>The first statement in the command script sets a shell option
          to exit immediately on error. This prevents the multiline script
          from corrupting files in the event of problems. For simple scripts
          another way to achieve this effect is to connect statements with
          <code class="literal">&amp;&amp;</code> rather than
          semicolons.</p><p>ä¸‹ä¸€æ¡è¯­å¥æ˜¯ä½¿ç”¨æœ¬ç« å‰é¢<a class="link" href="#OEBPS/ch11s02.html.make3-CHP-11-SECT-2.3" title="ç®¡ç†å‘½ä»¤å›žæ˜¾">ç¬¬ 11.2.3 èŠ‚</a>ä¸­æè¿°çš„æŠ€æœ¯ç¼–å†™çš„<em class="command">echo</em>å‘½ä»¤ï¼ŒåŽé¢æ˜¯ä¾èµ–é¡¹ç”Ÿæˆå‘½ä»¤æœ¬èº«ã€‚è¯¥å‘½ä»¤å†™å…¥ï¼Œç„¶åŽç”±
          <em class="command">script/basic/fixdep</em>è¿›è¡Œè½¬æ¢ã€‚<em class="command">fixdep</em>å‘½ä»¤è¡Œä¸­çš„åµŒå¥—
          å‡½æ•°é¦–å…ˆè½¬ä¹‰å•å¼•å·ï¼Œç„¶åŽè½¬ä¹‰(shell è¯­æ³•ä¸­çš„å½“å‰è¿›ç¨‹å·) çš„å‡ºçŽ°ã€‚<a class="link" href="#OEBPS/ch11s02.html.make3-CHP-11-SECT-2.3" title="ç®¡ç†å‘½ä»¤å›žæ˜¾"></a><code class="literal">$(depfile)</code><em class="command"></em><code class="function">subst</code><em class="command"></em><code class="literal">$$</code></p><p>The next statement is an <em class="command">echo</em> command written using the techniques
          described in <a class="link" href="#OEBPS/ch11s02.html.make3-CHP-11-SECT-2.3" title="Managing Command Echo">Section
          11.2.3</a> earlier in this chapter, followed by the dependency
          generating command itself. The command writes <code class="literal">$(depfile)</code>, which is then transformed by
          <em class="command">scripts/basic/fixdep</em>. The nested
          <code class="function">subst</code> function in the <em class="command">fixdep</em> command line first escapes single
          quotes, then escapes occurrences of <code class="literal">$$</code> (the current process number in shell
          syntax).</p><p>æœ€åŽï¼Œå¦‚æžœæ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼Œåˆ™
          <code class="literal">$(depfile)</code>åˆ é™¤ä¸­é—´æ–‡ä»¶ï¼Œå¹¶å°†ç”Ÿæˆçš„ä¾èµ–æ–‡ä»¶ï¼ˆå¸¦æœ‰<em class="filename">.cmd</em>åŽç¼€ï¼‰ç§»åŠ¨åˆ°ä½ã€‚</p><p>Finally, if no errors have occurred, the intermediate file
          <code class="literal">$(depfile)</code> is removed and the
          generated dependency file (with its <em class="filename">.cmd</em> suffix) is moved into place.</p><p>ä¸‹ä¸€ä¸ªå‡½æ•°<code class="function">if_changed_rule</code>ï¼Œä½¿ç”¨ç›¸åŒçš„æ¯”è¾ƒæŠ€æœ¯æ¥<code class="function">if_changed_dep</code>æŽ§åˆ¶å‘½ä»¤çš„æ‰§è¡Œï¼š</p><p>The next function, <code class="function">if_changed_rule</code>, uses the same comparison
          technique as <code class="function">if_changed_dep</code> to
          control the execution of a command:</p><a id="OEBPS/ch11s02.html.I_6_tt499"></a><pre class="programlisting"># ç”¨æ³•ï¼š$(call if_changed_rule,foo)
# å°†æ£€æŸ¥ $(cmd_foo) æ˜¯å¦æ›´æ”¹ï¼Œæˆ–è€…ä»»ä½•å…ˆå†³æ¡ä»¶æ˜¯å¦æ›´æ”¹ï¼Œ
# å¦‚æžœæ˜¯çš„è¯å°†æ‰§è¡Œ $(rule_foo)

if_changed_rule = \
    $(å¦‚æžœ$(å‰¥ç¦»$?\
           $(è¿‡æ»¤æŽ‰$(cmd_$(1)),$(cmd_$(@F))) \
           $(è¿‡æ»¤æŽ‰$(cmd_$(@F)),$(cmd_$(1)))), \
      @$(è§„åˆ™_$(1)))</pre><pre class="programlisting"># Usage: $(call if_changed_rule,foo)
# will check if $(cmd_foo) changed, or any of the prequisites changed,
# and if so will execute $(rule_foo)

if_changed_rule =                                   \
    $(if $(strip $?                                 \
           $(filter-out $(cmd_$(1)),$(cmd_$(@F)))   \
           $(filter-out $(cmd_$(@F)),$(cmd_$(1)))), \
      @$(rule_$(1)))</pre><p>åœ¨æœ€é¡¶å±‚çš„<em class="filename">makefile</em>ä¸­ï¼Œè¯¥å‡½æ•°ç”¨äºŽå°†å†…æ ¸ä¸Žè¿™äº›å®é“¾æŽ¥ï¼š</p><p>In the topmost <em class="filename">makefile</em>,
          this function is used to link the kernel with these macros:</p><a id="OEBPS/ch11s02.html.I_6_tt500"></a><pre class="programlisting"># è¿™æœ‰ç‚¹æ£˜æ‰‹ï¼šå¦‚æžœæˆ‘ä»¬éœ€è¦é‡æ–°é“¾æŽ¥ vmlinuxï¼Œæˆ‘ä»¬éœ€è¦
# ç‰ˆæœ¬å·å¢žåŠ ï¼Œæ„å‘³ç€é‡æ–°ç¼–è¯‘init/version.o
# å¹¶é‡æ–°é“¾æŽ¥ init/init.oã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨
# æ­£å¸¸çš„ä¸‹é™åˆ°å­ç›®å½•é˜¶æ®µï¼Œä»Žé‚£æ—¶èµ·
# æˆ‘ä»¬è¿˜ä¸çŸ¥é“æ˜¯å¦éœ€è¦é‡æ–°é“¾æŽ¥ vmlinuxã€‚
# æ‰€ä»¥æˆ‘ä»¬å†æ¬¡è¿›å…¥ vmlinux è§„åˆ™å†…çš„ init/ ã€‚
...

Quiet_cmd_vmlinux_ _ = LD $@
å®šä¹‰cmd_vmlinux__
  $(LD) $(LDFLAGS) $(LDFLAGS_vmlinux) \
    ...
æ©å¾·å¤«

# set -e ä½¿è§„åˆ™åœ¨å‡ºé”™æ—¶ç«‹å³é€€å‡º

å®šä¹‰rule_vmlinux__
  +è®¾ç½®-eï¼› \
  $(å¦‚æžœ$(è¿‡æ»¤å™¨.tmp_kallsyms%,$^),, \
    echo 'GEN.ç‰ˆæœ¬'; \
    ã€‚ $(srctree)/scripts/mkversion &gt; .tmp_version; \
    mv -f .tmp_version .ç‰ˆæœ¬ï¼› \
    $(MAKE) $(build)=init;) \
  $(å¦‚æžœ$($(å®‰é™)cmd_vmlinux_ _), \
    echo ' $($(quiet)cmd_vmlinux_ _)' &amp;&amp;) \
  $(cmd_vmlinux_ _); \
  echo 'cmd_$@ := $(cmd_vmlinux_ _)' &gt; $(@D)/.$(@F).cmd
æ©å¾·å¤«

å®šä¹‰rule_vmlinux
  $(rule_vmlinux_ _); \
  $(æ–°ç±³) $@ | \
  grep -v '\(å·²ç¼–è¯‘\)\|...' | \
  æŽ’åº&gt;ç³»ç»Ÿ.map
æ©å¾·å¤«</pre><pre class="programlisting"># This is a bit tricky: If we need to relink vmlinux, we want
# the version number incremented, which means recompile init/version.o
# and relink init/init.o. However, we cannot do this during the
# normal descending-into-subdirs phase, since at that time
# we cannot yet know if we will need to relink vmlinux.
# So we descend into init/ inside the rule for vmlinux again.
...

quiet_cmd_vmlinux_ _ = LD $@
define cmd_vmlinux_ _
  $(LD) $(LDFLAGS) $(LDFLAGS_vmlinux) \
    ...
endef

# set -e makes the rule exit immediately on error

define rule_vmlinux_ _
  +set -e;                                              \
  $(if $(filter .tmp_kallsyms%,$^),,                    \
    echo '  GEN     .version';                          \
    . $(srctree)/scripts/mkversion &gt; .tmp_version;      \
    mv -f .tmp_version .version;                        \
    $(MAKE) $(build)=init;)                             \
  $(if $($(quiet)cmd_vmlinux_ _),                        \
    echo '  $($(quiet)cmd_vmlinux_ _)' &amp;&amp;)               \
  $(cmd_vmlinux_ _);                                     \
  echo 'cmd_$@ := $(cmd_vmlinux_ _)' &gt; $(@D)/.$(@F).cmd
endef

define rule_vmlinux
  $(rule_vmlinux_ _);          \
  $(NM) $@ |                  \
  grep -v '\(compiled\)\|...' | \
  sort &gt; System.map
endef</pre><p>è¯¥<code class="function">if_changed_rule</code>
          å‡½æ•°ç”¨äºŽè°ƒç”¨<code class="function">rule_vmlinux</code>ï¼ŒåŽè€…æ‰§è¡Œé“¾æŽ¥å¹¶æž„å»ºæœ€ç»ˆçš„<em class="filename">System.map</em>ã€‚æ­£å¦‚<em class="filename">makefile</em>ä¸­çš„æ³¨é‡Šæ‰€
          æŒ‡å‡ºçš„ï¼Œè¯¥å‡½æ•°å¿…é¡»åœ¨é‡æ–°é“¾æŽ¥<em class="filename">vmlinux</em>ä¹‹å‰
          <code class="function">rule_vmlinux_ _</code>
          é‡æ–°ç”Ÿæˆå†…æ ¸ç‰ˆæœ¬æ–‡ä»¶å¹¶é‡æ–°é“¾æŽ¥
          <em class="filename">init.o</em>ã€‚è¿™æ˜¯ç”±ç¬¬ä¸€ä¸ªæŽ§åˆ¶çš„ã€‚ç¬¬äºŒä¸ªæŽ§åˆ¶é“¾æŽ¥å‘½ä»¤çš„å›žæ˜¾ã€‚é“¾æŽ¥å‘½ä»¤ä¹‹åŽï¼Œå®žé™…æ‰§è¡Œçš„å‘½ä»¤ä¼šè®°å½•åœ¨
          <em class="filename">.cmd</em>æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿ä¸‹æ¬¡æž„å»ºæ—¶è¿›è¡Œæ¯”è¾ƒã€‚<em class="filename"></em><code class="function">if</code><code class="function">rule_vmlinux_ _</code><code class="function">if</code><code class="literal">$(cmd_vmlinux_ _)</code><em class="filename"></em></p><p>The <code class="function">if_changed_rule</code>
          function is used to invoke <code class="function">rule_vmlinux</code>, which performs the link and
          builds the final <em class="filename">System.map</em>. As
          the comment in the <em class="filename">makefile</em>
          notes, the <code class="function">rule_vmlinux_ _</code>
          function must regenerate the kernel version file and relink
          <em class="filename">init.o</em> before relinking
          <em class="filename">vmlinux</em>. This is controlled by
          the first <code class="function">if</code> in <code class="function">rule_vmlinux_ _</code>. The second <code class="function">if</code> controls the echoing of the link
          command, <code class="literal">$(cmd_vmlinux_ _)</code>. After
          the link command, the actual command executed is recorded in a
          <em class="filename">.cmd</em> file for comparison in the
          next build.</p></div></div></div></div>
<div id="OEBPS/ch12.html"><div>
<div class="chapter" title="ç¬¬ 12 ç« è°ƒè¯• Makefile"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch12.html.make3-CHP-12"></a>ç¬¬ 12 ç« è°ƒè¯• Makefile</h1><h1 class="title"><a></a>Chapter&nbsp;12.&nbsp;Debugging Makefiles</h1></div></div></div><p>è°ƒè¯•<em class="filename">makefile</em>æœ‰ç‚¹åƒé­”æœ¯ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ²¡æœ‰åƒ
      <em class="filename">makefile</em>è°ƒè¯•å™¨è¿™æ ·çš„ä¸œè¥¿æ¥æ£€æŸ¥å¦‚ä½•è¯„ä¼°ç‰¹å®šè§„åˆ™æˆ–å¦‚ä½•æ‰©å±•å˜é‡ã€‚ç›¸åï¼Œå¤§å¤šæ•°è°ƒè¯•æ˜¯é€šè¿‡ç®€å•çš„æ‰“å°è¯­å¥å’Œæ£€æŸ¥<em class="filename">makefile</em>æ¥æ‰§è¡Œçš„ã€‚
       <acronym class="acronym">GNU </acronym> <em class="command">make</em>æä¾›äº†ä¸€äº›æœ‰å…³å„ç§å†…ç½®å‡½æ•°å’Œå‘½ä»¤è¡Œé€‰é¡¹çš„å¸®åŠ©ã€‚</p><p>Debugging <em class="filename">makefile</em>s is
      somewhat of a black art. Unfortunately, there is no such thing as a
      <em class="filename">makefile</em> debugger to examine how a
      particular rule is being evaluated or a variable expanded. Instead, most
      debugging is performed with simple print statements and by inspection of
      the <em class="filename">makefile</em>.
      <acronym class="acronym">GNU</acronym> <em class="command">make</em> provides
      some help with various built-in functions and command-line
      options.</p><p><em class="filename">è°ƒè¯•makefile çš„</em>æœ€ä½³æ–¹æ³•ä¹‹ä¸€æ˜¯æ·»åŠ è°ƒè¯•æŒ‚é’©å¹¶ä½¿ç”¨é˜²å¾¡æ€§ç¼–ç¨‹æŠ€æœ¯ï¼Œå½“å‡ºçŽ°é—®é¢˜æ—¶å¯ä»¥ä¾é è¿™äº›æŠ€æœ¯ã€‚æˆ‘å°†ä»‹ç»ä¸€äº›æˆ‘è®¤ä¸ºæœ€æœ‰å¸®åŠ©çš„åŸºæœ¬è°ƒè¯•æŠ€æœ¯å’Œé˜²å¾¡æ€§ç¼–ç å®žè·µã€‚</p><p>One of the best ways to debug a <em class="filename">makefile</em> is to add debugging hooks and use
      defensive programming techniques that you can fall back on when things
      go awry. I'll present a few basic debugging techniques and defensive
      coding practices I've found most helpful.</p><div class="sect1" title="make çš„è°ƒè¯•åŠŸèƒ½"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch12.html.make3-CHP-12-SECT-1"></a>make çš„è°ƒè¯•åŠŸèƒ½</h1><h1 class="title"><a></a>Debugging Features of make</h1></div></div></div><p>åŠŸèƒ½<code class="function">warning</code>å¾ˆ<a id="OEBPS/ch12.html.make3-CHP-12-ITERM-1583" class="indexterm"></a>å¯¹äºŽè°ƒè¯•ä»»æ€§çš„<em class="filename">makefile</em>å¾ˆæœ‰ç”¨ã€‚å› ä¸º<code class="function">warning</code>å‡½æ•°<a id="OEBPS/ch12.html.make3-CHP-12-ITERM-1584" class="indexterm"></a> <a id="OEBPS/ch12.html.make3-CHP-12-ITERM-1585" class="indexterm"></a>æ‰©å±•ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå®ƒå¯ä»¥æ”¾ç½®åœ¨<em class="filename">makefile</em>ä¸­çš„ä»»ä½•ä½ç½®ï¼šé¡¶å±‚ã€ç›®æ ‡æˆ–å…ˆå†³æ¡ä»¶åˆ—è¡¨ä»¥åŠå‘½ä»¤è„šæœ¬ä¸­ã€‚è¿™å…è®¸æ‚¨åœ¨æœ€æ–¹ä¾¿æ£€æŸ¥å˜é‡çš„åœ°æ–¹æ‰“å°å˜é‡çš„å€¼ã€‚ä¾‹å¦‚ï¼š</p><p>The <code class="function">warning</code> function is
        very <a class="indexterm"></a>useful for debugging wayward <em class="filename">makefile</em>s. Because the <code class="function">warning</code> function<a class="indexterm"></a> <a class="indexterm"></a> expands to the empty string, it can be placed anywhere
        in a <em class="filename">makefile</em>: at the top-level,
        in target or prerequisite lists, and in command scripts. This allows
        you to print the value of variables wherever it is most convenient to
        inspect them. For example:</p><a id="OEBPS/ch12.html.I_7_tt501"></a><pre class="programlisting">$(è­¦å‘Š é¡¶çº§è­¦å‘Š)

FOO := $(è­¦å‘Šç®€å•å˜é‡çš„å³ä¾§)bar
BAZ = $(è­¦å‘Šé€’å½’å˜é‡çš„å³ä¾§)boo

$(è­¦å‘Š A ç›®æ ‡)target: $(è­¦å‘Šåœ¨å…ˆå†³æ¡ä»¶åˆ—è¡¨ä¸­)makefile $(BAZ)
        $ï¼ˆå‘½ä»¤è„šæœ¬ä¸­çš„è­¦å‘Šï¼‰
        LS
$ï¼ˆå·´å…¹ï¼‰ï¼š</pre><pre class="programlisting">$(warning A top-level warning)

FOO := $(warning Right-hand side of a simple variable)bar
BAZ = $(warning Right-hand side of a recursive variable)boo

$(warning A target)target: $(warning In a prerequisite list)makefile $(BAZ)
        $(warning In a command script)
        ls
$(BAZ):</pre><p>äº§ç”Ÿè¾“å‡ºï¼š</p><p>yields the output:</p><a id="OEBPS/ch12.html.I_7_tt502"></a><pre class="programlisting">$ åˆ¶ä½œ
makefile:1ï¼šé¡¶çº§è­¦å‘Š
makefile:2ï¼šç®€å•å˜é‡çš„å³ä¾§
makefile:5ï¼šç›®æ ‡
makefile:5ï¼šåœ¨å…ˆå†³æ¡ä»¶åˆ—è¡¨ä¸­
makefile:5ï¼šé€’å½’å˜é‡çš„å³ä¾§
makefile:8ï¼šé€’å½’å˜é‡çš„å³ä¾§
makefile:6ï¼šåœ¨å‘½ä»¤è„šæœ¬ä¸­
LS
ç”Ÿæˆæ–‡ä»¶</pre><pre class="programlisting">$ make
makefile:1: A top-level warning
makefile:2: Right-hand side of a simple variable
makefile:5: A target
makefile:5: In a prerequisite list
makefile:5: Right-hand side of a recursive variable
makefile:8: Right-hand side of a recursive variable
makefile:6: In a command script
ls
makefile</pre><p>è¯·æ³¨æ„ï¼Œå‡½æ•°çš„è¯„ä¼°éµå¾ªç«‹å³è¯„ä¼°å’Œå»¶è¿Ÿè¯„ä¼°çš„<code class="function">warning</code>æ­£å¸¸
        <em class="command">make</em>ç®—æ³•ã€‚å°½ç®¡ çš„åˆ†é…<code class="literal">BAZ</code>åŒ…å«ï¼Œä½†åªæœ‰åœ¨å…ˆå†³æ¡ä»¶åˆ—è¡¨ä¸­è¿›è¡Œè¯„ä¼°<code class="function">warning</code>åŽæ‰ä¼šæ‰“å°è¯¥æ¶ˆæ¯
        ã€‚<code class="literal">BAZ</code></p><p>Notice that the evaluation of the <code class="function">warning</code> function follows the normal
        <em class="command">make</em> algorithm for immediate and
        deferred evaluation. Although the assignment to <code class="literal">BAZ</code> contains a <code class="function">warning</code>, the message does not print until
        <code class="literal">BAZ</code> is evaluated in the
        prerequisites list.</p><p>åœ¨ä»»ä½•åœ°æ–¹æ³¨å…¥è°ƒç”¨çš„èƒ½åŠ›<code class="function">warning</code>ä½¿å…¶æˆä¸ºå¿…ä¸å¯å°‘çš„è°ƒè¯•å·¥å…·ã€‚</p><p>The ability to inject a <code class="function">warning</code> call anywhere makes it an essential
        debugging tool.</p><div class="sect2" title="å‘½ä»¤è¡Œé€‰é¡¹"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch12.html.make3-CHP-12-SECT-1.1"></a>å‘½ä»¤è¡Œé€‰é¡¹</h2><h2 class="title"><a></a>Command-Line Options</h2></div></div></div><p>æœ‰ä¸‰ç§<a id="OEBPS/ch12.html.make3-CHP-12-ITERM-1586" class="indexterm"></a> <a id="OEBPS/ch12.html.make3-CHP-12-ITERM-1587" class="indexterm"></a>æˆ‘å‘çŽ°å¯¹äºŽè°ƒè¯•æœ€æœ‰ç”¨çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼š(
           )ã€
           <code class="option">â€”just-print</code>( ) å’Œ
          .<code class="option">-n</code><code class="option">â€”print-data-base</code><code class="option">-p</code><code class="option">â€”warn-undefined-variables</code></p><p>There are three <a class="indexterm"></a> <a class="indexterm"></a>command-line options I find most useful for debugging:
          <code class="option">â€”just-print</code> (<code class="option">-n</code>),
          <code class="option">â€”print-data-base</code> (<code class="option">-p</code>), and
          <code class="option">â€”warn-undefined-variables</code>.</p><div class="sect3" title="â€”åªéœ€æ‰“å°"><div class="titlepage"><div><div><h3 class="title"><a id="OEBPS/ch12.html.make3-CHP-12-SECT-1.1.1"></a>â€”åªéœ€æ‰“å°</h3><h3 class="title"><a></a>â€”just-print</h3></div></div></div><p>æˆ‘æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªæµ‹è¯•<a id="OEBPS/ch12.html.make3-CHP-12-ITERM-1588" class="indexterm"></a>åœ¨æ–°çš„<em class="filename">makefile</em>ç›®æ ‡ä¸Šçš„æ–¹æ³•æ˜¯ä½¿ç”¨( )é€‰é¡¹
            è°ƒç”¨<em class="command">make</em>ã€‚è¿™ä¼šå¯¼è‡´<em class="command">make</em>è¯»å–
            <em class="filename">makefile</em>å¹¶æ‰“å°å®ƒé€šå¸¸ä¼šæ‰§è¡Œä»¥æ›´æ–°ç›®æ ‡çš„æ¯ä¸ªå‘½ä»¤ï¼Œä½†ä¸æ‰§è¡Œå®ƒä»¬ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œ<acronym class="acronym">GNU </acronym><em class="command">make</em>è¿˜å°†å›žæ˜¾æ ‡æœ‰é™éŸ³ä¿®é¥°ç¬¦ ( ) çš„å‘½ä»¤ã€‚<code class="option">â€”just-print</code><code class="option">-n</code><em class="command"></em><em class="filename"></em><acronym class="acronym"></acronym> <em class="command"></em><code class="literal">@</code></p><p>The first test I perform <a class="indexterm"></a>on a new <em class="filename">makefile</em> target is to invoke <em class="command">make</em> with the
            <code class="option">â€”just-print</code> (<code class="option">-n</code>) option. This
            causes <em class="command">make</em> to read the
            <em class="filename">makefile</em> and print every
            command it would normally execute to update the target but without
            executing them. As a convenience, <acronym class="acronym">GNU</acronym> <em class="command">make</em> will also echo commands marked with
            the silent modifier (<code class="literal">@</code>).</p><p>è¯¥é€‰é¡¹åº”è¯¥æŠ‘åˆ¶æ‰€æœ‰å‘½ä»¤çš„æ‰§è¡Œã€‚è™½ç„¶è¿™åœ¨æŸç§æ„ä¹‰ä¸Šå¯èƒ½æ˜¯æ­£ç¡®çš„ï¼Œä½†å®žé™…ä¸Šï¼Œæ‚¨å¿…é¡»å°å¿ƒã€‚è™½ç„¶<em class="command">make</em>ä¸ä¼šæ‰§è¡Œå‘½ä»¤è„šæœ¬ï¼Œä½†å®ƒå°†è¯„ä¼°<code class="function">shell</code>ç›´æŽ¥ä¸Šä¸‹æ–‡ä¸­å‘ç”Ÿçš„å‡½æ•°è°ƒç”¨ã€‚ä¾‹å¦‚ï¼š</p><p>The option is supposed to suppress all command execution.
            While this may be true in one sense, practically speaking, you
            must take care. While <em class="command">make</em> will
            not execute command scripts, it will evaluate <code class="function">shell</code> function calls that occur within
            an immediate context. For instance:</p><a id="OEBPS/ch12.html.I_7_tt503"></a><pre class="programlisting">REQUIRED_DIRS = ...
_MKDIRS := $(shell for d in $(REQUIRED_DIRS); \
             åš \
               [[ -d $$d ]] || mkdir -p $$d; \
             å®Œæ¯•ï¼‰

$(å¯¹è±¡) : $(æº)</pre><pre class="programlisting">REQUIRED_DIRS = ...
_MKDIRS := $(shell for d in $(REQUIRED_DIRS); \
             do                               \
               [[ -d $$d ]] || mkdir -p $$d;  \
             done)

$(objects) : $(sources)</pre><p>æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€çœ‹åˆ°çš„ï¼Œç®€å•å˜é‡çš„ç›®çš„<code class="literal">_MKDIRS</code>æ˜¯è§¦å‘åŸºæœ¬ç›®å½•çš„åˆ›å»ºã€‚å½“ç”¨ æ‰§è¡Œæ—¶
            ï¼Œshell å‘½ä»¤å°†åœ¨è¯»å–<em class="filename">makefile</em><code class="option">â€”just-print</code>æ—¶ç…§å¸¸æ‰§è¡Œã€‚ç„¶åŽ<em class="command">make</em>å°†å›žæ˜¾ï¼ˆä¸æ‰§è¡Œï¼‰æ›´æ–°æ–‡ä»¶åˆ—è¡¨æ‰€éœ€çš„æ¯ä¸ªç¼–è¯‘å‘½ä»¤ã€‚<em class="filename"></em><em class="command"></em><code class="literal">$(objects)</code></p><p>As we've seen before, the purpose of the <code class="literal">_MKDIRS</code> simple variable is to trigger
            the creation of essential directories. When this is executed with
            <code class="option">â€”just-print</code>, the shell command will be executed
            as usual when the <em class="filename">makefile</em> is
            read. Then <em class="command">make</em> will echo
            (without executing) each compilation command required to update
            the <code class="literal">$(objects)</code> file
            list.</p></div><div class="sect3" title="â€”æ‰“å°æ•°æ®åº“"><div class="titlepage"><div><div><h3 class="title"><a id="OEBPS/ch12.html.make3-CHP-12-SECT-1.1.2"></a>â€”æ‰“å°æ•°æ®åº“</h3><h3 class="title"><a></a>â€”print-data-base</h3></div></div></div><p>é€‰é¡¹<code class="option">â€”print-data-base</code>â€‹<code class="option">-p</code>â€‹<a id="OEBPS/ch12.html.make3-CHP-12-ITERM-1589" class="indexterm"></a>æ˜¯æ‚¨ä¼šç»å¸¸ä½¿ç”¨çš„å¦ä¸€ç§ã€‚å®ƒæ‰§è¡Œ
            <em class="filename">makefile</em>ï¼Œæ˜¾ç¤º
            <acronym class="acronym">GNUç‰ˆæƒï¼Œç„¶åŽæ˜¾ç¤ºç”±</acronym><em class="command">make</em>è¿è¡Œçš„å‘½ä»¤ï¼Œç„¶åŽå®ƒå°†è½¬å‚¨å…¶å†…éƒ¨æ•°æ®åº“ã€‚æ•°æ®è¢«æ”¶é›†åˆ°å€¼ç»„ä¸­ï¼šå˜é‡ã€ç›®å½•ã€éšå¼è§„åˆ™ã€ç‰¹å®šäºŽæ¨¡å¼çš„å˜é‡ã€æ–‡ä»¶ï¼ˆæ˜¾å¼è§„åˆ™ï¼‰å’Œ vpath æœç´¢è·¯å¾„ï¼š</p><p>The <code class="option">â€”print-data-base</code> (<code class="option">-p</code>)
            option <a class="indexterm"></a>is another one you'll use often. It executes the
            <em class="filename">makefile</em>, displaying the
            <acronym class="acronym">GNU</acronym> copyright followed by the commands as they
            are run by <em class="command">make</em>, then it will
            dump its internal database. The data is collected into groups of
            values: variables, directories, implicit rules, pattern-specific
            variables, files (explicit rules), and the vpath search
            path:</p><a id="OEBPS/ch12.html.I_7_tt504"></a><pre class="programlisting"># GNU Make 3.80
# ç‰ˆæƒæ‰€æœ‰ (C) 2002 è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šï¼ŒInc.
# è¿™æ˜¯å…è´¹è½¯ä»¶ï¼›è¯·å‚é˜…å¤åˆ¶æ¡ä»¶çš„æ¥æºã€‚
# æ²¡æœ‰ä»»ä½•ä¿è¯ï¼›ç”šè‡³ä¸è€ƒè™‘é€‚é”€æ€§æˆ–é€‚ç”¨æ€§
ï¼ƒ ç‰¹æ®Šç”¨é€”ã€‚<em class="replaceable"><code>normal command execution occurs here</code></em>

# åˆ¶ä½œæ•°æ®åº“ï¼Œæ‰“å°äºŽ Thu Apr 29 20:58:13 2004

# å˜é‡
...
# ç›®å½•
...
# éšå¼è§„åˆ™
...
# ç‰¹å®šäºŽæ¨¡å¼çš„å˜é‡å€¼
...
# æ–‡ä»¶
...
# VPATH æœç´¢è·¯å¾„</pre><pre class="programlisting"># GNU Make 3.80
# Copyright (C) 2002  Free Software Foundation, Inc.
# This is free software; see the source for copying conditions.
# There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE.<em class="replaceable"><code>normal command execution occurs here</code></em>

# Make data base, printed on Thu Apr 29 20:58:13 2004

# Variables
...
# Directories
...
# Implicit Rules
...
# Pattern-specific variable values
...
# Files
...
# VPATH Search Paths</pre><p>è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°ç ”ç©¶è¿™äº›éƒ¨åˆ†ã€‚</p><p>Let's examine these sections in more detail.</p><p>å˜é‡éƒ¨åˆ†åˆ—å‡ºäº†æ¯ä¸ªå˜é‡ä»¥åŠæè¿°æ€§æ³¨é‡Šï¼š</p><p>The variables section lists each variable along with a
            descriptive comment:</p><a id="OEBPS/ch12.html.I_7_tt505"></a><pre class="programlisting">ï¼ƒ è‡ªåŠ¨çš„
&lt;D = $(patsubst %/,%,$(dir $&lt;))
ï¼ƒ çŽ¯å¢ƒ
EMACS_DIR = C:/usr/emacs-21.3.50.7
ï¼ƒ é»˜è®¤
CWEAVE = ç¼–ç»‡
# makefileï¼ˆæ¥è‡ªâ€œ../mp3_player/makefileâ€ï¼Œç¬¬ 35 è¡Œï¼‰
CPPFLAGS = $(addprefix -I ,$(include_dirs))
# makefileï¼ˆæ¥è‡ªâ€œ../ch07-separate-binaries/makefileâ€ï¼Œç¬¬ 44 è¡Œï¼‰
RM := rm -f
# makefileï¼ˆæ¥è‡ªâ€œ../mp3_player/makefileâ€ï¼Œç¬¬ 14 è¡Œï¼‰
å®šä¹‰ make-library
  å›¾ä¹¦é¦† += $1
  æ¥æº += $2

  $1: $(è°ƒç”¨æºåˆ°å¯¹è±¡,$2)
        $(AR) $(ARFLAGS) $$@ $$^
æ©å¾·å¤«</pre><pre class="programlisting"># automatic
&lt;D = $(patsubst %/,%,$(dir $&lt;))
# environment
EMACS_DIR = C:/usr/emacs-21.3.50.7
# default
CWEAVE = cweave
# makefile (from `../mp3_player/makefile', line 35)
CPPFLAGS = $(addprefix -I ,$(include_dirs))
# makefile (from `../ch07-separate-binaries/makefile', line 44)
RM := rm -f
# makefile (from `../mp3_player/makefile', line 14)
define make-library
  libraries += $1
  sources   += $2

  $1: $(call source-to-object,$2)
        $(AR) $(ARFLAGS) $$@ $$^
endef</pre><p>è‡ªåŠ¨å˜é‡ä¸ä¼šè¢«æ‰“å°ï¼Œä½†ä»Žå®ƒä»¬æ´¾ç”Ÿçš„ä¾¿åˆ©å˜é‡<code class="literal">$(&lt;D)</code>ä¼šè¢«æ‰“å°ã€‚æ³¨é‡ŠæŒ‡ç¤ºå‡½æ•°è¿”å›žçš„å˜é‡çš„ç±»åž‹<code class="function">origin</code>ï¼ˆå‚è§<a class="link" href="#OEBPS/ch04.html" title="ç¬¬ 4 ç« å‡½æ•°">ç¬¬ 4 ç« </a>ä¸­çš„<a class="link" href="#OEBPS/ch04s02.html.make3-CHP-4-SECT-2.5" title="ä¸å¤ªé‡è¦çš„æ‚é¡¹åŠŸèƒ½">4.2.5 èŠ‚</a>ï¼‰ã€‚å¦‚æžœå˜é‡æ˜¯åœ¨æ–‡ä»¶ä¸­å®šä¹‰çš„ï¼Œåˆ™ç»™å‡ºå®šä¹‰çš„æ–‡ä»¶åå’Œè¡Œå·ã€‚ç®€å•å˜é‡å’Œé€’å½’å˜é‡é€šè¿‡èµ‹å€¼è¿ç®—ç¬¦æ¥åŒºåˆ†ã€‚ç®€å•å˜é‡çš„å€¼å°†æ˜¾ç¤ºä¸ºå³ä¾§çš„è®¡ç®—å½¢å¼ã€‚<a class="link" href="#OEBPS/ch04.html" title="ç¬¬ 4 ç« å‡½æ•°"></a></p><p>Automatic variables are not printed, but convenience
            variables derived from them like <code class="literal">$(&lt;D)</code> are. The comment indicates the
            type of the variable as returned by the <code class="function">origin</code> function (see the <a class="link" href="#OEBPS/ch04s02.html.make3-CHP-4-SECT-2.5" title="Less Important Miscellaneous Functions">Section 4.2.5</a> in <a class="link" href="#OEBPS/ch04.html" title="Chapter&nbsp;4.&nbsp;Functions">Chapter 4</a>). If the variable is
            defined in a file, the filename and line number of the definition
            is given. Simple and recursive variables are distinguished by the
            assignment operator. The value of a simple variable will be
            displayed as the evaluated form of the righthand side.</p><p>ä¸‹ä¸€éƒ¨åˆ†æ ‡è®°ä¸ºâ€œç›®å½•â€ï¼Œå¯¹äºŽ
            <em class="command">åŸ¹å…»</em>å¼€å‘äººå‘˜æ¯”
            <em class="command">åŸ¹å…»</em>ç”¨æˆ·æ›´æœ‰ç”¨ã€‚å®ƒåˆ—å‡ºäº†<em class="command">make</em>æ£€æŸ¥çš„ç›®å½•ï¼ŒåŒ…æ‹¬å¯èƒ½å­˜åœ¨ä½†é€šå¸¸ä¸å­˜åœ¨çš„ SCCS å’Œ RCS å­ç›®å½•ã€‚å¯¹äºŽæ¯ä¸ªç›®å½•ï¼Œ<em class="command">make</em>æ˜¾ç¤ºå®žçŽ°è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚è®¾å¤‡å·ã€inode å’Œæ–‡ä»¶æ¨¡å¼åŒ¹é…çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</p><p>The next section, labeled Directories, is more useful to
            <em class="command">make</em> developers than to
            <em class="command">make</em> users. It lists the
            directories being examined by <em class="command">make</em>, including SCCS and RCS
            subdirectories that might exist, but usually do not. For each
            directory, <em class="command">make</em> displays
            implementation details, such as the device number, inode, and
            statistics on file pattern matches.</p><p>éšå«è§„åˆ™éƒ¨åˆ†å¦‚ä¸‹ã€‚å®ƒåŒ…å«<em class="command">make</em>æ•°æ®åº“ä¸­çš„æ‰€æœ‰å†…ç½®å’Œç”¨æˆ·å®šä¹‰çš„æ¨¡å¼è§„åˆ™ã€‚åŒæ ·ï¼Œå¯¹äºŽæ–‡ä»¶ä¸­å®šä¹‰çš„è§„åˆ™ï¼Œæ³¨é‡ŠæŒ‡ç¤ºæ–‡ä»¶å’Œè¡Œå·ï¼š</p><p>The Implicit Rules section follows. This contains all the
            built-in and user-defined pattern rules in <em class="command">make</em>'s database. Again, for those rules
            defined in a file, a comment indicates the file and line
            number:</p><a id="OEBPS/ch12.html.I_7_tt506"></a><pre class="programlisting">%.c %.h: %.y
# è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆæ¥è‡ªâ€œ../mp3_player/makefileâ€ï¼Œç¬¬ 73 è¡Œï¼‰ï¼š
        $(YACC.y) --å®šä¹‰$&lt;
        $(MV) y.tab.c $*.c
        $(MV) y.tab.h $*.h

ï¼…ï¼š ï¼…ã€‚C
# è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆå†…ç½®ï¼‰ï¼š
        $(LINK.c) $^ $(LOADLIBES) $(LDLIBS) -o $@

%.o: %.c
# è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆå†…ç½®ï¼‰ï¼š
        $(COMPILE.c) $(OUTPUT_OPTION) $&lt;</pre><pre class="programlisting">%.c %.h: %.y
# commands to execute (from `../mp3_player/makefile', line 73):
        $(YACC.y) --defines $&lt;
        $(MV) y.tab.c $*.c
        $(MV) y.tab.h $*.h

%: %.c
#  commands to execute (built-in):
        $(LINK.c) $^ $(LOADLIBES) $(LDLIBS) -o $@

%.o: %.c
#  commands to execute (built-in):
        $(COMPILE.c) $(OUTPUT_OPTION) $&lt;</pre><p>æ£€æŸ¥æœ¬èŠ‚æ˜¯ç†Ÿæ‚‰<em class="command">make</em>å†…ç½®è§„åˆ™çš„å¤šæ ·æ€§å’Œç»“æž„çš„å¥½æ–¹æ³•ã€‚å½“ç„¶ï¼Œå¹¶éžæ‰€æœ‰å†…ç½®è§„åˆ™éƒ½ä½œä¸ºæ¨¡å¼è§„åˆ™å®žçŽ°ã€‚å¦‚æžœæ‚¨æ²¡æœ‰æ‰¾åˆ°æ‚¨è¦æŸ¥æ‰¾çš„è§„åˆ™ï¼Œè¯·æ£€æŸ¥åˆ—å‡ºäº†æ—§å¼åŽç¼€è§„åˆ™çš„â€œæ–‡ä»¶â€éƒ¨åˆ†ã€‚</p><p>Examining this section is a great way to become familiar
            with the variety and structure of <em class="command">make</em>'s built-in rules. Of course, not
            all built-in rules are implemented as pattern rules. If you don't
            find the rule you're looking for, check in the Files section where
            the old-style suffix rules are listed.</p><p>ä¸‹ä¸€èŠ‚å¯¹<em class="filename">makefile</em>ä¸­å®šä¹‰çš„ç‰¹å®šäºŽæ¨¡å¼çš„å˜é‡è¿›è¡Œåˆ†ç±»ã€‚å›žæƒ³ä¸€ä¸‹ï¼Œç‰¹å®šäºŽæ¨¡å¼çš„å˜é‡æ˜¯å˜é‡å®šä¹‰ï¼Œå…¶èŒƒå›´æ°å¥½æ˜¯å…¶å…³è”æ¨¡å¼è§„åˆ™çš„æ‰§è¡Œæ—¶é—´ã€‚ä¾‹å¦‚ï¼Œæ¨¡å¼å˜é‡<code class="literal">YYLEXFLAG</code>ï¼Œå®šä¹‰ä¸ºï¼š</p><p>The next section catalogs the pattern-specific variables
            defined in the <em class="filename">makefile</em>.
            Recall that pattern-specific variables are variable definitions
            whose scope is precisely the execution time of their associated
            pattern rule. For example, the pattern variable <code class="literal">YYLEXFLAG</code>, defined as:</p><a id="OEBPS/ch12.html.I_7_tt507"></a><pre class="programlisting">%.c %.h: YYLEXFLAG := -d
%.c %.h: %.y
        $(YACC.y) --å®šä¹‰$&lt;
        $(MV) y.tab.c $*.c
        $(MV) y.tab.h $*.h</pre><pre class="programlisting">%.c %.h: YYLEXFLAG := -d
%.c %.h: %.y
        $(YACC.y) --defines $&lt;
        $(MV) y.tab.c $*.c
        $(MV) y.tab.h $*.h</pre><p>å°†æ˜¾ç¤ºä¸ºï¼š</p><p>would be displayed as:</p><a id="OEBPS/ch12.html.I_7_tt508"></a><pre class="programlisting"># ç‰¹å®šäºŽæ¨¡å¼çš„å˜é‡å€¼

ï¼…ã€‚C ï¼š
# makefileï¼ˆæ¥è‡ªâ€œMakefileâ€ï¼Œç¬¬ 1 è¡Œï¼‰
# YYLEXFLAG := -d
# å˜é‡é›†å“ˆå¸Œè¡¨ç»Ÿè®¡ä¿¡æ¯ï¼š
# è´Ÿè½½=1/16=6%ï¼Œé‡æ–°æ•£åˆ—=0ï¼Œç¢°æ’ž=0/1=0%

ï¼…ã€‚H ï¼š
# makefileï¼ˆæ¥è‡ªâ€œMakefileâ€ï¼Œç¬¬ 1 è¡Œï¼‰
# YYLEXFLAG := -d
# å˜é‡é›†å“ˆå¸Œè¡¨ç»Ÿè®¡ä¿¡æ¯ï¼š
# è´Ÿè½½=1/16=6%ï¼Œé‡æ–°æ•£åˆ—=0ï¼Œç¢°æ’ž=0/1=0%

# 2 ä¸ªç‰¹å®šäºŽæ¨¡å¼çš„å˜é‡å€¼</pre><pre class="programlisting"># Pattern-specific variable values

%.c :
# makefile (from `Makefile', line 1)
# YYLEXFLAG := -d
# variable set hash-table stats:
# Load=1/16=6%, Rehash=0, Collisions=0/1=0%

%.h :
# makefile (from `Makefile', line 1)
# YYLEXFLAG := -d
# variable set hash-table stats:
# Load=1/16=6%, Rehash=0, Collisions=0/1=0%

# 2 pattern-specific variable values</pre><p>æ–‡ä»¶éƒ¨åˆ†éšåŽåˆ—å‡ºäº†ä¸Žç‰¹å®šæ–‡ä»¶ç›¸å…³çš„æ‰€æœ‰æ˜¾å¼è§„åˆ™å’ŒåŽç¼€è§„åˆ™ï¼š</p><p>The Files section follows and lists all the explicit and
            suffix rules that relate to specific files:</p><a id="OEBPS/ch12.html.I_7_tt509"></a><pre class="programlisting"># ä¸æ˜¯ç›®æ ‡ï¼š
.po:
# éšå¼è§„åˆ™æœç´¢å°šæœªå®Œæˆã€‚
# ä¿®æ”¹æ—¶é—´ä»Žæœªæ£€æŸ¥è¿‡ã€‚
# æ–‡ä»¶å°šæœªæ›´æ–°ã€‚
# è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆå†…ç½®ï¼‰ï¼š
        $(COMPILE.p) $(OUTPUT_OPTION) $&lt;

lib/ui/libui.a: lib/ui/ui.o
# éšå¼è§„åˆ™æœç´¢å°šæœªå®Œæˆã€‚
# æœ€åŽä¿®æ”¹æ—¶é—´ 2004-04-01 22:04:09.515625
# æ–‡ä»¶å·²æ›´æ–°ã€‚
ï¼ƒ æˆåŠŸæ›´æ–°ã€‚
# è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆæ¥è‡ª `../mp3_player/lib/ui/module.mk'ï¼Œç¬¬ 3 è¡Œï¼‰ï¼š
        æˆ¿è½¦ $@ $^

lib/codec/codec.o: ../mp3_player/lib/codec/codec.c ../mp3_player/lib/codec/codec.c ../
mp3_player/include/codec/codec.h
# éšå¼è§„åˆ™æœç´¢å·²å®Œæˆã€‚
# éšå¼/é™æ€æ¨¡å¼ä¸»å¹²ï¼š`lib/codec/codec'
# æœ€åŽä¿®æ”¹æ—¶é—´ 2004-04-01 22:04:08.40625
# æ–‡ä»¶å·²æ›´æ–°ã€‚
ï¼ƒ æˆåŠŸæ›´æ–°ã€‚
# è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆå†…ç½®ï¼‰ï¼š
        $(COMPILE.c) $(OUTPUT_OPTION) $&lt;</pre><pre class="programlisting"># Not a target:
.p.o:
#  Implicit rule search has not been done.
#  Modification time never checked.
#  File has not been updated.
#  commands to execute (built-in):
        $(COMPILE.p) $(OUTPUT_OPTION) $&lt;

lib/ui/libui.a: lib/ui/ui.o
#  Implicit rule search has not been done.
#  Last modified 2004-04-01 22:04:09.515625
#  File has been updated.
#  Successfully updated.
#  commands to execute (from `../mp3_player/lib/ui/module.mk', line 3):
        ar rv $@ $^

lib/codec/codec.o: ../mp3_player/lib/codec/codec.c ../mp3_player/lib/codec/codec.c ../
mp3_player/include/codec/codec.h
#  Implicit rule search has been done.
#  Implicit/static pattern stem: `lib/codec/codec'
#  Last modified 2004-04-01 22:04:08.40625
#  File has been updated.
#  Successfully updated.
#  commands to execute (built-in):
        $(COMPILE.c) $(OUTPUT_OPTION) $&lt;</pre><p>ä¸­é—´æ–‡ä»¶å’ŒåŽç¼€è§„åˆ™è¢«æ ‡è®°ä¸ºâ€œä¸æ˜¯ç›®æ ‡â€ï¼›å…¶ä½™çš„æ˜¯ç›®æ ‡ã€‚æ¯ä¸ªæ–‡ä»¶éƒ½åŒ…å«æŒ‡ç¤º<em class="command">make</em>å¦‚ä½•å¤„ç†è§„åˆ™çš„æ³¨é‡Šã€‚é€šè¿‡æ­£å¸¸æœç´¢æ‰¾åˆ°çš„æ–‡ä»¶
            <code class="literal">vpath</code>ä¼šæ˜¾ç¤ºå…¶è§£æžè·¯å¾„ã€‚</p><p>Intermediate files and suffix rules are labeled "Not a
            target"; the remainder are targets. Each file includes comments
            indicating how <em class="command">make</em> has
            processed the rule. Files that are found through the normal
            <code class="literal">vpath</code> search have their
            resolved path displayed.</p><p>æœ€åŽä¸€éƒ¨åˆ†æ ‡è®°ä¸º VPATH æœç´¢è·¯å¾„ï¼Œå¹¶åˆ—å‡º çš„å€¼<code class="literal">VPATH</code>å’Œæ‰€æœ‰
            <code class="literal">vpath</code>æ¨¡å¼ã€‚</p><p>The last section is labeled VPATH Search Paths and lists the
            value of <code class="literal">VPATH</code> and all the
            <code class="literal">vpath</code> patterns.</p><p>å¯¹äºŽå¹¿æ³›ä½¿ç”¨ç”¨æˆ·å®šä¹‰å‡½æ•°å¹¶åˆ›å»ºå¤æ‚å˜é‡å’Œè§„åˆ™çš„<em class="filename">makefile</em><code class="function">eval</code>ï¼Œæ£€æŸ¥æ­¤è¾“å‡ºé€šå¸¸æ˜¯éªŒè¯å®æ‰©å±•æ˜¯å¦å·²ç”Ÿæˆé¢„æœŸå€¼çš„å”¯ä¸€æ–¹æ³•ã€‚</p><p>For <em class="filename">makefile</em>s that make
            extensive use of user-defined functions and <code class="function">eval</code> to create complex variables and
            rules, examining this output is often the only way to verify that
            macro expansion has generated the expected values.</p></div><div class="sect3" title="â€”è­¦å‘Šæœªå®šä¹‰å˜é‡"><div class="titlepage"><div><div><h3 class="title"><a id="OEBPS/ch12.html.make3-CHP-12-SECT-1.1.3"></a>â€”è­¦å‘Šæœªå®šä¹‰å˜é‡</h3><h3 class="title"><a></a>â€”warn-undefined-variables</h3></div></div></div><p>è¯¥é€‰é¡¹å¯¼è‡´<em class="command">make</em>
            <a id="OEBPS/ch12.html.make3-CHP-12-ITERM-1590" class="indexterm"></a>æ¯å½“æ‰©å±•æœªå®šä¹‰çš„å˜é‡æ—¶æ˜¾ç¤ºè­¦å‘Šã€‚ç”±äºŽæœªå®šä¹‰çš„å˜é‡ä¼šæ‰©å±•ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå› æ­¤å˜é‡åç§°ä¸­çš„æ‹¼å†™é”™è¯¯å¾ˆå®¹æ˜“é•¿æ—¶é—´æœªè¢«æ£€æµ‹åˆ°ã€‚è¿™ä¸ªé€‰é¡¹çš„é—®é¢˜æ˜¯ï¼Œè®¸å¤šå†…ç½®è§„åˆ™éƒ½åŒ…å«æœªå®šä¹‰çš„å˜é‡ä½œä¸ºç”¨æˆ·å®šä¹‰å€¼çš„æŒ‚é’©ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘å¾ˆå°‘ä½¿ç”¨å®ƒçš„åŽŸå› ã€‚å› æ­¤ï¼Œä½¿ç”¨æ­¤é€‰é¡¹è¿è¡Œ
            <em class="command">make</em>å°†ä¸å¯é¿å…åœ°äº§ç”Ÿè®¸å¤šè­¦å‘Šï¼Œè¿™äº›è­¦å‘Šä¸æ˜¯é”™è¯¯ï¼Œå¹¶ä¸”ä¸Žç”¨æˆ·çš„<em class="filename">makefile</em>æ²¡æœ‰ä»»ä½•æœ‰ç”¨çš„å…³ç³»ã€‚ä¾‹å¦‚ï¼š</p><p>This option causes <em class="command">make</em>
            <a class="indexterm"></a>to display a warning whenever an undefined variable
            is expanded. Since undefined variables expand to the empty string,
            it is common for typographical errors in variable names to go
            undetected for long periods. The problem with this option, and why
            I use it only rarely, is that many built-in rules include
            undefined variables as hooks for user-defined values. So running
            <em class="command">make</em> with this option will
            inevitably produce many warnings that are not errors and have no
            useful relationship to the user's <em class="filename">makefile</em>. For example:</p><a id="OEBPS/ch12.html.I_7_tt510"></a><pre class="programlisting">$<strong class="userinput"><code>make --warn-undefined-variables -n</code></strong>
makefile:35: è­¦å‘Š: æœªå®šä¹‰å˜é‡ MAKECMDGOALS
makefile:45: è­¦å‘Š: æœªå®šä¹‰çš„å˜é‡ CFLAGS
makefile:45: è­¦å‘Š: æœªå®šä¹‰å˜é‡ TARGET_ARCH
...
makefile:35: è­¦å‘Š: æœªå®šä¹‰å˜é‡ MAKECMDGOALS
makeï¼šè­¦å‘Šï¼šæœªå®šä¹‰çš„å˜é‡ CFLAGS
makeï¼šè­¦å‘Šï¼šæœªå®šä¹‰å˜é‡ TARGET_ARCH
makeï¼šè­¦å‘Šï¼šæœªå®šä¹‰çš„å˜é‡ CFLAGS
makeï¼šè­¦å‘Šï¼šæœªå®šä¹‰å˜é‡ TARGET_ARCH
...
makeï¼šè­¦å‘Šï¼šæœªå®šä¹‰çš„å˜é‡LDFLAGS
makeï¼šè­¦å‘Šï¼šæœªå®šä¹‰å˜é‡ TARGET_ARCH
makeï¼šè­¦å‘Šï¼šæœªå®šä¹‰å˜é‡ LOADLIBES
makeï¼šè­¦å‘Šï¼šæœªå®šä¹‰å˜é‡ LDLIBS</pre><pre class="programlisting">$<strong class="userinput"><code>make --warn-undefined-variables -n</code></strong>
makefile:35: warning: undefined variable MAKECMDGOALS
makefile:45: warning: undefined variable CFLAGS
makefile:45: warning: undefined variable TARGET_ARCH
...
makefile:35: warning: undefined variable MAKECMDGOALS
make: warning: undefined variable CFLAGS
make: warning: undefined variable TARGET_ARCH
make: warning: undefined variable CFLAGS
make: warning: undefined variable TARGET_ARCH
...
make: warning: undefined variable LDFLAGS
make: warning: undefined variable TARGET_ARCH
make: warning: undefined variable LOADLIBES
make: warning: undefined variable LDLIBS</pre><p>å°½ç®¡å¦‚æ­¤ï¼Œè¯¥å‘½ä»¤æœ‰æ—¶å¯¹äºŽæ•èŽ·æ­¤ç±»é”™è¯¯éžå¸¸æœ‰ä»·å€¼ã€‚</p><p>Nevertheless, this command can be extremely valuable on
            occasion in catching these kinds of errors.</p></div></div><div class="sect2" title="â€”debug é€‰é¡¹"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch12.html.make3-CHP-12-SECT-1.2"></a>â€”debug é€‰é¡¹</h2><h2 class="title"><a></a>The â€”debug Option</h2></div></div></div><p>å½“ä½ éœ€è¦çŸ¥é“å¦‚ä½•<em class="command">åˆ¶ä½œæ—¶</em> <a id="OEBPS/ch12.html.make3-CHP-12-ITERM-1591" class="indexterm"></a>åˆ†æžæ‚¨çš„ä¾èµ–å…³ç³»å›¾ï¼Œä½¿ç”¨è¯¥
          <code class="option">â€”debug</code>é€‰é¡¹ã€‚é™¤äº†è¿è¡Œè°ƒè¯•å™¨ä¹‹å¤–ï¼Œè¿™è¿˜æä¾›äº†æœ€è¯¦ç»†çš„å¯ç”¨ä¿¡æ¯ã€‚æœ‰äº”ä¸ªè°ƒè¯•é€‰é¡¹å’Œä¸€ä¸ªä¿®é¥°ç¬¦ï¼šåˆ†åˆ«ä¸º<code class="literal">basic</code>ã€<code class="literal">verbose</code>ã€<code class="literal">implicit</code>ã€<code class="literal">jobs</code>ã€<code class="literal">all</code>å’Œ<code class="literal">makefile</code>ã€‚</p><p>When you need to know how <em class="command">make</em> <a class="indexterm"></a>analyzes your dependency graph, use the
          <code class="option">â€”debug</code> option. This provides the most detailed
          information available other than by running a debugger. There are
          five debugging options and one modifier: <code class="literal">basic</code>, <code class="literal">verbose</code>, <code class="literal">implicit</code>, <code class="literal">jobs</code>, <code class="literal">all</code>, and <code class="literal">makefile</code>, respectively.</p><p>å¦‚æžœè°ƒè¯•é€‰é¡¹æŒ‡å®šä¸º
          <code class="option">â€”debug</code>ï¼Œåˆ™ä½¿ç”¨åŸºæœ¬è°ƒè¯•ã€‚å¦‚æžœè°ƒè¯•é€‰é¡¹æŒ‡å®šä¸º<code class="option">-d</code>,<code class="literal">all</code>åˆ™ä½¿ç”¨ã€‚è¦é€‰æ‹©å…¶ä»–é€‰é¡¹ç»„åˆï¼Œè¯·ä½¿ç”¨é€—å·åˆ†éš”åˆ—è¡¨<sub>1</sub> , <sub>2</sub>ï¼Œå…¶ä¸­é€‰é¡¹å¯ä»¥æ˜¯ä»¥ä¸‹å•è¯ä¹‹ä¸€ï¼ˆå®žé™…ä¸Šï¼Œ<em class="command">make</em>
          ä»…æŸ¥çœ‹ç¬¬ä¸€ä¸ªå­—æ¯ï¼‰ï¼š<code class="option">â€”debug=</code>
          <em class="replaceable"><code>option</code></em>
          <sub></sub><em class="replaceable"><code>option</code></em>
          <sub></sub><em class="command"></em></p><p>If the debugging option is specified as
          <code class="option">â€”debug</code>, basic debugging is used. If the debugging
          option is given as <code class="option">-d</code>, <code class="literal">all</code> is used. To select other combinations
          of options, use a comma separated list <code class="option">â€”debug=</code>
          <em class="replaceable"><code>option</code></em>
          <sub>1</sub>,<em class="replaceable"><code>option</code></em>
          <sub>2</sub> where the option can be one of the
          following words (actually, <em class="command">make</em>
          looks only at the first letter):</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">basic</code></span></dt><dt><span class="term"><code class="literal">basic</code></span></dt><dd><p>åŸºæœ¬è°ƒè¯•æ˜¯æœ€ä¸è¯¦ç»†çš„ã€‚å¯ç”¨åŽï¼Œ
                 <em class="command">make ä¼š</em>æ‰“å°æ¯ä¸ªå‘çŽ°è¿‡æœŸçš„ç›®æ ‡ä»¥åŠæ›´æ–°æ“ä½œçš„çŠ¶æ€ã€‚ç¤ºä¾‹è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p><a id="OEBPS/ch12.html.I_7_tt511"></a><pre class="programlisting">æ–‡ä»¶å…¨éƒ¨ä¸å­˜åœ¨ã€‚
  æ–‡ä»¶ app/player/play_mp3 ä¸å­˜åœ¨ã€‚
    æ–‡ä»¶ app/player/play_mp3.o ä¸å­˜åœ¨ã€‚
   å¿…é¡»é‡æ–°åˆ¶ä½œç›®æ ‡ app/player/play_mp3.oã€‚
æµ·æ¹¾åˆä½œå§”å‘˜ä¼š ... ../mp3_player/app/player/play_mp3.c
   æˆåŠŸé‡åˆ¶ç›®æ ‡æ–‡ä»¶app/player/play_mp3.oã€‚</pre></dd><dd><p>Basic debugging is the least detailed. When enabled,
                <em class="command">make</em> prints each target
                that is found to be out-of-date and the status of the update
                action. Sample output looks like:</p><a></a><pre class="programlisting">File all does not exist.
  File app/player/play_mp3 does not exist.
    File app/player/play_mp3.o does not exist.
   Must remake target app/player/play_mp3.o.
gcc ... ../mp3_player/app/player/play_mp3.c
   Successfully remade target file app/player/play_mp3.o.</pre></dd><dt><span class="term"><code class="literal">verbose</code></span></dt><dt><span class="term"><code class="literal">verbose</code></span></dt><dd><p>æ­¤é€‰é¡¹è®¾ç½®<code class="literal">basic</code>é€‰é¡¹å¹¶åŒ…å«æœ‰å…³è§£æžå“ªäº›æ–‡ä»¶ã€ä¸éœ€è¦é‡å»ºçš„å…ˆå†³æ¡ä»¶ç­‰çš„é™„åŠ ä¿¡æ¯ï¼š</p><a id="OEBPS/ch12.html.I_7_tt512"></a><pre class="programlisting">æ–‡ä»¶å…¨éƒ¨ä¸å­˜åœ¨ã€‚
 è€ƒè™‘ç›®æ ‡æ–‡ä»¶ app/player/play_mp3ã€‚
  æ–‡ä»¶ app/player/play_mp3 ä¸å­˜åœ¨ã€‚
   è€ƒè™‘ç›®æ ‡æ–‡ä»¶app/player/play_mp3.oã€‚
    æ–‡ä»¶ app/player/play_mp3.o ä¸å­˜åœ¨ã€‚
     ä¿®å‰ªæ–‡ä»¶../mp3_player/app/player/play_mp3.cã€‚
     ä¿®å‰ªæ–‡ä»¶../mp3_player/app/player/play_mp3.cã€‚
     ä¿®å‰ªæ–‡ä»¶../mp3_player/include/player/play_mp3.hã€‚
    å®Œæˆäº†ç›®æ ‡æ–‡ä»¶ app/player/play_mp3.o çš„å…ˆå†³æ¡ä»¶ã€‚
   å¿…é¡»é‡æ–°åˆ¶ä½œç›®æ ‡ app/player/play_mp3.oã€‚
æµ·æ¹¾åˆä½œå§”å‘˜ä¼š ... ../mp3_player/app/player/play_mp3.c
   æˆåŠŸé‡åˆ¶ç›®æ ‡æ–‡ä»¶app/player/play_mp3.oã€‚
   ä¿®å‰ªæ–‡ä»¶ app/player/play_mp3.oã€‚</pre></dd><dd><p>This option sets the <code class="literal">basic</code> option and includes additional
                information about which files where parsed, prerequisites that
                did not need to be rebuilt, etc.:</p><a></a><pre class="programlisting">File all does not exist.
 Considering target file app/player/play_mp3.
  File app/player/play_mp3 does not exist.
   Considering target file app/player/play_mp3.o.
    File app/player/play_mp3.o does not exist.
     Pruning file ../mp3_player/app/player/play_mp3.c.
     Pruning file ../mp3_player/app/player/play_mp3.c.
     Pruning file ../mp3_player/include/player/play_mp3.h.
    Finished prerequisites of target file app/player/play_mp3.o.
   Must remake target app/player/play_mp3.o.
gcc ... ../mp3_player/app/player/play_mp3.c
   Successfully remade target file app/player/play_mp3.o.
   Pruning file app/player/play_mp3.o.</pre></dd><dt><span class="term"><code class="literal">implicit</code></span></dt><dt><span class="term"><code class="literal">implicit</code></span></dt><dd><p>æ­¤é€‰é¡¹è®¾ç½®<code class="literal">basic</code>é€‰é¡¹å¹¶åŒ…å«æœ‰å…³æ¯ä¸ªç›®æ ‡çš„éšå¼è§„åˆ™æœç´¢çš„é™„åŠ ä¿¡æ¯ï¼š</p><a id="OEBPS/ch12.html.I_7_tt513"></a><pre class="programlisting">æ–‡ä»¶å…¨éƒ¨ä¸å­˜åœ¨ã€‚
  æ–‡ä»¶ app/player/play_mp3 ä¸å­˜åœ¨ã€‚
  å¯»æ‰¾ app/player/play_mp3 çš„éšå¼è§„åˆ™ã€‚
  å°è¯•ä½¿ç”¨ Stem play_mp3 çš„æ¨¡å¼è§„åˆ™ã€‚
  å°è¯•éšå¼å…ˆå†³æ¡ä»¶ app/player/play_mp3.oã€‚
  å‘çŽ° app/player/play_mp3 çš„éšå¼è§„åˆ™ã€‚
    æ–‡ä»¶ app/player/play_mp3.o ä¸å­˜åœ¨ã€‚
    å¯»æ‰¾ app/player/play_mp3.o çš„éšå¼è§„åˆ™ã€‚
    å°è¯•ä½¿ç”¨ Stem play_mp3 çš„æ¨¡å¼è§„åˆ™ã€‚
    å°è¯•éšå¼å…ˆå†³æ¡ä»¶ app/player/play_mp3.cã€‚
    æ‰¾åˆ°å…ˆå†³æ¡ä»¶ app/player/play_mp3.c ä½œä¸º VPATH ../mp3_player/app/player/play_mp3.c
    å‘çŽ° app/player/play_mp3.o çš„éšå¼è§„åˆ™ã€‚
   å¿…é¡»é‡æ–°åˆ¶ä½œç›®æ ‡ app/player/play_mp3.oã€‚
æµ·æ¹¾åˆä½œå§”å‘˜ä¼š ... ../mp3_player/app/player/play_mp3.c
   æˆåŠŸé‡åˆ¶ç›®æ ‡æ–‡ä»¶app/player/play_mp3.oã€‚</pre></dd><dd><p>This option sets the <code class="literal">basic</code> option and includes additional
                information about implicit rule searches for each
                target:</p><a></a><pre class="programlisting">File all does not exist.
  File app/player/play_mp3 does not exist.
  Looking for an implicit rule for app/player/play_mp3.
  Trying pattern rule with stem play_mp3.
  Trying implicit prerequisite app/player/play_mp3.o.
  Found an implicit rule for app/player/play_mp3.
    File app/player/play_mp3.o does not exist.
    Looking for an implicit rule for app/player/play_mp3.o.
    Trying pattern rule with stem play_mp3.
    Trying implicit prerequisite app/player/play_mp3.c.
    Found prerequisite app/player/play_mp3.c as VPATH ../mp3_player/app/player/play_mp3.c
    Found an implicit rule for app/player/play_mp3.o.
   Must remake target app/player/play_mp3.o.
gcc ... ../mp3_player/app/player/play_mp3.c
   Successfully remade target file app/player/play_mp3.o.</pre></dd><dt><span class="term"><code class="literal">jobs</code></span></dt><dt><span class="term"><code class="literal">jobs</code></span></dt><dd><p><em class="command">æ­¤é€‰é¡¹æ‰“å°make</em>è°ƒç”¨çš„å­è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ã€‚å®ƒä¸å¯ç”¨è¯¥<code class="literal">basic</code>é€‰é¡¹ã€‚</p><a id="OEBPS/ch12.html.I_7_tt514"></a><pre class="programlisting">æ”¶åˆ° SIGCHLDï¼› 1 æœªæ”¶å‰²çš„å­©å­ã€‚
æµ·æ¹¾åˆä½œå§”å‘˜ä¼š ... ../mp3_player/app/player/play_mp3.c
å°†å­è¿›ç¨‹ 0x10033800 (app/player/play_mp3.o) PID 576 æ”¾åˆ°é“¾ä¸Šã€‚
æ´»å­©å­ 0x10033800 (app/player/play_mp3.o) PID 576
æ”¶åˆ° SIGCHLDï¼› 1 æœªæ”¶å‰²çš„å­©å­ã€‚
æ”¶å‰²èŽ·èƒœå­©å­ 0x10033800 PID 576
æ­£åœ¨ä»Žé“¾ä¸­åˆ é™¤å­è¿›ç¨‹ 0x10033800 PID 576ã€‚</pre></dd><dd><p>This options prints the details of subprocesses invoked
                by <em class="command">make</em>. It does not enable
                the <code class="literal">basic</code> option.</p><a></a><pre class="programlisting">Got a SIGCHLD; 1 unreaped children.
gcc ... ../mp3_player/app/player/play_mp3.c
Putting child 0x10033800 (app/player/play_mp3.o) PID 576 on the chain.
Live child 0x10033800 (app/player/play_mp3.o) PID 576
Got a SIGCHLD; 1 unreaped children.
Reaping winning child 0x10033800 PID 576
Removing child 0x10033800 PID 576 from chain.</pre></dd><dt><span class="term"><code class="literal">all</code></span></dt><dt><span class="term"><code class="literal">all</code></span></dt><dd><p>è¿™å°†å¯ç”¨ä¹‹å‰çš„æ‰€æœ‰é€‰é¡¹ï¼Œå¹¶ä¸”æ˜¯ä½¿ç”¨è¯¥<code class="option">-d</code>é€‰é¡¹æ—¶çš„é»˜è®¤é€‰é¡¹ã€‚</p></dd><dd><p>This enables all the previous options and is the default
                when using the <code class="option">-d</code> option.</p></dd><dt><span class="term"><code class="literal">makefile</code></span></dt><dt><span class="term"><code class="literal">makefile</code></span></dt><dd><p>é€šå¸¸ï¼Œåœ¨æ›´æ–° makefile<em class="filename">åŽ</em>æ‰ä¼šå¯ç”¨è°ƒè¯•ä¿¡æ¯ã€‚è¿™åŒ…æ‹¬æ›´æ–°ä»»ä½•åŒ…å«çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ä¾èµ–é¡¹åˆ—è¡¨ã€‚å½“æ‚¨ä½¿ç”¨æ­¤ä¿®é¥°ç¬¦æ—¶ï¼Œ<em class="command">makeå°†åœ¨é‡å»º</em><em class="filename">makefile</em>å’ŒåŒ…å«æ–‡ä»¶æ—¶æ‰“å°æ‰€é€‰ä¿¡æ¯ã€‚è¯¥é€‰é¡¹å¯ç”¨è¯¥<code class="literal">basic</code>
                é€‰é¡¹ï¼Œä¹Ÿç”±è¯¥é€‰é¡¹å¯ç”¨<code class="literal">all</code>ã€‚</p></dd><dd><p>Normally, debugging information is not enabled until
                after the <em class="filename">makefile</em>s have
                been updated. This includes updating any included files, such
                as lists of dependencies. When you use this modifier, <em class="command">make</em> will print the selected
                information while rebuilding <em class="filename">makefile</em>s and include files. This
                option enables the <code class="literal">basic</code>
                option and is also enabled by the <code class="literal">all</code> option.</p></dd></dl></div></div></div></div></div></div>
<div id="OEBPS/ch12s02.html"><div>
<div class="sect1" title="ç¼–å†™è°ƒè¯•ä»£ç "><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch12s02.html.make3-CHP-12-SECT-2"></a>ç¼–å†™è°ƒè¯•ä»£ç </h1><h1 class="title"><a></a>Writing Code for Debugging</h1></div></div></div><p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œæ²¡æœ‰å¤ªå¤šç”¨äºŽè°ƒè¯•
        <em class="filename">makefile çš„</em>å·¥å…·ï¼Œåªæœ‰å‡ ç§è½¬å‚¨<em class="command">make</em>å†…éƒ¨æ•°æ®ç»“æž„çš„æ–¹æ³•å’Œä¸€äº›æ‰“å°è¯­å¥ã€‚å½’æ ¹ç»“åº•ï¼Œæ‚¨éœ€è¦ä»¥å°½é‡å‡å°‘é”™è¯¯æœºä¼šæˆ–æä¾›è‡ªå·±çš„è„šæ‰‹æž¶æ¥å¸®åŠ©è°ƒè¯•é”™è¯¯çš„æ–¹å¼ç¼–å†™<em class="filename">makefile ã€‚</em></p><p>As you can see, there aren't too many tools for debugging
        <em class="filename">makefile</em>s, just a few ways to
        dump <em class="command">make</em>'s internal data
        structures and a couple of print statements. When it comes right down
        to it, it is up to you to write your <em class="filename">makefile</em>s in ways that either minimize the
        chance of errors or provide your own scaffolding to help debug
        them.</p><p>æœ¬èŠ‚ä¸­çš„å»ºè®®åœ¨ç¼–ç å®žè·µã€é˜²å¾¡æ€§ç¼–ç å’Œè°ƒè¯•æŠ€æœ¯æ–¹é¢æœ‰äº›éšæ„ã€‚è™½ç„¶ç‰¹å®šé¡¹ç›®ï¼ˆä¾‹å¦‚æ£€æŸ¥å‘½ä»¤çš„é€€å‡ºçŠ¶æ€ï¼‰å¯ä»¥æ”¾ç½®åœ¨è‰¯å¥½ç¼–ç å®žè·µéƒ¨åˆ†æˆ–é˜²å¾¡æ€§ç¼–ç éƒ¨åˆ†ä¸­ï¼Œä½†è¿™ä¸‰ä¸ªç±»åˆ«åæ˜ äº†é€‚å½“çš„åè§ã€‚ä¸“æ³¨äºŽå¯¹ä½ çš„<em class="filename">makefile</em>è¿›è¡Œè‰¯å¥½çš„ç¼–ç ï¼Œä¸è¦èµ°å¤ªå¤šæ·å¾„ã€‚åŒ…æ‹¬å¤§é‡çš„é˜²å¾¡æ€§ç¼–ç ï¼Œä»¥ä¿æŠ¤<em class="filename">makefile</em>å…å—æ„å¤–äº‹ä»¶å’ŒçŽ¯å¢ƒæ¡ä»¶çš„å½±å“ã€‚æœ€åŽï¼Œå½“é”™è¯¯ç¡®å®žå‡ºçŽ°æ—¶ï¼Œä½¿ç”¨ä½ èƒ½æ‰¾åˆ°çš„ä¸€åˆ‡æŠ€å·§æ¥æ¶ˆé™¤å®ƒä»¬ã€‚</p><p>The suggestions in this section are laid out somewhat
        arbitrarily as coding practices, defensive coding, and debugging
        techniques. While specific items, such as checking the exit status of
        commands, could be placed in either the good coding practice section
        or the defensive coding section, the three categories reflect the
        proper bias. Focus on coding your <em class="filename">makefile</em>s well without cutting too many
        corners. Include plenty of defensive coding to protect the <em class="filename">makefile</em> against unexpected events and
        environmental conditions. Finally, when bugs do arise, use every trick
        you can find to squash them.</p><p>â€œä¿æŒç®€å•â€åŽŸåˆ™ ( <a class="ulink" href="http://www.catb.org/~esr/jargon/html/K/KISS-Principle.html">http://www.catb.org/~esr/jargon/html/K/KISS-Principle.html</a> ) æ˜¯æ‰€æœ‰ä¼˜ç§€è®¾è®¡çš„æ ¸å¿ƒã€‚æ­£å¦‚æ‚¨åœ¨å‰é¢çš„ç« èŠ‚ä¸­æ‰€çœ‹åˆ°çš„ï¼Œå³ä½¿å¯¹äºŽè¯¸å¦‚ä¾èµ–é¡¹ç”Ÿæˆä¹‹ç±»çš„æ™®é€šä»»åŠ¡ï¼Œmakefile ä¹Ÿä¼šå¾ˆå¿«å˜å¾—å¤æ‚<em class="filename">ã€‚</em>æŠµåˆ¶åœ¨æž„å»ºç³»ç»Ÿä¸­åŒ…å«è¶Šæ¥è¶Šå¤šåŠŸèƒ½çš„è¶‹åŠ¿ã€‚ä½ ä¼šå¤±è´¥ï¼Œä½†ä¸ä¼šåƒä½ ç®€å•åœ°åŒ…å«ä½ æƒ³åˆ°çš„æ¯ä¸€ä¸ªåŠŸèƒ½é‚£æ ·ä¸¥é‡ã€‚</p><p>The "Keep It Simple" Principle (<a class="ulink" href="http://www.catb.org/~esr/jargon/html/K/KISS-Principle.html">http://www.catb.org/~esr/jargon/html/K/KISS-Principle.html</a>)
        is at the heart of all good design. As you've seen in previous
        chapters, <em class="filename">makefile</em>s can quickly
        become complex, even for mundane tasks, such as dependency generation.
        Fight the tendency to include more and more features in your build
        system. You'll fail, but not as badly as you would if you simply
        include every feature that occurs to you.</p><div class="sect2" title="è‰¯å¥½çš„ç¼–ç å®žè·µ"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch12s02.html.make3-CHP-12-SECT-2.1"></a>è‰¯å¥½çš„ç¼–ç å®žè·µ</h2><h2 class="title"><a></a>Good Coding Practices</h2></div></div></div><p>æ ¹æ®æˆ‘çš„ç»éªŒï¼Œå¤§å¤šæ•°<a id="OEBPS/ch12s02.html.make3-CHP-12-ITERM-1592" class="indexterm"></a> <a id="OEBPS/ch12s02.html.make3-CHP-12-ITERM-1593" class="indexterm"></a>ç¨‹åºå‘˜å¹¶ä¸å°†ç¼–å†™<em class="filename">makefile</em>è§†ä¸ºç¼–ç¨‹ï¼Œå› æ­¤ä¸ä¼šåƒç”¨ C++ æˆ– Java ç¼–å†™æ—¶é‚£æ ·å°å¿ƒè°¨æ…Žã€‚ä½†<em class="command">make</em>è¯­è¨€æ˜¯ä¸€ç§å®Œå…¨çš„éžè¿‡ç¨‹è¯­è¨€ã€‚å¦‚æžœæž„å»ºç³»ç»Ÿçš„å¯é æ€§å’Œå¯ç»´æŠ¤æ€§å¾ˆé‡è¦ï¼Œè¯·å°å¿ƒç¼–å†™å¹¶å°½å¯èƒ½ä½¿ç”¨æœ€ä½³ç¼–ç å®žè·µã€‚</p><p>In my experience, most <a class="indexterm"></a> <a class="indexterm"></a>programmers do not see writing <em class="filename">makefile</em>s as programming and, therefore,
          do not take the same care as they do when writing in C++ or Java.
          But the <em class="command">make</em> language is a
          complete nonprocedural language. If the reliability and
          maintainability of your build system is important, write it with
          care and use the best coding practices you can.</p><p><em class="filename">ç¼–å†™å¥å£®çš„makefile</em>çš„æœ€é‡è¦æ–¹é¢ä¹‹ä¸€
          æ˜¯æ£€æŸ¥å‘½ä»¤çš„è¿”å›žçŠ¶æ€ã€‚å½“ç„¶ï¼Œ<em class="command">make</em>ä¼šè‡ªåŠ¨æ£€æŸ¥ç®€å•å‘½ä»¤ï¼Œä½†æ˜¯<em class="filename">makefile</em>é€šå¸¸åŒ…å«å¯èƒ½ä¼šæ‚„æ‚„å¤±è´¥çš„å¤åˆå‘½ä»¤ï¼š</p><p>One of the most important aspects of programming robust
          <em class="filename">makefile</em>s is to check the
          return status of commands. Of course, <em class="command">make</em> will check simple commands
          automatically, but <em class="filename">makefile</em>s
          often include compound commands that can fail quietly:</p><a id="OEBPS/ch12s02.html.I_7_tt515"></a><pre class="programlisting">åšï¼š
        cd æˆ‘-ä¸å­˜åœ¨ï¼› \
        å›žæ˜¾*.c</pre><pre class="programlisting">do:
        cd i-dont-exist; \
        echo *.c</pre><p>è¿è¡Œæ—¶ï¼Œæ­¤<em class="filename">makefile</em>
          ä¸ä¼šå› é”™è¯¯çŠ¶æ€è€Œç»ˆæ­¢ï¼Œå°½ç®¡è‚¯å®šä¼šå‘ç”Ÿé”™è¯¯ï¼š</p><p>When run, this <em class="filename">makefile</em>
          does not terminate with an error status, although an error most
          definitely occurs:</p><a id="OEBPS/ch12s02.html.I_7_tt516"></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
cd æˆ‘-ä¸å­˜åœ¨ï¼› \
å›žæ˜¾*.c
/bin/sh: ç¬¬ 1 è¡Œ: cd: i-dont-exist: æ²¡æœ‰è¿™æ ·çš„æ–‡ä»¶æˆ–ç›®å½•
*ã€‚C</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
cd i-dont-exist; \
echo *.c
/bin/sh: line 1: cd: i-dont-exist: No such file or directory
*.c</pre><p>æ­¤å¤–ï¼Œé€šé…è¡¨è¾¾å¼æ— æ³•æ‰¾åˆ°ä»»ä½•
          <em class="filename">.c</em>æ–‡ä»¶ï¼Œå› æ­¤å®ƒä¼šæ‚„æ‚„åœ°è¿”å›žé€šé…è¡¨è¾¾å¼ã€‚å“Žå‘€ã€‚ç¼–å†™æ­¤å‘½ä»¤è„šæœ¬çš„æ›´å¥½æ–¹æ³•æ˜¯ä½¿ç”¨ shell çš„åŠŸèƒ½æ¥æ£€æŸ¥å’Œé˜²æ­¢é”™è¯¯ï¼š</p><p>Furthermore, the globbing expression fails to find any
          <em class="filename">.c</em> files, so it quietly returns
          the globbing expression. Oops. A better way to code this command
          script is to use the shell's features for checking and preventing
          errors:</p><a id="OEBPS/ch12s02.html.I_7_tt517"></a><pre class="programlisting">å¤–å£³=/bin/bash
åšï¼š
        cd æˆ‘ä¸å­˜åœ¨ &amp;&amp; \
        shopt -s nullglob &amp;&amp;\
        å›žæ˜¾*.c</pre><pre class="programlisting">SHELL = /bin/bash
do:
        cd i-dont-exist &amp;&amp; \
        shopt -s nullglob &amp;&amp;\
        echo *.c</pre><p>çŽ°åœ¨<em class="command">cd</em>é”™è¯¯å·²æ­£ç¡®ä¼ è¾“åˆ°<em class="command">make</em>ï¼Œ
           <em class="command">echo</em>å‘½ä»¤æ°¸è¿œä¸ä¼šæ‰§è¡Œï¼Œå¹¶ä¸”
          <em class="command">make</em>ä»¥é”™è¯¯çŠ¶æ€ç»ˆæ­¢ã€‚æ­¤å¤–ï¼Œè®¾ç½®<em class="command">bash</em><code class="option">nullglob</code>é€‰é¡¹
          ä¼šå¯¼è‡´é€šé…æ¨¡å¼åœ¨æœªæ‰¾åˆ°æ–‡ä»¶æ—¶è¿”å›žç©ºå­—ç¬¦ä¸²ã€‚ ï¼ˆå½“ç„¶ï¼Œæ‚¨çš„ç‰¹å®šåº”ç”¨ç¨‹åºå¯èƒ½æ›´å–œæ¬¢é€šé…æ¨¡å¼ã€‚ï¼‰<em class="command"></em></p><p>Now the <em class="command">cd</em> error is
          properly transmitted to <em class="command">make</em>, the
          <em class="command">echo</em> command never executes, and
          <em class="command">make</em> terminates with an error
          status. In addition, setting the <code class="option">nullglob</code> option of
          <em class="command">bash</em> causes the globbing pattern
          to return the empty string if no files are found. (Of course, your
          particular application may prefer the globbing pattern.)</p><a id="OEBPS/ch12s02.html.I_7_tt518"></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
cd æˆ‘ä¸å­˜åœ¨ &amp;&amp; \
å›žæ˜¾*.c
/bin/sh: ç¬¬ 1 è¡Œ: cd: i-dont-exist: æ²¡æœ‰è¿™æ ·çš„æ–‡ä»¶æˆ–ç›®å½•
make: *** [do] é”™è¯¯ 1</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
cd i-dont-exist &amp;&amp; \
echo *.c
/bin/sh: line 1: cd: i-dont-exist: No such file or directory
make: *** [do] Error 1</pre><p>å¦ä¸€ä¸ªå¥½çš„ç¼–ç å®žè·µæ˜¯æ ¼å¼åŒ–ä»£ç ä»¥èŽ·å¾—æœ€å¤§çš„å¯è¯»æ€§ã€‚æˆ‘çœ‹åˆ°çš„å¤§å¤šæ•°<em class="filename">makefile</em>çš„æ ¼å¼éƒ½å¾ˆç³Ÿç³•ï¼Œå› æ­¤éš¾ä»¥é˜…è¯»ã€‚æ‚¨è§‰å¾—å“ªä¸ªæ›´å®¹æ˜“é˜…è¯»ï¼Ÿ</p><p>Another good coding practice is formatting your code for
          maximum readability. Most <em class="filename">makefile</em>s I see are poorly formatted and,
          consequently, difficult to read. Which do you find easier to
          read?</p><a id="OEBPS/ch12s02.html.I_7_tt519"></a><pre class="programlisting">_MKDIRS := $(shell for d in $(REQUIRED_DIRS); do [[ -d $$d \
]] || mkdir -p $$d;å®Œæ¯•ï¼‰</pre><pre class="programlisting">_MKDIRS := $(shell for d in $(REQUIRED_DIRS); do [[ -d $$d \
]] || mkdir -p $$d; done)</pre><p>æˆ–è€…ï¼š</p><p>or:</p><a id="OEBPS/ch12s02.html.I_7_tt520"></a><pre class="programlisting">_MKDIRS := $(å¤–å£³\
             for d in $(REQUIRED_DIRS); \
             åš \
               [[ -d $$d ]] || mkdir -p $$d; \
             å®Œæ¯•ï¼‰</pre><pre class="programlisting">_MKDIRS := $(shell                            \
             for d in $(REQUIRED_DIRS);       \
             do                               \
               [[ -d $$d ]] || mkdir -p $$d;  \
             done)</pre><p>å¦‚æžœæ‚¨åƒå¤§å¤šæ•°äººä¸€æ ·ï¼Œæ‚¨ä¼šå‘çŽ°ç¬¬ä¸€ä¸ªæ›´éš¾ä»¥è§£æžï¼Œåˆ†å·æ›´éš¾æ‰¾åˆ°ï¼Œå¹¶ä¸”è¯­å¥çš„æ•°é‡æ›´éš¾ä»¥è®¡æ•°ã€‚è¿™äº›éƒ½ä¸æ˜¯å°äº‹ã€‚åœ¨å‘½ä»¤è„šæœ¬ä¸­é‡åˆ°çš„è¯­æ³•é”™è¯¯å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯ç”±äºŽç¼ºå°‘åˆ†å·ã€åæ–œæ æˆ–å…¶ä»–åˆ†éš”ç¬¦ï¼ˆä¾‹å¦‚ç®¡é“ç¬¦å’Œé€»è¾‘è¿ç®—ç¬¦ï¼‰é€ æˆçš„ã€‚</p><p>If you're like most people, you'll find the first more
          difficult to parse, the semicolons harder to find, and the number of
          statements more difficult to count. These are not trivial concerns.
          A significant percentage of the syntax errors you will encounter in
          command scripts will be due to missing semicolons, backslashes, or
          other separators, such as pipe and logical operators.</p><p>å¦è¯·æ³¨æ„ï¼Œå¹¶éžæ‰€æœ‰ä¸¢å¤±çš„åˆ†éš”ç¬¦éƒ½ä¼šç”Ÿæˆé”™è¯¯ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹é”™è¯¯éƒ½ä¸ä¼šäº§ç”Ÿ shell è¯­æ³•é”™è¯¯ï¼š</p><p>Also, note that not all missing separators will generate an
          error. For instance, neither of the following errors will produce a
          shell syntax error:</p><a id="OEBPS/ch12s02.html.I_7_tt521"></a><pre class="programlisting">æ ‡ç­¾ï¼š
        å…‰ç›˜æºæ–‡ä»¶\
        ctags--é€’å½’

ç£ç›˜ç©ºé—²ï¼š
        echoâ€œæ­£åœ¨æ£€æŸ¥å¯ç”¨ç£ç›˜ç©ºé—´...â€\
        df ã€‚ | awk '{ æ‰“å° $$4 }'</pre><pre class="programlisting">TAGS:
        cd src \
        ctags --recurse

disk_free:
        echo "Checking free disk space..." \
        df . | awk '{ print $$4 }'</pre><p>æ ¼å¼åŒ–å‘½ä»¤ä»¥æé«˜å¯è¯»æ€§å°†ä½¿æ­¤ç±»é”™è¯¯æ›´å®¹æ˜“æ•èŽ·ã€‚å½“æ ¼å¼åŒ–ç”¨æˆ·å®šä¹‰å‡½æ•°æ—¶ï¼Œç¼©è¿›ä»£ç ã€‚æœ‰æ—¶ï¼Œç”Ÿæˆçš„å®æ‰©å±•ä¸­çš„é¢å¤–ç©ºæ ¼ä¼šå¯¼è‡´é—®é¢˜ã€‚å¦‚æžœæ˜¯è¿™æ ·ï¼Œè¯·å°†æ ¼å¼åŒ–åŒ…è£…åœ¨
          <code class="function">strip</code>å‡½æ•°è°ƒç”¨ä¸­ã€‚å½“æ ¼å¼åŒ–é•¿å€¼åˆ—è¡¨æ—¶ï¼Œå°†æ¯ä¸ªå€¼åˆ†éš”åœ¨è‡ªå·±çš„è¡Œä¸Šã€‚åœ¨æ¯ä¸ªç›®æ ‡ä¹‹å‰æ·»åŠ æ³¨é‡Šï¼Œç»™å‡ºç®€è¦è¯´æ˜Žï¼Œå¹¶è®°å½•å‚æ•°åˆ—è¡¨ã€‚</p><p>Formatting commands for readability will make these kinds of
          errors easier to catch. When formatting user-defined functions,
          indent the code. Occasionally, the extra spaces in the resulting
          macro expansion cause problems. If so, wrap the formatting in a
          <code class="function">strip</code> function call. When
          formatting long lists of values, separate each value on its own
          line. Add a comment before each target, give a brief explanation,
          and document the parameter list.</p><p>ä¸‹ä¸€ä¸ªå¥½çš„ç¼–ç å®žè·µæ˜¯è‡ªç”±ä½¿ç”¨å˜é‡æ¥ä¿å­˜å…±åŒçš„å€¼ã€‚ä¸Žä»»ä½•ç¨‹åºä¸€æ ·ï¼Œæ— é™åˆ¶åœ°ä½¿ç”¨æ–‡å­—å€¼ä¼šå¯¼è‡´ä»£ç é‡å¤å¹¶å¯¼è‡´ç»´æŠ¤é—®é¢˜å’Œé”™è¯¯ã€‚å˜é‡çš„å¦ä¸€ä¸ªå·¨å¤§ä¼˜ç‚¹æ˜¯ï¼Œæ‚¨å¯ä»¥åœ¨æ‰§è¡ŒæœŸé—´<em class="command">æ˜¾ç¤º</em>å®ƒä»¬ä»¥è¿›è¡Œè°ƒè¯•ã€‚æˆ‘åœ¨æœ¬ç« åŽé¢çš„<a class="link" href="#OEBPS/ch12s02.html.make3-CHP-12-SECT-2.3" title="è°ƒè¯•æŠ€å·§">12.2.3 èŠ‚</a>ä¸­å±•ç¤ºäº†ä¸€ä¸ªå¾ˆå¥½çš„å‘½ä»¤è¡Œç•Œé¢ã€‚</p><p>The next good coding practice is the liberal use of variables
          to hold common values. As in any program, the unrestrained use of
          literal values creates code duplication and leads to maintenance
          problems and bugs. Another great advantage of variables is that you
          can get <em class="command">make</em> to display them for
          debugging purposes during execution. I show a nice command line
          interface in <a class="link" href="#OEBPS/ch12s02.html.make3-CHP-12-SECT-2.3" title="Debugging Techniques">Section
          12.2.3</a>, later in this chapter.</p></div><div class="sect2" title="é˜²å¾¡æ€§ç¼–ç "><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch12s02.html.make3-CHP-12-SECT-2.2"></a>é˜²å¾¡æ€§ç¼–ç </h2><h2 class="title"><a></a>Defensive Coding</h2></div></div></div><p>é˜²å¾¡æ€§ä»£ç æ˜¯å¯ä»¥<a id="OEBPS/ch12s02.html.make3-CHP-12-ITERM-1594" class="indexterm"></a> <a id="OEBPS/ch12s02.html.make3-CHP-12-ITERM-1595" class="indexterm"></a>ä»…å½“æ‚¨çš„å‡è®¾æˆ–æœŸæœ›ä¹‹ä¸€é”™è¯¯æ—¶æ‰æ‰§è¡Œ -<code class="function">if</code>
          æ°¸è¿œä¸æ­£ç¡®çš„æµ‹è¯•ã€<code class="function">assert</code>æ°¸è¿œä¸ä¼šå¤±è´¥çš„å‡½æ•°æˆ–è·Ÿè¸ªä»£ç ã€‚å½“ç„¶ï¼Œè¿™æ®µä»Žä¸æ‰§è¡Œçš„ä»£ç çš„ä»·å€¼åœ¨äºŽï¼Œå¶å°”ï¼ˆé€šå¸¸æ˜¯åœ¨æ‚¨æœ€æ„æƒ³ä¸åˆ°çš„æ—¶å€™ï¼‰ï¼Œå®ƒç¡®å®žä¼šè¿è¡Œå¹¶äº§ç”Ÿè­¦å‘Šæˆ–é”™è¯¯ï¼Œæˆ–è€…æ‚¨é€‰æ‹©å¯ç”¨è·Ÿè¸ªä»£ç ä»¥å…è®¸æ‚¨æŸ¥çœ‹<em class="command">make</em>çš„å†…éƒ¨å·¥ä½œåŽŸç†ã€‚</p><p>Defensive code is code that can <a class="indexterm"></a> <a class="indexterm"></a>execute only if one of your assumptions or
          expectations is wrong â€” an <code class="function">if</code>
          test that is never true, an <code class="function">assert</code> function that never fails, or
          tracing code. Of course, the value of this code that never executes
          is that occasionally (usually when you least expect it), it does run
          and produce a warning or error, or you choose to enable tracing code
          to allow you to view the inner workings of <em class="command">make</em>.</p><p>æ‚¨å·²ç»åœ¨å…¶ä»–ä¸Šä¸‹æ–‡ä¸­çœ‹åˆ°è¿‡æ­¤ä»£ç çš„å¤§éƒ¨åˆ†å†…å®¹ï¼Œä½†ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œè¿™é‡Œé‡å¤ä¸€ä¸‹ã€‚</p><p>You've already seen most of this code in other contexts, but
          for convenience it is repeated here.</p><p>éªŒè¯æ£€æŸ¥æ˜¯é˜²å¾¡æ€§ä»£ç çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚æ­¤ä»£ç ç¤ºä¾‹éªŒè¯å½“å‰æ‰§è¡Œçš„<em class="command">make</em>ç‰ˆæœ¬
          æ˜¯å¦ä¸º 3.80ï¼š</p><p>Validation checking is a great example of defensive code. This
          code sample verifies that the currently executing version of
          <em class="command">make</em> is 3.80:</p><a id="OEBPS/ch12s02.html.I_7_tt522"></a><pre class="programlisting">éœ€è¦ç‰ˆæœ¬ï¼š= 3.80
$(å¦‚æžœ$(è¿‡æ»¤$(NEED_VERSION),$(MAKE_VERSION)),, \
  $(é”™è¯¯æ‚¨å¿…é¡»è¿è¡Œ make ç‰ˆæœ¬ $(NEED_VERSION)ã€‚))</pre><pre class="programlisting">NEED_VERSION := 3.80
$(if $(filter $(NEED_VERSION),$(MAKE_VERSION)),,              \
  $(error You must be running make version $(NEED_VERSION).))</pre><p>å¯¹äºŽ Java åº”ç”¨ç¨‹åºï¼Œåœ¨<code class="literal">CLASSPATH</code>.</p><p>For Java applications, it is useful to include a check for
          files in the <code class="literal">CLASSPATH</code>.</p><p>éªŒè¯ä»£ç è¿˜å¯ä»¥ç®€å•åœ°ç¡®ä¿æŸäº›å†…å®¹æ˜¯çœŸå®žçš„ã€‚ä¸Šä¸€èŠ‚ä¸­çš„ç›®å½•åˆ›å»ºä»£ç å°±æ˜¯è¿™ç§æ€§è´¨ã€‚</p><p>Validation code can also simply ensure that something is true.
          The directory creation code from the previous section is of this
          nature.</p><p>å¦ä¸€ç§å¾ˆæ£’çš„é˜²å¾¡æ€§ç¼–ç æŠ€æœ¯æ˜¯ä½¿ç”¨
          <a class="link" href="#OEBPS/ch04.html" title="ç¬¬ 4 ç« å‡½æ•°">ç¬¬ 4 ç« </a><a class="link" href="#OEBPS/ch04s02.html.make3-CHP-4-SECT-2.4" title="æµé‡æŽ§åˆ¶">4.2.4 èŠ‚</a>ä¸­<code class="function">assert</code>å®šä¹‰çš„å‡½æ•°
          ã€‚è¿™é‡Œæœ‰å‡ ä¸ªç‰ˆæœ¬ï¼š<a class="link" href="#OEBPS/ch04s02.html.make3-CHP-4-SECT-2.4" title="æµé‡æŽ§åˆ¶"></a><a class="link" href="#OEBPS/ch04.html" title="ç¬¬ 4 ç« å‡½æ•°"></a></p><p>Another great defensive coding technique is to use the
          <code class="function">assert</code> functions defined in
          <a class="link" href="#OEBPS/ch04s02.html.make3-CHP-4-SECT-2.4" title="Flow Control">Section 4.2.4</a> in <a class="link" href="#OEBPS/ch04.html" title="Chapter&nbsp;4.&nbsp;Functions">Chapter 4</a>. Here are several
          versions:</p><a id="OEBPS/ch12s02.html.I_7_tt523"></a><pre class="programlisting"># $(è°ƒç”¨æ–­è¨€,æ¡ä»¶,æ¶ˆæ¯)
å®šä¹‰æ–­è¨€
  $(å¦‚æžœ $1,,$(é”™è¯¯æ–­è¨€å¤±è´¥: $2))
æ©å¾·å¤«

# $(è°ƒç”¨æ–­è¨€æ–‡ä»¶å­˜åœ¨ï¼Œé€šé…ç¬¦æ¨¡å¼)
å®šä¹‰æ–­è¨€æ–‡ä»¶å­˜åœ¨
  $(è°ƒç”¨æ–­è¨€,$(é€šé…ç¬¦$1),$1ä¸å­˜åœ¨)
æ©å¾·å¤«

# $(è°ƒç”¨æ–­è¨€éžç©ºï¼Œmake-variable)
å®šä¹‰æ–­è¨€éžç©º
  $(è°ƒç”¨æ–­è¨€,$($1),å˜é‡â€œ$1â€ä¸ºç©º)
æ©å¾·å¤«</pre><pre class="programlisting"># $(call assert,condition,message)
define assert
  $(if $1,,$(error Assertion failed: $2))
endef

# $(call assert-file-exists,wildcard-pattern)
define assert-file-exists
  $(call assert,$(wildcard $1),$1 does not exist)
endef

# $(call assert-not-null,make-variable)
define assert-not-null
  $(call assert,$($1),The variable "$1" is null)
endef</pre><p>æˆ‘å‘çŽ°åœ¨<em class="filename">makefile</em><code class="function">assert</code>
          å‘¨å›´è¿›è¡Œå°‘é‡è°ƒç”¨æ˜¯æ£€æµ‹ä¸¢å¤±å’Œæ‹¼å†™é”™è¯¯çš„å‚æ•°ä»¥åŠè¿åå…¶ä»–å‡è®¾çš„æƒ…å†µçš„ä¸€ç§å»‰ä»·è€Œæœ‰æ•ˆçš„æ–¹æ³•ã€‚<em class="filename"></em></p><p>I find sprinkling <code class="function">assert</code>
          calls around the <em class="filename">makefile</em> to be
          a cheap and effective way of detecting missing and misspelled
          parameters as well as violations of other assumptions.</p><p>åœ¨<a class="link" href="#OEBPS/ch04.html" title="ç¬¬ 4 ç« å‡½æ•°">ç¬¬ 4 ç« </a>ä¸­ï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€å¯¹å‡½æ•°æ¥è·Ÿè¸ªç”¨æˆ·å®šä¹‰å‡½æ•°çš„æ‰©å±•ï¼š</p><p>In <a class="link" href="#OEBPS/ch04.html" title="Chapter&nbsp;4.&nbsp;Functions">Chapter 4</a>, we wrote a
          pair of functions to trace the expansion of user-defined
          functions:</p><a id="OEBPS/ch12s02.html.I_7_tt524"></a><pre class="programlisting"># $(è°ƒè¯•è¾“å…¥)
è°ƒè¯•è¾“å…¥ = $(å¦‚æžœ $(debug_trace),\
                $(è­¦å‘Šè¾“å…¥$0($(echo-args))))

# $(è°ƒè¯•ç¦»å¼€)
debug-leave = $(if $(debug_trace),$(è­¦å‘Šç¦»å¼€ $0))

é€—å· := ,
echo-args = $(subst ' ','$(é€—å·) ',\
                $(foreach a,1 2 3 4 5 6 7 8 9,'$($a)'))</pre><pre class="programlisting"># $(debug-enter)
debug-enter = $(if $(debug_trace),\
                $(warning Entering $0($(echo-args))))

# $(debug-leave)
debug-leave = $(if $(debug_trace),$(warning Leaving $0))

comma := ,
echo-args   = $(subst ' ','$(comma) ',\
                $(foreach a,1 2 3 4 5 6 7 8 9,'$($a)'))</pre><p>æ‚¨å¯ä»¥å°†è¿™äº›å®è°ƒç”¨æ·»åŠ åˆ°æ‚¨è‡ªå·±çš„å‡½æ•°ä¸­ï¼Œå¹¶ä½¿å…¶ä¿æŒç¦ç”¨çŠ¶æ€ï¼Œç›´åˆ°éœ€è¦è¿›è¡Œè°ƒè¯•ä¸ºæ­¢ã€‚è¦å¯ç”¨å®ƒä»¬ï¼Œè¯·è®¾ç½®<code class="literal">debug_trace</code>ä¸ºä»»ä½•éžç©ºå€¼ï¼š</p><p>You can add these macro calls to your own functions and leave
          them disabled until they are required for debugging. To enable them,
          set <code class="literal">debug_trace</code> to any nonempty
          value:</p><a id="OEBPS/ch12s02.html.I_7_tt525"></a><pre class="programlisting">$ ä½¿ debug_trace=1</pre><pre class="programlisting">$ make debug_trace=1</pre><p><a class="link" href="#OEBPS/ch04.html" title="ç¬¬ 4 ç« å‡½æ•°">æ­£å¦‚ç¬¬ 4 ç« </a>æ‰€è¿°ï¼Œè¿™äº›è·Ÿè¸ªå®æœ¬èº«ä¹Ÿæœ‰è®¸å¤šé—®é¢˜ï¼Œä½†å¯¹äºŽè·Ÿè¸ªé”™è¯¯ä»ç„¶å¾ˆæœ‰ç”¨ã€‚</p><p>As noted in <a class="link" href="#OEBPS/ch04.html" title="Chapter&nbsp;4.&nbsp;Functions">Chapter 4</a>,
          these trace macros have a number of problems of their own but can
          still be useful in tracking down bugs.</p><p>æœ€åŽçš„é˜²å¾¡æ€§ç¼–ç¨‹æŠ€æœ¯åªæ˜¯<code class="literal">@</code>é€šè¿‡<em class="command">make</em>
          å˜é‡ä½¿ç”¨å®ƒæ¥è½»æ¾ç¦ç”¨å‘½ä»¤ä¿®é¥°ç¬¦ï¼Œè€Œä¸æ˜¯å­—é¢æ„æ€ï¼š</p><p>The final defensive programming technique is simply to make
          disabling the <code class="literal">@</code> command modifier
          easy by using it through a <em class="command">make</em>
          variable, rather than literally:</p><a id="OEBPS/ch12s02.html.I_7_tt526"></a><pre class="programlisting">å®‰é™:=@
...
ç›®æ ‡ï¼š
        $ï¼ˆå®‰é™ï¼‰<em class="replaceable"><code>some command</code></em></pre><pre class="programlisting">QUIET := @
...
target:
        $(QUIET)<em class="replaceable"><code>some command</code></em></pre><p><code class="literal">QUIET</code>ä½¿ç”¨è¿™ç§æŠ€æœ¯ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸Šé‡æ–°å®šä¹‰æ¥æŸ¥çœ‹é™é»˜å‘½ä»¤çš„æ‰§è¡Œæƒ…å†µï¼š</p><p>Using this technique, you can see the execution of the silent
          command by redefining <code class="literal">QUIET</code> on
          the command line:</p><a id="OEBPS/ch12s02.html.I_7_tt527"></a><pre class="programlisting">$ ä¿æŒå®‰é™=</pre><pre class="programlisting">$ make QUIET=</pre></div><div class="sect2" title="è°ƒè¯•æŠ€å·§"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch12s02.html.make3-CHP-12-SECT-2.3"></a>è°ƒè¯•æŠ€å·§</h2><h2 class="title"><a></a>Debugging Techniques</h2></div></div></div><p>æœ¬èŠ‚è®¨è®º<a id="OEBPS/ch12s02.html.make3-CHP-12-ITERM-1596" class="indexterm"></a>ä¸€èˆ¬è°ƒè¯•æŠ€æœ¯å’Œé—®é¢˜ã€‚æœ€ç»ˆï¼Œè°ƒè¯•æ˜¯é€‚åˆæ‚¨æƒ…å†µçš„ä»»ä½•ä¸œè¥¿çš„ä¸€ä¸ªæŠ“åŒ…ã€‚è¿™äº›æŠ€æœ¯å¯¹æˆ‘å¾ˆæœ‰æ•ˆï¼Œè€Œä¸”æˆ‘å·²ç»å¼€å§‹ä¾èµ–å®ƒä»¬æ¥è°ƒè¯•æœ€ç®€å•çš„<em class="filename">makefile</em>é—®é¢˜ã€‚ä¹Ÿè®¸ä»–ä»¬ä¹Ÿä¼šå¸®åŠ©ä½ ã€‚</p><p>This section discusses <a class="indexterm"></a>general debugging techniques and issues. Ultimately,
          debugging is a grab-bag of whatever works for your situation. These
          techniques have worked for me, and I've come to rely on them to
          debug even the simplest <em class="filename">makefile</em> problems. Maybe they'll help
          you, too.</p><p>3.80 ä¸­éžå¸¸çƒ¦äººçš„é”™è¯¯ä¹‹ä¸€æ˜¯ï¼Œå½“<em class="command">makeæŠ¥å‘Š</em><em class="filename">makefile</em>ä¸­çš„é—®é¢˜å¹¶åŒ…å«è¡Œå·æ—¶ï¼Œæˆ‘é€šå¸¸ä¼šå‘çŽ°è¡Œå·æ˜¯é”™è¯¯çš„ã€‚æˆ‘è¿˜æ²¡æœ‰è°ƒæŸ¥é—®é¢˜æ˜¯å¦æ˜¯ç”±äºŽåŒ…å«æ–‡ä»¶ã€å¤šè¡Œå˜é‡èµ‹å€¼æˆ–ç”¨æˆ·å®šä¹‰çš„å®å¼•èµ·çš„ï¼Œä½†ç¡®å®žå¦‚æ­¤ã€‚é€šå¸¸ï¼Œ<em class="command">ç”Ÿæˆ</em>æŠ¥å‘Šçš„è¡Œå·å¤§äºŽå®žé™…è¡Œå·ã€‚åœ¨å¤æ‚çš„<em class="filename">makefile</em>ä¸­ï¼Œè¡Œå·ç›¸å·®äº† 20 è¡Œä¹‹å¤šã€‚</p><p>One of the very annoying bugs in 3.80 is that when <em class="command">make</em> reports problems in <em class="filename">makefile</em>s and includes a line number, I
          usually find that the line number is wrong. I haven't investigated
          whether the problem is due to include files, multiline variable
          assignments, or user-defined macros, but there it is. Usually the
          line number <em class="command">make</em> reports is
          larger than the actual line number. In complex <em class="filename">makefile</em>s, I've had the line number be
          off by as much as 20 lines.</p><p><em class="command">é€šå¸¸ï¼ŒæŸ¥çœ‹make</em>å˜é‡å€¼çš„æœ€ç®€å•æ–¹æ³•æ˜¯åœ¨ç›®æ ‡æ‰§è¡ŒæœŸé—´æ‰“å°å®ƒã€‚å°½ç®¡ä½¿ç”¨æ·»åŠ æ‰“å°è¯­å¥
          å¾ˆç®€å•ï¼Œ
          ä½†ä»Žé•¿è¿œæ¥çœ‹ï¼Œ<code class="function">warning</code>æ·»åŠ ç”¨äºŽæ‰“å°å˜é‡çš„é€šç”¨ç›®æ ‡çš„é¢å¤–å·¥ä½œå¯ä»¥èŠ‚çœå¤§é‡æ—¶é—´ã€‚<code class="literal">debug</code>è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹<code class="literal">debug</code>
          ç›®æ ‡ï¼š</p><p>Often the easiest way to see the value of a <em class="command">make</em> variable is to print it during the
          execution of a target. Although adding print statements using
          <code class="function">warning</code> is simple, the extra
          effort of adding a generic <code class="literal">debug</code>
          target for printing variables can save lots of time in the long run.
          Here is a sample <code class="literal">debug</code>
          target:</p><a id="OEBPS/ch12s02.html.I_7_tt528"></a><pre class="programlisting">è°ƒè¯•ï¼š
        $(å¯¹äºŽ v,$(V), \
          $(è­¦å‘Š$v = $($v)))</pre><pre class="programlisting">debug:
        $(for v,$(V), \
          $(warning $v = $($v)))</pre><p>è¦ä½¿ç”¨å®ƒï¼Œåªéœ€è®¾ç½®è¦åœ¨å‘½ä»¤è¡Œä¸Šæ‰“å°çš„å˜é‡åˆ—è¡¨ï¼Œå¹¶åŒ…å«ç›®æ ‡<code class="literal">debug</code>ï¼š</p><p>To use it, just set the list of variables to print on the
          command line, and include the <code class="literal">debug</code> target:</p><a id="OEBPS/ch12s02.html.I_7_tt529"></a><pre class="programlisting">$ make V="USERNAME SHELL" è°ƒè¯•
makefile:2: ç”¨æˆ·å = æ‰€æœ‰è€…
makefile:2: SHELL = /bin/sh.exe
makeï¼šè°ƒè¯•æ˜¯æœ€æ–°çš„ã€‚</pre><pre class="programlisting">$ make V="USERNAME SHELL" debug
makefile:2: USERNAME = Owner
makefile:2: SHELL = /bin/sh.exe
make: debug is up to date.</pre><p>å¦‚æžœä½ æƒ³å˜å¾—éžå¸¸æ£˜æ‰‹ï¼Œä½ å¯ä»¥ä½¿ç”¨å˜é‡<code class="literal">MAKECMDGOALS</code>æ¥é¿å…ç»™å˜é‡èµ‹å€¼<code class="literal">V</code>ï¼š</p><p>If you want to get really tricky, you can use the <code class="literal">MAKECMDGOALS</code> variable to avoid the
          assignment to the variable <code class="literal">V</code>:</p><a id="OEBPS/ch12s02.html.I_7_tt530"></a><pre class="programlisting">è°ƒè¯•ï¼š
        $(å¯¹äºŽ v,$(V) $(MAKECMDGOALS), \
          $(å¦‚æžœ$(è¿‡æ»¤å™¨è°ƒè¯•,$v),,$(è­¦å‘Š$v = $($v))))</pre><pre class="programlisting">debug:
        $(for v,$(V) $(MAKECMDGOALS), \
          $(if $(filter debug,$v),,$(warning $v = $($v))))</pre><p>çŽ°åœ¨ï¼Œæ‚¨åªéœ€åœ¨å‘½ä»¤è¡Œä¸Šåˆ—å‡ºå˜é‡å³å¯æ‰“å°å˜é‡ã€‚ä¸è¿‡ï¼Œæˆ‘ä¸æŽ¨èè¿™ç§æŠ€æœ¯ï¼Œå› ä¸ºæ‚¨è¿˜ä¼šæ”¶åˆ°ä»¤äººå›°æƒ‘çš„<em class="command">make</em>
          è­¦å‘Šï¼Œè¡¨æ˜Žå®ƒä¸çŸ¥é“å¦‚ä½•æ›´æ–°å˜é‡ï¼ˆå› ä¸ºå®ƒä»¬è¢«åˆ—ä¸ºç›®æ ‡ï¼‰ï¼š</p><p>Now you can print variables by simply listing them on the
          command line. I don't recommend this technique, though, because
          you'll also get confusing <em class="command">make</em>
          warnings indicating it doesn't know how to update the variables
          (since they are listed as targets):</p><a id="OEBPS/ch12s02.html.I_7_tt531"></a><pre class="programlisting">$<strong class="userinput"><code>make debug USERNAME SHELL</code></strong>
makefile:2: ç”¨æˆ·å = æ‰€æœ‰è€…
makefile:2: SHELL = /bin/sh.exe
makeï¼šè°ƒè¯•æ˜¯æœ€æ–°çš„ã€‚
make: *** æ²¡æœ‰è§„åˆ™å¯ä»¥åˆ›å»ºç›®æ ‡ç”¨æˆ·åã€‚åœæ­¢ã€‚</pre><pre class="programlisting">$<strong class="userinput"><code>make debug USERNAME SHELL</code></strong>
makefile:2: USERNAME = Owner
makefile:2: SHELL = /bin/sh.exe
make: debug is up to date.
make: *** No rule to make target USERNAME.  Stop.</pre><p>åœ¨<a class="link" href="#OEBPS/ch10.html" title="ç¬¬ 10 ç« æé«˜ make çš„æ€§èƒ½">ç¬¬ 10 ç« ä¸­ï¼Œæˆ‘ç®€è¦æåˆ°äº†ä½¿ç”¨è°ƒè¯• shell æ¥å¸®åŠ©ç†è§£</a><em class="command">make</em>åœ¨å¹•åŽæ‰§è¡Œçš„ä¸€äº›æ´»åŠ¨ã€‚è™½ç„¶<em class="command">make</em><code class="function">shell</code>åœ¨æ‰§è¡Œå‘½ä»¤è„šæœ¬ä¸­çš„å‘½ä»¤ä¹‹å‰å¯¹å…¶è¿›è¡Œå›žæ˜¾ï¼Œä½†å®ƒä¸ä¼šå›žæ˜¾åœ¨å‡½æ•°ä¸­æ‰§è¡Œçš„å‘½ä»¤ã€‚é€šå¸¸ï¼Œè¿™äº›å‘½ä»¤æ˜¯å¾®å¦™ä¸”å¤æ‚çš„ï¼Œç‰¹åˆ«æ˜¯å› ä¸ºå®ƒä»¬å¯èƒ½ä¼šç«‹å³æ‰§è¡Œæˆ–ä»¥å»¶è¿Ÿçš„æ–¹å¼æ‰§è¡Œï¼ˆå¦‚æžœå®ƒä»¬å‡ºçŽ°åœ¨é€’å½’å˜é‡èµ‹å€¼ä¸­ï¼‰ã€‚æŸ¥çœ‹è¿™äº›å‘½ä»¤æ‰§è¡Œçš„ä¸€ç§æ–¹æ³•æ˜¯è¯·æ±‚å­ shell å¯ç”¨è°ƒè¯•æ‰“å°ï¼š</p><p>In <a class="link" href="#OEBPS/ch10.html" title="Chapter&nbsp;10.&nbsp;Improving the Performance of make">Chapter 10</a>, I briefly
          mentioned using a debugging shell to help understand some of the
          activities <em class="command">make</em> performs behind
          the scenes. While <em class="command">make</em> echos
          commands in command scripts before they are executed, it does not
          echo the commands executed in <code class="function">shell</code> functions. Often these commands are
          subtle and complex, particularly since they may be executed
          immediately or in a deferred fashion, if they occur in a recursive
          variable assignment. One way to see these commands execute is to
          request that the subshell enable debug printing:</p><a id="OEBPS/ch12s02.html.I_7_tt532"></a><pre class="programlisting">æ—¥æœŸ := $(å¤–å£³æ—¥æœŸ +%F)
OUTPUT_DIR = è¾“å‡º-$(æ—¥æœŸ)

make-directories := $(shell [ -d $(OUTPUT_DIR) ] || mkdir -p $(OUTPUT_DIR))

å…¨éƒ¨ï¼š ;</pre><pre class="programlisting">DATE := $(shell date +%F)
OUTPUT_DIR = out-$(DATE)

make-directories := $(shell [ -d $(OUTPUT_DIR) ] || mkdir -p $(OUTPUT_DIR))

all: ;</pre><p><em class="command">å½“ä½¿ç”¨sh</em>çš„è°ƒè¯•é€‰é¡¹è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼š</p><p>When run with <em class="command">sh</em>'s
          debugging option, we see:</p><a id="OEBPS/ch12s02.html.I_7_tt533"></a><pre class="programlisting">$ ä½¿ SHELL="sh -x"
+ æ—¥æœŸ +%F
+ '[' -d out-2004-05-11 ']'
+ mkdir -p è¾“å‡º-2004-05-11</pre><pre class="programlisting">$ make SHELL="sh -x"
+ date +%F
+ '[' -d out-2004-05-11 ']'
+ mkdir -p out-2004-05-11</pre><p>è¿™ç”šè‡³æä¾›äº†
          <em class="command">make</em> <code class="function">warning</code>è¯­å¥ä¹‹å¤–çš„é™„åŠ è°ƒè¯•ä¿¡æ¯ï¼Œå› ä¸ºä½¿ç”¨æ­¤é€‰é¡¹ï¼Œshell è¿˜æ˜¾ç¤ºå˜é‡å’Œè¡¨è¾¾å¼çš„å€¼ã€‚</p><p>This even provides additional debugging information beyond
          <em class="command">make</em> <code class="function">warning</code> statements, since with this
          option the shell also displays the value of variables and
          expressions.</p><p><code class="literal">PATH</code>æœ¬ä¹¦ä¸­çš„è®¸å¤šç¤ºä¾‹éƒ½æ˜¯ç”¨æ·±å±‚åµŒå¥—è¡¨è¾¾å¼ç¼–å†™çš„ï¼Œä¾‹å¦‚æ£€æŸ¥Windows/Cygwin ç³»ç»Ÿä¸Šçš„å˜é‡çš„ç¤ºä¾‹ï¼š</p><p>Many of the examples in this book are written as deeply nested
          expressions, such as this one that checks the <code class="literal">PATH</code> variable on a Windows/Cygwin
          system:</p><a id="OEBPS/ch12s02.html.I_7_tt534"></a><pre class="programlisting">$(å¦‚æžœ $(findstring /bin/, \
       $(ç¬¬ä¸€ä¸ªå•è¯\
         $(é€šé…ç¬¦\
           $(addsuffix /sort$(if $(COMSPEC),.exe), \
             $(subst :, ,$(PATH)))))),, \
  $(error ä½ çš„è·¯å¾„é”™è¯¯ï¼Œc:/usr/cygwin/bin åº”è¯¥ \
    ä½äºŽ c:/WINDOWS/system32)) ä¹‹å‰</pre><pre class="programlisting">$(if $(findstring /bin/,                               \
       $(firstword                                     \
         $(wildcard                                    \
           $(addsuffix /sort$(if $(COMSPEC),.exe),     \
             $(subst :, ,$(PATH)))))),,                \
  $(error Your PATH is wrong, c:/usr/cygwin/bin should \
    precede c:/WINDOWS/system32))</pre><p>æ²¡æœ‰å¥½çš„æ–¹æ³•æ¥è°ƒè¯•è¿™äº›è¡¨è¾¾å¼ã€‚ä¸€ç§åˆç†çš„æ–¹æ³•æ˜¯å±•å¼€å®ƒä»¬ï¼Œå¹¶æ‰“å°æ¯ä¸ªå­è¡¨è¾¾å¼ï¼š</p><p>There is no good way to debug these expressions. One
          reasonable approach is to unroll them, and print each
          subexpression:</p><a id="OEBPS/ch12s02.html.I_7_tt535"></a><pre class="programlisting">$(è­¦å‘Š$(subst :, ,$(PATH)))
$(è­¦å‘Š/æŽ’åº$(å¦‚æžœ$(COMSPEC),.exe))
$(è­¦å‘Š$(addsuffix /sort$(if $(COMSPEC),.exe), \
             $(æ›¿æ¢:,,$(è·¯å¾„))))
$(è­¦å‘Š$(é€šé…ç¬¦\
            $(addsuffix /sort$(if $(COMSPEC),.exe), \
              $(æ›¿æ¢:,,$(è·¯å¾„)))))</pre><pre class="programlisting">$(warning $(subst :, ,$(PATH)))
$(warning /sort$(if $(COMSPEC),.exe))
$(warning $(addsuffix /sort$(if $(COMSPEC),.exe),     \
             $(subst :, ,$(PATH))))
$(warning $(wildcard                                   \
            $(addsuffix /sort$(if $(COMSPEC),.exe),    \
              $(subst :, ,$(PATH)))))</pre><p>è™½ç„¶æœ‰ç‚¹ä¹å‘³ï¼Œä½†æ²¡æœ‰çœŸæ­£çš„è°ƒè¯•å™¨ï¼Œè¿™æ˜¯ç¡®å®šå„ç§å­è¡¨è¾¾å¼çš„å€¼çš„æœ€ä½³æ–¹æ³•ï¼ˆæœ‰æ—¶æ˜¯å”¯ä¸€çš„æ–¹æ³•ï¼‰ã€‚</p><p>Although a bit tedious, without a real debugger, this is the
          best way (and sometimes the only way) to determine the value of
          various subexpressions.</p></div></div></div></div>
<div id="OEBPS/ch12s03.html"><div>
<div class="sect1" title="å¸¸è§é”™è¯¯æ¶ˆæ¯"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ch12s03.html.make3-CHP-12-SECT-3"></a>å¸¸è§é”™è¯¯æ¶ˆæ¯</h1><h1 class="title"><a></a>Common Error Messages</h1></div></div></div><p>3.81 <acronym class="acronym">GNU </acronym> <em class="command">make</em>æ‰‹å†Œ<a id="OEBPS/ch12s03.html.make3-CHP-12-ITERM-1597" class="indexterm"></a> <a id="OEBPS/ch12s03.html.make3-CHP-12-ITERM-1598" class="indexterm"></a>åŒ…æ‹¬ä¸€ä¸ªå¾ˆå¥½çš„éƒ¨åˆ†ï¼Œåˆ—å‡ºäº†<em class="command">make</em>é”™è¯¯æ¶ˆæ¯åŠå…¶åŽŸå› ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œå›žé¡¾ä¸€äº›æœ€å¸¸è§çš„ã€‚æ‰€æè¿°çš„ä¸€äº›é—®é¢˜å¹¶ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„<em class="command">make</em>
        é”™è¯¯ï¼Œä¾‹å¦‚å‘½ä»¤è„šæœ¬ä¸­çš„è¯­æ³•é”™è¯¯ï¼Œä½†å¯¹äºŽå¼€å‘äººå‘˜æ¥è¯´ä»ç„¶æ˜¯å¸¸è§é—®é¢˜ã€‚æœ‰å…³<em class="command">make</em>é”™è¯¯çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜…<em class="command">make</em>æ‰‹å†Œã€‚</p><p>The 3.81 <acronym class="acronym">GNU</acronym> <em class="command">make</em> manual <a class="indexterm"></a> <a class="indexterm"></a>includes an excellent section listing <em class="command">make</em> error messages and their causes. We
        review a few of the most common ones here. Some of the issues
        described are not strictly <em class="command">make</em>
        errors, such as syntax errors in command scripts, but are nonetheless
        common problems for developers. For a complete list of <em class="command">make</em> errors, see the <em class="command">make</em> manual.</p><p><em class="command">make</em>æ‰“å°çš„é”™è¯¯æ¶ˆæ¯å…·æœ‰æ ‡å‡†æ ¼å¼ï¼š</p><p>Error messages printed by <em class="command">make</em> have a standard format:</p><a id="OEBPS/ch12s03.html.I_7_tt536"></a><pre class="programlisting"><em class="replaceable"><code>makefile</code></em>: <em class="replaceable"><code>n</code></em>: *** <em class="replaceable"><code>message</code></em>ã€‚åœæ­¢ã€‚</pre><pre class="programlisting"><em class="replaceable"><code>makefile</code></em>:<em class="replaceable"><code>n</code></em>: *** <em class="replaceable"><code>message</code></em>. Stop.</pre><p>æˆ–è€…ï¼š</p><p>or:</p><a id="OEBPS/ch12s03.html.I_7_tt537"></a><pre class="programlisting">åˆ¶ä½œï¼š<em class="replaceable"><code>n</code></em>ï¼š *** <em class="replaceable"><code>message</code></em>ã€‚åœæ­¢ã€‚</pre><pre class="programlisting">make:<em class="replaceable"><code>n</code></em>: *** <em class="replaceable"><code>message</code></em>. Stop.</pre><p>è¯¥éƒ¨åˆ†æ˜¯å‘ç”Ÿé”™è¯¯çš„<em class="filename">makefile</em><em class="replaceable"><code>makefile</code></em>æˆ– include æ–‡ä»¶çš„åç§°
        ã€‚ä¸‹ä¸€éƒ¨åˆ†æ˜¯å‘ç”Ÿé”™è¯¯çš„è¡Œå·ï¼ŒåŽè·Ÿä¸‰ä¸ªæ˜Ÿå·ï¼Œæœ€åŽæ˜¯é”™è¯¯æ¶ˆæ¯ã€‚<em class="filename"></em></p><p>The <em class="replaceable"><code>makefile</code></em> part is the name of the
        <em class="filename">makefile</em> or include file in which
        the error occurred. The next part is the line number where the error
        occurred, followed by three asterisks and, finally, the error
        message.</p><p>è¯·æ³¨æ„ï¼Œè¿è¡Œå…¶ä»–ç¨‹åºæ˜¯<em class="command">makeçš„å·¥ä½œï¼Œå¦‚æžœå‘ç”Ÿé”™è¯¯ï¼Œ </em><em class="filename">makefile</em>ä¸­çš„é—®é¢˜å¾ˆå¯èƒ½ä¼šåœ¨è¿™äº›å…¶ä»–ç¨‹åºä¸­è¡¨çŽ°ä¸ºé”™è¯¯ã€‚ä¾‹å¦‚ï¼Œshell é”™è¯¯å¯èƒ½æ˜¯ç”±æ ¼å¼é”™è¯¯çš„å‘½ä»¤è„šæœ¬å¼•èµ·çš„ï¼Œæˆ–è€…æ˜¯ç”±ä¸æ­£ç¡®çš„å‘½ä»¤è¡Œå‚æ•°å¼•èµ·çš„ç¼–è¯‘å™¨é”™è¯¯ã€‚æ‰¾å‡ºå“ªä¸ªç¨‹åºäº§ç”Ÿäº†é”™è¯¯æ¶ˆæ¯æ˜¯è§£å†³é—®é¢˜çš„é¦–è¦ä»»åŠ¡ã€‚å¹¸è¿çš„æ˜¯ï¼Œ<em class="command">make</em>çš„é”™è¯¯æ¶ˆæ¯æ˜¯ç›¸å½“ä¸è¨€è€Œå–»çš„ã€‚</p><p>Note that it is <em class="command">make</em>'s job to
        run other programs and that, if errors occur, it is very likely that
        problems in your <em class="filename">makefile</em> will
        manifest themselves as errors in these other programs. For instance,
        shell errors may result from badly formed command scripts, or compiler
        errors from incorrect command-line arguments. Figuring out what
        program produced the error message is your first task in solving the
        problem. Fortunately, <em class="command">make</em>'s error
        messages are fairly self-evident.</p><div class="sect2" title="è¯­æ³•é”™è¯¯"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch12s03.html.make3-CHP-12-SECT-3.1"></a>è¯­æ³•é”™è¯¯</h2><h2 class="title"><a></a>Syntax Errors</h2></div></div></div><p>è¿™äº›é€šå¸¸æ˜¯<a id="OEBPS/ch12s03.html.make3-CHP-12-ITERM-1599" class="indexterm"></a> <a id="OEBPS/ch12s03.html.make3-CHP-12-ITERM-1600" class="indexterm"></a>å°åˆ·é”™è¯¯ï¼šç¼ºå°‘æ‹¬å·ã€ä½¿ç”¨ç©ºæ ¼è€Œä¸æ˜¯åˆ¶è¡¨ç¬¦ç­‰ã€‚</p><p>These are usually <a class="indexterm"></a> <a class="indexterm"></a>typographical errors: missing parentheses, using
          spaces instead of tabs, etc.</p><p><em class="command">å¯¹äºŽæ–°çš„make</em>ç”¨æˆ·æ¥è¯´ï¼Œæœ€å¸¸è§çš„é”™è¯¯ä¹‹ä¸€æ˜¯çœç•¥å˜é‡åç§°å‘¨å›´çš„æ‹¬å·ï¼š</p><p>One of the most common errors for new <em class="command">make</em> users is omitting parentheses around
          variable names:</p><a id="OEBPS/ch12s03.html.I_7_tt538"></a><pre class="programlisting">å¯Œï¼š
        å¯¹äºŽ $SOURCES ä¸­çš„ fï¼› \
        åš \
           ... \
        å®Œæ¯•</pre><pre class="programlisting">foo:
        for f in $SOURCES; \
        do                 \
           ...               \
        done</pre><p>è¿™å¯èƒ½ä¼šå¯¼è‡´<em class="command">make</em>æ‰©å±•<code class="literal">$S</code>ä¸ºç©ºï¼Œå¹¶ä¸” shell ä»…æ‰§è¡Œä¸€æ¬¡å¾ªçŽ¯ï¼Œä¸”<code class="literal">f</code>å€¼ä¸º<code class="literal">OURCES</code>ã€‚æ ¹æ®æ‚¨çš„æ“ä½œ<code class="literal">f</code>ï¼Œæ‚¨å¯èƒ½ä¼šæ”¶åˆ°ä¸€æ¡ä¸é”™çš„ shell é”™è¯¯æ¶ˆæ¯ï¼Œä¾‹å¦‚ï¼š</p><p>This will likely result in <em class="command">make</em> expanding <code class="literal">$S</code> to nothing, and the shell executing the
          loop only once with <code class="literal">f</code> having a
          value of <code class="literal">OURCES</code>. Depending on
          what you do with <code class="literal">f</code>, you may get a
          nice shell error message like:</p><a id="OEBPS/ch12s03.html.I_7_tt539"></a><pre class="programlisting">æ¥æºï¼šæ²¡æœ‰è¿™æ ·çš„æ–‡ä»¶æˆ–ç›®å½•</pre><pre class="programlisting">OURCES: No such file or directory</pre><p>ä½†æ‚¨ä¹Ÿå¯èƒ½å¾ˆå®¹æ˜“æ ¹æœ¬æ”¶ä¸åˆ°ä»»ä½•æ¶ˆæ¯ã€‚è¯·è®°ä½ç”¨æ‹¬å·å°†<em class="command">makeå˜é‡æ‹¬èµ·æ¥ã€‚</em></p><p>but you might just as easily get no message at all. Remember
          to surround your <em class="command">make</em> variables
          with parentheses.</p><div class="sect3" title="ç¼ºå°‘åˆ†éš”ç¬¦"><div class="titlepage"><div><div><h3 class="title"><a id="OEBPS/ch12s03.html.make3-CHP-12-SECT-3.1.1"></a>ç¼ºå°‘åˆ†éš”ç¬¦</h3><h3 class="title"><a></a>missing separator</h3></div></div></div><p>è¿™<a id="OEBPS/ch12s03.html.make3-CHP-12-ITERM-1601" class="indexterm"></a>ä¿¡æ¯ï¼š</p><p>The <a class="indexterm"></a>message:</p><a id="OEBPS/ch12s03.html.I_7_tt540"></a><pre class="programlisting">makefile:2:ç¼ºå°‘åˆ†éš”ç¬¦ã€‚åœæ­¢ã€‚</pre><pre class="programlisting">makefile:2:missing separator. Stop.</pre><p>æˆ–è€…ï¼š</p><p>or:</p><a id="OEBPS/ch12s03.html.I_7_tt541"></a><pre class="programlisting">makefile:2:ç¼ºå°‘åˆ†éš”ç¬¦ï¼ˆæ‚¨çš„æ„æ€æ˜¯ TAB è€Œä¸æ˜¯ 8 ä¸ªç©ºæ ¼ï¼Ÿï¼‰ã€‚åœæ­¢ã€‚</pre><pre class="programlisting">makefile:2:missing separator (did you mean TAB instead of 8 spaces?).  Stop.</pre><p>é€šå¸¸æ„å‘³ç€æ‚¨æœ‰ä¸€ä¸ªä½¿ç”¨ç©ºæ ¼è€Œä¸æ˜¯åˆ¶è¡¨ç¬¦çš„å‘½ä»¤è„šæœ¬ã€‚</p><p>usually means you have a command script that is using spaces
            instead of tabs.</p><p>æ›´å­—é¢çš„è§£é‡Šæ˜¯<em class="command">make</em>æ­£åœ¨å¯»æ‰¾<em class="command">make</em>åˆ†éš”ç¬¦ï¼Œä¾‹å¦‚ :ã€<code class="literal">=</code>æˆ–åˆ¶è¡¨ç¬¦ï¼Œä½†æ²¡æœ‰æ‰¾åˆ°ã€‚ç›¸åï¼Œå®ƒå‘çŽ°äº†ä¸€äº›å®ƒä¸ç†è§£çš„ä¸œè¥¿ã€‚</p><p>The more literal interpretation is that <em class="command">make</em> was looking for a <em class="command">make</em> separator such as :, <code class="literal">=</code>, or a tab, and didn't find one.
            Instead, it found something it didn't understand.</p></div><div class="sect3" title="å‘½ä»¤åœ¨ç¬¬ä¸€ä¸ªç›®æ ‡ä¹‹å‰å¼€å§‹"><div class="titlepage"><div><div><h3 class="title"><a id="OEBPS/ch12s03.html.make3-CHP-12-SECT-3.1.2"></a>å‘½ä»¤åœ¨ç¬¬ä¸€ä¸ªç›®æ ‡ä¹‹å‰å¼€å§‹</h3><h3 class="title"><a></a>commands commence before first target</h3></div></div></div><p>åˆ¶è¡¨ç¬¦æ•²å‡»<a id="OEBPS/ch12s03.html.make3-CHP-12-ITERM-1602" class="indexterm"></a>å†æ¬¡ï¼</p><p>The tab character strikes <a class="indexterm"></a>again!</p><p>è¯¥é”™è¯¯æ¶ˆæ¯é¦–å…ˆåœ¨<a class="link" href="#OEBPS/ch05.html" title="ç¬¬ 5 ç« å‘½ä»¤">ç¬¬ 5 ç« çš„</a><a class="link" href="#OEBPS/ch05.html.make3-CHP-5-SECT-1" title="è§£æžå‘½ä»¤">5.1 èŠ‚</a>ä¸­ä»‹ç»ã€‚å½“å‘½ä»¤è„šæœ¬å¤–éƒ¨çš„è¡Œä»¥åˆ¶è¡¨ç¬¦å¼€å¤´æ—¶ï¼Œæ­¤é”™è¯¯ä¼¼ä¹Žæœ€å¸¸å‡ºçŽ°åœ¨<em class="filename">makefile</em>çš„ä¸­é—´ã€‚ <em class="command">make</em>ä¼šå°½åŠ›æ¶ˆé™¤è¿™ç§æƒ…å†µçš„æ­§ä¹‰ï¼Œä½†å¦‚æžœè¯¥è¡Œæ— æ³•è¯†åˆ«ä¸ºå˜é‡èµ‹å€¼ã€æ¡ä»¶è¡¨è¾¾å¼æˆ–å¤šè¡Œå®å®šä¹‰ï¼Œ
             <em class="command">make</em>ä¼šè®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªæ”¾é”™ä½ç½®çš„å‘½ä»¤ã€‚<a class="link" href="#OEBPS/ch05.html" title="ç¬¬ 5 ç« å‘½ä»¤"></a><em class="filename"></em><em class="command"></em><em class="command"></em></p><p>This error message was first covered in <a class="link" href="#OEBPS/ch05.html.make3-CHP-5-SECT-1" title="Parsing Commands">Section 5.1</a> in <a class="link" href="#OEBPS/ch05.html" title="Chapter&nbsp;5.&nbsp;Commands">Chapter 5</a>. This error seems to appear
            most often in the middle of <em class="filename">makefile</em>s when a line outside of a
            command script begins with a tab character. <em class="command">make</em> does its best to disambiguate this
            situation, but if the line cannot be identified as a variable
            assignment, conditional expression, or multiline macro definition,
            <em class="command">make</em> considers it a misplaced
            command.</p></div><div class="sect3" title="æœªç»ˆæ­¢çš„å˜é‡å¼•ç”¨"><div class="titlepage"><div><div><h3 class="title"><a id="OEBPS/ch12s03.html.make3-CHP-12-SECT-3.1.3"></a>æœªç»ˆæ­¢çš„å˜é‡å¼•ç”¨</h3><h3 class="title"><a></a>unterminated variable reference</h3></div></div></div><p>è¿™æ˜¯ä¸€ä¸ªç®€å•ä½†<a id="OEBPS/ch12s03.html.make3-CHP-12-ITERM-1603" class="indexterm"></a>å¸¸è§é”™è¯¯ã€‚è¿™æ„å‘³ç€æ‚¨æœªèƒ½ä½¿ç”¨æ­£ç¡®æ•°é‡çš„æ‹¬å·å…³é—­å˜é‡å¼•ç”¨æˆ–å‡½æ•°è°ƒç”¨ã€‚é€šè¿‡æ·±åº¦åµŒå¥—çš„å‡½æ•°è°ƒç”¨å’Œå˜é‡å¼•ç”¨ï¼Œ<em class="command">make</em>æ–‡ä»¶å¯ä»¥å¼€å§‹çœ‹èµ·æ¥åƒ Lispï¼ä¸€ä¸ªèƒ½å¤Ÿè¿›è¡Œæ‹¬å·åŒ¹é…çš„ä¼˜ç§€ç¼–è¾‘å™¨ï¼ˆä¾‹å¦‚ Emacsï¼‰æ˜¯é¿å…æ­¤ç±»é”™è¯¯çš„æœ€å¯é æ–¹æ³•ã€‚</p><p>This is a simple but <a class="indexterm"></a>common error. It means you failed to close a
            variable reference or function call with the proper number of
            parentheses. With deeply nested function calls and variable
            references, <em class="command">make</em> files can
            begin to look like Lisp! A good editor that does parenthesis
            matching, such as Emacs, is the surest way to avoid these types of
            errors.</p></div></div><div class="sect2" title="å‘½ä»¤è„šæœ¬ä¸­çš„é”™è¯¯"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch12s03.html.make3-CHP-12-SECT-3.2"></a>å‘½ä»¤è„šæœ¬ä¸­çš„é”™è¯¯</h2><h2 class="title"><a></a>Errors in Command Scripts</h2></div></div></div><p>å¸¸è§çš„æœ‰ä»¥ä¸‹ä¸‰ç§ç±»åž‹<a id="OEBPS/ch12s03.html.make3-CHP-12-ITERM-1604" class="indexterm"></a> <a id="OEBPS/ch12s03.html.make3-CHP-12-ITERM-1605" class="indexterm"></a> <a id="OEBPS/ch12s03.html.make3-CHP-12-ITERM-1606" class="indexterm"></a>å‘½ä»¤è„šæœ¬ä¸­çš„é”™è¯¯ï¼šå¤šè¡Œå‘½ä»¤ä¸­ç¼ºå°‘åˆ†å·ã€è·¯å¾„å˜é‡ä¸å®Œæ•´æˆ–ä¸æ­£ç¡®ï¼Œæˆ–è€…å‘½ä»¤åœ¨è¿è¡Œæ—¶é‡åˆ°é—®é¢˜ã€‚</p><p>There are three common types of <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>errors in command scripts: a missing semicolon in
          multiline commands, an incomplete or incorrect path variable, or a
          command that simply encounters a problem when run.</p><p>æˆ‘ä»¬åœ¨<a class="link" href="#OEBPS/ch12s02.html.make3-CHP-12-SECT-2.1" title="è‰¯å¥½çš„ç¼–ç å®žè·µ">ç¬¬ 12.2.1 èŠ‚</a>ä¸­è®¨è®ºäº†ç¼ºå°‘åˆ†å·çš„é—®é¢˜ï¼Œå› æ­¤è¿™é‡Œä¸å†è¯¦ç»†è¯´æ˜Žã€‚</p><p>We discussed missing semicolons in <a class="link" href="#OEBPS/ch12s02.html.make3-CHP-12-SECT-2.1" title="Good Coding Practices">Section 12.2.1</a>, so we won't
          elaborate further here.</p><p>ç»å…¸çš„é”™è¯¯ä¿¡æ¯ï¼š</p><p>The classic error message:</p><a id="OEBPS/ch12s03.html.I_7_tt542"></a><pre class="programlisting">bash: foo: æœªæ‰¾åˆ°å‘½ä»¤</pre><pre class="programlisting">bash: foo: command not found</pre><p>å½“ shell æ‰¾ä¸åˆ°å‘½ä»¤<em class="command">foo</em>æ—¶æ˜¾ç¤ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œshell å·²åœ¨<code class="literal">PATH</code>å˜é‡ä¸­çš„æ¯ä¸ªç›®å½•ä¸­æœç´¢å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½†æ²¡æœ‰æ‰¾åˆ°åŒ¹é…é¡¹ã€‚è¦æ›´æ­£æ­¤é”™è¯¯ï¼Œæ‚¨å¿…é¡»æ›´æ–°<code class="literal">PATH</code>å˜é‡ï¼Œé€šå¸¸åœ¨<em class="filename">.profile</em> 
          (Bourne shell)ã€. <em class="filename">bashrc</em> (bash) æˆ–<em class="filename">.cshrc</em> (C shell) ä¸­ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥<code class="literal">PATH</code>åœ¨<em class="filename">makefile</em>æœ¬èº«ä¸­è®¾ç½®å˜é‡ï¼Œç„¶åŽ<code class="literal">PATH</code>ä»Ž<em class="command">make</em>å¯¼å‡ºè¯¥å˜é‡ã€‚</p><p>is displayed when the shell cannot find the command <em class="command">foo</em>. That is, the shell has searched each
          directory in the <code class="literal">PATH</code> variable
          for the executable and found no match. To correct this error, you
          must update your <code class="literal">PATH</code> variable,
          usually in your <em class="filename">.profile</em>
          (Bourne shell), <em class="filename">.bashrc</em> (bash),
          or <em class="filename">.cshrc</em> (C shell). Of course,
          it is also possible to set the <code class="literal">PATH</code> variable in the <em class="filename">makefile</em> itself, and export the <code class="literal">PATH</code> variable from <em class="command">make</em>.</p><p>æœ€åŽï¼Œå½“ shell å‘½ä»¤å¤±è´¥æ—¶ï¼Œå®ƒä¼šä»¥éžé›¶é€€å‡ºçŠ¶æ€ç»ˆæ­¢ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<em class="command">make ä¼š</em>æŠ¥å‘Šå¤±è´¥å¹¶æ˜¾ç¤ºä»¥ä¸‹æ¶ˆæ¯ï¼š</p><p>Finally, when a shell command fails, it terminates with a
          nonzero exit status. In this case, <em class="command">make</em> reports the failure with the
          message:</p><a id="OEBPS/ch12s03.html.I_7_tt543"></a><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
è§¦æ‘¸/foo/bar
touchï¼šåˆ›å»º/foo/barï¼šæ²¡æœ‰è¿™æ ·çš„æ–‡ä»¶æˆ–ç›®å½•
make: *** [å…¨éƒ¨] é”™è¯¯ 1</pre><pre class="programlisting">$<strong class="userinput"><code>make</code></strong>
touch /foo/bar
touch: creating /foo/bar: No such file or directory
make: *** [all] Error 1</pre><p>è¿™é‡Œå¤±è´¥çš„å‘½ä»¤æ˜¯<em class="command">touch</em>ï¼Œå®ƒæ‰“å°è‡ªå·±çš„é”™è¯¯æ¶ˆæ¯æ¥è§£é‡Šå¤±è´¥ã€‚ä¸‹ä¸€è¡Œæ˜¯<em class="command">make</em>çš„é”™è¯¯æ‘˜è¦ã€‚å¤±è´¥çš„
          <em class="filename">makefile</em>ç›®æ ‡æ˜¾ç¤ºåœ¨æ–¹æ‹¬å·ä¸­ï¼ŒåŽè·Ÿå¤±è´¥ç¨‹åºçš„é€€å‡ºå€¼ã€‚æœ‰æ—¶ï¼Œå¦‚æžœç¨‹åºç”±äºŽä¿¡å·è€Œé€€å‡ºï¼Œé‚£ä¹ˆ<em class="command">makeä¼šæ‰“å°æ›´è¯¦ç»†çš„æ¶ˆæ¯ï¼Œè€Œä¸æ˜¯ç®€å•åœ°æ‰“å°éžé›¶é€€å‡ºçŠ¶æ€ã€‚</em></p><p>Here the failing command is <em class="command">touch</em>, which prints its own error message
          explaining the failure. The next line is <em class="command">make</em>'s summary of the error. The failing
          <em class="filename">makefile</em> target is shown in
          square brackets followed by the exit value of the failing program.
          Sometimes <em class="command">make</em> will print a more
          verbose message if the program exits due to a signal, rather than
          simply a nonzero exit status.</p><p>å¦è¯·æ³¨æ„ï¼Œä½¿ç”¨ä¿®é¥°ç¬¦é™é»˜æ‰§è¡Œçš„å‘½ä»¤<code class="literal">@</code>ä¹Ÿå¯èƒ½ä¼šå¤±è´¥ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ‰€æ˜¾ç¤ºçš„é”™è¯¯æ¶ˆæ¯å¯èƒ½ä¸çŸ¥ä»Žä½•è€Œæ¥ã€‚</p><p>Note also that commands executed silently with the <code class="literal">@</code> modifier can also fail. In these cases,
          the error message presented may appear as if from nowhere.</p><p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œé”™è¯¯éƒ½æºäºŽæ­£åœ¨è¿è¡Œçš„ç¨‹åº<em class="command">make</em>ï¼Œè€Œä¸æ˜¯<em class="command">make</em>æœ¬èº«ã€‚</p><p>In either of these cases, the error originates with the
          program <em class="command">make</em> is running, rather
          than <em class="command">make</em> itself.</p></div><div class="sect2" title="æ²¡æœ‰è§„åˆ™å¯ä»¥åˆ¶å®šç›®æ ‡"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch12s03.html.make3-CHP-12-SECT-3.3"></a>æ²¡æœ‰è§„åˆ™å¯ä»¥åˆ¶å®šç›®æ ‡</h2><h2 class="title"><a></a>No Rule to Make Target</h2></div></div></div><p>è¯¥æ¶ˆæ¯æœ‰ä¸¤ç§å½¢å¼ï¼š</p><p>This message has two forms:</p><a id="OEBPS/ch12s03.html.I_7_tt544"></a><pre class="programlisting">make: *** æ²¡æœ‰è§„åˆ™å¯ä»¥åˆ›å»ºç›®æ ‡ XXXã€‚åœæ­¢ã€‚</pre><pre class="programlisting">make: *** No rule to make target XXX. Stop.</pre><p>å’Œï¼š</p><p>and:</p><a id="OEBPS/ch12s03.html.I_7_tt545"></a><pre class="programlisting">make: *** æ²¡æœ‰è§„åˆ™å¯ä»¥åˆ›å»º YYY éœ€è¦çš„ç›®æ ‡ XXXã€‚åœæ­¢ã€‚</pre><pre class="programlisting">make: *** No rule to make target XXX, needed by YYY. Stop.</pre><p>è¿™æ„å‘³ç€<em class="command">make</em>å†³å®šéœ€è¦æ›´æ–°æ–‡ä»¶<em class="filename">XXX ï¼Œä½†</em><em class="command">make</em>æ‰¾ä¸åˆ°ä»»ä½•è§„åˆ™æ¥æ‰§è¡Œè¯¥ä½œä¸šã€‚<em class="command">make</em>
          å°†åœ¨æ”¾å¼ƒå¹¶æ‰“å°æ¶ˆæ¯ä¹‹å‰æœç´¢å…¶æ•°æ®åº“ä¸­çš„æ‰€æœ‰éšå¼å’Œæ˜¾å¼è§„åˆ™ã€‚</p><p>It means that <em class="command">make</em> decided
          the file <em class="filename">XXX</em> needed to be
          updated, but <em class="command">make</em> could not find
          any rule to perform the job. <em class="command">make</em>
          will search all the implicit and explicit rules in its database
          before giving up and printing the message.</p><p>å¯¼è‡´æ­¤é”™è¯¯çš„å¯èƒ½åŽŸå› æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p><p>There are three possible reasons for this error:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>æ‚¨çš„<em class="filename">makefile</em>ç¼ºå°‘æ›´æ–°æ–‡ä»¶æ‰€éœ€çš„è§„åˆ™ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¿…é¡»æ·»åŠ æè¿°å¦‚ä½•æž„å»ºç›®æ ‡çš„è§„åˆ™ã€‚</p></li><li class="listitem"><p>Your <em class="filename">makefile</em> is
              missing a rule required to update the file. In this case, you
              will have to add the rule describing how to build the
              target.</p></li><li class="listitem"><p><em class="filename">makefile</em>ä¸­æœ‰ä¸€ä¸ªæ‹¼å†™é”™è¯¯ã€‚è¦ä¹ˆ<em class="command">make</em>æ­£åœ¨æŸ¥æ‰¾é”™è¯¯çš„æ–‡ä»¶ï¼Œè¦ä¹ˆæ›´æ–°æ–‡ä»¶çš„è§„åˆ™æŒ‡å®šäº†é”™è¯¯çš„æ–‡ä»¶ã€‚ç”±äºŽä½¿ç”¨äº†<em class="command">make</em>å˜é‡ï¼Œå› æ­¤å¾ˆéš¾åœ¨<em class="filename">makefile</em>ä¸­æ‰¾åˆ°æ‹¼å†™é”™è¯¯ã€‚æœ‰æ—¶ï¼ŒçœŸæ­£ç¡®å®šå¤æ‚æ–‡ä»¶åçš„å€¼çš„å”¯ä¸€æ–¹æ³•æ˜¯é€šè¿‡ç›´æŽ¥æ‰“å°å˜é‡æˆ–æ£€æŸ¥
              <em class="command">make</em>çš„å†…éƒ¨æ•°æ®åº“æ¥æ‰“å°å®ƒã€‚<em class="command"></em><em class="command"></em></p></li><li class="listitem"><p>There is a typo in the <em class="filename">makefile</em>. Either <em class="command">make</em> is looking for the wrong file or
              the rule to update the file specifies the wrong file. Typos can
              be hard to find in <em class="filename">makefile</em>s due to the use of <em class="command">make</em> variables. Sometimes the only way
              to really be sure of the value of a complex filename is to print
              it out either by printing the variable directly or examining
              <em class="command">make</em>'s internal
              database.</p></li><li class="listitem"><p>è¯¥æ–‡ä»¶åº”è¯¥å­˜åœ¨ï¼Œä½†<em class="command">make</em>ä¹Ÿæ‰¾ä¸åˆ°å®ƒï¼Œå› ä¸ºå®ƒä¸¢å¤±äº†æˆ–è€…å› ä¸º<em class="command">make</em>
              ä¸çŸ¥é“åœ¨å“ªé‡ŒæŸ¥æ‰¾ã€‚å½“ç„¶ï¼Œæœ‰æ—¶<em class="command">make</em>æ˜¯ç»å¯¹æ­£ç¡®çš„ã€‚æ–‡ä»¶ä¸¢å¤± â€” ä¹Ÿè®¸æ‚¨å¿˜è®°ä»Ž CVS ä¸­æ£€å‡ºå®ƒã€‚æ›´å¸¸è§çš„æ˜¯ï¼Œ<em class="command">make</em>æ ¹æœ¬æ‰¾ä¸åˆ°è¯¥æ–‡ä»¶ï¼Œå› ä¸ºæºä»£ç è¢«æ”¾ç½®åœ¨å…¶ä»–åœ°æ–¹ã€‚æœ‰æ—¶æºä½äºŽå•ç‹¬çš„æºæ ‘ä¸­ï¼Œæˆ–è€…æ–‡ä»¶å¯èƒ½æ˜¯ç”±å¦ä¸€ä¸ªç¨‹åºç”Ÿæˆçš„å¹¶ä¸”ç”Ÿæˆçš„æ–‡ä»¶ä½äºŽäºŒè¿›åˆ¶æ ‘ä¸­ã€‚</p></li><li class="listitem"><p>The file should exist but <em class="command">make</em> cannot find it either, because it
              is missing or because <em class="command">make</em>
              doesn't know where to look. Of course, sometimes <em class="command">make</em> is absolutely correct. The file
              is missingâ€”perhaps you forgot to check it out of CVS. More
              often, <em class="command">make</em> simply can't find
              the file, because the source is placed somewhere else. Sometimes
              the source is in a separate source tree, or maybe the file is
              generated by another program and the generated file is in the
              binary tree.</p></li></ul></div></div><div class="sect2" title="è¦†ç›–ç›®æ ‡å‘½ä»¤"><div class="titlepage"><div><div><h2 class="title"><a id="OEBPS/ch12s03.html.make3-CHP-12-SECT-3.4"></a>è¦†ç›–ç›®æ ‡å‘½ä»¤</h2><h2 class="title"><a></a>Overriding Commands for Target</h2></div></div></div><p><em class="command">make</em>åªå…è®¸ä¸€ä¸ª
          <a id="OEBPS/ch12s03.html.make3-CHP-12-ITERM-1607" class="indexterm"></a> <a id="OEBPS/ch12s03.html.make3-CHP-12-ITERM-1608" class="indexterm"></a> <a id="OEBPS/ch12s03.html.make3-CHP-12-ITERM-1609" class="indexterm"></a>ç›®æ ‡çš„å‘½ä»¤è„šæœ¬ï¼ˆåŒå†’å·è§„åˆ™é™¤å¤–ï¼Œå¾ˆå°‘ä½¿ç”¨ï¼‰ã€‚å¦‚æžœç»™ä¸€ä¸ªç›®æ ‡å¤šä¸ªå‘½ä»¤è„šæœ¬ï¼Œ<em class="command">make</em>ä¼šæ‰“å°è­¦å‘Šï¼š</p><p><em class="command">make</em> allows only one
          <a class="indexterm"></a> <a class="indexterm"></a> <a class="indexterm"></a>command script for a target (except for double-colon
          rules, which are rarely used). If a target is given more than one
          command script, <em class="command">make</em> prints the
          warning:</p><a id="OEBPS/ch12s03.html.I_7_tt546"></a><pre class="programlisting">makefile:5: è­¦å‘Š: è¦†ç›–ç›®æ ‡ foo çš„å‘½ä»¤</pre><pre class="programlisting">makefile:5: warning: overriding commands for target foo</pre><p>å®ƒè¿˜å¯èƒ½æ˜¾ç¤ºè­¦å‘Šï¼š</p><p>It may also display the warning:</p><a id="OEBPS/ch12s03.html.I_7_tt547"></a><pre class="programlisting">makefile:2: è­¦å‘Šï¼šå¿½ç•¥ç›®æ ‡ foo çš„æ—§å‘½ä»¤</pre><pre class="programlisting">makefile:2: warning: ignoring old commands for target foo</pre><p>ç¬¬ä¸€ä¸ªè­¦å‘ŠæŒ‡ç¤ºæ‰¾åˆ°ç¬¬äºŒä¸ªå‘½ä»¤è„šæœ¬çš„è¡Œï¼Œè€Œç¬¬äºŒä¸ªè­¦å‘ŠæŒ‡ç¤ºè¢«è¦†ç›–çš„åŽŸå§‹å‘½ä»¤è„šæœ¬çš„ä½ç½®ã€‚</p><p>The first warning indicates the line at which the second
          command script is found, while the second warning indicates the
          location of the original command script that is being
          overridden.</p><p>åœ¨å¤æ‚çš„<em class="filename">makefile</em>ä¸­ï¼Œç›®æ ‡é€šå¸¸ä¼šè¢«å¤šæ¬¡æŒ‡å®šï¼Œæ¯ä¸ªç›®æ ‡éƒ½ä¼šæ·»åŠ è‡ªå·±çš„å…ˆå†³æ¡ä»¶ã€‚å…¶ä¸­ä¸€ä¸ªç›®æ ‡é€šå¸¸åŒ…å«ä¸€ä¸ªå‘½ä»¤è„šæœ¬ï¼Œä½†åœ¨å¼€å‘æˆ–è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå¾ˆå®¹æ˜“æ·»åŠ å¦ä¸€ä¸ªå‘½ä»¤è„šæœ¬ï¼Œè€Œæ²¡æœ‰æ„è¯†åˆ°æ‚¨å®žé™…ä¸Šæ­£åœ¨è¦†ç›–ä¸€ç»„çŽ°æœ‰çš„å‘½ä»¤ã€‚</p><p>In complex <em class="filename">makefile</em>s,
          targets are often specified many times, each adding its own
          prerequisites. One of these targets usually includes a command
          script, but during development or debugging it is easy to add
          another command script without realizing you are actually overriding
          an existing set of commands.</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åŒ…å«æ–‡ä»¶ä¸­å®šä¹‰é€šç”¨ç›®æ ‡ï¼š</p><p>For example, we might define a generic target in an include
          file:</p><a id="OEBPS/ch12s03.html.I_7_tt548"></a><pre class="programlisting"># åˆ›å»ºä¸€ä¸ª jar æ–‡ä»¶ã€‚
$(jar_file):
        $(JAR) $(JARFLAGS) -f $@ $^</pre><pre class="programlisting"># Create a jar file.
$(jar_file):
        $(JAR) $(JARFLAGS) -f $@ $^</pre><p>å¹¶å…è®¸å¤šä¸ªå•ç‹¬çš„<em class="filename">makefile</em>æ·»åŠ è‡ªå·±çš„å…ˆå†³æ¡ä»¶ã€‚ç„¶åŽåœ¨<em class="filename">makefile</em>ä¸­æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š</p><p>and allow several separate <em class="filename">makefile</em>s to add their own prerequisites.
          Then in a <em class="filename">makefile</em> we could
          write:</p><a id="OEBPS/ch12s03.html.I_7_tt549"></a><pre class="programlisting"># è®¾ç½®åˆ›å»º jar çš„ç›®æ ‡å¹¶æ·»åŠ å…ˆå†³æ¡ä»¶
jar_file = è§£æžå™¨.jar
$(jar_file): $(class_files)</pre><pre class="programlisting"># Set the target for creating the jar and add prerequisites
jar_file = parser.jar
$(jar_file): $(class_files)</pre><p>å¦‚æžœæˆ‘ä»¬æ— æ„ä¸­å°†å‘½ä»¤è„šæœ¬æ·»åŠ åˆ°æ­¤
          <em class="filename">makefile</em>æ–‡æœ¬ä¸­ï¼Œ<em class="command">make</em>å°†äº§ç”Ÿæœ€é‡è¦çš„è­¦å‘Šã€‚</p><p>If we were to inadvertently add a command script to this
          <em class="filename">makefile</em> text, <em class="command">make</em> would produce the overriding
          warning.</p></div></div></div></div>
<div id="OEBPS/pt03.html"><div>
<div class="part" title="ç¬¬ä¸‰éƒ¨åˆ†ã€‚é™„å½•"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/pt03.html.make3-PART-3"></a>ç¬¬ä¸‰éƒ¨åˆ†ã€‚é™„å½•</h1><h1 class="title"><a></a>Part&nbsp;III.&nbsp;Appendixes</h1></div></div></div><div class="partintro" title="é™„å½•" id="OEBPS/pt03.html.id3177073"><div></div><p>æœ¬ä¹¦çš„æœ€åŽä¸€éƒ¨åˆ†åŒ…å«çš„ä¿¡æ¯ä¸Žæœ¬ä¹¦çš„ç›®æ ‡æ— å…³ï¼Œä½†æ‚¨å¯èƒ½ä¼šå‘çŽ°å®ƒå¯¹äºŽå¼‚å¸¸æƒ…å†µå¾ˆæœ‰ç”¨ã€‚<a class="link" href="#OEBPS/apa.html" title="é™„å½• A. è¿è¡Œ make">é™„å½• A</a><code class="literal">make</code>åˆ—å‡ºäº† GNUå‘½ä»¤åœ¨å‘½ä»¤è¡Œä¸ŠæŽ¥å—çš„é€‰é¡¹ã€‚æ‚¨ä¼šå‘çŽ°
      <a class="link" href="#OEBPS/apb.html" title="é™„å½• B. å¤–éƒ¨é™åˆ¶">é™„å½• B</a><code class="literal">make</code>å¾ˆæœ‰è¶£ï¼Œè€Œä¸”å¯èƒ½å¾ˆæœ‰ç”¨ï¼Œå®ƒå¯ä»¥å……å½“å…·æœ‰æ•°æ®ç»“æž„å’Œç®—æœ¯è¿ç®—çš„é€šç”¨ç¼–ç¨‹è¯­è¨€ã€‚
      <a class="link" href="#OEBPS/apc.html" title="é™„å½• C. GNU è‡ªç”±æ–‡æ¡£è®¸å¯è¯ â€” GNU é¡¹ç›® â€” è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼š (FSF)">é™„å½• C</a>åŒ…å«æœ¬ä¹¦çš„å…è´¹è®¸å¯è¯ã€‚</p><p>The final section of this book contains information that is not
      central to the goals ofthe book, but you might find it useful for
      unusual situations. <a class="link" href="#OEBPS/apa.html" title="Appendix&nbsp;A.&nbsp;Running make">Appendix A</a> lists
      the options that the GNU <code class="literal">make</code> command
      accepts on the command line. <a class="link" href="#OEBPS/apb.html" title="Appendix&nbsp;B.&nbsp;The Outer Limits">Appendix
      B</a>, which you will find amusing and possibly useful, stretches
      <code class="literal">make</code> to act as a general-purpose
      programming language with data structures and arithmetic operations.
      <a class="link" href="#OEBPS/apc.html" title="Appendix&nbsp;C.&nbsp;GNU Free Documentation Licenseâ€”GNU Projectâ€”Free Software Foundation (FSF)">Appendix C</a> contains the free license
      for the book.</p><p><a class="link" href="#OEBPS/apa.html" title="é™„å½• A. è¿è¡Œ make">é™„å½• A</a>ï¼Œè¿è¡Œ make Makefile</p><p><a class="link" href="#OEBPS/apa.html" title="Appendix&nbsp;A.&nbsp;Running make">Appendix A</a>, Running make
      Makefile</p><p><a class="link" href="#OEBPS/apb.html" title="é™„å½• B. å¤–éƒ¨é™åˆ¶">é™„å½•B</a>ï¼Œå¤–éƒ¨é™åˆ¶</p><p><a class="link" href="#OEBPS/apb.html" title="Appendix&nbsp;B.&nbsp;The Outer Limits">Appendix B</a>, The Outer
      Limits</p><p><a class="link" href="#OEBPS/apc.html" title="é™„å½• C. GNU è‡ªç”±æ–‡æ¡£è®¸å¯è¯ â€” GNU é¡¹ç›® â€” è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼š (FSF)">é™„å½• C</a>ï¼ŒGNU è‡ªç”±æ–‡æ¡£è®¸å¯è¯ â€” GNU é¡¹ç›® â€” è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼š (FSF)</p><p><a class="link" href="#OEBPS/apc.html" title="Appendix&nbsp;C.&nbsp;GNU Free Documentation Licenseâ€”GNU Projectâ€”Free Software Foundation (FSF)">Appendix C</a>, GNU Free
      Documentation Licenseâ€”GNU Projectâ€”Free Software Foundation (FSF)</p></div></div></div></div>
<div id="OEBPS/apa.html"><div>
<div class="appendix" title="é™„å½• A. è¿è¡Œ make"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/apa.html.make3-APP-A"></a>é™„å½• A. è¿è¡Œ make</h1><h1 class="title"><a></a>Appendix&nbsp;A.&nbsp;Running make</h1></div></div></div><p><acronym class="acronym">GNU </acronym> <em class="command">make</em>æœ‰ä¸€ç»„ä»¤äººå°è±¡æ·±åˆ»çš„å‘½ä»¤è¡Œé€‰é¡¹ã€‚å¤§å¤šæ•°å‘½ä»¤è¡Œé€‰é¡¹åŒ…æ‹¬çŸ­å½¢å¼å’Œé•¿å½¢å¼ã€‚çŸ­å‘½ä»¤ç”¨å•ç ´æŠ˜å·åŽè·Ÿå•ä¸ªå­—ç¬¦è¡¨ç¤ºï¼Œè€Œé•¿é€‰é¡¹ä»¥åŒç ´æŠ˜å·å¼€å¤´ï¼Œé€šå¸¸åŽè·Ÿç”±ç ´æŠ˜å·åˆ†éš”çš„æ•´ä¸ªå•è¯ã€‚è¿™äº›å‘½ä»¤çš„è¯­æ³•æ˜¯ï¼š</p><p><acronym class="acronym">GNU</acronym> <em class="command">make</em> has
      an impressive set of command-line options. Most command-line options
      include a short form and a long form. Short commands are indicated with
      a single dash followed by a single character, while long options begin
      with a double dash usually followed by whole words separated by dashes.
      The syntax of these commands is:</p><a id="OEBPS/apa.html.I__tt550"></a><pre class="programlisting">-o <em class="replaceable"><code>argument</code></em>
--é€‰é¡¹å­—=<em class="replaceable"><code>argument</code></em></pre><pre class="programlisting">-o<em class="replaceable"><code>argument</code></em>
--option-word=<em class="replaceable"><code>argument</code></em></pre><p>ä»¥ä¸‹æ˜¯æœ€å¸¸ç”¨çš„<em class="command">make</em>é€‰é¡¹ã€‚æœ‰å…³å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜…
      <acronym class="acronym">GNU </acronym> <em class="command">make</em>æ‰‹å†Œæˆ–è¾“å…¥<code class="literal">make --help</code>ã€‚</p><p>The following are the most commonly used options to <em class="command">make</em>. For a complete listing, see the
      <acronym class="acronym">GNU</acronym> <em class="command">make</em> manual or
      type <code class="literal">make --help</code>.</p><div class="variablelist"><dl><dt><span class="term"><code class="option">â€”always-make</code></span></dt><dt><span class="term"><code class="option">â€”always-make</code></span></dt><dd><p></p></dd><dd><p></p></dd><dt><span class="term"><code class="option">-B</code></span></dt><dt><span class="term"><code class="option">-B</code></span></dt><dd><p>å‡è®¾æ‰€æœ‰ç›®æ ‡éƒ½å·²å®Œæˆ<a id="OEBPS/apa.html.make3-APP-A-ITERM-1610" class="indexterm"></a>æ—¥æœŸå¹¶å…¨éƒ¨æ›´æ–°ã€‚</p></dd><dd><p>Assume every target is out <a class="indexterm"></a>of date and update them all.</p></dd><dt><span class="term"><code class="option">â€”directory=</code>
          <em class="replaceable"><code>directory</code></em></span></dt><dt><span class="term"><code class="option">â€”directory=</code>
          <em class="replaceable"><code>directory</code></em></span></dt><dd><p></p></dd><dd><p></p></dd><dt><span class="term"><code class="option">-C </code>
          <em class="replaceable"><code>directory</code></em></span></dt><dt><span class="term"><code class="option">-C </code>
          <em class="replaceable"><code>directory</code></em></span></dt><dd><p>æ›´æ”¹ä¸ºç»™å®šçš„<a id="OEBPS/apa.html.make3-APP-A-ITERM-1611" class="indexterm"></a>æœç´¢<em class="filename">makefile</em>æˆ–æ‰§è¡Œä»»ä½•å·¥ä½œä¹‹å‰çš„ç›®å½•ã€‚è¿™ä¹Ÿå°†å˜é‡è®¾ç½®<code class="literal">CURDIR</code>
            ä¸º<em class="replaceable"><code>directory</code></em>ã€‚</p></dd><dd><p>Change to the given <a class="indexterm"></a>directory before searching for a <em class="filename">makefile</em> or performing any work. This
            also sets the variable <code class="literal">CURDIR</code>
            to <em class="replaceable"><code>directory</code></em>.</p></dd><dt><span class="term"><code class="option">â€”environment-overrides</code></span></dt><dt><span class="term"><code class="option">â€”environment-overrides</code></span></dt><dd><p></p></dd><dd><p></p></dd><dt><span class="term"><code class="option">-e</code></span></dt><dt><span class="term"><code class="option">-e</code></span></dt><dd><p>å–œæ¬¢çŽ¯å¢ƒ<a id="OEBPS/apa.html.make3-APP-A-ITERM-1612" class="indexterm"></a>å½“æœ‰é€‰æ‹©æ—¶ï¼Œå˜é‡åˆ°<em class="filename">makefile</em>å˜é‡ã€‚å¯¹äºŽç‰¹å®šå˜é‡ï¼Œå¯ä»¥ä½¿ç”¨è¯¥æŒ‡ä»¤åœ¨<em class="filename">makefile</em>ä¸­è¦†ç›–æ­¤å‘½ä»¤è¡Œé€‰é¡¹
            <code class="function">override</code>
            ã€‚</p></dd><dd><p>Prefer environment <a class="indexterm"></a>variables to <em class="filename">makefile</em> variables when there is a
            choice. This command-line option can be overridden in the
            <em class="filename">makefile</em> for particular
            variables with the <code class="function">override</code>
            directive.</p></dd><dt><span class="term"><code class="option">â€”file=</code>
          <em class="replaceable"><code>makefile</code></em></span></dt><dt><span class="term"><code class="option">â€”file=</code>
          <em class="replaceable"><code>makefile</code></em></span></dt><dd><p></p></dd><dd><p></p></dd><dt><span class="term"><code class="option">-f </code>
          <em class="replaceable"><code>makefile</code></em></span></dt><dt><span class="term"><code class="option">-f </code>
          <em class="replaceable"><code>makefile</code></em></span></dt><dd><p>è¯»å–ç»™å®šçš„æ–‡ä»¶<a id="OEBPS/apa.html.make3-APP-A-ITERM-1613" class="indexterm"></a>ä½œä¸º<em class="filename">makefile</em>
            è€Œä¸æ˜¯ä»»ä½•é»˜è®¤åç§°ï¼ˆå³<em class="filename">makefile</em>ã€<em class="filename">Makefile</em>æˆ–<em class="filename">GNUMakefile</em>ï¼‰ã€‚</p></dd><dd><p>Read the given file <a class="indexterm"></a>as the <em class="filename">makefile</em>
            rather than any of the default names (i.e., <em class="filename">makefile</em>, <em class="filename">Makefile</em>, or <em class="filename">GNUMakefile</em>).</p></dd><dt><span class="term"><code class="option">â€”help</code></span></dt><dt><span class="term"><code class="option">â€”help</code></span></dt><dd><p></p></dd><dd><p></p></dd><dt><span class="term"><code class="option">-h</code></span></dt><dt><span class="term"><code class="option">-h</code></span></dt><dd><p>æ‰“å°ç®€ä»‹<a id="OEBPS/apa.html.make3-APP-A-ITERM-1614" class="indexterm"></a>å‘½ä»¤è¡Œé€‰é¡¹çš„æ‘˜è¦ã€‚</p></dd><dd><p>Print a brief <a class="indexterm"></a>summary of the command-line options.</p></dd><dt><span class="term"><code class="option">â€”include-dir=</code>
          <em class="replaceable"><code>directory</code></em></span></dt><dt><span class="term"><code class="option">â€”include-dir=</code>
          <em class="replaceable"><code>directory</code></em></span></dt><dd><p></p></dd><dd><p></p></dd><dt><span class="term"><code class="option">-I </code>
          <em class="replaceable"><code>directory</code></em></span></dt><dt><span class="term"><code class="option">-I </code>
          <em class="replaceable"><code>directory</code></em></span></dt><dd><p>å¦‚æžœåŒ…å«æ–‡ä»¶æ²¡æœ‰<a id="OEBPS/apa.html.make3-APP-A-ITERM-1615" class="indexterm"></a>å­˜åœ¨äºŽå½“å‰ç›®å½•ä¸­ï¼Œåœ¨æœç´¢ç¼–è¯‘çš„æœç´¢è·¯å¾„ä¹‹å‰åœ¨æŒ‡ç¤ºçš„ç›®å½•ä¸­æŸ¥æ‰¾åŒ…å«æ–‡ä»¶ã€‚<code class="option">â€”include-dir</code>å‘½ä»¤è¡Œä¸Šå¯ä»¥ç»™å‡ºä»»æ„æ•°é‡çš„
            é€‰é¡¹ã€‚</p></dd><dd><p>If an include file does not <a class="indexterm"></a>exist in the current directory, look in the
            indicated directories for include files before searching the
            compiled-in search path. Any number of
            <code class="option">â€”include-dir</code> options can be given on the command
            line.</p></dd><dt><span class="term"><code class="option">â€”keep-going</code></span></dt><dt><span class="term"><code class="option">â€”keep-going</code></span></dt><dd><p></p></dd><dd><p></p></dd><dt><span class="term"><code class="option">-k</code></span></dt><dt><span class="term"><code class="option">-k</code></span></dt><dd><p>ä¸è¦ç»ˆæ­¢<a id="OEBPS/apa.html.make3-APP-A-ITERM-1616" class="indexterm"></a>å¦‚æžœå‘½ä»¤è¿”å›žé”™è¯¯çŠ¶æ€ï¼Œåˆ™<em class="command">make</em>è¿›ç¨‹ã€‚ç›¸åï¼Œè·³è¿‡å½“å‰ç›®æ ‡çš„å…¶ä½™éƒ¨åˆ†ï¼Œå¹¶ç»§ç»­æ‰§è¡Œå…¶ä»–ç›®æ ‡ã€‚</p></dd><dd><p>Do not terminate <a class="indexterm"></a>the <em class="command">make</em> process
            if a command returns an error status. Instead, skip the remainder
            of the current target, and continue on with other targets.</p></dd><dt><span class="term"><code class="option">â€”just-print</code></span></dt><dt><span class="term"><code class="option">â€”just-print</code></span></dt><dd><p></p></dd><dd><p></p></dd><dt><span class="term"><code class="option">-n</code></span></dt><dt><span class="term"><code class="option">-n</code></span></dt><dd><p>æ˜¾ç¤ºå‘½ä»¤é›†<a id="OEBPS/apa.html.make3-APP-A-ITERM-1617" class="indexterm"></a><em class="command">å®ƒå°†ç”±make</em>æ‰§è¡Œï¼Œä½†ä¸æ‰§è¡Œå‘½ä»¤è„šæœ¬ä¸­çš„ä»»ä½•å‘½ä»¤ã€‚å½“æ‚¨æƒ³åœ¨å®žé™…æ‰§è¡Œä¹‹å‰çŸ¥é“<em class="command">make</em>å°†åšä»€ä¹ˆæ—¶ï¼Œè¿™éžå¸¸æœ‰ç”¨ã€‚è¯·æ³¨æ„ï¼Œæ­¤é€‰é¡¹ä¸ä¼šé˜»æ­¢<code class="function">shell</code>å‡½æ•°ä¸­çš„ä»£ç æ‰§è¡Œï¼Œåªä¼šé˜»æ­¢å‘½ä»¤è„šæœ¬ä¸­çš„å‘½ä»¤æ‰§è¡Œã€‚</p></dd><dd><p>Display the set of commands <a class="indexterm"></a>that would be executed by <em class="command">make</em>, but do not execute any commands
            from command scripts. This is very useful when you want to know
            what <em class="command">make</em> will do before
            actually doing it. Be aware that this option does not prevent code
            in <code class="function">shell</code> functions from
            executing, just commands in command scripts.</p></dd><dt><span class="term"><code class="option">â€”old-file=</code>
          <em class="replaceable"><code>file</code></em></span></dt><dt><span class="term"><code class="option">â€”old-file=</code>
          <em class="replaceable"><code>file</code></em></span></dt><dd><p></p></dd><dd><p></p></dd><dt><span class="term"><code class="option">-o </code> <em class="replaceable"><code>file</code></em></span></dt><dt><span class="term"><code class="option">-o </code> <em class="replaceable"><code>file</code></em></span></dt><dd><p><em class="replaceable"><code>file</code></em>å½“ä½œæ˜¯ä¸€æ ·å¯¹å¾…<a id="OEBPS/apa.html.make3-APP-A-ITERM-1618" class="indexterm"></a>æ— é™æ—§ï¼Œå¹¶æ‰§è¡Œé€‚å½“çš„æ“ä½œæ¥æ›´æ–°ç›®æ ‡ã€‚å¦‚æžœæ–‡ä»¶è¢«æ„å¤–è§¦åŠæˆ–ç¡®å®šæŸä¸ªå…ˆå†³æ¡ä»¶å¯¹ä¾èµ–å…³ç³»å›¾çš„å½±å“ï¼Œè¿™å¯èƒ½éžå¸¸æœ‰ç”¨ã€‚è¿™æ˜¯<code class="option">â€”new-file</code>( )çš„è¡¥é›†
            <code class="option">-W</code>ã€‚</p></dd><dd><p>Treat <em class="replaceable"><code>file</code></em> as if it
            were<a class="indexterm"></a> infinitely old, and perform the appropriate actions
            to update the goals. This can be very useful if a file has been
            accidentally touched or to determine the effect of one
            prerequisite on the dependency graph. This is the complement of
            <code class="option">â€”new-file</code> (<code class="option">-W</code>).</p></dd><dt><span class="term"><code class="option">â€”print-data-base</code></span></dt><dt><span class="term"><code class="option">â€”print-data-base</code></span></dt><dd><p></p></dd><dd><p></p></dd><dt><span class="term"><code class="option">-p</code></span></dt><dt><span class="term"><code class="option">-p</code></span></dt><dd><p>æ‰“å°<em class="command">make</em>çš„å†…éƒ¨ä¿¡æ¯
            <a id="OEBPS/apa.html.make3-APP-A-ITERM-1619" class="indexterm"></a>æ•°æ®åº“ã€‚</p></dd><dd><p>Print <em class="command">make</em>'s internal
            <a class="indexterm"></a>database.</p></dd><dt><span class="term"><code class="option">â€”touch</code></span></dt><dt><span class="term"><code class="option">â€”touch</code></span></dt><dd><p></p></dd><dd><p></p></dd><dt><span class="term"><code class="option">-t</code></span></dt><dt><span class="term"><code class="option">-t</code></span></dt><dd><p>åœ¨æ¯ä¸ªä¸Šæ‰§è¡Œ<em class="command">è§¦æ‘¸ç¨‹åº</em><a id="OEBPS/apa.html.make3-APP-A-ITERM-1620" class="indexterm"></a>è¿‡æ—¶çš„ç›®æ ‡æ›´æ–°å…¶æ—¶é—´æˆ³ã€‚è¿™å¯¹äºŽä½¿ä¾èµ–å…³ç³»å›¾ä¸­çš„æ–‡ä»¶ä¿æŒæœ€æ–°éžå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œç¼–è¾‘ä¸­å¤®å¤´æ–‡ä»¶ä¸­çš„æ³¨é‡Šå¯èƒ½ä¼šå¯¼è‡´
            <em class="command">make</em>ä¸å¿…è¦åœ°é‡æ–°ç¼–è¯‘å¤§é‡ä»£ç ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è¯¥<code class="option">â€”touch</code>
            é€‰é¡¹å¼ºåˆ¶æ‰€æœ‰æ–‡ä»¶ä¿æŒæœ€æ–°ï¼Œè€Œä¸æ˜¯æ‰§è¡Œç¼–è¯‘å’Œæµªè´¹æœºå™¨å‘¨æœŸã€‚</p></dd><dd><p>Execute the <em class="command">touch</em> program
            on each <a class="indexterm"></a>out-of-date target to update its timestamp. This can
            be useful in bringing the files in a dependency graph up to date.
            For instance, editing a comment in a central header file may cause
            <em class="command">make</em> to unnecessarily recompile
            an immense amount of code. Instead of performing the compile and
            wasting machine cycles, you can use the <code class="option">â€”touch</code>
            option to force all files to be up to date.</p></dd><dt><span class="term"><code class="option">â€”new-file=</code>
          <em class="replaceable"><code>file</code></em></span></dt><dt><span class="term"><code class="option">â€”new-file=</code>
          <em class="replaceable"><code>file</code></em></span></dt><dd><p></p></dd><dd><p></p></dd><dt><span class="term"><code class="option">-W </code> <em class="replaceable"><code>file</code></em></span></dt><dt><span class="term"><code class="option">-W </code> <em class="replaceable"><code>file</code></em></span></dt><dd><p>å‡è®¾<em class="replaceable"><code>file</code></em>æ›´æ–°äºŽ
            <a id="OEBPS/apa.html.make3-APP-A-ITERM-1621" class="indexterm"></a>ä»»ä½•ç›®æ ‡ã€‚è¿™å¯¹äºŽå¼ºåˆ¶æ›´æ–°ç›®æ ‡å¾ˆæœ‰ç”¨ï¼Œè€Œæ— éœ€ç¼–è¾‘æˆ–è§¦æ‘¸æ–‡ä»¶ã€‚è¿™æ˜¯ çš„è¡¥é›†<code class="option">â€”old-file</code>ã€‚</p></dd><dd><p>Assume <em class="replaceable"><code>file</code></em> is newer than
            <a class="indexterm"></a>any target. This can be useful in forcing an update
            on targets without having to edit or touch a file. This is the
            complement of <code class="option">â€”old-file</code>.</p></dd><dt><span class="term"><code class="option">â€”warn-undefined-variables</code></span></dt><dt><span class="term"><code class="option">â€”warn-undefined-variables</code></span></dt><dd><p>æ‰“å°è­¦å‘Š<a id="OEBPS/apa.html.make3-APP-A-ITERM-1622" class="indexterm"></a>å¦‚æžœæ‰©å±•äº†æœªå®šä¹‰çš„å˜é‡ï¼Œåˆ™æ˜¾ç¤ºæ¶ˆæ¯ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„è¯Šæ–­å·¥å…·ï¼Œå› ä¸ºæœªå®šä¹‰çš„å˜é‡ä¼šæ‚„æ‚„æ¶ˆå¤±ã€‚ç„¶è€Œï¼Œå‡ºäºŽå®šåˆ¶ç›®çš„ï¼Œåœ¨<em class="filename">makefile</em>ä¸­åŒ…å«ç©ºå˜é‡ä¹Ÿå¾ˆå¸¸è§ã€‚æ­¤é€‰é¡¹ä¹Ÿå°†æŠ¥å‘Šä»»ä½•æœªè®¾ç½®çš„è‡ªå®šä¹‰å˜é‡ã€‚</p></dd><dd><p>Print a warning <a class="indexterm"></a>message if an undefined variable is expanded. This
            is a useful diagnostic tool since undefined variables quietly
            collapse into nothing. However, it is also common to include empty
            variables in <em class="filename">makefile</em>s for
            customization purposes. Any unset customization variables will be
            reported by this option as well.</p></dd></dl></div></div></div></div>
<div id="OEBPS/apb.html"><div>
<div class="appendix" title="é™„å½• B. å¤–éƒ¨é™åˆ¶"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/apb.html.make3-APP-B"></a>é™„å½• B. å¤–éƒ¨é™åˆ¶</h1><h1 class="title"><a></a>Appendix&nbsp;B.&nbsp;The Outer Limits</h1></div></div></div><p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œ<acronym class="acronym">GNU </acronym> <em class="command">make</em>å¯ä»¥åšä¸€äº›éžå¸¸ä»¤äººéš¾ä»¥ç½®ä¿¡çš„äº‹æƒ…ï¼Œä½†æˆ‘è¿˜æ²¡æœ‰çœ‹åˆ°å¤ªå¤šçœŸæ­£çªç ´<em class="command">make</em> 3.80 åŠå…¶<code class="function">eval</code>æž„é€ é™åˆ¶çš„ä¸œè¥¿ã€‚åœ¨æœ¬ç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹æ˜¯å¦å¯ä»¥æ¯”å¹³å¸¸è¿›ä¸€æ­¥æ‰©å±•å®ƒã€‚</p><p>As you've seen, <acronym class="acronym">GNU</acronym> <em class="command">make</em> can do some pretty incredible things, but
      I haven't seen very much that really pushes the limits of <em class="command">make</em> 3.80 with its <code class="function">eval</code> construct. In this exercise, we'll see
      if we can stretch it further than usual.</p><div class="sect1" title="æ•°æ®ç»“æž„"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/apb.html.make3-APP-B-SECT-1"></a>æ•°æ®ç»“æž„</h1><h1 class="title"><a></a>Data Structures</h1></div></div></div><p><em class="command">make</em>çš„å±€é™æ€§ä¹‹ä¸€<em class="command"></em> <a id="OEBPS/apb.html.make3-APP-B-ITERM-1623" class="indexterm"></a><em class="filename">åœ¨ç¼–å†™å¤æ‚çš„makefile</em>æ—¶å¶å°”ä¼šå‡ºçŽ°é—®é¢˜ï¼Œå› ä¸º<em class="command">make</em>ç¼ºä¹æ•°æ®ç»“æž„ã€‚ä»¥éžå¸¸æœ‰é™çš„æ–¹å¼ï¼Œæ‚¨å¯ä»¥é€šè¿‡å®šä¹‰æ¥æ¨¡æ‹Ÿæ•°æ®ç»“æž„<a id="OEBPS/apb.html.make3-APP-B-ITERM-1624" class="indexterm"></a> <a id="OEBPS/apb.html.make3-APP-B-ITERM-1625" class="indexterm"></a>å¸¦æœ‰åµŒå…¥å¥ç‚¹çš„å˜é‡ï¼ˆæˆ–è€…å³ä½¿<code class="literal">-&gt;</code>ä½ å¯ä»¥å¿å—ï¼‰ï¼š</p><p>One of the limitations of <em class="command">make</em> <a class="indexterm"></a>that occasionally chaffs when writing complex <em class="filename">makefile</em>s is <em class="command">make</em>'s lack of data structures. In a very
        limited way, you can simulate a data structure by defining <a class="indexterm"></a> <a class="indexterm"></a>variables with embedded periods (or even <code class="literal">-&gt;</code> if you can stand it):</p><a id="OEBPS/apb.html.I__tt551"></a><pre class="programlisting">æ–‡ä»¶.path = /foo/bar
æ–‡ä»¶ç±»åž‹=unix
æ–‡ä»¶.host = å¥¥æ–¯å¡</pre><pre class="programlisting">file.path = /foo/bar
file.type = unix
file.host = oscar</pre><p>å¦‚æžœæŒ‰ä¸‹ï¼Œæ‚¨ç”šè‡³å¯ä»¥<code class="literal">file</code>ä½¿ç”¨è®¡ç®—å˜é‡å°†æ­¤ç»“æž„â€œä¼ é€’â€ç»™å‡½æ•°ï¼š</p><p>If pressed, you can even "pass" this <code class="literal">file</code> structure to a function by using
        computed variables:</p><a id="OEBPS/apb.html.I__tt552"></a><pre class="programlisting">å®šä¹‰è¿œç¨‹æ–‡ä»¶
  $(if $(è¿‡æ»¤unix,$($1.type)), \
    /net/$($1.host)/$($1.path), \
    //$($1.ä¸»æœº)/$($1.è·¯å¾„))
æ©å¾·å¤«</pre><pre class="programlisting">define remote-file
  $(if $(filter unix,$($1.type)), \
    /net/$($1.host)/$($1.path),   \
    //$($1.host)/$($1.path))
endef</pre><p>ç„¶è€Œï¼Œç”±äºŽä»¥ä¸‹å‡ ä¸ªåŽŸå› ï¼Œè¿™ä¼¼ä¹Žæ˜¯ä¸€ä¸ªä»¤äººä¸æ»¡æ„çš„è§£å†³æ–¹æ¡ˆï¼š</p><p>Nevertheless, this seems an unsatisfying solution for several
        reasons:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>æ‚¨æ— æ³•è½»æ¾åˆ†é…æ­¤â€œç»“æž„â€çš„å®žä¾‹ã€‚åˆ›å»ºæ–°å®žä¾‹æ¶‰åŠé€‰æ‹©æ–°å˜é‡åç§°å¹¶åˆ†é…æ¯ä¸ªå…ƒç´ ã€‚è¿™ä¹Ÿæ„å‘³ç€è¿™äº›ä¼ªå®žä¾‹ä¸èƒ½ä¿è¯å…·æœ‰ç›¸åŒçš„å­—æ®µï¼ˆç§°ä¸º
            <em class="firstterm">slot</em>ï¼‰ã€‚</p></li><li class="listitem"><p>You cannot easily allocate a instance of this "structure."
            Creating a new instance involves selecting a new variable name and
            assigning each element. This also means these pseudo-instances are
            not guaranteed to have the same fields (called
            <em class="firstterm">slots</em>).</p></li><li class="listitem"><p>è¯¥ç»“æž„ä»…å­˜åœ¨äºŽç”¨æˆ·çš„è„‘æµ·ä¸­ï¼Œå¹¶ä¸”ä½œä¸ºä¸€ç»„ä¸åŒçš„<em class="command">make</em>å˜é‡ï¼Œè€Œä¸æ˜¯ä½œä¸ºå…·æœ‰è‡ªå·±åç§°çš„ç»Ÿä¸€å®žä½“ã€‚è€Œä¸”ç”±äºŽç»“æž„æ²¡æœ‰åç§°ï¼Œå› æ­¤å¾ˆéš¾åˆ›å»ºå¯¹ç»“æž„çš„å¼•ç”¨ï¼ˆæˆ–æŒ‡é’ˆï¼‰ï¼Œå› æ­¤å°†å®ƒä»¬ä½œä¸ºå‚æ•°ä¼ é€’æˆ–å°†å…¶å­˜å‚¨åœ¨å˜é‡ä¸­æ˜¯ç¬¨æ‹™çš„ã€‚</p></li><li class="listitem"><p>The structure exists only in the user's mind, and as a set
            of different <em class="command">make</em> variables,
            rather than as a unified entity with its own name. And because the
            structure has no name, it is difficult to create a reference (or
            pointer) to a structure, so passing them as arguments or storing
            one in a variable is clumsy.</p></li><li class="listitem"><p>æ²¡æœ‰å®‰å…¨çš„æ–¹æ³•æ¥è®¿é—®è¯¥ç»“æž„çš„æ§½ã€‚å˜é‡åä»»ä¸€éƒ¨åˆ†ä¸­çš„ä»»ä½•å°åˆ·é”™è¯¯éƒ½ä¼šäº§ç”Ÿé”™è¯¯å€¼ï¼ˆæˆ–æ— å€¼ï¼‰ï¼Œå¹¶ä¸”<em class="command">make</em>ä¸ä¼šå‘å‡ºè­¦å‘Šã€‚</p></li><li class="listitem"><p>There is no safe way to access a slot of the structure. Any
            typographical error in either part of the variable name yields the
            wrong value (or no value) with no warning from <em class="command">make</em>.</p></li></ul></div><p>ä½†<code class="function">remote-file</code>
        åŠŸèƒ½<a id="OEBPS/apb.html.make3-APP-B-ITERM-1626" class="indexterm"></a> <a id="OEBPS/apb.html.make3-APP-B-ITERM-1627" class="indexterm"></a>æš—ç¤ºäº†æ›´å…¨é¢çš„è§£å†³æ–¹æ¡ˆã€‚å‡è®¾æˆ‘ä»¬ä½¿ç”¨è®¡ç®—å˜é‡å®žçŽ°ç»“æž„å®žä¾‹ã€‚æ—©æœŸçš„ Lisp å¯¹è±¡ç³»ç»Ÿï¼ˆç”šè‡³ä»Šå¤©çš„ä¸€äº›ï¼‰ä½¿ç”¨äº†ç±»ä¼¼çš„æŠ€æœ¯ã€‚ä¸€ä¸ªç»“æž„ï¼Œä¾‹å¦‚<code class="literal">file-info</code>ï¼Œå¯ä»¥å…·æœ‰ç”±ç¬¦å·åç§°è¡¨ç¤ºçš„å®žä¾‹ï¼Œä¾‹å¦‚<code class="literal">file_info_1</code>ã€‚</p><p>But the <code class="function">remote-file</code>
        function <a class="indexterm"></a> <a class="indexterm"></a>hints at a more comprehensive solution. Suppose we
        implement structure instances using computed variables. Early Lisp
        object systems (and even some today) used similar techniques. A
        structure, say <code class="literal">file-info</code>, can have
        instances represented by a symbolic name, such as <code class="literal">file_info_1</code>.</p><p>å¦ä¸€ä¸ªå®žä¾‹å¯èƒ½ç§°ä¸º<code class="literal">file_info_2</code>.è¯¥ç»“æž„çš„æ§½å¯ä»¥ç”¨è®¡ç®—å˜é‡è¡¨ç¤ºï¼š</p><p>Another instance might be called <code class="literal">file_info_2</code>. The slots of this structure can
        be represented by computed variables:</p><a id="OEBPS/apb.html.I__tt553"></a><pre class="programlisting">æ–‡ä»¶ä¿¡æ¯_1_è·¯å¾„
æ–‡ä»¶ä¿¡æ¯_1_ç±»åž‹
æ–‡ä»¶ä¿¡æ¯_1_ä¸»æœº</pre><pre class="programlisting">file_info_1_path
file_info_1_type
file_info_1_host</pre><p>ç”±äºŽå®žä¾‹å…·æœ‰ç¬¦å·åç§°ï¼Œå› æ­¤å¯ä»¥å°†å…¶ä¿å­˜åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªå˜é‡ä¸­ï¼ˆåƒå¾€å¸¸ä¸€æ ·ï¼Œä½¿ç”¨é€’å½’æˆ–ç®€å•å˜é‡æ˜¯ç¨‹åºå‘˜çš„é€‰æ‹©ï¼‰ï¼š</p><p>Since the instance has a symbolic name, it can be saved in one
        or more variables (as usual, using recursive or simple variables is
        the choice of the programmer):</p><a id="OEBPS/apb.html.I__tt554"></a><pre class="programlisting">before_foo = file_info_1
another_foo = $(before_foo)</pre><pre class="programlisting">before_foo = file_info_1
another_foo = $(before_foo)</pre><p>a çš„å…ƒç´ <code class="literal">file-info</code>å¯ä»¥ä½¿ç”¨ç±»ä¼¼ Lisp çš„ getter å’Œ setter æ¥è®¿é—®ï¼š</p><p>Elements of a <code class="literal">file-info</code> can
        be accessed using Lisp-like getters and setters:</p><a id="OEBPS/apb.html.I__tt555"></a><pre class="programlisting">è·¯å¾„ := $(è°ƒç”¨ get-value,before_foo,path)
$(è°ƒç”¨è®¾ç½®å€¼,before_foo,è·¯å¾„,/usr/tmp/bar)</pre><pre class="programlisting">path := $(call get-value,before_foo,path)
$(call set-value,before_foo,path,/usr/tmp/bar)</pre><p>æˆ‘ä»¬å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼Œä¸º
        <code class="literal">file-info</code>ç»“æž„åˆ›å»ºä¸€ä¸ªæ¨¡æ¿ï¼Œä»¥ä¾¿æ–¹ä¾¿åœ°åˆ†é…æ–°å®žä¾‹ï¼š</p><p>We can go further than this by creating a template for the
        <code class="literal">file-info</code> structure to allow the
        convenient allocation of new instances:</p><a id="OEBPS/apb.html.I__tt556"></a><pre class="programlisting">orig_foo := $(è°ƒç”¨æ–°çš„ï¼Œæ–‡ä»¶ä¿¡æ¯)
$(è°ƒç”¨è®¾ç½®å€¼,orig_foo,è·¯å¾„,/foo/bar)

tmp_foo := $(è°ƒç”¨æ–°çš„ï¼Œæ–‡ä»¶ä¿¡æ¯)
$(è°ƒç”¨è®¾ç½®å€¼,tmp_foo,è·¯å¾„,/tmp/bar)</pre><pre class="programlisting">orig_foo := $(call new,file-info)
$(call set-value,orig_foo,path,/foo/bar)

tmp_foo := $(call new,file-info)
$(call set-value,tmp_foo,path,/tmp/bar)</pre><p>çŽ°åœ¨ï¼Œå­˜åœ¨ä¸¤ä¸ªä¸åŒçš„å®žä¾‹<code class="literal">file-info</code>ã€‚ä½œä¸ºæœ€åŽçš„ä¾¿åˆ©ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ æ§½é»˜è®¤å€¼çš„æ¦‚å¿µã€‚ä¸ºäº†å£°æ˜Ž
        <code class="literal">file-info</code>ç»“æž„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ï¼š</p><p>Now, two distinct instances of <code class="literal">file-info</code> exist. As a final convenience, we
        can add the concept of default values for slots. To declare the
        <code class="literal">file-info</code> structure, we might
        use:</p><a id="OEBPS/apb.html.I__tt557"></a><pre class="programlisting">$(è°ƒç”¨ defstruct,æ–‡ä»¶ä¿¡æ¯,\
  $(è°ƒç”¨ defslot,è·¯å¾„,), \
  $(è°ƒç”¨ defslot,ç±»åž‹,unix), \
  $(call defslot,host,oscar))</pre><pre class="programlisting">$(call defstruct,file-info,  \
  $(call defslot,path,),     \
  $(call defslot,type,unix), \
  $(call defslot,host,oscar))</pre><p>è¿™é‡Œï¼Œå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°<code class="function">defstruct</code>æ˜¯ç»“æž„åç§°ï¼ŒåŽé¢æ˜¯è°ƒç”¨åˆ—è¡¨<code class="function">defslot</code>
        ã€‚æ¯ä¸ªéƒ½<code class="function">defslot</code>åŒ…å«ä¸€ä¸ª ( <em class="replaceable"><code>name</code></em>,
         ) å¯¹ã€‚<a class="link" href="#OEBPS/apb.html.make3-APP-B-EX-1" title="ç¤ºä¾‹ B-1ã€‚ makeä¸­çš„ç»“æž„ä½“å®šä¹‰">ç¤ºä¾‹ B-1</a>æ˜¾ç¤ºäº†å®ƒçš„å®žçŽ°åŠå…¶æ”¯æŒä»£ç ã€‚<em class="replaceable"><code>default</code></em> <em class="replaceable"><code>value</code></em><a class="link" href="#OEBPS/apb.html.make3-APP-B-EX-1" title="ç¤ºä¾‹ B-1ã€‚ makeä¸­çš„ç»“æž„ä½“å®šä¹‰"></a><code class="function">defstruct</code></p><p>Here, the first argument to the <code class="function">defstruct</code> function is the structure name,
        followed by a list of <code class="function">defslot</code>
        calls. Each <code class="function">defslot</code> contains a
        single (<em class="replaceable"><code>name</code></em>,
        <em class="replaceable"><code>default</code></em> <em class="replaceable"><code>value</code></em>)
        pair. <a class="link" href="#OEBPS/apb.html.make3-APP-B-EX-1" title="Example&nbsp;B-1.&nbsp;Structure definition in make">Example B-1</a> shows the
        implementation of <code class="function">defstruct</code> and
        its supporting code.</p><div class="example"><a id="OEBPS/apb.html.make3-APP-B-EX-1"></a><p class="title">ç¤ºä¾‹ B-1ã€‚ makeä¸­çš„ç»“æž„ä½“å®šä¹‰</p><p class="title">Example&nbsp;B-1.&nbsp;Structure definition in make</p><div class="example-contents"><pre class="programlisting"># $(next-id) - è¿”å›žä¸€ä¸ªå”¯ä¸€çš„æ•°å­—
ä¸‹ä¸€ä¸ª_id_è®¡æ•°å™¨ï¼š=
å®šä¹‰ä¸‹ä¸€ä¸ª id
$(å•è¯$(next_id_counter))$(eval next_id_counter += 1)
æ©å¾·å¤«

# all_structs - å·²å®šä¹‰ç»“æž„åç§°çš„åˆ—è¡¨
æ‰€æœ‰ç»“æž„ï¼š=

value_sep := XxSepxX

# $(è°ƒç”¨ defstruct, struct_name, $(è°ƒç”¨ defslot, slot_name, value), ...)
å®šä¹‰defstruct
  $(eval all_structs += $1) \
  $(eval $1_def_slotnames :=) \
  $(foreach v, $2 $3 $4 $5 $6 $7 $8 $9 $(10) $(11), \
    $(å¦‚æžœ$($v_name), \
      $(eval $1_def_slotnames += $($v_name)) \
      $(eval $1_def_$($v_name)_default := $($v_value))))
æ©å¾·å¤«

# $(è°ƒç”¨ defslot,slot_name,slot_value)
å®šä¹‰defslot
  $(eval tmp_id := $(next_id))
  $(eval $1_$(tmp_id)_name := $1)
  $(eval $1_$(tmp_id)_value := $2)
  $1_$(tmp_id)
æ©å¾·å¤«

# all_instances - ä»»ä½•ç»“æž„çš„æ‰€æœ‰å®žä¾‹çš„åˆ—è¡¨
æ‰€æœ‰å®žä¾‹ :=

# $(è°ƒç”¨æ–°çš„, struct_name)
å®šä¹‰æ–°çš„
$(æ¡\
  $(å¦‚æžœ$(è¿‡æ»¤å™¨$1,$(all_structs)),, \
    $(æœªçŸ¥ç»“æž„'$(strip $1)'ä¸Šå‡ºçŽ°æ–°é”™è¯¯)) \
  $(eval å®žä¾‹ := $1@$(next-id)) \
  $(eval all_instances += $(å®žä¾‹)) \
  $(foreach v, $($(strip $1)_def_slotnames), \
    $(eval $(instance)_$v := $($(strip $1)_def_$v_default))) \
  $(å®žä¾‹))
æ©å¾·å¤«

# $(è°ƒç”¨åˆ é™¤ï¼Œå˜é‡)
å®šä¹‰åˆ é™¤
$(æ¡\
  $(if $(è¿‡æ»¤å™¨$($(strip $1)),$(all_instances)),, \
    $(é”™è¯¯æ— æ•ˆå®žä¾‹'$($(strip $1))')) \
  $(eval all_instances := $(è¿‡æ»¤æŽ‰ $($(strip $1)),$(all_instances))) \
  $(foreach v, $($(strip $1)_def_slotnames), \
    $(eval $(å®žä¾‹)_$v := )))
æ©å¾·å¤«

# $(è°ƒç”¨ç»“æž„ä½“åç§°ï¼Œinstance_id)
å®šä¹‰ç»“æž„ä½“åç§°
$(ç¬¬ä¸€ä¸ªå­— $(subst @, ,$($(strip $1))))
æ©å¾·å¤«

# $(è°ƒç”¨æ£€æŸ¥å‚æ•°ã€instance_idã€slot_name)
å®šä¹‰æ£€æŸ¥å‚æ•°
  $(if $(è¿‡æ»¤å™¨$($(strip $1)),$(all_instances)),, \
    $(é”™è¯¯æ— æ•ˆå®žä¾‹'$(strip $1)')) \
  $(if $(filter $2,$($(call struct-name,$1)_def_slotnames)),, \
    $(é”™è¯¯å®žä¾‹'$($(strip $1))'æ²¡æœ‰æ’æ§½'$(strip $2)'))
æ©å¾·å¤«

# $(è°ƒç”¨èŽ·å–å€¼ã€instance_idã€slot_name)
å®šä¹‰èŽ·å–å€¼
$(æ¡\
  $(è°ƒç”¨æ£€æŸ¥å‚æ•°,$1,$2) \
  $($($(æ¡å¸¦$1))_$(æ¡å¸¦$2)))
æ©å¾·å¤«

# $(è°ƒç”¨è®¾ç½®å€¼ï¼Œinstance_idï¼Œslot_nameï¼Œå€¼)
å®šä¹‰è®¾å®šå€¼
  $(è°ƒç”¨æ£€æŸ¥å‚æ•°,$1,$2) \
  $(eval $($(æ¡å¸¦$1))_$(æ¡å¸¦$2) := $3)
æ©å¾·å¤«

# $(è°ƒç”¨è½¬å‚¨ç»“æž„ï¼Œstruct_name)
å®šä¹‰è½¬å‚¨ç»“æž„
{ $(æ¡å¸¦ $1)_def_slotnames "$($(æ¡å¸¦ $1)_def_slotnames)" \
  $(foreach s, \
    $($(æ¡å¸¦$1)_def_slotnames),$(æ¡å¸¦\
    $(æ¡å¸¦$1)_def_$s_default "$($(æ¡å¸¦$1)_def_$s_default)")) }
æ©å¾·å¤«

# $(è°ƒç”¨æ‰“å°ç»“æž„ï¼Œç»“æž„åç§°)
å®šä¹‰æ‰“å°ç»“æž„
{ $(foreach s, \
    $($(æ¡å¸¦$1)_def_slotnames),$(æ¡å¸¦\
    { "$s" "$($(æ¡å¸¦ $1)_def_$s_default)" })) }
æ©å¾·å¤«

# $(è°ƒç”¨è½¬å‚¨å®žä¾‹ï¼Œinstance_id)
å®šä¹‰è½¬å‚¨å®žä¾‹
{ $(eval tmp_name := $(call struct-name,$1)) \
  $(foreach s, \
    $($(tmp_name)_def_slotnames),$(æ¡å¸¦\
    { $($(æ¡å¸¦ $1))_$s "$($($(æ¡å¸¦ $1))_$s)" })) }
æ©å¾·å¤«

# $(è°ƒç”¨æ‰“å°å®žä¾‹ï¼Œinstance_id)
å®šä¹‰æ‰“å°å®žä¾‹
{ $(foreach s, \
    $($(call struct-name,$1)_def_slotnames),"$(æ¡å¸¦\
    $(è°ƒç”¨ get-value,$1,$s))") }
æ©å¾·å¤«</pre><pre class="programlisting"># $(next-id) - return a unique number
next_id_counter :=
define next-id
$(words $(next_id_counter))$(eval next_id_counter += 1)
endef

# all_structs - a list of the defined structure names
all_structs :=

value_sep := XxSepxX

# $(call defstruct, struct_name, $(call defslot, slot_name, value), ...)
define defstruct
  $(eval all_structs += $1)                                             \
  $(eval $1_def_slotnames :=)                                           \
  $(foreach v, $2 $3 $4 $5 $6 $7 $8 $9 $(10) $(11),                     \
    $(if $($v_name),                                                    \
      $(eval $1_def_slotnames          += $($v_name))                   \
      $(eval $1_def_$($v_name)_default := $($v_value))))
endef

# $(call defslot,slot_name,slot_value)
define defslot
  $(eval tmp_id := $(next_id))
  $(eval $1_$(tmp_id)_name := $1)
  $(eval $1_$(tmp_id)_value := $2)
  $1_$(tmp_id)
endef

# all_instances - a list of all the instances of any structure
all_instances :=

# $(call new, struct_name)
define new
$(strip                                                         \
  $(if $(filter $1,$(all_structs)),,                            \
    $(error new on unknown struct '$(strip $1)'))               \
  $(eval instance := $1@$(next-id))                             \
  $(eval all_instances += $(instance))                          \
  $(foreach v, $($(strip $1)_def_slotnames),                    \
    $(eval $(instance)_$v := $($(strip $1)_def_$v_default)))    \
  $(instance))
endef

# $(call delete, variable)
define delete
$(strip                                                                  \
  $(if $(filter $($(strip $1)),$(all_instances)),,                       \
    $(error Invalid instance '$($(strip $1))'))                          \
  $(eval all_instances := $(filter-out $($(strip $1)),$(all_instances))) \
  $(foreach v, $($(strip $1)_def_slotnames),                             \
    $(eval $(instance)_$v := )))
endef

# $(call struct-name, instance_id)
define struct-name
$(firstword $(subst @, ,$($(strip $1))))
endef

# $(call check-params, instance_id, slot_name)
define check-params
  $(if $(filter $($(strip $1)),$(all_instances)),,              \
    $(error Invalid instance '$(strip $1)'))                    \
  $(if $(filter $2,$($(call struct-name,$1)_def_slotnames)),,   \
    $(error Instance '$($(strip $1))' does not have slot '$(strip $2)'))
endef

# $(call get-value, instance_id, slot_name)
define get-value
$(strip                         \
  $(call check-params,$1,$2)    \
  $($($(strip $1))_$(strip $2)))
endef

# $(call set-value, instance_id, slot_name, value)
define set-value
  $(call check-params,$1,$2) \
  $(eval $($(strip $1))_$(strip $2) := $3)
endef

# $(call dump-struct, struct_name)
define dump-struct
{ $(strip $1)_def_slotnames "$($(strip $1)_def_slotnames)"      \
  $(foreach s,                                                  \
    $($(strip $1)_def_slotnames),$(strip                        \
    $(strip $1)_def_$s_default "$($(strip $1)_def_$s_default)")) }
endef

# $(call print-struct, struct_name)
define print-struct
{ $(foreach s,                                  \
    $($(strip $1)_def_slotnames),$(strip        \
    { "$s" "$($(strip $1)_def_$s_default)" })) }
endef

# $(call dump-instance, instance_id)
define dump-instance
{ $(eval tmp_name := $(call struct-name,$1))    \
  $(foreach s,                                  \
    $($(tmp_name)_def_slotnames),$(strip        \
    { $($(strip $1))_$s "$($($(strip $1))_$s)" })) }
endef

# $(call print-instance, instance_id)
define print-instance
{ $(foreach s,                                          \
    $($(call struct-name,$1)_def_slotnames),"$(strip    \
    $(call get-value,$1,$s))") }
endef</pre></div></div><p>ä¸€æ¬¡æ£€æŸ¥ä¸€ä¸ªå­å¥ï¼Œæ‚¨ä¼šå‘çŽ°å®ƒæ˜¯ä»Žå®šä¹‰ function å¼€å§‹çš„<code class="function">next-id</code>ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è®¡æ•°å™¨ï¼š</p><p>Examining this code one clause at a time, you can see that it
        starts by defining the function <code class="function">next-id</code>. This is a simple counter:</p><a id="OEBPS/apb.html.I__tt558"></a><pre class="programlisting"># $(next-id) - è¿”å›žä¸€ä¸ªå”¯ä¸€çš„æ•°å­—
ä¸‹ä¸€ä¸ª_id_è®¡æ•°å™¨ï¼š=
å®šä¹‰ä¸‹ä¸€ä¸ª id
$(å•è¯$(next_id_counter))$(eval next_id_counter += 1)
æ©å¾·å¤«</pre><pre class="programlisting"># $(next-id) - return a unique number
next_id_counter :=
define next-id
$(words $(next_id_counter))$(eval next_id_counter += 1)
endef</pre><p>äººä»¬å¸¸è¯´ä½ ä¸èƒ½åœ¨<em class="command">make</em>ä¸­æ‰§è¡Œç®—æœ¯ï¼Œå› ä¸ºè¯­è¨€å¤ªæœ‰é™äº†ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™æ˜¯æ­£ç¡®çš„ï¼Œä½†å¯¹äºŽåƒè¿™æ ·çš„æœ‰é™æƒ…å†µï¼Œæ‚¨é€šå¸¸å¯ä»¥è®¡ç®—å‡ºæ‚¨éœ€è¦çš„å†…å®¹ã€‚è¯¥å‡½æ•°ç”¨äºŽ<code class="function">eval</code>é‡æ–°å®šä¹‰ç®€å•å˜é‡çš„å€¼ã€‚è¯¥å‡½æ•°åŒ…å«ä¸¤ä¸ªè¡¨è¾¾å¼ï¼šç¬¬ä¸€ä¸ªè¡¨è¾¾å¼è¿”å›ž ä¸­çš„å•è¯æ•°<code class="literal">next_id_counter</code>ï¼›ç¬¬äºŒä¸ªè¡¨è¾¾å¼å°†å¦ä¸€ä¸ªå•è¯é™„åŠ åˆ°å˜é‡ä¸­ã€‚å®ƒçš„æ•ˆçŽ‡ä¸æ˜¯å¾ˆé«˜ï¼Œä½†å¯¹äºŽå‡ åƒä¸ªæ•°å­—æ¥è¯´å·²ç»å¾ˆå¥½äº†ã€‚</p><p>It is often said that you cannot perform arithmetic in <em class="command">make</em>, because the language is too limited.
        In general, this is true, but for limited cases like this you can
        often compute what you need. This function uses <code class="function">eval</code> to redefine the value of a simple
        variable. The function contains two expressions: the first expression
        returns the number of words in <code class="literal">next_id_counter</code>; the second expression
        appends another word to the variable. It isn't very efficient, but for
        numbers in the small thousands it is fine.</p><p>ä¸‹ä¸€èŠ‚å®šä¹‰<code class="function">defstruct</code>å‡½æ•°æœ¬èº«å¹¶åˆ›å»ºæ”¯æŒæ•°æ®ç»“æž„ã€‚</p><p>The next section defines the <code class="function">defstruct</code> function itself and creates the
        supporting data structures.</p><a id="OEBPS/apb.html.I__tt559"></a><pre class="programlisting"># all_structs - å·²å®šä¹‰ç»“æž„åç§°çš„åˆ—è¡¨
æ‰€æœ‰ç»“æž„ï¼š=

value_sep := XxSepxX

# $(è°ƒç”¨ defstruct, struct_name, $(è°ƒç”¨ defslot, slot_name, value), ...)
å®šä¹‰defstruct
  $(eval all_structs += $1) \
  $(eval $1_def_slotnames :=) \
  $(foreach v, $2 $3 $4 $5 $6 $7 $8 $9 $(10) $(11), \
    $(å¦‚æžœ$($v_name), \
      $(eval $1_def_slotnames += $($v_name)) \
      $(eval $1_def_$($v_name)_default := $($v_value))))
æ©å¾·å¤«

# $(è°ƒç”¨ defslot,slot_name,slot_value)
å®šä¹‰defslot
  $(eval tmp_id := $(next_id))
  $(eval $1_$(tmp_id)_name := $1)
  $(eval $1_$(tmp_id)_value := $2)
  $1_$(tmp_id)
æ©å¾·å¤«</pre><pre class="programlisting"># all_structs - a list of the defined structure names
all_structs :=

value_sep := XxSepxX

# $(call defstruct, struct_name, $(call defslot, slot_name, value), ...)
define defstruct
  $(eval all_structs += $1)                              \
  $(eval $1_def_slotnames :=)                            \
  $(foreach v, $2 $3 $4 $5 $6 $7 $8 $9 $(10) $(11),      \
    $(if $($v_name),                                     \
      $(eval $1_def_slotnames          += $($v_name))    \
      $(eval $1_def_$($v_name)_default := $($v_value))))
endef

# $(call defslot,slot_name,slot_value)
define defslot
  $(eval tmp_id := $(next_id))
  $(eval $1_$(tmp_id)_name := $1)
  $(eval $1_$(tmp_id)_value := $2)
  $1_$(tmp_id)
endef</pre><p>è¯¥å˜é‡<code class="literal">all_structs</code>æ˜¯ç”¨ å®šä¹‰çš„æ‰€æœ‰å·²çŸ¥ç»“æž„çš„åˆ—è¡¨<code class="function">defstruct</code>ã€‚è¯¥åˆ—è¡¨å…è®¸<code class="function">new</code>å‡½æ•°å¯¹å…¶åˆ†é…çš„ç»“æž„æ‰§è¡Œç±»åž‹æ£€æŸ¥ã€‚å¯¹äºŽæ¯ä¸ªç»“æž„ ï¼Œ
        <em class="replaceable"><code>S</code></em>è¯¥<code class="function">defstruct</code>å‡½æ•°å®šä¹‰ä¸€ç»„å˜é‡ï¼š</p><p>The variable <code class="literal">all_structs</code> is a
        list of all known structures defined with <code class="function">defstruct</code>. This list allows the <code class="function">new</code> function to perform type checking on
        the structures it allocates. For each structure,
        <em class="replaceable"><code>S</code></em>, the <code class="function">defstruct</code> function defines a set of
        variables:</p><a id="OEBPS/apb.html.I__tt560"></a><pre class="programlisting"><em class="replaceable"><code>S</code></em>_def_slotnames
 <em class="replaceable"><code>S</code></em>_def_ <sub>n</sub> _default<em class="replaceable"><code>slot</code></em>
               <sub></sub></pre><pre class="programlisting"><em class="replaceable"><code>S</code></em>_def_slotnames
<em class="replaceable"><code>S</code></em>_def_<em class="replaceable"><code>slot</code></em>
               <sub>n</sub>_default</pre><p>ç¬¬ä¸€ä¸ªå˜é‡å®šä¹‰ç»“æž„çš„æ§½é›†ã€‚å…¶ä»–å˜é‡å®šä¹‰æ¯ä¸ªæ’æ§½çš„é»˜è®¤å€¼ã€‚è¯¥å‡½æ•°çš„å‰ä¸¤è¡Œåˆ†åˆ«<code class="function">defstruct</code>é™„åŠ åˆ°<code class="literal">all_structs</code>æ§½åç§°åˆ—è¡¨å¹¶åˆå§‹åŒ–æ§½åç§°åˆ—è¡¨ã€‚è¯¥å‡½æ•°çš„å…¶ä½™éƒ¨åˆ†è¿­ä»£æ§½ï¼Œæž„å»ºæ§½åˆ—è¡¨å¹¶ä¿å­˜é»˜è®¤å€¼ã€‚</p><p>The first variable defines the set of slots for a structure. The
        other variables define the default value for each slot. The first two
        lines of the <code class="function">defstruct</code> function
        append to <code class="literal">all_structs</code> and
        initialize the slot names list, respectively. The remainder of the
        function iterates through the slots, building the slot list and saving
        the default value.</p><p>æ¯ä¸ªæ§½çš„å®šä¹‰æ˜¯<a id="OEBPS/apb.html.make3-APP-B-ITERM-1628" class="indexterm"></a> <a id="OEBPS/apb.html.make3-APP-B-ITERM-1629" class="indexterm"></a>ç”± å¤„ç†<code class="function">defslot</code>ã€‚è¯¥å‡½æ•°åˆ†é…ä¸€ä¸ª idï¼Œå°†æ’æ§½åç§°å’Œå€¼ä¿å­˜åœ¨ä¸¤ä¸ªå˜é‡ä¸­ï¼Œå¹¶è¿”å›žå‰ç¼€ã€‚è¿”å›žå‰ç¼€å…è®¸ çš„å‚æ•°åˆ—è¡¨<code class="function">defstruct</code>æˆä¸ºä¸€ä¸ªç®€å•çš„ç¬¦å·åˆ—è¡¨ï¼Œæ¯ä¸ªç¬¦å·éƒ½æä¾›å¯¹æ§½å®šä¹‰çš„è®¿é—®ã€‚å¦‚æžœç¨åŽå°†æ›´å¤šå±žæ€§æ·»åŠ åˆ°æ’æ§½ä¸­ï¼Œå°†å®ƒä»¬åˆå¹¶åˆ°å…¶ä¸­<code class="function">defslot</code>å°±å¾ˆç®€å•ã€‚ä¸Žæ›´ç®€å•çš„æ›¿ä»£å®žçŽ°ç›¸æ¯”ï¼Œè¯¥æŠ€æœ¯è¿˜å…è®¸é»˜è®¤å€¼å…·æœ‰æ›´å¹¿æ³›çš„å€¼èŒƒå›´ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰ã€‚</p><p>Each slot definition is <a class="indexterm"></a> <a class="indexterm"></a>handled by <code class="function">defslot</code>.
        The function allocates an id, saves the slot name and value in two
        variables, and returns the prefix. Returning the prefix allows the
        argument list of <code class="function">defstruct</code> to be
        a simple list of symbols, each of which provides access to a slot
        definition. If more attributes are added to slots later, incorporating
        them into <code class="function">defslot</code> is
        straightforward. This technique also allows default values to have a
        wider range of values (including spaces) than simpler, alternative
        implementations.</p><p>å¾ªçŽ¯<code class="function">foreach</code>ä¸­
        <code class="function">defstruct</code> <a id="OEBPS/apb.html.make3-APP-B-ITERM-1630" class="indexterm"></a> <a id="OEBPS/apb.html.make3-APP-B-ITERM-1631" class="indexterm"></a>ç¡®å®šå…è®¸çš„æœ€å¤§æ’æ§½æ•°ã€‚æ­¤ç‰ˆæœ¬å…è®¸ 10 ä¸ªæ’æ§½ã€‚ä¸»ä½“<code class="function">foreach</code>é€šè¿‡å°†æ§½åç§°é™„åŠ åˆ°å˜é‡å¹¶å°†é»˜è®¤å€¼åˆ†é…ç»™å˜é‡æ¥å¤„ç†æ¯ä¸ªå‚æ•°ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„ç»“æž„å°†å®šä¹‰ï¼š<em class="replaceable"><code>S</code></em> <code class="literal">_def_slotnames</code><code class="function">file-info</code></p><p>The <code class="function">foreach</code> loop in
        <code class="function">defstruct</code> <a class="indexterm"></a> <a class="indexterm"></a>determines the maximum number of allowable slots. This
        version allows for 10 slots. The body of the <code class="function">foreach</code> processes each argument by
        appending the slot name to <em class="replaceable"><code>S</code></em> <code class="literal">_def_slotnames</code> and assigning the default
        value to a variable. For example, our <code class="function">file-info</code> structure would define:</p><a id="OEBPS/apb.html.I__tt561"></a><pre class="programlisting">file-info_def_slotnames := è·¯å¾„ç±»åž‹ä¸»æœº
æ–‡ä»¶ä¿¡æ¯_def_è·¯å¾„_é»˜è®¤:=
æ–‡ä»¶ä¿¡æ¯_def_type_default := unix
file-info_def_host_default := oscar</pre><pre class="programlisting">file-info_def_slotnames := path type host
file-info_def_path_default :=
file-info_def_type_default := unix
file-info_def_host_default := oscar</pre><p>è¿™æ ·å°±å®Œæˆäº†ç»“æž„ä½“çš„å®šä¹‰ã€‚</p><p>This completes the definition of a structure.</p><p>çŽ°åœ¨æˆ‘ä»¬å¯ä»¥å®šä¹‰ç»“æž„äº†ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿå®žä¾‹åŒ–ä¸€ä¸ªç»“æž„ã€‚è¯¥<code class="function">new</code>å‡½æ•°æ‰§è¡Œæ­¤æ“ä½œï¼š</p><p>Now that we can define structures, we need to be able to
        instantiate one. The <code class="function">new</code> function
        performs this operation:</p><a id="OEBPS/apb.html.I__tt562"></a><pre class="programlisting"># $(è°ƒç”¨æ–°çš„, struct_name)
å®šä¹‰æ–°çš„
$(æ¡\
  $(å¦‚æžœ$(è¿‡æ»¤å™¨$1,$(all_structs)),, \
    $(æœªçŸ¥ç»“æž„'$(strip $1)'ä¸Šå‡ºçŽ°æ–°é”™è¯¯)) \
  $(eval å®žä¾‹ := $1@$(next-id)) \
  $(eval all_instances += $(å®žä¾‹)) \
  $(foreach v, $($(strip $1)_def_slotnames), \
    $(eval $(instance)_$v := $($(strip $1)_def_$v_default))) \
  $(å®žä¾‹))
æ©å¾·å¤«</pre><pre class="programlisting"># $(call new, struct_name)
define new
$(strip                                                         \
  $(if $(filter $1,$(all_structs)),,                            \
    $(error new on unknown struct '$(strip $1)'))               \
  $(eval instance := $1@$(next-id))                             \
  $(eval all_instances += $(instance))                          \
  $(foreach v, $($(strip $1)_def_slotnames),                    \
    $(eval $(instance)_$v := $($(strip $1)_def_$v_default)))    \
  $(instance))
endef</pre><p>å‡½æ•°ä¸­çš„ç¬¬ä¸€ä¸ª<code class="function">if</code>æ£€æŸ¥åç§°æ˜¯å¦å¼•ç”¨å·²çŸ¥ç»“æž„ã€‚å¦‚æžœåœ¨ ä¸­æ‰¾ä¸åˆ°è¯¥ç»“æž„<code class="literal">all_structs</code>ï¼Œåˆ™ä¼šå‘å‡ºé”™è¯¯ä¿¡å·ã€‚æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡å°†ç»“æž„åç§°ä¸Žå”¯ä¸€çš„æ•´æ•°åŽç¼€è¿žæŽ¥èµ·æ¥ï¼Œä¸ºæ–°å®žä¾‹æž„é€ ä¸€ä¸ªå”¯ä¸€çš„ idã€‚æˆ‘ä»¬ä½¿ç”¨ at ç¬¦å·å°†ç»“æž„åç§°ä¸ŽåŽç¼€åˆ†å¼€ï¼Œä»¥ä¾¿ç¨åŽå¯ä»¥è½»æ¾åœ°å°†ä¸¤è€…åˆ†å¼€ã€‚ç„¶åŽï¼Œè¯¥<code class="function">new</code>å‡½æ•°è®°å½•æ–°çš„å®žä¾‹åç§°ï¼Œä»¥ä¾¿ç¨åŽè®¿é—®å™¨è¿›è¡Œç±»åž‹æ£€æŸ¥ã€‚ç„¶åŽä½¿ç”¨é»˜è®¤å€¼åˆå§‹åŒ–ç»“æž„ä½“çš„æ§½ã€‚åˆå§‹åŒ–ä»£ç å¾ˆæœ‰è¶£ï¼š</p><p>The first <code class="function">if</code> in the
        function checks that the name refers to a known structure. If the
        structure isn't found in <code class="literal">all_structs</code>, an error is signaled. Next, we
        construct a unique id for the new instance by concatenating the
        structure name with a unique integer suffix. We use an at sign to
        separate the structure name from the suffix so we can easily separate
        the two later. The <code class="function">new</code> function
        then records the new instance name for type checking by accessors
        later. Then the slots of the structure are initialized with their
        default values. The initialization code is interesting:</p><a id="OEBPS/apb.html.I__tt563"></a><pre class="programlisting">$(foreach v, $($(strip $1)_def_slotnames), \
  $(eval $(instance)_$v := $($(strip $1)_def_$v_default)))</pre><pre class="programlisting">$(foreach v, $($(strip $1)_def_slotnames),                \
  $(eval $(instance)_$v := $($(strip $1)_def_$v_default)))</pre><p>è¯¥<code class="function">foreach</code>å¾ªçŽ¯è¿­ä»£ç»“æž„çš„æ§½åç§°ã€‚åœ¨ç»“æž„åç§°ä¸Šä½¿ç”¨<code class="function">strip</code>around å…è®¸ç”¨æˆ·åœ¨<code class="function">call</code>toä¸­çš„é€—å·åŽé¢æ·»åŠ ç©ºæ ¼<code class="function">new</code>ã€‚å›žæƒ³ä¸€ä¸‹ï¼Œæ¯ä¸ªæ§½éƒ½æ˜¯é€šè¿‡è¿žæŽ¥å®žä¾‹åç§°å’Œæ§½åç§°æ¥è¡¨ç¤ºçš„ï¼ˆä¾‹å¦‚ï¼Œ
         <code class="literal">file_info@1_path</code>ï¼‰ã€‚å³ä¾§æ˜¯æ ¹æ®ç»“æž„åç§°å’Œæ§½åç§°è®¡ç®—çš„é»˜è®¤å€¼ã€‚æœ€åŽï¼Œå‡½æ•°è¿”å›žå®žä¾‹åç§°ã€‚</p><p>The <code class="function">foreach</code> loop iterates
        over the slot names of the structure. Using <code class="function">strip</code> around on the structure name allows
        the user to add spaces after commas in the <code class="function">call</code> to <code class="function">new</code>. Recall that each slot is represented
        by concatenating the instance name and the slot name (for instance,
        <code class="literal">file_info@1_path</code>). The righthand
        side is the default value computed from the structure name and slot
        name. Finally, the instance name is returned by the function.</p><p>è¯·æ³¨æ„ï¼Œæˆ‘å°†è¿™äº›æž„é€ å‡½æ•°ç§°ä¸ºå‡½æ•°ï¼Œä½†å®ƒä»¬å®žé™…ä¸Šæ˜¯å®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥ç¬¦å·<code class="function">new</code>è¢«é€’å½’æ‰©å±•ä»¥äº§ç”Ÿä¸€æ®µæ–°çš„æ–‡æœ¬ï¼Œè¯¥æ–‡æœ¬è¢«æ’å…¥åˆ°<em class="filename">makefile</em>ä¸­è¿›è¡Œé‡æ–°åˆ†æžã€‚å®æ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„æ“ä½œçš„åŽŸå› 
        <code class="function">defstruct</code>æ˜¯å› ä¸ºæ‰€æœ‰å·¥ä½œæœ€ç»ˆéƒ½åµŒå…¥åˆ°<code class="function">eval</code>è°ƒç”¨ä¸­ï¼Œè€Œè°ƒç”¨åˆ™å´©æºƒä¸ºç©ºã€‚åŒæ ·ï¼Œ<code class="function">new</code>å®åœ¨è°ƒç”¨ä¸­æ‰§è¡Œå…¶é‡è¦å·¥ä½œ<code class="function">eval</code>
        ã€‚å®ƒå¯ä»¥åˆç†åœ°ç§°ä¸ºå‡½æ•°ï¼Œå› ä¸ºå®çš„æ‰©å±•åœ¨æ¦‚å¿µä¸Šäº§ç”Ÿå•ä¸ªå€¼ï¼Œå³ä»£è¡¨æ–°å®žä¾‹çš„ç¬¦å·ã€‚</p><p>Note that I call these constructs functions, but they are
        actually macros. That is, the symbol <code class="function">new</code> is recursively expanded to yield a new
        piece of text that is inserted into the <em class="filename">makefile</em> for reparsing. The reason the
        <code class="function">defstruct</code> macro does what we want
        is because all the work is eventually embedded within <code class="function">eval</code> calls, which collapse to nothing.
        Similarly, the <code class="function">new</code> macro performs
        its significant work within <code class="function">eval</code>
        calls. It can reasonably be termed a function, because the expansion
        of the macro conceptually yields a single value, the symbol
        representing the new instance.</p><p>æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿåœ¨ç»“æž„ä¸­èŽ·å–å’Œè®¾ç½®å€¼ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæ–°å‡½æ•°ï¼š</p><p>Next, we need to be able to get and set values within our
        structures. To do this, we define two new functions:</p><a id="OEBPS/apb.html.I__tt564"></a><pre class="programlisting"># $(è°ƒç”¨èŽ·å–å€¼ã€instance_idã€slot_name)
å®šä¹‰èŽ·å–å€¼
$(æ¡\
  $(è°ƒç”¨æ£€æŸ¥å‚æ•°,$1,$2) \
  $($($(æ¡å¸¦$1))_$(æ¡å¸¦$2)))
æ©å¾·å¤«

# $(è°ƒç”¨è®¾ç½®å€¼ï¼Œinstance_idï¼Œslot_nameï¼Œå€¼)
å®šä¹‰è®¾å®šå€¼
  $(è°ƒç”¨æ£€æŸ¥å‚æ•°,$1,$2) \
  $(eval $($(æ¡å¸¦$1))_$(æ¡å¸¦$2) := $3)
æ©å¾·å¤«</pre><pre class="programlisting"># $(call get-value, instance_id, slot_name)
define get-value
$(strip                         \
  $(call check-params,$1,$2)    \
  $($($(strip $1))_$(strip $2)))
endef

# $(call set-value, instance_id, slot_name, value)
define set-value
  $(call check-params,$1,$2) \
  $(eval $($(strip $1))_$(strip $2) := $3)
endef</pre><p>è¦èŽ·å–æ’æ§½çš„å€¼ï¼Œæˆ‘ä»¬åªéœ€æ ¹æ®å®žä¾‹ ID å’Œæ’æ§½åç§°è®¡ç®—æ’æ§½å˜é‡åç§°å³å¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é¦–å…ˆä½¿ç”¨è¯¥å‡½æ•°æ£€æŸ¥å®žä¾‹å’Œæ§½åç§°æ˜¯å¦ä¸ºæœ‰æ•ˆå­—ç¬¦ä¸²æ¥æé«˜å®‰å…¨æ€§<code class="function">check-params</code>
        ã€‚ä¸ºäº†å…è®¸æ›´ç¾Žè§‚çš„æ ¼å¼å¹¶ç¡®ä¿æ— å…³çš„ç©ºé—´ä¸ä¼šç ´åæ§½å€¼ï¼Œæˆ‘ä»¬å°†å¤§éƒ¨åˆ†å‚æ•°åŒ…è£…åœ¨<code class="function">strip</code>è°ƒç”¨ä¸­ã€‚</p><p>To get the value of a slot, we simply need to compute the slot
        variable name from the instance id and the slot name. We can improve
        safety by first checking that the instance and slot name are valid
        strings with the <code class="function">check-params</code>
        function. To allow more aesthetic formating and to ensure that
        extraneous spaces do not corrupt the slot value, we wrap most of these
        parameters in <code class="function">strip</code> calls.</p><p>è®¾ç½®å‡½æ•°è¿˜åœ¨è®¾ç½®å€¼ä¹‹å‰æ£€æŸ¥å‚æ•°ã€‚æˆ‘ä»¬å†æ¬¡åˆ é™¤ä¸¤ä¸ªå‡½æ•°å‚æ•°ï¼Œä»¥å…è®¸ç”¨æˆ·è‡ªç”±åœ°åœ¨å‚æ•°åˆ—è¡¨ä¸­æ·»åŠ ç©ºæ ¼ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä¸ä¼šåˆ é™¤æ§½å€¼ï¼Œå› ä¸ºç”¨æˆ·å¯èƒ½å®žé™…ä¸Šéœ€è¦ç©ºæ ¼ã€‚</p><p>The set function also checks parameters before setting the
        value. Again, we strip the two function arguments to allow users the
        freedom to add spaces in the argument list. Note that we do not strip
        the slot value, because the user might actually need the
        spaces.</p><a id="OEBPS/apb.html.I__tt565"></a><pre class="programlisting"># $(è°ƒç”¨æ£€æŸ¥å‚æ•°ã€instance_idã€slot_name)
å®šä¹‰æ£€æŸ¥å‚æ•°
  $(if $(è¿‡æ»¤å™¨$($(strip $1)),$(all_instances)),, \
    $(é”™è¯¯æ— æ•ˆå®žä¾‹'$(strip $1)')) \
  $(if $(filter $2,$($(call struct-name,$1)_def_slotnames)),, \
    $(é”™è¯¯å®žä¾‹'$($(strip $1))'æ²¡æœ‰æ’æ§½'$(strip $2)'))
æ©å¾·å¤«

# $(è°ƒç”¨ç»“æž„ä½“åç§°ï¼Œinstance_id)
å®šä¹‰ç»“æž„ä½“åç§°
$(ç¬¬ä¸€ä¸ªå­— $(subst @, ,$($(strip $1))))
æ©å¾·å¤«</pre><pre class="programlisting"># $(call check-params, instance_id, slot_name)
define check-params
  $(if $(filter $($(strip $1)),$(all_instances)),,              \
    $(error Invalid instance '$(strip $1)'))                    \
  $(if $(filter $2,$($(call struct-name,$1)_def_slotnames)),,   \
    $(error Instance '$($(strip $1))' does not have slot '$(strip $2)'))
endef

# $(call struct-name, instance_id)
define struct-name
$(firstword $(subst @, ,$($(strip $1))))
endef</pre><p>è¯¥<code class="function">check-params</code>å‡½æ•°åªæ˜¯æ£€æŸ¥ä¼ é€’ç»™ setter å’Œ getter å‡½æ•°çš„å®žä¾‹ ID æ˜¯å¦åŒ…å«åœ¨å·²çŸ¥å®žä¾‹åˆ—è¡¨ä¸­ã€‚åŒæ ·ï¼Œå®ƒæ£€æŸ¥æ§½åç§°æ˜¯å¦åŒ…å«åœ¨å±žäºŽè¯¥ç»“æž„çš„æ§½åˆ—è¡¨ä¸­ã€‚ç»“æž„åç§°æ˜¯æ ¹æ®å®žä¾‹åç§°è®¡ç®—çš„ï¼Œæ–¹æ³•æ˜¯æ‹†åˆ† ä¸Šçš„ç¬¦å·<code class="literal">@</code>å¹¶å–ç¬¬ä¸€ä¸ªå•è¯ã€‚è¿™æ„å‘³ç€ç»“æž„åç§°ä¸èƒ½åŒ…å« at ç¬¦å·ã€‚</p><p>The <code class="function">check-params</code> function
        simply checks that the instance id passed to the setter and getter
        functions is contained within the known instances list. Likewise, it
        checks that the slot name is contained within the list of slots
        belonging to this structure. The structure name is computed from the
        instance name by splitting the symbol on the <code class="literal">@</code> and taking the first word. This means that
        structure names cannot contain an at sign.</p><p>ä¸ºäº†å®Œå–„å®žçŽ°ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€äº›æ‰“å°å’Œè°ƒè¯•åŠŸèƒ½ã€‚ä»¥ä¸‹æ‰“å°å‡½æ•°æ˜¾ç¤ºç»“æž„å®šä¹‰å’Œç»“æž„å®žä¾‹çš„ç®€å•ç”¨æˆ·å¯è¯»è¡¨ç¤ºï¼Œè€Œè½¬å‚¨å‡½æ•°æ˜¾ç¤ºä¸¤ä¸ªæž„é€ çš„å®žçŽ°ç»†èŠ‚ã€‚å…·ä½“å®žçŽ°è¯·å‚è§<a class="link" href="#OEBPS/apb.html.make3-APP-B-EX-1" title="ç¤ºä¾‹ B-1ã€‚ makeä¸­çš„ç»“æž„ä½“å®šä¹‰">ç¤ºä¾‹ B-1 ã€‚</a></p><p>To round out the implementation, we can add a couple of print
        and debugging functions. The following print function displays a
        simple user-readable representation of a structure definition and a
        structure instance, while the dump function displays the
        implementation details of the two constructs. See <a class="link" href="#OEBPS/apb.html.make3-APP-B-EX-1" title="Example&nbsp;B-1.&nbsp;Structure definition in make">Example B-1</a> for the
        implementations.</p><p>è¿™æ˜¯å®šä¹‰å’Œä½¿ç”¨æˆ‘ä»¬çš„ç»“æž„çš„ç¤ºä¾‹<code class="function">file-info</code>ï¼š</p><p>Here's an example defining and using our <code class="function">file-info</code> structure:</p><a id="OEBPS/apb.html.I__tt566"></a><pre class="programlisting">åŒ…æ‹¬ defstruct.mk

$(è°ƒç”¨ defstruct, æ–‡ä»¶ä¿¡æ¯, \
  $(è°ƒç”¨ defslot, è·¯å¾„,), \
  $(è°ƒç”¨ defslot, ç±»åž‹,unix), \
  $(call defslot, ä¸»æŒäºº,oscar))

before := $(è°ƒç”¨æ–°çš„ï¼Œæ–‡ä»¶ä¿¡æ¯)
$(è°ƒç”¨è®¾ç½®å€¼ã€ä¹‹å‰ã€è·¯å¾„ã€/etc/password)
$ï¼ˆè°ƒç”¨è®¾ç½®å€¼ï¼Œä¹‹å‰ï¼Œä¸»æœºï¼Œwasatchï¼‰

ä¹‹åŽï¼š= $(è°ƒç”¨æ–°çš„ï¼Œæ–‡ä»¶ä¿¡æ¯)
$(è°ƒç”¨è®¾ç½®å€¼ã€ä¹‹åŽã€è·¯å¾„ã€/etc/shadow)
$(è°ƒç”¨è®¾ç½®å€¼ï¼Œä¹‹åŽï¼Œä¸»æœºï¼Œwasatch)

æ¼”ç¤ºï¼š
        # ä¹‹å‰ = $(ä¹‹å‰)
        # before.path = $(è°ƒç”¨ get-value, before, path)
        # before.type = $(è°ƒç”¨ get-value, before, type)
        # before.host = $(è°ƒç”¨ get-value, before, host)
        # print before = $(è°ƒç”¨ print-instance, before)
        # dump before = $(è°ƒç”¨ dump-instance, before)
        #
        # æ‰€æœ‰å®žä¾‹ = $(æ‰€æœ‰å®žä¾‹)
        # all_structs = $(all_structs)
        # æ‰“å°æ–‡ä»¶ä¿¡æ¯ = $(è°ƒç”¨æ‰“å°ç»“æž„, æ–‡ä»¶ä¿¡æ¯)
        # è½¬å‚¨æ–‡ä»¶ä¿¡æ¯ = $(è°ƒç”¨è½¬å‚¨ç»“æž„, æ–‡ä»¶ä¿¡æ¯)</pre><pre class="programlisting">include defstruct.mk

$(call defstruct, file-info,    \
  $(call defslot, path,),       \
  $(call defslot, type,unix),   \
  $(call defslot, host,oscar))

before := $(call new, file-info)
$(call set-value, before, path,/etc/password)
$(call set-value, before, host,wasatch)

after := $(call new,file-info)
$(call set-value, after, path,/etc/shadow)
$(call set-value, after, host,wasatch)

demo:
        # before       = $(before)
        # before.path  = $(call get-value, before, path)
        # before.type  = $(call get-value, before, type)
        # before.host  = $(call get-value, before, host)
        # print before = $(call print-instance, before)
        # dump before  = $(call dump-instance, before)
        #
        # all_instances   = $(all_instances)
        # all_structs     = $(all_structs)
        # print file-info = $(call print-struct, file-info)
        # dump file-info  = $(call dump-struct, file-info)</pre><p>å’Œè¾“å‡ºï¼š</p><p>and the output:</p><a id="OEBPS/apb.html.I__tt567"></a><pre class="programlisting">$ åˆ¶ä½œ
# ä¹‹å‰ = æ–‡ä»¶ä¿¡æ¯@0
# before.path = /etc/password
# before.type = unix
# before.host = wasatch
# print before = { "/etc/password" "unix" "wasatch" }
# dump before = { { file-info@0_path "/etc/password" } { file-info@0_type "unix" }
{ file-info@0_host "wasatch" } }
#
# all_instances = æ–‡ä»¶ä¿¡æ¯@0 æ–‡ä»¶ä¿¡æ¯@1
# all_structs = æ–‡ä»¶ä¿¡æ¯
# print file-info = { { "path" "" } { "type" "unix" } { "host" "oscar" } }
# dump file-info = { file-info_def_slotnames " è·¯å¾„ç±»åž‹ä¸»æœº"
æ–‡ä»¶ä¿¡æ¯å®šä¹‰è·¯å¾„é»˜è®¤å€¼
 â€œâ€ file-info_def_type_default â€œunixâ€ file-info_def_host_default â€œoscarâ€ }</pre><pre class="programlisting">$ make
# before       = file-info@0
# before.path  = /etc/password
# before.type  = unix
# before.host  = wasatch
# print before = { "/etc/password" "unix" "wasatch" }
# dump before  = {  { file-info@0_path "/etc/password" } { file-info@0_type "unix" } 
{ file-info@0_host "wasatch" } }
#
# all_instances   =  file-info@0 file-info@1
# all_structs     =  file-info
# print file-info = { { "path" "" } { "type" "unix" } { "host" "oscar" } }
# dump file-info  = { file-info_def_slotnames " path type host" 
file-info_def_path_default
 "" file-info_def_type_default "unix" file-info_def_host_default "oscar" }</pre><p>å¦è¯·æ³¨æ„éžæ³•å»ºç­‘å¦‚ä½•ä½¿ç”¨<a id="OEBPS/apb.html.make3-APP-B-ITERM-1632" class="indexterm"></a>è¢«å›°ï¼š</p><p>Also note how illegal structure uses <a class="indexterm"></a>are trapped:</p><a id="OEBPS/apb.html.I__tt568"></a><pre class="programlisting">$ çŒ« badstruct.mk
åŒ…æ‹¬ defstruct.mk
$(è°ƒç”¨æ–°çš„ï¼Œæ²¡æœ‰è¿™æ ·çš„ç»“æž„)
$ make -f badstruct.mk
badstruct.mk:2: *** æœªçŸ¥ç»“æž„â€œæ— æ­¤ç±»ç»“æž„â€ä¸Šçš„æ–°å†…å®¹ã€‚åœæ­¢ã€‚

$ çŒ« badslot.mk
åŒ…æ‹¬ defstruct.mk
$(è°ƒç”¨ defstruct, foo, defslot(size, 0))
é…’å§ := $(è°ƒç”¨æ–°çš„ï¼Œfoo)
$(è°ƒç”¨è®¾ç½®å€¼, bar, å¤§å°, 10)
$ make -f badslot.mk
badslot.mk:4: *** å®žä¾‹â€œfoo@0â€æ²¡æœ‰æ’æ§½â€œsizâ€ã€‚åœæ­¢ã€‚</pre><pre class="programlisting">$ cat badstruct.mk
include defstruct.mk
$(call new, no-such-structure)
$ make -f badstruct.mk
badstruct.mk:2: *** new on unknown struct 'no-such-structure'.  Stop.

$ cat badslot.mk
include defstruct.mk
$(call defstruct, foo, defslot(size, 0))
bar := $(call new, foo)
$(call set-value, bar, siz, 10)
$ make -f badslot.mk
badslot.mk:4: *** Instance 'foo@0' does not have slot 'siz'.  Stop.</pre><p>å½“ç„¶ï¼Œå¯ä»¥å¯¹ä»£ç è¿›è¡Œå¾ˆå¤šæ”¹è¿›ï¼Œä½†åŸºæœ¬æ€æƒ³æ˜¯åˆç†çš„ã€‚ä»¥ä¸‹æ˜¯å¯èƒ½çš„å¢žå¼ºåŠŸèƒ½çš„åˆ—è¡¨ï¼š</p><p>Of course, there are lots of improvements that can be made to
        the code, but the basic ideas are sound. Here is a list of possible
        enhancements:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>å‘æ§½åˆ†é…æ·»åŠ éªŒè¯æ£€æŸ¥ã€‚è¿™å¯ä»¥é€šè¿‡ä¸€ä¸ªé’©å­å‡½æ•°æ¥å®Œæˆï¼Œè¯¥å‡½æ•°åœ¨æ‰§è¡Œèµ‹å€¼åŽå¿…é¡»äº§ç”Ÿç©ºã€‚é’©å­å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š</p><a id="OEBPS/apb.html.I__tt569"></a><pre class="programlisting"># $(è°ƒç”¨è®¾ç½®å€¼ï¼Œinstance_idï¼Œslot_nameï¼Œå€¼)
å®šä¹‰è®¾å®šå€¼
  $(è°ƒç”¨æ£€æŸ¥å‚æ•°,$1,$2) \
  $(if $(call $(strip $1)_$(strip $2)_hook, value), \
    $(é”™è¯¯è®¾å®šå€¼æŒ‚é’©ï¼Œ$(strip $1)_$(strip $2)_hookï¼Œå¤±è´¥)) \
  $(eval $($(æ¡å¸¦$1))_$(æ¡å¸¦$2) := $3)
æ©å¾·å¤«</pre></li><li class="listitem"><p>Add a validation check to the slot assignment. This could be
            done with a hook function that must yield empty after the
            assignment has been performed. The hook could be used like
            this:</p><a></a><pre class="programlisting"># $(call set-value, instance_id, slot_name, value)
define set-value
  $(call check-params,$1,$2)                                       \
  $(if $(call $(strip $1)_$(strip $2)_hook, value),                \
    $(error set-value hook, $(strip $1)_$(strip $2)_hook, failed)) \
  $(eval $($(strip $1))_$(strip $2) := $3)
endef</pre></li><li class="listitem"><p>æ”¯æŒç»§æ‰¿ã€‚ A<code class="function">defstruct</code>å¯ä»¥æŽ¥å—å¦ä¸€ä¸ª
            <code class="function">defstruct</code>åç§°ä½œä¸ºè¶…ç±»ï¼Œä»Žè€Œåœ¨å­ç±»ä¸­å¤åˆ¶æ‰€æœ‰è¶…ç±»çš„æˆå‘˜ã€‚</p></li><li class="listitem"><p>Support for inheritance. A <code class="function">defstruct</code> could accept another
            <code class="function">defstruct</code> name as a
            superclass, duplicating all the superclass's members in the
            subclass.</p></li><li class="listitem"><p>æ›´å¥½åœ°æ”¯æŒç»“æž„å‚è€ƒã€‚åœ¨å½“å‰çš„å®žçŽ°ä¸­ï¼Œæ§½å¯ä»¥ä¿å­˜å¦ä¸€ä¸ªç»“æž„çš„ IDï¼Œä½†è®¿é—®å¾ˆå›°éš¾ã€‚å¯ä»¥ç¼–å†™è¯¥å‡½æ•°çš„æ–°ç‰ˆ<code class="function">get-value</code>æœ¬æ¥æ£€æŸ¥å¼•ç”¨ï¼ˆé€šè¿‡æŸ¥æ‰¾
            <em class="replaceable"><code>defstruct</code></em>@ <em class="replaceable"><code>number</code></em>ï¼‰ï¼Œå¹¶æ‰§è¡Œè‡ªåŠ¨å–æ¶ˆå¼•ç”¨ã€‚</p></li><li class="listitem"><p>Better support for structure references. With the current
            implementation, a slot can hold the ID of another structure, but
            accessing is awkward. A new version of the <code class="function">get-value</code> function could be written to
            check for references (by looking for
            <em class="replaceable"><code>defstruct</code></em>@<em class="replaceable"><code>number</code></em>),
            and perform automatic dereferencing.</p></li></ul></div></div></div></div></div>
<div id="OEBPS/apbs02.html"><div>
<div class="sect1" title="ç®—æœ¯"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/apbs02.html.make3-APP-B-SECT-2"></a>ç®—æœ¯</h1><h1 class="title"><a></a>Arithmetic</h1></div></div></div><p>åœ¨ä¹‹å‰çš„<a id="OEBPS/apbs02.html.make3-APP-B-ITERM-1633" class="indexterm"></a> <a id="OEBPS/apbs02.html.make3-APP-B-ITERM-1634" class="indexterm"></a>éƒ¨åˆ†ï¼Œæˆ‘æ³¨æ„åˆ°ä¸å¯èƒ½ä»…ä½¿ç”¨ make çš„æœ¬æœºåŠŸèƒ½åœ¨<em class="command">make</em>ä¸­æ‰§è¡Œç®—æœ¯è¿ç®—ã€‚ç„¶åŽï¼Œæˆ‘å±•ç¤ºäº†å¦‚ä½•é€šè¿‡å°†å•è¯é™„åŠ åˆ°åˆ—è¡¨å¹¶è¿”å›žåˆ—è¡¨çš„é•¿åº¦æ¥å®žçŽ°ä¸€ä¸ªç®€å•çš„è®¡æ•°å™¨ã€‚åœ¨æˆ‘å‘çŽ°å¢žé‡æŠ€å·§åŽä¸ä¹…ï¼ŒMichael Mounteney å‘å¸ƒäº†ä¸€ä¸ªå¾ˆé…·çš„æŠ€å·§ï¼Œç”¨äºŽåœ¨<em class="command">make</em>ä¸­å¯¹æ•´æ•°æ‰§è¡Œæœ‰é™å½¢å¼çš„åŠ æ³•ã€‚</p><p>In the previous <a class="indexterm"></a> <a class="indexterm"></a>section, I noted that it is not possible to perform
        arithmetic in <em class="command">make</em> using only its
        native features. I then showed how you could implement a simple
        counter by appending words to a list and returning the length of the
        list. Soon after I discovered the increment trick, Michael Mounteney
        posted a cool trick for performing a limited form of addition on
        integers in <em class="command">make</em>.</p><p>ä»–çš„æŠ€å·§æ“çºµæ•°è½´æ¥è®¡ç®—ä¸¤ä¸ªå¤§å°ä¸º 1 æˆ–æ›´å¤§çš„æ•´æ•°çš„å’Œã€‚è¦äº†è§£å…¶å·¥ä½œåŽŸç†ï¼Œè¯·æƒ³è±¡æ•°è½´ï¼š</p><p>His trick manipulates the number line to compute the sum of two
        integers of size one or greater. To see how this works, imagine the
        number line:</p><a id="OEBPS/apbs02.html.I__tt570"></a><pre class="programlisting">2 3 4 5 6 7 8 9 10 11 12 13 14 15</pre><pre class="programlisting">2 3 4 5 6 7 8 9 10 11 12 13 14 15</pre><p>çŽ°åœ¨ï¼Œè¯·æ³¨æ„ï¼ˆå¦‚æžœæˆ‘ä»¬èƒ½å¤ŸèŽ·å¾—æ­£ç¡®çš„ä¸‹æ ‡ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é¦–å…ˆèŽ·å–ä»Žç¬¬å››ä¸ªå…ƒç´ åˆ°æœ«å°¾çš„è¡Œçš„å­é›†ï¼Œç„¶åŽé€‰æ‹©å­é›†çš„ç¬¬äº”ä¸ªå…ƒç´ æ¥æ·»åŠ ï¼Œä¾‹å¦‚ 4 åŠ  5ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ¬æœº<em class="command">make</em>å‡½æ•°æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼š</p><p>Now, notice that (if we could get the subscripts right), we
        could add, say 4 plus 5, by first taking a subset of the line from the
        fourth element to the end then selecting the fifth element of the
        subset. We can do this with native <em class="command">make</em> functions:</p><a id="OEBPS/apbs02.html.I__tt571"></a><pre class="programlisting">è¡Œå· = 2 3 4 5 6 7 8 9 10 11 12 13 14 15
åŠ  = $(å•è¯ $2, $(å•è¯åˆ—è¡¨ $1, 15, $(number_line)))
å››+äº” = $(è°ƒç”¨åŠ , 4, 5)</pre><pre class="programlisting">number_line = 2 3 4 5 6 7 8 9 10 11 12 13 14 15
plus = $(word $2, $(wordlist $1, 15, $(number_line)))
four+five = $(call plus, 4, 5)</pre><p>éžå¸¸èªæ˜Žï¼Œè¿ˆå…‹å°”ï¼è¯·æ³¨æ„ï¼Œæ•°è½´ä»¥ 2 å¼€å¤´ï¼Œè€Œä¸æ˜¯ 0 æˆ– 1ã€‚æ‚¨å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æžœæ‚¨
        <code class="function">plus</code>ä½¿ç”¨ 1 å’Œ 1 è¿è¡Œè¯¥å‡½æ•°ï¼Œè¿™æ˜¯å¿…éœ€çš„ã€‚ä¸¤ä¸ªä¸‹æ ‡éƒ½å°†äº§ç”Ÿç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”ç­”æ¡ˆå¿…é¡»æ˜¯ 2ï¼Œå› æ­¤ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ åˆ—è¡¨çš„ å¿…é¡»æ˜¯ 2ã€‚è¿™æ ·åšçš„åŽŸå› æ˜¯ï¼Œå¯¹äºŽ<code class="function">word</code>å’Œ
        <code class="function">wordlist</code>å‡½æ•°ï¼Œåˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä¸‹æ ‡æ˜¯ 1 è€Œä¸æ˜¯ï¼ˆä½†æˆ‘æ²¡æœ‰è´¹å¿ƒåŽ»è¯æ˜Žå®ƒï¼‰ã€‚</p><p>Very clever, Michael! Notice that the number line starts with 2
        rather than 0 or 1. You can see that this is necessary if you run the
        <code class="function">plus</code> function with 1 and 1. Both
        subscripts will yield the first element and the answer must be 2,
        therefore, the first element of the list must be 2. The reason for
        this is that, for the <code class="function">word</code> and
        <code class="function">wordlist</code> functions, the first
        element of the list has subscript 1 rather than (but I haven't
        bothered to prove it).</p><p>çŽ°åœ¨ï¼Œç»™å®šä¸€æ¡æ•°è½´ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡ŒåŠ æ³•ï¼Œä½†æ˜¯å¦‚ä½•åœ¨<em class="command">make</em>ä¸­åˆ›å»ºä¸€æ¡æ•°è½´
        ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨è¾“å…¥æˆ–ä½¿ç”¨ shell ç¨‹åºå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†åä½ä¸­æ‰€æœ‰å¯èƒ½çš„å€¼ä¸Žä¸ªä½ä¸­æ‰€æœ‰å¯èƒ½çš„å€¼ç»„åˆæ¥åˆ›å»º 00 åˆ° 99 ä¹‹é—´çš„æ‰€æœ‰æ•°å­—ã€‚ä¾‹å¦‚ï¼š</p><p>Now, given a number line, we can perform addition, but how do we
        create a number line in <em class="command">make</em>
        without typing it in by hand or using a shell program? We can create
        all numbers between 00 and 99 by combining all possible values in the
        tens place with all possible values in the ones place. For
        example:</p><a id="OEBPS/apbs02.html.I__tt572"></a><pre class="programlisting">make -f - &lt;&lt;&lt; '$(è­¦å‘Š $(foreach i, 0 1 2, $(addprefix $i, 0 1 2)))'
/c/TEMP/Gm002568:1: 00 01 02 10 11 12 20 21 22</pre><pre class="programlisting">make -f - &lt;&lt;&lt; '$(warning $(foreach i, 0 1 2, $(addprefix $i, 0 1 2)))'
/c/TEMP/Gm002568:1:  00 01 02  10 11 12  20 21 22</pre><p>é€šè¿‡åŒ…å« 0 åˆ° 9 çš„æ‰€æœ‰æ•°å­—ï¼Œæˆ‘ä»¬å°†ç”Ÿæˆä»Ž 00 åˆ° 99 çš„æ‰€æœ‰æ•°å­—ã€‚é€šè¿‡å°† back<code class="literal">foreach</code>ä¸Žç™¾ä½åˆ—ç»„åˆï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä»Ž 000 åˆ° 999 çš„æ•°å­—ï¼Œç­‰ç­‰ã€‚å‰©ä¸‹çš„å°±æ˜¯åŽ»æŽ‰å‰å¯¼é›¶ï¼Œå…¶ä¸­å¿…è¦çš„ã€‚</p><p>By including all digits 0 through 9, we would produce all
        numbers from 00 to 99. By combining the <code class="literal">foreach</code> again with a hundreds column, we
        would get the numbers from 000 to 999, etc. All that is left is to
        strip the leading zeros where necessary.</p><p>ä»¥ä¸‹æ˜¯ Mounteney å…ˆç”Ÿçš„ä»£ç çš„ä¿®æ”¹å½¢å¼ï¼Œç”¨äºŽç”Ÿæˆæ•°è½´å¹¶å®šä¹‰<code class="function">plus</code>
        å’Œ<code class="function">gt</code>è¿ç®—ï¼š</p><p>Here is a modified form of Mr. Mounteney's code to generate a
        number line and define the <code class="function">plus</code>
        and <code class="function">gt</code> operations:</p><a id="OEBPS/apbs02.html.I__tt573"></a><pre class="programlisting"># ç»„åˆ - å°†ä¸€ä¸ªæ•°å­—åºåˆ—ä¸Žå¦ä¸€ä¸ªæ•°å­—åºåˆ—è¿žæŽ¥èµ·æ¥
ç»„åˆ = $(foreach i, $1, $(addprefix $i, $2))

# stripzero - ä»Žæ¯ä¸ªå•è¯ä¸­åˆ é™¤ä¸€ä¸ªå‰å¯¼é›¶
stripzero = $(patsubst 0%,%,$1)

#generate - ç”Ÿæˆå•è¯åˆ—è¡¨ä¸­ä¸‰ä¸ªå…ƒç´ çš„æ‰€æœ‰æŽ’åˆ—
ç”Ÿæˆ = $(è°ƒç”¨ stripzero, \
             $(è°ƒç”¨ stripzero, \
               $(è°ƒç”¨ç»„åˆï¼Œ$1ï¼Œ\
                 $(è°ƒç”¨ç»„åˆ, $1, $1))))

# number_line - åˆ›å»ºä»Ž 0 åˆ° 999 çš„æ•°è½´
number_line := $(è°ƒç”¨ç”Ÿæˆ,0 1 2 3 4 5 6 7 8 9)
é•¿åº¦ := $(å•è¯ $(å•è¯ $(number_line)), $(number_line))

# plus - ä½¿ç”¨æ•°è½´å°†ä¸¤ä¸ªæ•´æ•°ç›¸åŠ 
åŠ  = $(å•è¯ $2, \
         $(å•è¯åˆ—è¡¨$1,$(é•¿åº¦),\
           $(å•è¯åˆ—è¡¨ 3, $(é•¿åº¦), $(number_line))))

# gt - ä½¿ç”¨æ•°è½´ç¡®å®š $1 æ˜¯å¦å¤§äºŽ $2
gt = $(è¿‡æ»¤$1, \
       $(å•è¯åˆ—è¡¨ 3, $(é•¿åº¦), \
         $(å•è¯åˆ—è¡¨$2,$(é•¿åº¦),$(number_line))))


å…¨éƒ¨ï¼š
        @echo $(call plus,4,7)
        @echo $(if $(call gt,4,7),æ˜¯,ä¸æ˜¯)
        @echo $(if $(call gt,7,4),æ˜¯,ä¸æ˜¯)
        @echo $(if $(call gt,7,7),æ˜¯,ä¸æ˜¯)</pre><pre class="programlisting"># combine - concatentate one sequence of numbers with another
combine = $(foreach i, $1, $(addprefix $i, $2))

# stripzero - Remove one leading zero from each word
stripzero = $(patsubst 0%,%,$1)

# generate - Produce all permutations of three elements from the word list
generate = $(call stripzero,                            \
             $(call stripzero,                          \
               $(call combine, $1,                      \
                 $(call combine, $1, $1))))

# number_line - Create a number line from 0 to 999
number_line := $(call generate,0 1 2 3 4 5 6 7 8 9)
length      := $(word $(words $(number_line)), $(number_line))

# plus - Use the number line to add two integers
plus = $(word $2,                                       \
         $(wordlist $1, $(length),                      \
           $(wordlist 3, $(length), $(number_line))))

# gt - Use the number line to determine if $1 is greater than $2
gt = $(filter $1,                                       \
       $(wordlist 3, $(length),                         \
         $(wordlist $2, $(length), $(number_line))))


all:
        @echo $(call plus,4,7)
        @echo $(if $(call gt,4,7),is,is not)
        @echo $(if $(call gt,7,4),is,is not)
        @echo $(if $(call gt,7,7),is,is not)</pre><p>è¿è¡Œæ—¶ï¼Œ<em class="filename">makefile</em>
        ä¼šäº§ç”Ÿï¼š</p><p>When run, the <em class="filename">makefile</em>
        yields:</p><a id="OEBPS/apbs02.html.I__tt574"></a><pre class="programlisting">$ åˆ¶ä½œ
11
ä¸æ˜¯
æ˜¯
ä¸æ˜¯</pre><pre class="programlisting">$ make
11
is not
is
is not</pre><p>æˆ‘ä»¬å¯ä»¥æ‰©å±•æ­¤ä»£ç ä»¥åŒ…æ‹¬å‡æ³•ï¼Œæ³¨æ„ä¸‹æ ‡åå‘åˆ—è¡¨å°±åƒå‘åŽè®¡æ•°ä¸€æ ·ã€‚ä¾‹å¦‚ï¼Œè¦è®¡ç®— 7 å‡ 4ï¼Œé¦–å…ˆåˆ›å»ºæ•°è½´å­é›† 0 åˆ° 6ï¼Œå°†å…¶åè½¬ï¼Œç„¶åŽé€‰æ‹©ç¬¬å››ä¸ªå…ƒç´ ï¼š</p><p>We can extend this code to include subtraction by noting that
        subscripting a reversed list is just like counting backwards. For
        example, to compute 7 minus 4, first create the number line subset 0
        to 6, reverse it, then select the fourth element:</p><a id="OEBPS/apbs02.html.I__tt575"></a><pre class="programlisting">è¡Œå· := 0 1 2 3 4 5 6 7 8 9...
1åˆ°6 := 0 1 2 3 4 5 6
åå‘ï¼š= 6 5 4 3 2 1 0
ç¬¬å››é¡¹ := 3</pre><pre class="programlisting">number_line := 0 1 2 3 4 5 6 7 8 9...
1through6   := 0 1 2 3 4 5 6
reverse_it  := 6 5 4 3 2 1 0
fourth_item := 3</pre><p><em class="command">make</em>è¯­æ³•ä¸­çš„ç®—æ³•å¦‚ä¸‹
        ï¼š</p><p>Here is the algorithm in <em class="command">make</em>
        syntax:</p><a id="OEBPS/apbs02.html.I__tt576"></a><pre class="programlisting"># å‘åŽ - é€†æ•°è½´
å‘åŽ := $(è°ƒç”¨ç”Ÿæˆ, 9 8 7 6 5 4 3 2 1 0)

# åå‘ - åè½¬å•è¯åˆ—è¡¨
åå‘= $(æ¡\
               $(foreach f, \
                 $(å•è¯åˆ—è¡¨ 1, $(é•¿åº¦), $(å‘åŽ)), \
                 $(å•è¯$f, $1)))

# minus - è®¡ç®— $1 å‡åŽ» $2
å‡ = $(å•è¯ $2, \
               $(è°ƒç”¨åå‘ï¼Œ\
                 $(å•è¯åˆ—è¡¨ 1, $1, $(number_line))))

å‡ï¼š
        # $(è°ƒç”¨å‡å·, 7, 4)</pre><pre class="programlisting"># backwards - a reverse number line
backwards := $(call generate, 9 8 7 6 5 4 3 2 1 0)

# reverse - reverse a list of words
reverse    = $(strip                                     \
               $(foreach f,                              \
                 $(wordlist 1, $(length), $(backwards)), \
                 $(word $f, $1)))

# minus - compute $1 minus $2
minus      = $(word $2,                                \
               $(call reverse,                         \
                 $(wordlist 1, $1, $(number_line))))

minus:
        # $(call minus, 7, 4)</pre><p>ä¹˜æ³•å’Œé™¤æ³•ç•™ç»™è¯»è€…ä½œä¸ºç»ƒä¹ ã€‚</p><p>Multiplication and division are left as an exercise for the
        reader.</p></div></div></div>
<div id="OEBPS/apc.html"><div>
<div class="appendix" title="é™„å½• C. GNU è‡ªç”±æ–‡æ¡£è®¸å¯è¯ â€” GNU é¡¹ç›® â€” è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼š (FSF)"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/apc.html.make3-APP-C"></a>é™„å½• C. GNU è‡ªç”±æ–‡æ¡£è®¸å¯è¯ â€” GNU é¡¹ç›® â€” è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼š (FSF)</h1><h1 class="title"><a></a>Appendix&nbsp;C.&nbsp;GNU Free Documentation Licenseâ€”GNU Projectâ€”Free Software
      Foundation (FSF)</h1></div></div></div><p>ç‰ˆæœ¬ 1.2ï¼Œ2002 å¹´ 11 æœˆ</p><p>Version 1.2, November 2002</p><table border="0" summary="Simple list" class="simplelist"><tbody><tr><td>ç‰ˆæƒæ‰€æœ‰ Â© 2000,2001,2002 è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼š, Inc.</td></tr><tr><td>59 Temple Place, Suite 330, æ³¢å£«é¡¿, MA 02111-1307 ç¾Žå›½</td></tr></tbody></table><p>ä»»ä½•äººéƒ½å¯ä»¥å¤åˆ¶å’Œåˆ†å‘<a id="OEBPS/apc.html.make3-APP-C-ITERM-1635" class="indexterm"></a>è¯¥è®¸å¯æ–‡æ¡£çš„é€å­—å‰¯æœ¬ï¼Œä½†ä¸å…è®¸æ›´æ”¹ã€‚</p><p>Everyone is permitted to copy and distribute <a class="indexterm"></a>verbatim copies of this license document, but changing it
      is not allowed.</p><div class="sect1" title="0. å‰è¨€"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/apc.html.make3-APP-C-SECT-1"></a>0. å‰è¨€</h1><h1 class="title"><a></a>0. PREAMBLE</h1></div></div></div><p>æœ¬è®¸å¯è¯çš„ç›®çš„æ˜¯ä½¿æ‰‹å†Œã€æ•™ç§‘ä¹¦æˆ–å…¶ä»–åŠŸèƒ½æ€§å’Œæœ‰ç”¨çš„æ–‡æ¡£åœ¨è‡ªç”±æ„ä¹‰ä¸Šâ€œå…è´¹â€ï¼šç¡®ä¿æ¯ä¸ªäººéƒ½å¯ä»¥æœ‰æ•ˆåœ°è‡ªç”±åœ°å¤åˆ¶å’Œé‡æ–°åˆ†å‘å®ƒï¼Œæ— è®ºæ˜¯å¦å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œæ— è®ºæ˜¯å•†ä¸šæ€§è¿˜æ˜¯éžå•†ä¸šæ€§ã€‚å…¶æ¬¡ï¼Œè¯¥è®¸å¯è¯ä¸ºä½œè€…å’Œå‡ºç‰ˆå•†ä¿ç•™äº†ä¸€ç§èŽ·å¾—å…¶ä½œå“è£èª‰çš„æ–¹å¼ï¼ŒåŒæ—¶ä¸è¢«è®¤ä¸ºå¯¹ä»–äººæ‰€åšçš„ä¿®æ”¹è´Ÿè´£ã€‚</p><p>The purpose of this License is to make a manual, textbook, or
        other functional and useful document "free" in the sense of freedom:
        to assure everyone the effective freedom to copy and redistribute it,
        with or without modifying it, either commercially or noncommercially.
        Secondarily, this License preserves for the author and publisher a way
        to get credit for their work, while not being considered responsible
        for modifications made by others.</p><p>è¯¥è®¸å¯è¯æ˜¯ä¸€ç§â€œcopyleftâ€ï¼Œè¿™æ„å‘³ç€è¯¥æ–‡æ¡£çš„è¡ç”Ÿä½œå“æœ¬èº«å¿…é¡»åœ¨ç›¸åŒæ„ä¹‰ä¸Šæ˜¯å…è´¹çš„ã€‚å®ƒè¡¥å……äº† GNU é€šç”¨å…¬å…±è®¸å¯è¯ï¼Œè¿™æ˜¯ä¸“ä¸ºè‡ªç”±è½¯ä»¶è®¾è®¡çš„ Copyleft è®¸å¯è¯ã€‚</p><p>This License is a kind of "copyleft", which means that
        derivative works of the document must themselves be free in the same
        sense. It complements the GNU General Public License, which is a
        copyleft license designed for free software.</p><p>æˆ‘ä»¬è®¾è®¡æ­¤è®¸å¯è¯æ˜¯ä¸ºäº†å°†å…¶ç”¨ä½œè‡ªç”±è½¯ä»¶çš„æ‰‹å†Œï¼Œå› ä¸ºè‡ªç”±è½¯ä»¶éœ€è¦è‡ªç”±æ–‡æ¡£ï¼šè‡ªç”±ç¨‹åºåº”è¯¥é™„å¸¦æä¾›ä¸Žè½¯ä»¶ç›¸åŒè‡ªç”±çš„æ‰‹å†Œã€‚ä½†æœ¬è®¸å¯ä¸é™äºŽè½¯ä»¶æ‰‹å†Œï¼›å®ƒå¯ç”¨äºŽä»»ä½•æ–‡æœ¬ä½œå“ï¼Œæ— è®ºä¸»é¢˜å¦‚ä½•æˆ–æ˜¯å¦ä»¥å°åˆ·ä¹¦ç±å½¢å¼å‡ºç‰ˆã€‚æˆ‘ä»¬ä¸»è¦æŽ¨èæ­¤è®¸å¯è¯ç”¨äºŽä»¥æŒ‡å¯¼æˆ–å‚è€ƒä¸ºç›®çš„çš„ä½œå“ã€‚</p><p>We have designed this License in order to use it for manuals for
        free software, because free software needs free documentation: a free
        program should come with manuals providing the same freedoms that the
        software does. But this License is not limited to software manuals; it
        can be used for any textual work, regardless of subject matter or
        whether it is published as a printed book. We recommend this License
        principally for works whose purpose is instruction or
        reference.</p></div></div></div></div>
<div id="OEBPS/apcs02.html"><div>
<div class="sect1" title="1. é€‚ç”¨èŒƒå›´å’Œå®šä¹‰"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/apcs02.html.make3-APP-C-SECT-2"></a>1. é€‚ç”¨èŒƒå›´å’Œå®šä¹‰</h1><h1 class="title"><a></a>1. APPLICABILITY AND DEFINITIONS</h1></div></div></div><p>æœ¬è®¸å¯è¯é€‚ç”¨äºŽä»»ä½•åª’ä»‹ä¸­çš„ä»»ä½•æ‰‹å†Œæˆ–å…¶ä»–ä½œå“ï¼Œå…¶ä¸­åŒ…å«ç‰ˆæƒæ‰€æœ‰è€…å‘å¸ƒçš„å£°æ˜Žï¼Œè¡¨æ˜Žå¯ä»¥æ ¹æ®æœ¬è®¸å¯è¯çš„æ¡æ¬¾è¿›è¡Œåˆ†å‘ã€‚æ­¤ç±»é€šçŸ¥æŽˆäºˆåœ¨å…¨çƒèŒƒå›´å†…ã€æ— æœŸé™ã€å…ç‰ˆç¨Žçš„è®¸å¯ï¼Œä»¥ä¾¿åœ¨æ­¤å¤„è§„å®šçš„æ¡ä»¶ä¸‹ä½¿ç”¨è¯¥ä½œå“ã€‚ä¸‹é¢çš„â€œæ–‡æ¡£â€æŒ‡ä»»ä½•æ­¤ç±»æ‰‹å†Œæˆ–ä½œå“ã€‚ä»»ä½•å…¬ä¼—æˆå‘˜éƒ½æ˜¯è¢«è®¸å¯äººï¼Œå¹¶è¢«ç§°ä¸ºâ€œæ‚¨â€ã€‚å¦‚æžœæ‚¨æŒ‰ç…§ç‰ˆæƒæ³•è¦æ±‚è®¸å¯çš„æ–¹å¼å¤åˆ¶ã€ä¿®æ”¹æˆ–åˆ†å‘è¯¥ä½œå“ï¼Œåˆ™è¡¨ç¤ºæ‚¨æŽ¥å—è¯¥è®¸å¯ã€‚</p><p>This License applies to any manual or other work, in any medium,
        that contains a notice placed by the copyright holder saying it can be
        distributed under the terms of this License. Such a notice grants a
        world-wide, royalty-free license, unlimited in duration, to use that
        work under the conditions stated herein. The "Document", below, refers
        to any such manual or work. Any member of the public is a licensee,
        and is addressed as "you". You accept the license if you copy, modify
        or distribute the work in a way requiring permission under copyright
        law.</p><p>æœ¬æ–‡æ¡£çš„â€œä¿®æ”¹ç‰ˆæœ¬â€æ˜¯æŒ‡åŒ…å«æœ¬æ–‡æ¡£æˆ–å…¶ä¸€éƒ¨åˆ†çš„ä»»ä½•ä½œå“ï¼Œæ— è®ºæ˜¯é€å­—å¤åˆ¶è¿˜æ˜¯ç»è¿‡ä¿®æ”¹å’Œ/æˆ–ç¿»è¯‘æˆå¦ä¸€ç§è¯­è¨€ã€‚</p><p>A "Modified Version" of the Document means any work containing
        the Document or a portion of it, either copied verbatim, or with
        modifications and/or translated into another language.</p><p>â€œç¬¬äºŒéƒ¨åˆ†â€æ˜¯æ–‡æ¡£çš„æŒ‡å®šé™„å½•æˆ–å‰è¨€éƒ¨åˆ†ï¼Œä¸“é—¨å¤„ç†æ–‡æ¡£çš„å‡ºç‰ˆå•†æˆ–ä½œè€…ä¸Žæ–‡æ¡£çš„æ•´ä½“ä¸»é¢˜ï¼ˆæˆ–ç›¸å…³äº‹é¡¹ï¼‰çš„å…³ç³»ï¼Œå¹¶ä¸”ä¸åŒ…å«ä»»ä½•å¯èƒ½ç›´æŽ¥æ¶‰åŠçš„å†…å®¹åœ¨æ•´ä¸ªä¸»é¢˜å†…ã€‚ ï¼ˆå› æ­¤ï¼Œå¦‚æžœè¯¥æ–‡æ¡£çš„ä¸€éƒ¨åˆ†æ˜¯æ•°å­¦æ•™ç§‘ä¹¦ï¼Œåˆ™ç¬¬äºŒéƒ¨åˆ†å¯èƒ½ä¸ä¼šè§£é‡Šä»»ä½•æ•°å­¦ã€‚ï¼‰è¿™ç§å…³ç³»å¯èƒ½æ˜¯ä¸Žä¸»é¢˜æˆ–ç›¸å…³äº‹é¡¹çš„åŽ†å²è”ç³»ï¼Œæˆ–è€…æ˜¯æ³•å¾‹ã€å•†ä¸šã€å“²å­¦ã€ä¼¦ç†çš„åŽ†å²è”ç³»ã€‚æˆ–å…³äºŽä»–ä»¬çš„æ”¿æ²»ç«‹åœºã€‚</p><p>A "Secondary Section" is a named appendix or a front-matter
        section of the Document that deals exclusively with the relationship
        of the publishers or authors of the Document to the Document's overall
        subject (or to related matters) and contains nothing that could fall
        directly within that overall subject. (Thus, if the Document is in
        part a textbook of mathematics, a Secondary Section may not explain
        any mathematics.) The relationship could be a matter of historical
        connection with the subject or with related matters, or of legal,
        commercial, philosophical, ethical or political position regarding
        them.</p><p>â€œä¸å˜éƒ¨åˆ†â€æ˜¯æŸäº›æ¬¡è¦éƒ¨åˆ†ï¼Œå…¶æ ‡é¢˜åœ¨è¯´æ˜Žæ–‡æ¡£æ ¹æ®æœ¬è®¸å¯è¯å‘å¸ƒçš„é€šçŸ¥ä¸­æŒ‡å®šä¸ºä¸å˜éƒ¨åˆ†çš„æ ‡é¢˜ã€‚å¦‚æžœä¸€ä¸ªéƒ¨åˆ†ä¸ç¬¦åˆä¸Šè¿°æ¬¡è¦çš„å®šä¹‰ï¼Œåˆ™ä¸å…è®¸å°†å…¶æŒ‡å®šä¸ºä¸å˜çš„ã€‚è¯¥æ–‡æ¡£å¯ä»¥åŒ…å«é›¶ä¸ªä¸å˜éƒ¨åˆ†ã€‚å¦‚æžœæ–‡æ¡£æ²¡æœ‰æ ‡è¯†ä»»ä½•ä¸å˜éƒ¨åˆ†ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰ä¸å˜éƒ¨åˆ†ã€‚</p><p>The "Invariant Sections" are certain Secondary Sections whose
        titles are designated, as being those of Invariant Sections, in the
        notice that says that the Document is released under this License. If
        a section does not fit the above definition of Secondary then it is
        not allowed to be designated as Invariant. The Document may contain
        zero Invariant Sections. If the Document does not identify any
        Invariant Sections then there are none.</p><p>â€œå°é¢æ–‡æœ¬â€æ˜¯åœ¨é€šçŸ¥ä¸­åˆ—å‡ºçš„æŸäº›ç®€çŸ­æ–‡æœ¬æ®µè½ï¼Œå¦‚å°é¢æ–‡æœ¬æˆ–å°åº•æ–‡æœ¬ï¼Œè¯´æ˜Žæ–‡æ¡£æ˜¯æ ¹æ®æœ¬è®¸å¯è¯å‘å¸ƒçš„ã€‚å°é¢æ–‡æœ¬æœ€å¤šå¯åŒ…å« 5 ä¸ªå•è¯ï¼Œå°åº•æ–‡æœ¬æœ€å¤šå¯åŒ…å« 25 ä¸ªå•è¯ã€‚</p><p>The "Cover Texts" are certain short passages of text that are
        listed, as Front-Cover Texts or Back-Cover Texts, in the notice that
        says that the Document is released under this License. A Front-Cover
        Text may be at most 5 words, and a Back-Cover Text may be at most 25
        words.</p><p>æ–‡ä»¶çš„â€œé€æ˜Žâ€å‰¯æœ¬æ˜¯æŒ‡æœºå™¨å¯è¯»çš„å‰¯æœ¬ï¼Œä»¥å…¬ä¼—å¯èŽ·å¾—çš„è§„èŒƒæ ¼å¼è¡¨ç¤ºï¼Œé€‚åˆä½¿ç”¨é€šç”¨æ–‡æœ¬ç¼–è¾‘å™¨æˆ–ï¼ˆå¯¹äºŽç”±åƒç´ ç»„æˆçš„å›¾åƒï¼‰â€‹â€‹é€šç”¨ç»˜ç”»ç›´æŽ¥ä¿®æ”¹æ–‡æ¡£ç¨‹åºæˆ–ï¼ˆå¯¹äºŽç»˜å›¾ï¼‰ä¸€äº›å¹¿æ³›ä½¿ç”¨çš„ç»˜å›¾ç¼–è¾‘å™¨ï¼Œå¹¶ä¸”é€‚åˆè¾“å…¥åˆ°æ–‡æœ¬æ ¼å¼åŒ–ç¨‹åºæˆ–è‡ªåŠ¨è½¬æ¢ä¸ºé€‚åˆè¾“å…¥åˆ°æ–‡æœ¬æ ¼å¼åŒ–ç¨‹åºçš„å„ç§æ ¼å¼ã€‚ä»¥å…¶ä»–é€æ˜Žæ–‡ä»¶æ ¼å¼åˆ¶ä½œçš„å‰¯æœ¬ï¼Œå…¶æ ‡è®°æˆ–æ— æ ‡è®°å·²è¢«å®‰æŽ’ä¸ºé˜»æ­¢æˆ–é˜»æ­¢è¯»è€…è¿›è¡ŒåŽç»­ä¿®æ”¹ï¼Œè¯¥å‰¯æœ¬ä¸æ˜¯é€æ˜Žçš„ã€‚å¦‚æžœå›¾åƒæ ¼å¼ç”¨äºŽä»»ä½•å¤§é‡æ–‡æœ¬ï¼Œåˆ™è¯¥å›¾åƒæ ¼å¼ä¸æ˜¯é€æ˜Žçš„ã€‚éžâ€œé€æ˜Žâ€çš„å‰¯æœ¬ç§°ä¸ºâ€œä¸é€æ˜Žâ€ã€‚</p><p>A "Transparent" copy of the Document means a machine-readable
        copy, represented in a format whose specification is available to the
        general public, that is suitable for revising the document
        straightforwardly with generic text editors or (for images composed of
        pixels) generic paint programs or (for drawings) some widely available
        drawing editor, and that is suitable for input to text formatters or
        for automatic translation to a variety of formats suitable for input
        to text formatters. A copy made in an otherwise Transparent file
        format whose markup, or absence of markup, has been arranged to thwart
        or discourage subsequent modification by readers is not Transparent.
        An image format is not Transparent if used for any substantial amount
        of text. A copy that is not "Transparent" is called "Opaque".</p><p>é€æ˜Žå‰¯æœ¬çš„åˆé€‚æ ¼å¼çš„ç¤ºä¾‹åŒ…æ‹¬æ— æ ‡è®°çš„çº¯ ASCIIã€Texinfo è¾“å…¥æ ¼å¼ã€LaTeX è¾“å…¥æ ¼å¼ã€ä½¿ç”¨å…¬å¼€å¯ç”¨çš„ DTD çš„ SGML æˆ– XMLï¼Œä»¥åŠä¸ºäººå·¥ä¿®æ”¹è€Œè®¾è®¡çš„ç¬¦åˆæ ‡å‡†çš„ç®€å• HTMLã€PostScript æˆ– PDFã€‚é€æ˜Žå›¾åƒæ ¼å¼çš„ç¤ºä¾‹åŒ…æ‹¬ PNGã€XCF å’Œ JPGã€‚ä¸é€æ˜Žæ ¼å¼åŒ…æ‹¬åªèƒ½ç”±ä¸“æœ‰æ–‡å­—å¤„ç†å™¨è¯»å–å’Œç¼–è¾‘çš„ä¸“æœ‰æ ¼å¼ã€DTD å’Œ/æˆ–å¤„ç†å·¥å…·é€šå¸¸ä¸å¯ç”¨çš„ SGML æˆ– XMLï¼Œä»¥åŠç”±æŸäº›æ–‡å­—å¤„ç†å™¨ç”Ÿæˆçš„æœºå™¨ç”Ÿæˆçš„ HTMLã€PostScript æˆ– PDFã€‚ä»…ç”¨äºŽè¾“å‡ºç›®çš„ã€‚</p><p>Examples of suitable formats for Transparent copies include
        plain ASCII without markup, Texinfo input format, LaTeX input format,
        SGML or XML using a publicly available DTD, and standard-conforming
        simple HTML, PostScript or PDF designed for human modification.
        Examples of transparent image formats include PNG, XCF and JPG. Opaque
        formats include proprietary formats that can be read and edited only
        by proprietary word processors, SGML or XML for which the DTD and/or
        processing tools are not generally available, and the
        machine-generated HTML, PostScript or PDF produced by some word
        processors for output purposes only.</p><p>å¯¹äºŽå°åˆ·ä¹¦ç±ï¼Œâ€œæ‰‰é¡µâ€æ˜¯æŒ‡æ‰‰é¡µæœ¬èº«ï¼Œä»¥åŠæ¸…æ™°åœ°ä¿å­˜æœ¬è®¸å¯è¯è¦æ±‚åœ¨æ‰‰é¡µä¸­æ˜¾ç¤ºçš„ææ–™æ‰€éœ€çš„åŽç»­é¡µé¢ã€‚å¯¹äºŽæ²¡æœ‰ä»»ä½•æ ‡é¢˜é¡µçš„æ ¼å¼çš„ä½œå“ï¼Œâ€œæ ‡é¢˜é¡µâ€æ˜¯æŒ‡é è¿‘ä½œå“æ ‡é¢˜æœ€çªå‡ºçš„å¤–è§‚ã€ä½äºŽæ–‡æœ¬æ­£æ–‡å¼€å¤´ä¹‹å‰çš„æ–‡æœ¬ã€‚</p><p>The "Title Page" means, for a printed book, the title page
        itself, plus such following pages as are needed to hold, legibly, the
        material this License requires to appear in the title page. For works
        in formats which do not have any title page as such, "Title Page"
        means the text near the most prominent appearance of the work's title,
        preceding the beginning of the body of the text.</p><p>â€œæ ‡é¢˜ä¸º XYZâ€çš„éƒ¨åˆ†æ˜¯æŒ‡æ–‡æ¡£çš„å‘½åå­å•å…ƒï¼Œå…¶æ ‡é¢˜è¦ä¹ˆæ°å¥½æ˜¯ XYZï¼Œè¦ä¹ˆåœ¨å°† XYZ ç¿»è¯‘æˆå¦ä¸€ç§è¯­è¨€çš„æ–‡æœ¬åŽé¢çš„æ‹¬å·ä¸­åŒ…å« XYZã€‚ ï¼ˆè¿™é‡Œ XYZ ä»£è¡¨ä¸‹é¢æåˆ°çš„ç‰¹å®šéƒ¨åˆ†åç§°ï¼Œä¾‹å¦‚â€œè‡´è°¢â€ã€â€œå¥‰çŒ®â€ã€â€œè®¤å¯â€æˆ–â€œåŽ†å²â€ã€‚ï¼‰åœ¨ä¿®æ”¹æ–‡æ¡£æ—¶â€œä¿ç•™è¯¥éƒ¨åˆ†çš„æ ‡é¢˜â€æ„å‘³ç€å®ƒæ ¹æ®æ­¤å®šä¹‰ï¼Œä¿ç•™â€œæ ‡é¢˜ä¸º XYZâ€çš„éƒ¨åˆ†ã€‚</p><p>A section "Entitled XYZ" means a named subunit of the Document
        whose title either is precisely XYZ or contains XYZ in parentheses
        following text that translates XYZ in another language. (Here XYZ
        stands for a specific section name mentioned below, such as
        "Acknowledgements", "Dedications", "Endorsements", or "History".) To
        "Preserve the Title" of such a section when you modify the Document
        means that it remains a section "Entitled XYZ" according to this
        definition.</p><p>è¯¥æ–‡æ¡£å¯èƒ½åœ¨é€šçŸ¥æ—è¾¹åŒ…å«ä¿è¯å…è´£å£°æ˜Žï¼Œå£°æ˜Žæœ¬è®¸å¯è¯é€‚ç”¨äºŽè¯¥æ–‡æ¡£ã€‚è¿™äº›ä¿è¯å…è´£å£°æ˜Žè¢«è§†ä¸ºé€šè¿‡å¼•ç”¨åŒ…å«åœ¨æœ¬è®¸å¯è¯ä¸­ï¼Œä½†ä»…é™äºŽå…è´£ä¿è¯ï¼šè¿™äº›ä¿è¯å…è´£å£°æ˜Žå¯èƒ½å…·æœ‰çš„ä»»ä½•å…¶ä»–å«ä¹‰éƒ½æ˜¯æ— æ•ˆçš„ï¼Œå¹¶ä¸”å¯¹æœ¬è®¸å¯è¯çš„å«ä¹‰æ²¡æœ‰å½±å“ã€‚</p><p>The Document may include Warranty Disclaimers next to the notice
        which states that this License applies to the Document. These Warranty
        Disclaimers are considered to be included by reference in this
        License, but only as regards disclaiming warranties: any other
        implication that these Warranty Disclaimers may have is void and has
        no effect on the meaning of this License.</p></div></div></div>
<div id="OEBPS/apcs03.html"><div>
<div class="sect1" title="2. é€å­—å¤åˆ¶"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/apcs03.html.make3-APP-C-SECT-3"></a>2. é€å­—å¤åˆ¶</h1><h1 class="title"><a></a>2. VERBATIM COPYING</h1></div></div></div><p>æ‚¨å¯ä»¥åœ¨ä»»ä½•å•†ä¸šæˆ–éžå•†ä¸šåª’ä»‹ä¸Šå¤åˆ¶å’Œåˆ†å‘æœ¬æ–‡æ¡£ï¼Œå‰ææ˜¯æœ¬è®¸å¯è¯ã€ç‰ˆæƒå£°æ˜Žä»¥åŠè¯´æ˜Žæœ¬è®¸å¯è¯é€‚ç”¨äºŽæœ¬æ–‡æ¡£çš„è®¸å¯è¯å£°æ˜Žå‡å¤åˆ¶åˆ°æ‰€æœ‰å‰¯æœ¬ä¸­ï¼Œå¹¶ä¸”æ‚¨ä¸æ·»åŠ ä»»ä½•å…¶ä»–æ¡ä»¶æœ¬è®¸å¯è¯çš„å†…å®¹ã€‚æ‚¨ä¸å¾—ä½¿ç”¨æŠ€æœ¯æŽªæ–½é˜»ç¢æˆ–æŽ§åˆ¶æ‚¨åˆ¶ä½œæˆ–åˆ†å‘çš„å‰¯æœ¬çš„é˜…è¯»æˆ–è¿›ä¸€æ­¥å¤åˆ¶ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥æŽ¥å—è¡¥å¿ä»¥æ¢å–å‰¯æœ¬ã€‚å¦‚æžœæ‚¨åˆ†å‘è¶³å¤Ÿå¤šçš„å‰¯æœ¬ï¼Œæ‚¨è¿˜å¿…é¡»éµå®ˆç¬¬ 3 èŠ‚ä¸­çš„æ¡ä»¶ã€‚</p><p>You may copy and distribute the Document in any medium, either
        commercially or noncommercially, provided that this License, the
        copyright notices, and the license notice saying this License applies
        to the Document are reproduced in all copies, and that you add no
        other conditions whatsoever to those of this License. You may not use
        technical measures to obstruct or control the reading or further
        copying of the copies you make or distribute. However, you may accept
        compensation in exchange for copies. If you distribute a large enough
        number of copies you must also follow the conditions in section
        3.</p><p>æ‚¨è¿˜å¯ä»¥åœ¨ä¸Šè¿°ç›¸åŒæ¡ä»¶ä¸‹å‡ºå€Ÿå‰¯æœ¬ï¼Œå¹¶ä¸”å¯ä»¥å…¬å¼€å±•ç¤ºå‰¯æœ¬ã€‚</p><p>You may also lend copies, under the same conditions stated
        above, and you may publicly display copies.</p></div></div></div>
<div id="OEBPS/apcs04.html"><div>
<div class="sect1" title="3. å¤åˆ¶æ•°é‡"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/apcs04.html.make3-APP-C-SECT-4"></a>3. å¤åˆ¶æ•°é‡</h1><h1 class="title"><a></a>3. COPYING IN QUANTITY</h1></div></div></div><p>å¦‚æžœæ‚¨å‘å¸ƒæ–‡æ¡£çš„å°åˆ·å‰¯æœ¬ï¼ˆæˆ–é€šå¸¸æœ‰å°åˆ·å°é¢çš„ä»‹è´¨ä¸­çš„å‰¯æœ¬ï¼‰ï¼Œæ•°é‡è¶…è¿‡ 100ï¼Œå¹¶ä¸”æ–‡æ¡£çš„è®¸å¯é€šçŸ¥éœ€è¦å°é¢æ–‡æœ¬ï¼Œåˆ™æ‚¨å¿…é¡»å°†å‰¯æœ¬é™„åœ¨å°é¢ä¸Šï¼Œå…¶ä¸­æ¸…æ™°æ˜“è¯»åœ°è½½æœ‰æ‰€æœ‰è¿™äº›å†…å®¹å°é¢æ–‡æœ¬ï¼šå°é¢æ–‡æœ¬åœ¨å°é¢ä¸Šï¼Œå°åº•æ–‡æœ¬åœ¨å°åº•ä¸Šã€‚ä¸¤ä¸ªå°é¢è¿˜å¿…é¡»æ¸…æ¥šæ˜“è¯»åœ°è¡¨æ˜Žæ‚¨æ˜¯è¿™äº›å‰¯æœ¬çš„å‡ºç‰ˆå•†ã€‚å°é¢å¿…é¡»å‘ˆçŽ°å®Œæ•´çš„æ ‡é¢˜ï¼Œæ ‡é¢˜çš„æ‰€æœ‰æ–‡å­—éƒ½åŒæ ·çªå‡ºå’Œå¯è§ã€‚æ‚¨è¿˜å¯ä»¥åœ¨å°é¢ä¸Šæ·»åŠ å…¶ä»–ææ–™ã€‚ä»…é™äºŽå°é¢æ›´æ”¹çš„å¤åˆ¶ï¼Œåªè¦ä¿ç•™æ–‡æ¡£æ ‡é¢˜å¹¶æ»¡è¶³è¿™äº›æ¡ä»¶ï¼Œåœ¨å…¶ä»–æ–¹é¢å°±å¯ä»¥è¢«è§†ä¸ºé€å­—å¤åˆ¶ã€‚</p><p>If you publish printed copies (or copies in media that commonly
        have printed covers) of the Document, numbering more than 100, and the
        Document's license notice requires Cover Texts, you must enclose the
        copies in covers that carry, clearly and legibly, all these Cover
        Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on
        the back cover. Both covers must also clearly and legibly identify you
        as the publisher of these copies. The front cover must present the
        full title with all words of the title equally prominent and visible.
        You may add other material on the covers in addition. Copying with
        changes limited to the covers, as long as they preserve the title of
        the Document and satisfy these conditions, can be treated as verbatim
        copying in other respects.</p><p>å¦‚æžœä»»ä¸€å°é¢æ‰€éœ€çš„æ–‡æœ¬å¤ªå¤§è€Œæ— æ³•æ¸…æ™°æ˜¾ç¤ºï¼Œåˆ™åº”å°†åˆ—å‡ºçš„ç¬¬ä¸€ä¸ªæ–‡æœ¬ï¼ˆå°½å¯èƒ½å¤šåœ°åˆç†æ”¾ç½®ï¼‰æ”¾åœ¨å®žé™…å°é¢ä¸Šï¼Œå¹¶å°†å…¶ä½™å†…å®¹ç»§ç»­æ”¾åœ¨ç›¸é‚»çš„é¡µé¢ä¸Šã€‚</p><p>If the required texts for either cover are too voluminous to fit
        legibly, you should put the first ones listed (as many as fit
        reasonably) on the actual cover, and continue the rest onto adjacent
        pages.</p><p>å¦‚æžœæ‚¨å‘å¸ƒæˆ–åˆ†å‘çš„æ–‡æ¡£çš„ä¸é€æ˜Žå‰¯æœ¬æ•°é‡è¶…è¿‡ 100ï¼Œåˆ™å¿…é¡»åœ¨æ¯ä¸ªä¸é€æ˜Žå‰¯æœ¬ä¸­é™„ä¸Šæœºå™¨å¯è¯»çš„é€æ˜Žå‰¯æœ¬ï¼Œæˆ–è€…åœ¨æ¯ä¸ªä¸é€æ˜Žå‰¯æœ¬ä¸­æ³¨æ˜Žä¸€ä¸ªè®¡ç®—æœºç½‘ç»œä½ç½®ï¼Œä¸€èˆ¬ç½‘ç»œå¯ä»Žè¯¥ä½ç½®ä½¿ç”¨å…¬ä¼—å¯ä»¥ä½¿ç”¨å…¬å…±æ ‡å‡†ç½‘ç»œåè®®ä¸‹è½½è¯¥æ–‡æ¡£çš„å®Œæ•´é€æ˜Žå‰¯æœ¬ï¼Œæ— éœ€æ·»åŠ ææ–™ã€‚å¦‚æžœæ‚¨ä½¿ç”¨åŽä¸€ä¸ªé€‰é¡¹ï¼Œå½“æ‚¨å¼€å§‹å¤§é‡åˆ†å‘ä¸é€æ˜Žå‰¯æœ¬æ—¶ï¼Œæ‚¨å¿…é¡»é‡‡å–ç›¸å½“è°¨æ…Žçš„æ­¥éª¤ï¼Œä»¥ç¡®ä¿æ­¤é€æ˜Žå‰¯æœ¬å°†åœ¨æŒ‡å®šä½ç½®ä¿æŒå¯è®¿é—®çŠ¶æ€ï¼Œç›´åˆ°æ‚¨ä¸Šæ¬¡åˆ†å‘ä¸é€æ˜Žå‰¯æœ¬åŽè‡³å°‘ä¸€å¹´ã€‚å°†è¯¥ç‰ˆæœ¬çš„ä¸é€æ˜Žå‰¯æœ¬ï¼ˆç›´æŽ¥æˆ–é€šè¿‡æ‚¨çš„ä»£ç†å•†æˆ–é›¶å”®å•†ï¼‰å‘å…¬ä¼—å…¬å¼€ã€‚</p><p>If you publish or distribute Opaque copies of the Document
        numbering more than 100, you must either include a machine-readable
        Transparent copy along with each Opaque copy, or state in or with each
        Opaque copy a computer-network location from which the general
        network-using public has access to download using public-standard
        network protocols a complete Transparent copy of the Document, free of
        added material. If you use the latter option, you must take reasonably
        prudent steps, when you begin distribution of Opaque copies in
        quantity, to ensure that this Transparent copy will remain thus
        accessible at the stated location until at least one year after the
        last time you distribute an Opaque copy (directly or through your
        agents or retailers) of that edition to the public.</p><p>æˆ‘ä»¬è¦æ±‚ï¼ˆä½†ä¸æ˜¯è¦æ±‚ï¼‰æ‚¨åœ¨é‡æ–°åˆ†å‘å¤§é‡å‰¯æœ¬ä¹‹å‰ä¸Žæ–‡æ¡£çš„ä½œè€…è”ç³»ï¼Œä»¥ä¾¿ä»–ä»¬æœ‰æœºä¼šä¸ºæ‚¨æä¾›æ–‡æ¡£çš„æ›´æ–°ç‰ˆæœ¬ã€‚</p><p>It is requested, but not required, that you contact the authors
        of the Document well before redistributing any large number of copies,
        to give them a chance to provide you with an updated version of the
        Document.</p></div></div></div>
<div id="OEBPS/apcs05.html"><div>
<div class="sect1" title="4. ä¿®æ”¹"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/apcs05.html.make3-APP-C-SECT-5"></a>4. ä¿®æ”¹</h1><h1 class="title"><a></a>4. MODIFICATIONS</h1></div></div></div><p>æ‚¨å¯ä»¥æ ¹æ®ä¸Šè¿°ç¬¬ 2 èŠ‚å’Œç¬¬ 3 èŠ‚çš„æ¡ä»¶å¤åˆ¶å’Œåˆ†å‘æœ¬æ–‡æ¡£çš„ä¿®æ”¹ç‰ˆæœ¬ï¼Œå‰ææ˜¯æ‚¨å®Œå…¨æŒ‰ç…§æœ¬è®¸å¯è¯å‘å¸ƒä¿®æ”¹ç‰ˆæœ¬ï¼Œå¹¶ä¸”ä¿®æ”¹ç‰ˆæœ¬å¡«è¡¥äº†æ–‡æ¡£çš„è§’è‰²ï¼Œä»Žè€Œè®¸å¯åˆ†å‘å’Œä¿®æ”¹ä¿®æ”¹åŽçš„ç‰ˆæœ¬äº¤ç»™æ‹¥æœ‰è¯¥å‰¯æœ¬çš„ä»»ä½•äººã€‚å¦å¤–ï¼Œæ‚¨å¿…é¡»åœ¨ä¿®æ”¹ç‰ˆæœ¬ä¸­æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><p>You may copy and distribute a Modified Version of the Document
        under the conditions of sections 2 and 3 above, provided that you
        release the Modified Version under precisely this License, with the
        Modified Version filling the role of the Document, thus licensing
        distribution and modification of the Modified Version to whoever
        possesses a copy of it. In addition, you must do these things in the
        Modified Version:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>åœ¨æ‰‰é¡µï¼ˆä»¥åŠå°é¢ï¼Œå¦‚æžœæœ‰ï¼‰ä¸­ä½¿ç”¨ä¸Žæ–‡æ¡£ä»¥åŠä»¥å‰ç‰ˆæœ¬ï¼ˆå¦‚æžœæœ‰çš„è¯ï¼Œåº”è¯¥åœ¨æ–‡æ¡£çš„åŽ†å²è®°å½•éƒ¨åˆ†ä¸­åˆ—å‡ºï¼‰ä¸åŒçš„æ ‡é¢˜ã€‚å¦‚æžœè¯¥ç‰ˆæœ¬çš„åŽŸå§‹å‘è¡Œå•†å…è®¸ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸Žå…ˆå‰ç‰ˆæœ¬ç›¸åŒçš„æ ‡é¢˜ã€‚</p></li><li class="listitem"><p>Use in the Title Page (and on the covers, if any) a title
            distinct from that of the Document, and from those of previous
            versions (which should, if there were any, be listed in the
            History section of the Document). You may use the same title as a
            previous version if the original publisher of that version gives
            permission.</p></li><li class="listitem"><p>åœ¨æ‰‰é¡µä¸Šåˆ—å‡ºä½œä¸ºä½œè€…ã€è´Ÿè´£ä¿®æ”¹ç‰ˆæœ¬ä¸­ä¿®æ”¹çš„ä½œè€…çš„ä¸€ä¸ªæˆ–å¤šä¸ªä¸ªäººæˆ–å®žä½“ï¼Œä»¥åŠæ–‡æ¡£çš„è‡³å°‘äº”ä½ä¸»è¦ä½œè€…ï¼ˆå¦‚æžœæ–‡æ¡£çš„ä¸»è¦ä½œè€…å°‘äºŽäº”ï¼‰ï¼Œé™¤éžä»–ä»¬å…é™¤æ‚¨çš„æ­¤è¦æ±‚ã€‚</p></li><li class="listitem"><p>List on the Title Page, as authors, one or more persons or
            entities responsible for authorship of the modifications in the
            Modified Version, together with at least five of the principal
            authors of the Document (all of its principal authors, if it has
            fewer than five), unless they release you from this
            requirement.</p></li><li class="listitem"><p>åœ¨æ‰‰é¡µä¸Šæ³¨æ˜Žä¿®æ”¹ç‰ˆæœ¬çš„å‡ºç‰ˆå•†åç§°ï¼Œå³å‡ºç‰ˆå•†ã€‚</p></li><li class="listitem"><p>State on the Title page the name of the publisher of the
            Modified Version, as the publisher.</p></li><li class="listitem"><p>ä¿ç•™æ–‡æ¡£çš„æ‰€æœ‰ç‰ˆæƒå£°æ˜Žã€‚</p></li><li class="listitem"><p>Preserve all the copyright notices of the Document.</p></li><li class="listitem"><p>åœ¨å…¶ä»–ç‰ˆæƒå£°æ˜Žæ—è¾¹æ·»åŠ é€‚åˆæ‚¨çš„ä¿®æ”¹çš„ç‰ˆæƒå£°æ˜Žã€‚</p></li><li class="listitem"><p>Add an appropriate copyright notice for your modifications
            adjacent to the other copyright notices.</p></li><li class="listitem"><p>åœ¨ç‰ˆæƒå£°æ˜Žä¹‹åŽç«‹å³åŒ…å«ä¸€ä»½è®¸å¯å£°æ˜Žï¼Œå…è®¸å…¬ä¼—æ ¹æ®æœ¬è®¸å¯è¯çš„æ¡æ¬¾ä½¿ç”¨ä¿®æ”¹ç‰ˆæœ¬ï¼Œå…¶å½¢å¼å¦‚ä¸‹é¢çš„é™„å½•æ‰€ç¤ºã€‚</p></li><li class="listitem"><p>Include, immediately after the copyright notices, a license
            notice giving the public permission to use the Modified Version
            under the terms of this License, in the form shown in the Addendum
            below.</p></li><li class="listitem"><p>åœ¨è¯¥è®¸å¯é€šçŸ¥ä¸­ä¿ç•™æ–‡æ¡£è®¸å¯é€šçŸ¥ä¸­ç»™å‡ºçš„ä¸å˜éƒ¨åˆ†å’Œæ‰€éœ€å°é¢æ–‡æœ¬çš„å®Œæ•´åˆ—è¡¨ã€‚</p></li><li class="listitem"><p>Preserve in that license notice the full lists of Invariant
            Sections and required Cover Texts given in the Document's license
            notice.</p></li><li class="listitem"><p>åŒ…å«æœ¬è®¸å¯è¯çš„æœªæ›´æ”¹å‰¯æœ¬ã€‚</p></li><li class="listitem"><p>Include an unaltered copy of this License.</p></li><li class="listitem"><p>ä¿ç•™æ ‡é¢˜ä¸ºâ€œåŽ†å²â€çš„éƒ¨åˆ†ï¼Œä¿ç•™å…¶æ ‡é¢˜ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ ä¸€ä¸ªé¡¹ç›®ï¼Œè‡³å°‘è¯´æ˜Žæ ‡é¢˜é¡µä¸Šç»™å‡ºçš„ä¿®æ”¹ç‰ˆæœ¬çš„æ ‡é¢˜ã€å¹´ä»½ã€æ–°ä½œè€…å’Œå‡ºç‰ˆå•†ã€‚å¦‚æžœæ–‡æ¡£ä¸­æ²¡æœ‰æ ‡é¢˜ä¸ºâ€œåŽ†å²â€çš„éƒ¨åˆ†ï¼Œè¯·åˆ›å»ºä¸€ä¸ªè¯´æ˜Žæ ‡é¢˜é¡µä¸Šç»™å‡ºçš„æ–‡æ¡£æ ‡é¢˜ã€å¹´ä»½ã€ä½œè€…å’Œå‡ºç‰ˆå•†ï¼Œç„¶åŽæ·»åŠ ä¸€ä¸ªæè¿°ä¸Šä¸€å¥ä¸­æ‰€è¿°çš„ä¿®æ”¹ç‰ˆæœ¬çš„é¡¹ç›®ã€‚</p></li><li class="listitem"><p>Preserve the section Entitled "History", Preserve its Title,
            and add to it an item stating at least the title, year, new
            authors, and publisher of the Modified Version as given on the
            Title Page. If there is no section Entitled "History" in the
            Document, create one stating the title, year, authors, and
            publisher of the Document as given on its Title Page, then add an
            item describing the Modified Version as stated in the previous
            sentence.</p></li><li class="listitem"><p>ä¿ç•™æ–‡æ¡£ä¸­ç»™å‡ºçš„ç½‘ç»œä½ç½®ï¼ˆå¦‚æžœæœ‰ï¼‰ï¼Œä»¥ä¾¿å…¬ä¼—è®¿é—®æ–‡æ¡£çš„é€æ˜Žå‰¯æœ¬ï¼ŒåŒæ ·ä¿ç•™æ–‡æ¡£ä¸­ç»™å‡ºçš„å…¶æ‰€åŸºäºŽçš„å…ˆå‰ç‰ˆæœ¬çš„ç½‘ç»œä½ç½®ã€‚è¿™äº›å¯ä»¥æ”¾åœ¨â€œåŽ†å²â€éƒ¨åˆ†ã€‚æ‚¨å¯ä»¥çœç•¥è‡³å°‘åœ¨æ–‡æ¡£æœ¬èº«ä¹‹å‰å››å¹´å‘å¸ƒçš„ä½œå“çš„ç½‘ç»œä½ç½®ï¼Œæˆ–è€…å¦‚æžœå®ƒæ‰€å¼•ç”¨çš„ç‰ˆæœ¬çš„åŽŸå§‹å‡ºç‰ˆå•†ç»™äºˆè®¸å¯ã€‚</p></li><li class="listitem"><p>Preserve the network location, if any, given in the Document
            for public access to a Transparent copy of the Document, and
            likewise the network locations given in the Document for previous
            versions it was based on. These may be placed in the "History"
            section. You may omit a network location for a work that was
            published at least four years before the Document itself, or if
            the original publisher of the version it refers to gives
            permission.</p></li><li class="listitem"><p>å¯¹äºŽä»»ä½•æ ‡é¢˜ä¸ºâ€œè‡´è°¢â€æˆ–â€œå¥‰çŒ®â€çš„éƒ¨åˆ†ï¼Œä¿ç•™è¯¥éƒ¨åˆ†çš„æ ‡é¢˜ï¼Œå¹¶åœ¨è¯¥éƒ¨åˆ†ä¸­ä¿ç•™å…¶ä¸­ç»™å‡ºçš„æ¯ä¸ªè´¡çŒ®è€…è‡´è°¢å’Œ/æˆ–å¥‰çŒ®çš„æ‰€æœ‰å®žè´¨å†…å®¹å’Œè¯­æ°”ã€‚</p></li><li class="listitem"><p>For any section Entitled "Acknowledgements" or
            "Dedications", Preserve the Title of the section, and preserve in
            the section all the substance and tone of each of the contributor
            acknowledgements and/or dedications given therein.</p></li><li class="listitem"><p>ä¿ç•™æ–‡æ¡£çš„æ‰€æœ‰ä¸å˜éƒ¨åˆ†ï¼Œå…¶æ–‡æœ¬å’Œæ ‡é¢˜ä¸å˜ã€‚ç« èŠ‚ç¼–å·æˆ–åŒç­‰å†…å®¹ä¸è¢«è§†ä¸ºç« èŠ‚æ ‡é¢˜çš„ä¸€éƒ¨åˆ†ã€‚</p></li><li class="listitem"><p>Preserve all the Invariant Sections of the Document,
            unaltered in their text and in their titles. Section numbers or
            the equivalent are not considered part of the section
            titles.</p></li><li class="listitem"><p>åˆ é™¤ä»»ä½•æ ‡é¢˜ä¸ºâ€œè®¤å¯â€çš„éƒ¨åˆ†ã€‚ä¿®æ”¹ç‰ˆæœ¬ä¸­å¯èƒ½ä¸åŒ…å«æ­¤ç±»éƒ¨åˆ†ã€‚</p></li><li class="listitem"><p>Delete any section Entitled "Endorsements". Such a section
            may not be included in the Modified Version.</p></li><li class="listitem"><p>è¯·å‹¿å°†ä»»ä½•çŽ°æœ‰éƒ¨åˆ†çš„æ ‡é¢˜é‡æ–°å‘½åä¸ºâ€œè®¤å¯â€æˆ–ä¸Žä»»ä½•ä¸å˜éƒ¨åˆ†çš„æ ‡é¢˜å‘ç”Ÿå†²çªã€‚</p></li><li class="listitem"><p>Do not retitle any existing section to be Entitled
            "Endorsements" or to conflict in title with any Invariant
            Section.</p></li><li class="listitem"><p>ä¿ç•™ä»»ä½•ä¿ä¿®å…è´£å£°æ˜Žã€‚</p></li><li class="listitem"><p>Preserve any Warranty Disclaimers.</p></li></ol></div><p>å¦‚æžœä¿®æ”¹ç‰ˆæœ¬åŒ…å«ç¬¦åˆæ¬¡è¦éƒ¨åˆ†èµ„æ ¼çš„æ–°çš„å‰è¨€éƒ¨åˆ†æˆ–é™„å½•ï¼Œå¹¶ä¸”ä¸åŒ…å«ä»Žæ–‡æ¡£å¤åˆ¶çš„ææ–™ï¼Œåˆ™æ‚¨å¯ä»¥é€‰æ‹©å°†è¿™äº›éƒ¨åˆ†ä¸­çš„éƒ¨åˆ†æˆ–å…¨éƒ¨æŒ‡å®šä¸ºä¸å˜ã€‚ä¸ºæ­¤ï¼Œè¯·å°†å…¶æ ‡é¢˜æ·»åŠ åˆ°ä¿®æ”¹ç‰ˆæœ¬çš„è®¸å¯å£°æ˜Žä¸­çš„ä¸å˜éƒ¨åˆ†åˆ—è¡¨ä¸­ã€‚è¿™äº›æ ‡é¢˜å¿…é¡»ä¸Žä»»ä½•å…¶ä»–éƒ¨åˆ†æ ‡é¢˜ä¸åŒã€‚</p><p>If the Modified Version includes new front-matter sections or
        appendices that qualify as Secondary Sections and contain no material
        copied from the Document, you may at your option designate some or all
        of these sections as invariant. To do this, add their titles to the
        list of Invariant Sections in the Modified Version's license notice.
        These titles must be distinct from any other section titles.</p><p>æ‚¨å¯ä»¥æ·»åŠ æ ‡é¢˜ä¸ºâ€œè®¤å¯â€çš„éƒ¨åˆ†ï¼Œå‰ææ˜¯å®ƒåªåŒ…å«å„æ–¹å¯¹æ‚¨çš„ä¿®æ”¹ç‰ˆæœ¬çš„è®¤å¯ï¼Œä¾‹å¦‚åŒè¡Œè¯„å®¡çš„å£°æ˜Žæˆ–æ–‡æœ¬å·²è¢«ç»„ç»‡æ‰¹å‡†ä¸ºæ ‡å‡†çš„æƒå¨å®šä¹‰ã€‚</p><p>You may add a section Entitled "Endorsements", provided it
        contains nothing but endorsements of your Modified Version by various
        partiesâ€”for example, statements of peer review or that the text has
        been approved by an organization as the authoritative definition of a
        standard.</p><p>æ‚¨å¯ä»¥å°†æœ€å¤š 5 ä¸ªå•è¯çš„æ®µè½ä½œä¸ºå°é¢æ–‡æœ¬ï¼Œå°†æœ€å¤š 25 ä¸ªå•è¯çš„æ®µè½ä½œä¸ºå°åº•æ–‡æœ¬æ·»åŠ åˆ°ä¿®æ”¹ç‰ˆæœ¬ä¸­å°é¢æ–‡æœ¬åˆ—è¡¨çš„æœ«å°¾ã€‚ä»»ä½•ä¸€ä¸ªå®žä½“ï¼ˆæˆ–é€šè¿‡å…¶å®‰æŽ’ï¼‰åªèƒ½æ·»åŠ ä¸€æ®µå°é¢æ–‡æœ¬å’Œä¸€æ®µå°åº•æ–‡æœ¬ã€‚å¦‚æžœæ–‡æ¡£å·²åŒ…å«åŒä¸€å°é¢çš„å°é¢æ–‡æœ¬ï¼ˆç”±æ‚¨ä¹‹å‰æ·»åŠ æˆ–ç”±æ‚¨ä»£è¡¨çš„åŒä¸€å®žä½“åšå‡ºçš„å®‰æŽ’ï¼‰ï¼Œåˆ™æ‚¨ä¸å¾—æ·»åŠ å…¶ä»–å†…å®¹ï¼›ä½†æ‚¨å¯ä»¥åœ¨èŽ·å¾—æ·»åŠ æ—§ç‰ˆæœ¬çš„å‰ä¸€å‘å¸ƒè€…çš„æ˜Žç¡®è®¸å¯åŽæ›´æ¢æ—§ç‰ˆæœ¬ã€‚</p><p>You may add a passage of up to five words as a Front-Cover Text,
        and a passage of up to 25 words as a Back-Cover Text, to the end of
        the list of Cover Texts in the Modified Version. Only one passage of
        Front-Cover Text and one of Back-Cover Text may be added by (or
        through arrangements made by) any one entity. If the Document already
        includes a cover text for the same cover, previously added by you or
        by arrangement made by the same entity you are acting on behalf of,
        you may not add another; but you may replace the old one, on explicit
        permission from the previous publisher that added the old one.</p><p>æ–‡æ¡£çš„ä½œè€…å’Œå‡ºç‰ˆå•†æœªæ ¹æ®æœ¬è®¸å¯è¯æŽˆäºˆä½¿ç”¨å…¶å§“åè¿›è¡Œä»»ä½•ä¿®æ”¹ç‰ˆæœ¬çš„å®£ä¼ æˆ–ä¸»å¼ æˆ–æš—ç¤ºè®¤å¯çš„è®¸å¯ã€‚</p><p>The author(s) and publisher(s) of the Document do not by this
        License give permission to use their names for publicity for or to
        assert or imply endorsement of any Modified Version.</p></div></div></div>
<div id="OEBPS/apcs06.html"><div>
<div class="sect1" title="5. åˆå¹¶æ–‡ä»¶"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/apcs06.html.make3-APP-C-SECT-6"></a>5. åˆå¹¶æ–‡ä»¶</h1><h1 class="title"><a></a>5. COMBINING DOCUMENTS</h1></div></div></div><p>æ‚¨å¯ä»¥æ ¹æ®ä¸Šè¿°ç¬¬ 4 èŠ‚ä¸­é’ˆå¯¹ä¿®æ”¹ç‰ˆæœ¬å®šä¹‰çš„æ¡æ¬¾ï¼Œå°†æœ¬æ–‡æ¡£ä¸Žæ ¹æ®æœ¬è®¸å¯è¯å‘å¸ƒçš„å…¶ä»–æ–‡æ¡£åˆå¹¶ï¼Œå‰ææ˜¯æ‚¨åœ¨ç»„åˆä¸­åŒ…å«æ‰€æœ‰æœªç»ä¿®æ”¹çš„åŽŸå§‹æ–‡æ¡£çš„æ‰€æœ‰ä¸å˜éƒ¨åˆ†ï¼Œå¹¶å°†å®ƒä»¬å…¨éƒ¨åˆ—å‡ºä½œä¸ºæ‚¨çš„ç»„åˆä½œå“çš„è®¸å¯å£°æ˜Žä¸­çš„ä¸å˜éƒ¨åˆ†ï¼Œå¹¶ä¸”æ‚¨ä¿ç•™å…¶æ‰€æœ‰ä¿è¯å…è´£å£°æ˜Žã€‚</p><p>You may combine the Document with other documents released under
        this License, under the terms defined in section 4 above for modified
        versions, provided that you include in the combination all of the
        Invariant Sections of all of the original documents, unmodified, and
        list them all as Invariant Sections of your combined work in its
        license notice, and that you preserve all their Warranty
        Disclaimers.</p><p>ç»„åˆä½œå“åªéœ€åŒ…å«æœ¬è®¸å¯è¯çš„ä¸€ä»½å‰¯æœ¬ï¼Œå¤šä¸ªç›¸åŒçš„ä¸å˜éƒ¨åˆ†å¯ä»¥ç”¨ä¸€ä»½å‰¯æœ¬æ›¿æ¢ã€‚å¦‚æžœå­˜åœ¨å¤šä¸ªå…·æœ‰ç›¸åŒåç§°ä½†å†…å®¹ä¸åŒçš„ä¸å˜éƒ¨åˆ†ï¼Œè¯·é€šè¿‡åœ¨å…¶æœ«å°¾çš„æ‹¬å·ä¸­æ·»åŠ è¯¥éƒ¨åˆ†çš„åŽŸå§‹ä½œè€…æˆ–å‡ºç‰ˆå•†çš„åç§°ï¼ˆå¦‚æžœå·²çŸ¥ï¼‰ï¼Œä½¿æ¯ä¸ªæ­¤ç±»éƒ¨åˆ†çš„æ ‡é¢˜å”¯ä¸€ï¼Œå¦åˆ™ä¸ºå”¯ä¸€çš„å·ç ã€‚å¯¹ç»„åˆä½œå“çš„è®¸å¯å£°æ˜Žä¸­ä¸å˜ç« èŠ‚åˆ—è¡¨ä¸­çš„ç« èŠ‚æ ‡é¢˜è¿›è¡Œç›¸åŒçš„è°ƒæ•´ã€‚</p><p>The combined work need only contain one copy of this License,
        and multiple identical Invariant Sections may be replaced with a
        single copy. If there are multiple Invariant Sections with the same
        name but different contents, make the title of each such section
        unique by adding at the end of it, in parentheses, the name of the
        original author or publisher of that section if known, or else a
        unique number. Make the same adjustment to the section titles in the
        list of Invariant Sections in the license notice of the combined
        work.</p><p>åˆå¹¶æ—¶ï¼Œå¿…é¡»å°†å„åŽŸå§‹æ–‡ä»¶ä¸­ä»»æ„æ ‡é¢˜ä¸ºâ€œåŽ†å²â€çš„ç« èŠ‚åˆå¹¶èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæ ‡é¢˜ä¸ºâ€œåŽ†å²â€çš„ç« èŠ‚ï¼›åŒæ ·ï¼Œåˆå¹¶ä»»ä½•æ ‡é¢˜ä¸ºâ€œè‡´è°¢â€çš„éƒ¨åˆ†å’Œä»»ä½•æ ‡é¢˜ä¸ºâ€œå¥‰çŒ®â€çš„éƒ¨åˆ†ã€‚æ‚¨å¿…é¡»åˆ é™¤æ‰€æœ‰æ ‡é¢˜ä¸ºâ€œè®¤å¯â€çš„éƒ¨åˆ†ã€‚</p><p>In the combination, you must combine any sections Entitled
        "History" in the various original documents, forming one section
        Entitled "History"; likewise combine any sections Entitled
        "Acknowledgements", and any sections Entitled "Dedications". You must
        delete all sections Entitled "Endorsements."</p></div></div></div>
<div id="OEBPS/apcs07.html"><div>
<div class="sect1" title="6. æ–‡ä»¶æ”¶é›†"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/apcs07.html.make3-APP-C-SECT-7"></a>6. æ–‡ä»¶æ”¶é›†</h1><h1 class="title"><a></a>6. COLLECTIONS OF DOCUMENTS</h1></div></div></div><p>æ‚¨å¯ä»¥åˆ¶ä½œä¸€ä¸ªåŒ…å«æœ¬æ–‡æ¡£å’Œæ ¹æ®æœ¬è®¸å¯è¯å‘å¸ƒçš„å…¶ä»–æ–‡æ¡£çš„é›†åˆï¼Œå¹¶ç”¨é›†åˆä¸­åŒ…å«çš„å•ä¸ªå‰¯æœ¬æ›¿æ¢å„ä¸ªæ–‡æ¡£ä¸­æœ¬è®¸å¯è¯çš„å„ä¸ªå‰¯æœ¬ï¼Œå‰ææ˜¯æ‚¨éµå¾ªæœ¬è®¸å¯è¯çš„è§„åˆ™åœ¨æ‰€æœ‰å…¶ä»–æ–¹é¢é€å­—å¤åˆ¶æ¯ä»½æ–‡ä»¶ã€‚</p><p>You may make a collection consisting of the Document and other
        documents released under this License, and replace the individual
        copies of this License in the various documents with a single copy
        that is included in the collection, provided that you follow the rules
        of this License for verbatim copying of each of the documents in all
        other respects.</p><p>æ‚¨å¯ä»¥ä»Žæ­¤ç±»é›†åˆä¸­æå–å•ä¸ªæ–‡æ¡£ï¼Œå¹¶æ ¹æ®æœ¬è®¸å¯è¯å°†å…¶å•ç‹¬åˆ†å‘ï¼Œå‰ææ˜¯æ‚¨å°†æœ¬è®¸å¯è¯çš„å‰¯æœ¬æ’å…¥åˆ°æå–çš„æ–‡æ¡£ä¸­ï¼Œå¹¶åœ¨æœ‰å…³é€å­—å¤åˆ¶è¯¥æ–‡æ¡£çš„æ‰€æœ‰å…¶ä»–æ–¹é¢éµå¾ªæœ¬è®¸å¯è¯ã€‚</p><p>You may extract a single document from such a collection, and
        distribute it individually under this License, provided you insert a
        copy of this License into the extracted document, and follow this
        License in all other respects regarding verbatim copying of that
        document.</p></div></div></div>
<div id="OEBPS/apcs08.html"><div>
<div class="sect1" title="7. ä¸Žç‹¬ç«‹ä½œå“çš„èšåˆ"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/apcs08.html.make3-APP-C-SECT-8"></a>7. ä¸Žç‹¬ç«‹ä½œå“çš„èšåˆ</h1><h1 class="title"><a></a>7. AGGREGATION WITH INDEPENDENT WORKS</h1></div></div></div><p>å¦‚æžœç”±æ±‡ç¼–äº§ç”Ÿçš„ç‰ˆæƒä¸ç”¨äºŽé™åˆ¶åˆæ³•æƒåˆ©ï¼Œåˆ™åœ¨å­˜å‚¨æˆ–åˆ†å‘ä»‹è´¨çš„å·ä¸­æˆ–ä¹‹ä¸Šå¯¹æœ¬æ–‡æ¡£æˆ–å…¶è¡ç”Ÿå“ä¸Žå…¶ä»–å•ç‹¬ä¸”ç‹¬ç«‹çš„æ–‡æ¡£æˆ–ä½œå“çš„æ±‡ç¼–ç§°ä¸ºâ€œé›†åˆä½“â€æ±‡ç¼–çš„ç”¨æˆ·è¶…å‡ºäº†ä¸ªåˆ«ä½œå“å…è®¸çš„èŒƒå›´ã€‚å½“æ–‡æ¡£åŒ…å«åœ¨ä¸€ä¸ªé›†åˆä¸­æ—¶ï¼Œæœ¬è®¸å¯è¯ä¸é€‚ç”¨äºŽé›†åˆä¸­çš„å…¶ä»–ä½œå“ï¼Œè¿™äº›ä½œå“æœ¬èº«ä¸æ˜¯è¯¥æ–‡æ¡£çš„è¡ç”Ÿä½œå“ã€‚</p><p>A compilation of the Document or its derivatives with other
        separate and independent documents or works, in or on a volume of a
        storage or distribution medium, is called an "aggregate" if the
        copyright resulting from the compilation is not used to limit the
        legal rights of the compilation's users beyond what the individual
        works permit. When the Document is included in an aggregate, this
        License does not apply to the other works in the aggregate which are
        not themselves derivative works of the Document.</p><p>å¦‚æžœç¬¬ 3 èŠ‚çš„å°é¢æ–‡æœ¬è¦æ±‚é€‚ç”¨äºŽæ–‡æ¡£çš„è¿™äº›å‰¯æœ¬ï¼Œåˆ™å¦‚æžœæ–‡æ¡£å°‘äºŽæ•´ä¸ªèšåˆçš„ä¸€åŠï¼Œåˆ™æ–‡æ¡£çš„å°é¢æ–‡æœ¬å¯ä»¥æ”¾ç½®åœ¨å°†æ–‡æ¡£æ‹¬åœ¨èšåˆå†…çš„å°é¢ä¸Šï¼Œæˆ–è€…å¦‚æžœæ–‡æ¡£ä¸ºç”µå­å½¢å¼ï¼Œåˆ™å°é¢çš„ç”µå­ç­‰æ•ˆé¡¹ã€‚å¦åˆ™ï¼Œå®ƒä»¬å¿…é¡»å‡ºçŽ°åœ¨æ”¯æ’‘æ•´ä¸ªèšåˆä½“çš„å°åˆ·å°é¢ä¸Šã€‚</p><p>If the Cover Text requirement of section 3 is applicable to
        these copies of the Document, then if the Document is less than one
        half of the entire aggregate, the Document's Cover Texts may be placed
        on covers that bracket the Document within the aggregate, or the
        electronic equivalent of covers if the Document is in electronic form.
        Otherwise they must appear on printed covers that bracket the whole
        aggregate.</p></div></div></div>
<div id="OEBPS/apcs09.html"><div>
<div class="sect1" title="8. ç¿»è¯‘"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/apcs09.html.make3-APP-C-SECT-9"></a>8. ç¿»è¯‘</h1><h1 class="title"><a></a>8. TRANSLATION</h1></div></div></div><p>ç¿»è¯‘è¢«è§†ä¸ºä¸€ç§ä¿®æ”¹ï¼Œå› æ­¤æ‚¨å¯ä»¥æ ¹æ®ç¬¬ 4 èŠ‚çš„æ¡æ¬¾åˆ†å‘æ–‡æ¡£çš„ç¿»è¯‘ç‰ˆæœ¬ã€‚ç”¨ç¿»è¯‘æ›¿æ¢ä¸å˜éƒ¨åˆ†éœ€è¦èŽ·å¾—å…¶ç‰ˆæƒæ‰€æœ‰è€…çš„ç‰¹åˆ«è®¸å¯ï¼Œä½†é™¤äº†ä»¥ä¸‹å†…å®¹ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥åŒ…æ‹¬éƒ¨åˆ†æˆ–å…¨éƒ¨ä¸å˜éƒ¨åˆ†çš„ç¿»è¯‘è¿™äº›ä¸å˜éƒ¨åˆ†çš„åŽŸå§‹ç‰ˆæœ¬ã€‚æ‚¨å¯ä»¥åŒ…å«æœ¬è®¸å¯è¯çš„ç¿»è¯‘ä»¥åŠæ–‡æ¡£ä¸­çš„æ‰€æœ‰è®¸å¯è¯å£°æ˜Žä»¥åŠä»»ä½•ä¿è¯å…è´£å£°æ˜Žï¼Œå‰ææ˜¯æ‚¨è¿˜åŒ…å«æœ¬è®¸å¯è¯çš„åŽŸå§‹è‹±æ–‡ç‰ˆæœ¬ä»¥åŠè¿™äº›é€šçŸ¥å’Œå…è´£å£°æ˜Žçš„åŽŸå§‹ç‰ˆæœ¬ã€‚å¦‚æžœæœ¬è®¸å¯è¯æˆ–é€šçŸ¥æˆ–å…è´£å£°æ˜Žçš„ç¿»è¯‘ç‰ˆæœ¬ä¸ŽåŽŸå§‹ç‰ˆæœ¬ä¹‹é—´å­˜åœ¨åˆ†æ­§ï¼Œåˆ™ä»¥åŽŸå§‹ç‰ˆæœ¬ä¸ºå‡†ã€‚</p><p>Translation is considered a kind of modification, so you may
        distribute translations of the Document under the terms of section 4.
        Replacing Invariant Sections with translations requires special
        permission from their copyright holders, but you may include
        translations of some or all Invariant Sections in addition to the
        original versions of these Invariant Sections. You may include a
        translation of this License, and all the license notices in the
        Document, and any Warranty Disclaimers, provided that you also include
        the original English version of this License and the original versions
        of those notices and disclaimers. In case of a disagreement between
        the translation and the original version of this License or a notice
        or disclaimer, the original version will prevail.</p><p>å¦‚æžœæ–‡æ¡£ä¸­çš„æŸä¸ªéƒ¨åˆ†çš„æ ‡é¢˜ä¸ºâ€œè‡´è°¢â€ã€â€œå¥‰çŒ®â€æˆ–â€œåŽ†å²â€ï¼Œåˆ™ä¿ç•™å…¶æ ‡é¢˜ï¼ˆç¬¬ 1 èŠ‚ï¼‰çš„è¦æ±‚ï¼ˆç¬¬ 4 èŠ‚ï¼‰é€šå¸¸éœ€è¦æ›´æ”¹å®žé™…æ ‡é¢˜ã€‚</p><p>If a section in the Document is Entitled "Acknowledgements",
        "Dedications", or "History", the requirement (section 4) to Preserve
        its Title (section 1) will typically require changing the actual
        title.</p></div></div></div>
<div id="OEBPS/apcs10.html"><div>
<div class="sect1" title="9. ç»ˆæ­¢"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/apcs10.html.make3-APP-C-SECT-10"></a>9. ç»ˆæ­¢</h1><h1 class="title"><a></a>9. TERMINATION</h1></div></div></div><p>é™¤éžæœ¬è®¸å¯è¯æ˜Žç¡®è§„å®šï¼Œå¦åˆ™æ‚¨ä¸å¾—å¤åˆ¶ã€ä¿®æ”¹ã€å†è®¸å¯æˆ–åˆ†å‘æœ¬æ–‡æ¡£ã€‚ä»»ä½•å…¶ä»–å¤åˆ¶ã€ä¿®æ”¹ã€å†è®¸å¯æˆ–åˆ†å‘æœ¬æ–‡æ¡£çš„å°è¯•å‡æ— æ•ˆï¼Œå¹¶å°†è‡ªåŠ¨ç»ˆæ­¢æ‚¨åœ¨æœ¬è®¸å¯è¯ä¸‹çš„æƒåˆ©ã€‚ä½†æ˜¯ï¼Œæ ¹æ®æœ¬è®¸å¯è¯ä»Žæ‚¨é‚£é‡Œæ”¶åˆ°å‰¯æœ¬æˆ–æƒåˆ©çš„å„æ–¹åªè¦å®Œå…¨éµå®ˆè§„å®šï¼Œå…¶è®¸å¯è¯å°±ä¸ä¼šè¢«ç»ˆæ­¢ã€‚</p><p>You may not copy, modify, sublicense, or distribute the Document
        except as expressly provided for under this License. Any other attempt
        to copy, modify, sublicense or distribute the Document is void, and
        will automatically terminate your rights under this License. However,
        parties who have received copies, or rights, from you under this
        License will not have their licenses terminated so long as such
        parties remain in full compliance.</p></div></div></div>
<div id="OEBPS/apcs11.html"><div>
<div class="sect1" title="10. æœ¬è®¸å¯è¯çš„æœªæ¥ä¿®è®¢"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/apcs11.html.make3-APP-C-SECT-11"></a>10. æœ¬è®¸å¯è¯çš„æœªæ¥ä¿®è®¢</h1><h1 class="title"><a></a>10. FUTURE REVISIONS OF THIS LICENSE</h1></div></div></div><p>è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šå¯èƒ½ä¼šä¸æ—¶å‘å¸ƒ GNU è‡ªç”±æ–‡æ¡£è®¸å¯è¯çš„æ–°ä¿®è®¢ç‰ˆæœ¬ã€‚æ­¤ç±»æ–°ç‰ˆæœ¬åœ¨ç²¾ç¥žä¸Šä¸Žå½“å‰ç‰ˆæœ¬ç›¸ä¼¼ï¼Œä½†åœ¨è§£å†³æ–°é—®é¢˜æˆ–ç–‘è™‘æ–¹é¢å¯èƒ½åœ¨ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒã€‚è¯·å‚é˜…<a class="ulink" href="http://www.gnu.org/copyleft/">http://www.gnu.org/copyleft/</a>ã€‚</p><p>The Free Software Foundation may publish new, revised versions
        of the GNU Free Documentation License from time to time. Such new
        versions will be similar in spirit to the present version, but may
        differ in detail to address new problems or concerns. See <a class="ulink" href="http://www.gnu.org/copyleft/">http://www.gnu.org/copyleft/</a>.</p><p>æ¯ä¸ªç‰ˆæœ¬çš„è®¸å¯è¯éƒ½æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„ç‰ˆæœ¬å·ã€‚å¦‚æžœæ–‡æ¡£æŒ‡å®šæœ¬è®¸å¯è¯çš„ç‰¹å®šç¼–å·ç‰ˆæœ¬â€œæˆ–ä»»ä½•æ›´é«˜ç‰ˆæœ¬â€é€‚ç”¨äºŽå®ƒï¼Œæ‚¨å¯ä»¥é€‰æ‹©éµå¾ªè¯¥æŒ‡å®šç‰ˆæœ¬æˆ–ä»»ä½•å·²å‘å¸ƒçš„æ›´é«˜ç‰ˆæœ¬ï¼ˆä¸ä½œä¸ºè‰æ¡ˆï¼‰ç”±è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šåˆ¶å®šã€‚å¦‚æžœæ–‡æ¡£æ²¡æœ‰æŒ‡å®šæœ¬è®¸å¯è¯çš„ç‰ˆæœ¬å·ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä»»ä½•ç‰ˆæœ¬
        <a id="OEBPS/apcs11.html.make3-APP-C-ITERM-1636" class="indexterm"></a>æ›¾ç»ç”±è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šå‘å¸ƒè¿‡ï¼ˆä¸æ˜¯è‰ç¨¿ï¼‰ã€‚</p><p>Each version of the License is given a distinguishing version
        number. If the Document specifies that a particular numbered version
        of this License "or any later version" applies to it, you have the
        option of following the terms and conditions either of that specified
        version or of any later version that has been published (not as a
        draft) by the Free Software Foundation. If the Document does not
        specify a version number of this License, you may choose any version
        <a class="indexterm"></a>ever published (not as a
        draft) by the Free Software Foundation.</p></div></div></div>
<div id="OEBPS/ix01.html"><div>
<div class="index" title="æŒ‡æ•°"><div class="titlepage"><div><div><h1 class="title"><a id="OEBPS/ix01.html.id3179703"></a>æŒ‡æ•°</h1><h1 class="title"><a></a>Index</h1></div></div></div><div class="note" title="å…³äºŽæ•°å­—ç´¢å¼•çš„è¯´æ˜Ž"><h3 class="title">å…³äºŽæ•°å­—ç´¢å¼•çš„è¯´æ˜Ž</h3><h3 class="title">A note on the digital index</h3><p>ç´¢å¼•æ¡ç›®ä¸­çš„é“¾æŽ¥æ˜¾ç¤ºä¸ºè¯¥æ¡ç›®æ‰€åœ¨çš„éƒ¨åˆ†æ ‡é¢˜ã€‚ç”±äºŽæŸäº›éƒ¨åˆ†å…·æœ‰å¤šä¸ªç´¢å¼•æ ‡è®°ï¼Œå› æ­¤ä¸€ä¸ªæ¡ç›®å…·æœ‰å¤šä¸ªæŒ‡å‘åŒä¸€éƒ¨â€‹â€‹åˆ†çš„é“¾æŽ¥å¹¶ä¸ç½•è§ã€‚å•å‡»ä»»ä½•é“¾æŽ¥å°†ç›´æŽ¥è½¬åˆ°æ–‡æœ¬ä¸­å‡ºçŽ°æ ‡è®°çš„ä½ç½®ã€‚</p><p>A link in an index entry is displayed as the section title in which that entry appears. Because some sections have multiple index markers, it is not unusual for an entry to have several links to the same section. Clicking on any link will take you directly to the place in the text in which the marker appears.</p></div><div class="index"><div class="indexdiv"><h3>ç¬¦å·</h3><h3>Symbols</h3><dl><dt>$%è‡ªåŠ¨å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-910">è‡ªåŠ¨å˜é‡</a></dt><dt>$% automatic variable, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-910">Automatic Variables</a></dt><dt>$(OBJECTS) å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-956">é™æ€æ¨¡å¼è§„åˆ™</a></dt><dt>$(OBJECTS) variable, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-956">Static Pattern Rules</a></dt><dt>$* è‡ªåŠ¨å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-915">è‡ªåŠ¨å˜é‡</a></dt><dt>$* automatic variables, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-915">Automatic Variables</a></dt><dt>$+ è‡ªåŠ¨å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-914">è‡ªåŠ¨å˜é‡</a></dt><dt>$+ automatic variable, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-914">Automatic Variables</a></dt><dt>$&lt; è‡ªåŠ¨å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-911">è‡ªåŠ¨å˜é‡</a></dt><dt>$&lt; automatic variable, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-911">Automatic Variables</a></dt><dt>$ï¼Ÿè‡ªåŠ¨å˜é‡,<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-912">è‡ªåŠ¨å˜é‡</a></dt><dt>$? automatic variable, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-912">Automatic Variables</a></dt><dt>$@è‡ªåŠ¨å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-909">è‡ªåŠ¨å˜é‡</a></dt><dt>$@ automatic variable, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-909">Automatic Variables</a></dt><dt>$^è‡ªåŠ¨å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-913">è‡ªåŠ¨å˜é‡</a></dt><dt>$^ automatic variable, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-913">Automatic Variables</a></dt><dt>%ï¼ˆç™¾åˆ†æ¯”ï¼‰å­—ç¬¦ï¼Œæ¨¡å¼è§„åˆ™ï¼Œ<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-946">æ¨¡å¼</a></dt><dt>% (percent) character, pattern rules, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-946">The Patterns</a></dt><dt>+ï¼ˆåŠ ï¼‰å‘½ä»¤ä¿®é¥°ç¬¦ï¼Œ<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1321">å‘½ä»¤ä¿®é¥°ç¬¦</a></dt><dt>+ (plus) command modifier, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1321">Command Modifiers</a></dt><dt>+=ï¼ˆé™„åŠ ï¼‰è¿ç®—ç¬¦ï¼Œ<a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1057">å…¶ä»–ç±»åž‹çš„èµ‹å€¼</a></dt><dt>+= (append) operator, <a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1057">Other Types of Assignment</a></dt><dt>-ï¼ˆç ´æŠ˜å·ï¼‰å‘½ä»¤å‰ç¼€ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1318">å‘½ä»¤ä¿®é¥°ç¬¦</a></dt><dt>- (dash) command prefix, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1318">Command Modifiers</a></dt><dt>--always-make é€‰é¡¹ï¼Œ<a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1610">è¿è¡Œ make</a></dt><dt>--always-make option, <a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1610">Running make</a></dt><dt>--print-data-base é€‰é¡¹ï¼Œè°ƒè¯•å’Œï¼Œ<a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1589">--print-data-base</a></dt><dt>--print-data-base option, debugging and, <a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1589">â€”print-data-base</a></dt><dt>ï¼Ÿ ï¼ˆé—®å·ï¼‰é€šé…ç¬¦ï¼Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-849">é€šé…â€‹â€‹ç¬¦</a></dt><dt>? (question mark) wildcard, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-849">Wildcards</a></dt><dt>?=ï¼ˆæ¡ä»¶å˜é‡èµ‹å€¼è¿ç®—ç¬¦ï¼‰ï¼Œ<a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1055">å…¶ä»–ç±»åž‹çš„èµ‹å€¼</a></dt><dt>?= (conditional variable assignment operator), <a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1055">Other Types of Assignment</a></dt><dt>?= è¿ç®—ç¬¦ã€çŽ¯å¢ƒå˜é‡ã€<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1094">å˜é‡ä»Žä½•è€Œæ¥</a></dt><dt>?= operator, environment variables, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1094">Where Variables Come From</a></dt><dt>@å‘½ä»¤å‰ç¼€ã€echo å’Œ<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1315">å‘½ä»¤ä¿®é¥°ç¬¦</a></dt><dt>@ command prefix, echo and, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1315">Command Modifiers</a></dt><dt>@æ ‡å¿—ï¼Œæ€§èƒ½å’Œï¼Œ<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1542">ç¦ç”¨@</a></dt><dt>@ sign, performance and, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1542">Disabling @</a></dt><dt>^ï¼ˆæ³¢å½¢ç¬¦ï¼‰é€šé…ç¬¦ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-853">é€šé…ç¬¦</a></dt><dt>^ (tilde) wildcard, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-853">Wildcards</a></dt><dt><a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1041">å˜é‡ã€å˜é‡å’Œå®</a>ä¸­çš„ { }ï¼ˆèŠ±æ‹¬å·ï¼‰<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1041"></a></dt><dt>{ } (curly braces) in variables, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1041">Variables and Macros</a></dt></dl></div><div class="indexdiv"><h3>A</h3><h3>A</h3><dl><dt>add-manifest å‡½æ•°ã€jarã€<a class="indexterm" href="#OEBPS/ch09s04.html.make3-CHP-9-ITERM-1508">ç®¡ç† Jars</a></dt><dt>add-manifest function, jars, <a class="indexterm" href="#OEBPS/ch09s04.html.make3-CHP-9-ITERM-1508">Managing Jars</a></dt><dt>addprefix å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1234">æ–‡ä»¶åå‡½æ•°</a></dt><dt>addprefix function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1234">Filename Functions</a></dt><dt>addsuffix å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1230">æ–‡ä»¶åå‡½æ•°</a></dt><dt>addsuffix function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1230">Filename Functions</a></dt><dt>æ‰€æœ‰ç›®æ ‡ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-879">è™šå‡ç›®æ ‡</a></dt><dt>all target, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-879">Phony Targets</a></dt><dt>ALL_TREESå˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch08s04.html.make3-CHP-8-ITERM-1452">æ”¯æŒå¤šä¸ªäºŒå‰æ ‘</a></dt><dt>ALL_TREES variable, <a class="indexterm" href="#OEBPS/ch08s04.html.make3-CHP-8-ITERM-1452">Supporting Multiple Binary Trees</a></dt><dt>èš‚èšï¼ˆJavaï¼‰ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1475">èš‚èš</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1478">èš‚èš</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1480">èš‚èš</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1483">èš‚èš</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1486">èš‚èš</a></dt><dt>Ant (Java), <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1475">Ant</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1478">Ant</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1480">Ant</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1483">Ant</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1486">Ant</a></dt><dd><dl><dt>æž„å»ºæ–‡ä»¶ã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1478">Ant</a>ã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1483">Ant</a></dt><dd><dl><dt>mkdir ç¨‹åºã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1483">Ant</a></dt></dl></dd><dt>å¯ç§»æ¤æ€§ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1486">èš‚èš</a></dt><dt>ä»»åŠ¡ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1480">èš‚èš</a></dt></dl></dd><dd><dl><dt>build files, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1478">Ant</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1483">Ant</a></dt><dd><dl><dt>mkdir program, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1483">Ant</a></dt></dl></dd><dt>portability, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1486">Ant</a></dt><dt>tasks, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1480">Ant</a></dt></dl></dd><dt>ä»»ä½•è§’è‰²è§„åˆ™ï¼Œ<a class="indexterm" href="#OEBPS/ch01s03.html.make3-CHP-1-ITERM-816">æœ€å°åŒ–é‡å»º</a></dt><dt>any character rule, <a class="indexterm" href="#OEBPS/ch01s03.html.make3-CHP-1-ITERM-816">Minimizing Rebuilds</a></dt><dt>è¿½åŠ è¿ç®—ç¬¦ (+=)ã€<a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1058">å…¶ä»–ç±»åž‹çš„èµ‹å€¼</a></dt><dt>append operator (+=), <a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1058">Other Types of Assignment</a></dt><dt>ar å‘½ä»¤ã€å­˜æ¡£åº“ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1014">ç®¡ç†åº“</a></dt><dt>ar command, archive libraries, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1014">Managing Libraries</a></dt><dt>æ¡£æ¡ˆé¦†ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1011">å›¾ä¹¦é¦†ç®¡ç†</a></dt><dt>archive libraries, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1011">Managing Libraries</a></dt><dt>å½’æ¡£æˆå‘˜ã€è‡ªåŠ¨å˜é‡å’Œ<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-905">è‡ªåŠ¨å˜é‡</a></dt><dt>archive members, automatic variables and, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-905">Automatic Variables</a></dt><dt>å‚æ•°ã€ä½œä¸ºå†…ç½®å‡½æ•°çš„æ¨¡å¼ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1162">å†…ç½®å‡½æ•°</a></dt><dt>arguments, patterns as built-in functions, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1162">Built-in Functions</a></dt><dt>ç®—æœ¯ã€å¢žé‡ã€<a class="indexterm" href="#OEBPS/apbs02.html.make3-APP-B-ITERM-1633">ç®—æœ¯</a></dt><dt>arithmetic, increments, <a class="indexterm" href="#OEBPS/apbs02.html.make3-APP-B-ITERM-1633">Arithmetic</a></dt><dt>æ•°ç»„ã€æ–‡ä»¶æ•°ç»„å’Œå‘½ä»¤è¡Œé™åˆ¶ã€<a class="indexterm" href="#OEBPS/ch05s06.html.make3-CHP-5-ITERM-1362">å‘½ä»¤è¡Œé™åˆ¶</a></dt><dt>arrays, files array and command line limits, <a class="indexterm" href="#OEBPS/ch05s06.html.make3-CHP-5-ITERM-1362">Command-Line Limits</a></dt><dt>æ–­è¨€å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1251">æµç¨‹æŽ§åˆ¶</a></dt><dt>assert function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1251">Flow Control</a></dt><dt>automakeå·¥å…·ï¼Œ<a class="indexterm" href="#OEBPS/ch07s05.html.make3-CHP-7-ITERM-1441">Automake</a></dt><dt>automake tool, <a class="indexterm" href="#OEBPS/ch07s05.html.make3-CHP-7-ITERM-1441">Automake</a></dt><dt>è‡ªåŠ¨å˜é‡ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-893">ç©ºç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-900">è‡ªåŠ¨å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-903">è‡ªåŠ¨å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-906">è‡ªåŠ¨å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-907">è‡ªåŠ¨å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-931">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-932">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1095">å˜é‡æ¥è‡ªå“ªé‡Œ</a></dt><dt>automatic variables, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-893">Empty Targets</a>, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-900">Automatic Variables</a>, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-903">Automatic Variables</a>, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-906">Automatic Variables</a>, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-907">Automatic Variables</a>, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-931">Finding Files with VPATH and vpath</a>, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-932">Finding Files with VPATH and vpath</a>, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1095">Where Variables Come From</a></dt><dd><dl><dt>æ¡£æ¡ˆæˆå‘˜ã€<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-906">è‡ªåŠ¨å˜é‡</a></dt><dt>ç©ºç›®æ ‡å’Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-893">ç©ºç›®æ ‡</a></dt><dt>å…ˆå†³æ¡ä»¶ï¼Œ<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-907">è‡ªåŠ¨å˜é‡</a></dt><dt>ç›®æ ‡å’Œ<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-903">è‡ªåŠ¨å˜é‡</a></dt><dt>VPATH å’Œï¼Œ<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-931">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a></dt><dt>vpath å’Œï¼Œ<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-932">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a></dt></dl></dd><dd><dl><dt>archive members, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-906">Automatic Variables</a></dt><dt>empty targets and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-893">Empty Targets</a></dt><dt>prerequisites, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-907">Automatic Variables</a></dt><dt>targets and, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-903">Automatic Variables</a></dt><dt>VPATH and, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-931">Finding Files with VPATH and vpath</a></dt><dt>vpath and, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-932">Finding Files with VPATH and vpath</a></dt></dl></dd><dt>awk å‘½ä»¤ã€è™šå‡ç›®æ ‡å’Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-868">è™šå‡ç›®æ ‡</a></dt><dt>awk command, phony targets and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-868">Phony Targets</a></dt></dl></div><div class="indexdiv"><h3>ä¹™</h3><h3>B</h3><dl><dt>åŸºæœ¬åç§°å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1227">æ–‡ä»¶åå‡½æ•°</a></dt><dt>basename function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1227">Filename Functions</a></dt><dt>bash shellã€åŸºå‡†æµ‹è¯•å’Œ<a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1524">åŸºå‡†æµ‹è¯•</a></dt><dt>bash shell, benchmarking and, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1524">Benchmarking</a></dt><dt><a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1523">åŸºå‡†</a>æµ‹è¯•ã€åŸºå‡†<a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1525">æµ‹è¯•</a>ã€åŸºå‡†æµ‹è¯•ã€<a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1526">åŸºå‡†æµ‹è¯•</a>ã€åŸºå‡†æµ‹è¯•ã€åŸºå‡†æµ‹è¯•ã€<a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1528">åŸºå‡†</a><a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1530">æµ‹è¯•</a></dt><dt>benchmarking, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1523">Benchmarking</a>, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1525">Benchmarking</a>, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1526">Benchmarking</a>, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1528">Benchmarking</a>, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1530">Benchmarking</a></dt><dd><dl><dt>bash shellï¼Œ<a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1525">åŸºå‡†æµ‹è¯•</a></dt><dt>Cygwin å’Œ<a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1526">åŸºå‡†æµ‹è¯•</a></dt><dt>subst å‡½æ•°è°ƒç”¨å’Œ<a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1530">åŸºå‡†æµ‹è¯•</a></dt><dt>å˜é‡åˆ†é…é€Ÿåº¦ï¼Œ<a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1528">åŸºå‡†æµ‹è¯•</a></dt></dl></dd><dd><dl><dt>bash shell, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1525">Benchmarking</a></dt><dt>Cygwin and, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1526">Benchmarking</a></dt><dt>subst function calls and, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1530">Benchmarking</a></dt><dt>variable assignment speed, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1528">Benchmarking</a></dt></dl></dd><dt>äºŒå‰æ ‘ã€<a class="indexterm" href="#OEBPS/ch06s03.html.make3-CHP-6-ITERM-1405">è¦æ±‚</a>ã€<a class="indexterm" href="#OEBPS/ch06s04.html.make3-CHP-6-ITERM-1407">æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€</a>ã€<a class="indexterm" href="#OEBPS/ch08.html.make3-CHP-8-ITERM-1443">åˆ†ç¦»æºä»£ç å’ŒäºŒè¿›åˆ¶æ–‡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch08.html.make3-CHP-8-ITERM-1444">å›°éš¾çš„æ–¹æ³•</a>ã€<a class="indexterm" href="#OEBPS/ch08s04.html.make3-CHP-8-ITERM-1451">æ”¯æŒå¤šä¸ªäºŒå‰æ ‘</a>ã€<a class="indexterm" href="#OEBPS/ch08s04.html.make3-CHP-8-ITERM-1454">æ”¯æŒå¤šä¸ªäºŒå‰æ ‘</a>ã€<a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1460">éƒ¨åˆ†æºæ ‘</a></dt><dt>binary trees, <a class="indexterm" href="#OEBPS/ch06s03.html.make3-CHP-6-ITERM-1405">Requirements</a>, <a class="indexterm" href="#OEBPS/ch06s04.html.make3-CHP-6-ITERM-1407">Filesystem Layout</a>, <a class="indexterm" href="#OEBPS/ch08.html.make3-CHP-8-ITERM-1443">Separating Source and Binary</a>, <a class="indexterm" href="#OEBPS/ch08.html.make3-CHP-8-ITERM-1444">The Hard Way</a>, <a class="indexterm" href="#OEBPS/ch08s04.html.make3-CHP-8-ITERM-1451">Supporting Multiple Binary Trees</a>, <a class="indexterm" href="#OEBPS/ch08s04.html.make3-CHP-8-ITERM-1454">Supporting Multiple Binary Trees</a>, <a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1460">Partial Source Trees</a></dt><dd><dl><dt>ALL_TREESå˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch08s04.html.make3-CHP-8-ITERM-1454">æ”¯æŒå¤šäºŒå‰æ ‘</a></dt><dt>æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€å’Œ<a class="indexterm" href="#OEBPS/ch06s04.html.make3-CHP-6-ITERM-1407">æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€</a></dt><dt>multipleï¼Œ<a class="indexterm" href="#OEBPS/ch08s04.html.make3-CHP-8-ITERM-1451">æ”¯æŒå¤šä¸ªäºŒå‰æ ‘</a></dt><dt>æœç´¢ï¼Œ<a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1460">éƒ¨åˆ†æºæ ‘</a></dt><dt>åˆ†å¼€ï¼Œ<a class="indexterm" href="#OEBPS/ch06s03.html.make3-CHP-6-ITERM-1405">è¦æ±‚</a></dt><dt>æºæ ‘åˆ†ç¦»ï¼Œ<a class="indexterm" href="#OEBPS/ch08.html.make3-CHP-8-ITERM-1443">åˆ†ç¦»æºä»£ç å’ŒäºŒè¿›åˆ¶æ–‡ä»¶</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch08.html.make3-CHP-8-ITERM-1444">å›°éš¾çš„æ–¹æ³•</a></dt></dl></dd><dd><dl><dt>ALL_TREES variables, <a class="indexterm" href="#OEBPS/ch08s04.html.make3-CHP-8-ITERM-1454">Supporting Multiple Binary Trees</a></dt><dt>filesystem layout and, <a class="indexterm" href="#OEBPS/ch06s04.html.make3-CHP-6-ITERM-1407">Filesystem Layout</a></dt><dt>multiple, <a class="indexterm" href="#OEBPS/ch08s04.html.make3-CHP-8-ITERM-1451">Supporting Multiple Binary Trees</a></dt><dt>searches, <a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1460">Partial Source Trees</a></dt><dt>separate, <a class="indexterm" href="#OEBPS/ch06s03.html.make3-CHP-6-ITERM-1405">Requirements</a></dt><dt>source tree separation, <a class="indexterm" href="#OEBPS/ch08.html.make3-CHP-8-ITERM-1443">Separating Source and Binary</a>, <a class="indexterm" href="#OEBPS/ch08.html.make3-CHP-8-ITERM-1444">The Hard Way</a></dt></dl></dd><dt>book makefileã€<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1551">Book Makefile</a>ã€<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1552">Book Makefile</a>ã€<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1556">XML é¢„å¤„ç†</a>ã€<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1559">XML é¢„å¤„ç†</a>ã€<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1561">ç”Ÿæˆè¾“å‡º</a>ã€<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1564">éªŒè¯æº</a></dt><dt>book makefile, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1551">The Book Makefile</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1552">The Book Makefile</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1556">XML Preprocessing</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1559">XML Preprocessing</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1561">Generating Output</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1564">Validating the Source</a></dt><dd><dl><dt>m4 å®å’Œ<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1559">XML é¢„å¤„ç†</a></dt><dt>è¾“å‡ºç”Ÿæˆï¼Œ<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1561">ç”Ÿæˆè¾“å‡º</a></dt><dt>æºéªŒè¯ï¼Œ<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1564">éªŒè¯æº</a></dt><dt>XML é¢„å¤„ç†, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1556">XML é¢„å¤„ç†</a></dt></dl></dd><dd><dl><dt>m4 macros and, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1559">XML Preprocessing</a></dt><dt>output generation, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1561">Generating Output</a></dt><dt>source validation, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1564">Validating the Source</a></dt><dt>XML preprocessing, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1556">XML Preprocessing</a></dt></dl></dd><dt>ç“¶é¢ˆã€<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1533">è¯†åˆ«å’Œå¤„ç†ç“¶é¢ˆ</a>ã€<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1535">è¯†åˆ«å’Œå¤„ç†ç“¶é¢ˆ</a></dt><dt>bottlenecks, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1533">Identifying and Handling Bottlenecks</a>, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1535">Identifying and Handling Bottlenecks</a></dt><dd><dl><dt>ä¾èµ–å…³ç³»ä»¥åŠ<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1535">è¯†åˆ«å’Œå¤„ç†ç“¶é¢ˆ</a></dt></dl></dd><dd><dl><dt>dependencies and, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1535">Identifying and Handling Bottlenecks</a></dt></dl></dd><dt>æž„å»ºæ–‡ä»¶ã€XMLã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1476">Ant</a></dt><dt>build files, XML, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1476">Ant</a></dt><dt>æž„å»ºç›®æ ‡ã€é€’å½’ make ä»¥åŠ<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1379">æž„å»ºå…¶ä»–ç›®æ ‡</a></dt><dt>build targets, recursive make and, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1379">Building Other Targets</a></dt><dt>build-classpath å‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1503">è®¾ç½® CLASSPATH</a></dt><dt>build-classpath function, <a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1503">Setting CLASSPATH</a></dt><dt>æž„å»ºã€<a class="indexterm" href="#OEBPS/ch06s05.html.make3-CHP-6-ITERM-1409">è‡ªåŠ¨åŒ–æž„å»ºå’Œæµ‹è¯•</a>ã€<a class="indexterm" href="#OEBPS/ch06s05.html.make3-CHP-6-ITERM-1410">è‡ªåŠ¨åŒ–æž„å»ºå’Œæµ‹è¯•</a>ã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1576">é…ç½®ä¸Žæž„å»º</a></dt><dt>builds, <a class="indexterm" href="#OEBPS/ch06s05.html.make3-CHP-6-ITERM-1409">Automating Builds and Testing</a>, <a class="indexterm" href="#OEBPS/ch06s05.html.make3-CHP-6-ITERM-1410">Automating Builds and Testing</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1576">Configuration Versus Building</a></dt><dd><dl><dt>è‡ªåŠ¨åŒ–ï¼Œ<a class="indexterm" href="#OEBPS/ch06s05.html.make3-CHP-6-ITERM-1409">è‡ªåŠ¨åŒ–æž„å»ºå’Œæµ‹è¯•</a></dt><dt>Linux å†…æ ¸ makefileï¼Œ<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1576">é…ç½®ä¸Žæž„å»º</a></dt><dt>æµ‹è¯•ã€<a class="indexterm" href="#OEBPS/ch06s05.html.make3-CHP-6-ITERM-1410">è‡ªåŠ¨åŒ–æž„å»ºå’Œæµ‹è¯•</a></dt></dl></dd><dd><dl><dt>automation, <a class="indexterm" href="#OEBPS/ch06s05.html.make3-CHP-6-ITERM-1409">Automating Builds and Testing</a></dt><dt>Linux kernel makefile, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1576">Configuration Versus Building</a></dt><dt>testing, <a class="indexterm" href="#OEBPS/ch06s05.html.make3-CHP-6-ITERM-1410">Automating Builds and Testing</a></dt></dl></dd><dt>å†…ç½®å‡½æ•°,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1154">å†…ç½®å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1275">ä¸å¤ªé‡è¦çš„æ‚é¡¹å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1157">å†…ç½®å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1160">å†…ç½®å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1164">å­—ç¬¦ä¸²å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1211">æ–‡ä»¶åå‡½æ•°</a></dt><dt>built-in functions, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1154">Built-in Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1275">Less Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1157">Built-in Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1160">Built-in Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1164">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1211">Filename Functions</a></dt><dd><dl><dt>æ–‡ä»¶åå’Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1211">æ–‡ä»¶åå‡½æ•°</a></dt><dt>æ¨¡å¼ä½œä¸ºå‚æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1160">å†…ç½®å‡½æ•°</a></dt><dt>å­—ç¬¦ä¸²å‡½æ•°,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1164">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>è¯­æ³•ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1157">å†…ç½®å‡½æ•°</a></dt></dl></dd><dd><dl><dt>filenames and, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1211">Filename Functions</a></dt><dt>patterns as arguments, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1160">Built-in Functions</a></dt><dt>string functions, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1164">String Functions</a></dt><dt>syntax, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1157">Built-in Functions</a></dt></dl></dd><dt>å†…ç½®è§„åˆ™ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-943">æ¨¡å¼è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-944">æ¨¡å¼è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-968">ä½¿ç”¨éšå¼è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-979">è§„åˆ™ç»“æž„</a></dt><dt>built-in rules, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-943">Pattern Rules</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-944">Pattern Rules</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-968">Working with Implicit Rules</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-979">Rule Structure</a></dt><dd><dl><dt>ï¼ˆå¦è§è§„åˆ™ï¼‰</dt><dt>éšå¼è§„åˆ™ï¼Œ<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-968">ä½¿ç”¨éšå¼è§„åˆ™</a></dt><dt>å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-979">è§„åˆ™ç»“æž„</a></dt></dl></dd><dd><dl><dt>(see also rules)</dt><dt>implicit rules, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-968">Working with Implicit Rules</a></dt><dt>variables, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-979">Rule Structure</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>C</h3><h3>C</h3><dl><dt>-C ç›®å½•é€‰é¡¹ï¼Œ<a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1611">è¿è¡Œ make</a></dt><dt>-C directory
                option, <a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1611">Running make</a></dt><dt>è°ƒç”¨å‡½æ•°ã€é€šé…ç¬¦å’Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-858">é€šé…ç¬¦</a></dt><dt>calling functions, wildcards and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-858">Wildcards</a></dt><dt>å›ºå®šåºåˆ—ã€<a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1060">å®</a>ï¼ˆè¯·å‚é˜…å®ï¼‰</dt><dt>canned sequences, <a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1060">Macros</a> (see macros)</dt><dt><a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1035">å˜é‡ã€å˜é‡å’Œå®</a>ä¸­åŒºåˆ†å¤§å°å†™<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1035"></a></dt><dt>case-sensitivity in variables, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1035">Variables and Macros</a></dt><dt>é“¾æŽ¥è§„åˆ™ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-940">æ¨¡å¼è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-971">ä½¿ç”¨éšå¼è§„åˆ™</a></dt><dt>chaining rules, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-940">Pattern Rules</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-971">Working with Implicit Rules</a></dt><dd><dl><dt>ä¸­é—´æ–‡ä»¶å’Œ<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-971">ä½¿ç”¨éšå¼è§„åˆ™</a></dt></dl></dd><dd><dl><dt>intermediate files and, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-971">Working with Implicit Rules</a></dt></dl></dd><dt>å­—ç¬¦ç±»ã€é€šé…ç¬¦å’Œã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-851">é€šé…ç¬¦</a></dt><dt>character classes, wildcards and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-851">Wildcards</a></dt><dt><a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1033">å˜é‡ã€å˜é‡å’Œå®</a>ä¸­çš„å­—ç¬¦<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1033"></a></dt><dt>characters in variables, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1033">Variables and Macros</a></dt><dt>æ£€æŸ¥ç›®æ ‡ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-885">è™šå‡ç›®æ ‡</a></dt><dt>check target, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-885">Phony Targets</a></dt><dt>å¾ªçŽ¯å¼•ç”¨ã€åº“ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1026">ä½¿ç”¨åº“ä½œä¸ºå…ˆå†³æ¡ä»¶</a></dt><dt>circular references, libraries, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1026">Using Libraries as Prerequisites</a></dt><dt>å¾ªçŽ¯æ€§ã€librairesã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1027">ä½¿ç”¨åº“ä½œä¸ºå…ˆå†³æ¡ä»¶</a></dt><dt>circularities, libraires, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1027">Using Libraries as Prerequisites</a></dt><dt>CLASSPATH å˜é‡ã€Java makefileã€<a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1498">è®¾ç½® CLASSPATH</a></dt><dt>CLASSPATH variable, Java makefile, <a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1498">Setting CLASSPATH</a></dt><dt>å¹²å‡€ç›®æ ‡ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-881">è™šå‡ç›®æ ‡</a></dt><dt>clean target, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-881">Phony Targets</a></dt><dt>ä»£ç ã€<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1383">é¿å…é‡å¤ä»£ç </a>ã€<a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1593">è‰¯å¥½ç¼–ç å®žè·µ</a>ã€<a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1595">é˜²å¾¡æ€§ç¼–ç </a></dt><dt>code, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1383">Avoiding Duplicate Code</a>, <a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1593">Good Coding Practices</a>, <a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1595">Defensive Coding</a></dt><dd><dl><dt>è°ƒè¯•ã€<a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1593">è‰¯å¥½ç¼–ç å®žè·µ</a>ã€<a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1595">é˜²å¾¡æ€§ç¼–ç </a></dt><dd><dl><dt>é˜²å¾¡æ€§ç¼–ç ,<a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1595">é˜²å¾¡æ€§ç¼–ç </a></dt><dt>ä¸ºã€Š<a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1593">è‰¯å¥½ç¼–ç å®žè·µã€‹å†™ä½œ</a></dt></dl></dd><dt>å¤åˆ¶ã€é€’å½’ make ä»¥åŠ<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1383">é¿å…é‡å¤ä»£ç </a></dt></dl></dd><dd><dl><dt>debugging, <a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1593">Good Coding Practices</a>, <a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1595">Defensive Coding</a></dt><dd><dl><dt>defensive coding, <a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1595">Defensive Coding</a></dt><dt>writing for, <a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1593">Good Coding Practices</a></dt></dl></dd><dt>duplicating, recursive make and, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1383">Avoiding Duplicate Code</a></dt></dl></dd><dt>å‘½ä»¤è„šæœ¬ã€<a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-821">åŸºæœ¬ Makefile è¯­æ³•</a>ã€<a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-822">åŸºæœ¬ Makefile è¯­æ³•</a>ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1302">è§£æžå‘½ä»¤</a>ã€<a class="indexterm" href="#OEBPS/ch05s05.html.make3-CHP-5-ITERM-1357">è¯„ä¼°å‘½ä»¤</a>ã€<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1604">å‘½ä»¤è„šæœ¬ä¸­çš„é”™è¯¯</a></dt><dt>command scripts, <a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-821">Basic Makefile Syntax</a>, <a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-822">Basic Makefile Syntax</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1302">Parsing Commands</a>, <a class="indexterm" href="#OEBPS/ch05s05.html.make3-CHP-5-ITERM-1357">Evaluating Commands</a>, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1604">Errors in Command Scripts</a></dt><dd><dl><dt>ï¼ˆå¦è¯·å‚é˜…è„šæœ¬ï¼‰</dt><dt>é”™è¯¯æ¶ˆæ¯ã€<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1604">å‘½ä»¤è„šæœ¬ä¸­çš„é”™è¯¯</a></dt><dt>è¯„ä¼°ï¼Œ<a class="indexterm" href="#OEBPS/ch05s05.html.make3-CHP-5-ITERM-1357">è¯„ä¼°å‘½ä»¤</a></dt><dt>è§£æžå’Œ<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1302">è§£æžå‘½ä»¤</a></dt></dl></dd><dd><dl><dt>(see also scripts)</dt><dt>error messages, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1604">Errors in Command Scripts</a></dt><dt>evaluation, <a class="indexterm" href="#OEBPS/ch05s05.html.make3-CHP-5-ITERM-1357">Evaluating Commands</a></dt><dt>parsing and, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1302">Parsing Commands</a></dt></dl></dd><dt>å‘½ä»¤è¡Œ,<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-793">å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile</a> ,<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1089">å˜é‡æ¥è‡ªå“ªé‡Œ</a>,<a class="indexterm" href="#OEBPS/ch05s02.html.make3-CHP-5-ITERM-1334">ä½¿ç”¨å“ªä¸ª Shell</a> ,<a class="indexterm" href="#OEBPS/ch05s06.html.make3-CHP-5-ITERM-1358">å‘½ä»¤è¡Œé™åˆ¶</a>,<a class="indexterm" href="#OEBPS/ch05s06.html.make3-CHP-5-ITERM-1359">å‘½ä»¤è¡Œé™åˆ¶</a>,<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1371">å‘½ä»¤è¡Œé€‰é¡¹</a>,<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1572">å‘½ä»¤è¡Œé€‰é¡¹</a>,<a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1587">å‘½ä»¤è¡Œé€‰é¡¹</a></dt><dt>command-line, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-793">How to Write a Simple Makefile</a>, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1089">Where Variables Come From</a>, <a class="indexterm" href="#OEBPS/ch05s02.html.make3-CHP-5-ITERM-1334">Which Shell to Use</a>, <a class="indexterm" href="#OEBPS/ch05s06.html.make3-CHP-5-ITERM-1358">Command-Line Limits</a>, <a class="indexterm" href="#OEBPS/ch05s06.html.make3-CHP-5-ITERM-1359">Command-Line Limits</a>, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1371">Command-Line Options</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1572">Command-Line Options</a>, <a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1587">Command-Line Options</a></dt><dd><dl><dt>è°ƒè¯•é€‰é¡¹ã€<a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1587">å‘½ä»¤è¡Œé€‰é¡¹</a></dt><dt>é™åˆ¶,<a class="indexterm" href="#OEBPS/ch05s06.html.make3-CHP-5-ITERM-1358">å‘½ä»¤è¡Œé™åˆ¶</a>,<a class="indexterm" href="#OEBPS/ch05s06.html.make3-CHP-5-ITERM-1359">å‘½ä»¤è¡Œé™åˆ¶</a></dt><dd><dl><dt>echo å‘½ä»¤è¡Œï¼Œ<a class="indexterm" href="#OEBPS/ch05s06.html.make3-CHP-5-ITERM-1359">å‘½ä»¤è¡Œé™åˆ¶</a></dt></dl></dd><dt>Linux å†…æ ¸ makefile é€‰é¡¹ã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1572">å‘½ä»¤è¡Œé€‰é¡¹</a></dt><dt>é€’å½’ make andï¼Œ<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1371">å‘½ä»¤è¡Œé€‰é¡¹</a></dt><dt>å­ shellï¼Œ<a class="indexterm" href="#OEBPS/ch05s02.html.make3-CHP-5-ITERM-1334">ä½¿ç”¨å“ªä¸ª Shell</a></dt><dt>ç›®æ ‡ä½œä¸ºå‚æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-793">å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile</a></dt><dt>å˜é‡å®šä¹‰ä»¥åŠ<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1089">å˜é‡ä»Žä½•è€Œæ¥</a></dt></dl></dd><dd><dl><dt>debugging options, <a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1587">Command-Line Options</a></dt><dt>limits, <a class="indexterm" href="#OEBPS/ch05s06.html.make3-CHP-5-ITERM-1358">Command-Line Limits</a>, <a class="indexterm" href="#OEBPS/ch05s06.html.make3-CHP-5-ITERM-1359">Command-Line Limits</a></dt><dd><dl><dt>echo command line, <a class="indexterm" href="#OEBPS/ch05s06.html.make3-CHP-5-ITERM-1359">Command-Line Limits</a></dt></dl></dd><dt>Linux kernel makefile options, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1572">Command-Line Options</a></dt><dt>recursive make and, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1371">Command-Line Options</a></dt><dt>subshells, <a class="indexterm" href="#OEBPS/ch05s02.html.make3-CHP-5-ITERM-1334">Which Shell to Use</a></dt><dt>targets as arguments, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-793">How to Write a Simple Makefile</a></dt><dt>variable definition and, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1089">Where Variables Come From</a></dt></dl></dd><dt>å‘½ä»¤,<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-803">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a>,<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-804">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a>,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-871">å‡ç›®æ ‡</a>,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-872">å‡ç›®æ ‡</a>,<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-988">ä¸€ä¸ªç®€å•çš„å¸®åŠ©å‘½ä»¤</a>,<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1015">ç®¡ç†åº“</a>,<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1077">æ‰©å±•å˜é‡æ—¶</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1300">è§£æžå‘½ä»¤</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1305">è§£æžå‘½ä»¤</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1306">è§£æžå‘½ä»¤</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1309">è¿žç»­é•¿å‘½ä»¤</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1311">è¿žç»­é•¿å‘½ä»¤</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1313">å‘½ä»¤ä¿®é¥°ç¬¦</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1316">å‘½ä»¤ä¿®é¥°ç¬¦</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1319">å‘½ä»¤ä¿®é¥°ç¬¦</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1322">å‘½ä»¤ä¿®é¥°ç¬¦</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1326">é”™è¯¯</a><a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1324">å’Œä¸­æ–­</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1330">é”™è¯¯å’Œä¸­æ–­</a>,é”™è¯¯å’Œä¸­æ–­,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1331">é”™è¯¯å’Œä¸­æ–­</a>,<a class="indexterm" href="#OEBPS/ch05s03.html.make3-CHP-5-ITERM-1338">ç©ºå‘½ä»¤</a>,<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1339">å‘½ä»¤çŽ¯å¢ƒ</a>,<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1341">å‘½ä»¤çŽ¯å¢ƒ</a>,<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1345">å‘½ä»¤çŽ¯å¢ƒ</a>,<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1349">å‘½ä»¤çŽ¯å¢ƒ</a>,<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1608">è¦†ç›–ç›®æ ‡å‘½ä»¤</a><a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1326"></a><a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1330"></a><a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1331"></a><a class="indexterm" href="#OEBPS/ch05s03.html.make3-CHP-5-ITERM-1338"></a><a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1339"></a><a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1341"></a><a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1345"></a><a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1349"></a><a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1608"></a></dt><dt>commands, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-803">Targets and Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-804">Targets and Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-871">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-872">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-988">A Simple Help Command</a>, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1015">Managing Libraries</a>, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1077">When Variables Are Expanded</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1300">Parsing Commands</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1305">Parsing Commands</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1306">Parsing Commands</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1309">Continuing Long Commands</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1311">Continuing Long Commands</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1313">Command Modifiers</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1316">Command Modifiers</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1319">Command Modifiers</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1322">Command Modifiers</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1324">Errors and Interrupts</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1326">Errors and Interrupts</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1330">Errors and Interrupts</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1331">Errors and Interrupts</a>, <a class="indexterm" href="#OEBPS/ch05s03.html.make3-CHP-5-ITERM-1338">Empty Commands</a>, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1339">Command Environment</a>, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1341">Command Environment</a>, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1345">Command Environment</a>, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1349">Command Environment</a>, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1608">Overriding Commands for Target</a></dt><dd><dl><dt>arï¼ˆæ¡£æ¡ˆåº“ï¼‰ï¼Œ<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1015">ç®¡ç†å›¾ä¹¦é¦†</a></dt><dt>awkã€è™šå‡ç›®æ ‡å’Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-872">è™šå‡ç›®æ ‡</a></dt><dt>dfã€è™šå‡ç›®æ ‡å’Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-871">è™šå‡ç›®æ ‡</a></dt><dt>ç©ºï¼Œ<a class="indexterm" href="#OEBPS/ch05s03.html.make3-CHP-5-ITERM-1338">ç©ºå‘½ä»¤</a></dt><dt>çŽ¯å¢ƒã€<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1339">å‘½ä»¤çŽ¯å¢ƒ</a>ã€<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1341">å‘½ä»¤çŽ¯å¢ƒ</a>ã€<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1345">å‘½ä»¤çŽ¯å¢ƒ</a>ã€<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1349">å‘½ä»¤çŽ¯å¢ƒ</a></dt><dd><dl><dt>æ–‡ä»¶æè¿°ç¬¦ã€<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1349">å‘½ä»¤çŽ¯å¢ƒ</a></dt><dt>MAKEFLAGS å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1341">å‘½ä»¤çŽ¯å¢ƒ</a></dt><dt>MAKELEVEL å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1345">å‘½ä»¤çŽ¯å¢ƒ</a></dt></dl></dd><dt>å¿½ç•¥<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1319">å‘½ä»¤ä¿®é¥°ç¬¦ä¸­çš„é”™è¯¯</a></dt><dt>helpï¼Œ<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-988">ä¸€ä¸ªç®€å•çš„å¸®åŠ©å‘½ä»¤</a></dt><dt>é•¿ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1311">è¿žç»­çš„é•¿å‘½ä»¤</a></dt><dt>åˆ¶ä½œã€æ‰§è¡Œé¡ºåºã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-803">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a></dt><dt>makefileã€æ‰§è¡Œé¡ºåºã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-804">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a></dt><dt>å¤šè¡Œã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1331">é”™è¯¯å’Œä¸­æ–­</a></dt><dt>æ— æ“ä½œã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1330">é”™è¯¯å’Œä¸­æ–­</a></dt><dt>é€‰é¡¹ã€é”™è¯¯ä»¥åŠ<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1326">é”™è¯¯å’Œä¸­æ–­</a></dt><dt>è§£æž,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1300">è§£æžå‘½ä»¤</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1305">è§£æžå‘½ä»¤</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1306">è§£æžå‘½ä»¤</a></dt><dd><dl><dt>å‘½ä»¤è„šæœ¬å’Œ<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1305">è§£æžå‘½ä»¤</a></dt><dt>ç¼–è¾‘å™¨å’Œ<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1306">è§£æžå‘½ä»¤</a></dt></dl></dd><dt>å‰ç¼€,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1313">å‘½ä»¤ä¿®é¥°ç¬¦</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1316">å‘½ä»¤ä¿®é¥°ç¬¦</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1322">å‘½ä»¤ä¿®é¥°ç¬¦</a></dt><dd><dl><dt>+ï¼ˆåŠ å·ï¼‰ï¼Œ<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1322">å‘½ä»¤ä¿®é¥°ç¬¦</a></dt><dt>-ï¼ˆç ´æŠ˜å·ï¼‰ï¼Œ<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1316">å‘½ä»¤ä¿®é¥°ç¬¦</a></dt><dt>@,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1313">å‘½ä»¤ä¿®é¥°ç¬¦</a></dt></dl></dd><dt>shellã€åºåˆ—ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1309">è¿žç»­é•¿å‘½ä»¤</a></dt><dt>çŠ¶æ€ç ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1324">é”™è¯¯å’Œä¸­æ–­</a></dt><dt>ç›®æ ‡ã€è¦†ç›–ã€<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1608">ç›®æ ‡çš„è¦†ç›–å‘½ä»¤</a></dt><dt>å˜é‡æ‰©å±•ï¼Œ<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1077">å½“å˜é‡æ‰©å±•æ—¶</a></dt></dl></dd><dd><dl><dt>ar (archive library), <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1015">Managing Libraries</a></dt><dt>awk, phony targets and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-872">Phony Targets</a></dt><dt>df, phony targets and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-871">Phony Targets</a></dt><dt>empty, <a class="indexterm" href="#OEBPS/ch05s03.html.make3-CHP-5-ITERM-1338">Empty Commands</a></dt><dt>environments, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1339">Command Environment</a>, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1341">Command Environment</a>, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1345">Command Environment</a>, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1349">Command Environment</a></dt><dd><dl><dt>file descriptors, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1349">Command Environment</a></dt><dt>MAKEFLAGS variable, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1341">Command Environment</a></dt><dt>MAKELEVEL variable, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1345">Command Environment</a></dt></dl></dd><dt>errors in, ignoring, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1319">Command Modifiers</a></dt><dt>help, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-988">A Simple Help Command</a></dt><dt>long, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1311">Continuing Long Commands</a></dt><dt>make, execution order, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-803">Targets and Prerequisites</a></dt><dt>makefile, execution order, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-804">Targets and Prerequisites</a></dt><dt>multiline, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1331">Errors and Interrupts</a></dt><dt>no-op, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1330">Errors and Interrupts</a></dt><dt>options, errors and, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1326">Errors and Interrupts</a></dt><dt>parsing, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1300">Parsing Commands</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1305">Parsing Commands</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1306">Parsing Commands</a></dt><dd><dl><dt>command scripts and, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1305">Parsing Commands</a></dt><dt>editors and, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1306">Parsing Commands</a></dt></dl></dd><dt>prefixes, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1313">Command Modifiers</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1316">Command Modifiers</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1322">Command Modifiers</a></dt><dd><dl><dt>+ (plus), <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1322">Command Modifiers</a></dt><dt>- (dash), <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1316">Command Modifiers</a></dt><dt>@, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1313">Command Modifiers</a></dt></dl></dd><dt>shell, sequences, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1309">Continuing Long Commands</a></dt><dt>status code, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1324">Errors and Interrupts</a></dt><dt>targets, overriding, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1608">Overriding Commands for Target</a></dt><dt>variable expansion, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1077">When Variables Are Expanded</a></dt></dl></dd><dt>æ³¨é‡Šï¼Œ<a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-823">åŸºæœ¬ Makefile è¯­æ³•</a></dt><dt>comments, <a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-823">Basic Makefile Syntax</a></dt><dt>å•†ä¸šå¼€å‘æ¨¡åž‹ï¼Œ<a class="indexterm" href="#OEBPS/ch06s03.html.make3-CHP-6-ITERM-1402">å¤§åž‹ç³»ç»Ÿçš„ç»„ä»¶</a></dt><dt>commercial development model, <a class="indexterm" href="#OEBPS/ch06s03.html.make3-CHP-6-ITERM-1402">Components of Large Systems</a></dt><dt>ç¼–è¯‘ bean å‡½æ•° (Java)ã€<a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1515">Enterprise JavaBeans</a></dt><dt>compile-bean function (Java), <a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1515">Enterprise JavaBeans</a></dt><dt>è®¡ç®—å˜é‡ã€æ–­è¨€å‡½æ•°å’Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1254">æµç¨‹æŽ§åˆ¶</a></dt><dt>computed variables, assert function and, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1254">Flow Control</a></dt><dt>æ¡ä»¶æŒ‡ä»¤ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1104">æ¡ä»¶å¹¶åŒ…æ‹¬å¤„ç†</a>ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1109">æ¡ä»¶å¹¶åŒ…æ‹¬å¤„ç†</a>ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1110">æ¡ä»¶å¹¶åŒ…æ‹¬å¤„ç†</a></dt><dt>conditional directives, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1104">Conditional and include Processing</a>, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1109">Conditional and include Processing</a>, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1110">Conditional and include Processing</a></dt><dd><dl><dt>ifeqã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1109">æ¡ä»¶å’ŒåŒ…å«å¤„ç†</a></dt><dt>ifneq æŒ‡ä»¤ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1110">æ¡ä»¶å’ŒåŒ…å«å¤„ç†</a></dt><dt>è¯­æ³•ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1104">æ¡ä»¶å’ŒåŒ…å«å¤„ç†</a></dt></dl></dd><dd><dl><dt>ifeq, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1109">Conditional and include Processing</a></dt><dt>ifneq directive, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1110">Conditional and include Processing</a></dt><dt>syntax, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1104">Conditional and include Processing</a></dt></dl></dd><dt>æ¡ä»¶å¤„ç†æŒ‡ä»¤ï¼Œ<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1099">Conditional å’Œ include å¤„ç†</a></dt><dt>conditional processing directives, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1099">Conditional and include Processing</a></dt><dt>æ¡ä»¶å˜é‡èµ‹å€¼è¿ç®—ç¬¦ (?=)ã€<a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1053">å…¶ä»–ç±»åž‹çš„èµ‹å€¼</a></dt><dt>conditional variable assignment operator (?=), <a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1053">Other Types of Assignment</a></dt><dt>é…ç½® Linux å†…æ ¸ makefileï¼Œ<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1575">é…ç½®ä¸Žæž„å»º</a></dt><dt>configuring Linux kernel makefile, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1575">Configuration Versus Building</a></dt><dt>å¸¸é‡ã€ç”¨æˆ·è‡ªå®šä¹‰å˜é‡ã€<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1043">å˜é‡å’Œå®</a></dt><dt>constants, user-customized variables, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1043">Variables and Macros</a></dt><dt>cookieã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-890">ç©ºç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-891">ç©ºç›®æ ‡</a></dt><dt>cookies, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-890">Empty Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-891">Empty Targets</a></dt><dd><dl><dt>ï¼ˆå¦è¯·å‚é˜…ç©ºç›®æ ‡ï¼‰</dt></dl></dd><dd><dl><dt>(see also empty targets)</dt></dl></dd><dt>è®¡æ•°å™¨å‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-921">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a></dt><dt>counter function, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-921">Finding Files with VPATH and vpath</a></dt><dt>CPPFLAGS å˜é‡ã€<a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1082">ç‰¹å®šäºŽç›®æ ‡å’Œæ¨¡å¼çš„å˜é‡</a></dt><dt>CPPFLAGS variable, <a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1082">Target- and Pattern-Specific Variables</a></dt><dt>CURDIR å˜é‡ã€<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1123">æ ‡å‡† make å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1125">æ ‡å‡† make å˜é‡</a></dt><dt>CURDIR variable, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1123">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1125">Standard make Variables</a></dt><dt><a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1040">å˜é‡ã€å˜é‡å’Œå®</a>ä¸­çš„èŠ±æ‹¬å· ({ })<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1040"></a></dt><dt>curly braces ({ }) in variables, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1040">Variables and Macros</a></dt><dt>CVSï¼ˆå¹¶å‘ç‰ˆæœ¬ç³»ç»Ÿï¼‰ã€<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-986">æºä»£ç æŽ§åˆ¶</a>ã€<a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1465">å‚è€ƒç‰ˆæœ¬ã€åº“å’Œå®‰è£…ç¨‹åºçš„éšå¼è§„åˆ™</a></dt><dt>CVS (Concurrent Version Systems), <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-986">Implicit Rules for Source Control</a>, <a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1465">Reference Builds, Libraries, and Installers</a></dt><dd><dl><dt>äºŒè¿›åˆ¶æ–‡ä»¶ã€å¤§åž‹ã€<a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1465">å‚è€ƒç‰ˆæœ¬ã€åº“å’Œå®‰è£…ç¨‹åº</a></dt><dt>éšå¼è§„åˆ™å’Œ<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-986">æºä»£ç æŽ§åˆ¶çš„éšå¼è§„åˆ™</a></dt></dl></dd><dd><dl><dt>binary files, large, <a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1465">Reference Builds, Libraries, and Installers</a></dt><dt>implicit rules and, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-986">Implicit Rules for Source Control</a></dt></dl></dd><dt>cwdï¼ˆå½“å‰å·¥ä½œç›®å½•ï¼‰ã€CURDIR å˜é‡å’Œ<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1127">æ ‡å‡† make å˜é‡</a></dt><dt>cwd (current working directory), CURDIR variable
                  and, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1127">Standard make Variables</a></dt><dt>Cygwinã€<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1144">ç”¨æˆ·å®šä¹‰å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1424">Cygwin</a>ã€<a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1425">è¡Œç»ˆæ­¢</a>ã€<a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1427">æ–‡ä»¶ç³»ç»Ÿ</a>ã€<a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1429">ç¨‹åºå†²çª</a>ã€<a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1501">è®¾ç½® CLASSPATH</a>ã€<a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1527">åŸºå‡†æµ‹è¯•</a></dt><dt>Cygwin, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1144">User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1424">Cygwin</a>, <a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1425">Line Termination</a>, <a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1427">Filesystem</a>, <a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1429">Program Conflicts</a>, <a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1501">Setting CLASSPATH</a>, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1527">Benchmarking</a></dt><dd><dl><dt>åŸºå‡†æµ‹è¯•å’Œ<a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1527">åŸºå‡†æµ‹è¯•</a></dt><dt>å†²çªã€<a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1429">ç¨‹åºå†²çª</a></dt><dt>çº¿è·¯ç»ˆç«¯,<a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1425">çº¿è·¯ç»ˆç«¯</a></dt><dt>å¯ç§»æ¤æ€§å’Œ<a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1424">Cygwin</a></dt><dt>regtoolï¼Œ<a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1501">è®¾ç½® CLASSPATH</a></dt><dt>Windows æ–‡ä»¶ç³»ç»Ÿå’Œ<a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1427">æ–‡ä»¶ç³»ç»Ÿ</a></dt></dl></dd><dd><dl><dt>benchmarking and, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1527">Benchmarking</a></dt><dt>conflicts, <a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1429">Program Conflicts</a></dt><dt>line termination, <a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1425">Line Termination</a></dt><dt>portability and, <a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1424">Cygwin</a></dt><dt>regtool, <a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1501">Setting CLASSPATH</a></dt><dt>Windows filesystem and, <a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1427">Filesystem</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>D</h3><h3>D</h3><dl><dt>æ•°æ®ç»“æž„,<a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1623">æ•°æ®ç»“æž„</a>,<a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1632">æ•°æ®ç»“æž„</a></dt><dt>data structures, <a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1623">Data Structures</a>, <a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1632">Data Structures</a></dt><dd><dl><dt>éžæ³•ï¼Œ<a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1632">æ•°æ®ç»“æž„</a></dt></dl></dd><dd><dl><dt>illegal, <a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1632">Data Structures</a></dt></dl></dd><dt>--debug é€‰é¡¹ï¼Œ<a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1591">--debug é€‰é¡¹</a></dt><dt>--debug option, <a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1591">The â€”debug Option</a></dt><dt>è°ƒè¯•è¾“å…¥å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1279">é«˜çº§ç”¨æˆ·å®šä¹‰å‡½æ•°</a></dt><dt>debug-enter variable, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1279">Advanced User-Defined Functions</a></dt><dt>è°ƒè¯•ç¦»å¼€å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1280">é«˜çº§ç”¨æˆ·å®šä¹‰å‡½æ•°</a></dt><dt>debug-leave variable, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1280">Advanced User-Defined Functions</a></dt><dt>è°ƒè¯•ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-875">å‡ç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1283">é«˜çº§ç”¨æˆ·å®šä¹‰å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1583">make è°ƒè¯•åŠŸèƒ½</a>ã€<a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1585">make è°ƒè¯•åŠŸèƒ½</a>ã€<a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1586">å‘½ä»¤è¡Œé€‰é¡¹</a>ã€<a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1592">è‰¯å¥½ç¼–ç å®žè·µ</a>ã€<a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1594">é˜²å¾¡æ€§ç¼–ç </a>ã€<a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1596">è°ƒè¯•æŠ€æœ¯</a>ã€<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1597">å¸¸è§é”™è¯¯æ¶ˆæ¯</a>ã€<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1599">è¯­æ³•é”™è¯¯</a>ã€<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1606">å‘½ä»¤è„šæœ¬ä¸­çš„é”™è¯¯</a>ã€<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1609">è¦†ç›–å‘½ä»¤å¯¹äºŽç›®æ ‡</a></dt><dt>debugging, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-875">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1283">Advanced User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1583">Debugging Features of make</a>, <a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1585">Debugging Features of make</a>, <a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1586">Command-Line Options</a>, <a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1592">Good Coding Practices</a>, <a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1594">Defensive Coding</a>, <a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1596">Debugging Techniques</a>, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1597">Common Error Messages</a>, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1599">Syntax Errors</a>, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1606">Errors in Command Scripts</a>, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1609">Overriding Commands for Target</a></dt><dd><dl><dt>ä»£ç ç¼–å†™å’Œ<a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1592">è‰¯å¥½ç¼–ç å®žè·µ</a></dt><dt>å‘½ä»¤è„šæœ¬é”™è¯¯æ¶ˆæ¯ã€<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1606">å‘½ä»¤è„šæœ¬ä¸­çš„é”™è¯¯</a></dt><dt>å‘½ä»¤è¡Œé€‰é¡¹,<a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1586">å‘½ä»¤è¡Œé€‰é¡¹</a></dt><dt>é˜²å¾¡æ€§ç¼–ç å’Œ<a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1594">é˜²å¾¡æ€§ç¼–ç </a></dt><dt>é”™è¯¯æ¶ˆæ¯ã€<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1597">å¸¸è§é”™è¯¯æ¶ˆæ¯</a></dt><dt>ç®€ä»‹ã€<a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1583">make çš„è°ƒè¯•åŠŸèƒ½</a></dt><dt>å®å’Œ<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1283">é«˜çº§ç”¨æˆ·å®šä¹‰å‡½æ•°</a></dt><dt>åˆ¶ä½œè¾“å‡ºã€è™šå‡ç›®æ ‡å’Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-875">è™šå‡ç›®æ ‡</a></dt><dt>è¦†ç›–å‘½ä»¤ã€ç›®æ ‡ã€<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1609">ç›®æ ‡çš„è¦†ç›–å‘½ä»¤</a></dt><dt>è¯­æ³•é”™è¯¯,<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1599">è¯­æ³•é”™è¯¯</a></dt><dt>æŠ€æœ¯ï¼Œ<a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1596">è°ƒè¯•æŠ€æœ¯</a></dt><dt><a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1585">make çš„</a>è­¦å‘ŠåŠŸèƒ½å’Œè°ƒè¯•åŠŸèƒ½<a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1585"></a></dt></dl></dd><dd><dl><dt>code writing and, <a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1592">Good Coding Practices</a></dt><dt>command script error messages, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1606">Errors in Command Scripts</a></dt><dt>command-line options, <a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1586">Command-Line Options</a></dt><dt>defensive coding and, <a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1594">Defensive Coding</a></dt><dt>error messages, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1597">Common Error Messages</a></dt><dt>introduction, <a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1583">Debugging Features of make</a></dt><dt>macros and, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1283">Advanced User-Defined Functions</a></dt><dt>make output, phony targets and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-875">Phony Targets</a></dt><dt>overriding commands, targets, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1609">Overriding Commands for Target</a></dt><dt>syntax errors, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1599">Syntax Errors</a></dt><dt>techniuqes for, <a class="indexterm" href="#OEBPS/ch12s02.html.make3-CHP-12-ITERM-1596">Debugging Techniques</a></dt><dt>warning function and, <a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1585">Debugging Features of make</a></dt></dl></dd><dt>å£°æ˜Žã€å¯é‡ç”¨ã€åº“å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-925">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a></dt><dt>declarations, reusable, library functions, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-925">Finding Files with VPATH and vpath</a></dt><dt>å»¶è¿Ÿæ‰©å±•ï¼Œ<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1071">å½“å˜é‡æ‰©å±•æ—¶</a></dt><dt>deferred expansion, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1071">When Variables Are Expanded</a></dt><dt>å®šä¹‰æŒ‡ä»¤ã€å®ã€<a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1062">å®</a></dt><dt>define directive, macros, <a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1062">Macros</a></dt><dt>defslot å‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1628">æ•°æ®ç»“æž„</a></dt><dt>defslot function, <a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1628">Data Structures</a></dt><dt>.DELETE_ON_ERROR ç›®æ ‡ä¿®é¥°ç¬¦ï¼Œ<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1008">ç‰¹æ®Šç›®æ ‡</a></dt><dt>.DELETE_ON_ERROR
                  target modifier, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1008">Special Targets</a></dt><dt>ä¾èµ–é¡¹ã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-800">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch02s07.html.make3-CHP-2-ITERM-1009">è‡ªåŠ¨ä¾èµ–é¡¹ç”Ÿæˆ</a>ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1116">åŒ…å«å’Œä¾èµ–é¡¹</a>ã€<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1369">é€’å½’ make</a>ã€<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1381">è·¨ Makefile ä¾èµ–é¡¹</a>ã€<a class="indexterm" href="#OEBPS/ch08s03.html.make3-CHP-8-ITERM-1448">ä¾èµ–é¡¹ç”Ÿæˆ</a>ã€<a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1497">ä½¿ç”¨ä¾èµ–é¡¹è¿›è¡Œç¼–è¯‘</a>ã€<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1534">è¯†åˆ«å’Œå¤„ç†ç“¶é¢ˆ</a></dt><dt>dependencies, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-800">Targets and Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch02s07.html.make3-CHP-2-ITERM-1009">Automatic Dependency Generation</a>, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1116">include and Dependencies</a>, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1369">Recursive make</a>, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1381">Cross-Makefile Dependencies</a>, <a class="indexterm" href="#OEBPS/ch08s03.html.make3-CHP-8-ITERM-1448">Dependency Generation</a>, <a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1497">Compiling with Dependencies</a>, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1534">Identifying and Handling Bottlenecks</a></dt><dd><dl><dt>ç“¶é¢ˆä»¥åŠ<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1534">è¯†åˆ«å’Œå¤„ç†ç“¶é¢ˆ</a></dt><dt>ç”Ÿæˆã€<a class="indexterm" href="#OEBPS/ch02s07.html.make3-CHP-2-ITERM-1009">è‡ªåŠ¨ä¾èµ–ç”Ÿæˆ</a>ã€<a class="indexterm" href="#OEBPS/ch08s03.html.make3-CHP-8-ITERM-1448">ä¾èµ–ç”Ÿæˆ</a></dt><dd><dl><dt>è‡ªåŠ¨ï¼Œ<a class="indexterm" href="#OEBPS/ch02s07.html.make3-CHP-2-ITERM-1009">è‡ªåŠ¨ä¾èµ–ç”Ÿæˆ</a></dt></dl></dd><dt>include æŒ‡ä»¤å’Œã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1116">include å’Œä¾èµ–é¡¹</a></dt><dt>Java makefileï¼Œ<a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1497">ä½¿ç”¨ä¾èµ–é¡¹è¿›è¡Œç¼–è¯‘</a></dt><dt>é€’å½’å’Œï¼Œ<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1369">é€’å½’make</a></dt><dt>è§„åˆ™ã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-800">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a></dt></dl></dd><dd><dl><dt>bottlenecks and, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1534">Identifying and Handling Bottlenecks</a></dt><dt>generating, <a class="indexterm" href="#OEBPS/ch02s07.html.make3-CHP-2-ITERM-1009">Automatic Dependency Generation</a>, <a class="indexterm" href="#OEBPS/ch08s03.html.make3-CHP-8-ITERM-1448">Dependency Generation</a></dt><dd><dl><dt>automatically, <a class="indexterm" href="#OEBPS/ch02s07.html.make3-CHP-2-ITERM-1009">Automatic Dependency Generation</a></dt></dl></dd><dt>include directive and, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1116">include and Dependencies</a></dt><dt>Java makefile, <a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1497">Compiling with Dependencies</a></dt><dt>recursion and, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1369">Recursive make</a></dt><dt>rules, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-800">Targets and Prerequisites</a></dt></dl></dd><dt>ä¾èµ–æ€§æ£€æŸ¥,<a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-807">ä¾èµ–æ€§æ£€æŸ¥</a></dt><dt>dependency checking, <a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-807">Dependency Checking</a></dt><dt>å¼€å‘çŽ¯å¢ƒï¼Œ<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1097">å˜é‡ä»Žä½•è€Œæ¥</a></dt><dt>development environments, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1097">Where Variables Come From</a></dt><dd><dl><dt>å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1097">å˜é‡ä»Žä½•è€Œæ¥</a></dt></dl></dd><dd><dl><dt>variables, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1097">Where Variables Come From</a></dt></dl></dd><dt>å¼€å‘éœ€æ±‚ã€<a class="indexterm" href="#OEBPS/ch06s03.html.make3-CHP-6-ITERM-1404">è¦æ±‚</a></dt><dt>development requirements, <a class="indexterm" href="#OEBPS/ch06s03.html.make3-CHP-6-ITERM-1404">Requirements</a></dt><dt>å¼€å‘é£Žæ ¼ï¼Œ<a class="indexterm" href="#OEBPS/ch06s03.html.make3-CHP-6-ITERM-1403">å¤§åž‹ç³»ç»Ÿçš„ç»„ä»¶</a></dt><dt>development styles, <a class="indexterm" href="#OEBPS/ch06s03.html.make3-CHP-6-ITERM-1403">Components of Large Systems</a></dt><dt>df å‘½ä»¤ã€è™šå‡ç›®æ ‡å’Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-867">è™šå‡ç›®æ ‡</a></dt><dt>df command, phony targets and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-867">Phony Targets</a></dt><dt>dir å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1217">æ–‡ä»¶åå‡½æ•°</a></dt><dt>dir function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1217">Filename Functions</a></dt><dt>æŒ‡ä»¤ã€<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-935">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1064">å®</a>ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1100">æ¡ä»¶å’ŒåŒ…å«å¤„ç†</a>ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1103">æ¡ä»¶å’ŒåŒ…å«å¤„ç†</a>ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1106">æ¡ä»¶å’ŒåŒ…å«å¤„ç†</a>ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1115">åŒ…å«æŒ‡ä»¤</a>ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1118">åŒ…å«å’Œä¾èµ–é¡¹</a>ã€<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1398">éžé€’å½’ make</a></dt><dt>directives, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-935">Finding Files with VPATH and vpath</a>, <a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1064">Macros</a>, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1100">Conditional and include Processing</a>, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1103">Conditional and include Processing</a>, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1106">Conditional and include Processing</a>, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1115">The include Directive</a>, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1118">include and Dependencies</a>, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1398">Nonrecursive make</a></dt><dd><dl><dt>æ¡ä»¶å¤„ç†,<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1100">æœ‰æ¡ä»¶å¹¶åŒ…æ‹¬å¤„ç†</a></dt><dt>æ¡ä»¶ã€è¯­æ³•ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1106">æ¡ä»¶å’ŒåŒ…å«å¤„ç†</a></dt><dt>å®šä¹‰ã€<a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1064">å®</a></dt><dt>åŒ…å«ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1103">æ¡ä»¶å’ŒåŒ…å«å¤„ç†</a>ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1115">åŒ…å«æŒ‡ä»¤</a>ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1118">åŒ…å«å’Œä¾èµ–é¡¹</a>ã€<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1398">éžé€’å½’ make</a></dt><dd><dl><dt>ä¾èµ–å…³ç³»ï¼Œ<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1118">åŒ…æ‹¬å’Œä¾èµ–å…³ç³»</a></dt><dt>ä¼˜åŒ–ï¼Œ<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1398">éžé€’å½’make</a></dt></dl></dd><dt>vpathï¼Œ<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-935">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a></dt></dl></dd><dd><dl><dt>conditional processing, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1100">Conditional and include Processing</a></dt><dt>conditional, syntax, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1106">Conditional and include Processing</a></dt><dt>define, <a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1064">Macros</a></dt><dt>include, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1103">Conditional and include Processing</a>, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1115">The include Directive</a>, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1118">include and Dependencies</a>, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1398">Nonrecursive make</a></dt><dd><dl><dt>dependencies and, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1118">include and Dependencies</a></dt><dt>optimization, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1398">Nonrecursive make</a></dt></dl></dd><dt>vpath, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-935">Finding Files with VPATH and vpath</a></dt></dl></dd><dt>ç›®å½•ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-855">é€šé…ç¬¦</a>ã€<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1386">éžé€’å½’ make</a></dt><dt>directories, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-855">Wildcards</a>, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1386">Nonrecursive make</a></dt><dd><dl><dt>å¤šç›®å½•é¡¹ç›®ã€éžé€’å½’ make å’Œ<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1386">éžé€’å½’ make</a></dt><dt>^ï¼ˆæ³¢å½¢ç¬¦ï¼‰å’Œï¼Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-855">é€šé…ç¬¦</a></dt></dl></dd><dd><dl><dt>multidirectory projects, nonrecursive make
            and, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1386">Nonrecursive make</a></dt><dt>^ (tilde) and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-855">Wildcards</a></dt></dl></dd><dt>distclean ç›®æ ‡ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-882">è™šå‡ç›®æ ‡</a></dt><dt>distclean target, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-882">Phony Targets</a></dt><dt>åˆ†å¸ƒã€æ€§èƒ½å’Œã€<a class="indexterm" href="#OEBPS/ch10s04.html.make3-CHP-10-ITERM-1549">åˆ†å¸ƒå¼åˆ¶ä½œ</a></dt><dt>distribution, performance and, <a class="indexterm" href="#OEBPS/ch10s04.html.make3-CHP-10-ITERM-1549">Distributed make</a></dt><dt>åŒå†’å·è§„åˆ™,<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1029">åŒå†’å·è§„åˆ™</a></dt><dt>double-colon rules, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1029">Double-Colon Rules</a></dt></dl></div><div class="indexdiv"><h3>ä¹™</h3><h3>E</h3><dl><dt>echo å‘½ä»¤è¡Œã€é™åˆ¶ã€<a class="indexterm" href="#OEBPS/ch05s06.html.make3-CHP-5-ITERM-1360">å‘½ä»¤è¡Œé™åˆ¶</a></dt><dt>echo command line, limits, <a class="indexterm" href="#OEBPS/ch05s06.html.make3-CHP-5-ITERM-1360">Command-Line Limits</a></dt><dt>Eclipseã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1491">IDE</a></dt><dt>Eclipse, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1491">IDEs</a></dt><dt>EJBï¼ˆä¼ä¸š Java Beanï¼‰ã€<a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1514">ä¼ä¸š JavaBean</a></dt><dt>EJB (Enterprise Java Beans), <a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1514">Enterprise JavaBeans</a></dt><dt>ejb-rule å‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1519">Enterprise JavaBeans</a></dt><dt>ejb-rule function, <a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1519">Enterprise JavaBeans</a></dt><dt>EJBS å˜é‡ã€<a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1517">Enterprise JavaBeans</a></dt><dt>EJBS variable, <a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1517">Enterprise JavaBeans</a></dt><dt>Emacs JDEEã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1492">IDE</a></dt><dt>Emacs JDEE, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1492">IDEs</a></dt><dt>åµŒå…¥å‘¨æœŸã€å˜é‡å®šä¹‰å’Œ<a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1625">æ•°æ®ç»“æž„</a></dt><dt>embedded periods, variable definition and, <a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1625">Data Structures</a></dt><dt>ç©ºå‘½ä»¤ï¼Œ<a class="indexterm" href="#OEBPS/ch05s03.html.make3-CHP-5-ITERM-1337">ç©ºå‘½ä»¤</a></dt><dt>empty commands, <a class="indexterm" href="#OEBPS/ch05s03.html.make3-CHP-5-ITERM-1337">Empty Commands</a></dt><dt>ç©ºç›®æ ‡,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-887">ç©ºç›®æ ‡</a>,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-895">ç©ºç›®æ ‡</a></dt><dt>empty targets, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-887">Empty Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-895">Empty Targets</a></dt><dd><dl><dt>è‡ªåŠ¨å˜é‡å’Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-895">ç©ºç›®æ ‡</a></dt></dl></dd><dd><dl><dt>automatic variables and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-895">Empty Targets</a></dt></dl></dd><dt>å°è£…ã€Java åŒ…ã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1473">Java</a></dt><dt>encapsulation, Java packages, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1473">Java</a></dt><dt>endef å…³é”®å­—ã€<a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1065">å®</a></dt><dt>endef keyword, <a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1065">Macros</a></dt><dt>çŽ¯å¢ƒå˜é‡ï¼Œ?= è¿ç®—ç¬¦ï¼Œ<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1093">å˜é‡ä»Žä½•è€Œæ¥</a></dt><dt>environment variables, ?= operator, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1093">Where Variables Come From</a></dt><dt>--environment-overrides é€‰é¡¹ï¼Œ<a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1612">è¿è¡Œ make</a></dt><dt>--environment-overrides
                option, <a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1612">Running make</a></dt><dt>çŽ¯å¢ƒã€<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1090">å˜é‡ä»Žä½•è€Œæ¥</a>ã€<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1340">å‘½ä»¤çŽ¯å¢ƒ</a>ã€<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1342">å‘½ä»¤çŽ¯å¢ƒ</a>ã€<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1346">å‘½ä»¤çŽ¯å¢ƒ</a>ã€<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1350">å‘½ä»¤çŽ¯å¢ƒ</a></dt><dt>environments, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1090">Where Variables Come From</a>, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1340">Command Environment</a>, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1342">Command Environment</a>, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1346">Command Environment</a>, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1350">Command Environment</a></dt><dd><dl><dt>å‘½ä»¤ã€<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1340">å‘½ä»¤çŽ¯å¢ƒ</a>ã€<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1342">å‘½ä»¤çŽ¯å¢ƒ</a>ã€<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1346">å‘½ä»¤çŽ¯å¢ƒ</a>ã€<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1350">å‘½ä»¤çŽ¯å¢ƒ</a></dt><dd><dl><dt>æ–‡ä»¶æè¿°ç¬¦ã€<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1350">å‘½ä»¤çŽ¯å¢ƒ</a></dt><dt>MAKEFLAGS å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1342">å‘½ä»¤çŽ¯å¢ƒ</a></dt><dt>MAKELEVEL å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1346">å‘½ä»¤çŽ¯å¢ƒ</a></dt></dl></dd><dt>å˜é‡å®šä¹‰ä»¥åŠ<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1090">å˜é‡ä»Žä½•è€Œæ¥</a></dt></dl></dd><dd><dl><dt>commands, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1340">Command Environment</a>, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1342">Command Environment</a>, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1346">Command Environment</a>, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1350">Command Environment</a></dt><dd><dl><dt>file descriptors, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1350">Command Environment</a></dt><dt>MAKEFLAGS variable, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1342">Command Environment</a></dt><dt>MAKELEVEL variable, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1346">Command Environment</a></dt></dl></dd><dt>variable definition and, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1090">Where Variables Come From</a></dt></dl></dd><dt>è¯¯å·®å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1246">æµé‡æŽ§åˆ¶</a></dt><dt>error function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1246">Flow Control</a></dt><dt>é”™è¯¯å¤„ç†ã€é€’å½’ make å’Œã€<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1377">é”™è¯¯å¤„ç†</a></dt><dt>error handling, recursive make and, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1377">Error Handling</a></dt><dt>é”™è¯¯æ¶ˆæ¯ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1248">æµç¨‹æŽ§åˆ¶</a>ã€<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1598">å¸¸è§é”™è¯¯æ¶ˆæ¯</a>ã€<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1605">å‘½ä»¤è„šæœ¬ä¸­çš„é”™è¯¯</a></dt><dt>error messages, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1248">Flow Control</a>, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1598">Common Error Messages</a>, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1605">Errors in Command Scripts</a></dt><dd><dl><dt>å‘½ä»¤è„šæœ¬ã€<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1605">å‘½ä»¤è„šæœ¬ä¸­çš„é”™è¯¯</a></dt><dt>è°ƒè¯•å’Œ<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1598">å¸¸è§é”™è¯¯æ¶ˆæ¯</a></dt><dt>è‡´å‘½ã€æ‰“å°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1248">æµé‡æŽ§åˆ¶</a></dt></dl></dd><dd><dl><dt>command scripts, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1605">Errors in Command Scripts</a></dt><dt>debugging and, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1598">Common Error Messages</a></dt><dt>fatal, printing, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1248">Flow Control</a></dt></dl></dd><dt>é”™è¯¯ã€å‘½ä»¤ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1320">å‘½ä»¤ä¿®é¥°ç¬¦</a>ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1328">é”™è¯¯å’Œä¸­æ–­</a></dt><dt>errors, commands, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1320">Command Modifiers</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1328">Errors and Interrupts</a></dt><dd><dl><dt>å¿½ç•¥ï¼Œ<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1320">å‘½ä»¤ä¿®é¥°ç¬¦</a></dt><dt>é€‰é¡¹ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1328">é”™è¯¯å’Œä¸­æ–­</a></dt></dl></dd><dd><dl><dt>ignoring, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1320">Command Modifiers</a></dt><dt>options, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1328">Errors and Interrupts</a></dt></dl></dd><dt>eval å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1285">eval å’Œ value</a>ã€<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1289">eval å’Œ value</a></dt><dt>eval function, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1285">eval and value</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1289">eval and value</a></dt><dd><dl><dt>è§£æž andã€<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1289">eval å’Œ value</a></dt></dl></dd><dd><dl><dt>parsing and, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1289">eval and value</a></dt></dl></dd><dt>æ‰©å±•å®ï¼Œ<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1069">å½“å˜é‡æ‰©å±•æ—¶</a></dt><dt>exanding macros, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1069">When Variables Are Expanded</a></dt><dt>æ‰©å±•å®ã€<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1074">æ‰©å±•å˜é‡æ—¶</a>ã€<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1075">æ‰©å±•å˜é‡æ—¶</a>ã€<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1149">ç”¨æˆ·å®šä¹‰å‡½æ•°</a></dt><dt>expanding macros, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1074">When Variables Are Expanded</a>, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1075">When Variables Are Expanded</a>, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1149">User-Defined Functions</a></dt><dd><dl><dt>å»¶è¿Ÿæ‰©å±•ï¼Œ<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1075">å½“å˜é‡æ‰©å±•æ—¶</a></dt><dt>ç«‹å³æ‰©å±•ï¼Œ<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1074">å½“å˜é‡æ‰©å±•æ—¶</a></dt><dt>ä»Žå¦ä¸€ä¸ª<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1149">ç”¨æˆ·å®šä¹‰å‡½æ•°è°ƒç”¨çš„å®</a></dt></dl></dd><dd><dl><dt>deferred expansion, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1075">When Variables Are Expanded</a></dt><dt>immediate expansion, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1074">When Variables Are Expanded</a></dt><dt>macros invoked from another, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1149">User-Defined Functions</a></dt></dl></dd><dt>æ‰©å±•æ–‡æœ¬ã€foreach å‡½æ•°å’Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1260">æµç¨‹æŽ§åˆ¶</a></dt><dt>expanding text, foreach function and, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1260">Flow Control</a></dt><dt>æ‰©å±•å˜é‡ã€<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1039">å˜é‡å’Œå®</a>ã€<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1067">ä½•æ—¶æ‰©å±•å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1072">ä½•æ—¶æ‰©å±•å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1073">ä½•æ—¶æ‰©å±•å˜é‡</a></dt><dt>expanding variables, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1039">Variables and Macros</a>, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1067">When Variables Are Expanded</a>, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1072">When Variables Are Expanded</a>, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1073">When Variables Are Expanded</a></dt><dd><dl><dt>å¤§æ‹¬å·å’Œ<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1039">å˜é‡å’Œå®</a></dt><dt><a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1072">å½“å˜é‡æ‰©å±•æ—¶</a>å»¶è¿Ÿ<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1072"></a></dt><dt>ç«‹å³ç”Ÿæ•ˆï¼Œ<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1073">å½“å˜é‡æ‰©å±•æ—¶</a></dt></dl></dd><dd><dl><dt>curly braces and, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1039">Variables and Macros</a></dt><dt>deferred, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1072">When Variables Are Expanded</a></dt><dt>immediate, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1073">When Variables Are Expanded</a></dt></dl></dd><dt>æ˜¾å¼è§„åˆ™,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-827">è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-839">æ˜¾å¼è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-896">ç©ºç›®æ ‡</a>,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-847">é€šé…ç¬¦</a>,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-863">è™šå‡ç›®æ ‡</a>,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-888">ç©ºç›®æ ‡</a></dt><dt>explicit rules, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-827">Rules</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-839">Explicit Rules</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-896">Empty Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-847">Wildcards</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-863">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-888">Empty Targets</a></dt><dd><dl><dt>ç©ºç›®æ ‡å’Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-888">ç©ºç›®æ ‡</a></dt><dt>è™šå‡ç›®æ ‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-863">è™šå‡ç›®æ ‡</a></dt><dt>é€šé…ç¬¦,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-847">é€šé…ç¬¦</a></dt></dl></dd><dd><dl><dt>empty targets and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-888">Empty Targets</a></dt><dt>phony targets, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-863">Phony Targets</a></dt><dt>wildcards, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-847">Wildcards</a></dt></dl></dd><dt>å¯¼å‡ºå˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1091">å˜é‡ä»Žä½•è€Œæ¥</a></dt><dt>exporting variables, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1091">Where Variables Come From</a></dt></dl></div><div class="indexdiv"><h3>F</h3><h3>F</h3><dl><dt>è‡´å‘½é”™è¯¯æ¶ˆæ¯ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1249">æµé‡æŽ§åˆ¶</a></dt><dt>fatal error messages, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1249">Flow Control</a></dt><dt>æ–‡ä»¶æè¿°ç¬¦ã€<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1351">å‘½ä»¤çŽ¯å¢ƒ</a></dt><dt>file descriptors, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1351">Command Environment</a></dt><dt>æ–‡ä»¶ç®¡ç†ã€<a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1431">ç®¡ç†ç¨‹åºå’Œæ–‡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1436">æºæ ‘å¸ƒå±€</a></dt><dt>file management, <a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1431">Managing Programs and Files</a>, <a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1436">Source Tree Layout</a></dt><dd><dl><dt>æºæ ‘å¸ƒå±€ï¼Œ<a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1436">æºæ ‘å¸ƒå±€</a></dt></dl></dd><dd><dl><dt>source tree layout, <a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1436">Source Tree Layout</a></dt></dl></dd><dt>--file é€‰é¡¹ï¼Œ<a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1613">è¿è¡Œ make</a></dt><dt>--file option, <a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1613">Running make</a></dt><dt>æ–‡ä»¶å,<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-938">æ¨¡å¼è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1208">é‡è¦æ‚é¡¹å‡½æ•°</a>,æ–‡ä»¶<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1215">å</a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1212">å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1216">æ–‡ä»¶åå‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1219">æ–‡ä»¶åå‡½æ•°</a>,æ–‡ä»¶å<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1222">å‡½æ•° , æ–‡ä»¶åå‡½æ•°</a>,æ–‡ä»¶<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1226">åå‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1228">æ–‡ä»¶åå‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1231">æ–‡ä»¶åå‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1233">æ–‡ä»¶åå‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1236">æ–‡ä»¶åå‡½æ•°</a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1215"></a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1216"></a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1219"></a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1222"></a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1226"></a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1228"></a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1231"></a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1233"></a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1236"></a></dt><dt>filenames, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-938">Pattern Rules</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1208">Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1212">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1215">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1216">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1219">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1222">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1226">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1228">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1231">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1233">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1236">Filename Functions</a></dt><dd><dl><dt>å†…ç½®å‡½æ•°å’Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1212">æ–‡ä»¶åå‡½æ•°</a></dt><dt>å‡½æ•°,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1215">æ–‡ä»¶åå‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1216">æ–‡ä»¶åå‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1219">æ–‡ä»¶åå‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1228">æ–‡ä»¶åå‡½æ•°</a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1226">,</a>æ–‡ä»¶åå‡½æ•°,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1231">æ–‡ä»¶åå‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1233">æ–‡ä»¶åå‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1236">æ–‡ä»¶åå‡½æ•°</a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1228"></a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1231"></a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1233"></a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1236"></a></dt><dd><dl><dt>addprefixï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1233">æ–‡ä»¶åå‡½æ•°</a></dt><dt>addsuffixï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1231">æ–‡ä»¶åå‡½æ•°</a></dt><dt>åŸºæœ¬åç§°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1228">æ–‡ä»¶åå‡½æ•°</a></dt><dt>ç›®å½•ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1216">æ–‡ä»¶åå‡½æ•°</a></dt><dt>joinï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1236">æ–‡ä»¶åå‡½æ•°</a></dt><dt>notdirï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1219">æ–‡ä»¶åå‡½æ•°</a></dt><dt>åŽç¼€ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1226">æ–‡ä»¶ååŠŸèƒ½</a></dt><dt>é€šé…ç¬¦å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1215">æ–‡ä»¶åå‡½æ•°</a></dt></dl></dd><dt>æ¨¡å¼ï¼Œ<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-938">æ¨¡å¼è§„åˆ™</a>ï¼ˆå‚è§æ¨¡å¼è§„åˆ™ï¼‰</dt><dt>åŽç¼€ã€å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1222">æ–‡ä»¶åå‡½æ•°</a></dt><dt>æ—¶é—´æˆ³å’Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1208">é‡è¦çš„æ‚é¡¹åŠŸèƒ½</a></dt></dl></dd><dd><dl><dt>built-in functions and, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1212">Filename Functions</a></dt><dt>functions, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1215">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1216">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1219">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1226">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1228">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1231">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1233">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1236">Filename Functions</a></dt><dd><dl><dt>addprefix, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1233">Filename Functions</a></dt><dt>addsuffix, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1231">Filename Functions</a></dt><dt>basename, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1228">Filename Functions</a></dt><dt>dir, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1216">Filename Functions</a></dt><dt>join, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1236">Filename Functions</a></dt><dt>notdir, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1219">Filename Functions</a></dt><dt>suffix, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1226">Filename Functions</a></dt><dt>wildcard function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1215">Filename Functions</a></dt></dl></dd><dt>patterns, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-938">Pattern Rules</a> (see pattern rules)</dt><dt>suffixes, functions, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1222">Filename Functions</a></dt><dt>timestamps and, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1208">Important Miscellaneous Functions</a></dt></dl></dd><dt>æ–‡ä»¶ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-843">é€šé…ç¬¦</a>ã€<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1088">å˜é‡ä»Žä½•è€Œæ¥</a></dt><dt>files, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-843">Wildcards</a>, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1088">Where Variables Come From</a></dt><dd><dl><dt>å˜é‡å®šä¹‰ä»¥åŠ<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1088">å˜é‡ä»Žä½•è€Œæ¥</a></dt><dt>é€šé…ç¬¦,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-843">é€šé…ç¬¦</a></dt></dl></dd><dd><dl><dt>variable definition and, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1088">Where Variables Come From</a></dt><dt>wildcards, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-843">Wildcards</a></dt></dl></dd><dt>æ–‡ä»¶æ•°ç»„ã€å‘½ä»¤è¡Œé™åˆ¶å’Œ<a class="indexterm" href="#OEBPS/ch05s06.html.make3-CHP-5-ITERM-1361">å‘½ä»¤è¡Œé™åˆ¶</a></dt><dt>files array, command line limits and, <a class="indexterm" href="#OEBPS/ch05s06.html.make3-CHP-5-ITERM-1361">Command-Line Limits</a></dt><dt>æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€ã€äºŒå‰æ ‘å’Œ<a class="indexterm" href="#OEBPS/ch06s04.html.make3-CHP-6-ITERM-1406">æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€</a></dt><dt>filesystems layout, binary trees and, <a class="indexterm" href="#OEBPS/ch06s04.html.make3-CHP-6-ITERM-1406">Filesystem Layout</a></dt><dt>è¿‡æ»¤å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1169">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>filter function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1169">String Functions</a></dt><dt>è¿‡æ»¤å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1172">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>filter-out function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1172">String Functions</a></dt><dt>find å‘½ä»¤ã€æ¨¡å—å®šä¹‰ã€<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1400">éžé€’å½’ make</a></dt><dt>find command, module definition, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1400">Nonrecursive make</a></dt><dt>findstring å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1175">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>findstring function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1175">String Functions</a></dt><dt>ç¬¬ä¸€ä¸ªå­—å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1194">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>firstword function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1194">String Functions</a></dt><dt>æµé‡æŽ§åˆ¶åŠŸèƒ½,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1240">æµé‡æŽ§åˆ¶</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1242">æµé‡æŽ§åˆ¶</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1245">æµé‡æŽ§åˆ¶</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1250">æµé‡æŽ§åˆ¶</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1253">æµé‡æŽ§åˆ¶</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1256">æµé‡æŽ§åˆ¶</a></dt><dt>flow control functions, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1240">Flow Control</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1242">Flow Control</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1245">Flow Control</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1250">Flow Control</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1253">Flow Control</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1256">Flow Control</a></dt><dd><dl><dt>æ–­è¨€ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1250">æµæŽ§åˆ¶</a>ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1253">æµæŽ§åˆ¶</a></dt><dt>é”™è¯¯ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1245">æµé‡æŽ§åˆ¶</a></dt><dt>foreachï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1256">æµé‡æŽ§åˆ¶</a></dt><dt>å¦‚æžœï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1242">æµé‡æŽ§åˆ¶</a></dt></dl></dd><dd><dl><dt>assert, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1250">Flow Control</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1253">Flow Control</a></dt><dt>error, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1245">Flow Control</a></dt><dt>foreach, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1256">Flow Control</a></dt><dt>if, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1242">Flow Control</a></dt></dl></dd><dt>foreachå‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1257">æµé‡æŽ§åˆ¶</a></dt><dt>foreach function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1257">Flow Control</a></dt><dt>foreach å¾ªçŽ¯ï¼Œ<a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1630">æ•°æ®ç»“æž„</a></dt><dt>foreach loop, <a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1630">Data Structures</a></dt><dt>å…è´¹è½¯ä»¶æ¨¡åž‹å¼€å‘ï¼Œ<a class="indexterm" href="#OEBPS/ch06s03.html.make3-CHP-6-ITERM-1401">å¤§åž‹ç³»ç»Ÿçš„ç»„ä»¶</a></dt><dt>free software model development, <a class="indexterm" href="#OEBPS/ch06s03.html.make3-CHP-6-ITERM-1401">Components of Large Systems</a></dt><dt>å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-857">é€šé…ç¬¦</a>ã€<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-922">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-924">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1045">å˜é‡å’Œå®</a>ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1113">æ¡ä»¶å’ŒåŒ…å«å¤„ç†</a>ã€<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1140">ç”¨æˆ·å®šä¹‰å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1153">ç”¨æˆ·å®šä¹‰å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1146">ç”¨æˆ·å®šä¹‰å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1155">å†…ç½®å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1276">ä¸å¤ªé‡è¦çš„æ‚é¡¹å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1158">å†…ç½®å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1161">å†…ç½®</a>å‡½æ•°,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1165">å­—ç¬¦ä¸²</a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1167">å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1170">å­—ç¬¦ä¸²</a>å‡½æ•°,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1173">å­—ç¬¦ä¸²å‡½æ•° , å­—ç¬¦ä¸²</a>å‡½æ•°<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1176">, å­—ç¬¦ä¸²</a>å‡½æ•°<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1180">, å­—ç¬¦ä¸²</a>å‡½æ•°,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1183">å­—ç¬¦ä¸²å‡½æ•°</a>,å­—ç¬¦ä¸²<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1185">å‡½æ•°,</a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1190">å­—ç¬¦ä¸²å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1192">å­—ç¬¦ä¸²å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1195">å­—ç¬¦ä¸²å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1198">å­—ç¬¦ä¸²å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1201">é‡è¦æ‚é¡¹å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1203">é‡è¦æ‚é¡¹å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1214">æ–‡ä»¶åå‡½æ•°</a>,æ–‡ä»¶<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1218">å</a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1221">å‡½æ•°</a>,æ–‡ä»¶<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1224">åå‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1229">æ–‡ä»¶åå‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1232">æ–‡ä»¶åå‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1235">æ–‡ä»¶åå‡½æ•°</a>,æ–‡ä»¶<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1238">åå‡½æ•° , æ–‡ä»¶åå‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1239">æµæŽ§åˆ¶</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1241">æµæŽ§åˆ¶</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1244">æµ</a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1247">æŽ§åˆ¶</a>,æµæŽ§åˆ¶,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1252">æµæŽ§åˆ¶</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1258">æµæŽ§åˆ¶</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1264">ä¸å¤ªé‡è¦æ‚é¡¹å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1265">ä¸å¤ªé‡è¦çš„æ‚é¡¹å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1269">ä¸å¤ªé‡è¦çš„æ‚é¡¹å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1272">ä¸å¤ªé‡è¦çš„æ‚é¡¹å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1274">ä¸å¤ªé‡è¦çš„æ‚é¡¹å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1278">é«˜çº§ç”¨æˆ·å®šä¹‰å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1299">ä¼ é€’å‚æ•°</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1286">eval å’Œ value</a> ,<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1293">æŒ‚é’©å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1297">ä¼ é€’å‚æ•°</a>,<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1390">éžé€’å½’ make</a> ,<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1394">éžé€’å½’ make</a> ,<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1396">éžé€’å½’ make</a> ,<a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1433">ç®¡ç†ç¨‹åºå’Œæ–‡ä»¶</a>,<a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1435">ç®¡ç†ç¨‹åºå’Œæ–‡ä»¶</a>,<a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1504">è®¾ç½® CLASSPATH</a> ,<a class="indexterm" href="#OEBPS/ch09s04.html.make3-CHP-9-ITERM-1509">ç®¡ç† Jars</a> , <a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1516">Enterprise JavaBeans</a> , <a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1520">Enterprise JavaBeans</a> ,<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1582">ç”¨æˆ·å®šä¹‰çš„å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1627">æ•°æ®ç»“æž„</a>,<a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1629">æ•°æ®ç»“æž„</a></dt><dt>functions, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-857">Wildcards</a>, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-922">Finding Files with VPATH and vpath</a>, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-924">Finding Files with VPATH and vpath</a>, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1045">Variables and Macros</a>, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1113">Conditional and include Processing</a>, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1140">User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1153">User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1146">User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1155">Built-in Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1276">Less Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1158">Built-in Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1161">Built-in Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1165">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1167">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1170">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1173">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1176">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1180">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1183">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1185">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1190">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1192">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1195">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1198">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1201">Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1203">Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1214">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1218">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1221">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1224">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1229">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1232">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1235">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1238">Filename Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1239">Flow Control</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1241">Flow Control</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1244">Flow Control</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1247">Flow Control</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1252">Flow Control</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1258">Flow Control</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1264">Less Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1265">Less Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1269">Less Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1272">Less Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1274">Less Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1278">Advanced User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1299">Passing Parameters</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1286">eval and value</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1293">Hooking Functions</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1297">Passing Parameters</a>, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1390">Nonrecursive make</a>, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1394">Nonrecursive make</a>, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1396">Nonrecursive make</a>, <a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1433">Managing Programs and Files</a>, <a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1435">Managing Programs and Files</a>, <a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1504">Setting CLASSPATH</a>, <a class="indexterm" href="#OEBPS/ch09s04.html.make3-CHP-9-ITERM-1509">Managing Jars</a>, <a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1516">Enterprise JavaBeans</a>, <a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1520">Enterprise JavaBeans</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1582">User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1627">Data Structures</a>, <a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1629">Data Structures</a></dt><dd><dl><dt>add-manifestï¼Œ<a class="indexterm" href="#OEBPS/ch09s04.html.make3-CHP-9-ITERM-1509">ç®¡ç†ç½å­</a></dt><dt>addprefixï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1235">æ–‡ä»¶åå‡½æ•°</a></dt><dt>addsuffixï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1232">æ–‡ä»¶åå‡½æ•°</a></dt><dt>æ–­è¨€ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1252">æµç¨‹æŽ§åˆ¶</a></dt><dt>åŸºæœ¬åç§°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1229">æ–‡ä»¶åå‡½æ•°</a></dt><dt>æž„å»ºç±»è·¯å¾„ï¼Œ<a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1504">è®¾ç½® CLASSPATH</a></dt><dt>å†…ç½®,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1155">å†…ç½®å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1276">ä¸å¤ªé‡è¦çš„æ‚é¡¹å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1158">å†…ç½®å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1161">å†…ç½®å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1165">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dd><dl><dt>æ¨¡å¼ä½œä¸ºå‚æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1161">å†…ç½®å‡½æ•°</a></dt><dt>å­—ç¬¦ä¸²å‡½æ•°,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1165">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>è¯­æ³•ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1158">å†…ç½®å‡½æ•°</a></dt></dl></dd><dt>å‘¼å«ã€é€šé…ç¬¦å’Œã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-857">é€šé…ç¬¦</a></dt><dt>ç¼–è¯‘ beanï¼Œ<a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1516">ä¼ä¸š JavaBean</a></dt><dt>è®¡æ•°å™¨ï¼Œ<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-922">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a></dt><dt>defslotï¼Œ<a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1629">æ•°æ®ç»“æž„</a></dt><dt>ç›®å½•ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1218">æ–‡ä»¶åå‡½æ•°</a></dt><dt>ejb è§„åˆ™ï¼Œ<a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1520">ä¼ä¸š JavaBean</a></dt><dt>é”™è¯¯ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1247">æµé‡æŽ§åˆ¶</a></dt><dt>è¯„ä¼°ã€<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1286">è¯„ä¼°å’Œä»·å€¼</a></dt><dt>è¿‡æ»¤å™¨ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1170">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>è¿‡æ»¤å™¨ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1173">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>æŸ¥æ‰¾å­—ç¬¦ä¸²ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1176">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>ç¬¬ä¸€ä¸ªå­—ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1195">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>æµé‡æŽ§åˆ¶,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1239">æµé‡æŽ§åˆ¶</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1241">æµé‡æŽ§åˆ¶</a></dt><dt>foreachï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1258">æµé‡æŽ§åˆ¶</a></dt><dt>ç”Ÿæˆæºï¼Œ<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1396">éžé€’å½’ make</a></dt><dt>é’©å­ã€<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1293">é’©å­å‡½æ•°</a></dt><dt>å¦‚æžœï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1244">æµé‡æŽ§åˆ¶</a></dt><dt>joinï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1238">æ–‡ä»¶åå‡½æ•°</a></dt><dt>åº“ã€å£°æ˜Žã€<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-924">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a></dt><dt>make-libraryï¼Œ<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1390">éžé€’å½’make</a></dt><dt>æ‚é¡¹ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1265">ä¸å¤ªé‡è¦çš„æ‚é¡¹åŠŸèƒ½</a>ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1274">ä¸å¤ªé‡è¦çš„æ‚é¡¹åŠŸèƒ½</a></dt><dt>notdirï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1221">æ–‡ä»¶åå‡½æ•°</a></dt><dt>èµ·æºï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1269">ä¸å¤ªé‡è¦çš„æ‚é¡¹åŠŸèƒ½</a></dt><dt>å‚æ•°ï¼Œä¼ é€’ç»™ï¼Œ<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1297">ä¼ é€’å‚æ•°</a></dt><dt>patsubstï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1185">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>è¿œç¨‹æ–‡ä»¶ï¼Œ<a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1627">æ•°æ®ç»“æž„</a></dt><dt>æœç´¢å’Œæ›¿æ¢ã€å­—ç¬¦ä¸²ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1180">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>shellï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1203">é‡è¦çš„æ‚é¡¹å‡½æ•°</a></dt><dt>æŽ’åºï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1201">é‡è¦çš„æ‚é¡¹å‡½æ•°</a></dt><dt>æºåˆ°å¯¹è±¡ï¼Œ<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1394">éžé€’å½’ make</a></dt><dt>ç©ºé—´é—®é¢˜ï¼Œ<a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1435">ç®¡ç†ç¨‹åºå’Œæ–‡ä»¶</a></dt><dt>å­—ç¬¦ä¸²å‡½æ•°,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1167">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>æ¡å¸¦ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1264">ä¸å¤ªé‡è¦çš„æ‚é¡¹åŠŸèƒ½</a></dt><dt>å‰¥ç¦»ã€ç©ºç™½åˆ é™¤ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1113">æ¡ä»¶å’ŒåŒ…å«å¤„ç†</a></dt><dt>substï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1183">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>åŽç¼€ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1224">æ–‡ä»¶ååŠŸèƒ½</a></dt><dt>ç”¨æˆ·å®šä¹‰,<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1045">å˜é‡å’Œå®</a>,<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1140">ç”¨æˆ·å®šä¹‰å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1153">ç”¨æˆ·å®šä¹‰å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1146">ç”¨æˆ·å®šä¹‰å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1278">é«˜çº§ç”¨æˆ·å®šä¹‰å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1299">ä¼ é€’å‚æ•°</a>,<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1582">ç”¨æˆ·å®šä¹‰å‡½æ•°</a></dt><dd><dl><dt>é«˜çº§ã€<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1278">é«˜çº§ç”¨æˆ·å®šä¹‰å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1299">ä¼ é€’å‚æ•°</a></dt><dt>Linux å†…æ ¸ makefileã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1582">ç”¨æˆ·å®šä¹‰å‡½æ•°</a></dt><dt>å‚æ•°å’Œ<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1146">ç”¨æˆ·å®šä¹‰çš„å‡½æ•°</a></dt><dt>å˜é‡ã€<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1045">å˜é‡å’Œå®</a></dt></dl></dd><dt>è­¦å‘Šï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1272">ä¸å¤ªé‡è¦çš„æ‚é¡¹åŠŸèƒ½</a></dt><dt>ç©ºæ ¼æ“ä½œã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1190">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>é€šé…ç¬¦ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1214">æ–‡ä»¶åå‡½æ•°</a></dt><dt>é€šé…ç¬¦ç©ºæ ¼ï¼Œ<a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1433">ç®¡ç†ç¨‹åºå’Œæ–‡ä»¶</a></dt><dt>è¯è¡¨ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1198">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>å•è¯ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1192">å­—ç¬¦ä¸²å‡½æ•°</a></dt></dl></dd><dd><dl><dt>add-manifest, <a class="indexterm" href="#OEBPS/ch09s04.html.make3-CHP-9-ITERM-1509">Managing Jars</a></dt><dt>addprefix, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1235">Filename Functions</a></dt><dt>addsuffix, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1232">Filename Functions</a></dt><dt>assert, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1252">Flow Control</a></dt><dt>basename, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1229">Filename Functions</a></dt><dt>build-classpath, <a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1504">Setting CLASSPATH</a></dt><dt>built-in, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1155">Built-in Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1276">Less Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1158">Built-in Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1161">Built-in Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1165">String Functions</a></dt><dd><dl><dt>patterns as arguments, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1161">Built-in Functions</a></dt><dt>string functions, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1165">String Functions</a></dt><dt>syntax, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1158">Built-in Functions</a></dt></dl></dd><dt>calling, wildcards and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-857">Wildcards</a></dt><dt>compile-bean, <a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1516">Enterprise JavaBeans</a></dt><dt>counter, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-922">Finding Files with VPATH and vpath</a></dt><dt>defslot, <a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1629">Data Structures</a></dt><dt>dir, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1218">Filename Functions</a></dt><dt>ejb-rule, <a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1520">Enterprise JavaBeans</a></dt><dt>error, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1247">Flow Control</a></dt><dt>eval, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1286">eval and value</a></dt><dt>filter, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1170">String Functions</a></dt><dt>filter-out, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1173">String Functions</a></dt><dt>findstring, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1176">String Functions</a></dt><dt>firstword, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1195">String Functions</a></dt><dt>flow control, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1239">Flow Control</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1241">Flow Control</a></dt><dt>foreach, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1258">Flow Control</a></dt><dt>generated-source, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1396">Nonrecursive make</a></dt><dt>hooks, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1293">Hooking Functions</a></dt><dt>if, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1244">Flow Control</a></dt><dt>join, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1238">Filename Functions</a></dt><dt>library, declarations, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-924">Finding Files with VPATH and vpath</a></dt><dt>make-library, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1390">Nonrecursive make</a></dt><dt>miscellaneous, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1265">Less Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1274">Less Important Miscellaneous Functions</a></dt><dt>notdir, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1221">Filename Functions</a></dt><dt>origin, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1269">Less Important Miscellaneous Functions</a></dt><dt>parameters, passing to, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1297">Passing Parameters</a></dt><dt>patsubst, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1185">String Functions</a></dt><dt>remote-file, <a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1627">Data Structures</a></dt><dt>search and replace, strings, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1180">String Functions</a></dt><dt>shell, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1203">Important Miscellaneous Functions</a></dt><dt>sort, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1201">Important Miscellaneous Functions</a></dt><dt>source-to-object, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1394">Nonrecursive make</a></dt><dt>space-to-question, <a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1435">Managing Programs and Files</a></dt><dt>string functions, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1167">String Functions</a></dt><dt>strip, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1264">Less Important Miscellaneous Functions</a></dt><dt>strip, whitespace removal, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1113">Conditional and include Processing</a></dt><dt>subst, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1183">String Functions</a></dt><dt>suffix, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1224">Filename Functions</a></dt><dt>user-defined, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1045">Variables and Macros</a>, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1140">User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1153">User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1146">User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1278">Advanced User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1299">Passing Parameters</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1582">User-Defined Functions</a></dt><dd><dl><dt>advanced, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1278">Advanced User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1299">Passing Parameters</a></dt><dt>Linux kernel makefile, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1582">User-Defined Functions</a></dt><dt>parameters and, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1146">User-Defined Functions</a></dt><dt>variables, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1045">Variables and Macros</a></dt></dl></dd><dt>warning, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1272">Less Important Miscellaneous Functions</a></dt><dt>whitespace manipulation, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1190">String Functions</a></dt><dt>wildcard, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1214">Filename Functions</a></dt><dt>wildcard-spaces, <a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1433">Managing Programs and Files</a></dt><dt>wordlist, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1198">String Functions</a></dt><dt>words, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1192">String Functions</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>G</h3><h3>G</h3><dl><dt>ç”Ÿæˆæºå‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1395">éžé€’å½’ make</a></dt><dt>generated-source function, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1395">Nonrecursive make</a></dt><dt>ç”Ÿæˆä¾èµ–å…³ç³»ï¼Œ<a class="indexterm" href="#OEBPS/ch08s03.html.make3-CHP-8-ITERM-1449">ä¾èµ–ç”Ÿæˆ</a></dt><dt>generating dependencies, <a class="indexterm" href="#OEBPS/ch08s03.html.make3-CHP-8-ITERM-1449">Dependency Generation</a></dt><dt>é€šé…ç¬¦ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-845">é€šé…ç¬¦</a></dt><dt>globbing, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-845">Wildcards</a></dt><dt>GNU è‡ªç”±æ–‡æ¡£è®¸å¯è¯ã€<a class="indexterm" href="#OEBPS/apc.html.make3-APP-C-ITERM-1635">GNU è‡ªç”±æ–‡æ¡£è®¸å¯è¯ â€” GNU é¡¹ç›® â€” è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼š (FSF)</a>ï¼Œ<a class="indexterm" href="#OEBPS/apcs11.html.make3-APP-C-ITERM-1636">10. æœ¬è®¸å¯è¯çš„æœªæ¥ä¿®è®¢ç‰ˆ</a></dt><dt>GNU Free Documentation License, <a class="indexterm" href="#OEBPS/apc.html.make3-APP-C-ITERM-1635">GNU Free Documentation Licenseâ€”GNU Projectâ€”Free Software
      Foundation (FSF)</a>, <a class="indexterm" href="#OEBPS/apcs11.html.make3-APP-C-ITERM-1636">10. FUTURE REVISIONS OF THIS LICENSE</a></dt><dt>grep å‘½ä»¤ã€å˜é‡å’Œ<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1355">å‘½ä»¤çŽ¯å¢ƒ</a></dt><dt>grep command, variables and, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1355">Command Environment</a></dt></dl></div><div class="indexdiv"><h3>H</h3><h3>H</h3><dl><dt>å¤´æ–‡ä»¶ã€åŒ…å«ç›®å½•ã€<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-927">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a></dt><dt>header files, include directory, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-927">Finding Files with VPATH and vpath</a></dt><dt>Hello World makefile æ–‡ä»¶ï¼Œ<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-790">å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile</a></dt><dt>Hello World makefile file, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-790">How to Write a Simple Makefile</a></dt><dt>help å‘½ä»¤ï¼Œ<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-987">ä¸€ä¸ªç®€å•çš„å¸®åŠ©å‘½ä»¤</a></dt><dt>help commands, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-987">A Simple Help Command</a></dt><dt>--help é€‰é¡¹ï¼Œ<a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1614">è¿è¡Œ make</a></dt><dt>--help option, <a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1614">Running make</a></dt><dt>ä¸»ç›®å½•ã€^ï¼ˆæ³¢å½¢ç¬¦ï¼‰å’Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-854">é€šé…ç¬¦</a></dt><dt>home directory, ^ (tilde) and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-854">Wildcards</a></dt><dt>é’©å­ã€å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1294">æŒ‚é’©å‡½æ•°</a></dt><dt>hooks, functions, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1294">Hooking Functions</a></dt></dl></div><div class="indexdiv"><h3>æˆ‘</h3><h3>I</h3><dl><dt>IDEï¼ˆé›†æˆå¼€å‘çŽ¯å¢ƒï¼‰ã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1466">Java</a>ã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1489">IDE</a></dt><dt>IDEs (Integrated Development Environments), <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1466">Java</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1489">IDEs</a></dt><dt>if å‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1243">æµé‡æŽ§åˆ¶</a></dt><dt>if function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1243">Flow Control</a></dt><dt>ifeq æ¡ä»¶æŒ‡ä»¤ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1107">Conditional å’Œ include å¤„ç†</a></dt><dt>ifeq conditional directive, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1107">Conditional and include Processing</a></dt><dt>ifneq æ¡ä»¶æŒ‡ä»¤ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1108">Conditional å’Œ include å¤„ç†</a></dt><dt>ifneq conditional directive, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1108">Conditional and include Processing</a></dt><dt>ç«‹å³æ‰©å±•ï¼Œ<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1070">å½“å˜é‡æ‰©å±•æ—¶</a></dt><dt>immediate expansion, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1070">When Variables Are Expanded</a></dt><dt>éšå¼è§„åˆ™,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-835">è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-965">éšå¼è§„åˆ™æ•°æ®åº“</a>,<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-967">ä½¿ç”¨éšå¼è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-981">æºä»£ç ç®¡ç†çš„éšå¼è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-985">æºä»£ç ç®¡ç†çš„éšå¼è§„åˆ™</a></dt><dt>implicit rules, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-835">Rules</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-965">The Implicit Rules Database</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-967">Working with Implicit Rules</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-981">Implicit Rules for Source Control</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-985">Implicit Rules for Source Control</a></dt><dd><dl><dt>å†…ç½®ï¼Œ<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-967">ä½¿ç”¨éšå¼è§„åˆ™</a></dt><dt>æºä»£ç æŽ§åˆ¶å’Œï¼Œ<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-981">æºä»£ç æŽ§åˆ¶çš„éšå¼è§„åˆ™</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-985">æºä»£ç æŽ§åˆ¶çš„éšå¼è§„åˆ™</a></dt><dd><dl><dt>CVSï¼Œ<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-985">æºä»£ç æŽ§åˆ¶çš„éšå¼è§„åˆ™</a></dt></dl></dd></dl></dd><dd><dl><dt>built-in, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-967">Working with Implicit Rules</a></dt><dt>source control and, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-981">Implicit Rules for Source Control</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-985">Implicit Rules for Source Control</a></dt><dd><dl><dt>CVS, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-985">Implicit Rules for Source Control</a></dt></dl></dd></dl></dd><dt>include æŒ‡ä»¤ã€<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-929">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1102">æ¡ä»¶å’Œ include å¤„ç†</a>ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1114">include æŒ‡ä»¤</a>ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1117">include å’Œä¾èµ–é¡¹</a>ã€<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1397">éžé€’å½’ make</a></dt><dt>include directive, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-929">Finding Files with VPATH and vpath</a>, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1102">Conditional and include Processing</a>, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1114">The include Directive</a>, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1117">include and Dependencies</a>, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1397">Nonrecursive make</a></dt><dd><dl><dt>ä¾èµ–å…³ç³»ï¼Œ<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1117">åŒ…æ‹¬å’Œä¾èµ–å…³ç³»</a></dt><dt>å¤´æ–‡ä»¶ï¼Œ<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-929">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a></dt><dt>ä¼˜åŒ–ï¼Œ<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1397">éžé€’å½’make</a></dt></dl></dd><dd><dl><dt>dependencies and, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1117">include and Dependencies</a></dt><dt>header files, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-929">Finding Files with VPATH and vpath</a></dt><dt>optimization, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1397">Nonrecursive make</a></dt></dl></dd><dt>åŒ…æ‹¬å¤„ç†ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1101">æ¡ä»¶å’ŒåŒ…æ‹¬å¤„ç†</a></dt><dt>include processing, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1101">Conditional and include Processing</a></dt><dt>--include-dir é€‰é¡¹ï¼Œ<a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1615">è¿è¡Œ make</a></dt><dt>--include-dir
                option, <a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1615">Running make</a></dt><dt>é€’å¢žã€<a class="indexterm" href="#OEBPS/apbs02.html.make3-APP-B-ITERM-1634">ç®—æœ¯</a></dt><dt>incrementing, <a class="indexterm" href="#OEBPS/apbs02.html.make3-APP-B-ITERM-1634">Arithmetic</a></dt><dt>ä¿¡æ¯ç›®æ ‡ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-884">è™šå‡ç›®æ ‡</a></dt><dt>info target, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-884">Phony Targets</a></dt><dt>åˆå§‹åŒ–ã€æ€§èƒ½å’Œ<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1545">å»¶è¿Ÿåˆå§‹åŒ–</a></dt><dt>initialization, performance and, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1545">Lazy Initialization</a></dt><dt>è¾“å…¥æ–‡ä»¶ã€æ–‡æœ¬æ‰“å°ã€<a class="indexterm" href="#OEBPS/ch01s03.html.make3-CHP-1-ITERM-812">æœ€å°åŒ–é‡å»º</a></dt><dt>input files, text printing, <a class="indexterm" href="#OEBPS/ch01s03.html.make3-CHP-1-ITERM-812">Minimizing Rebuilds</a></dt><dt>å®‰è£…ç›®æ ‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-880">å‡ç›®æ ‡</a></dt><dt>install target, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-880">Phony Targets</a></dt><dt>å®‰è£…ç¨‹åºã€å‚è€ƒç‰ˆæœ¬å’Œ<a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1464">å‚è€ƒç‰ˆæœ¬ã€åº“å’Œå®‰è£…ç¨‹åº</a></dt><dt>installers, reference builds and, <a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1464">Reference Builds, Libraries, and Installers</a></dt><dt>æŽ¥å£ã€è™šå‡ç›®æ ‡å’Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-877">è™šå‡ç›®æ ‡</a></dt><dt>interfaces, phony targets and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-877">Phony Targets</a></dt><dt>ä¸­é—´æ–‡ä»¶ã€é“¾æŽ¥è§„åˆ™ä»¥åŠ<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-972">ä½¿ç”¨éšå¼è§„åˆ™</a></dt><dt>intermediate files, chaining rules and, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-972">Working with Implicit Rules</a></dt><dt>.INTERMEDIATE ç›®æ ‡ä¿®é¥°ç¬¦ï¼Œ<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-996">ç‰¹æ®Šç›®æ ‡</a></dt><dt>.INTERMEDIATE
                  target modifier, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-996">Special Targets</a></dt><dt>è°ƒç”¨ make,<a class="indexterm" href="#OEBPS/ch01s04.html.make3-CHP-1-ITERM-818">è°ƒç”¨ make</a></dt><dt>invoking make, <a class="indexterm" href="#OEBPS/ch01s04.html.make3-CHP-1-ITERM-818">Invoking make</a></dt></dl></div><div class="indexdiv"><h3>J</h3><h3>J</h3><dl><dt>jar ç¨‹åºã€<a class="indexterm" href="#OEBPS/ch09s04.html.make3-CHP-9-ITERM-1507">ç®¡ç† Jars</a>ã€<a class="indexterm" href="#OEBPS/ch09s05.html.make3-CHP-9-ITERM-1510">å‚è€ƒæ ‘å’Œç¬¬ä¸‰æ–¹ Jars</a>ã€<a class="indexterm" href="#OEBPS/ch09s05.html.make3-CHP-9-ITERM-1512">å‚è€ƒæ ‘å’Œç¬¬ä¸‰æ–¹ Jars</a></dt><dt>jar program, <a class="indexterm" href="#OEBPS/ch09s04.html.make3-CHP-9-ITERM-1507">Managing Jars</a>, <a class="indexterm" href="#OEBPS/ch09s05.html.make3-CHP-9-ITERM-1510">Reference Trees and Third-Party Jars</a>, <a class="indexterm" href="#OEBPS/ch09s05.html.make3-CHP-9-ITERM-1512">Reference Trees and Third-Party Jars</a></dt><dd><dl><dt>å‚è€ƒæ ‘ã€<a class="indexterm" href="#OEBPS/ch09s05.html.make3-CHP-9-ITERM-1510">å‚è€ƒæ ‘å’Œç¬¬ä¸‰æ–¹ Jar</a></dt><dt>ç¬¬ä¸‰æ–¹ã€<a class="indexterm" href="#OEBPS/ch09s05.html.make3-CHP-9-ITERM-1512">å‚è€ƒæ ‘å’Œç¬¬ä¸‰æ–¹ Jar</a></dt></dl></dd><dd><dl><dt>reference trees, <a class="indexterm" href="#OEBPS/ch09s05.html.make3-CHP-9-ITERM-1510">Reference Trees and Third-Party Jars</a></dt><dt>third-party, <a class="indexterm" href="#OEBPS/ch09s05.html.make3-CHP-9-ITERM-1512">Reference Trees and Third-Party Jars</a></dt></dl></dd><dt>jars (Java)ï¼Œ<a class="indexterm" href="#OEBPS/ch09s04.html.make3-CHP-9-ITERM-1506">ç®¡ç† Jars</a></dt><dt>jars (Java), <a class="indexterm" href="#OEBPS/ch09s04.html.make3-CHP-9-ITERM-1506">Managing Jars</a></dt><dt>Javaã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1467">Java</a>ã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1468">Java</a>ã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1471">Java</a>ã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1474">Ant</a>ã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1479">Ant</a>ã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1481">Ant</a>ã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1484">Ant</a>ã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1488">Ant</a>ã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1490">IDE</a>ã€<a class="indexterm" href="#OEBPS/ch09s02.html.make3-CHP-9-ITERM-1494">é€šç”¨ Java Makefile</a>ã€<a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1496">ä½¿ç”¨ä¾èµ–é¡¹è¿›è¡Œç¼–è¯‘</a>ã€<a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1500">è®¾ç½® CLASSPATH</a>ã€<a class="indexterm" href="#OEBPS/ch09s04.html.make3-CHP-9-ITERM-1505">ç®¡ç† Jars</a>ã€<a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1513">Enterprise JavaBean</a></dt><dt>Java, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1467">Java</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1468">Java</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1471">Java</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1474">Ant</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1479">Ant</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1481">Ant</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1484">Ant</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1488">Ant</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1490">IDEs</a>, <a class="indexterm" href="#OEBPS/ch09s02.html.make3-CHP-9-ITERM-1494">A Generic Java Makefile</a>, <a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1496">Compiling with Dependencies</a>, <a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1500">Setting CLASSPATH</a>, <a class="indexterm" href="#OEBPS/ch09s04.html.make3-CHP-9-ITERM-1505">Managing Jars</a>, <a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1513">Enterprise JavaBeans</a></dt><dd><dl><dt>èš‚èšï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1474">èš‚èš</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1479">èš‚èš</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1481">èš‚èš</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1484">èš‚èš</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1488">èš‚èš</a></dt><dd><dl><dt>æž„å»ºæ–‡ä»¶ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1479">èš‚èš</a></dt><dt>mkdir ç¨‹åºã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1484">Ant</a></dt><dt>å¯ç§»æ¤æ€§ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1488">èš‚èš</a></dt><dt>ä»»åŠ¡ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1481">èš‚èš</a></dt></dl></dd><dt>æ—¥é£Ÿï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1467">Java</a></dt><dt>EJBï¼ˆä¼ä¸š JavaBeanï¼‰ã€<a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1513">ä¼ä¸š JavaBean</a></dt><dt>IDEã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1490">IDE</a></dt><dt>ç½å­å’Œ<a class="indexterm" href="#OEBPS/ch09s04.html.make3-CHP-9-ITERM-1505">ç®¡ç†ç½å­</a></dt><dt>ä½¿å’Œï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1468">Java</a></dt><dt>makefileï¼ˆé€šç”¨ï¼‰ã€<a class="indexterm" href="#OEBPS/ch09s02.html.make3-CHP-9-ITERM-1494">é€šç”¨ Java Makefile</a>ã€<a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1496">ä½¿ç”¨ä¾èµ–é¡¹è¿›è¡Œç¼–è¯‘</a>ã€<a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1500">è®¾ç½® CLASSPATH</a></dt><dd><dl><dt>CLASSPATHå˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1500">è®¾ç½®CLASSPATH</a></dt><dt>ä¾èµ–å…³ç³»ä»¥åŠ<a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1496">ä½¿ç”¨ä¾èµ–å…³ç³»è¿›è¡Œç¼–è¯‘</a></dt></dl></dd><dt>åŒ…ã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1471">Java</a></dt></dl></dd><dd><dl><dt>Ant, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1474">Ant</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1479">Ant</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1481">Ant</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1484">Ant</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1488">Ant</a></dt><dd><dl><dt>build file, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1479">Ant</a></dt><dt>mkdir program, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1484">Ant</a></dt><dt>portability, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1488">Ant</a></dt><dt>tasks, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1481">Ant</a></dt></dl></dd><dt>Eclipse, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1467">Java</a></dt><dt>EJB (Enterprise JavaBeans), <a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1513">Enterprise JavaBeans</a></dt><dt>IDEs, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1490">IDEs</a></dt><dt>jars and, <a class="indexterm" href="#OEBPS/ch09s04.html.make3-CHP-9-ITERM-1505">Managing Jars</a></dt><dt>make and, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1468">Java</a></dt><dt>makefile (generic), <a class="indexterm" href="#OEBPS/ch09s02.html.make3-CHP-9-ITERM-1494">A Generic Java Makefile</a>, <a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1496">Compiling with Dependencies</a>, <a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1500">Setting CLASSPATH</a></dt><dd><dl><dt>CLASSPATH variable, <a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1500">Setting CLASSPATH</a></dt><dt>dependecies and, <a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1496">Compiling with Dependencies</a></dt></dl></dd><dt>packages, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1471">Java</a></dt></dl></dd><dt>JBuilderã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1493">IDE</a></dt><dt>JBuilder, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1493">IDEs</a></dt><dt>JITï¼ˆå³æ—¶ï¼‰ä¼˜åŒ–ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1469">Java</a></dt><dt>JIT (just-in-time) optimization, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1469">Java</a></dt><dt>è¿žæŽ¥å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1237">æ–‡ä»¶åå‡½æ•°</a></dt><dt>join function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1237">Filename Functions</a></dt><dt>--just-print é€‰é¡¹ï¼Œ<a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1617">è¿è¡Œ make</a></dt><dt>--just-print
                option, <a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1617">Running make</a></dt><dt>--just-print é€‰é¡¹ï¼Œè°ƒè¯•ï¼Œ<a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1588">--just-print</a></dt><dt>--just-print
                option, debugging, <a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1588">â€”just-print</a></dt><dt>JVMï¼ˆJavaè™šæ‹Ÿæœºï¼‰ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1470">Java</a></dt><dt>JVM (Java virtual machine), <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1470">Java</a></dt></dl></div><div class="indexdiv"><h3>K</h3><h3>K</h3><dl><dt>--keep-going é€‰é¡¹ï¼Œ<a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1616">è¿è¡Œ make</a></dt><dt>--keep-going
                option, <a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1616">Running make</a></dt><dt>ç»ˆæ­¢è¿›ç¨‹ã€ç”¨æˆ·å®šä¹‰çš„å‡½æ•°å’Œ<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1142">ç”¨æˆ·å®šä¹‰çš„å‡½æ•°</a></dt><dt>killing processes, user-defined functions and, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1142">User-Defined Functions</a></dt></dl></div><div class="indexdiv"><h3>L</h3><h3>L</h3><dl><dt>å¤§åž‹é¡¹ç›®ã€<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1363">ç®¡ç†å¤§åž‹é¡¹ç›®</a>ã€<a class="indexterm" href="#OEBPS/ch06s05.html.make3-CHP-6-ITERM-1411">è‡ªåŠ¨åŒ–æž„å»ºå’Œæµ‹è¯•</a></dt><dt>large projects, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1363">Managing Large Projects</a>, <a class="indexterm" href="#OEBPS/ch06s05.html.make3-CHP-6-ITERM-1411">Automating Builds and Testing</a></dt><dt>åº“ã€<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1002">ç‰¹æ®Šç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1012">ç®¡ç†åº“</a>ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1018">åˆ›å»ºå’Œæ›´æ–°åº“</a>ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1019">åˆ›å»ºå’Œæ›´æ–°åº“</a>ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1022">ä½¿ç”¨åº“ä½œä¸ºå…ˆå†³æ¡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1025">ä½¿ç”¨åº“ä½œä¸ºå…ˆå†³æ¡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1366">é€’å½’ make</a>ã€<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1392">éžé€’å½’ make</a>ã€<a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1463">å‚è€ƒæž„å»ºã€åº“å’Œå®‰è£…ç¨‹åº</a></dt><dt>libraries, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1002">Special Targets</a>, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1012">Managing Libraries</a>, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1018">Creating and Updating Libraries</a>, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1019">Creating and Updating Libraries</a>, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1022">Using Libraries as Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1025">Using Libraries as Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1366">Recursive make</a>, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1392">Nonrecursive make</a>, <a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1463">Reference Builds, Libraries, and Installers</a></dt><dd><dl><dt>æ¡£æ¡ˆé¦†ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1012">å›¾ä¹¦é¦†ç®¡ç†</a></dt><dt>å¾ªçŽ¯å¼•ç”¨ï¼Œ<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1025">ä½¿ç”¨åº“ä½œä¸ºå…ˆå†³æ¡ä»¶</a></dt><dt>åˆ›å»ºã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1018">åˆ›å»ºå’Œæ›´æ–°åº“</a></dt><dt>make-library å‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1392">éžé€’å½’ make</a></dt><dt>ä½œä¸ºå…ˆå†³æ¡ä»¶ï¼Œ<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1022">ä½¿ç”¨åº“ä½œä¸ºå…ˆå†³æ¡ä»¶</a></dt><dt>é€’å½’å’Œï¼Œ<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1366">é€’å½’make</a></dt><dt>å‚è€ƒæž„å»ºã€<a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1463">å‚è€ƒæž„å»ºã€åº“å’Œå®‰è£…ç¨‹åº</a></dt><dt>.SECONDARY ç›®æ ‡ä¿®é¥°ç¬¦ï¼Œ<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1002">ç‰¹æ®Šç›®æ ‡</a></dt><dt>æ›´æ–°ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1019">åˆ›å»ºå’Œæ›´æ–°åº“</a></dt></dl></dd><dd><dl><dt>archive libraries, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1012">Managing Libraries</a></dt><dt>circular references, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1025">Using Libraries as Prerequisites</a></dt><dt>creating, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1018">Creating and Updating Libraries</a></dt><dt>make-library function, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1392">Nonrecursive make</a></dt><dt>as prerequisites, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1022">Using Libraries as Prerequisites</a></dt><dt>recursion and, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1366">Recursive make</a></dt><dt>reference builds and, <a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1463">Reference Builds, Libraries, and Installers</a></dt><dt>.SECONDARY
                  target modifier, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1002">Special Targets</a></dt><dt>updating, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1019">Creating and Updating Libraries</a></dt></dl></dd><dt>åº“å‡½æ•°ï¼Œå¯é‡ç”¨ï¼Œ<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-923">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a></dt><dt>library functions, reusable, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-923">Finding Files with VPATH and vpath</a></dt><dt>åº“ç®¡ç†ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1010">ç®¡ç†åº“</a>ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1016">åˆ›å»ºå’Œæ›´æ–°åº“</a>ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1017">åˆ›å»ºå’Œæ›´æ–°åº“</a>ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1030">åŒå†’å·è§„åˆ™</a></dt><dt>library management, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1010">Managing Libraries</a>, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1016">Creating and Updating Libraries</a>, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1017">Creating and Updating Libraries</a>, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1030">Double-Colon Rules</a></dt><dd><dl><dt>æ¡£æ¡ˆå›¾ä¹¦é¦†å’Œ<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1010">ç®¡ç†å›¾ä¹¦é¦†</a></dt><dt>åˆ›å»ºåº“ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1017">åˆ›å»ºå’Œæ›´æ–°åº“</a></dt><dt>åŒå†’å·è§„åˆ™,<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1030">åŒå†’å·è§„åˆ™</a></dt><dt>æ›´æ–°åº“ï¼Œ<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1016">åˆ›å»ºå’Œæ›´æ–°åº“</a></dt></dl></dd><dd><dl><dt>archive libraries and, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1010">Managing Libraries</a></dt><dt>creating libraries, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1017">Creating and Updating Libraries</a></dt><dt>double-colon rules, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1030">Double-Colon Rules</a></dt><dt>updating libraries, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1016">Creating and Updating Libraries</a></dt></dl></dd><dt>çº¿è·¯ç»ˆç«¯ã€Cygwinã€<a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1426">çº¿è·¯ç»ˆç«¯</a></dt><dt>line termination, Cygwin, <a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1426">Line Termination</a></dt><dt>Linux å†…æ ¸ makefileã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1569">Linux å†…æ ¸ Makefile</a>ã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1570">å‘½ä»¤è¡Œé€‰é¡¹</a>ã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1573">é…ç½®ä¸Žæž„å»º</a>ã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1577">ç®¡ç†å‘½ä»¤å›žæ˜¾</a>ã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1579">ç”¨æˆ·å®šä¹‰å‡½æ•°</a></dt><dt>Linux kernel makefile, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1569">The Linux Kernel Makefile</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1570">Command-Line Options</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1573">Configuration Versus Building</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1577">Managing Command Echo</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1579">User-Defined Functions</a></dt><dd><dl><dt>å‘½ä»¤å›žæ˜¾ï¼Œ<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1577">ç®¡ç†å‘½ä»¤å›žæ˜¾</a></dt><dt>å‘½ä»¤è¡Œé€‰é¡¹,<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1570">å‘½ä»¤è¡Œé€‰é¡¹</a></dt><dt>é…ç½®ä¸Žæž„å»ºï¼Œ<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1573">é…ç½®ä¸Žæž„å»º</a></dt><dt>ç”¨æˆ·å®šä¹‰å‡½æ•°,<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1579">ç”¨æˆ·å®šä¹‰å‡½æ•°</a></dt></dl></dd><dd><dl><dt>command echo, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1577">Managing Command Echo</a></dt><dt>command-line options, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1570">Command-Line Options</a></dt><dt>configuration versus building, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1573">Configuration Versus Building</a></dt><dt>user-defined functions, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1579">User-Defined Functions</a></dt></dl></dd><dt>é•¿å‘½ä»¤ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1312">è¿žç»­é•¿å‘½ä»¤</a></dt><dt>long commands, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1312">Continuing Long Commands</a></dt><dt>å¾ªçŽ¯ã€foreachã€<a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1631">æ•°æ®ç»“æž„</a></dt><dt>loops, foreach, <a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1631">Data Structures</a></dt></dl></div><div class="indexdiv"><h3>ä¸­å·</h3><h3>M</h3><dl><dt>m4 å®ã€ä¹¦ç± makefile å’Œ<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1558">XML é¢„å¤„ç†</a></dt><dt>m4 macros, book makefile and, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1558">XML Preprocessing</a></dt><dt>å®,<a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1059">å®</a>,<a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1063">å®</a>,<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1068">å½“å˜é‡å±•å¼€æ—¶</a>,<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1076">å½“å˜é‡å±•å¼€æ—¶</a>,<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1148">ç”¨æˆ·å®šä¹‰å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1151">ç”¨æˆ·å®šä¹‰å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1284">é«˜çº§ç”¨æˆ·å®šä¹‰å‡½æ•°</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1288">eval å’Œ value</a> , <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1292">eval å’Œ value</a></dt><dt>macros, <a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1059">Macros</a>, <a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1063">Macros</a>, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1068">When Variables Are Expanded</a>, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1076">When Variables Are Expanded</a>, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1148">User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1151">User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1284">Advanced User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1288">eval and value</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1292">eval and value</a></dt><dd><dl><dt>è°ƒè¯•å’Œ<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1284">é«˜çº§ç”¨æˆ·å®šä¹‰å‡½æ•°</a></dt><dt>å®šä¹‰æŒ‡ä»¤ã€<a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1063">å®</a></dt><dt>å®šä¹‰ï¼Œ<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1076">å½“å˜é‡æ‰©å±•æ—¶</a></dt><dt>æ‰©å±•ï¼Œ<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1068">å½“å˜é‡æ‰©å±•æ—¶</a></dt><dt>å®žçŽ°ã€èŒƒå›´ç•Œå®šå’Œ<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1151">ç”¨æˆ·å®šä¹‰çš„å‡½æ•°</a></dt><dt>ç®€ä»‹ã€<a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1059">å®</a></dt><dt>ä»Žå¦ä¸€ä¸ªå®ã€<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1148">ç”¨æˆ·å®šä¹‰å‡½æ•°è°ƒç”¨</a></dt><dt>ç¨‹åºå˜é‡ã€<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1288">eval å’Œ value</a></dt><dt>è§„åˆ™ã€<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1292">è¯„ä¼°å’Œä»·å€¼</a></dt></dl></dd><dd><dl><dt>debugging and, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1284">Advanced User-Defined Functions</a></dt><dt>define directive, <a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1063">Macros</a></dt><dt>defining, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1076">When Variables Are Expanded</a></dt><dt>expanding, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1068">When Variables Are Expanded</a></dt><dt>implementing, scoping and, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1151">User-Defined Functions</a></dt><dt>introduction, <a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1059">Macros</a></dt><dt>invoking from another macro, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1148">User-Defined Functions</a></dt><dt>program-variables, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1288">eval and value</a></dt><dt>rules in, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1292">eval and value</a></dt></dl></dd><dt>makeã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-786">å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile</a>ã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-787">å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile</a>ã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-801">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-808">ä¾èµ–é¡¹æ£€æŸ¥</a>ã€<a class="indexterm" href="#OEBPS/ch01s04.html.make3-CHP-1-ITERM-817">è°ƒç”¨ make</a>ã€<a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-824">åŸºæœ¬ Makefile è¯­æ³•</a>ã€<a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-825">åŸºæœ¬ Makefile è¯­æ³•</a></dt><dt>make, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-786">How to Write a Simple Makefile</a>, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-787">How to Write a Simple Makefile</a>, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-801">Targets and Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-808">Dependency Checking</a>, <a class="indexterm" href="#OEBPS/ch01s04.html.make3-CHP-1-ITERM-817">Invoking make</a>, <a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-824">Basic Makefile Syntax</a>, <a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-825">Basic Makefile Syntax</a></dt><dd><dl><dt>è‡ªåŠ¨åŒ–ä»¥åŠ<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-786">å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile</a></dt><dt>å‘½ä»¤æ‰§è¡Œã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-801">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a></dt><dt>æ³¨é‡Šï¼Œ<a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-824">åŸºæœ¬ Makefile è¯­æ³•</a></dt><dt>ä¾èµ–æ€§æ£€æŸ¥,<a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-808">ä¾èµ–æ€§æ£€æŸ¥</a></dt><dt>è½¬ä¹‰å­—ç¬¦ï¼Œ<a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-825">åŸºæœ¬ Makefile è¯­æ³•</a></dt><dt>è°ƒç”¨ï¼Œ<a class="indexterm" href="#OEBPS/ch01s04.html.make3-CHP-1-ITERM-817">è°ƒç”¨ make</a></dt><dt>è„šæœ¬ä»¥åŠ<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-787">å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile</a></dt></dl></dd><dd><dl><dt>automation and, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-786">How to Write a Simple Makefile</a></dt><dt>command execution, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-801">Targets and Prerequisites</a></dt><dt>comments, <a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-824">Basic Makefile Syntax</a></dt><dt>dependency checking, <a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-808">Dependency Checking</a></dt><dt>escape character, <a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-825">Basic Makefile Syntax</a></dt><dt>invoking, <a class="indexterm" href="#OEBPS/ch01s04.html.make3-CHP-1-ITERM-817">Invoking make</a></dt><dt>scripts and, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-787">How to Write a Simple Makefile</a></dt></dl></dd><dt>make shell å‘½ä»¤ã€åŸºå‡†æµ‹è¯•å’Œ<a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1531">åŸºå‡†æµ‹è¯•</a></dt><dt>make shell command, benchmarking and, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1531">Benchmarking</a></dt><dt>make-library å‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1391">éžé€’å½’ make</a></dt><dt>make-library function, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1391">Nonrecursive make</a></dt><dt>MAKECMDGOALS å˜é‡ã€<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1132">æ ‡å‡† make å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1135">æ ‡å‡† make å˜é‡</a></dt><dt>MAKECMDGOALS variable, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1132">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1135">Standard make Variables</a></dt><dt>makedepend, <a class="indexterm" href="#OEBPS/ch08s03.html.make3-CHP-8-ITERM-1450">makedepend ç¨‹åº</a></dt><dt>makedepend, <a class="indexterm" href="#OEBPS/ch08s03.html.make3-CHP-8-ITERM-1450">makedepend Programs</a></dt><dt>makefiles,<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-789">å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile</a> ,<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-791">å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile</a> ,<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-802">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a>,<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-806">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a>,<a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-819">åŸºæœ¬ Makefile è¯­æ³•</a>,<a class="indexterm" href="#OEBPS/ch09s02.html.make3-CHP-9-ITERM-1495">é€šç”¨ Java Makefile</a> ,<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1550">ä¹¦ç± Makefile</a> ,<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1553">ä¹¦ç± Makefile</a> , <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1555">XML é¢„å¤„ç†</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1560">XML é¢„å¤„ç†</a>,<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1562">ç”Ÿæˆè¾“å‡º</a>,<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1565">éªŒè¯æºä»£ç </a>ã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1568">Linux å†…æ ¸ Makefile</a>ã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1571">å‘½ä»¤è¡Œé€‰é¡¹</a>ã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1574">é…ç½®ä¸Žæž„å»º</a>ã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1578">ç®¡ç†å‘½ä»¤å›žæ˜¾</a>ã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1580">ç”¨æˆ·å®šä¹‰å‡½æ•°</a></dt><dt>makefiles, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-789">How to Write a Simple Makefile</a>, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-791">How to Write a Simple Makefile</a>, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-802">Targets and Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-806">Targets and Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-819">Basic Makefile Syntax</a>, <a class="indexterm" href="#OEBPS/ch09s02.html.make3-CHP-9-ITERM-1495">A Generic Java Makefile</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1550">The Book Makefile</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1553">The Book Makefile</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1555">XML Preprocessing</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1560">XML Preprocessing</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1562">Generating Output</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1565">Validating the Source</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1568">The Linux Kernel Makefile</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1571">Command-Line Options</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1574">Configuration Versus Building</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1578">Managing Command Echo</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1580">User-Defined Functions</a></dt><dd><dl><dt>book makefileã€<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1550">Book Makefile</a>ã€<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1553">Book Makefile</a>ã€<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1555">XML é¢„å¤„ç†</a>ã€<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1560">XML é¢„å¤„ç†</a>ã€<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1562">ç”Ÿæˆè¾“å‡º</a>ã€<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1565">éªŒè¯æº</a></dt><dd><dl><dt>m4 å®ã€<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1560">XML é¢„å¤„ç†</a></dt><dt>è¾“å‡ºç”Ÿæˆï¼Œ<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1562">ç”Ÿæˆè¾“å‡º</a></dt><dt>æºéªŒè¯ï¼Œ<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1565">éªŒè¯æº</a></dt><dt>XML é¢„å¤„ç†, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1555">XML é¢„å¤„ç†</a></dt></dl></dd><dt>å‘½ä»¤æ‰§è¡Œã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-802">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a></dt><dt>ä½ å¥½ä¸–ç•Œï¼Œ<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-789">å¦‚ä½•ç¼–å†™ä¸€ä¸ªç®€å•çš„ Makefile</a></dt><dt>Javaï¼Œé€šç”¨ï¼Œ<a class="indexterm" href="#OEBPS/ch09s02.html.make3-CHP-9-ITERM-1495">é€šç”¨ Java Makefile</a></dt><dt>Linux å†…æ ¸ã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1568">Linux å†…æ ¸ Makefile</a>ã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1571">å‘½ä»¤è¡Œé€‰é¡¹</a>ã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1574">é…ç½®ä¸Žæž„å»º</a>ã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1578">ç®¡ç†å‘½ä»¤å›žæ˜¾</a>ã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1580">ç”¨æˆ·å®šä¹‰å‡½æ•°</a></dt><dd><dl><dt>å‘½ä»¤å›žæ˜¾å’Œ<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1578">ç®¡ç†å‘½ä»¤å›žæ˜¾</a></dt><dt>å‘½ä»¤è¡Œé€‰é¡¹,<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1571">å‘½ä»¤è¡Œé€‰é¡¹</a></dt><dt>é…ç½®ä¸Žæž„å»ºï¼Œ<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1574">é…ç½®ä¸Žæž„å»º</a></dt><dt>ç”¨æˆ·å®šä¹‰å‡½æ•°,<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1580">ç”¨æˆ·å®šä¹‰å‡½æ•°</a></dt></dl></dd><dt>è¯­æ³•ï¼Œ<a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-819">åŸºæœ¬ Makefile è¯­æ³•</a></dt><dt>ç›®æ ‡ä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-791">å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile</a></dt><dt>è‡ªä¸Šè€Œä¸‹çš„é£Žæ ¼ã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-806">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a></dt></dl></dd><dd><dl><dt>book makefile, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1550">The Book Makefile</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1553">The Book Makefile</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1555">XML Preprocessing</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1560">XML Preprocessing</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1562">Generating Output</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1565">Validating the Source</a></dt><dd><dl><dt>m4 macros, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1560">XML Preprocessing</a></dt><dt>output generation, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1562">Generating Output</a></dt><dt>source validation, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1565">Validating the Source</a></dt><dt>XML preprocessing, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1555">XML Preprocessing</a></dt></dl></dd><dt>command execution, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-802">Targets and Prerequisites</a></dt><dt>Hello World, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-789">How to Write a Simple Makefile</a></dt><dt>Java, generic for, <a class="indexterm" href="#OEBPS/ch09s02.html.make3-CHP-9-ITERM-1495">A Generic Java Makefile</a></dt><dt>Linux kernel, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1568">The Linux Kernel Makefile</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1571">Command-Line Options</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1574">Configuration Versus Building</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1578">Managing Command Echo</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1580">User-Defined Functions</a></dt><dd><dl><dt>command echo and, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1578">Managing Command Echo</a></dt><dt>command-line options, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1571">Command-Line Options</a></dt><dt>configuration versus building, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1574">Configuration Versus Building</a></dt><dt>user-defined functions, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1580">User-Defined Functions</a></dt></dl></dd><dt>syntax, <a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-819">Basic Makefile Syntax</a></dt><dt>targets as command-line arguments, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-791">How to Write a Simple Makefile</a></dt><dt>top-down style, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-806">Targets and Prerequisites</a></dt></dl></dd><dt>MAKEFILE_LIST å˜é‡ã€<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1128">æ ‡å‡† make å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1130">æ ‡å‡† make å˜é‡</a></dt><dt>MAKEFILE_LIST variable, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1128">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1130">Standard make Variables</a></dt><dt>MAKEFLAGS å˜é‡ã€å‘½ä»¤çŽ¯å¢ƒå’Œ<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1343">å‘½ä»¤çŽ¯å¢ƒ</a></dt><dt>MAKEFLAGS variable, command environment and, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1343">Command Environment</a></dt><dt>MAKELEVEL å˜é‡ã€å‘½ä»¤çŽ¯å¢ƒã€<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1347">å‘½ä»¤çŽ¯å¢ƒ</a></dt><dt>MAKELEVEL variable, command environments, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1347">Command Environment</a></dt><dt>MAKE_VERSION å˜é‡ã€<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1119">æ ‡å‡† make å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1122">æ ‡å‡† make å˜é‡</a></dt><dt>MAKE_VERSION variable, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1119">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1122">Standard make Variables</a></dt><dt>åŒ¹é…è§„åˆ™ã€è‡ªåŠ¨å˜é‡ã€<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-902">è‡ªåŠ¨å˜é‡</a></dt><dt>matched rules, automatic variables, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-902">Automatic Variables</a></dt><dt>æ¡£æ¡ˆå›¾ä¹¦é¦†æˆå‘˜ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1013">å›¾ä¹¦é¦†ç®¡ç†</a></dt><dt>members of archive libraries, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1013">Managing Libraries</a></dt><dt>æ‚é¡¹åŠŸèƒ½ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1266">ä¸å¤ªé‡è¦çš„æ‚é¡¹åŠŸèƒ½</a>ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1273">ä¸å¤ªé‡è¦çš„æ‚é¡¹åŠŸèƒ½</a></dt><dt>miscellaneous functions, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1266">Less Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1273">Less Important Miscellaneous Functions</a></dt><dd><dl><dt>è­¦å‘Šï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1273">ä¸å¤ªé‡è¦çš„æ‚é¡¹åŠŸèƒ½</a></dt></dl></dd><dd><dl><dt>warning, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1273">Less Important Miscellaneous Functions</a></dt></dl></dd><dt>mkdirã€Ant (Java)ã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1485">Ant</a></dt><dt>mkdir, Ant (Java), <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1485">Ant</a></dt><dt>æ¨¡å—å®šä¹‰ã€æŸ¥æ‰¾å‘½ä»¤ã€<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1399">éžé€’å½’ make</a></dt><dt>module definition, find command, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1399">Nonrecursive make</a></dt><dt>module.mk åŒ…å«æ–‡ä»¶ï¼Œ<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1389">éžé€’å½’ make</a></dt><dt>module.mk include files, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1389">Nonrecursive make</a></dt><dt>å¤šè¡Œå‘½ä»¤ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1332">é”™è¯¯å’Œä¸­æ–­</a></dt><dt>multiline commands, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1332">Errors and Interrupts</a></dt></dl></div><div class="indexdiv"><h3>æ°®</h3><h3>N</h3><dl><dt>--new-file é€‰é¡¹ï¼Œ<a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1621">è¿è¡Œ make</a></dt><dt>--new-file option, <a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1621">Running make</a></dt><dt>æ¢è¡Œè§„åˆ™ï¼Œ<a class="indexterm" href="#OEBPS/ch01s03.html.make3-CHP-1-ITERM-815">æœ€å°åŒ–é‡å»º</a></dt><dt>newline rule, <a class="indexterm" href="#OEBPS/ch01s03.html.make3-CHP-1-ITERM-815">Minimizing Rebuilds</a></dt><dt>æ— æ“ä½œå‘½ä»¤ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1329">é”™è¯¯å’Œä¸­æ–­</a></dt><dt>no-op commands, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1329">Errors and Interrupts</a></dt><dt>éžé€’å½’makeã€<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1385">éžé€’å½’make</a>ã€<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1388">éžé€’å½’make</a></dt><dt>nonrecursive make, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1385">Nonrecursive make</a>, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1388">Nonrecursive make</a></dt><dd><dl><dt>è™šå‡ç›®æ ‡å’Œ<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1388">éžé€’å½’ make</a></dt></dl></dd><dd><dl><dt>phony targets and, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1388">Nonrecursive make</a></dt></dl></dd><dt>notdir å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1220">æ–‡ä»¶åå‡½æ•°</a></dt><dt>notdir function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1220">Filename Functions</a></dt></dl></div><div class="indexdiv"><h3>æ°§</h3><h3>O</h3><dl><dt>ç›®æ ‡æ–‡ä»¶ã€æ›´æ–°ã€<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-975">è§„åˆ™ç»“æž„</a></dt><dt>object files, updates, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-975">Rule Structure</a></dt><dt>--old-file é€‰é¡¹ï¼Œ<a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1618">è¿è¡Œ make</a></dt><dt>--old-file option, <a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1618">Running make</a></dt><dt>é€‰é¡¹ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1327">é”™è¯¯å’Œä¸­æ–­</a>ã€<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1417">å¯ç§»æ¤æ€§é—®é¢˜</a></dt><dt>options, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1327">Errors and Interrupts</a>, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1417">Portability Issues</a></dt><dd><dl><dt>å‘½ä»¤ã€é”™è¯¯ä»¥åŠ<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1327">é”™è¯¯å’Œä¸­æ–­</a></dt><dt>å¯ç§»æ¤æ€§å’Œ<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1417">å¯ç§»æ¤æ€§é—®é¢˜</a></dt></dl></dd><dd><dl><dt>commands, errors and, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1327">Errors and Interrupts</a></dt><dt>portability and, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1417">Portability Issues</a></dt></dl></dd><dt>åŽŸç‚¹å‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1268">ä¸å¤ªé‡è¦çš„æ‚é¡¹å‡½æ•°</a></dt><dt>origin function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1268">Less Important Miscellaneous Functions</a></dt><dt>è¾“å‡ºï¼Œä¹¦ç± makefile ç¤ºä¾‹ï¼Œ<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1563">ç”Ÿæˆè¾“å‡º</a></dt><dt>output, book makefile example, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1563">Generating Output</a></dt></dl></div><div class="indexdiv"><h3>ç£·</h3><h3>P</h3><dl><dt>åŒ…ã€Javaã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1472">Java</a></dt><dt>packages, Java, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1472">Java</a></dt><dt>å¹¶è¡Œæ€§ã€æ€§èƒ½å’Œ<a class="indexterm" href="#OEBPS/ch10s03.html.make3-CHP-10-ITERM-1547">å¹¶è¡Œæ€§</a></dt><dt>parallelism, performance and, <a class="indexterm" href="#OEBPS/ch10s03.html.make3-CHP-10-ITERM-1547">Parallel make</a></dt><dt>å‚æ•°ã€<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1147">ç”¨æˆ·å®šä¹‰å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1295">ä¼ é€’å‚æ•°</a></dt><dt>parameters, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1147">User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1295">Passing Parameters</a></dt><dd><dl><dt>ä¼ é€’ç»™å‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1295">ä¼ é€’å‚æ•°</a></dt><dt>ç”¨æˆ·å®šä¹‰å‡½æ•°,<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1147">ç”¨æˆ·å®šä¹‰å‡½æ•°</a></dt></dl></dd><dd><dl><dt>passing to functions, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1295">Passing Parameters</a></dt><dt>user-defined functions, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1147">User-Defined Functions</a></dt></dl></dd><dt>æ‹¬å·ã€å˜é‡å’Œã€<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1037">å˜é‡å’Œå®</a>ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1262">æœ‰å…³å˜é‡å’Œæ‹¬å·çš„æ ·å¼æ³¨é‡Š</a></dt><dt>parentheses, variables and, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1037">Variables and Macros</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1262">Style note concerning variables and parentheses</a></dt><dt>è§£æžã€<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1290">eval å’Œ value</a> ,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1301">è§£æžå‘½ä»¤</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1304">è§£æžå‘½ä»¤</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1307">è§£æžå‘½ä»¤</a></dt><dt>parsing, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1290">eval and value</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1301">Parsing Commands</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1304">Parsing Commands</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1307">Parsing Commands</a></dt><dd><dl><dt>å‘½ä»¤,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1301">è§£æžå‘½ä»¤</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1304">è§£æžå‘½ä»¤</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1307">è§£æžå‘½ä»¤</a></dt><dd><dl><dt>å‘½ä»¤è„šæœ¬å’Œ<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1304">è§£æžå‘½ä»¤</a></dt><dt>ç¼–è¾‘å™¨å’Œ<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1307">è§£æžå‘½ä»¤</a></dt></dl></dd><dt>eval å‡½æ•° and, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1290">eval å’Œ value</a></dt></dl></dd><dd><dl><dt>commands, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1301">Parsing Commands</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1304">Parsing Commands</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1307">Parsing Commands</a></dt><dd><dl><dt>command scripts and, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1304">Parsing Commands</a></dt><dt>editors and, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1307">Parsing Commands</a></dt></dl></dd><dt>eval function and, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1290">eval and value</a></dt></dl></dd><dt>éƒ¨åˆ†æºæ ‘,<a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1456">éƒ¨åˆ†æºæ ‘</a></dt><dt>partial source trees, <a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1456">Partial Source Trees</a></dt><dt>å°†å‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1296">ä¼ é€’å‚æ•°</a></dt><dt>passing parameters to functions, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1296">Passing Parameters</a></dt><dt>ä¼ é€’å˜é‡ã€é€’å½’ make å’Œã€<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1375">ä¼ é€’å˜é‡</a></dt><dt>passing variables, recursive make and, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1375">Passing Variables</a></dt><dt>è·¯å¾„ã€å¯ç§»æ¤æ€§å’Œ<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1415">å¯ç§»æ¤æ€§é—®é¢˜</a></dt><dt>paths, portability and, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1415">Portability Issues</a></dt><dt>patsubst å‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1184">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>patsubst function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1184">String Functions</a></dt><dt>æ¨¡å¼è§„åˆ™ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-830">è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-833">è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-937">æ¨¡å¼è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-945">æ¨¡å¼</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-947">æ¨¡å¼</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-948">æ¨¡å¼</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-949">æ¨¡å¼</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-952">é™æ€æ¨¡å¼è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-958">åŽç¼€è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-964">åŽç¼€è§„åˆ™</a></dt><dt>pattern rules, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-830">Rules</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-833">Rules</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-937">Pattern Rules</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-945">The Patterns</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-947">The Patterns</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-948">The Patterns</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-949">The Patterns</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-952">Static Pattern Rules</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-958">Suffix Rules</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-964">Suffix Rules</a></dt><dd><dl><dt>%ï¼ˆç™¾åˆ†æ¯”ï¼‰å­—ç¬¦ï¼Œ<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-947">æ¨¡å¼</a></dt><dt>éšå«è§„åˆ™å’Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-830">è§„åˆ™</a></dt><dt>å›¾æ¡ˆã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-945">å›¾æ¡ˆ</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-948">å›¾æ¡ˆ</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-949">å›¾æ¡ˆ</a></dt><dd><dl><dt>åŽç¼€ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-948">æ¨¡å¼</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-949">æ¨¡å¼</a></dt></dl></dd><dt>é™æ€æ¨¡å¼è§„åˆ™,<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-952">é™æ€æ¨¡å¼è§„åˆ™</a></dt><dt>åŽç¼€è§„åˆ™,<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-958">åŽç¼€è§„åˆ™</a></dt><dt>åŽç¼€ã€åˆ é™¤ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-964">åŽç¼€è§„åˆ™</a></dt></dl></dd><dd><dl><dt>% (percent) character, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-947">The Patterns</a></dt><dt>implicit rules and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-830">Rules</a></dt><dt>patterns, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-945">The Patterns</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-948">The Patterns</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-949">The Patterns</a></dt><dd><dl><dt>suffixes, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-948">The Patterns</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-949">The Patterns</a></dt></dl></dd><dt>static pattern rules, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-952">Static Pattern Rules</a></dt><dt>suffix rules, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-958">Suffix Rules</a></dt><dt>suffixes, deleting, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-964">Suffix Rules</a></dt></dl></dd><dt>ç‰¹å®šäºŽæ¨¡å¼çš„å˜é‡ã€<a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1079">ç‰¹å®šäºŽç›®æ ‡å’Œæ¨¡å¼çš„å˜é‡</a></dt><dt>pattern-specific variables, <a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1079">Target- and Pattern-Specific Variables</a></dt><dt>æ¨¡å¼ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1163">å†…ç½®å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1171">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>patterns, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1163">Built-in Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1171">String Functions</a></dt><dd><dl><dt>ä½œä¸ºå†…ç½®å‡½æ•°ä¸­çš„å‚æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1163">å†…ç½®å‡½æ•°</a></dt><dt>è¿‡æ»¤å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1171">å­—ç¬¦ä¸²å‡½æ•°</a></dt></dl></dd><dd><dl><dt>as arguments
            in built-in functions, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1163">Built-in Functions</a></dt><dt>filter function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1171">String Functions</a></dt></dl></dd><dt>æ€§èƒ½ã€<a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1521">æé«˜ make çš„æ€§èƒ½</a>ã€<a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1522">åŸºå‡†æµ‹è¯•</a>ã€<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1532">è¯†åˆ«å’Œå¤„ç†ç“¶é¢ˆ</a>ã€<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1536">ç®€å•å˜é‡ä¸Žé€’å½’</a>ã€<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1537">ç®€å•å˜é‡ä¸Žé€’å½’</a>ã€<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1543">ç¦ç”¨ @</a>ã€<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1544">å»¶è¿Ÿåˆå§‹åŒ–</a>ã€<a class="indexterm" href="#OEBPS/ch10s03.html.make3-CHP-10-ITERM-1546">å¹¶è¡Œ make</a>ã€<a class="indexterm" href="#OEBPS/ch10s04.html.make3-CHP-10-ITERM-1548">åˆ†å¸ƒå¼ make</a></dt><dt>performance, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1521">Improving the Performance of make</a>, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1522">Benchmarking</a>, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1532">Identifying and Handling Bottlenecks</a>, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1536">Simple Variables Versus Recursive</a>, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1537">Simple Variables Versus Recursive</a>, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1543">Disabling @</a>, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1544">Lazy Initialization</a>, <a class="indexterm" href="#OEBPS/ch10s03.html.make3-CHP-10-ITERM-1546">Parallel make</a>, <a class="indexterm" href="#OEBPS/ch10s04.html.make3-CHP-10-ITERM-1548">Distributed make</a></dt><dd><dl><dt>@ ç¬¦å·å¹¶ä¸”<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1543">ç¦ç”¨ @</a></dt><dt>åŸºå‡†æµ‹è¯•å’Œ<a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1522">åŸºå‡†æµ‹è¯•</a></dt><dt>ç“¶é¢ˆã€<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1532">è¯†åˆ«å’Œå¤„ç†ç“¶é¢ˆ</a></dt><dt>åˆ†å¸ƒå¼å’Œ<a class="indexterm" href="#OEBPS/ch10s04.html.make3-CHP-10-ITERM-1548">åˆ†å¸ƒå¼åˆ¶é€ </a></dt><dt>åˆå§‹åŒ–å’Œ<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1544">å»¶è¿Ÿåˆå§‹åŒ–</a></dt><dt>ç®€ä»‹ï¼Œ<a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1521">æé«˜ make çš„æ€§èƒ½</a></dt><dt>å¹¶è¡Œæ€§å’Œ<a class="indexterm" href="#OEBPS/ch10s03.html.make3-CHP-10-ITERM-1546">å¹¶è¡Œæ€§</a></dt><dt>é€’å½’å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1536">ç®€å•å˜é‡ä¸Žé€’å½’</a></dt><dt>ç®€å•å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1537">ç®€å•å˜é‡ä¸Žé€’å½’</a></dt></dl></dd><dd><dl><dt>@ sign and, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1543">Disabling @</a></dt><dt>benchmarking and, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1522">Benchmarking</a></dt><dt>bottlenecks, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1532">Identifying and Handling Bottlenecks</a></dt><dt>distribution and, <a class="indexterm" href="#OEBPS/ch10s04.html.make3-CHP-10-ITERM-1548">Distributed make</a></dt><dt>initialization and, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1544">Lazy Initialization</a></dt><dt>introduction, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1521">Improving the Performance of make</a></dt><dt>parallelism and, <a class="indexterm" href="#OEBPS/ch10s03.html.make3-CHP-10-ITERM-1546">Parallel make</a></dt><dt>recursive variables, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1536">Simple Variables Versus Recursive</a></dt><dt>simple variables, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1537">Simple Variables Versus Recursive</a></dt></dl></dd><dt>è™šå‡ç›®æ ‡ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-861">è™šå‡</a><a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-866">ç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-869">è™šå‡ç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-870">è™šå‡ç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-873">è™šå‡ç›®æ ‡</a>ã€è™šå‡ç›®æ ‡ã€è™šå‡<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-874">ç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-876">è™šå‡ç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-878">è™šå‡ç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-991">ç‰¹æ®Šç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1387">éžé€’å½’ make</a></dt><dt>phony targets, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-861">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-866">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-869">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-870">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-873">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-874">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-876">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-878">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-991">Special Targets</a>, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1387">Nonrecursive make</a></dt><dd><dl><dt>awk å‘½ä»¤ï¼Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-870">è™šå‡ç›®æ ‡</a></dt><dt>df å‘½ä»¤ï¼Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-869">è™šå‡ç›®æ ‡</a></dt><dt>æŽ¥å£å’Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-876">è™šå‡ç›®æ ‡</a></dt><dt>éžé€’å½’ make å’Œ<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1387">éžé€’å½’ make</a></dt><dt>è¾“å‡ºï¼Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-873">è™šå‡ç›®æ ‡</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-874">è™šå‡ç›®æ ‡</a></dt><dd><dl><dt>è°ƒè¯•ï¼Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-874">è™šå‡ç›®æ ‡</a></dt><dt>é˜…è¯»ï¼Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-873">è™šå‡ç›®æ ‡</a></dt></dl></dd><dt>å…ˆå†³æ¡ä»¶ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-866">è™šå‡ç›®æ ‡</a></dt><dt>ç‰¹æ®Šç›®æ ‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-991">ç‰¹æ®Šç›®æ ‡</a></dt><dt>æ ‡å‡†ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-878">è™šå‡ç›®æ ‡</a></dt></dl></dd><dd><dl><dt>awk command, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-870">Phony Targets</a></dt><dt>df command, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-869">Phony Targets</a></dt><dt>interfaces and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-876">Phony Targets</a></dt><dt>nonrecursive make and, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1387">Nonrecursive make</a></dt><dt>output, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-873">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-874">Phony Targets</a></dt><dd><dl><dt>debugging, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-874">Phony Targets</a></dt><dt>reading, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-873">Phony Targets</a></dt></dl></dd><dt>prerequisites, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-866">Phony Targets</a></dt><dt>special targets, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-991">Special Targets</a></dt><dt>standard, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-878">Phony Targets</a></dt></dl></dd><dt>å¯ç§»æ¤æ€§,<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1412">å¯ç§»æ¤æ€§ Makefile</a> ,<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1413">å¯ç§»æ¤æ€§é—®é¢˜</a>,<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1416">å¯ç§»æ¤æ€§é—®é¢˜</a>,<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1418">å¯ç§»æ¤æ€§</a>é—®é¢˜,<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1420">å¯ç§»æ¤æ€§é—®é¢˜</a>,<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1422">å¯ç§»æ¤æ€§é—®é¢˜</a>, <a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1423">Cygwin</a> ,<a class="indexterm" href="#OEBPS/ch07s04.html.make3-CHP-7-ITERM-1438">ä½¿ç”¨ä¸å¯ç§»æ¤å·¥å…·</a>,<a class="indexterm" href="#OEBPS/ch07s04.html.make3-CHP-7-ITERM-1440">æ ‡å‡† Shell</a> , <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1487">Ant</a></dt><dt>portability, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1412">Portable Makefiles</a>, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1413">Portability Issues</a>, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1416">Portability Issues</a>, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1418">Portability Issues</a>, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1420">Portability Issues</a>, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1422">Portability Issues</a>, <a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1423">Cygwin</a>, <a class="indexterm" href="#OEBPS/ch07s04.html.make3-CHP-7-ITERM-1438">Working with Nonportable Tools</a>, <a class="indexterm" href="#OEBPS/ch07s04.html.make3-CHP-7-ITERM-1440">A Standard Shell</a>, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1487">Ant</a></dt><dd><dl><dt>èš‚èšï¼ˆJavaï¼‰ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1487">èš‚èš</a></dt><dt>è¥¿æ ¼æ¸©,<a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1423">è¥¿æ ¼æ¸©</a></dt><dt>éžä¾¿æºå¼å·¥å…·ï¼Œ<a class="indexterm" href="#OEBPS/ch07s04.html.make3-CHP-7-ITERM-1438">ä½¿ç”¨éžä¾¿æºå¼å·¥å…·</a></dt><dt>é€‰é¡¹å’Œ<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1418">å¯ç§»æ¤æ€§é—®é¢˜</a></dt><dt>è·¯å¾„å’Œ<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1416">å¯ç§»æ¤æ€§é—®é¢˜</a></dt><dt>ç¨‹åºè¡Œä¸ºå’Œ<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1422">å¯ç§»æ¤æ€§é—®é¢˜</a></dt><dt>ç¨‹åºåç§°å’Œ<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1413">å¯ç§»æ¤æ€§é—®é¢˜</a></dt><dt>shell å’Œ<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1420">å¯ç§»æ¤æ€§é—®é¢˜</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch07s04.html.make3-CHP-7-ITERM-1440">æ ‡å‡† Shell</a></dt></dl></dd><dd><dl><dt>Ant (Java), <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1487">Ant</a></dt><dt>Cygwin, <a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1423">Cygwin</a></dt><dt>nonportable tools, <a class="indexterm" href="#OEBPS/ch07s04.html.make3-CHP-7-ITERM-1438">Working with Nonportable Tools</a></dt><dt>options and, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1418">Portability Issues</a></dt><dt>paths and, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1416">Portability Issues</a></dt><dt>program behavior and, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1422">Portability Issues</a></dt><dt>program names and, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1413">Portability Issues</a></dt><dt>shell and, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1420">Portability Issues</a>, <a class="indexterm" href="#OEBPS/ch07s04.html.make3-CHP-7-ITERM-1440">A Standard Shell</a></dt></dl></dd><dt>.PRECIOUS ç›®æ ‡ä¿®é¥°ç¬¦ï¼Œ<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1004">ç‰¹æ®Šç›®æ ‡</a></dt><dt>.PRECIOUS target
                  modifier, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1004">Special Targets</a></dt><dt>å‘½ä»¤å‰ç¼€ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1314">å‘½ä»¤ä¿®é¥°ç¬¦</a>ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1317">å‘½ä»¤ä¿®é¥°ç¬¦</a>ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1323">å‘½ä»¤ä¿®é¥°ç¬¦</a></dt><dt>prefixes on commands, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1314">Command Modifiers</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1317">Command Modifiers</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1323">Command Modifiers</a></dt><dd><dl><dt>+ï¼ˆåŠ å·ï¼‰ï¼Œ<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1323">å‘½ä»¤ä¿®é¥°ç¬¦</a></dt><dt>-ï¼ˆç ´æŠ˜å·ï¼‰ï¼Œ<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1317">å‘½ä»¤ä¿®é¥°ç¬¦</a></dt><dt>@,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1314">å‘½ä»¤ä¿®é¥°ç¬¦</a></dt></dl></dd><dd><dl><dt>+ (plus), <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1323">Command Modifiers</a></dt><dt>- (dash), <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1317">Command Modifiers</a></dt><dt>@, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1314">Command Modifiers</a></dt></dl></dd><dt>å‰ç¼€ã€æ¨¡å¼è§„åˆ™ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-950">æ¨¡å¼</a></dt><dt>prefixes, pattern rules, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-950">The Patterns</a></dt><dt>å…ˆå†³æ¡ä»¶,<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-797">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a>,<a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-810">ä¾èµ–é¡¹æ£€æŸ¥</a>,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-865">è™šå‡ç›®æ ‡</a>,<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-908">è‡ªåŠ¨å˜é‡</a>,<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-997">ç‰¹æ®Šç›®æ ‡</a>,<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1001">ç‰¹æ®Šç›®æ ‡</a>,<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1021">ä½¿ç”¨åº“ä½œä¸ºå…ˆå†³æ¡ä»¶</a>,<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1024">ä½¿ç”¨åº“ä½œä¸ºå…ˆå†³æ¡ä»¶</a>,<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1367">é€’å½’ make</a></dt><dt>prerequisites, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-797">Targets and Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-810">Dependency Checking</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-865">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-908">Automatic Variables</a>, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-997">Special Targets</a>, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1001">Special Targets</a>, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1021">Using Libraries as Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1024">Using Libraries as Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1367">Recursive make</a></dt><dd><dl><dt>è‡ªåŠ¨å˜é‡å’Œ<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-908">è‡ªåŠ¨å˜é‡</a></dt><dt>åº“ä½œä¸ºï¼Œ<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1021">ä½¿ç”¨åº“ä½œä¸ºå…ˆå†³æ¡ä»¶</a></dt><dt>è™šå‡ç›®æ ‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-865">è™šå‡ç›®æ ‡</a></dt><dt>è§„åˆ™ã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-797">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a></dt><dt>ä¿å­˜ï¼Œ<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1024">ä½¿ç”¨åº“ä½œä¸ºå…ˆå†³æ¡ä»¶</a></dt><dt>ç›®æ ‡ã€<a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-810">ä¾èµ–æ€§æ£€æŸ¥</a>ã€<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-997">ç‰¹æ®Šç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1001">ç‰¹æ®Šç›®æ ‡</a></dt><dd><dl><dt>é“¾æŽ¥ã€<a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-810">ä¾èµ–æ€§æ£€æŸ¥</a></dt><dt>.INTERMEDIATE ä¿®é¥°ç¬¦å’Œ<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-997">ç‰¹æ®Šç›®æ ‡</a></dt><dt>.SECONDARY ä¿®é¥°ç¬¦ï¼Œ<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1001">ç‰¹æ®Šç›®æ ‡</a></dt></dl></dd><dt>æ›´æ–°ã€æŽ’åºå’Œ<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1367">é€’å½’ make</a></dt></dl></dd><dd><dl><dt>automatic variables and, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-908">Automatic Variables</a></dt><dt>libraries as, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1021">Using Libraries as Prerequisites</a></dt><dt>phony targets, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-865">Phony Targets</a></dt><dt>rules and, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-797">Targets and Prerequisites</a></dt><dt>saving, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1024">Using Libraries as Prerequisites</a></dt><dt>targets, <a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-810">Dependency Checking</a>, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-997">Special Targets</a>, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1001">Special Targets</a></dt><dd><dl><dt>chaining, <a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-810">Dependency Checking</a></dt><dt>.INTERMEDIATE
                  modifier and, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-997">Special Targets</a></dt><dt>.SECONDARY
                  modifier, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1001">Special Targets</a></dt></dl></dd><dt>updates, ordering and, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1367">Recursive make</a></dt></dl></dd><dt>--print-data-base é€‰é¡¹ï¼Œ<a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1619">è¿è¡Œ make</a></dt><dt>--print-data-base
                option, <a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1619">Running make</a></dt><dt>ç¨‹åºè¡Œä¸ºã€å¯ç§»æ¤æ€§å’Œ<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1421">å¯ç§»æ¤æ€§é—®é¢˜</a></dt><dt>program behavior, portability and, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1421">Portability Issues</a></dt><dt>ç¨‹åºç®¡ç†ï¼Œ<a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1430">ç®¡ç†ç¨‹åºå’Œæ–‡ä»¶</a></dt><dt>program management, <a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1430">Managing Programs and Files</a></dt><dt>ç¨‹åºåç§°ã€å¯ç§»æ¤æ€§å’Œ<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1414">å¯ç§»æ¤æ€§é—®é¢˜</a></dt><dt>program names, portability and, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1414">Portability Issues</a></dt><dt>ç¨‹åºå˜é‡å®ã€<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1287">eval å’Œ value</a></dt><dt>program-variables macro, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1287">eval and value</a></dt></dl></div><div class="indexdiv"><h3>å³</h3><h3>R</h3><dl><dt>RCS æºä»£ç æŽ§åˆ¶ã€éšå¼è§„åˆ™å’Œ<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-983">æºä»£ç æŽ§åˆ¶çš„éšå¼è§„åˆ™</a></dt><dt>RCS source control, implicit rules and, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-983">Implicit Rules for Source Control</a></dt><dt>åªè¯»æº,<a class="indexterm" href="#OEBPS/ch08s02.html.make3-CHP-8-ITERM-1447">åªè¯»æº</a></dt><dt>read-only source, <a class="indexterm" href="#OEBPS/ch08s02.html.make3-CHP-8-ITERM-1447">Read-Only Source</a></dt><dt>é‡å»ºã€æœ€å°åŒ–ã€<a class="indexterm" href="#OEBPS/ch01s03.html.make3-CHP-1-ITERM-811">æœ€å°åŒ–é‡å»º</a></dt><dt>rebuilds, minimizing, <a class="indexterm" href="#OEBPS/ch01s03.html.make3-CHP-1-ITERM-811">Minimizing Rebuilds</a></dt><dt>é€’å½’ï¼Œ<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1364">ç®¡ç†å¤§åž‹é¡¹ç›®</a></dt><dt>recursion, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1364">Managing Large Projects</a></dt><dt>é€’å½’ makeã€<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1365">é€’å½’ make</a>ã€<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1370">é€’å½’ make</a>ã€<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1372">å‘½ä»¤è¡Œé€‰é¡¹</a>ã€<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1373">ä¼ é€’å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1376">é”™è¯¯å¤„ç†</a>ã€<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1380">æž„å»ºå…¶ä»–ç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1382">é¿å…é‡å¤ä»£ç </a>ã€<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1384">éžé€’å½’ make</a></dt><dt>recursive make, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1365">Recursive make</a>, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1370">Recursive make</a>, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1372">Command-Line Options</a>, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1373">Passing Variables</a>, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1376">Error Handling</a>, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1380">Building Other Targets</a>, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1382">Avoiding Duplicate Code</a>, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1384">Nonrecursive make</a></dt><dd><dl><dt>ï¼ˆå¦è¯·å‚é˜…éžé€’å½’ makeï¼‰</dt><dt>å»ºç«‹ç›®æ ‡å¹¶<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1380">å»ºç«‹å…¶ä»–ç›®æ ‡</a></dt><dt>ä»£ç é‡å¤ï¼Œ<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1382">é¿å…é‡å¤ä»£ç </a></dt><dt>å‘½ä»¤è¡Œå’Œ<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1372">å‘½ä»¤è¡Œé€‰é¡¹</a></dt><dt>ä¾èµ–å…³ç³»å’Œ<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1370">é€’å½’ make</a></dt><dt>é”™è¯¯å¤„ç†,<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1376">é”™è¯¯å¤„ç†</a></dt><dt>å˜é‡ã€ä¼ é€’ã€<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1373">ä¼ é€’å˜é‡</a></dt></dl></dd><dd><dl><dt>(see also nonrecursive make)</dt><dt>build targets and, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1380">Building Other Targets</a></dt><dt>code duplication, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1382">Avoiding Duplicate Code</a></dt><dt>command-line and, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1372">Command-Line Options</a></dt><dt>dependencies and, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1370">Recursive make</a></dt><dt>error handling, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1376">Error Handling</a></dt><dt>variables, passing, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1373">Passing Variables</a></dt></dl></dd><dt>é€’å½’å˜é‡ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1207">é‡è¦çš„æ‚é¡¹å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1538">ç®€å•å˜é‡ä¸Žé€’å½’</a></dt><dt>recursive variables, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1207">Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1538">Simple Variables Versus Recursive</a></dt><dd><dl><dt>æ€§èƒ½ä»¥åŠ<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1538">ç®€å•å˜é‡ä¸Žé€’å½’</a></dt><dt>shell å‡½æ•°å’Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1207">é‡è¦çš„æ‚é¡¹å‡½æ•°</a></dt></dl></dd><dd><dl><dt>performance and, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1538">Simple Variables Versus Recursive</a></dt><dt>shell function and, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1207">Important Miscellaneous Functions</a></dt></dl></dd><dt>é€’å½’æ‰©å±•å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1052">å˜é‡ç±»åž‹</a></dt><dt>recursively expanded variables, <a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1052">Variable Types</a></dt><dt>å‚è€ƒæž„å»ºã€<a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1461">å‚è€ƒæž„å»ºã€åº“å’Œå®‰è£…ç¨‹åº</a>ã€<a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1462">å‚è€ƒæž„å»ºã€åº“å’Œå®‰è£…ç¨‹åº</a></dt><dt>reference builds, <a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1461">Reference Builds, Libraries, and Installers</a>, <a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1462">Reference Builds, Libraries, and Installers</a></dt><dd><dl><dt>å®‰è£…ç¨‹åºå’Œ<a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1462">å‚è€ƒç‰ˆæœ¬ã€åº“å’Œå®‰è£…ç¨‹åº</a></dt><dt>åº“ä»¥åŠ<a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1461">å‚è€ƒç‰ˆæœ¬ã€åº“å’Œå®‰è£…ç¨‹åº</a></dt></dl></dd><dd><dl><dt>installers and, <a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1462">Reference Builds, Libraries, and Installers</a></dt><dt>libraries and, <a class="indexterm" href="#OEBPS/ch08s06.html.make3-CHP-8-ITERM-1461">Reference Builds, Libraries, and Installers</a></dt></dl></dd><dt>å‚è€ƒæ ‘ã€jar ç¨‹åºã€<a class="indexterm" href="#OEBPS/ch09s05.html.make3-CHP-9-ITERM-1511">å‚è€ƒæ ‘å’Œç¬¬ä¸‰æ–¹ Jars</a></dt><dt>reference trees, jar program, <a class="indexterm" href="#OEBPS/ch09s05.html.make3-CHP-9-ITERM-1511">Reference Trees and Third-Party Jars</a></dt><dt>regtoolï¼Œ<a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1502">è®¾ç½® CLASSPATH</a></dt><dt>regtool, <a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1502">Setting CLASSPATH</a></dt><dt>ç›¸å¯¹è·¯å¾„ã€è½¬æ¢ä¸º Java ç±»åã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1210">é‡è¦æ‚é¡¹å‡½æ•°</a></dt><dt>relative paths, converting to Java class name, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1210">Important Miscellaneous Functions</a></dt><dt>è¿œç¨‹æ–‡ä»¶å‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1626">æ•°æ®ç»“æž„</a></dt><dt>remote-file function, <a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1626">Data Structures</a></dt><dt>å¯é‡ç”¨çš„åº“å‡½æ•°ã€å£°æ˜Žã€<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-926">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a></dt><dt>reusable library functions, declarations, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-926">Finding Files with VPATH and vpath</a></dt><dt>è§„åˆ™é“¾ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-939">æ¨¡å¼è§„åˆ™</a></dt><dt>rule chaining, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-939">Pattern Rules</a></dt><dt>è§„åˆ™,<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-794">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a>,<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-795">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a>,<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-798">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a>,<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-799">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a>,<a class="indexterm" href="#OEBPS/ch01s03.html.make3-CHP-1-ITERM-813">æœ€å°åŒ–é‡å»º</a>,<a class="indexterm" href="#OEBPS/ch01s03.html.make3-CHP-1-ITERM-814">æœ€å°åŒ–é‡å»º</a>,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-826">è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-832">è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-834">è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-836">è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-838">è§„åˆ™</a>,æ˜¾å¼<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-840">è§„åˆ™</a>,ç©º<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-897">ç›®æ ‡</a>,æ˜¾å¼<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-841">è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-864">å‡ç›®æ ‡</a>,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-889">ç©ºç›®æ ‡</a>,<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-901">è‡ªåŠ¨å˜é‡</a>,<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-936">æ¨¡å¼è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-954">é™æ€æ¨¡å¼è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-959">åŽç¼€è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-966">éšå¼è§„åˆ™æ•°æ®åº“</a>,<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-969">ä½¿ç”¨éšå¼</a>è§„åˆ™,<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-970">ä½¿ç”¨éšå¼è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-973">è§„åˆ™ç»“æž„</a>,<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-977">è§„åˆ™ç»“æž„</a>,<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-978">è§„åˆ™ç»“æž„</a>,<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-982">æºä»£ç ç®¡ç†éšå¼è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1028">åŒå†’å·è§„åˆ™</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1291">eval å’Œ value</a></dt><dt>rules, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-794">Targets and Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-795">Targets and Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-798">Targets and Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-799">Targets and Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch01s03.html.make3-CHP-1-ITERM-813">Minimizing Rebuilds</a>, <a class="indexterm" href="#OEBPS/ch01s03.html.make3-CHP-1-ITERM-814">Minimizing Rebuilds</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-826">Rules</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-832">Rules</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-834">Rules</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-836">Rules</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-838">Rules</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-840">Explicit Rules</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-897">Empty Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-841">Explicit Rules</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-864">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-889">Empty Targets</a>, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-901">Automatic Variables</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-936">Pattern Rules</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-954">Static Pattern Rules</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-959">Suffix Rules</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-966">The Implicit Rules Database</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-969">Working with Implicit Rules</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-970">Working with Implicit Rules</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-973">Rule Structure</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-977">Rule Structure</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-978">Rule Structure</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-982">Implicit Rules for Source Control</a>, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1028">Double-Colon Rules</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1291">eval and value</a></dt><dd><dl><dt>ä»»ä½•è§’è‰²ï¼Œ<a class="indexterm" href="#OEBPS/ch01s03.html.make3-CHP-1-ITERM-813">æœ€å°åŒ–é‡å»º</a></dt><dt>é“¾æŽ¥ã€ä¸­é—´æ–‡ä»¶ã€<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-970">ä½¿ç”¨éšå¼è§„åˆ™</a></dt><dt>å®šåˆ¶ã€å˜é‡å’Œ<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-977">è§„åˆ™ç»“æž„</a></dt><dt>é»˜è®¤è§„åˆ™ã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-798">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a></dt><dt>å®¶å±žã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-799">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a></dt><dt>åŒå†’å·,<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1028">åŒå†’å·è§„åˆ™</a></dt><dt>æ˜¾å¼ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-826">è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-840">æ˜¾å¼è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-897">ç©ºç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-864">è™šå‡ç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-889">ç©ºç›®æ ‡</a></dt><dd><dl><dt>ç©ºç›®æ ‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-889">ç©ºç›®æ ‡</a></dt><dt>è™šå‡ç›®æ ‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-864">è™šå‡ç›®æ ‡</a></dt></dl></dd><dt>éšå¼ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-834">è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-966">éšå¼è§„åˆ™æ•°æ®åº“</a>ã€<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-969">ä½¿ç”¨éšå¼è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-982">æºä»£ç æŽ§åˆ¶çš„éšå¼è§„åˆ™</a></dt><dd><dl><dt>å†…ç½®ï¼Œ<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-969">ä½¿ç”¨éšå¼è§„åˆ™</a></dt><dt>æºä»£ç æŽ§åˆ¶å’Œ<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-982">æºä»£ç æŽ§åˆ¶çš„éšå¼è§„åˆ™</a></dt></dl></dd><dt>å®ã€<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1291">eval å’Œ value</a></dt><dt>åŒ¹é…ã€è‡ªåŠ¨å˜é‡å’Œã€<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-901">è‡ªåŠ¨å˜é‡</a></dt><dt>æ¢è¡Œï¼Œ<a class="indexterm" href="#OEBPS/ch01s03.html.make3-CHP-1-ITERM-814">æœ€å°åŒ–é‡å»º</a></dt><dt>æ¨¡å¼ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-832">è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-936">æ¨¡å¼è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-959">åŽç¼€è§„åˆ™</a></dt><dd><dl><dt>åŽç¼€è§„åˆ™,<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-959">åŽç¼€è§„åˆ™</a></dt></dl></dd><dt>å…ˆå†³æ¡ä»¶å’Œ<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-795">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a></dt><dt>é™æ€æ¨¡å¼,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-836">è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-954">é™æ€æ¨¡å¼è§„åˆ™</a></dt><dt>ç»“æž„ã€<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-973">è§„åˆ™ç»“æž„</a></dt><dt>åŽç¼€ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-838">è§„åˆ™</a></dt><dt>ç›®æ ‡ã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-794">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-841">æ˜Žç¡®è§„åˆ™</a></dt><dd><dl><dt>å¤šé‡ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-841">æ˜Žç¡®çš„è§„åˆ™</a></dt></dl></dd><dt>å˜é‡ã€å®šåˆ¶å’Œ<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-978">è§„åˆ™ç»“æž„</a></dt></dl></dd><dd><dl><dt>any character, <a class="indexterm" href="#OEBPS/ch01s03.html.make3-CHP-1-ITERM-813">Minimizing Rebuilds</a></dt><dt>chaining, intermediate files, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-970">Working with Implicit Rules</a></dt><dt>customization, variables and, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-977">Rule Structure</a></dt><dt>default rule, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-798">Targets and Prerequisites</a></dt><dt>dependents, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-799">Targets and Prerequisites</a></dt><dt>double-colon, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1028">Double-Colon Rules</a></dt><dt>explicit, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-826">Rules</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-840">Explicit Rules</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-897">Empty Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-864">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-889">Empty Targets</a></dt><dd><dl><dt>empty targets, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-889">Empty Targets</a></dt><dt>phony targets, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-864">Phony Targets</a></dt></dl></dd><dt>implicit, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-834">Rules</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-966">The Implicit Rules Database</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-969">Working with Implicit Rules</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-982">Implicit Rules for Source Control</a></dt><dd><dl><dt>built-in, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-969">Working with Implicit Rules</a></dt><dt>source control and, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-982">Implicit Rules for Source Control</a></dt></dl></dd><dt>macros, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1291">eval and value</a></dt><dt>matching, automatic variables and, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-901">Automatic Variables</a></dt><dt>newline, <a class="indexterm" href="#OEBPS/ch01s03.html.make3-CHP-1-ITERM-814">Minimizing Rebuilds</a></dt><dt>pattern, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-832">Rules</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-936">Pattern Rules</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-959">Suffix Rules</a></dt><dd><dl><dt>suffix rules, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-959">Suffix Rules</a></dt></dl></dd><dt>prerequisites and, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-795">Targets and Prerequisites</a></dt><dt>static pattern, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-836">Rules</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-954">Static Pattern Rules</a></dt><dt>structure, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-973">Rule Structure</a></dt><dt>suffix, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-838">Rules</a></dt><dt>targets, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-794">Targets and Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-841">Explicit Rules</a></dt><dd><dl><dt>multiple, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-841">Explicit Rules</a></dt></dl></dd><dt>variables, customization and, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-978">Rule Structure</a></dt></dl></dd><dt>run-make shell è„šæœ¬ã€è¿è¡Œä¹¦ç± makefileã€<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1554">ç®¡ç†ç¤ºä¾‹</a></dt><dt>run-make shell script, running book makefile, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1554">Managing Examples</a></dt></dl></div><div class="indexdiv"><h3>S</h3><h3>S</h3><dl><dt>SCCS æºä»£ç æŽ§åˆ¶ã€éšå¼è§„åˆ™å’Œ<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-984">æºä»£ç æŽ§åˆ¶çš„éšå¼è§„åˆ™</a></dt><dt>SCCS source control, implicit rules and, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-984">Implicit Rules for Source Control</a></dt><dt>èŒƒå›´ç•Œå®šã€å®å®žçŽ°å’Œ<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1150">ç”¨æˆ·å®šä¹‰å‡½æ•°</a></dt><dt>scoping, macro implementation and, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1150">User-Defined Functions</a></dt><dt>è„šæœ¬ã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-788">å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile</a>ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1303">è§£æžå‘½ä»¤</a></dt><dt>scripts, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-788">How to Write a Simple Makefile</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1303">Parsing Commands</a></dt><dd><dl><dt>å‘½ä»¤è„šæœ¬ã€è§£æžå’Œ<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1303">è§£æžå‘½ä»¤</a></dt><dt>make ä»¥åŠ<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-788">å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile</a></dt></dl></dd><dd><dl><dt>command scripts, parsing and, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1303">Parsing Commands</a></dt><dt>make and, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-788">How to Write a Simple Makefile</a></dt></dl></dd><dt>æœç´¢å’Œæ›¿æ¢å‡½æ•°ã€å­—ç¬¦ä¸²ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1179">å­—ç¬¦ä¸²å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1187">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>search and replace functions, strings, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1179">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1187">String Functions</a></dt><dd><dl><dt>æ›¿æ¢å¼•ç”¨ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1187">å­—ç¬¦ä¸²å‡½æ•°</a></dt></dl></dd><dd><dl><dt>substitution references, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1187">String Functions</a></dt></dl></dd><dt>æœç´¢ã€<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-919">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-920">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1457">éƒ¨åˆ†æºæ ‘</a>ã€<a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1458">éƒ¨åˆ†æºæ ‘</a></dt><dt>searches, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-919">Finding Files with VPATH and vpath</a>, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-920">Finding Files with VPATH and vpath</a>, <a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1457">Partial Source Trees</a>, <a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1458">Partial Source Trees</a></dt><dd><dl><dt>äºŒå‰æ ‘ã€<a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1458">éƒ¨åˆ†æºæ ‘</a></dt><dt>æºæ ‘ï¼Œ<a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1457">éƒ¨åˆ†æºæ ‘</a></dt><dt>VPATH å’Œï¼Œ<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-919">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a></dt><dt>vpath å’Œï¼Œ<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-920">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a></dt></dl></dd><dd><dl><dt>binary trees, <a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1458">Partial Source Trees</a></dt><dt>source treese, <a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1457">Partial Source Trees</a></dt><dt>VPATH and, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-919">Finding Files with VPATH and vpath</a></dt><dt>vpath and, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-920">Finding Files with VPATH and vpath</a></dt></dl></dd><dt>.SECONDARY ç›®æ ‡ä¿®é¥°ç¬¦ï¼Œ<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1000">ç‰¹æ®Šç›®æ ‡</a></dt><dt>.SECONDARY
                  target modifier, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1000">Special Targets</a></dt><dt>åˆ†éš”ç¬¦ã€ç¼ºå¤±ï¼ˆé”™è¯¯æ¶ˆæ¯ï¼‰ã€<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1601">ç¼ºå¤±åˆ†éš”ç¬¦</a></dt><dt>separators, missing (error messages), <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1601">missing separator</a></dt><dt>shellã€<a class="indexterm" href="#OEBPS/ch05s02.html.make3-CHP-5-ITERM-1336">ä½¿ç”¨å“ªä¸ª Shell</a>ã€<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1419">å¯ç§»æ¤æ€§é—®é¢˜</a>ã€<a class="indexterm" href="#OEBPS/ch07s04.html.make3-CHP-7-ITERM-1439">æ ‡å‡† Shell</a></dt><dt>shell, <a class="indexterm" href="#OEBPS/ch05s02.html.make3-CHP-5-ITERM-1336">Which Shell to Use</a>, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1419">Portability Issues</a>, <a class="indexterm" href="#OEBPS/ch07s04.html.make3-CHP-7-ITERM-1439">A Standard Shell</a></dt><dd><dl><dt>å‘½ä»¤è¡Œã€å­ shellã€<a class="indexterm" href="#OEBPS/ch05s02.html.make3-CHP-5-ITERM-1336">ä½¿ç”¨å“ªä¸ª Shell</a></dt><dt>å¯ç§»æ¤æ€§å’Œ<a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1419">å¯ç§»æ¤æ€§é—®é¢˜</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch07s04.html.make3-CHP-7-ITERM-1439">æ ‡å‡† Shell</a></dt></dl></dd><dd><dl><dt>command lines, subshells, <a class="indexterm" href="#OEBPS/ch05s02.html.make3-CHP-5-ITERM-1336">Which Shell to Use</a></dt><dt>portability and, <a class="indexterm" href="#OEBPS/ch07.html.make3-CHP-7-ITERM-1419">Portability Issues</a>, <a class="indexterm" href="#OEBPS/ch07s04.html.make3-CHP-7-ITERM-1439">A Standard Shell</a></dt></dl></dd><dt>shell å‘½ä»¤ã€åºåˆ—ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1310">è¿žç»­é•¿å‘½ä»¤</a></dt><dt>shell commands, sequences, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1310">Continuing Long Commands</a></dt><dt>shell å‡½æ•°,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1202">é‡è¦æ‚é¡¹å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1204">é‡è¦æ‚é¡¹å‡½æ•°</a></dt><dt>shell function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1202">Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1204">Important Miscellaneous Functions</a></dt><dd><dl><dt>å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1204">é‡è¦çš„æ‚é¡¹å‡½æ•°</a></dt></dl></dd><dd><dl><dt>variables, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1204">Important Miscellaneous Functions</a></dt></dl></dd><dt>ç®€å•å˜é‡ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1206">é‡è¦æ‚é¡¹å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1539">ç®€å•å˜é‡ä¸Žé€’å½’</a></dt><dt>simple variables, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1206">Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1539">Simple Variables Versus Recursive</a></dt><dd><dl><dt>æ€§èƒ½ä»¥åŠ<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1539">ç®€å•å˜é‡ä¸Žé€’å½’</a></dt><dt>shell å‡½æ•°å’Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1206">é‡è¦çš„æ‚é¡¹å‡½æ•°</a></dt></dl></dd><dd><dl><dt>performance and, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1539">Simple Variables Versus Recursive</a></dt><dt>shell function and, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1206">Important Miscellaneous Functions</a></dt></dl></dd><dt>ç®€å•æ‰©å±•å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1050">å˜é‡ç±»åž‹</a></dt><dt>simply expanded variables, <a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1050">Variable Types</a></dt><dt>æŽ’åºå‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1200">é‡è¦çš„æ‚é¡¹å‡½æ•°</a></dt><dt>sort function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1200">Important Miscellaneous Functions</a></dt><dt>æºã€<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-928">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch08.html.make3-CHP-8-ITERM-1442">åˆ†ç¦»æºä»£ç å’ŒäºŒè¿›åˆ¶æ–‡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch08.html.make3-CHP-8-ITERM-1445">å›°éš¾çš„æ–¹æ³•</a>ã€<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1566">éªŒè¯æºä»£ç </a></dt><dt>source, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-928">Finding Files with VPATH and vpath</a>, <a class="indexterm" href="#OEBPS/ch08.html.make3-CHP-8-ITERM-1442">Separating Source and Binary</a>, <a class="indexterm" href="#OEBPS/ch08.html.make3-CHP-8-ITERM-1445">The Hard Way</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1566">Validating the Source</a></dt><dd><dl><dt>äºŒå‰æ ‘åˆ†ç¦»ï¼Œ<a class="indexterm" href="#OEBPS/ch08.html.make3-CHP-8-ITERM-1442">åˆ†ç¦»æºä»£ç å’ŒäºŒè¿›åˆ¶</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch08.html.make3-CHP-8-ITERM-1445">å›°éš¾çš„æ–¹æ³•</a></dt><dt>srcç›®å½•ï¼Œ<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-928">ä½¿ç”¨VPATHå’ŒvpathæŸ¥æ‰¾æ–‡ä»¶</a></dt><dt>éªŒè¯ã€ä¹¦ç± makefileã€<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1566">éªŒè¯æºä»£ç </a></dt></dl></dd><dd><dl><dt>binary tree separation, <a class="indexterm" href="#OEBPS/ch08.html.make3-CHP-8-ITERM-1442">Separating Source and Binary</a>, <a class="indexterm" href="#OEBPS/ch08.html.make3-CHP-8-ITERM-1445">The Hard Way</a></dt><dt>src directory, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-928">Finding Files with VPATH and vpath</a></dt><dt>validation, book makefile, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1566">Validating the Source</a></dt></dl></dd><dt>æºæ ‘ã€<a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1437">æºæ ‘å¸ƒå±€</a>ã€<a class="indexterm" href="#OEBPS/ch08s02.html.make3-CHP-8-ITERM-1446">åªè¯»æº</a>ã€<a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1455">éƒ¨åˆ†æºæ ‘</a>ã€<a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1459">éƒ¨åˆ†æºæ ‘</a></dt><dt>source trees, <a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1437">Source Tree Layout</a>, <a class="indexterm" href="#OEBPS/ch08s02.html.make3-CHP-8-ITERM-1446">Read-Only Source</a>, <a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1455">Partial Source Trees</a>, <a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1459">Partial Source Trees</a></dt><dd><dl><dt>å¸ƒå±€ã€æ–‡ä»¶ç®¡ç†å’Œ<a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1437">æºæ ‘å¸ƒå±€</a></dt><dt>éƒ¨åˆ†ï¼Œ<a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1455">éƒ¨åˆ†æºæ ‘</a></dt><dt>åªè¯»ï¼Œ<a class="indexterm" href="#OEBPS/ch08s02.html.make3-CHP-8-ITERM-1446">åªè¯»æº</a></dt><dt>æœç´¢ï¼Œ<a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1459">éƒ¨åˆ†æºæ ‘</a></dt></dl></dd><dd><dl><dt>layout, file management and, <a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1437">Source Tree Layout</a></dt><dt>partial, <a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1455">Partial Source Trees</a></dt><dt>read-only, <a class="indexterm" href="#OEBPS/ch08s02.html.make3-CHP-8-ITERM-1446">Read-Only Source</a></dt><dt>searches, <a class="indexterm" href="#OEBPS/ch08s05.html.make3-CHP-8-ITERM-1459">Partial Source Trees</a></dt></dl></dd><dt>æºåˆ°å¯¹è±¡å‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1393">éžé€’å½’ make</a></dt><dt>source-to-object function, <a class="indexterm" href="#OEBPS/ch06s02.html.make3-CHP-6-ITERM-1393">Nonrecursive make</a></dt><dt>å˜é‡çš„æ¥æºï¼Œ<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1087">å˜é‡ä»Žå“ªé‡Œæ¥</a></dt><dt>sources of variables, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1087">Where Variables Come From</a></dt><dt>ç©ºæ ¼è½¬é¢˜åŠŸèƒ½ï¼Œ<a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1434">ç®¡ç†ç¨‹åºå’Œæ–‡ä»¶</a></dt><dt>space-to-question function, <a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1434">Managing Programs and Files</a></dt><dt>ç‰¹æ®Šç›®æ ‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-990">ç‰¹æ®Šç›®æ ‡</a></dt><dt>special targets, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-990">Special Targets</a></dt><dt>src ç›®å½•ã€æºæ–‡ä»¶ã€<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-930">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a></dt><dt>src directory, source files, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-930">Finding Files with VPATH and vpath</a></dt><dt>é™æ€æ¨¡å¼è§„åˆ™,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-837">è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-953">é™æ€æ¨¡å¼è§„åˆ™</a></dt><dt>static pattern rules, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-837">Rules</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-953">Static Pattern Rules</a></dt><dt>çŠ¶æ€ç ã€å‘½ä»¤ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1325">é”™è¯¯å’Œä¸­æ–­</a></dt><dt>status code, commands, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1325">Errors and Interrupts</a></dt><dt>stderr æ–‡ä»¶æè¿°ç¬¦ï¼Œ<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1354">å‘½ä»¤çŽ¯å¢ƒ</a></dt><dt>stderr file descriptor, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1354">Command Environment</a></dt><dt>stdin æ–‡ä»¶æè¿°ç¬¦ï¼Œ<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1352">å‘½ä»¤çŽ¯å¢ƒ</a></dt><dt>stdin file descriptor, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1352">Command Environment</a></dt><dt>stdout æ–‡ä»¶æè¿°ç¬¦ï¼Œ<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1353">å‘½ä»¤çŽ¯å¢ƒ</a></dt><dt>stdout file descriptor, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1353">Command Environment</a></dt><dt>å­—ç¬¦ä¸²å‡½æ•°,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1166">å­—ç¬¦ä¸²å‡½æ•°</a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1168">,</a>å­—ç¬¦ä¸²<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1174">å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1177">å­—ç¬¦ä¸²å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1178">å­—ç¬¦ä¸²å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1182">å­—ç¬¦ä¸²å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1186">å­—ç¬¦ä¸²å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1193">å­—ç¬¦ä¸²å‡½æ•°</a>,å­—ç¬¦ä¸²å‡½æ•°,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1196">å­—ç¬¦ä¸²å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1199">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>string functions, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1166">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1168">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1174">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1177">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1178">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1182">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1186">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1193">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1196">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1199">String Functions</a></dt><dd><dl><dt>è¿‡æ»¤å™¨ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1168">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>è¿‡æ»¤å™¨ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1174">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>æŸ¥æ‰¾å­—ç¬¦ä¸²ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1177">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>ç¬¬ä¸€ä¸ªå­—ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1196">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>patsubstï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1186">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>æœç´¢å’Œæ›¿æ¢å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1178">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>substï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1182">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>è¯è¡¨ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1199">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>å•è¯ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1193">å­—ç¬¦ä¸²å‡½æ•°</a></dt></dl></dd><dd><dl><dt>filter, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1168">String Functions</a></dt><dt>filter-out, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1174">String Functions</a></dt><dt>findstring, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1177">String Functions</a></dt><dt>firstword, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1196">String Functions</a></dt><dt>patsubst, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1186">String Functions</a></dt><dt>search and replace functions, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1178">String Functions</a></dt><dt>subst, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1182">String Functions</a></dt><dt>wordlist, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1199">String Functions</a></dt><dt>words, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1193">String Functions</a></dt></dl></dd><dt>å‰¥ç¦»åŠŸèƒ½ï¼Œ<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1112">æ¡ä»¶å’ŒåŒ…æ‹¬å¤„ç†</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1263">ä¸å¤ªé‡è¦çš„æ‚é¡¹åŠŸèƒ½</a></dt><dt>strip function, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1112">Conditional and include Processing</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1263">Less Important Miscellaneous Functions</a></dt><dd><dl><dt>ç©ºç™½åˆ é™¤ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1112">æ¡ä»¶å’ŒåŒ…å«å¤„ç†</a></dt></dl></dd><dd><dl><dt>whitespace removal, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1112">Conditional and include Processing</a></dt></dl></dd><dt>è§„åˆ™ç»“æž„,<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-974">è§„åˆ™ç»“æž„</a></dt><dt>structure of rules, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-974">Rule Structure</a></dt><dt>å­ shellã€å‘½ä»¤è¡Œä»¥åŠ<a class="indexterm" href="#OEBPS/ch05s02.html.make3-CHP-5-ITERM-1335">ä½¿ç”¨å“ªä¸ª Shell</a></dt><dt>subshells, command lines and, <a class="indexterm" href="#OEBPS/ch05s02.html.make3-CHP-5-ITERM-1335">Which Shell to Use</a></dt><dt>subst å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1181">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>subst function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1181">String Functions</a></dt><dt>æ›¿æ¢å¼•ç”¨ã€å­—ç¬¦ä¸²å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1188">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>substitution references, string
                    functions, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1188">String Functions</a></dt><dt>åŽç¼€å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1225">æ–‡ä»¶åå‡½æ•°</a></dt><dt>suffix function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1225">Filename Functions</a></dt><dt>åŽç¼€è§„åˆ™,<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-831">è§„åˆ™</a>,<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-960">åŽç¼€è§„åˆ™</a></dt><dt>suffix rules, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-831">Rules</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-960">Suffix Rules</a></dt><dd><dl><dt>éšå«è§„åˆ™å’Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-831">è§„åˆ™</a></dt></dl></dd><dd><dl><dt>implicit rules and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-831">Rules</a></dt></dl></dd><dt>åŽç¼€ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-951">æ¨¡å¼</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-962">åŽç¼€è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-963">åŽç¼€è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1223">æ–‡ä»¶åå‡½æ•°</a></dt><dt>suffixes, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-951">The Patterns</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-962">Suffix Rules</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-963">Suffix Rules</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1223">Filename Functions</a></dt><dd><dl><dt>æ–‡ä»¶åã€å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1223">æ–‡ä»¶åå‡½æ•°</a></dt><dt>æ¨¡å¼è§„åˆ™ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-951">æ¨¡å¼</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-963">åŽç¼€è§„åˆ™</a></dt><dd><dl><dt>åˆ é™¤ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-963">åŽç¼€è§„åˆ™</a></dt></dl></dd><dt>ç›®æ ‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-962">åŽç¼€è§„åˆ™</a></dt></dl></dd><dd><dl><dt>filenames, functions, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1223">Filename Functions</a></dt><dt>pattern rules, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-951">The Patterns</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-963">Suffix Rules</a></dt><dd><dl><dt>deleting, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-963">Suffix Rules</a></dt></dl></dd><dt>targets, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-962">Suffix Rules</a></dt></dl></dd><dt>è¯­æ³•ã€<a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-820">åŸºæœ¬ Makefile è¯­æ³•</a>ã€<a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1084">ç‰¹å®šäºŽç›®æ ‡å’Œæ¨¡å¼çš„å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1105">æ¡ä»¶å’ŒåŒ…å«å¤„ç†</a>ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1156">å†…ç½®å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1308">è§£æžå‘½ä»¤</a>ã€<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1600">è¯­æ³•é”™è¯¯</a></dt><dt>syntax, <a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-820">Basic Makefile Syntax</a>, <a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1084">Target- and Pattern-Specific Variables</a>, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1105">Conditional and include Processing</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1156">Built-in Functions</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1308">Parsing Commands</a>, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1600">Syntax Errors</a></dt><dd><dl><dt>å†…ç½®å‡½æ•°,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1156">å†…ç½®å‡½æ•°</a></dt><dt>æ¡ä»¶æŒ‡ä»¤ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1105">Conditional å’Œ include å¤„ç†</a></dt><dt>ç¼–è¾‘å™¨ï¼Œ<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1308">è§£æžå‘½ä»¤</a></dt><dt>é”™è¯¯ã€è°ƒè¯•å’Œ<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1600">è¯­æ³•é”™è¯¯</a></dt><dt>makefileï¼Œ<a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-820">åŸºæœ¬ Makefile è¯­æ³•</a></dt><dt>ç‰¹å®šäºŽç›®æ ‡çš„å˜é‡ã€<a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1084">ç‰¹å®šäºŽç›®æ ‡å’Œæ¨¡å¼çš„å˜é‡</a></dt></dl></dd><dd><dl><dt>built-in functions, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1156">Built-in Functions</a></dt><dt>conditional directives, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1105">Conditional and include Processing</a></dt><dt>editors, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1308">Parsing Commands</a></dt><dt>errors, debugging and, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1600">Syntax Errors</a></dt><dt>makefile, <a class="indexterm" href="#OEBPS/ch01s05.html.make3-CHP-1-ITERM-820">Basic Makefile Syntax</a></dt><dt>target-specific variables, <a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1084">Target- and Pattern-Specific Variables</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>æ—¶é—´</h3><h3>T</h3><dl><dt>åˆ¶è¡¨ç¬¦ã€é”™è¯¯æ¶ˆæ¯ã€<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1602">å‘½ä»¤åœ¨ç¬¬ä¸€ä¸ªç›®æ ‡ä¹‹å‰å¼€å§‹</a></dt><dt>tab character, error message, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1602">commands commence before first target</a></dt><dt>æ ‡ç­¾ ç›®æ ‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-883">è™šå‡ç›®æ ‡</a></dt><dt>TAGS target, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-883">Phony Targets</a></dt><dt>ç‰¹å®šäºŽç›®æ ‡çš„å˜é‡ã€<a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1078">ç‰¹å®šäºŽç›®æ ‡å’Œæ¨¡å¼çš„å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1085">ç‰¹å®šäºŽç›®æ ‡å’Œæ¨¡å¼çš„å˜é‡</a></dt><dt>target-specific variables, <a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1078">Target- and Pattern-Specific Variables</a>, <a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1085">Target- and Pattern-Specific Variables</a></dt><dd><dl><dt>è¯­æ³•ã€<a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1085">ç‰¹å®šäºŽç›®æ ‡å’Œæ¨¡å¼çš„å˜é‡</a></dt></dl></dd><dd><dl><dt>syntax, <a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1085">Target- and Pattern-Specific Variables</a></dt></dl></dd><dt>ç›®æ ‡ã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-792">å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile</a>ã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-796">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-809">ä¾èµ–æ€§æ£€æŸ¥</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-828">è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-842">æ˜¾å¼è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-886">è™šå‡ç›®æ ‡</a>ã€ç©º<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-862">ç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-904">è‡ªåŠ¨å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-941">æ¨¡å¼è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-955">é™æ€æ¨¡å¼è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-961">åŽç¼€è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-989">ç‰¹æ®Šç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-992">ç‰¹æ®Šç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-993">ç‰¹æ®Šç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-995">ç‰¹æ®Šç›®æ ‡</a>,<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-999">ç‰¹æ®Šç›®æ ‡</a>,<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1005">ç‰¹æ®Šç›®æ ‡</a>,<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1007">ç‰¹æ®Šç›®æ ‡</a>,<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1023">ä½¿ç”¨åº“ä½œä¸ºå…ˆå†³æ¡ä»¶</a>,<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1333">åˆ é™¤å’Œä¿ç•™ç›®æ ‡æ–‡ä»¶</a>,<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1378">æž„å»ºå…¶ä»–ç›®æ ‡</a>,<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1607">è¦†ç›–ç›®æ ‡å‘½ä»¤</a><a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-886"></a><a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-904"></a><a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-941"></a><a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-955"></a><a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-961"></a><a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-989"></a><a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-992"></a><a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-993"></a><a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-995"></a><a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-999"></a><a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1005"></a><a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1007"></a><a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1023"></a><a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1333"></a><a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1378"></a><a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1607"></a></dt><dt>targets, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-792">How to Write a Simple Makefile</a>, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-796">Targets and Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-809">Dependency Checking</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-828">Rules</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-842">Explicit Rules</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-862">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-886">Empty Targets</a>, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-904">Automatic Variables</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-941">Pattern Rules</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-955">Static Pattern Rules</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-961">Suffix Rules</a>, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-989">Special Targets</a>, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-992">Special Targets</a>, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-993">Special Targets</a>, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-995">Special Targets</a>, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-999">Special Targets</a>, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1005">Special Targets</a>, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1007">Special Targets</a>, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1023">Using Libraries as Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1333">Deleting and preserving target files</a>, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1378">Building Other Targets</a>, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1607">Overriding Commands for Target</a></dt><dd><dl><dt>è‡ªåŠ¨å˜é‡å’Œ<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-904">è‡ªåŠ¨å˜é‡</a></dt><dt>æž„å»ºç›®æ ‡ã€é€’å½’ make ä»¥åŠ<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1378">æž„å»ºå…¶ä»–ç›®æ ‡</a></dt><dt>ä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-792">å¦‚ä½•ç¼–å†™ç®€å•çš„ Makefile</a></dt><dt>å‘½ä»¤ã€è¦†ç›–ã€<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1607">è¦†ç›–ç›®æ ‡å‘½ä»¤</a></dt><dt>åˆ é™¤ã€<a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1333">åˆ é™¤å’Œä¿ç•™ç›®æ ‡æ–‡ä»¶</a></dt><dt>ç©ºï¼Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-886">ç©ºç›®æ ‡</a></dt><dt>ä¿®é¥°ç¬¦ã€<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-993">ç‰¹æ®Šç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-995">ç‰¹æ®Šç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-999">ç‰¹æ®Šç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1005">ç‰¹æ®Šç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1007">ç‰¹æ®Šç›®æ ‡</a></dt><dd><dl><dt>.DELETE_ON_ERRORï¼Œ<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1007">ç‰¹æ®Šç›®æ ‡</a></dt><dt>.ä¸­çº§ï¼Œ<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-995">ç‰¹æ®Šç›®æ ‡</a></dt><dt>.çè´µ<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1005">çš„ç‰¹æ®Šç›®æ ‡</a></dt><dt>.SECONDARYï¼Œ<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-999">ç‰¹æ®Šç›®æ ‡</a></dt></dl></dd><dt>è™šå‡ç›®æ ‡ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-862">è™šå‡ç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-992">ç‰¹æ®Šç›®æ ‡</a></dt><dd><dl><dt>ç‰¹æ®Šç›®æ ‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-992">ç‰¹æ®Šç›®æ ‡</a></dt></dl></dd><dt>å…ˆå†³æ¡ä»¶ã€<a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-809">ä¾èµ–é¡¹æ£€æŸ¥</a>ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1023">ä½¿ç”¨åº“ä½œä¸ºå…ˆå†³æ¡ä»¶</a></dt><dd><dl><dt>é“¾æŽ¥ã€<a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-809">ä¾èµ–æ€§æ£€æŸ¥</a></dt><dt>ä¿å­˜ï¼Œ<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1023">ä½¿ç”¨åº“ä½œä¸ºå…ˆå†³æ¡ä»¶</a></dt></dl></dd><dt>è§„åˆ™ã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-796">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-828">è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-842">æ˜Žç¡®è§„åˆ™</a></dt><dd><dl><dt>æ˜Žç¡®çš„è§„åˆ™ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-828">è§„åˆ™</a></dt><dt>å¤šé‡ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-842">æ˜Žç¡®çš„è§„åˆ™</a></dt></dl></dd><dt>ç‰¹æ®Šç›®æ ‡ï¼Œ<a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-989">ç‰¹æ®Šç›®æ ‡</a></dt><dt>é™æ€æ¨¡å¼è§„åˆ™,<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-955">é™æ€æ¨¡å¼è§„åˆ™</a></dt><dt>åŽç¼€ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-961">åŽç¼€è§„åˆ™</a></dt><dt>æ›´æ–°ã€è§„åˆ™é“¾æŽ¥å’Œ<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-941">æ¨¡å¼è§„åˆ™</a></dt></dl></dd><dd><dl><dt>automatic variables and, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-904">Automatic Variables</a></dt><dt>build targets, recursive make and, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1378">Building Other Targets</a></dt><dt>as command-line
          arguments, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-792">How to Write a Simple Makefile</a></dt><dt>commands, overriding, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1607">Overriding Commands for Target</a></dt><dt>deleting, <a class="indexterm" href="#OEBPS/ch05.html.make3-CHP-5-ITERM-1333">Deleting and preserving target files</a></dt><dt>empty, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-886">Empty Targets</a></dt><dt>modifiers, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-993">Special Targets</a>, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-995">Special Targets</a>, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-999">Special Targets</a>, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1005">Special Targets</a>, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1007">Special Targets</a></dt><dd><dl><dt>.DELETE_ON_ERROR, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1007">Special Targets</a></dt><dt>.INTERMEDIATE, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-995">Special Targets</a></dt><dt>.PRECIOUS, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-1005">Special Targets</a></dt><dt>.SECONDARY, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-999">Special Targets</a></dt></dl></dd><dt>phony targets, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-862">Phony Targets</a>, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-992">Special Targets</a></dt><dd><dl><dt>special targets, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-992">Special Targets</a></dt></dl></dd><dt>prerequisites, <a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-809">Dependency Checking</a>, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1023">Using Libraries as Prerequisites</a></dt><dd><dl><dt>chaining, <a class="indexterm" href="#OEBPS/ch01s02.html.make3-CHP-1-ITERM-809">Dependency Checking</a></dt><dt>saving, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1023">Using Libraries as Prerequisites</a></dt></dl></dd><dt>rules, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-796">Targets and Prerequisites</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-828">Rules</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-842">Explicit Rules</a></dt><dd><dl><dt>explicit rules, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-828">Rules</a></dt><dt>multiple, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-842">Explicit Rules</a></dt></dl></dd><dt>special targets, <a class="indexterm" href="#OEBPS/ch02s06.html.make3-CHP-2-ITERM-989">Special Targets</a></dt><dt>static pattern rules, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-955">Static Pattern Rules</a></dt><dt>suffixes, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-961">Suffix Rules</a></dt><dt>updating, rule chaining and, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-941">Pattern Rules</a></dt></dl></dd><dt>ä»»åŠ¡ï¼ˆèš‚èšï¼‰ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1482">èš‚èš</a></dt><dt>tasks (Ant), <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1482">Ant</a></dt><dt>æ–‡æœ¬æ‰©å±•ã€foreach å‡½æ•°å’Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1259">æµç¨‹æŽ§åˆ¶</a></dt><dt>text expansion, foreach function and, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1259">Flow Control</a></dt><dt>æ—¶é—´æˆ³ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-892">ç©ºç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1209">é‡è¦æ‚é¡¹å‡½æ•°</a></dt><dt>timestamps, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-892">Empty Targets</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1209">Important Miscellaneous Functions</a></dt><dd><dl><dt>ç©ºæ–‡ä»¶å’Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-892">ç©ºç›®æ ‡</a></dt><dt>æ–‡ä»¶åå’Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1209">é‡è¦çš„æ‚é¡¹åŠŸèƒ½</a></dt></dl></dd><dd><dl><dt>empty files and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-892">Empty Targets</a></dt><dt>filenames and, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1209">Important Miscellaneous Functions</a></dt></dl></dd><dt>è‡ªä¸Šè€Œä¸‹çš„é£Žæ ¼ã€makefileã€<a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-805">ç›®æ ‡å’Œå…ˆå†³æ¡ä»¶</a></dt><dt>top-down style, makefiles, <a class="indexterm" href="#OEBPS/ch01.html.make3-CHP-1-ITERM-805">Targets and Prerequisites</a></dt><dt>--touché€‰é¡¹ï¼Œ<a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1620">è¿è¡Œmake</a></dt><dt>--touch option, <a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1620">Running make</a></dt></dl></div><div class="indexdiv"><h3>U</h3><h3>U</h3><dl><dt>æ›´æ–°ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-942">æ¨¡å¼è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-976">è§„åˆ™ç»“æž„</a>ã€<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1020">åˆ›å»ºå’Œæ›´æ–°åº“</a>ã€<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1368">é€’å½’ make</a></dt><dt>updates, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-942">Pattern Rules</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-976">Rule Structure</a>, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1020">Creating and Updating Libraries</a>, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1368">Recursive make</a></dt><dd><dl><dt>åº“ï¼Œ<a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1020">åˆ›å»ºå’Œæ›´æ–°åº“</a></dt><dt>ç›®æ ‡æ–‡ä»¶ã€è§„åˆ™ã€<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-976">è§„åˆ™ç»“æž„</a></dt><dt>å…ˆå†³æ¡ä»¶ã€æŽ’åºå’Œ<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1368">é€’å½’ make</a></dt><dt>ç›®æ ‡ã€è§„åˆ™é“¾ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-942">æ¨¡å¼è§„åˆ™</a></dt></dl></dd><dd><dl><dt>libraries, <a class="indexterm" href="#OEBPS/ch02s08.html.make3-CHP-2-ITERM-1020">Creating and Updating Libraries</a></dt><dt>object files, rules, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-976">Rule Structure</a></dt><dt>prerequisites, ordering and, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1368">Recursive make</a></dt><dt>targets, rule chaining, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-942">Pattern Rules</a></dt></dl></dd><dt>ç”¨æˆ·å®šä¹‰å‡½æ•°,<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1046">å˜é‡å’Œå®</a>,<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1141">ç”¨æˆ·å®šä¹‰å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1143">ç”¨æˆ·å®šä¹‰</a><a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1152">å‡½æ•°</a>,ç”¨æˆ·å®šä¹‰å‡½æ•°,<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1145">ç”¨æˆ·å®šä¹‰å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1277">é«˜çº§ç”¨æˆ·å®šä¹‰å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1298">ä¼ é€’å‚æ•°</a>,<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1581">ç”¨æˆ·å®šä¹‰å‡½æ•°</a><a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1143"></a><a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1145"></a><a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1277"></a><a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1298"></a><a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1581"></a></dt><dt>user-defined functions, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1046">Variables and Macros</a>, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1141">User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1152">User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1143">User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1145">User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1277">Advanced User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1298">Passing Parameters</a>, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1581">User-Defined Functions</a></dt><dd><dl><dt>é«˜çº§ã€<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1277">é«˜çº§ç”¨æˆ·å®šä¹‰å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1298">ä¼ é€’å‚æ•°</a></dt><dt>ç»ˆæ­¢è¿›ç¨‹å’Œ<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1143">ç”¨æˆ·å®šä¹‰çš„å‡½æ•°</a></dt><dt>Linux å†…æ ¸ makefileã€<a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1581">ç”¨æˆ·å®šä¹‰å‡½æ•°</a></dt><dt>å‚æ•°å’Œ<a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1145">ç”¨æˆ·å®šä¹‰çš„å‡½æ•°</a></dt><dt>å˜é‡å’Œï¼Œ<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1046">å˜é‡å’Œå®</a></dt></dl></dd><dd><dl><dt>advanced, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1277">Advanced User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1298">Passing Parameters</a></dt><dt>killing processes and, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1143">User-Defined Functions</a></dt><dt>Linux kernel makefile, <a class="indexterm" href="#OEBPS/ch11s02.html.make3-CHP-11-ITERM-1581">User-Defined Functions</a></dt><dt>parameters and, <a class="indexterm" href="#OEBPS/ch04.html.make3-CHP-4-ITERM-1145">User-Defined Functions</a></dt><dt>variables and, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1046">Variables and Macros</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>V</h3><h3>V</h3><dl><dt>éªŒè¯æºä»£ç ï¼Œä¹¦ç± makefileï¼Œ<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1567">éªŒè¯æºä»£ç </a></dt><dt>validating source, book makefile, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1567">Validating the Source</a></dt><dt>.VARIABLES å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1136">æ ‡å‡† make å˜é‡</a></dt><dt>.VARIABLES
                variable, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1136">Standard make Variables</a></dt><dt>å˜é‡ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-894">ç©ºç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-898">å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-899">è‡ªåŠ¨å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-933">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a>ã€<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-957">é™æ€æ¨¡å¼è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-980">è§„åˆ™ç»“æž„</a>ã€<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1032">å˜é‡</a><a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1031">å’Œå®</a>ã€å˜é‡å’Œå®ã€å˜é‡<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1034">å’Œå®</a>ã€å˜é‡<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1036">å’Œå®</a>ã€<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1038">å˜é‡å’Œå®</a>ã€<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1042">å˜é‡å’Œå®</a>ã€<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1044">å˜é‡å’Œå®</a>,<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1047">å˜é‡å’Œå®</a>,<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1048">å˜é‡çš„ç”¨é€”</a>,<a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1049">å˜é‡ç±»åž‹</a>,<a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1051">å˜é‡ç±»åž‹</a>,<a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1054">å…¶ä»–ç±»åž‹çš„</a>èµ‹å€¼,<a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1056">å…¶ä»–ç±»åž‹çš„èµ‹å€¼</a>,<a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1061">å®</a>,<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1066">ä½•æ—¶æ‰©å±•å˜é‡</a>,<a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1080">ç‰¹å®šäºŽç›®æ ‡å’Œæ¨¡å¼çš„å˜é‡</a>,<a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1081">ç‰¹å®šäºŽç›®æ ‡å’Œæ¨¡å¼çš„å˜é‡</a>,ç‰¹å®šäºŽ<a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1083">ç›®æ ‡å’Œæ¨¡å¼çš„å˜é‡</a>,<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1086">å˜é‡æ¥è‡ªå“ªé‡Œ</a>,<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1096">å˜é‡æ¥è‡ªå“ªé‡Œ</a><a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1092">,</a>å˜é‡æ¥è‡ªå“ªé‡Œ,<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1098">å˜é‡æ¥è‡ªå“ªé‡Œ</a>,<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1120">æ ‡å‡†åˆ¶ä½œå˜é‡</a>,<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1121">æ ‡å‡†åˆ¶ä½œå˜é‡</a>,<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1124">æ ‡å‡†åˆ¶ä½œå˜é‡</a>,<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1126">æ ‡å‡†åˆ¶ä½œå˜é‡</a>,<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1129">æ ‡å‡†åˆ¶ä½œå˜é‡</a>,<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1131">æ ‡å‡†make å˜é‡</a>,<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1133">æ ‡å‡† make å˜é‡</a>,<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1134">æ ‡å‡† make å˜é‡</a>,<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1137">æ ‡å‡† make å˜é‡</a>,<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1139">æ ‡å‡† make å˜é‡</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1205">é‡è¦æ‚é¡¹å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1255">æµç¨‹æŽ§åˆ¶</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1261">æœ‰å…³å˜é‡å’Œæ‹¬å·çš„æ ·å¼æ³¨é‡Š</a>,<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1270">ä¸å¤ªé‡è¦çš„æ‚é¡¹å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1281">é«˜çº§ç”¨æˆ·å®šä¹‰å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1282">é«˜çº§ç”¨æˆ·å®šä¹‰å‡½æ•°</a>,<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1344">å‘½ä»¤çŽ¯å¢ƒ</a>,<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1348">å‘½ä»¤çŽ¯å¢ƒ</a>,<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1356">å‘½ä»¤çŽ¯å¢ƒ</a>,<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1374">ä¼ é€’å˜é‡</a>,<a class="indexterm" href="#OEBPS/ch08s04.html.make3-CHP-8-ITERM-1453">æ”¯æŒå¤šä¸ªäºŒå‰æ ‘</a>,<a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1499">è®¾ç½® CLASSPATH</a> , <a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1518">Enterprise JavaBeans</a> ,<a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1529">åŸºå‡†æµ‹è¯•</a>,<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1540">ç®€å•å˜é‡ä¸Žé€’å½’</a>,<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1541">ç®€å•å˜é‡ä¸Žé€’å½’</a>,<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1603">æœªç»ˆæ­¢å˜é‡å¼•ç”¨</a>,<a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1624">æ•°æ®ç»“æž„</a><a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1032"></a><a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1034"></a><a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1036"></a><a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1038"></a><a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1042"></a><a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1044"></a><a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1047"></a><a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1048"></a><a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1049"></a><a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1051"></a><a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1054"></a><a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1056"></a><a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1061"></a><a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1066"></a><a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1080"></a><a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1081"></a><a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1083"></a><a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1086"></a><a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1092"></a><a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1096"></a><a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1098"></a><a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1120"></a><a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1121"></a><a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1124"></a><a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1126"></a><a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1129"></a><a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1131"></a><a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1133"></a><a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1134"></a><a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1137"></a><a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1139"></a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1205"></a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1255"></a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1261"></a><a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1270"></a><a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1281"></a><a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1282"></a><a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1344"></a><a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1348"></a><a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1356"></a><a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1374"></a><a class="indexterm" href="#OEBPS/ch08s04.html.make3-CHP-8-ITERM-1453"></a><a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1499"></a><a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1518"></a><a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1529"></a><a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1540"></a><a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1541"></a><a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1603"></a><a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1624"></a></dt><dt>variables, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-894">Empty Targets</a>, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-898">Variables</a>, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-899">Automatic Variables</a>, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-933">Finding Files with VPATH and vpath</a>, <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-957">Static Pattern Rules</a>, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-980">Rule Structure</a>, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1031">Variables and Macros</a>, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1032">Variables and Macros</a>, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1034">Variables and Macros</a>, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1036">Variables and Macros</a>, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1038">Variables and Macros</a>, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1042">Variables and Macros</a>, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1044">Variables and Macros</a>, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1047">Variables and Macros</a>, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1048">What Variables Are Used For</a>, <a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1049">Variable Types</a>, <a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1051">Variable Types</a>, <a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1054">Other Types of Assignment</a>, <a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1056">Other Types of Assignment</a>, <a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1061">Macros</a>, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1066">When Variables Are Expanded</a>, <a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1080">Target- and Pattern-Specific Variables</a>, <a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1081">Target- and Pattern-Specific Variables</a>, <a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1083">Target- and Pattern-Specific Variables</a>, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1086">Where Variables Come From</a>, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1092">Where Variables Come From</a>, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1096">Where Variables Come From</a>, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1098">Where Variables Come From</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1120">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1121">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1124">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1126">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1129">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1131">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1133">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1134">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1137">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1139">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1205">Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1255">Flow Control</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1261">Style note concerning variables and parentheses</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1270">Less Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1281">Advanced User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1282">Advanced User-Defined Functions</a>, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1344">Command Environment</a>, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1348">Command Environment</a>, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1356">Command Environment</a>, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1374">Passing Variables</a>, <a class="indexterm" href="#OEBPS/ch08s04.html.make3-CHP-8-ITERM-1453">Supporting Multiple Binary Trees</a>, <a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1499">Setting CLASSPATH</a>, <a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1518">Enterprise JavaBeans</a>, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1529">Benchmarking</a>, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1540">Simple Variables Versus Recursive</a>, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1541">Simple Variables Versus Recursive</a>, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1603">unterminated variable reference</a>, <a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1624">Data Structures</a></dt><dd><dl><dt>$(OBJECTS)ï¼Œ<a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-957">é™æ€æ¨¡å¼è§„åˆ™</a></dt><dt>+=ï¼ˆé™„åŠ ï¼‰è¿ç®—ç¬¦ï¼Œ<a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1056">å…¶ä»–ç±»åž‹çš„èµ‹å€¼</a></dt><dt>ALL_TREESï¼Œ<a class="indexterm" href="#OEBPS/ch08s04.html.make3-CHP-8-ITERM-1453">æ”¯æŒå¤šäºŒå‰æ ‘</a></dt><dt>åˆ†é…ã€é€Ÿåº¦ã€<a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1529">åŸºå‡†æµ‹è¯•</a></dt><dt>è‡ªåŠ¨ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-894">ç©ºç›®æ ‡</a>ã€<a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-899">è‡ªåŠ¨å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1096">å˜é‡æ¥è‡ªå“ªé‡Œ</a></dt><dd><dl><dt>ç©ºç›®æ ‡å’Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-894">ç©ºç›®æ ‡</a></dt></dl></dd><dt>å†…ç½®è§„åˆ™ã€<a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-980">è§„åˆ™ç»“æž„</a></dt><dt>åŒºåˆ†å¤§å°å†™ã€<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1034">å˜é‡å’Œå®</a></dt><dt>å…è®¸çš„å­—ç¬¦ã€<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1032">å˜é‡å’Œå®</a></dt><dt>CLASSPATHã€Java makefileã€<a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1499">è®¾ç½® CLASSPATH</a></dt><dt>è®¡ç®—ã€æ–­è¨€å‡½æ•°å’Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1255">æµç¨‹æŽ§åˆ¶</a></dt><dt>å¸¸é‡ã€ç”¨æˆ·è‡ªå®šä¹‰ã€<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1042">å˜é‡å’Œå®</a></dt><dt>CPPFLAGSã€<a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1083">ç‰¹å®šäºŽç›®æ ‡å’Œæ¨¡å¼çš„å˜é‡</a></dt><dt>CURDIRã€<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1124">æ ‡å‡† make å˜é‡</a>ã€<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1126">æ ‡å‡† make å˜é‡</a></dt><dt>debug-enterï¼Œ<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1281">é«˜çº§ç”¨æˆ·å®šä¹‰å‡½æ•°</a></dt><dt>è°ƒè¯•ç¦»å¼€ï¼Œ<a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1282">é«˜çº§ç”¨æˆ·å®šä¹‰å‡½æ•°</a></dt><dt>å¼€å‘çŽ¯å¢ƒï¼Œ<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1098">å˜é‡ä»Žä½•è€Œæ¥</a></dt><dt>EJBSã€<a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1518">ä¼ä¸š JavaBean</a></dt><dt>é”™è¯¯æ¶ˆæ¯ï¼Œ<a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1603">æœªç»ˆæ­¢çš„å˜é‡å¼•ç”¨</a></dt><dt>æ‰©å±•,<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1038">å˜é‡å’Œå®</a>,<a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1066">å½“å˜é‡æ‰©å±•æ—¶</a></dt><dd><dl><dt>å¤§æ‹¬å·å’Œ<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1038">å˜é‡å’Œå®</a></dt></dl></dd><dt>å¯¼å‡ºï¼Œ<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1092">å˜é‡ä»Žä½•è€Œæ¥</a></dt><dt>å‡½æ•°ã€ç”¨æˆ·å®šä¹‰ã€<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1044">å˜é‡å’Œå®</a></dt><dt>grep å‘½ä»¤ï¼Œ<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1356">å‘½ä»¤çŽ¯å¢ƒ</a></dt><dt>ç®€ä»‹ã€<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1031">å˜é‡å’Œå®</a></dt><dt>å®å’Œ<a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1061">å®</a></dt><dt>MAKECMDGOALSï¼Œ<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1133">æ ‡å‡† make å˜é‡</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1134">æ ‡å‡† make å˜é‡</a></dt><dt>MAKEFILE_LISTï¼Œ<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1129">æ ‡å‡† make å˜é‡</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1131">æ ‡å‡† make å˜é‡</a></dt><dt>MAKEFLAGSã€å‘½ä»¤çŽ¯å¢ƒå’Œ<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1344">å‘½ä»¤çŽ¯å¢ƒ</a></dt><dt>MAKELEVELï¼Œ<a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1348">å‘½ä»¤çŽ¯å¢ƒ</a></dt><dt>MAKE_VERSIONï¼Œ<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1120">æ ‡å‡† make å˜é‡</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1121">æ ‡å‡† make å˜é‡</a></dt><dt>è¿ç®—ç¬¦ã€<a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1054">å…¶ä»–ç±»åž‹çš„èµ‹å€¼</a></dt><dd><dl><dt>?=ï¼ˆæ¡ä»¶å˜é‡èµ‹å€¼è¿ç®—ç¬¦ï¼‰ï¼Œ<a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1054">å…¶ä»–ç±»åž‹çš„èµ‹å€¼</a></dt></dl></dd><dt>èµ·æºã€èµ·æºå‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1270">ä¸å¤ªé‡è¦çš„æ‚é¡¹å‡½æ•°</a></dt><dt>æ‹¬å·å’Œï¼Œ<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1036">å˜é‡å’Œå®</a>ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1261">æœ‰å…³å˜é‡å’Œæ‹¬å·çš„æ ·å¼æ³¨é‡Š</a></dt><dt>ä¼ é€’ã€é€’å½’ make å’Œã€<a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1374">ä¼ é€’å˜é‡</a></dt><dt>æ¨¡å¼ç‰¹å®šã€<a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1081">ç›®æ ‡ç‰¹å®šå’Œæ¨¡å¼ç‰¹å®šå˜é‡</a></dt><dt>å‘¨æœŸã€åµŒå…¥å¼ã€<a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1624">æ•°æ®ç»“æž„</a></dt><dt>é€’å½’ã€æ€§èƒ½å’Œ<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1540">ç®€å•å˜é‡ä¸Žé€’å½’</a></dt><dt>é€’å½’æ‰©å±•ï¼Œ<a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1051">å˜é‡ç±»åž‹</a></dt><dt>shellå‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1205">é‡è¦çš„æ‚é¡¹å‡½æ•°</a></dt><dt>ç®€å•ã€æ€§èƒ½å’Œ<a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1541">ç®€å•å˜é‡ä¸Žé€’å½’</a></dt><dt>ç®€å•æ‰©å±•ï¼Œ<a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1049">å˜é‡ç±»åž‹</a></dt><dt>æ¥æºï¼Œ<a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1086">å˜é‡ä»Žä½•è€Œæ¥</a></dt><dt>ç‰¹å®šäºŽç›®æ ‡ã€<a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1080">ç‰¹å®šäºŽç›®æ ‡å’Œæ¨¡å¼çš„å˜é‡</a></dt><dt>å°¾éšç©ºæ ¼ã€<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1047">å˜é‡å’Œå®</a></dt><dt>ç”¨é€”ï¼Œ<a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1048">å˜é‡çš„ç”¨é€”</a></dt><dt>.VARIABLEï¼Œ<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1137">æ ‡å‡† make å˜é‡</a></dt><dt>å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1139">æ ‡å‡† make å˜é‡</a></dt><dt>VPATHï¼Œ<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-933">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a>ï¼ˆè¯·å‚é˜… VPATHï¼‰</dt></dl></dd><dd><dl><dt>$(OBJECTS), <a class="indexterm" href="#OEBPS/ch02s04.html.make3-CHP-2-ITERM-957">Static Pattern Rules</a></dt><dt>+= (append) operator, <a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1056">Other Types of Assignment</a></dt><dt>ALL_TREES, <a class="indexterm" href="#OEBPS/ch08s04.html.make3-CHP-8-ITERM-1453">Supporting Multiple Binary Trees</a></dt><dt>assigning, speed, <a class="indexterm" href="#OEBPS/ch10.html.make3-CHP-10-ITERM-1529">Benchmarking</a></dt><dt>automatic, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-894">Empty Targets</a>, <a class="indexterm" href="#OEBPS/ch02s02.html.make3-CHP-2-ITERM-899">Automatic Variables</a>, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1096">Where Variables Come From</a></dt><dd><dl><dt>empty targets and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-894">Empty Targets</a></dt></dl></dd><dt>built-in rules, <a class="indexterm" href="#OEBPS/ch02s05.html.make3-CHP-2-ITERM-980">Rule Structure</a></dt><dt>case-sensitivity, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1034">Variables and Macros</a></dt><dt>characters allowed, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1032">Variables and Macros</a></dt><dt>CLASSPATH, Java makefile, <a class="indexterm" href="#OEBPS/ch09s03.html.make3-CHP-9-ITERM-1499">Setting CLASSPATH</a></dt><dt>computed, assert function and, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1255">Flow Control</a></dt><dt>constants, user-customized, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1042">Variables and Macros</a></dt><dt>CPPFLAGS, <a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1083">Target- and Pattern-Specific Variables</a></dt><dt>CURDIR, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1124">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1126">Standard make Variables</a></dt><dt>debug-enter, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1281">Advanced User-Defined Functions</a></dt><dt>debug-leave, <a class="indexterm" href="#OEBPS/ch04s03.html.make3-CHP-4-ITERM-1282">Advanced User-Defined Functions</a></dt><dt>development environment, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1098">Where Variables Come From</a></dt><dt>EJBS, <a class="indexterm" href="#OEBPS/ch09s06.html.make3-CHP-9-ITERM-1518">Enterprise JavaBeans</a></dt><dt>error messagess, <a class="indexterm" href="#OEBPS/ch12s03.html.make3-CHP-12-ITERM-1603">unterminated variable reference</a></dt><dt>expanding, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1038">Variables and Macros</a>, <a class="indexterm" href="#OEBPS/ch03s04.html.make3-CHP-3-ITERM-1066">When Variables Are Expanded</a></dt><dd><dl><dt>curly braces and, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1038">Variables and Macros</a></dt></dl></dd><dt>exporting, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1092">Where Variables Come From</a></dt><dt>functions, user-defined, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1044">Variables and Macros</a></dt><dt>grep command, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1356">Command Environment</a></dt><dt>introduction, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1031">Variables and Macros</a></dt><dt>macros and, <a class="indexterm" href="#OEBPS/ch03s03.html.make3-CHP-3-ITERM-1061">Macros</a></dt><dt>MAKECMDGOALS, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1133">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1134">Standard make Variables</a></dt><dt>MAKEFILE_LIST, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1129">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1131">Standard make Variables</a></dt><dt>MAKEFLAGS, command environment and, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1344">Command Environment</a></dt><dt>MAKELEVEL, <a class="indexterm" href="#OEBPS/ch05s04.html.make3-CHP-5-ITERM-1348">Command Environment</a></dt><dt>MAKE_VERSION, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1120">Standard make Variables</a>, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1121">Standard make Variables</a></dt><dt>operators, <a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1054">Other Types of Assignment</a></dt><dd><dl><dt>?= (conditional variable assignment
              operator), <a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1054">Other Types of Assignment</a></dt></dl></dd><dt>origins, origin function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1270">Less Important Miscellaneous Functions</a></dt><dt>parentheses and, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1036">Variables and Macros</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1261">Style note concerning variables and parentheses</a></dt><dt>passing, recursive make and, <a class="indexterm" href="#OEBPS/ch06.html.make3-CHP-6-ITERM-1374">Passing Variables</a></dt><dt>pattern-specific, <a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1081">Target- and Pattern-Specific Variables</a></dt><dt>periods, embedded, <a class="indexterm" href="#OEBPS/apb.html.make3-APP-B-ITERM-1624">Data Structures</a></dt><dt>recursive, performance and, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1540">Simple Variables Versus Recursive</a></dt><dt>recursively expanded, <a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1051">Variable Types</a></dt><dt>shell function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1205">Important Miscellaneous Functions</a></dt><dt>simple, performance and, <a class="indexterm" href="#OEBPS/ch10s02.html.make3-CHP-10-ITERM-1541">Simple Variables Versus Recursive</a></dt><dt>simply expanded, <a class="indexterm" href="#OEBPS/ch03s02.html.make3-CHP-3-ITERM-1049">Variable Types</a></dt><dt>sources, <a class="indexterm" href="#OEBPS/ch03s06.html.make3-CHP-3-ITERM-1086">Where Variables Come From</a></dt><dt>target-specific, <a class="indexterm" href="#OEBPS/ch03s05.html.make3-CHP-3-ITERM-1080">Target- and Pattern-Specific Variables</a></dt><dt>trailing spaces and, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1047">Variables and Macros</a></dt><dt>uses, <a class="indexterm" href="#OEBPS/ch03.html.make3-CHP-3-ITERM-1048">What Variables Are Used For</a></dt><dt>.VARIABLE, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1137">Standard make Variables</a></dt><dt>VARIABLES, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1139">Standard make Variables</a></dt><dt>VPATH, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-933">Finding Files with VPATH and vpath</a> (see VPATH)</dt></dl></dd><dt>VARIABLES å˜é‡ï¼Œ<a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1138">æ ‡å‡† make å˜é‡</a></dt><dt>VARIABLES variable, <a class="indexterm" href="#OEBPS/ch03s08.html.make3-CHP-3-ITERM-1138">Standard make Variables</a></dt><dt>VPATHï¼Œ<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-917">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a></dt><dt>VPATH, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-917">Finding Files with VPATH and vpath</a></dt><dt>vpathï¼Œ<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-918">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a></dt><dt>vpath, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-918">Finding Files with VPATH and vpath</a></dt><dt>vpath æŒ‡ä»¤ï¼Œ<a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-934">ä½¿ç”¨ VPATH å’Œ vpath æŸ¥æ‰¾æ–‡ä»¶</a></dt><dt>vpath directive, <a class="indexterm" href="#OEBPS/ch02s03.html.make3-CHP-2-ITERM-934">Finding Files with VPATH and vpath</a></dt></dl></div><div class="indexdiv"><h3>ç“¦</h3><h3>W</h3><dl><dt>--warn-undefined-variables é€‰é¡¹ï¼Œ<a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1590">--warn-undefined-variables</a>ï¼Œ<a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1622">è¿è¡Œ make</a></dt><dt>--warn-undefined-variables
                option, <a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1590">â€”warn-undefined-variables</a>, <a class="indexterm" href="#OEBPS/apa.html.make3-APP-A-ITERM-1622">Running make</a></dt><dd><dl><dt>è°ƒè¯•å’Œ<a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1590">â€”â€”è­¦å‘Šæœªå®šä¹‰å˜é‡</a></dt></dl></dd><dd><dl><dt>debugging and, <a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1590">â€”warn-undefined-variables</a></dt></dl></dd><dt>è­¦å‘Šå‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1271">ä¸å¤ªé‡è¦çš„æ‚é¡¹å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1584">make çš„è°ƒè¯•åŠŸèƒ½</a></dt><dt>warning function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1271">Less Important Miscellaneous Functions</a>, <a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1584">Debugging Features of make</a></dt><dd><dl><dt>è°ƒè¯•å’Œ<a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1584">make çš„è°ƒè¯•åŠŸèƒ½</a></dt></dl></dd><dd><dl><dt>debugging and, <a class="indexterm" href="#OEBPS/ch12.html.make3-CHP-12-ITERM-1584">Debugging Features of make</a></dt></dl></dd><dt>ç©ºç™½ã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1111">æ¡ä»¶å¹¶åŒ…æ‹¬å¤„ç†</a>ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1159">å†…ç½®å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1189">å­—ç¬¦ä¸²å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1267">ä¸å¤ªé‡è¦çš„æ‚é¡¹å‡½æ•°</a></dt><dt>whitespace, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1111">Conditional and include Processing</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1159">Built-in Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1189">String Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1267">Less Important Miscellaneous Functions</a></dt><dd><dl><dt>ç”¨äºŽæ“ä½œçš„å‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1189">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>åˆ é™¤ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1159">å†…ç½®å‡½æ•°</a>ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1267">ä¸å¤ªé‡è¦çš„æ‚é¡¹å‡½æ•°</a></dt><dd><dl><dt>å‰¥ç¦»å‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1267">ä¸å¤ªé‡è¦çš„æ‚é¡¹å‡½æ•°</a></dt></dl></dd><dt>å‰¥ç¦»åŠŸèƒ½å’Œã€<a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1111">æ¡ä»¶å’ŒåŒ…æ‹¬å¤„ç†</a></dt></dl></dd><dd><dl><dt>functions for manipulating, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1189">String Functions</a></dt><dt>removing, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1159">Built-in Functions</a>, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1267">Less Important Miscellaneous Functions</a></dt><dd><dl><dt>strip function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1267">Less Important Miscellaneous Functions</a></dt></dl></dd><dt>strip function and, <a class="indexterm" href="#OEBPS/ch03s07.html.make3-CHP-3-ITERM-1111">Conditional and include Processing</a></dt></dl></dd><dt>é€šé…ç¬¦å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1213">æ–‡ä»¶åå‡½æ•°</a></dt><dt>wildcard function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1213">Filename Functions</a></dt><dt>é€šé…ç¬¦ç©ºæ ¼å‡½æ•°ï¼Œ<a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1432">ç®¡ç†ç¨‹åºå’Œæ–‡ä»¶</a></dt><dt>wildcard-spaces function, <a class="indexterm" href="#OEBPS/ch07s03.html.make3-CHP-7-ITERM-1432">Managing Programs and Files</a></dt><dt>é€šé…ç¬¦ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-829">è§„åˆ™</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-844">é€šé…ç¬¦</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-846">é€šé…ç¬¦</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-860">é€šé…ç¬¦</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-848">é€šé…ç¬¦</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-850">é€šé…ç¬¦</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-852">é€šé…ç¬¦</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-856">é€šé…ç¬¦</a>ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-859">é€šé…ç¬¦</a><a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-860"></a></dt><dt>wildcards, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-829">Rules</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-844">Wildcards</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-846">Wildcards</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-848">Wildcards</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-850">Wildcards</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-852">Wildcards</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-856">Wildcards</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-859">Wildcards</a>, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-860">Wildcards</a></dt><dd><dl><dt>ï¼ˆå¦è¯·å‚è§é€šé…ç¬¦ï¼‰</dt><dt>ï¼Ÿ ï¼ˆé—®å·ï¼‰ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-848">é€šé…ç¬¦</a></dt><dt>è°ƒç”¨å‡½æ•°å’Œã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-859">é€šé…ç¬¦</a></dt><dt>å­—ç¬¦ç±»ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-850">é€šé…ç¬¦</a></dt><dt>æ‰©å±•ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-856">é€šé…ç¬¦</a></dt><dt>æ»¥ç”¨ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-860">é€šé…ç¬¦</a></dt><dt>æ¨¡å¼è§„åˆ™å’Œ<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-829">è§„åˆ™</a></dt><dt>^ï¼ˆæ³¢å½¢ç¬¦ï¼‰ã€<a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-852">é€šé…ç¬¦</a></dt></dl></dd><dd><dl><dt>(see also globbing)</dt><dt>? (question mark), <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-848">Wildcards</a></dt><dt>calling functions and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-859">Wildcards</a></dt><dt>character classes, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-850">Wildcards</a></dt><dt>expanding, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-856">Wildcards</a></dt><dt>misuse, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-860">Wildcards</a></dt><dt>pattern rules and, <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-829">Rules</a></dt><dt>^ (tilde), <a class="indexterm" href="#OEBPS/ch02.html.make3-CHP-2-ITERM-852">Wildcards</a></dt></dl></dd><dt>Windows æ–‡ä»¶ç³»ç»Ÿã€Cygwin å’Œ<a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1428">æ–‡ä»¶ç³»ç»Ÿ</a></dt><dt>Windows filesystem, Cygwin and, <a class="indexterm" href="#OEBPS/ch07s02.html.make3-CHP-7-ITERM-1428">Filesystem</a></dt><dt>è¯è¡¨å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1197">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>wordlist function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1197">String Functions</a></dt><dt>å•è¯å‡½æ•°ã€<a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1191">å­—ç¬¦ä¸²å‡½æ•°</a></dt><dt>words function, <a class="indexterm" href="#OEBPS/ch04s02.html.make3-CHP-4-ITERM-1191">String Functions</a></dt></dl></div><div class="indexdiv"><h3>X</h3><h3>X</h3><dl><dt>XMLã€<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1477">Ant</a>ã€<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1557">XML é¢„å¤„ç†</a></dt><dt>XML, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1477">Ant</a>, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1557">XML Preprocessing</a></dt><dd><dl><dt>æž„å»ºæ–‡ä»¶ï¼Œ<a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1477">Ant</a></dt><dt>é¢„å¤„ç†ä¹¦ç± makefileï¼Œ<a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1557">XML é¢„å¤„ç†</a></dt></dl></dd><dd><dl><dt>build files, <a class="indexterm" href="#OEBPS/ch09.html.make3-CHP-9-ITERM-1477">Ant</a></dt><dt>preprocessing book makefile, <a class="indexterm" href="#OEBPS/ch11.html.make3-CHP-11-ITERM-1557">XML Preprocessing</a></dt></dl></dd></dl></div></div></div></div></div>
<div id="OEBPS/author_bios.html"><div>
<div class="colophon" title="å…³äºŽä½œè€…"><h1 class="title"><a id="OEBPS/author_bios.html.id3179715"></a>å…³äºŽä½œè€…</h1><h1 class="title"><a></a>About the Author</h1><p>Robert Mecklenburg äºŽ 1977 å¹´ä½œä¸ºä¸€åå­¦ç”Ÿå¼€å§‹ä½¿ç”¨ Unixï¼Œå¹¶å·²ä»Žäº‹ä¸“ä¸šç¼–ç¨‹ 23 å¹´ã€‚ä»–çš„ make ç»éªŒå§‹äºŽ 1982 å¹´åœ¨ NASA çš„ Unix ç‰ˆæœ¬ 7ã€‚ 1991 å¹´èŽ·å¾—çŠ¹ä»–å¤§å­¦è®¡ç®—æœºç§‘å­¦åšå£«å­¦ä½ã€‚æ­¤åŽï¼Œä»–æ¶‰è¶³ä»Žæœºæ¢° CAD åˆ°ç”Ÿç‰©ä¿¡æ¯å­¦ç­‰å¤šä¸ªé¢†åŸŸï¼Œå¹¶åˆ©ç”¨è‡ªå·±åœ¨ C++ã€Java å’Œ Lisp æ–¹é¢çš„ä¸°å¯Œç»éªŒæ¥è§£å†³ make çš„é¡¹ç›®ç®¡ç†é—®é¢˜ã€‚</p><p>Robert Mecklenburg began using Unix as a student in 1977 and has been programming professionally for 23 years. His make experience started in 1982 at NASA with Unix version 7. Robert received his Ph.D. in Computer Science from the University of Utah in 1991. Since then, he has worked in many fields ranging from mechanical CAD to bioinformatics, and he brings his extensive experience in C++, Java, and Lisp to bear on the problems of project management with make</p></div></div></div>
<div id="OEBPS/co02.html"><div>
<div class="colophon" title="ç‰ˆç”»"><h1 class="title"><a id="OEBPS/co02.html.make3-COLOPHON"></a>ç‰ˆç”»</h1><h1 class="title"><a></a>Colophon</h1><p>æˆ‘ä»¬çš„å¤–è§‚æ˜¯è¯»è€…è¯„è®ºã€æˆ‘ä»¬è‡ªå·±çš„å®žéªŒä»¥åŠå‘è¡Œæ¸ é“åé¦ˆçš„ç»“æžœã€‚ç‹¬ç‰¹çš„å°é¢è¡¥å……äº†æˆ‘ä»¬å¤„ç†æŠ€æœ¯ä¸»é¢˜çš„ç‹¬ç‰¹æ–¹æ³•ï¼Œä¸ºæ½œåœ¨çš„æž¯ç‡¥ä¸»é¢˜æ³¨å…¥ä¸ªæ€§å’Œç”Ÿå‘½åŠ›ã€‚</p><p>Our look is the result of reader comments, our own experimentation,
    and feedback from distribution channels. Distinctive covers complement our
    distinctive approach to technical topics, breathing personality and life
    into potentially dry subjects.</p><p>ã€Šä½¿ç”¨ GNU Make ç®¡ç†é¡¹ç›®ï¼Œç¬¬ä¸‰ç‰ˆã€‹å°é¢ä¸Šçš„åŠ¨ç‰©æ˜¯æ‡’çŒ´å®¶æ—çš„ä¸€å‘˜â€”â€”pottoã€‚è¢‹é¼ æ˜¯ä¸€ç§åŽŸäº§äºŽè¥¿éžçƒ­å¸¦æ£®æž—çš„å°åž‹çµé•¿ç±»åŠ¨ç‰©ï¼Œé•¿ 17 è‹±å¯¸ï¼Œè¦†ç›–ç€æµ“å¯†çš„çº¢æ£•è‰²æ¯›çš®ã€‚å®ƒçš„å¯¹ç”Ÿæ‹‡æŒ‡ä½¿å…¶èƒ½å¤Ÿå¾ˆå¥½åœ°æŠ“æ¡ï¼Œä½¿å…¶å¾ˆå¥½åœ°é€‚åº”åœ¨æ ‘ä¸Šçš„ç”Ÿæ´»ã€‚é©¬é“ƒè–¯ç™½å¤©ç¡åœ¨æ ‘ç¼æˆ–æ ‘æ´žé‡Œï¼Œæ™šä¸Šå‡ºæ¥å¯»æ‰¾é£Ÿç‰©ï¼ˆæ˜†è™«ã€èœ—ç‰›å’Œè™è ï¼‰ã€‚ä¸Žè®¸å¤šçµé•¿ç±»åŠ¨ç‰©ä¸åŒï¼Œé©¬é“ƒè–¯é€šå¸¸ç‹¬å±…ã€‚</p><p>The animal on the cover of Managing Projects with GNU Make, Third
    Edition is a potto, a member of the loris family. A small primate native
    to the tropical forests of West Africa, the potto is 17 inches long and
    covered with dense, wooly, reddish-brown fur. Its opposable thumbs give it
    an excellent grasp, leaving it well adapted to its life in the trees. The
    potto spends its days sleeping in crevices or holes in trees, emerging at
    night to hunt for food (insects, snails, and bats). Unlike many primates,
    the potto generally lives alone.</p><p>Matt Hutchinson æ˜¯ã€Šä½¿ç”¨ GNU Make ç®¡ç†é¡¹ç›®ï¼Œç¬¬ä¸‰ç‰ˆã€‹çš„åˆ¶ä½œç¼–è¾‘ã€‚ Octal Publishing, Inc. æä¾›åˆ¶ä½œæœåŠ¡ã€‚çº¦ç¿°å¨œÂ·ä¸æ–¯ (Johnna Dinse) æ’°å†™äº†è¯¥ç´¢å¼•ã€‚ Adam Witwerã€Jamie Peppard å’Œ Darren Kelly è´Ÿè´£è´¨é‡æŽ§åˆ¶ã€‚</p><p>Matt Hutchinson was the production editor for Managing Projects with
    GNU Make, Third Edition . Octal Publishing, Inc. provided production
    services. Johnna Dinse wrote the index. Adam Witwer, Jamie Peppard, and
    Darren Kelly provided quality control.</p><p>åŸƒè¿ªÂ·å¼—é‡Œå¾·æ›¼è®¾è®¡äº†è¿™æœ¬ä¹¦çš„å°é¢ã€‚å°é¢å›¾ç‰‡æ˜¯æ¥è‡ªå¤šä½›å›¾ç”»æ¡£æ¡ˆé¦†çš„ 19 ä¸–çºªç‰ˆç”»ã€‚ Clay Fernald ä½¿ç”¨ QuarkXPress 4.1 ä½¿ç”¨ Adobâ€‹â€‹e çš„ ITC Garamond å­—ä½“åˆ¶ä½œäº†å°é¢å¸ƒå±€ã€‚</p><p>Edie Freedman designed the cover of this book. The cover image is a
    19th-century engraving from the Dover Pictorial Archive. Clay Fernald
    produced the cover layout with QuarkXPress 4.1 using Adobe's ITC Garamond
    font.</p><p>å¤§å«Â·å¯Œå¡”æ‰˜ (David Futato) è®¾è®¡äº†å®¤å†…å¸ƒå±€ã€‚ Joe Wizda ä½¿ç”¨ Erik Rayã€Jason McIntoshã€Neil Walls å’Œ Mike Sierra åˆ›å»ºçš„ä½¿ç”¨ Perl å’Œ XML æŠ€æœ¯çš„æ ¼å¼è½¬æ¢å·¥å…·å°†æœ¬ä¹¦è½¬æ¢ä¸º FrameMaker 5.5.6ã€‚æ–‡å­—å­—ä½“ä¸ºLinotype Birkaï¼›æ ‡é¢˜å­—ä½“ä¸º Adobâ€‹â€‹e Myriad Condensedï¼›ä»£ç å­—ä½“æ˜¯ LucasFont çš„ TheSans Mono Condensedã€‚ä¹¦ä¸­å‡ºçŽ°çš„æ’å›¾ç”± Robert Romano å’Œ Jessamyn Read ä½¿ç”¨ Macromedia FreeHand MX å’Œ Adobâ€‹â€‹e Photoshop CS åˆ¶ä½œã€‚</p><p>David Futato designed the interior layout. This book was converted
    by Joe Wizda to FrameMaker 5.5.6 with a format conversion tool created by
    Erik Ray, Jason McIntosh, Neil Walls, and Mike Sierra that uses Perl and
    XML technologies. The text font is Linotype Birka; the heading font is
    Adobe Myriad Condensed; and the code font is LucasFont's TheSans Mono
    Condensed. The illustrations that appear in the book were produced by
    Robert Romano and Jessamyn Read using Macromedia FreeHand MX and Adobe
    Photoshop CS.</p><p>æœ¬ä¹¦çš„åœ¨çº¿ç‰ˆæœ¬æ˜¯ç”± Safari åˆ¶ä½œç»„ï¼ˆJohn Chodackiã€Ken Douglass å’Œ Ellie Cutlerï¼‰åˆ›å»ºçš„ï¼Œä½¿ç”¨äº†ä¸€ç»„ç”± Erik Rayã€Benn Salterã€John Chodacki ç¼–å†™å’Œç»´æŠ¤çš„ Frame-to-XML è½¬æ¢å’Œæ¸…ç†å·¥å…·ï¼Œè‰¾èŽ‰Â·å¡ç‰¹å‹’å’Œæ°å¤«Â·åˆ©æ ¼ç‰¹ã€‚</p><p>The online edition of this book was created by the Safari production
    group (John Chodacki, Ken Douglass, and Ellie Cutler) using a set of
    Frame-to-XML conversion and cleanup tools written and maintained by Erik
    Ray, Benn Salter, John Chodacki, Ellie Cutler, and Jeff Liggett.</p></div></div></div>
</div>


<script id="res-script" src="/res/dist/res/main.js" type="text/javascript"></script>
</body></html>
