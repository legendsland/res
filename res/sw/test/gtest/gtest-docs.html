<!DOCTYPE html><html><head>
<meta name="dc.identifier" content="res/eed717b61d6de60313f80d11fde35ad072873f45">

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>GoogleTest User’s Guide</title>
  <script type="text/javascript">
    config = { "color": { "bg": "#333", "fg": "#fff", "active": "#48c", "hover": "#444" }, "toc": { "width": "20%", "minwidth": "200px", "shiftwidth": "1em", "lineheight": 2 }, "button": { "size": "1em", "color": { "bg": "#f66", "active": "#5c4" }, "duration": 500 } }
  </script>
  <script type="text/javascript">
    window.Element && !Element.prototype.closest && (Element.prototype.closest = function (e) { var t, n = (this.document || this.ownerDocument).querySelectorAll(e), o = this; do { for (t = n.length; 0 <= --t && n.item(t) !== o;); } while (t < 0 && (o = o.parentElement)); return o }), function () { function e(e, t) { t = t || { bubbles: !1, cancelable: !1, detail: void 0 }; var n = document.createEvent("CustomEvent"); return n.initCustomEvent(e, t.bubbles, t.cancelable, t.detail), n } "function" != typeof window.CustomEvent && (e.prototype = window.Event.prototype, window.CustomEvent = e) }(), function () { for (var a = 0, e = ["ms", "moz", "webkit", "o"], t = 0; t < e.length && !window.requestAnimationFrame; ++t)window.requestAnimationFrame = window[e[t] + "RequestAnimationFrame"], window.cancelAnimationFrame = window[e[t] + "CancelAnimationFrame"] || window[e[t] + "CancelRequestAnimationFrame"]; window.requestAnimationFrame || (window.requestAnimationFrame = function (e, t) { var n = (new Date).getTime(), o = Math.max(0, 16 - (n - a)), i = window.setTimeout(function () { e(n + o) }, o); return a = n + o, i }), window.cancelAnimationFrame || (window.cancelAnimationFrame = function (e) { clearTimeout(e) }) }(), function (e, t) { "function" == typeof define && define.amd ? define([], function () { return t(e) }) : "object" == typeof exports ? module.exports = t(e) : e.SmoothScroll = t(e) }("undefined" != typeof global ? global : "undefined" != typeof window ? window : this, function (E) { "use strict"; function b() { for (var n = {}, e = 0; e < arguments.length; e++)!function (e) { for (var t in e) e.hasOwnProperty(t) && (n[t] = e[t]) }(arguments[e]); return n } function s(t) { var n; try { n = decodeURIComponent(t) } catch (e) { n = t } return n } function u(e) { "#" === e.charAt(0) && (e = e.substr(1)); for (var t, n, o = String(e), i = o.length, a = -1, r = "", c = o.charCodeAt(0); ++a < i;) { if (0 === (t = o.charCodeAt(a))) throw new InvalidCharacterError("Invalid character: the input contains U+0000."); 1 <= t && t <= 31 || 127 == t || 0 === a && 48 <= t && t <= 57 || 1 === a && 48 <= t && t <= 57 && 45 === c ? r += "\\" + t.toString(16) + " " : r += 128 <= t || 45 === t || 95 === t || 48 <= t && t <= 57 || 65 <= t && t <= 90 || 97 <= t && t <= 122 ? o.charAt(a) : "\\" + o.charAt(a) } try { n = decodeURIComponent("#" + r) } catch (e) { n = "#" + r } return n } function S() { return Math.max(document.body.scrollHeight, document.documentElement.scrollHeight, document.body.offsetHeight, document.documentElement.offsetHeight, document.body.clientHeight, document.documentElement.clientHeight) } function A(e) { return e ? (t = e, parseInt(E.getComputedStyle(t).height, 10) + e.offsetTop) : 0; var t } function C(e, t, n, o) { t.emitEvents && "function" == typeof E.CustomEvent && (o = new CustomEvent(e, { bubbles: !0, detail: { anchor: n, toggle: o } }), document.dispatchEvent(o)) } var O = { ignore: "[data-scroll-ignore]", header: null, topOnEmptyHash: !0, speed: 500, clip: !0, offset: 0, easing: "easeInOutCubic", customEasing: null, updateURL: !0, popstate: !0, emitEvents: !0 }; return function (o, e) { var g, i, n, w, t, v, y = { cancelScroll: function (e) { cancelAnimationFrame(v), v = null, e || C("scrollCancel", g) } }; y.animateScroll = function (o, i, e) { var a, r, c, s, u, l, m, d, f, h = b(g || O, e || {}), p = "[object Number]" === Object.prototype.toString.call(o), t = p || !o.tagName ? null : o; (p || t) && (a = E.pageYOffset, h.header && !n && (n = document.querySelector(h.header)), w = w || A(n), r = p ? o : function (e, t, n, o) { var i = 0; if (e.offsetParent) for (; i += e.offsetTop, e = e.offsetParent, e;); return i = Math.max(i - t - n, 0), o && (i = Math.min(i, S() - E.innerHeight)), i }(t, w, parseInt("function" == typeof h.offset ? h.offset(o, i) : h.offset, 10), h.clip), c = r - a, s = S(), d = function (e, t) { var n = E.pageYOffset; if (e == t || n == t || (a < t && E.innerHeight + n) >= s) return y.cancelScroll(!0), e = t, n = p, 0 === (t = o) && document.body.focus(), n || (t.focus(), document.activeElement !== t && (t.setAttribute("tabindex", "-1"), t.focus(), t.style.outline = "none"), E.scrollTo(0, e)), C("scrollStop", h, o, i), !(v = l = null) }, f = function (e) { var t, n, o; m = (u += e - (l = l || e)) / parseInt(h.speed, 10), m = a + c * (n = m = 1 < m ? 1 : m, "easeInQuad" === (t = h).easing && (o = n * n), "easeOutQuad" === t.easing && (o = n * (2 - n)), "easeInOutQuad" === t.easing && (o = n < .5 ? 2 * n * n : (4 - 2 * n) * n - 1), "easeInCubic" === t.easing && (o = n * n * n), "easeOutCubic" === t.easing && (o = --n * n * n + 1), "easeInOutCubic" === t.easing && (o = n < .5 ? 4 * n * n * n : (n - 1) * (2 * n - 2) * (2 * n - 2) + 1), "easeInQuart" === t.easing && (o = n * n * n * n), "easeOutQuart" === t.easing && (o = 1 - --n * n * n * n), "easeInOutQuart" === t.easing && (o = n < .5 ? 8 * n * n * n * n : 1 - 8 * --n * n * n * n), "easeInQuint" === t.easing && (o = n * n * n * n * n), "easeOutQuint" === t.easing && (o = 1 + --n * n * n * n * n), "easeInOutQuint" === t.easing && (o = n < .5 ? 16 * n * n * n * n * n : 1 + 16 * --n * n * n * n * n), t.customEasing && (o = t.customEasing(n)), o || n), E.scrollTo(0, Math.floor(m)), d(m, r) || (v = E.requestAnimationFrame(f), l = e) }, (u = 0) === E.pageYOffset && E.scrollTo(0, 0), e = o, t = h, p || history.pushState && t.updateURL && history.pushState({ smoothScroll: JSON.stringify(t), anchor: e.id }, document.title, e === document.documentElement ? "#top" : "#" + e.id), C("scrollStart", h, o, i), y.cancelScroll(!0), E.requestAnimationFrame(f)) }; function a(e) { var t, n; "matchMedia" in E && E.matchMedia("(prefers-reduced-motion)").matches || 0 !== e.button || e.metaKey || e.ctrlKey || "closest" in e.target && (i = e.target.closest(o)) && "a" === i.tagName.toLowerCase() && !e.target.closest(g.ignore) && i.hostname === E.location.hostname && i.pathname === E.location.pathname && /#/.test(i.href) && (t = u(s(i.hash)), (n = (n = g.topOnEmptyHash && "#" === t ? document.documentElement : document.querySelector(t)) || "#top" !== t ? n : document.documentElement) && (e.preventDefault(), y.animateScroll(n, i))) } function r(e) { var t; null !== history.state && history.state.smoothScroll && history.state.smoothScroll === JSON.stringify(g) && (!history.state.anchor || (t = document.querySelector(u(s(history.state.anchor)))) && y.animateScroll(t, null, { updateURL: !1 })) } function c(e) { t = t || setTimeout(function () { t = null, w = A(n) }, 66) } return y.destroy = function () { g && (document.removeEventListener("click", a, !1), E.removeEventListener("resize", c, !1), E.removeEventListener("popstate", r, !1), y.cancelScroll(), v = t = w = n = i = g = null) }, y.init = function (e) { if (!("querySelector" in document && "addEventListener" in E && "requestAnimationFrame" in E && "closest" in E.Element.prototype)) throw "Smooth Scroll: This browser does not support the required JavaScript methods and browser APIs."; y.destroy(), g = b(O, e || {}), n = g.header ? document.querySelector(g.header) : null, w = A(n), document.addEventListener("click", a, !1), n && E.addEventListener("resize", c, !1), g.updateURL && g.popstate && E.addEventListener("popstate", r, !1) }, y.init(e), y } });
  </script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function () { var t, e, n, c, o, d = document.getElementById("markdown-toc"); function l() { window.pageYOffset || document.body.scrollTop || document.documentElement.scrollTop; for (var t = n[0], e = 0; e < n.length; e++) { var o = n[e].getBoundingClientRect(); if (0 < o.top) { o.top < Math.abs(t.getBoundingClientRect().top) && (t = n[e]); break } t = n[e] } [].forEach.call(document.getElementsByClassName("toc-active"), function (t) { t.classList.remove("toc-active") }), d.querySelector('a[href="#' + t.id + '"]').parentNode.classList.add("toc-active") } null != d && ((t = document.createElement("div")).classList.add("scroll"), (e = document.createElement("div")).classList.add("toc-button"), n = document.querySelectorAll("h1,h2,h3,h4"), c = document.createElement("ul"), [].forEach.call(n, function (t) { var e = document.createElement("li"); e.classList.add("toc-" + t.tagName.toLowerCase()); var o = document.createElement("a"); o.setAttribute("href", "#" + t.id), o.textContent = t.textContent, e.appendChild(o), c.appendChild(e) }), t.appendChild(c), d.style.direction = "rtl", t.style.direction = "ltr", d.appendChild(t), e.onclick = function () { 0 < d.offsetWidth ? (e.style.background = config.button.color.active, e.style.transform = "rotate(-45deg)", d.style.width = 0, d.style.minWidth = 0) : (e.style.background = config.button.color.bg, e.style.transform = "rotate(0)", d.style.width = config.toc.width, d.style.minWidth = config.toc.minwidth) }, document.body.appendChild(e), SmoothScroll('a[href*="#"]'), window.onscroll = function () { o && clearTimeout(o), o = setTimeout(function () { l() }, 50) }, l()) }, !1);
  </script>

  <style type="text/css">
    .chroma {
      background-color: #fff
    }

    .chroma .err {
      color: #a61717;
      background-color: #e3d2d2
    }

    .chroma .lntd {
      vertical-align: top;
      padding: 0;
      margin: 0;
      border: 0
    }

    .chroma .lntable {
      border-spacing: 0;
      padding: 0;
      margin: 0;
      border: 0;
      width: auto;
      overflow: auto;
      display: block
    }

    .chroma .hl {
      display: block;
      width: 100% !
    }

    .chroma .lnt {
      margin-right: .4em;
      padding: 0 .4em 0 .4em;
      color: #7f7f7f
    }

    .chroma .ln {
      margin-right: .4em;
      padding: 0 .4em 0 .4em;
      color: #7f7f7f
    }

    .chroma .k {
      color: #d73a49
    }

    .chroma .kc {
      color: #d73a49
    }

    .chroma .kd {
      color: #d73a49
    }

    .chroma .kn {
      color: #d73a49
    }

    .chroma .kp {
      color: #d73a49
    }

    .chroma .kr {
      color: #d73a49
    }

    .chroma .kt {
      color: #d73a49
    }

    .chroma .na {
      color: #005cc5
    }

    .chroma .nb {
      color: #6f42c1
    }

    .chroma .bp {
      color: #999
    }

    .chroma .nc {
      color: #d73a49
    }

    .chroma .no {
      color: #005cc5
    }

    .chroma .nd {
      color: #3c5d5d
    }

    .chroma .ni {
      color: purple
    }

    .chroma .ne {
      color: #6f42c1
    }

    .chroma .nf {
      color: #6f42c1
    }

    .chroma .nl {
      color: #6f42c1
    }

    .chroma .nn {
      color: #555
    }

    .chroma .nt {
      color: #22863a
    }

    .chroma .nv {
      color: #005cc5
    }

    .chroma .vc {
      color: #005cc5
    }

    .chroma .vg {
      color: #005cc5
    }

    .chroma .vi {
      color: #005cc5
    }

    .chroma .s {
      color: #032f62
    }

    .chroma .sa {
      color: #032f62
    }

    .chroma .sb {
      color: #032f62
    }

    .chroma .sc {
      color: #032f62
    }

    .chroma .dl {
      color: #032f62
    }

    .chroma .sd {
      color: #032f62
    }

    .chroma .s2 {
      color: #032f62
    }

    .chroma .se {
      color: #032f62
    }

    .chroma .sh {
      color: #032f62
    }

    .chroma .si {
      color: #032f62
    }

    .chroma .sx {
      color: #032f62
    }

    .chroma .sr {
      color: #22863a
    }

    .chroma .s1 {
      color: #032f62
    }

    .chroma .ss {
      color: #032f62
    }

    .chroma .m {
      color: #099
    }

    .chroma .mb {
      color: #099
    }

    .chroma .mf {
      color: #099
    }

    .chroma .mh {
      color: #099
    }

    .chroma .mi {
      color: #099
    }

    .chroma .il {
      color: #099
    }

    .chroma .mo {
      color: #099
    }

    .chroma .o {
      color: #d73a49
    }

    .chroma .ow {
      color: #d73a49
    }

    .chroma .c {
      color: #6a737d
    }

    .chroma .ch {
      color: #6a737d
    }

    .chroma .cm {
      color: #6a737d
    }

    .chroma .c1 {
      color: #6a737d
    }

    .chroma .cs {
      color: #6a737d
    }

    .chroma .cp {
      color: #6a737d
    }

    .chroma .cpf {
      color: #6a737d
    }

    .chroma .gd {
      color: #000;
      background-color: #fdd
    }

    .chroma .ge {
      color: #000;
      font-style: italic
    }

    .chroma .gr {
      color: #a00
    }

    .chroma .gh {
      color: #999
    }

    .chroma .gi {
      color: #000;
      background-color: #dfd
    }

    .chroma .go {
      color: #888
    }

    .chroma .gp {
      color: #555
    }

    .chroma .gs {
      font-weight: 700
    }

    .chroma .gu {
      color: #aaa
    }

    .chroma .gt {
      color: #a00
    }

    .chroma .gl {
      text-decoration: underline
    }

    .chroma .w {
      color: #bbb
    }
  </style>
  <style type="text/css">
    .markdown-body .octicon {
      display: inline-block;
      fill: currentColor;
      vertical-align: text-bottom
    }

    .markdown-body .anchor {
      float: left;
      line-height: 1;
      margin-left: -20px;
      padding-right: 4px
    }

    .markdown-body .anchor:focus {
      outline: 0
    }

    .markdown-body h1 .octicon-link,
    .markdown-body h2 .octicon-link,
    .markdown-body h3 .octicon-link,
    .markdown-body h4 .octicon-link,
    .markdown-body h5 .octicon-link,
    .markdown-body h6 .octicon-link {
      color: #1b1f23;
      vertical-align: middle;
      visibility: hidden
    }

    .markdown-body h1:hover .anchor,
    .markdown-body h2:hover .anchor,
    .markdown-body h3:hover .anchor,
    .markdown-body h4:hover .anchor,
    .markdown-body h5:hover .anchor,
    .markdown-body h6:hover .anchor {
      text-decoration: none
    }

    .markdown-body h1:hover .anchor .octicon-link,
    .markdown-body h2:hover .anchor .octicon-link,
    .markdown-body h3:hover .anchor .octicon-link,
    .markdown-body h4:hover .anchor .octicon-link,
    .markdown-body h5:hover .anchor .octicon-link,
    .markdown-body h6:hover .anchor .octicon-link {
      visibility: visible
    }

    .markdown-body h1:hover .anchor .octicon-link:before,
    .markdown-body h2:hover .anchor .octicon-link:before,
    .markdown-body h3:hover .anchor .octicon-link:before,
    .markdown-body h4:hover .anchor .octicon-link:before,
    .markdown-body h5:hover .anchor .octicon-link:before,
    .markdown-body h6:hover .anchor .octicon-link:before {
      width: 16px;
      height: 16px;
      content: ' ';
      display: inline-block;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'%3E%3C/path%3E%3C/svg%3E")
    }

    .markdown-body {
      -ms-text-size-adjust: 100%;
      -webkit-text-size-adjust: 100%;
      line-height: 1.5;
      color: #24292e;
      font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji;
      font-size: 16px;
      line-height: 1.5;
      word-wrap: break-word
    }

    .markdown-body details {
      display: block
    }

    .markdown-body summary {
      display: list-item
    }

    .markdown-body a {
      background-color: initial
    }

    .markdown-body a:active,
    .markdown-body a:hover {
      outline-width: 0
    }

    .markdown-body strong {
      font-weight: inherit;
      font-weight: bolder
    }

    .markdown-body h1 {
      font-size: 2em;
      margin: .67em 0
    }

    .markdown-body img {
      border-style: none
    }

    .markdown-body code,
    .markdown-body kbd,
    .markdown-body pre {
      font-family: monospace, monospace;
      font-size: 1em
    }

    .markdown-body hr {
      box-sizing: initial;
      height: 0;
      overflow: visible
    }

    .markdown-body input {
      font: inherit;
      margin: 0
    }

    .markdown-body input {
      overflow: visible
    }

    .markdown-body [type=checkbox] {
      box-sizing: border-box;
      padding: 0
    }

    .markdown-body * {
      box-sizing: border-box
    }

    .markdown-body input {
      font-family: inherit;
      font-size: inherit;
      line-height: inherit
    }

    .markdown-body a {
      color: #0366d6;
      text-decoration: none
    }

    .markdown-body a:hover {
      text-decoration: underline
    }

    .markdown-body strong {
      font-weight: 600
    }

    .markdown-body hr {
      height: 0;
      margin: 15px 0;
      overflow: hidden;
      background: 0 0;
      border: 0;
      border-bottom: 1px solid #dfe2e5
    }

    .markdown-body hr:after,
    .markdown-body hr:before {
      display: table;
      content: ""
    }

    .markdown-body hr:after {
      clear: both
    }

    .markdown-body table {
      border-spacing: 0;
      border-collapse: collapse
    }

    .markdown-body td,
    .markdown-body th {
      padding: 0
    }

    .markdown-body details summary {
      cursor: pointer
    }

    .markdown-body kbd {
      display: inline-block;
      padding: 3px 5px;
      font: 11px SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
      line-height: 10px;
      color: #444d56;
      vertical-align: middle;
      background-color: #fafbfc;
      border: 1px solid #d1d5da;
      border-radius: 3px;
      box-shadow: inset 0 -1px 0 #d1d5da
    }

    .markdown-body h1,
    .markdown-body h2,
    .markdown-body h3,
    .markdown-body h4,
    .markdown-body h5,
    .markdown-body h6 {
      margin-top: 0;
      margin-bottom: 0
    }

    .markdown-body h1 {
      font-size: 32px
    }

    .markdown-body h1,
    .markdown-body h2 {
      font-weight: 600
    }

    .markdown-body h2 {
      font-size: 24px
    }

    .markdown-body h3 {
      font-size: 20px
    }

    .markdown-body h3,
    .markdown-body h4 {
      font-weight: 600
    }

    .markdown-body h4 {
      font-size: 16px
    }

    .markdown-body h5 {
      font-size: 14px
    }

    .markdown-body h5,
    .markdown-body h6 {
      font-weight: 600
    }

    .markdown-body h6 {
      font-size: 12px
    }

    .markdown-body p {
      margin-top: 0;
      margin-bottom: 10px
    }

    .markdown-body blockquote {
      margin: 0
    }

    .markdown-body ol,
    .markdown-body ul {
      padding-left: 0;
      margin-top: 0;
      margin-bottom: 0
    }

    .markdown-body ol ol,
    .markdown-body ul ol {
      list-style-type: lower-roman
    }

    .markdown-body ol ol ol,
    .markdown-body ol ul ol,
    .markdown-body ul ol ol,
    .markdown-body ul ul ol {
      list-style-type: lower-alpha
    }

    .markdown-body dd {
      margin-left: 0
    }

    .markdown-body code,
    .markdown-body pre {
      font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
      font-size: 12px
    }

    .markdown-body pre {
      margin-top: 0;
      margin-bottom: 0
    }

    .markdown-body input::-webkit-inner-spin-button,
    .markdown-body input::-webkit-outer-spin-button {
      margin: 0;
      -webkit-appearance: none;
      appearance: none
    }

    .markdown-body :checked+.radio-label {
      position: relative;
      z-index: 1;
      border-color: #0366d6
    }

    .markdown-body .border {
      border: 1px solid #e1e4e8 !important
    }

    .markdown-body .border-0 {
      border: 0 !important
    }

    .markdown-body .border-bottom {
      border-bottom: 1px solid #e1e4e8 !important
    }

    .markdown-body .rounded-1 {
      border-radius: 3px !important
    }

    .markdown-body .bg-white {
      background-color: #fff !important
    }

    .markdown-body .bg-gray-light {
      background-color: #fafbfc !important
    }

    .markdown-body .text-gray-light {
      color: #6a737d !important
    }

    .markdown-body .mb-0 {
      margin-bottom: 0 !important
    }

    .markdown-body .my-2 {
      margin-top: 8px !important;
      margin-bottom: 8px !important
    }

    .markdown-body .pl-0 {
      padding-left: 0 !important
    }

    .markdown-body .py-0 {
      padding-top: 0 !important;
      padding-bottom: 0 !important
    }

    .markdown-body .pl-1 {
      padding-left: 4px !important
    }

    .markdown-body .pl-2 {
      padding-left: 8px !important
    }

    .markdown-body .py-2 {
      padding-top: 8px !important;
      padding-bottom: 8px !important
    }

    .markdown-body .pl-3,
    .markdown-body .px-3 {
      padding-left: 16px !important
    }

    .markdown-body .px-3 {
      padding-right: 16px !important
    }

    .markdown-body .pl-4 {
      padding-left: 24px !important
    }

    .markdown-body .pl-5 {
      padding-left: 32px !important
    }

    .markdown-body .pl-6 {
      padding-left: 40px !important
    }

    .markdown-body .f6 {
      font-size: 12px !important
    }

    .markdown-body .lh-condensed {
      line-height: 1.25 !important
    }

    .markdown-body .text-bold {
      font-weight: 600 !important
    }

    .markdown-body .pl-c {
      color: #6a737d
    }

    .markdown-body .pl-c1,
    .markdown-body .pl-s .pl-v {
      color: #005cc5
    }

    .markdown-body .pl-e,
    .markdown-body .pl-en {
      color: #6f42c1
    }

    .markdown-body .pl-s .pl-s1,
    .markdown-body .pl-smi {
      color: #24292e
    }

    .markdown-body .pl-ent {
      color: #22863a
    }

    .markdown-body .pl-k {
      color: #d73a49
    }

    .markdown-body .pl-pds,
    .markdown-body .pl-s,
    .markdown-body .pl-s .pl-pse .pl-s1,
    .markdown-body .pl-sr,
    .markdown-body .pl-sr .pl-cce,
    .markdown-body .pl-sr .pl-sra,
    .markdown-body .pl-sr .pl-sre {
      color: #032f62
    }

    .markdown-body .pl-smw,
    .markdown-body .pl-v {
      color: #e36209
    }

    .markdown-body .pl-bu {
      color: #b31d28
    }

    .markdown-body .pl-ii {
      color: #fafbfc;
      background-color: #b31d28
    }

    .markdown-body .pl-c2 {
      color: #fafbfc;
      background-color: #d73a49
    }

    .markdown-body .pl-c2:before {
      content: "^M"
    }

    .markdown-body .pl-sr .pl-cce {
      font-weight: 700;
      color: #22863a
    }

    .markdown-body .pl-ml {
      color: #735c0f
    }

    .markdown-body .pl-mh,
    .markdown-body .pl-mh .pl-en,
    .markdown-body .pl-ms {
      font-weight: 700;
      color: #005cc5
    }

    .markdown-body .pl-mi {
      font-style: italic;
      color: #24292e
    }

    .markdown-body .pl-mb {
      font-weight: 700;
      color: #24292e
    }

    .markdown-body .pl-md {
      color: #b31d28;
      background-color: #ffeef0
    }

    .markdown-body .pl-mi1 {
      color: #22863a;
      background-color: #f0fff4
    }

    .markdown-body .pl-mc {
      color: #e36209;
      background-color: #ffebda
    }

    .markdown-body .pl-mi2 {
      color: #f6f8fa;
      background-color: #005cc5
    }

    .markdown-body .pl-mdr {
      font-weight: 700;
      color: #6f42c1
    }

    .markdown-body .pl-ba {
      color: #586069
    }

    .markdown-body .pl-sg {
      color: #959da5
    }

    .markdown-body .pl-corl {
      text-decoration: underline;
      color: #032f62
    }

    .markdown-body .mb-0 {
      margin-bottom: 0 !important
    }

    .markdown-body .my-2 {
      margin-bottom: 8px !important
    }

    .markdown-body .my-2 {
      margin-top: 8px !important
    }

    .markdown-body .pl-0 {
      padding-left: 0 !important
    }

    .markdown-body .py-0 {
      padding-top: 0 !important;
      padding-bottom: 0 !important
    }

    .markdown-body .pl-1 {
      padding-left: 4px !important
    }

    .markdown-body .pl-2 {
      padding-left: 8px !important
    }

    .markdown-body .py-2 {
      padding-top: 8px !important;
      padding-bottom: 8px !important
    }

    .markdown-body .pl-3 {
      padding-left: 16px !important
    }

    .markdown-body .pl-4 {
      padding-left: 24px !important
    }

    .markdown-body .pl-5 {
      padding-left: 32px !important
    }

    .markdown-body .pl-6 {
      padding-left: 40px !important
    }

    .markdown-body .pl-7 {
      padding-left: 48px !important
    }

    .markdown-body .pl-8 {
      padding-left: 64px !important
    }

    .markdown-body .pl-9 {
      padding-left: 80px !important
    }

    .markdown-body .pl-10 {
      padding-left: 96px !important
    }

    .markdown-body .pl-11 {
      padding-left: 112px !important
    }

    .markdown-body .pl-12 {
      padding-left: 128px !important
    }

    .markdown-body hr {
      border-bottom-color: #eee
    }

    .markdown-body kbd {
      display: inline-block;
      padding: 3px 5px;
      font: 11px SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
      line-height: 10px;
      color: #444d56;
      vertical-align: middle;
      background-color: #fafbfc;
      border: 1px solid #d1d5da;
      border-radius: 3px;
      box-shadow: inset 0 -1px 0 #d1d5da
    }

    .markdown-body:after,
    .markdown-body:before {
      display: table;
      content: ""
    }

    .markdown-body:after {
      clear: both
    }

    .markdown-body>:first-child {
      margin-top: 0 !important
    }

    .markdown-body>:last-child {
      margin-bottom: 0 !important
    }

    .markdown-body a:not([href]) {
      color: inherit;
      text-decoration: none
    }

    .markdown-body blockquote,
    .markdown-body details,
    .markdown-body dl,
    .markdown-body ol,
    .markdown-body p,
    .markdown-body pre,
    .markdown-body table,
    .markdown-body ul {
      margin-top: 0;
      margin-bottom: 16px
    }

    .markdown-body hr {
      height: .25em;
      padding: 0;
      margin: 24px 0;
      background-color: #e1e4e8;
      border: 0
    }

    .markdown-body blockquote {
      padding: 0 1em;
      color: #6a737d;
      border-left: .25em solid #dfe2e5
    }

    .markdown-body blockquote>:first-child {
      margin-top: 0
    }

    .markdown-body blockquote>:last-child {
      margin-bottom: 0
    }

    .markdown-body h1,
    .markdown-body h2,
    .markdown-body h3,
    .markdown-body h4,
    .markdown-body h5,
    .markdown-body h6 {
      margin-top: 24px;
      margin-bottom: 16px;
      font-weight: 600;
      line-height: 1.25
    }

    .markdown-body h1 {
      font-size: 2em
    }

    .markdown-body h1,
    .markdown-body h2 {
      padding-bottom: .3em;
      border-bottom: 1px solid #eaecef
    }

    .markdown-body h2 {
      font-size: 1.5em
    }

    .markdown-body h3 {
      font-size: 1.25em
    }

    .markdown-body h4 {
      font-size: 1em
    }

    .markdown-body h5 {
      font-size: .875em
    }

    .markdown-body h6 {
      font-size: .85em;
      color: #6a737d
    }

    .markdown-body ol,
    .markdown-body ul {
      padding-left: 2em
    }

    .markdown-body ol ol,
    .markdown-body ol ul,
    .markdown-body ul ol,
    .markdown-body ul ul {
      margin-top: 0;
      margin-bottom: 0
    }

    .markdown-body li {
      word-wrap: break-all
    }

    .markdown-body li>p {
      margin-top: 16px
    }

    .markdown-body li+li {
      margin-top: .25em
    }

    .markdown-body dl {
      padding: 0
    }

    .markdown-body dl dt {
      padding: 0;
      margin-top: 16px;
      font-size: 1em;
      font-style: italic;
      font-weight: 600
    }

    .markdown-body dl dd {
      padding: 0 16px;
      margin-bottom: 16px
    }

    .markdown-body table {
      display: block;
      width: 100%;
      overflow: auto
    }

    .markdown-body table th {
      font-weight: 600
    }

    .markdown-body table td,
    .markdown-body table th {
      padding: 6px 13px;
      border: 1px solid #dfe2e5
    }

    .markdown-body table tr {
      background-color: #fff;
      border-top: 1px solid #c6cbd1
    }

    .markdown-body table tr:nth-child(2n) {
      background-color: #f6f8fa
    }

    .markdown-body img {
      max-width: 100%;
      box-sizing: initial;
      background-color: #fff
    }

    .markdown-body img[align=right] {
      padding-left: 20px
    }

    .markdown-body img[align=left] {
      padding-right: 20px
    }

    .markdown-body code {
      padding: .2em .4em;
      margin: 0;
      font-size: 85%;
      background-color: rgba(27, 31, 35, .05);
      border-radius: 3px
    }

    .markdown-body pre {
      word-wrap: normal
    }

    .markdown-body pre>code {
      padding: 0;
      margin: 0;
      font-size: 100%;
      word-break: normal;
      white-space: pre;
      background: 0 0;
      border: 0
    }

    .markdown-body .highlight {
      margin-bottom: 16px
    }

    .markdown-body .highlight pre {
      margin-bottom: 0;
      word-break: normal
    }

    .markdown-body .highlight pre,
    .markdown-body pre {
      padding: 16px;
      overflow: auto;
      font-size: 85%;
      line-height: 1.45;
      background-color: #f6f8fa;
      border-radius: 3px
    }

    .markdown-body pre code {
      display: inline;
      max-width: auto;
      padding: 0;
      margin: 0;
      overflow: visible;
      line-height: inherit;
      word-wrap: normal;
      background-color: initial;
      border: 0
    }

    .markdown-body .commit-tease-sha {
      display: inline-block;
      font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
      font-size: 90%;
      color: #444d56
    }

    .markdown-body .full-commit .btn-outline:not(:disabled):hover {
      color: #005cc5;
      border-color: #005cc5
    }

    .markdown-body .blob-wrapper {
      overflow-x: auto;
      overflow-y: hidden
    }

    .markdown-body .blob-wrapper-embedded {
      max-height: 240px;
      overflow-y: auto
    }

    .markdown-body .blob-num {
      width: 1%;
      min-width: 50px;
      padding-right: 10px;
      padding-left: 10px;
      font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
      font-size: 12px;
      line-height: 20px;
      color: rgba(27, 31, 35, .3);
      text-align: right;
      white-space: nowrap;
      vertical-align: top;
      cursor: pointer;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none
    }

    .markdown-body .blob-num:hover {
      color: rgba(27, 31, 35, .6)
    }

    .markdown-body .blob-num:before {
      content: attr(data-line-number)
    }

    .markdown-body .blob-code {
      position: relative;
      padding-right: 10px;
      padding-left: 10px;
      line-height: 20px;
      vertical-align: top
    }

    .markdown-body .blob-code-inner {
      overflow: visible;
      font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
      font-size: 12px;
      color: #24292e;
      word-wrap: normal;
      white-space: pre
    }

    .markdown-body .pl-token.active,
    .markdown-body .pl-token:hover {
      cursor: pointer;
      background: #ffea7f
    }

    .markdown-body .tab-size[data-tab-size="1"] {
      -moz-tab-size: 1;
      tab-size: 1
    }

    .markdown-body .tab-size[data-tab-size="2"] {
      -moz-tab-size: 2;
      tab-size: 2
    }

    .markdown-body .tab-size[data-tab-size="3"] {
      -moz-tab-size: 3;
      tab-size: 3
    }

    .markdown-body .tab-size[data-tab-size="4"] {
      -moz-tab-size: 4;
      tab-size: 4
    }

    .markdown-body .tab-size[data-tab-size="5"] {
      -moz-tab-size: 5;
      tab-size: 5
    }

    .markdown-body .tab-size[data-tab-size="6"] {
      -moz-tab-size: 6;
      tab-size: 6
    }

    .markdown-body .tab-size[data-tab-size="7"] {
      -moz-tab-size: 7;
      tab-size: 7
    }

    .markdown-body .tab-size[data-tab-size="8"] {
      -moz-tab-size: 8;
      tab-size: 8
    }

    .markdown-body .tab-size[data-tab-size="9"] {
      -moz-tab-size: 9;
      tab-size: 9
    }

    .markdown-body .tab-size[data-tab-size="10"] {
      -moz-tab-size: 10;
      tab-size: 10
    }

    .markdown-body .tab-size[data-tab-size="11"] {
      -moz-tab-size: 11;
      tab-size: 11
    }

    .markdown-body .tab-size[data-tab-size="12"] {
      -moz-tab-size: 12;
      tab-size: 12
    }

    .markdown-body .task-list-item {
      list-style-type: none
    }

    .markdown-body .task-list-item+.task-list-item {
      margin-top: 3px
    }

    .markdown-body .task-list-item input {
      margin: 0 .2em .25em -1.6em;
      vertical-align: middle
    }
  </style>
  <style type="text/css">
    * {
      margin: 0
    }

    .container {
      display: flex
    }

    .markdown-body {
      flex-grow: 1;
      min-width: 300px;
      overflow-x: auto;
      padding: 2em
    }

    .markdown-body table {
      font-family: Menlo, 'Bitstream Vera Sans Mono', 'DejaVu Sans Mono', Monaco, Consolas, monospace;
      font-size: .85em
    }
  </style>
  <style type="text/css">
    #markdown-toc {
      overflow-y: auto;
      color: #fff;
      background: #333;
      width: 20%;
      min-width: 200px;
      height: 100vh;
      position: sticky;
      top: 0;
      box-shadow: 0 0 5px 0 #000;
      transition: width .5s ease-in-out, min-width .5s ease-in-out
    }

    #markdown-toc ul {
      padding: 0;
      padding-top: 1em;
      list-style: none
    }

    #markdown-toc a {
      color: #fff;
      text-decoration: none;
      display: block;
      width: 100%;
      line-height: 2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis
    }

    #markdown-toc [class*=toc-h]:hover {
      background: #444
    }

    #markdown-toc [class*=toc-h].toc-active {
      background: #48c
    }

    #markdown-toc [class*=toc-h] :before {
      content: ""
    }

    #markdown-toc .toc-h1 {
      font-size: 1em
    }

    #markdown-toc .toc-h1 :before {
      padding-left: calc(1em + 1em)
    }

    #markdown-toc .toc-h2 {
      font-size: .9375em
    }

    #markdown-toc .toc-h2 :before {
      padding-left: calc(2em + 1em)
    }

    #markdown-toc .toc-h3 {
      font-size: .875em
    }

    #markdown-toc .toc-h3 :before {
      padding-left: calc(3em + 1em)
    }

    #markdown-toc .toc-h4 {
      font-size: .8125em
    }

    #markdown-toc .toc-h4 :before {
      padding-left: calc(4em + 1em)
    }

    .toc-button {
      position: fixed;
      top: .5em;
      margin-left: .5em;
      width: 1em;
      height: 1em;
      border-radius: 50%;
      background: #f66;
      cursor: pointer;
      transition: transform .5s linear
    }

    .toc-button:after,
    .toc-button:before {
      transform: rotate(-45deg);
      position: absolute;
      background-color: #fff;
      border-radius: 1em;
      content: ""
    }

    .toc-button:before {
      width: 75%;
      height: 12.5%;
      top: 43.75%;
      left: 12.5%
    }

    .toc-button:after {
      width: 12.5%;
      height: 75%;
      top: 12.5%;
      left: 43.75%
    }
  </style>

<link id="res-style" rel="stylesheet" href="/res/dist/res/style.css" type="text/css">
</head>

<body>
  <div id="book-container">
  <div class="container">
    <div class="markdown-body">
      <h1 id="googletest-users-guide">GoogleTest User’s Guide</h1>
      <h2 id="welcome-to-googletest">Welcome to GoogleTest!</h2>
      <p>GoogleTest is Google’s C++ testing and mocking framework. This user’s guide has
        the following contents:</p>
      <ul>
        <li><a href="#googletest-primer">GoogleTest Primer</a> - Teaches you how to write simple tests using
          GoogleTest. Read this first if you are new to GoogleTest.</li>
        <li><a href="#advanced-googletest-topics">GoogleTest Advanced</a> - Read this when you’ve finished the
          Primer and want to utilize GoogleTest to its full potential.</li>
        <li><a href="#googletest-samples">GoogleTest Samples</a> - Describes some GoogleTest samples.</li>
        <li><a href="#googletest-faq">GoogleTest FAQ</a> - Have a question? Want some tips? Check here
          first.</li>
        <li><a href="#gmock-for-dummies">Mocking for Dummies</a> - Teaches you how to create mock
          objects and use them in tests.</li>
        <li><a href="#gmock-cookbook">Mocking Cookbook</a> - Includes tips and approaches to
          common mocking use cases.</li>
        <li><a href="#gmock-cheat-sheet">Mocking Cheat Sheet</a> - A handy reference for
          matchers, actions, invariants, and more.</li>
        <li><a href="#legacy-gmock-faq">Mocking FAQ</a> - Contains answers to some mocking-specific
          questions.</li>
      </ul>
      <h1 id="supported-platforms">Supported Platforms</h1>
      <p>GoogleTest follows Google’s
        <a href="https://opensource.google/documentation/policies/cplusplus-support">Foundational C++ Support
          Policy</a>.
        See
        <a href="https://github.com/google/oss-policies-info/blob/main/foundational-cxx-support-matrix.md">this
          table</a>
        for a list of currently supported versions compilers, platforms, and build
        tools.
      </p>
      <h1 id="quickstart-building-with-bazel">Quickstart: Building with Bazel</h1>
      <p>This tutorial aims to get you up and running with GoogleTest using the Bazel
        build system. If you’re using GoogleTest for the first time or need a refresher,
        we recommend this tutorial as a starting point.</p>
      <h2 id="prerequisites">Prerequisites</h2>
      <p>To complete this tutorial, you’ll need:</p>
      <ul>
        <li>A compatible operating system (e.g. Linux, macOS, Windows).</li>
        <li>A compatible C++ compiler that supports at least C++14.</li>
        <li><a href="https://bazel.build/">Bazel</a>, the preferred build system used by the
          GoogleTest team.</li>
      </ul>
      <p>See <a href="#supported-platforms">Supported Platforms</a> for more information about platforms
        compatible with GoogleTest.</p>
      <p>If you don’t already have Bazel installed, see the
        <a href="https://bazel.build/install">Bazel installation guide</a>.
      </p>
      <p>{: .callout .note} Note: The terminal commands in this tutorial show a Unix
        shell prompt, but the commands work on the Windows command line as well.</p>
      <h2 id="set-up-a-bazel-workspace">Set up a Bazel workspace</h2>
      <p>A
        <a href="https://docs.bazel.build/versions/main/build-ref.html#workspace">Bazel workspace</a>
        is a directory on your filesystem that you use to manage source files for the
        software you want to build. Each workspace directory has a text file named
        <code>WORKSPACE</code> which may be empty, or may contain references to external
        dependencies required to build the outputs.
      </p>
      <p>First, create a directory for your workspace:</p>
      <pre><code>$ mkdir my_workspace &amp;&amp; cd my_workspace
</code></pre>
      <p>Next, you’ll create the <code>WORKSPACE</code> file to specify dependencies. A common and
        recommended way to depend on GoogleTest is to use a
        <a href="https://docs.bazel.build/versions/main/external.html">Bazel external dependency</a>
        via the
        <a href="https://docs.bazel.build/versions/main/repo/http.html#http_archive"><code>http_archive</code> rule</a>.
        To do this, in the root directory of your workspace (<code>my_workspace/</code>), create a
        file named <code>WORKSPACE</code> with the following contents:
      </p>
      <pre><code>load("@bazel_tools//tools/build_defs/repo:http.bzl", "http_archive")

http_archive(
  name = "com_google_googletest",
  urls = ["https://github.com/google/googletest/archive/5ab508a01f9eb089207ee87fd547d290da39d015.zip"],
  strip_prefix = "googletest-5ab508a01f9eb089207ee87fd547d290da39d015",
)
</code></pre>
      <p>The above configuration declares a dependency on GoogleTest which is downloaded
        as a ZIP archive from GitHub. In the above example,
        <code>5ab508a01f9eb089207ee87fd547d290da39d015</code> is the Git commit hash of the
        GoogleTest version to use; we recommend updating the hash often to point to the
        latest version. Use a recent hash on the <code>main</code> branch.
      </p>
      <p>Now you’re ready to build C++ code that uses GoogleTest.</p>
      <h2 id="create-and-run-a-binary">Create and run a binary</h2>
      <p>With your Bazel workspace set up, you can now use GoogleTest code within your
        own project.</p>
      <p>As an example, create a file named <code>hello_test.cc</code> in your <code>my_workspace</code>
        directory with the following contents:</p>
      <pre class="chroma"><span class="cp">#include</span> <span class="cpf">&lt;gtest/gtest.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="c1">// Demonstrate some basic assertions.
</span><span class="c1"></span><span class="n">TEST</span><span class="p">(</span><span class="n">HelloTest</span><span class="p">,</span> <span class="n">BasicAssertions</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Expect two strings not to be equal.
</span><span class="c1"></span>  <span class="n">EXPECT_STRNE</span><span class="p">(</span><span class="s">"hello"</span><span class="p">,</span> <span class="s">"world"</span><span class="p">);</span>
  <span class="c1">// Expect equality.
</span><span class="c1"></span>  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="mi">7</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>
<span class="p">}</span>
</pre>
      <p>GoogleTest provides <a href="primer.md#assertions">assertions</a> that you use to test the
        behavior of your code. The above sample includes the main GoogleTest header file
        and demonstrates some basic assertions.</p>
      <p>To build the code, create a file named <code>BUILD</code> in the same directory with the
        following contents:</p>
      <pre><code>cc_test(
  name = "hello_test",
  size = "small",
  srcs = ["hello_test.cc"],
  deps = ["@com_google_googletest//:gtest_main"],
)
</code></pre>
      <p>This <code>cc_test</code> rule declares the C++ test binary you want to build, and links to
        GoogleTest (<code>//:gtest_main</code>) using the prefix you specified in the <code>WORKSPACE</code>
        file (<code>@com_google_googletest</code>). For more information about Bazel <code>BUILD</code> files,
        see the
        <a href="https://docs.bazel.build/versions/main/tutorial/cpp.html">Bazel C++ Tutorial</a>.
      </p>
      <p>{: .callout .note}
        NOTE: In the example below, we assume Clang or GCC and set <code>--cxxopt=-std=c++14</code>
        to ensure that GoogleTest is compiled as C++14 instead of the compiler’s default
        setting (which could be C++11). For MSVC, the equivalent would be
        <code>--cxxopt=/std:c++14</code>. See <a href="#supported-platforms">Supported Platforms</a> for more details
        on supported language versions.
      </p>
      <p>Now you can build and run your test:</p>
      <pre><strong>my_workspace$ bazel test --cxxopt=-std=c++14 --test_output=all //:hello_test</strong>
INFO: Analyzed target //:hello_test (26 packages loaded, 362 targets configured).
INFO: Found 1 test target...
INFO: From Testing //:hello_test:
==================== Test output for //:hello_test:
Running main() from gmock_main.cc
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from HelloTest
[ RUN      ] HelloTest.BasicAssertions
[       OK ] HelloTest.BasicAssertions (0 ms)
[----------] 1 test from HelloTest (0 ms total)

[----------] Global test environment tear-down
[==========] 1 test from 1 test suite ran. (0 ms total)
[  PASSED  ] 1 test.
================================================================================
Target //:hello_test up-to-date:
  bazel-bin/hello_test
INFO: Elapsed time: 4.190s, Critical Path: 3.05s
INFO: 27 processes: 8 internal, 19 linux-sandbox.
INFO: Build completed successfully, 27 total actions
//:hello_test                                                     PASSED in 0.1s

INFO: Build completed successfully, 27 total actions
</pre>
      <p>Congratulations! You’ve successfully built and run a test binary using
        GoogleTest.</p>
      <h2 id="next-steps">Next steps</h2>
      <ul>
        <li><a href="#googletest-primer">Check out the Primer</a> to start learning how to write simple
          tests.</li>
        <li><a href="#googletest-samples">See the code samples</a> for more examples showing how to use a
          variety of GoogleTest features.</li>
      </ul>
      <h1 id="quickstart-building-with-cmake">Quickstart: Building with CMake</h1>
      <p>This tutorial aims to get you up and running with GoogleTest using CMake. If
        you’re using GoogleTest for the first time or need a refresher, we recommend
        this tutorial as a starting point. If your project uses Bazel, see the
        <a href="quickstart-bazel.md">Quickstart for Bazel</a> instead.
      </p>
      <h2 id="prerequisites">Prerequisites</h2>
      <p>To complete this tutorial, you’ll need:</p>
      <ul>
        <li>A compatible operating system (e.g. Linux, macOS, Windows).</li>
        <li>A compatible C++ compiler that supports at least C++14.</li>
        <li><a href="https://cmake.org/">CMake</a> and a compatible build tool for building the
          project.
          <ul>
            <li>Compatible build tools include
              <a href="https://www.gnu.org/software/make/">Make</a>,
              <a href="https://ninja-build.org/">Ninja</a>, and others - see
              <a href="https://cmake.org/cmake/help/latest/manual/cmake-generators.7.html">CMake Generators</a>
              for more information.
            </li>
          </ul>
        </li>
      </ul>
      <p>See <a href="#supported-platforms">Supported Platforms</a> for more information about platforms
        compatible with GoogleTest.</p>
      <p>If you don’t already have CMake installed, see the
        <a href="https://cmake.org/install">CMake installation guide</a>.
      </p>
      <p>{: .callout .note}
        Note: The terminal commands in this tutorial show a Unix shell prompt, but the
        commands work on the Windows command line as well.</p>
      <h2 id="set-up-a-project">Set up a project</h2>
      <p>CMake uses a file named <code>CMakeLists.txt</code> to configure the build system for a
        project. You’ll use this file to set up your project and declare a dependency on
        GoogleTest.</p>
      <p>First, create a directory for your project:</p>
      <pre><code>$ mkdir my_project &amp;&amp; cd my_project
</code></pre>
      <p>Next, you’ll create the <code>CMakeLists.txt</code> file and declare a dependency on
        GoogleTest. There are many ways to express dependencies in the CMake ecosystem;
        in this quickstart, you’ll use the
        <a href="https://cmake.org/cmake/help/latest/module/FetchContent.html"><code>FetchContent</code> CMake
          module</a>.
        To do this, in your project directory (<code>my_project</code>), create a file named
        <code>CMakeLists.txt</code> with the following contents:
      </p>
      <pre class="chroma"><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span> <span class="s">3.14</span><span class="p">)</span><span class="err">
</span><span class="err"></span><span class="nb">project</span><span class="p">(</span><span class="s">my_project</span><span class="p">)</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># GoogleTest requires at least C++14
</span><span class="c"></span><span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_CXX_STANDARD</span> <span class="s">14</span><span class="p">)</span><span class="err">
</span><span class="err"></span><span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_CXX_STANDARD_REQUIRED</span> <span class="s">ON</span><span class="p">)</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">include</span><span class="p">(</span><span class="s">FetchContent</span><span class="p">)</span><span class="err">
</span><span class="err"></span><span class="nb">FetchContent_Declare</span><span class="p">(</span>
  <span class="s">googletest</span>
  <span class="s">URL</span> <span class="s">https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip</span>
<span class="p">)</span><span class="err">
</span><span class="err"></span><span class="c"># For Windows: Prevent overriding the parent project's compiler/linker settings
</span><span class="c"></span><span class="nb">set</span><span class="p">(</span><span class="s">gtest_force_shared_crt</span> <span class="s">ON</span> <span class="s">CACHE</span> <span class="s">BOOL</span> <span class="s2">""</span> <span class="s">FORCE</span><span class="p">)</span><span class="err">
</span><span class="err"></span><span class="nb">FetchContent_MakeAvailable</span><span class="p">(</span><span class="s">googletest</span><span class="p">)</span><span class="err">
</span></pre>
      <p>The above configuration declares a dependency on GoogleTest which is downloaded
        from GitHub. In the above example, <code>03597a01ee50ed33e9dfd640b249b4be3799d395</code> is
        the Git commit hash of the GoogleTest version to use; we recommend updating the
        hash often to point to the latest version.</p>
      <p>For more information about how to create <code>CMakeLists.txt</code> files, see the
        <a href="https://cmake.org/cmake/help/latest/guide/tutorial/index.html">CMake Tutorial</a>.
      </p>
      <h2 id="create-and-run-a-binary">Create and run a binary</h2>
      <p>With GoogleTest declared as a dependency, you can use GoogleTest code within
        your own project.</p>
      <p>As an example, create a file named <code>hello_test.cc</code> in your <code>my_project</code>
        directory with the following contents:</p>
      <pre class="chroma"><span class="cp">#include</span> <span class="cpf">&lt;gtest/gtest.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="c1">// Demonstrate some basic assertions.
</span><span class="c1"></span><span class="n">TEST</span><span class="p">(</span><span class="n">HelloTest</span><span class="p">,</span> <span class="n">BasicAssertions</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Expect two strings not to be equal.
</span><span class="c1"></span>  <span class="n">EXPECT_STRNE</span><span class="p">(</span><span class="s">"hello"</span><span class="p">,</span> <span class="s">"world"</span><span class="p">);</span>
  <span class="c1">// Expect equality.
</span><span class="c1"></span>  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="mi">7</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>
<span class="p">}</span>
</pre>
      <p>GoogleTest provides <a href="primer.md#assertions">assertions</a> that you use to test the
        behavior of your code. The above sample includes the main GoogleTest header file
        and demonstrates some basic assertions.</p>
      <p>To build the code, add the following to the end of your <code>CMakeLists.txt</code> file:</p>
      <pre class="chroma"><span class="nb">enable_testing</span><span class="p">()</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">add_executable</span><span class="p">(</span>
  <span class="s">hello_test</span>
  <span class="s">hello_test.cc</span>
<span class="p">)</span><span class="err">
</span><span class="err"></span><span class="nb">target_link_libraries</span><span class="p">(</span>
  <span class="s">hello_test</span>
  <span class="s">GTest::gtest_main</span>
<span class="p">)</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">include</span><span class="p">(</span><span class="s">GoogleTest</span><span class="p">)</span><span class="err">
</span><span class="err"></span><span class="nb">gtest_discover_tests</span><span class="p">(</span><span class="s">hello_test</span><span class="p">)</span><span class="err">
</span></pre>
      <p>The above configuration enables testing in CMake, declares the C++ test binary
        you want to build (<code>hello_test</code>), and links it to GoogleTest (<code>gtest_main</code>). The
        last two lines enable CMake’s test runner to discover the tests included in the
        binary, using the
        <a href="https://cmake.org/cmake/help/git-stage/module/GoogleTest.html"><code>GoogleTest</code> CMake
          module</a>.
      </p>
      <p>Now you can build and run your test:</p>
      <pre><strong>my_project$ cmake -S . -B build</strong>
-- The C compiler identification is GNU 10.2.1
-- The CXX compiler identification is GNU 10.2.1
...
-- Build files have been written to: .../my_project/build

<strong>my_project$ cmake --build build</strong>
Scanning dependencies of target gtest
...
[100%] Built target gmock_main

<strong>my_project$ cd build &amp;&amp; ctest</strong>
Test project .../my_project/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1

Total Test time (real) =   0.01 sec
</pre>
      <p>Congratulations! You’ve successfully built and run a test binary using
        GoogleTest.</p>
      <h2 id="next-steps">Next steps</h2>
      <ul>
        <li><a href="#googletest-primer">Check out the Primer</a> to start learning how to write simple
          tests.</li>
        <li><a href="#googletest-samples">See the code samples</a> for more examples showing how to use a
          variety of GoogleTest features.</li>
      </ul>
      <h1 id="googletest-primer">GoogleTest Primer</h1>
      <h2 id="introduction-why-googletest">Introduction: Why GoogleTest?</h2>
      <p><em>GoogleTest</em> helps you write better C++ tests.</p>
      <p>GoogleTest is a testing framework developed by the Testing Technology team with
        Google’s specific requirements and constraints in mind. Whether you work on
        Linux, Windows, or a Mac, if you write C++ code, GoogleTest can help you. And it
        supports <em>any</em> kind of tests, not just unit tests.</p>
      <p>So what makes a good test, and how does GoogleTest fit in? We believe:</p>
      <ol>
        <li>Tests should be <em>independent</em> and <em>repeatable</em>. It’s a pain to debug a test
          that succeeds or fails as a result of other tests. GoogleTest isolates the
          tests by running each of them on a different object. When a test fails,
          GoogleTest allows you to run it in isolation for quick debugging.</li>
        <li>Tests should be well <em>organized</em> and reflect the structure of the tested
          code. GoogleTest groups related tests into test suites that can share data
          and subroutines. This common pattern is easy to recognize and makes tests
          easy to maintain. Such consistency is especially helpful when people switch
          projects and start to work on a new code base.</li>
        <li>Tests should be <em>portable</em> and <em>reusable</em>. Google has a lot of code that is
          platform-neutral; its tests should also be platform-neutral. GoogleTest
          works on different OSes, with different compilers, with or without
          exceptions, so GoogleTest tests can work with a variety of configurations.</li>
        <li>When tests fail, they should provide as much <em>information</em> about the problem
          as possible. GoogleTest doesn’t stop at the first test failure. Instead, it
          only stops the current test and continues with the next. You can also set up
          tests that report non-fatal failures after which the current test continues.
          Thus, you can detect and fix multiple bugs in a single run-edit-compile
          cycle.</li>
        <li>The testing framework should liberate test writers from housekeeping chores
          and let them focus on the test <em>content</em>. GoogleTest automatically keeps
          track of all tests defined, and doesn’t require the user to enumerate them
          in order to run them.</li>
        <li>Tests should be <em>fast</em>. With GoogleTest, you can reuse shared resources
          across tests and pay for the set-up/tear-down only once, without making
          tests depend on each other.</li>
      </ol>
      <p>Since GoogleTest is based on the popular xUnit architecture, you’ll feel right
        at home if you’ve used JUnit or PyUnit before. If not, it will take you about 10
        minutes to learn the basics and get started. So let’s go!</p>
      <h2 id="beware-of-the-nomenclature">Beware of the Nomenclature</h2>
      <p>{: .callout .note}
        <em>Note:</em> There might be some confusion arising from different definitions of the
        terms <em>Test</em>, <em>Test Case</em> and <em>Test Suite</em>, so beware of misunderstanding these.
      </p>
      <p>Historically, GoogleTest started to use the term <em>Test Case</em> for grouping
        related tests, whereas current publications, including International Software
        Testing Qualifications Board (<a href="https://www.istqb.org/">ISTQB</a>) materials and
        various textbooks on software quality, use the term
        <em><a href="https://glossary.istqb.org/en_US/term/test-suite-1-3">Test Suite</a></em> for this.
      </p>
      <p>The related term <em>Test</em>, as it is used in GoogleTest, corresponds to the term
        <em><a href="https://glossary.istqb.org/en_US/term/test-case-2">Test Case</a></em> of ISTQB and others.
      </p>
      <p>The term <em>Test</em> is commonly of broad enough sense, including ISTQB’s definition
        of <em>Test Case</em>, so it’s not much of a problem here. But the term <em>Test Case</em> as
        was used in Google Test is of contradictory sense and thus confusing.</p>
      <p>GoogleTest recently started replacing the term <em>Test Case</em> with <em>Test Suite</em>.
        The preferred API is <em>TestSuite</em>. The older TestCase API is being slowly
        deprecated and refactored away.</p>
      <p>So please be aware of the different definitions of the terms:</p>
      <table>
        <thead>
          <tr>
            <th align="left">Meaning</th>
            <th align="left">GoogleTest Term</th>
            <th align="left"><a href="https://www.istqb.org/">ISTQB</a> Term</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left">Exercise a particular program path with specific input values and verify the results</td>
            <td align="left"><a href="#simple-tests">TEST()</a></td>
            <td align="left"><a href="https://glossary.istqb.org/en_US/term/test-case-2">Test Case</a></td>
          </tr>
        </tbody>
      </table>
      <h2 id="basic-concepts">Basic Concepts</h2>
      <p>When using GoogleTest, you start by writing <em>assertions</em>, which are statements
        that check whether a condition is true. An assertion’s result can be <em>success</em>,
        <em>nonfatal failure</em>, or <em>fatal failure</em>. If a fatal failure occurs, it aborts the
        current function; otherwise the program continues normally.
      </p>
      <p><em>Tests</em> use assertions to verify the tested code’s behavior. If a test crashes
        or has a failed assertion, then it <em>fails</em>; otherwise it <em>succeeds</em>.</p>
      <p>A <em>test suite</em> contains one or many tests. You should group your tests into test
        suites that reflect the structure of the tested code. When multiple tests in a
        test suite need to share common objects and subroutines, you can put them into a
        <em>test fixture</em> class.
      </p>
      <p>A <em>test program</em> can contain multiple test suites.</p>
      <p>We’ll now explain how to write a test program, starting at the individual
        assertion level and building up to tests and test suites.</p>
      <h2 id="assertions">Assertions</h2>
      <p>GoogleTest assertions are macros that resemble function calls. You test a class
        or function by making assertions about its behavior. When an assertion fails,
        GoogleTest prints the assertion’s source file and line number location, along
        with a failure message. You may also supply a custom failure message which will
        be appended to GoogleTest’s message.</p>
      <p>The assertions come in pairs that test the same thing but have different effects
        on the current function. <code>ASSERT_*</code> versions generate fatal failures when they
        fail, and <strong>abort the current function</strong>. <code>EXPECT_*</code> versions generate nonfatal
        failures, which don’t abort the current function. Usually <code>EXPECT_*</code> are
        preferred, as they allow more than one failure to be reported in a test.
        However, you should use <code>ASSERT_*</code> if it doesn’t make sense to continue when the
        assertion in question fails.</p>
      <p>Since a failed <code>ASSERT_*</code> returns from the current function immediately,
        possibly skipping clean-up code that comes after it, it may cause a space leak.
        Depending on the nature of the leak, it may or may not be worth fixing - so keep
        this in mind if you get a heap checker error in addition to assertion errors.</p>
      <p>To provide a custom failure message, simply stream it into the macro using the
        <code>&lt;&lt;</code> operator or a sequence of such operators. See the following example, using
        the <a href="reference/assertions.md#EXPECT_EQ"><code>ASSERT_EQ</code> and <code>EXPECT_EQ</code></a> macros to
        verify value equality:
      </p>
      <pre class="chroma"><span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">y</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="o">&lt;&lt;</span> <span class="s">"Vectors x and y are of unequal length"</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="s">"Vectors x and y differ at index "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>
</pre>
      <p>Anything that can be streamed to an <code>ostream</code> can be streamed to an assertion
        macro–in particular, C strings and <code>string</code> objects. If a wide string
        (<code>wchar_t*</code>, <code>TCHAR*</code> in <code>UNICODE</code> mode on Windows, or
        <code>std::wstring</code>) is
        streamed to an assertion, it will be translated to UTF-8 when printed.
      </p>
      <p>GoogleTest provides a collection of assertions for verifying the behavior of
        your code in various ways. You can check Boolean conditions, compare values
        based on relational operators, verify string values, floating-point values, and
        much more. There are even assertions that enable you to verify more complex
        states by providing custom predicates. For the complete list of assertions
        provided by GoogleTest, see the <a href="reference/assertions.md">Assertions Reference</a>.</p>
      <h2 id="simple-tests">Simple Tests</h2>
      <p>To create a test:</p>
      <ol>
        <li>Use the <code>TEST()</code> macro to define and name a test function. These are
          ordinary C++ functions that don’t return a value.</li>
        <li>In this function, along with any valid C++ statements you want to include,
          use the various GoogleTest assertions to check values.</li>
        <li>The test’s result is determined by the assertions; if any assertion in the
          test fails (either fatally or non-fatally), or if the test crashes, the
          entire test fails. Otherwise, it succeeds.</li>
      </ol>
      <pre class="chroma"><span class="n">TEST</span><span class="p">(</span><span class="n">TestSuiteName</span><span class="p">,</span> <span class="n">TestName</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span> <span class="n">test</span> <span class="n">body</span> <span class="p">...</span>
<span class="p">}</span>
</pre>
      <p><code>TEST()</code> arguments go from general to specific. The <em>first</em> argument is the name
        of the test suite, and the <em>second</em> argument is the test’s name within the test
        suite. Both names must be valid C++ identifiers, and they should not contain any
        underscores (<code>_</code>). A test’s <em>full name</em> consists of its containing test suite
        and its individual name. Tests from different test suites can have the same
        individual name.</p>
      <p>For example, let’s take a simple integer function:</p>
      <pre class="chroma"><span class="kt">int</span> <span class="nf">Factorial</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">);</span>  <span class="c1">// Returns the factorial of n
</span></pre>
      <p>A test suite for this function might look like:</p>
      <pre class="chroma"><span class="c1">// Tests factorial of 0.
</span><span class="c1"></span><span class="n">TEST</span><span class="p">(</span><span class="n">FactorialTest</span><span class="p">,</span> <span class="n">HandlesZeroInput</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">Factorial</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Tests factorial of positive numbers.
</span><span class="c1"></span><span class="n">TEST</span><span class="p">(</span><span class="n">FactorialTest</span><span class="p">,</span> <span class="n">HandlesPositiveInput</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">Factorial</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">Factorial</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">Factorial</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">6</span><span class="p">);</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">Factorial</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="mi">40320</span><span class="p">);</span>
<span class="p">}</span>
</pre>
      <p>GoogleTest groups the test results by test suites, so logically related tests
        should be in the same test suite; in other words, the first argument to their
        <code>TEST()</code> should be the same. In the above example, we have two tests,
        <code>HandlesZeroInput</code> and <code>HandlesPositiveInput</code>, that belong to the same test
        suite <code>FactorialTest</code>.
      </p>
      <p>When naming your test suites and tests, you should follow the same convention as
        for
        <a href="https://google.github.io/styleguide/cppguide.html#Function_Names">naming functions and classes</a>.
      </p>
      <p><strong>Availability</strong>: Linux, Windows, Mac.</p>
      <h2 id="test-fixtures-using-the-same-data-configuration-for-multiple-tests-same-data-multiple-tests">Test
        Fixtures: Using the Same Data Configuration for Multiple Tests {#same-data-multiple-tests}</h2>
      <p>If you find yourself writing two or more tests that operate on similar data, you
        can use a <em>test fixture</em>. This allows you to reuse the same configuration of
        objects for several different tests.</p>
      <p>To create a fixture:</p>
      <ol>
        <li>Derive a class from <code>testing::Test</code> . Start its body with <code>protected:</code>, as
          we’ll want to access fixture members from sub-classes.</li>
        <li>Inside the class, declare any objects you plan to use.</li>
        <li>If necessary, write a default constructor or <code>SetUp()</code> function to prepare
          the objects for each test. A common mistake is to spell <code>SetUp()</code> as
          <strong><code>Setup()</code></strong> with a small <code>u</code> - Use <code>override</code> in C++11 to make
          sure you
          spelled it correctly.
        </li>
        <li>If necessary, write a destructor or <code>TearDown()</code> function to release any
          resources you allocated in <code>SetUp()</code> . To learn when you should use the
          constructor/destructor and when you should use <code>SetUp()/TearDown()</code>, read
          the <a href="#googletest-faq#CtorVsSetUp">FAQ</a>.</li>
        <li>If needed, define subroutines for your tests to share.</li>
      </ol>
      <p>When using a fixture, use <code>TEST_F()</code> instead of <code>TEST()</code> as it allows you to
        access objects and subroutines in the test fixture:</p>
      <pre class="chroma"><span class="n">TEST_F</span><span class="p">(</span><span class="n">TestFixtureClassName</span><span class="p">,</span> <span class="n">TestName</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span> <span class="n">test</span> <span class="n">body</span> <span class="p">...</span>
<span class="p">}</span>
</pre>
      <p>Unlike <code>TEST()</code>, in <code>TEST_F()</code> the first argument must be the name of the test
        fixture class. (<code>_F</code> stands for “Fixture”). No test suite name is specified for
        this macro.</p>
      <p>Unfortunately, the C++ macro system does not allow us to create a single macro
        that can handle both types of tests. Using the wrong macro causes a compiler
        error.</p>
      <p>Also, you must first define a test fixture class before using it in a
        <code>TEST_F()</code>, or you’ll get the compiler error “<code>virtual outside class declaration</code>”.
      </p>
      <p>For each test defined with <code>TEST_F()</code>, GoogleTest will create a <em>fresh</em> test
        fixture at runtime, immediately initialize it via <code>SetUp()</code>, run the test, clean
        up by calling <code>TearDown()</code>, and then delete the test fixture. Note that
        different tests in the same test suite have different test fixture objects, and
        GoogleTest always deletes a test fixture before it creates the next one.
        GoogleTest does <strong>not</strong> reuse the same test fixture for multiple tests. Any
        changes one test makes to the fixture do not affect other tests.</p>
      <p>As an example, let’s write tests for a FIFO queue class named <code>Queue</code>, which has
        the following interface:</p>
      <pre class="chroma"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">E</span><span class="o">&gt;</span>  <span class="c1">// E is the element type.
</span><span class="c1"></span><span class="k">class</span> <span class="nc">Queue</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">Queue</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">Enqueue</span><span class="p">(</span><span class="k">const</span> <span class="n">E</span><span class="o">&amp;</span> <span class="n">element</span><span class="p">);</span>
  <span class="n">E</span><span class="o">*</span> <span class="nf">Dequeue</span><span class="p">();</span>  <span class="c1">// Returns NULL if the queue is empty.
</span><span class="c1"></span>  <span class="n">size_t</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="p">...</span>
<span class="p">};</span>
</pre>
      <p>First, define a fixture class. By convention, you should give it the name
        <code>FooTest</code> where <code>Foo</code> is the class being tested.
      </p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">QueueTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
  <span class="n">QueueTest</span><span class="p">()</span> <span class="p">{</span>
     <span class="c1">// q0_ remains empty
</span><span class="c1"></span>     <span class="n">q1_</span><span class="p">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
     <span class="n">q2_</span><span class="p">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
     <span class="n">q2_</span><span class="p">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// ~QueueTest() override = default;
</span><span class="c1"></span>
  <span class="n">Queue</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">q0_</span><span class="p">;</span>
  <span class="n">Queue</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">q1_</span><span class="p">;</span>
  <span class="n">Queue</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">q2_</span><span class="p">;</span>
<span class="p">};</span>
</pre>
      <p>In this case, we don’t need to define a destructor or a <code>TearDown()</code> method,
        because the implicit destructor generated by the compiler will perform all of
        the necessary cleanup.</p>
      <p>Now we’ll write tests using <code>TEST_F()</code> and this fixture.</p>
      <pre class="chroma"><span class="n">TEST_F</span><span class="p">(</span><span class="n">QueueTest</span><span class="p">,</span> <span class="n">IsEmptyInitially</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">q0_</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">QueueTest</span><span class="p">,</span> <span class="n">DequeueWorks</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">n</span> <span class="o">=</span> <span class="n">q0_</span><span class="p">.</span><span class="n">Dequeue</span><span class="p">();</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">);</span>

  <span class="n">n</span> <span class="o">=</span> <span class="n">q1_</span><span class="p">.</span><span class="n">Dequeue</span><span class="p">();</span>
  <span class="n">ASSERT_NE</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">);</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">q1_</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">delete</span> <span class="n">n</span><span class="p">;</span>

  <span class="n">n</span> <span class="o">=</span> <span class="n">q2_</span><span class="p">.</span><span class="n">Dequeue</span><span class="p">();</span>
  <span class="n">ASSERT_NE</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">);</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">q2_</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span>
  <span class="k">delete</span> <span class="n">n</span><span class="p">;</span>
<span class="p">}</span>
</pre>
      <p>The above uses both <code>ASSERT_*</code> and <code>EXPECT_*</code> assertions. The rule of thumb is
        to use <code>EXPECT_*</code> when you want the test to continue to reveal more errors after
        the assertion failure, and use <code>ASSERT_*</code> when continuing after failure doesn’t
        make sense. For example, the second assertion in the <code>Dequeue</code> test is
        <code>ASSERT_NE(n, nullptr)</code>, as we need to dereference the pointer <code>n</code> later, which
        would lead to a segfault when <code>n</code> is <code>NULL</code>.
      </p>
      <p>When these tests run, the following happens:</p>
      <ol>
        <li>GoogleTest constructs a <code>QueueTest</code> object (let’s call it <code>t1</code>).</li>
        <li>The first test (<code>IsEmptyInitially</code>) runs on <code>t1</code>.</li>
        <li><code>t1</code> is destructed.</li>
        <li>The above steps are repeated on another <code>QueueTest</code> object, this time
          running the <code>DequeueWorks</code> test.</li>
      </ol>
      <p><strong>Availability</strong>: Linux, Windows, Mac.</p>
      <h2 id="invoking-the-tests">Invoking the Tests</h2>
      <p><code>TEST()</code> and <code>TEST_F()</code> implicitly register their tests with GoogleTest. So,
        unlike with many other C++ testing frameworks, you don’t have to re-list all
        your defined tests in order to run them.</p>
      <p>After defining your tests, you can run them with <code>RUN_ALL_TESTS()</code>, which
        returns <code>0</code> if all the tests are successful, or <code>1</code> otherwise. Note that
        <code>RUN_ALL_TESTS()</code> runs <em>all tests</em> in your link unit–they can be from different
        test suites, or even different source files.
      </p>
      <p>When invoked, the <code>RUN_ALL_TESTS()</code> macro:</p>
      <ul>
        <li>
          <p>Saves the state of all GoogleTest flags.</p>
        </li>
        <li>
          <p>Creates a test fixture object for the first test.</p>
        </li>
        <li>
          <p>Initializes it via <code>SetUp()</code>.</p>
        </li>
        <li>
          <p>Runs the test on the fixture object.</p>
        </li>
        <li>
          <p>Cleans up the fixture via <code>TearDown()</code>.</p>
        </li>
        <li>
          <p>Deletes the fixture.</p>
        </li>
        <li>
          <p>Restores the state of all GoogleTest flags.</p>
        </li>
        <li>
          <p>Repeats the above steps for the next test, until all tests have run.</p>
        </li>
      </ul>
      <p>If a fatal failure happens the subsequent steps will be skipped.</p>
      <p>{: .callout .important}</p>
      <blockquote>
        <p>IMPORTANT: You must <strong>not</strong> ignore the return value of <code>RUN_ALL_TESTS()</code>, or
          you will get a compiler error. The rationale for this design is that the
          automated testing service determines whether a test has passed based on its
          exit code, not on its stdout/stderr output; thus your <code>main()</code> function must
          return the value of <code>RUN_ALL_TESTS()</code>.</p>
        <p>Also, you should call <code>RUN_ALL_TESTS()</code> only <strong>once</strong>. Calling it more than
          once conflicts with some advanced GoogleTest features (e.g., thread-safe
          <a href="#advanced-googletest-topics#death-tests">death tests</a>) and thus is not supported.
        </p>
      </blockquote>
      <p><strong>Availability</strong>: Linux, Windows, Mac.</p>
      <h2 id="writing-the-main-function">Writing the main() Function</h2>
      <p>Most users should <em>not</em> need to write their own <code>main</code> function and instead link
        with <code>gtest_main</code> (as opposed to with <code>gtest</code>), which defines a suitable entry
        point. See the end of this section for details. The remainder of this section
        should only apply when you need to do something custom before the tests run that
        cannot be expressed within the framework of fixtures and test suites.</p>
      <p>If you write your own <code>main</code> function, it should return the value of
        <code>RUN_ALL_TESTS()</code>.
      </p>
      <p>You can start from this boilerplate:</p>
      <pre class="chroma"><span class="cp">#include</span> <span class="cpf">"this/package/foo.h"</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;gtest/gtest.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">namespace</span> <span class="n">my</span> <span class="p">{</span>
<span class="k">namespace</span> <span class="n">project</span> <span class="p">{</span>
<span class="k">namespace</span> <span class="p">{</span>

<span class="c1">// The fixture for testing class Foo.
</span><span class="c1"></span><span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
  <span class="c1">// You can remove any or all of the following functions if their bodies would
</span><span class="c1"></span>  <span class="c1">// be empty.
</span><span class="c1"></span>
  <span class="n">FooTest</span><span class="p">()</span> <span class="p">{</span>
     <span class="c1">// You can do set-up work for each test here.
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="o">~</span><span class="n">FooTest</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span>
     <span class="c1">// You can do clean-up work that doesn't throw exceptions here.
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="c1">// If the constructor and destructor are not enough for setting up
</span><span class="c1"></span>  <span class="c1">// and cleaning up each test, you can define the following methods:
</span><span class="c1"></span>
  <span class="kt">void</span> <span class="nf">SetUp</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span>
     <span class="c1">// Code here will be called immediately after the constructor (right
</span><span class="c1"></span>     <span class="c1">// before each test).
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="kt">void</span> <span class="nf">TearDown</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span>
     <span class="c1">// Code here will be called immediately after each test (right
</span><span class="c1"></span>     <span class="c1">// before the destructor).
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="c1">// Class members declared here can be used by all tests in the test suite
</span><span class="c1"></span>  <span class="c1">// for Foo.
</span><span class="c1"></span><span class="p">};</span>

<span class="c1">// Tests that the Foo::Bar() method does Abc.
</span><span class="c1"></span><span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">MethodBarDoesAbc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">input_filepath</span> <span class="o">=</span> <span class="s">"this/package/testdata/myinputfile.dat"</span><span class="p">;</span>
  <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">output_filepath</span> <span class="o">=</span> <span class="s">"this/package/testdata/myoutputfile.dat"</span><span class="p">;</span>
  <span class="n">Foo</span> <span class="n">f</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">input_filepath</span><span class="p">,</span> <span class="n">output_filepath</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Tests that Foo does Xyz.
</span><span class="c1"></span><span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">DoesXyz</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Exercises the Xyz feature of Foo.
</span><span class="c1"></span><span class="p">}</span>

<span class="p">}</span>  <span class="c1">// namespace
</span><span class="c1"></span><span class="p">}</span>  <span class="c1">// namespace project
</span><span class="c1"></span><span class="p">}</span>  <span class="c1">// namespace my
</span><span class="c1"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">testing</span><span class="o">::</span><span class="n">InitGoogleTest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">RUN_ALL_TESTS</span><span class="p">();</span>
<span class="p">}</span>
</pre>
      <p>The <code>testing::InitGoogleTest()</code> function parses the command line for GoogleTest
        flags, and removes all recognized flags. This allows the user to control a test
        program’s behavior via various flags, which we’ll cover in the
        <a href="#advanced-googletest-topics">AdvancedGuide</a>. You <strong>must</strong> call this function before
        calling
        <code>RUN_ALL_TESTS()</code>, or the flags won’t be properly initialized.
      </p>
      <p>On Windows, <code>InitGoogleTest()</code> also works with wide strings, so it can be used
        in programs compiled in <code>UNICODE</code> mode as well.</p>
      <p>But maybe you think that writing all those <code>main</code> functions is too much work? We
        agree with you completely, and that’s why Google Test provides a basic
        implementation of main(). If it fits your needs, then just link your test with
        the <code>gtest_main</code> library and you are good to go.</p>
      <p>{: .callout .note}
        NOTE: <code>ParseGUnitFlags()</code> is deprecated in favor of <code>InitGoogleTest()</code>.</p>
      <h2 id="known-limitations">Known Limitations</h2>
      <ul>
        <li>Google Test is designed to be thread-safe. The implementation is thread-safe
          on systems where the <code>pthreads</code> library is available. It is currently
          <em>unsafe</em> to use Google Test assertions from two threads concurrently on
          other systems (e.g. Windows). In most tests this is not an issue as usually
          the assertions are done in the main thread. If you want to help, you can
          volunteer to implement the necessary synchronization primitives in
          <code>gtest-port.h</code> for your platform.
        </li>
      </ul>
      <h1 id="advanced-googletest-topics">Advanced GoogleTest Topics</h1>
      <h2 id="introduction">Introduction</h2>
      <p>Now that you have read the <a href="#googletest-primer">GoogleTest Primer</a> and learned how to
        write tests using GoogleTest, it’s time to learn some new tricks. This document
        will show you more assertions as well as how to construct complex failure
        messages, propagate fatal failures, reuse and speed up your test fixtures, and
        use various flags with your tests.</p>
      <h2 id="more-assertions">More Assertions</h2>
      <p>This section covers some less frequently used, but still significant,
        assertions.</p>
      <h3 id="explicit-success-and-failure">Explicit Success and Failure</h3>
      <p>See <a href="#explicit-success-and-failure-success-failure">Explicit Success and Failure</a> in
        the Assertions Reference.</p>
      <h3 id="exception-assertions">Exception Assertions</h3>
      <p>See <a href="reference/assertions.md#exceptions">Exception Assertions</a> in the Assertions
        Reference.</p>
      <h3 id="predicate-assertions-for-better-error-messages">Predicate Assertions for Better Error Messages</h3>
      <p>Even though GoogleTest has a rich set of assertions, they can never be complete,
        as it’s impossible (nor a good idea) to anticipate all scenarios a user might
        run into. Therefore, sometimes a user has to use <code>EXPECT_TRUE()</code> to check a
        complex expression, for lack of a better macro. This has the problem of not
        showing you the values of the parts of the expression, making it hard to
        understand what went wrong. As a workaround, some users choose to construct the
        failure message by themselves, streaming it into <code>EXPECT_TRUE()</code>. However, this
        is awkward especially when the expression has side-effects or is expensive to
        evaluate.</p>
      <p>GoogleTest gives you three different options to solve this problem:</p>
      <h4 id="using-an-existing-boolean-function">Using an Existing Boolean Function</h4>
      <p>If you already have a function or functor that returns <code>bool</code> (or a type that
        can be implicitly converted to <code>bool</code>), you can use it in a <em>predicate
          assertion</em> to get the function arguments printed for free. See
        <a href="reference/assertions.md#EXPECT_PRED"><code>EXPECT_PRED*</code></a> in the Assertions
        Reference for details.
      </p>
      <h4 id="using-a-function-that-returns-an-assertionresult">Using a Function That Returns an AssertionResult</h4>
      <p>While <code>EXPECT_PRED*()</code> and friends are handy for a quick job, the syntax is not
        satisfactory: you have to use different macros for different arities, and it
        feels more like Lisp than C++. The <code>::testing::AssertionResult</code> class solves
        this problem.</p>
      <p>An <code>AssertionResult</code> object represents the result of an assertion (whether it’s
        a success or a failure, and an associated message). You can create an
        <code>AssertionResult</code> using one of these factory functions:
      </p>
      <pre class="chroma"><span class="k">namespace</span> <span class="n">testing</span> <span class="p">{</span>

<span class="c1">// Returns an AssertionResult object to indicate that an assertion has
</span><span class="c1">// succeeded.
</span><span class="c1"></span><span class="n">AssertionResult</span> <span class="nf">AssertionSuccess</span><span class="p">();</span>

<span class="c1">// Returns an AssertionResult object to indicate that an assertion has
</span><span class="c1">// failed.
</span><span class="c1"></span><span class="n">AssertionResult</span> <span class="nf">AssertionFailure</span><span class="p">();</span>

<span class="p">}</span>
</pre>
      <p>You can then use the <code>&lt;&lt;</code> operator to stream messages to the <code>AssertionResult</code>
        object.</p>
      <p>To provide more readable messages in Boolean assertions (e.g. <code>EXPECT_TRUE()</code>),
        write a predicate function that returns <code>AssertionResult</code> instead of <code>bool</code>. For
        example, if you define <code>IsEven()</code> as:</p>
      <pre class="chroma"><span class="n">testing</span><span class="o">::</span><span class="n">AssertionResult</span> <span class="n">IsEven</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">n</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">testing</span><span class="o">::</span><span class="n">AssertionSuccess</span><span class="p">();</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="n">testing</span><span class="o">::</span><span class="n">AssertionFailure</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="s">" is odd"</span><span class="p">;</span>
<span class="p">}</span>
</pre>
      <p>instead of:</p>
      <pre class="chroma"><span class="kt">bool</span> <span class="nf">IsEven</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre>
      <p>the failed assertion <code>EXPECT_TRUE(IsEven(Fib(4)))</code> will print:</p>
      <pre><code class="language-none">Value of: IsEven(Fib(4))
  Actual: false (3 is odd)
Expected: true
</code></pre>
      <p>instead of a more opaque</p>
      <pre><code class="language-none">Value of: IsEven(Fib(4))
  Actual: false
Expected: true
</code></pre>
      <p>If you want informative messages in <code>EXPECT_FALSE</code> and <code>ASSERT_FALSE</code> as well
        (one third of Boolean assertions in the Google code base are negative ones), and
        are fine with making the predicate slower in the success case, you can supply a
        success message:</p>
      <pre class="chroma"><span class="n">testing</span><span class="o">::</span><span class="n">AssertionResult</span> <span class="n">IsEven</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">n</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">testing</span><span class="o">::</span><span class="n">AssertionSuccess</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="s">" is even"</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="n">testing</span><span class="o">::</span><span class="n">AssertionFailure</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="s">" is odd"</span><span class="p">;</span>
<span class="p">}</span>
</pre>
      <p>Then the statement <code>EXPECT_FALSE(IsEven(Fib(6)))</code> will print</p>
      <pre><code class="language-none">  Value of: IsEven(Fib(6))
     Actual: true (8 is even)
  Expected: false
</code></pre>
      <h4 id="using-a-predicate-formatter">Using a Predicate-Formatter</h4>
      <p>If you find the default message generated by
        <a href="reference/assertions.md#EXPECT_PRED"><code>EXPECT_PRED*</code></a> and
        <a href="reference/assertions.md#EXPECT_TRUE"><code>EXPECT_TRUE</code></a> unsatisfactory, or some
        arguments to your predicate do not support streaming to <code>ostream</code>, you can
        instead use <em>predicate-formatter assertions</em> to <em>fully</em> customize how the
        message is formatted. See
        <a href="reference/assertions.md#EXPECT_PRED_FORMAT"><code>EXPECT_PRED_FORMAT*</code></a> in the
        Assertions Reference for details.
      </p>
      <h3 id="floating-point-comparison">Floating-Point Comparison</h3>
      <p>See <a href="reference/assertions.md#floating-point">Floating-Point Comparison</a> in the
        Assertions Reference.</p>
      <h4 id="floating-point-predicate-format-functions">Floating-Point Predicate-Format Functions</h4>
      <p>Some floating-point operations are useful, but not that often used. In order to
        avoid an explosion of new macros, we provide them as predicate-format functions
        that can be used in the predicate assertion macro
        <a href="reference/assertions.md#EXPECT_PRED_FORMAT"><code>EXPECT_PRED_FORMAT2</code></a>, for
        example:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">FloatLE</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">DoubleLE</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_PRED_FORMAT2</span><span class="p">(</span><span class="n">FloatLE</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">);</span>
<span class="n">EXPECT_PRED_FORMAT2</span><span class="p">(</span><span class="n">DoubleLE</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">);</span>
</pre>
      <p>The above code verifies that <code>val1</code> is less than, or approximately equal to,
        <code>val2</code>.
      </p>
      <h3 id="asserting-using-gmock-matchers">Asserting Using gMock Matchers</h3>
      <p>See <a href="reference/assertions.md#EXPECT_THAT"><code>EXPECT_THAT</code></a> in the Assertions
        Reference.</p>
      <h3 id="more-string-assertions">More String Assertions</h3>
      <p>(Please read the <a href="#asserting-using-gmock-matchers">previous</a> section first if
        you haven’t.)</p>
      <p>You can use the gMock <a href="reference/matchers.md#string-matchers">string matchers</a>
        with <a href="reference/assertions.md#EXPECT_THAT"><code>EXPECT_THAT</code></a> to do more string
        comparison tricks (sub-string, prefix, suffix, regular expression, and etc). For
        example,</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">HasSubstr</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">MatchesRegex</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">ASSERT_THAT</span><span class="p">(</span><span class="n">foo_string</span><span class="p">,</span> <span class="n">HasSubstr</span><span class="p">(</span><span class="s">"needle"</span><span class="p">));</span>
  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">bar_string</span><span class="p">,</span> <span class="n">MatchesRegex</span><span class="p">(</span><span class="s">"</span><span class="se">\\</span><span class="s">w*</span><span class="se">\\</span><span class="s">d+"</span><span class="p">));</span>
</pre>
      <h3 id="windows-hresult-assertions">Windows HRESULT assertions</h3>
      <p>See <a href="reference/assertions.md#HRESULT">Windows HRESULT Assertions</a> in the
        Assertions Reference.</p>
      <h3 id="type-assertions">Type Assertions</h3>
      <p>You can call the function</p>
      <pre class="chroma"><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">StaticAssertTypeEq</span><span class="o">&lt;</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="o">&gt;</span><span class="p">();</span>
</pre>
      <p>to assert that types <code>T1</code> and <code>T2</code> are the same. The function does nothing if
        the assertion is satisfied. If the types are different, the function call will
        fail to compile, the compiler error message will say that <code>T1 and T2 are not the same type</code> and most
        likely (depending on the compiler) show you the actual
        values of <code>T1</code> and <code>T2</code>. This is mainly useful inside template code.</p>
      <p><strong>Caveat</strong>: When used inside a member function of a class template or a function
        template, <code>StaticAssertTypeEq&lt;T1, T2&gt;()</code> is effective only if the function is
        instantiated. For example, given:</p>
      <pre class="chroma"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">Bar</span><span class="p">()</span> <span class="p">{</span> <span class="n">testing</span><span class="o">::</span><span class="n">StaticAssertTypeEq</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
</pre>
      <p>the code:</p>
      <pre class="chroma"><span class="kt">void</span> <span class="nf">Test1</span><span class="p">()</span> <span class="p">{</span> <span class="n">Foo</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">foo</span><span class="p">;</span> <span class="p">}</span>
</pre>
      <p>will not generate a compiler error, as <code>Foo&lt;bool&gt;::Bar()</code> is never actually
        instantiated. Instead, you need:</p>
      <pre class="chroma"><span class="kt">void</span> <span class="nf">Test2</span><span class="p">()</span> <span class="p">{</span> <span class="n">Foo</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">foo</span><span class="p">;</span> <span class="n">foo</span><span class="p">.</span><span class="n">Bar</span><span class="p">();</span> <span class="p">}</span>
</pre>
      <p>to cause a compiler error.</p>
      <h3 id="assertion-placement">Assertion Placement</h3>
      <p>You can use assertions in any C++ function. In particular, it doesn’t have to be
        a method of the test fixture class. The one constraint is that assertions that
        generate a fatal failure (<code>FAIL*</code> and <code>ASSERT_*</code>) can only be used in
        void-returning functions. This is a consequence of Google’s not using
        exceptions. By placing it in a non-void function you’ll get a confusing compile
        error like <code>"error: void value not ignored as it ought to be"</code> or
        <code>"cannot initialize return object of type 'bool' with an rvalue of type 'void'"</code>
        or
        <code>"error: no viable conversion from 'void' to 'string'"</code>.
      </p>
      <p>If you need to use fatal assertions in a function that returns non-void, one
        option is to make the function return the value in an out parameter instead. For
        example, you can rewrite <code>T2 Foo(T1 x)</code> to <code>void Foo(T1 x, T2* result)</code>. You
        need to make sure that <code>*result</code> contains some sensible value even when the
        function returns prematurely. As the function now returns <code>void</code>, you can use
        any assertion inside of it.</p>
      <p>If changing the function’s type is not an option, you should just use assertions
        that generate non-fatal failures, such as <code>ADD_FAILURE*</code> and <code>EXPECT_*</code>.</p>
      <p>{: .callout .note}
        NOTE: Constructors and destructors are not considered void-returning functions,
        according to the C++ language specification, and so you may not use fatal
        assertions in them; you’ll get a compilation error if you try. Instead, either
        call <code>abort</code> and crash the entire test executable, or put the fatal assertion in
        a <code>SetUp</code>/<code>TearDown</code> function; see
        <a href="#googletest-faq#CtorVsSetUp">constructor/destructor vs. <code>SetUp</code>/<code>TearDown</code></a>
      </p>
      <p>{: .callout .warning}
        WARNING: A fatal assertion in a helper function (private void-returning method)
        called from a constructor or destructor does not terminate the current test, as
        your intuition might suggest: it merely returns from the constructor or
        destructor early, possibly leaving your object in a partially-constructed or
        partially-destructed state! You almost certainly want to <code>abort</code> or use
        <code>SetUp</code>/<code>TearDown</code> instead.
      </p>
      <h2 id="skipping-test-execution">Skipping test execution</h2>
      <p>Related to the assertions <code>SUCCEED()</code> and <code>FAIL()</code>, you can prevent further test
        execution at runtime with the <code>GTEST_SKIP()</code> macro. This is useful when you need
        to check for preconditions of the system under test during runtime and skip
        tests in a meaningful way.</p>
      <p><code>GTEST_SKIP()</code> can be used in individual test cases or in the <code>SetUp()</code> methods
        of classes derived from either <code>::testing::Environment</code> or <code>::testing::Test</code>.
        For example:</p>
      <pre class="chroma"><span class="n">TEST</span><span class="p">(</span><span class="n">SkipTest</span><span class="p">,</span> <span class="n">DoesSkip</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">GTEST_SKIP</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"Skipping single test"</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>  <span class="c1">// Won't fail; it won't be executed
</span><span class="c1"></span><span class="p">}</span>

<span class="k">class</span> <span class="nc">SkipFixture</span> <span class="o">:</span> <span class="k">public</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">SetUp</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span>
    <span class="n">GTEST_SKIP</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"Skipping all tests for this fixture"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Tests for SkipFixture won't be executed.
</span><span class="c1"></span><span class="n">TEST_F</span><span class="p">(</span><span class="n">SkipFixture</span><span class="p">,</span> <span class="n">SkipsOneTest</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>  <span class="c1">// Won't fail
</span><span class="c1"></span><span class="p">}</span>
</pre>
      <p>As with assertion macros, you can stream a custom message into <code>GTEST_SKIP()</code>.</p>
      <h2 id="teaching-googletest-how-to-print-your-values">Teaching GoogleTest How to Print Your Values</h2>
      <p>When a test assertion such as <code>EXPECT_EQ</code> fails, GoogleTest prints the argument
        values to help you debug. It does this using a user-extensible value printer.</p>
      <p>This printer knows how to print built-in C++ types, native arrays, STL
        containers, and any type that supports the <code>&lt;&lt;</code> operator. For other types, it
        prints the raw bytes in the value and hopes that you the user can figure it out.</p>
      <p>As mentioned earlier, the printer is <em>extensible</em>. That means you can teach it
        to do a better job at printing your particular type than to dump the bytes. To
        do that, define an <code>AbslStringify()</code> overload as a <code>friend</code> function template
        for your type:</p>
      <pre class="chroma"><span class="k">namespace</span> <span class="n">foo</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">Point</span> <span class="p">{</span>  <span class="c1">// We want GoogleTest to be able to print instances of this.
</span><span class="c1"></span>  <span class="p">...</span>
  <span class="c1">// Provide a friend overload.
</span><span class="c1"></span>  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Sink</span><span class="o">&gt;</span>
  <span class="k">friend</span> <span class="kt">void</span> <span class="n">AbslStringify</span><span class="p">(</span><span class="n">Sink</span><span class="o">&amp;</span> <span class="n">sink</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span><span class="o">&amp;</span> <span class="n">point</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">absl</span><span class="o">::</span><span class="n">Format</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sink</span><span class="p">,</span> <span class="s">"(%d, %d)"</span><span class="p">,</span> <span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// If you can't declare the function in the class it's important that the
</span><span class="c1">// AbslStringify overload is defined in the SAME namespace that defines Point.
</span><span class="c1">// C++'s look-up rules rely on that.
</span><span class="c1"></span><span class="k">enum</span> <span class="k">class</span> <span class="nc">EnumWithStringify</span> <span class="p">{</span> <span class="n">kMany</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kChoices</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Sink</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">AbslStringify</span><span class="p">(</span><span class="n">Sink</span><span class="o">&amp;</span> <span class="n">sink</span><span class="p">,</span> <span class="n">EnumWithStringify</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">absl</span><span class="o">::</span><span class="n">Format</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sink</span><span class="p">,</span> <span class="s">"%s"</span><span class="p">,</span> <span class="n">e</span> <span class="o">==</span> <span class="n">EnumWithStringify</span><span class="o">::</span><span class="n">kMany</span> <span class="o">?</span> <span class="s">"Many"</span> <span class="o">:</span> <span class="s">"Choices"</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">}</span>  <span class="c1">// namespace foo
</span></pre>
      <p>{: .callout .note}
        Note: <code>AbslStringify()</code> utilizes a generic “sink” buffer to construct its
        string. For more information about supported operations on <code>AbslStringify()</code>’s
        sink, see go/abslstringify.</p>
      <p><code>AbslStringify()</code> can also use <code>absl::StrFormat</code>’s catch-all <code>%v</code> type
        specifier
        within its own format strings to perform type deduction. <code>Point</code> above could be
        formatted as <code>"(%v, %v)"</code> for example, and deduce the <code>int</code> values as
        <code>%d</code>.
      </p>
      <p>Sometimes, <code>AbslStringify()</code> might not be an option: your team may wish to print
        types with extra debugging information for testing purposes only. If so, you can
        instead define a <code>PrintTo()</code> function like this:</p>
      <pre class="chroma"><span class="cp">#include</span> <span class="cpf">&lt;ostream&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">namespace</span> <span class="n">foo</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">Point</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">friend</span> <span class="kt">void</span> <span class="n">PrintTo</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span><span class="o">&amp;</span> <span class="n">point</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"("</span> <span class="o">&lt;&lt;</span> <span class="n">point</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">","</span> <span class="o">&lt;&lt;</span> <span class="n">point</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="s">")"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// If you can't declare the function in the class it's important that PrintTo()
</span><span class="c1">// is defined in the SAME namespace that defines Point.  C++'s look-up rules
</span><span class="c1">// rely on that.
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">PrintTo</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span><span class="o">&amp;</span> <span class="n">point</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"("</span> <span class="o">&lt;&lt;</span> <span class="n">point</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">","</span> <span class="o">&lt;&lt;</span> <span class="n">point</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="s">")"</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">}</span>  <span class="c1">// namespace foo
</span></pre>
      <p>If you have defined both <code>AbslStringify()</code> and <code>PrintTo()</code>, the latter will be
        used by GoogleTest. This allows you to customize how the value appears in
        GoogleTest’s output without affecting code that relies on the behavior of
        <code>AbslStringify()</code>.
      </p>
      <p>If you have an existing <code>&lt;&lt;</code> operator and would like to define an
        <code>AbslStringify()</code>, the latter will be used for GoogleTest printing.
      </p>
      <p>If you want to print a value <code>x</code> using GoogleTest’s value printer yourself, just
        call <code>::testing::PrintToString(x)</code>, which returns an <code>std::string</code>:</p>
      <pre class="chroma"><span class="n">vector</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">Point</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">point_ints</span> <span class="o">=</span> <span class="n">GetPointIntVector</span><span class="p">();</span>

<span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">IsCorrectPointIntVector</span><span class="p">(</span><span class="n">point_ints</span><span class="p">))</span>
    <span class="o">&lt;&lt;</span> <span class="s">"point_ints = "</span> <span class="o">&lt;&lt;</span> <span class="n">testing</span><span class="o">::</span><span class="n">PrintToString</span><span class="p">(</span><span class="n">point_ints</span><span class="p">);</span>
</pre>
      <p>For more details regarding <code>AbslStringify()</code> and its integration with other
        libraries, see go/abslstringify.</p>
      <h2 id="death-tests">Death Tests</h2>
      <p>In many applications, there are assertions that can cause application failure if
        a condition is not met. These consistency checks, which ensure that the program
        is in a known good state, are there to fail at the earliest possible time after
        some program state is corrupted. If the assertion checks the wrong condition,
        then the program may proceed in an erroneous state, which could lead to memory
        corruption, security holes, or worse. Hence it is vitally important to test that
        such assertion statements work as expected.</p>
      <p>Since these precondition checks cause the processes to die, we call such tests
        <em>death tests</em>. More generally, any test that checks that a program terminates
        (except by throwing an exception) in an expected fashion is also a death test.
      </p>
      <p>Note that if a piece of code throws an exception, we don’t consider it “death”
        for the purpose of death tests, as the caller of the code could catch the
        exception and avoid the crash. If you want to verify exceptions thrown by your
        code, see <a href="#ExceptionAssertions">Exception Assertions</a>.</p>
      <p>If you want to test <code>EXPECT_*()/ASSERT_*()</code> failures in your test code, see
        <a href="#catching-failures">“Catching” Failures</a>.
      </p>
      <h3 id="how-to-write-a-death-test">How to Write a Death Test</h3>
      <p>GoogleTest provides assertion macros to support death tests. See
        <a href="reference/assertions.md#death">Death Assertions</a> in the Assertions Reference
        for details.
      </p>
      <p>To write a death test, simply use one of the macros inside your test function.
        For example,</p>
      <pre class="chroma"><span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">Foo</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// This death test uses a compound statement.
</span><span class="c1"></span>  <span class="n">ASSERT_DEATH</span><span class="p">({</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">Foo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
  <span class="p">},</span> <span class="s">"Error on line .* of Foo()"</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">NormalExit</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">EXPECT_EXIT</span><span class="p">(</span><span class="n">NormalExit</span><span class="p">(),</span> <span class="n">testing</span><span class="o">::</span><span class="n">ExitedWithCode</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"Success"</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">KillProcess</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">EXPECT_EXIT</span><span class="p">(</span><span class="n">KillProcess</span><span class="p">(),</span> <span class="n">testing</span><span class="o">::</span><span class="n">KilledBySignal</span><span class="p">(</span><span class="n">SIGKILL</span><span class="p">),</span>
              <span class="s">"Sending myself unblockable signal"</span><span class="p">);</span>
<span class="p">}</span>
</pre>
      <p>verifies that:</p>
      <ul>
        <li>calling <code>Foo(5)</code> causes the process to die with the given error message,</li>
        <li>calling <code>NormalExit()</code> causes the process to print <code>"Success"</code> to stderr and
          exit with exit code 0, and</li>
        <li>calling <code>KillProcess()</code> kills the process with signal <code>SIGKILL</code>.</li>
      </ul>
      <p>The test function body may contain other assertions and statements as well, if
        necessary.</p>
      <p>Note that a death test only cares about three things:</p>
      <ol>
        <li>does <code>statement</code> abort or exit the process?</li>
        <li>(in the case of <code>ASSERT_EXIT</code> and <code>EXPECT_EXIT</code>) does the exit status
          satisfy <code>predicate</code>? Or (in the case of <code>ASSERT_DEATH</code> and <code>EXPECT_DEATH</code>)
          is the exit status non-zero? And</li>
        <li>does the stderr output match <code>matcher</code>?</li>
      </ol>
      <p>In particular, if <code>statement</code> generates an <code>ASSERT_*</code> or <code>EXPECT_*</code> failure,
        it
        will <strong>not</strong> cause the death test to fail, as GoogleTest assertions don’t abort
        the process.</p>
      <h3 id="death-test-naming">Death Test Naming</h3>
      <p>{: .callout .important}
        IMPORTANT: We strongly recommend you to follow the convention of naming your
        <strong>test suite</strong> (not test) <code>*DeathTest</code> when it contains a death test, as
        demonstrated in the above example. The
        <a href="#death-tests-and-threads">Death Tests And Threads</a> section below explains why.
      </p>
      <p>If a test fixture class is shared by normal tests and death tests, you can use
        <code>using</code> or <code>typedef</code> to introduce an alias for the fixture class and avoid
        duplicating its code:
      </p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>

<span class="k">using</span> <span class="n">FooDeathTest</span> <span class="o">=</span> <span class="n">FooTest</span><span class="p">;</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">DoesThis</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// normal test
</span><span class="c1"></span><span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooDeathTest</span><span class="p">,</span> <span class="n">DoesThat</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// death test
</span><span class="c1"></span><span class="p">}</span>
</pre>
      <h3 id="regular-expression-syntax">Regular Expression Syntax</h3>
      <p>When built with Bazel and using Abseil, GoogleTest uses the
        <a href="https://github.com/google/re2/wiki/Syntax">RE2</a> syntax. Otherwise, for POSIX
        systems (Linux, Cygwin, Mac), GoogleTest uses the
        <a href="https://www.opengroup.org/onlinepubs/009695399/basedefs/xbd_chap09.html#tag_09_04">POSIX extended
          regular expression</a>
        syntax. To learn about POSIX syntax, you may want to read this
        <a href="https://en.wikipedia.org/wiki/Regular_expression#POSIX_extended">Wikipedia entry</a>.
      </p>
      <p>On Windows, GoogleTest uses its own simple regular expression implementation. It
        lacks many features. For example, we don’t support union (<code>"x|y"</code>), grouping
        (<code>"(xy)"</code>), brackets (<code>"[xy]"</code>), and repetition count
        (<code>"x{5,7}"</code>), among
        others. Below is what we do support (<code>A</code> denotes a literal character, period
        (<code>.</code>), or a single <code>\\ </code> escape sequence; <code>x</code> and <code>y</code> denote regular
        expressions.):</p>
      <table>
        <thead>
          <tr>
            <th>Expression</th>
            <th>Meaning</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>c</code></td>
            <td>matches any literal character <code>c</code></td>
          </tr>
          <tr>
            <td><code>\\d</code></td>
            <td>matches any decimal digit</td>
          </tr>
          <tr>
            <td><code>\\D</code></td>
            <td>matches any character that’s not a decimal digit</td>
          </tr>
          <tr>
            <td><code>\\f</code></td>
            <td>matches <code>\f</code></td>
          </tr>
          <tr>
            <td><code>\\n</code></td>
            <td>matches <code>\n</code></td>
          </tr>
          <tr>
            <td><code>\\r</code></td>
            <td>matches <code>\r</code></td>
          </tr>
          <tr>
            <td><code>\\s</code></td>
            <td>matches any ASCII whitespace, including <code>\n</code></td>
          </tr>
          <tr>
            <td><code>\\S</code></td>
            <td>matches any character that’s not a whitespace</td>
          </tr>
          <tr>
            <td><code>\\t</code></td>
            <td>matches <code>\t</code></td>
          </tr>
          <tr>
            <td><code>\\v</code></td>
            <td>matches <code>\v</code></td>
          </tr>
          <tr>
            <td><code>\\w</code></td>
            <td>matches any letter, <code>_</code>, or decimal digit</td>
          </tr>
          <tr>
            <td><code>\\W</code></td>
            <td>matches any character that <code>\\w</code> doesn’t match</td>
          </tr>
          <tr>
            <td><code>\\c</code></td>
            <td>matches any literal character <code>c</code>, which must be a punctuation</td>
          </tr>
          <tr>
            <td><code>.</code></td>
            <td>matches any single character except <code>\n</code></td>
          </tr>
          <tr>
            <td><code>A?</code></td>
            <td>matches 0 or 1 occurrences of <code>A</code></td>
          </tr>
          <tr>
            <td><code>A*</code></td>
            <td>matches 0 or many occurrences of <code>A</code></td>
          </tr>
          <tr>
            <td><code>A+</code></td>
            <td>matches 1 or many occurrences of <code>A</code></td>
          </tr>
          <tr>
            <td><code>^</code></td>
            <td>matches the beginning of a string (not that of each line)</td>
          </tr>
          <tr>
            <td><code>$</code></td>
            <td>matches the end of a string (not that of each line)</td>
          </tr>
          <tr>
            <td><code>xy</code></td>
            <td>matches <code>x</code> followed by <code>y</code></td>
          </tr>
        </tbody>
      </table>
      <p>To help you determine which capability is available on your system, GoogleTest
        defines macros to govern which regular expression it is using. The macros are:
        <code>GTEST_USES_SIMPLE_RE=1</code> or <code>GTEST_USES_POSIX_RE=1</code>. If you want your death
        tests to work in all cases, you can either <code>#if</code> on these macros or use the more
        limited syntax only.
      </p>
      <h3 id="how-it-works">How It Works</h3>
      <p>See <a href="reference/assertions.md#death">Death Assertions</a> in the Assertions
        Reference.</p>
      <h3 id="death-tests-and-threads">Death Tests And Threads</h3>
      <p>The reason for the two death test styles has to do with thread safety. Due to
        well-known problems with forking in the presence of threads, death tests should
        be run in a single-threaded context. Sometimes, however, it isn’t feasible to
        arrange that kind of environment. For example, statically-initialized modules
        may start threads before main is ever reached. Once threads have been created,
        it may be difficult or impossible to clean them up.</p>
      <p>GoogleTest has three features intended to raise awareness of threading issues.</p>
      <ol>
        <li>A warning is emitted if multiple threads are running when a death test is
          encountered.</li>
        <li>Test suites with a name ending in “DeathTest” are run before all other
          tests.</li>
        <li>It uses <code>clone()</code> instead of <code>fork()</code> to spawn the child process on Linux
          (<code>clone()</code> is not available on Cygwin and Mac), as <code>fork()</code> is more likely
          to cause the child to hang when the parent process has multiple threads.</li>
      </ol>
      <p>It’s perfectly fine to create threads inside a death test statement; they are
        executed in a separate process and cannot affect the parent.</p>
      <h3 id="death-test-styles">Death Test Styles</h3>
      <p>The “threadsafe” death test style was introduced in order to help mitigate the
        risks of testing in a possibly multithreaded environment. It trades increased
        test execution time (potentially dramatically so) for improved thread safety.</p>
      <p>The automated testing framework does not set the style flag. You can choose a
        particular style of death tests by setting the flag programmatically:</p>
      <pre class="chroma"><span class="n">GTEST_FLAG_SET</span><span class="p">(</span><span class="n">death_test_style</span><span class="p">,</span> <span class="s">"threadsafe"</span><span class="p">);</span>
</pre>
      <p>You can do this in <code>main()</code> to set the style for all death tests in the binary,
        or in individual tests. Recall that flags are saved before running each test and
        restored afterwards, so you need not do that yourself. For example:</p>
      <pre class="chroma"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">testing</span><span class="o">::</span><span class="n">InitGoogleTest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="n">GTEST_FLAG_SET</span><span class="p">(</span><span class="n">death_test_style</span><span class="p">,</span> <span class="s">"fast"</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">RUN_ALL_TESTS</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">TestOne</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">GTEST_FLAG_SET</span><span class="p">(</span><span class="n">death_test_style</span><span class="p">,</span> <span class="s">"threadsafe"</span><span class="p">);</span>
  <span class="c1">// This test is run in the "threadsafe" style:
</span><span class="c1"></span>  <span class="n">ASSERT_DEATH</span><span class="p">(</span><span class="n">ThisShouldDie</span><span class="p">(),</span> <span class="s">""</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">TestTwo</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// This test is run in the "fast" style:
</span><span class="c1"></span>  <span class="n">ASSERT_DEATH</span><span class="p">(</span><span class="n">ThisShouldDie</span><span class="p">(),</span> <span class="s">""</span><span class="p">);</span>
<span class="p">}</span>
</pre>
      <h3 id="caveats">Caveats</h3>
      <p>The <code>statement</code> argument of <code>ASSERT_EXIT()</code> can be any valid C++ statement. If
        it leaves the current function via a <code>return</code> statement or by throwing an
        exception, the death test is considered to have failed. Some GoogleTest macros
        may return from the current function (e.g. <code>ASSERT_TRUE()</code>), so be sure to avoid
        them in <code>statement</code>.</p>
      <p>Since <code>statement</code> runs in the child process, any in-memory side effect (e.g.
        modifying a variable, releasing memory, etc) it causes will <em>not</em> be observable
        in the parent process. In particular, if you release memory in a death test,
        your program will fail the heap check as the parent process will never see the
        memory reclaimed. To solve this problem, you can</p>
      <ol>
        <li>try not to free memory in a death test;</li>
        <li>free the memory again in the parent process; or</li>
        <li>do not use the heap checker in your program.</li>
      </ol>
      <p>Due to an implementation detail, you cannot place multiple death test assertions
        on the same line; otherwise, compilation will fail with an unobvious error
        message.</p>
      <p>Despite the improved thread safety afforded by the “threadsafe” style of death
        test, thread problems such as deadlock are still possible in the presence of
        handlers registered with <code>pthread_atfork(3)</code>.</p>
      <h2 id="using-assertions-in-sub-routines">Using Assertions in Sub-routines</h2>
      <p>{: .callout .note}
        Note: If you want to put a series of test assertions in a subroutine to check
        for a complex condition, consider using
        <a href="#gmock-cookbook#NewMatchers">a custom GMock matcher</a> instead. This lets you
        provide a more readable error message in case of failure and avoid all of the
        issues described below.
      </p>
      <h3 id="adding-traces-to-assertions">Adding Traces to Assertions</h3>
      <p>If a test sub-routine is called from several places, when an assertion inside it
        fails, it can be hard to tell which invocation of the sub-routine the failure is
        from. You can alleviate this problem using extra logging or custom failure
        messages, but that usually clutters up your tests. A better solution is to use
        the <code>SCOPED_TRACE</code> macro or the <code>ScopedTrace</code> utility:</p>
      <pre class="chroma"><span class="n">SCOPED_TRACE</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</pre>
      <pre class="chroma"><span class="n">ScopedTrace</span> <span class="nf">trace</span><span class="p">(</span><span class="s">"file_path"</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
</pre>
      <p>where <code>message</code> can be anything streamable to <code>std::ostream</code>. <code>SCOPED_TRACE</code>
        macro will cause the current file name, line number, and the given message to be
        added in every failure message. <code>ScopedTrace</code> accepts explicit file name and
        line number in arguments, which is useful for writing test helpers. The effect
        will be undone when the control leaves the current lexical scope.</p>
      <p>For example,</p>
      <pre class="chroma"><span class="mi">10</span><span class="o">:</span> <span class="kt">void</span> <span class="n">Sub1</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
<span class="mi">11</span><span class="o">:</span>   <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">Bar</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
<span class="mi">12</span><span class="o">:</span>   <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">Bar</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
<span class="mi">13</span><span class="o">:</span> <span class="p">}</span>
<span class="mi">14</span><span class="o">:</span>
<span class="mi">15</span><span class="o">:</span> <span class="n">TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Bar</span><span class="p">)</span> <span class="p">{</span>
<span class="mi">16</span><span class="o">:</span>   <span class="p">{</span>
<span class="mi">17</span><span class="o">:</span>     <span class="n">SCOPED_TRACE</span><span class="p">(</span><span class="s">"A"</span><span class="p">);</span>  <span class="c1">// This trace point will be included in
</span><span class="c1"></span><span class="mi">18</span><span class="o">:</span>                         <span class="c1">// every failure in this scope.
</span><span class="c1"></span><span class="mi">19</span><span class="o">:</span>     <span class="n">Sub1</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="mi">20</span><span class="o">:</span>   <span class="p">}</span>
<span class="mi">21</span><span class="o">:</span>   <span class="c1">// Now it won't.
</span><span class="c1"></span><span class="mi">22</span><span class="o">:</span>   <span class="n">Sub1</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span>
<span class="mi">23</span><span class="o">:</span> <span class="p">}</span>
</pre>
      <p>could result in messages like these:</p>
      <pre><code class="language-none">path/to/foo_test.cc:11: Failure
Value of: Bar(n)
Expected: 1
  Actual: 2
Google Test trace:
path/to/foo_test.cc:17: A

path/to/foo_test.cc:12: Failure
Value of: Bar(n + 1)
Expected: 2
  Actual: 3
</code></pre>
      <p>Without the trace, it would’ve been difficult to know which invocation of
        <code>Sub1()</code> the two failures come from respectively. (You could add an extra
        message to each assertion in <code>Sub1()</code> to indicate the value of <code>n</code>, but that’s
        tedious.)
      </p>
      <p>Some tips on using <code>SCOPED_TRACE</code>:</p>
      <ol>
        <li>With a suitable message, it’s often enough to use <code>SCOPED_TRACE</code> at the
          beginning of a sub-routine, instead of at each call site.</li>
        <li>When calling sub-routines inside a loop, make the loop iterator part of the
          message in <code>SCOPED_TRACE</code> such that you can know which iteration the failure
          is from.</li>
        <li>Sometimes the line number of the trace point is enough for identifying the
          particular invocation of a sub-routine. In this case, you don’t have to
          choose a unique message for <code>SCOPED_TRACE</code>. You can simply use <code>""</code>.</li>
        <li>You can use <code>SCOPED_TRACE</code> in an inner scope when there is one in the outer
          scope. In this case, all active trace points will be included in the failure
          messages, in reverse order they are encountered.</li>
        <li>The trace dump is clickable in Emacs - hit <code>return</code> on a line number and
          you’ll be taken to that line in the source file!</li>
      </ol>
      <h3 id="propagating-fatal-failures">Propagating Fatal Failures</h3>
      <p>A common pitfall when using <code>ASSERT_*</code> and <code>FAIL*</code> is not understanding that
        when they fail they only abort the <em>current function</em>, not the entire test. For
        example, the following test will segfault:</p>
      <pre class="chroma"><span class="kt">void</span> <span class="nf">Subroutine</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generates a fatal failure and aborts the current function.
</span><span class="c1"></span>  <span class="n">ASSERT_EQ</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

  <span class="c1">// The following won't be executed.
</span><span class="c1"></span>  <span class="p">...</span>
<span class="p">}</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Bar</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Subroutine</span><span class="p">();</span>  <span class="c1">// The intended behavior is for the fatal failure
</span><span class="c1"></span>                 <span class="c1">// in Subroutine() to abort the entire test.
</span><span class="c1"></span>
  <span class="c1">// The actual behavior: the function goes on after Subroutine() returns.
</span><span class="c1"></span>  <span class="kt">int</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
  <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1">// Segfault!
</span><span class="c1"></span><span class="p">}</span>
</pre>
      <p>To alleviate this, GoogleTest provides three different solutions. You could use
        either exceptions, the <code>(ASSERT|EXPECT)_NO_FATAL_FAILURE</code> assertions or the
        <code>HasFatalFailure()</code> function. They are described in the following two
        subsections.
      </p>
      <h4 id="asserting-on-subroutines-with-an-exception">Asserting on Subroutines with an exception</h4>
      <p>The following code can turn ASSERT-failure into an exception:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">ThrowListener</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">EmptyTestEventListener</span> <span class="p">{</span>
  <span class="kt">void</span> <span class="nf">OnTestPartResult</span><span class="p">(</span><span class="k">const</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestPartResult</span><span class="o">&amp;</span> <span class="n">result</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestPartResult</span><span class="o">::</span><span class="n">kFatalFailure</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="n">testing</span><span class="o">::</span><span class="n">AssertionException</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="n">testing</span><span class="o">::</span><span class="n">UnitTest</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">listeners</span><span class="p">().</span><span class="n">Append</span><span class="p">(</span><span class="k">new</span> <span class="n">ThrowListener</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">RUN_ALL_TESTS</span><span class="p">();</span>
<span class="p">}</span>
</pre>
      <p>This listener should be added after other listeners if you have any, otherwise
        they won’t see failed <code>OnTestPartResult</code>.</p>
      <h4 id="asserting-on-subroutines">Asserting on Subroutines</h4>
      <p>As shown above, if your test calls a subroutine that has an <code>ASSERT_*</code> failure
        in it, the test will continue after the subroutine returns. This may not be what
        you want.</p>
      <p>Often people want fatal failures to propagate like exceptions. For that
        GoogleTest offers the following macros:</p>
      <table>
        <thead>
          <tr>
            <th>Fatal assertion</th>
            <th>Nonfatal assertion</th>
            <th>Verifies</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>ASSERT_NO_FATAL_FAILURE(statement);</code></td>
            <td><code>EXPECT_NO_FATAL_FAILURE(statement);</code></td>
            <td><code>statement</code> doesn’t generate any new fatal failures in the current thread.</td>
          </tr>
        </tbody>
      </table>
      <p>Only failures in the thread that executes the assertion are checked to determine
        the result of this type of assertions. If <code>statement</code> creates new threads,
        failures in these threads are ignored.</p>
      <p>Examples:</p>
      <pre class="chroma"><span class="n">ASSERT_NO_FATAL_FAILURE</span><span class="p">(</span><span class="n">Foo</span><span class="p">());</span>

<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="n">EXPECT_NO_FATAL_FAILURE</span><span class="p">({</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">Bar</span><span class="p">();</span>
<span class="p">});</span>
</pre>
      <p>Assertions from multiple threads are currently not supported on Windows.</p>
      <h4 id="checking-for-failures-in-the-current-test">Checking for Failures in the Current Test</h4>
      <p><code>HasFatalFailure()</code> in the <code>::testing::Test</code> class returns <code>true</code> if an
        assertion in the current test has suffered a fatal failure. This allows
        functions to catch fatal failures in a sub-routine and return early.</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">Test</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="p">...</span>
  <span class="k">static</span> <span class="kt">bool</span> <span class="n">HasFatalFailure</span><span class="p">();</span>
<span class="p">};</span>
</pre>
      <p>The typical usage, which basically simulates the behavior of a thrown exception,
        is:</p>
      <pre class="chroma"><span class="n">TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Bar</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Subroutine</span><span class="p">();</span>
  <span class="c1">// Aborts if Subroutine() had a fatal failure.
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="n">HasFatalFailure</span><span class="p">())</span> <span class="k">return</span><span class="p">;</span>

  <span class="c1">// The following won't be executed.
</span><span class="c1"></span>  <span class="p">...</span>
<span class="p">}</span>
</pre>
      <p>If <code>HasFatalFailure()</code> is used outside of <code>TEST()</code> , <code>TEST_F()</code> , or a test
        fixture, you must add the <code>::testing::Test::</code> prefix, as in:</p>
      <pre class="chroma"><span class="k">if</span> <span class="p">(</span><span class="n">testing</span><span class="o">::</span><span class="n">Test</span><span class="o">::</span><span class="n">HasFatalFailure</span><span class="p">())</span> <span class="k">return</span><span class="p">;</span>
</pre>
      <p>Similarly, <code>HasNonfatalFailure()</code> returns <code>true</code> if the current test has at
        least one non-fatal failure, and <code>HasFailure()</code> returns <code>true</code> if the current
        test has at least one failure of either kind.</p>
      <h2 id="logging-additional-information">Logging Additional Information</h2>
      <p>In your test code, you can call <code>RecordProperty("key", value)</code> to log additional
        information, where <code>value</code> can be either a string or an <code>int</code>. The <em>last</em> value
        recorded for a key will be emitted to the
        <a href="#generating-an-xml-report">XML output</a> if you specify one. For example, the
        test
      </p>
      <pre class="chroma"><span class="n">TEST_F</span><span class="p">(</span><span class="n">WidgetUsageTest</span><span class="p">,</span> <span class="n">MinAndMaxWidgets</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">RecordProperty</span><span class="p">(</span><span class="s">"MaximumWidgets"</span><span class="p">,</span> <span class="n">ComputeMaxUsage</span><span class="p">());</span>
  <span class="n">RecordProperty</span><span class="p">(</span><span class="s">"MinimumWidgets"</span><span class="p">,</span> <span class="n">ComputeMinUsage</span><span class="p">());</span>
<span class="p">}</span>
</pre>
      <p>will output XML like this:</p>
      <pre class="chroma">  ...
    <span class="nt">&lt;testcase</span> <span class="na">name=</span><span class="s">"MinAndMaxWidgets"</span> <span class="na">file=</span><span class="s">"test.cpp"</span> <span class="na">line=</span><span class="s">"1"</span> <span class="na">status=</span><span class="s">"run"</span> <span class="na">time=</span><span class="s">"0.006"</span> <span class="na">classname=</span><span class="s">"WidgetUsageTest"</span> <span class="na">MaximumWidgets=</span><span class="s">"12"</span> <span class="na">MinimumWidgets=</span><span class="s">"9"</span> <span class="nt">/&gt;</span>
  ...
</pre>
      <p>{: .callout .note}</p>
      <blockquote>
        <p>NOTE:</p>
        <ul>
          <li><code>RecordProperty()</code> is a static member of the <code>Test</code> class. Therefore it
            needs to be prefixed with <code>::testing::Test::</code> if used outside of the
            <code>TEST</code> body and the test fixture class.
          </li>
          <li><em><code>key</code></em> must be a valid XML attribute name, and cannot conflict with the
            ones already used by GoogleTest (<code>name</code>, <code>status</code>, <code>time</code>,
            <code>classname</code>,
            <code>type_param</code>, and <code>value_param</code>).
          </li>
          <li>Calling <code>RecordProperty()</code> outside of the lifespan of a test is allowed.
            If it’s called outside of a test but between a test suite’s
            <code>SetUpTestSuite()</code> and <code>TearDownTestSuite()</code> methods, it will be
            attributed to the XML element for the test suite. If it’s called outside
            of all test suites (e.g. in a test environment), it will be attributed to
            the top-level XML element.
          </li>
        </ul>
      </blockquote>
      <h2 id="sharing-resources-between-tests-in-the-same-test-suite">Sharing Resources Between Tests in the Same Test
        Suite</h2>
      <p>GoogleTest creates a new test fixture object for each test in order to make
        tests independent and easier to debug. However, sometimes tests use resources
        that are expensive to set up, making the one-copy-per-test model prohibitively
        expensive.</p>
      <p>If the tests don’t change the resource, there’s no harm in their sharing a
        single resource copy. So, in addition to per-test set-up/tear-down, GoogleTest
        also supports per-test-suite set-up/tear-down. To use it:</p>
      <ol>
        <li>In your test fixture class (say <code>FooTest</code> ), declare as <code>static</code> some member
          variables to hold the shared resources.</li>
        <li>Outside your test fixture class (typically just below it), define those
          member variables, optionally giving them initial values.</li>
        <li>In the same test fixture class, define a public member function <code>static void SetUpTestSuite()</code>
          (remember not to spell it as <strong><code>SetupTestSuite</code></strong> with a
          small <code>u</code>!) to set up the shared resources and a <code>static void TearDownTestSuite()</code>
          function to tear them down.</li>
      </ol>
      <p>That’s it! GoogleTest automatically calls <code>SetUpTestSuite()</code> before running the
        <em>first test</em> in the <code>FooTest</code> test suite (i.e. before creating the first
        <code>FooTest</code> object), and calls <code>TearDownTestSuite()</code> after running the <em>last test</em>
        in it (i.e. after deleting the last <code>FooTest</code> object). In between, the tests can
        use the shared resources.
      </p>
      <p>Remember that the test order is undefined, so your code can’t depend on a test
        preceding or following another. Also, the tests must either not modify the state
        of any shared resource, or, if they do modify the state, they must restore the
        state to its original value before passing control to the next test.</p>
      <p>Note that <code>SetUpTestSuite()</code> may be called multiple times for a test fixture
        class that has derived classes, so you should not expect code in the function
        body to be run only once. Also, derived classes still have access to shared
        resources defined as static members, so careful consideration is needed when
        managing shared resources to avoid memory leaks if shared resources are not
        properly cleaned up in <code>TearDownTestSuite()</code>.</p>
      <p>Here’s an example of per-test-suite set-up and tear-down:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
  <span class="c1">// Per-test-suite set-up.
</span><span class="c1"></span>  <span class="c1">// Called before the first test in this test suite.
</span><span class="c1"></span>  <span class="c1">// Can be omitted if not needed.
</span><span class="c1"></span>  <span class="k">static</span> <span class="kt">void</span> <span class="n">SetUpTestSuite</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">shared_resource_</span> <span class="o">=</span> <span class="k">new</span> <span class="p">...;</span>

    <span class="c1">// If `shared_resource_` is **not deleted** in `TearDownTestSuite()`,
</span><span class="c1"></span>    <span class="c1">// reallocation should be prevented because `SetUpTestSuite()` may be called
</span><span class="c1"></span>    <span class="c1">// in subclasses of FooTest and lead to memory leak.
</span><span class="c1"></span>    <span class="c1">//
</span><span class="c1"></span>    <span class="c1">// if (shared_resource_ == nullptr) {
</span><span class="c1"></span>    <span class="c1">//   shared_resource_ = new ...;
</span><span class="c1"></span>    <span class="c1">// }
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="c1">// Per-test-suite tear-down.
</span><span class="c1"></span>  <span class="c1">// Called after the last test in this test suite.
</span><span class="c1"></span>  <span class="c1">// Can be omitted if not needed.
</span><span class="c1"></span>  <span class="k">static</span> <span class="kt">void</span> <span class="nf">TearDownTestSuite</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">delete</span> <span class="n">shared_resource_</span><span class="p">;</span>
    <span class="n">shared_resource_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// You can define per-test set-up logic as usual.
</span><span class="c1"></span>  <span class="kt">void</span> <span class="nf">SetUp</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

  <span class="c1">// You can define per-test tear-down logic as usual.
</span><span class="c1"></span>  <span class="kt">void</span> <span class="nf">TearDown</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

  <span class="c1">// Some expensive resource shared by all tests.
</span><span class="c1"></span>  <span class="k">static</span> <span class="n">T</span><span class="o">*</span> <span class="n">shared_resource_</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">T</span><span class="o">*</span> <span class="n">FooTest</span><span class="o">::</span><span class="n">shared_resource_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Test1</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span> <span class="n">you</span> <span class="n">can</span> <span class="n">refer</span> <span class="n">to</span> <span class="n">shared_resource_</span> <span class="n">here</span> <span class="p">...</span>
<span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Test2</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span> <span class="n">you</span> <span class="n">can</span> <span class="n">refer</span> <span class="n">to</span> <span class="n">shared_resource_</span> <span class="n">here</span> <span class="p">...</span>
<span class="p">}</span>
</pre>
      <p>{: .callout .note}
        NOTE: Though the above code declares <code>SetUpTestSuite()</code> protected, it may
        sometimes be necessary to declare it public, such as when using it with
        <code>TEST_P</code>.
      </p>
      <h2 id="global-set-up-and-tear-down">Global Set-Up and Tear-Down</h2>
      <p>Just as you can do set-up and tear-down at the test level and the test suite
        level, you can also do it at the test program level. Here’s how.</p>
      <p>First, you subclass the <code>::testing::Environment</code> class to define a test
        environment, which knows how to set-up and tear-down:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">Environment</span> <span class="o">:</span> <span class="k">public</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Environment</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="o">~</span><span class="n">Environment</span><span class="p">()</span> <span class="k">override</span> <span class="p">{}</span>

  <span class="c1">// Override this to define how to set up the environment.
</span><span class="c1"></span>  <span class="kt">void</span> <span class="nf">SetUp</span><span class="p">()</span> <span class="k">override</span> <span class="p">{}</span>

  <span class="c1">// Override this to define how to tear down the environment.
</span><span class="c1"></span>  <span class="kt">void</span> <span class="nf">TearDown</span><span class="p">()</span> <span class="k">override</span> <span class="p">{}</span>
<span class="p">};</span>
</pre>
      <p>Then, you register an instance of your environment class with GoogleTest by
        calling the <code>::testing::AddGlobalTestEnvironment()</code> function:</p>
      <pre class="chroma"><span class="n">Environment</span><span class="o">*</span> <span class="nf">AddGlobalTestEnvironment</span><span class="p">(</span><span class="n">Environment</span><span class="o">*</span> <span class="n">env</span><span class="p">);</span>
</pre>
      <p>Now, when <code>RUN_ALL_TESTS()</code> is invoked, it first calls the <code>SetUp()</code> method. The
        tests are then executed, provided that none of the environments have reported
        fatal failures and <code>GTEST_SKIP()</code> has not been invoked. Finally, <code>TearDown()</code> is
        called.</p>
      <p>Note that <code>SetUp()</code> and <code>TearDown()</code> are only invoked if there is at least one
        test to be performed. Importantly, <code>TearDown()</code> is executed even if the test is
        not run due to a fatal failure or <code>GTEST_SKIP()</code>.</p>
      <p>Calling <code>SetUp()</code> and <code>TearDown()</code> for each iteration depends on the flag
        <code>gtest_recreate_environments_when_repeating</code>. <code>SetUp()</code> and <code>TearDown()</code> are
        called for each environment object when the object is recreated for each
        iteration. However, if test environments are not recreated for each iteration,
        <code>SetUp()</code> is called only on the first iteration, and <code>TearDown()</code> is called only
        on the last iteration.
      </p>
      <p>It’s OK to register multiple environment objects. In this suite, their <code>SetUp()</code>
        will be called in the order they are registered, and their <code>TearDown()</code> will be
        called in the reverse order.</p>
      <p>Note that GoogleTest takes ownership of the registered environment objects.
        Therefore <strong>do not delete them</strong> by yourself.</p>
      <p>You should call <code>AddGlobalTestEnvironment()</code> before <code>RUN_ALL_TESTS()</code> is called,
        probably in <code>main()</code>. If you use <code>gtest_main</code>, you need to call this before
        <code>main()</code> starts for it to take effect. One way to do this is to define a global
        variable like this:
      </p>
      <pre class="chroma"><span class="n">testing</span><span class="o">::</span><span class="n">Environment</span><span class="o">*</span> <span class="k">const</span> <span class="n">foo_env</span> <span class="o">=</span>
    <span class="n">testing</span><span class="o">::</span><span class="n">AddGlobalTestEnvironment</span><span class="p">(</span><span class="k">new</span> <span class="n">FooEnvironment</span><span class="p">);</span>
</pre>
      <p>However, we strongly recommend you to write your own <code>main()</code> and call
        <code>AddGlobalTestEnvironment()</code> there, as relying on initialization of global
        variables makes the code harder to read and may cause problems when you register
        multiple environments from different translation units and the environments have
        dependencies among them (remember that the compiler doesn’t guarantee the order
        in which global variables from different translation units are initialized).
      </p>
      <h2 id="value-parameterized-tests">Value-Parameterized Tests</h2>
      <p><em>Value-parameterized tests</em> allow you to test your code with different
        parameters without writing multiple copies of the same test. This is useful in a
        number of situations, for example:</p>
      <ul>
        <li>You have a piece of code whose behavior is affected by one or more
          command-line flags. You want to make sure your code performs correctly for
          various values of those flags.</li>
        <li>You want to test different implementations of an OO interface.</li>
        <li>You want to test your code over various inputs (a.k.a. data-driven testing).
          This feature is easy to abuse, so please exercise your good sense when doing
          it!</li>
      </ul>
      <h3 id="how-to-write-value-parameterized-tests">How to Write Value-Parameterized Tests</h3>
      <p>To write value-parameterized tests, first you should define a fixture class. It
        must be derived from both <code>testing::Test</code> and <code>testing::WithParamInterface&lt;T&gt;</code>
        (the latter is a pure interface), where <code>T</code> is the type of your parameter
        values. For convenience, you can just derive the fixture class from
        <code>testing::TestWithParam&lt;T&gt;</code>, which itself is derived from both <code>testing::Test</code>
        and <code>testing::WithParamInterface&lt;T&gt;</code>. <code>T</code> can be any copyable type. If it’s a
        raw pointer, you are responsible for managing the lifespan of the pointed
        values.
      </p>
      <p>{: .callout .note}
        NOTE: If your test fixture defines <code>SetUpTestSuite()</code> or <code>TearDownTestSuite()</code>
        they must be declared <strong>public</strong> rather than <strong>protected</strong> in order to use
        <code>TEST_P</code>.
      </p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span>
    <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestWithParam</span><span class="o">&lt;</span><span class="n">absl</span><span class="o">::</span><span class="n">string_view</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="c1">// You can implement all the usual fixture class members here.
</span><span class="c1"></span>  <span class="c1">// To access the test parameter, call GetParam() from class
</span><span class="c1"></span>  <span class="c1">// TestWithParam&lt;T&gt;.
</span><span class="c1"></span><span class="p">};</span>

<span class="c1">// Or, when you want to add parameters to a pre-existing fixture class:
</span><span class="c1"></span><span class="k">class</span> <span class="nc">BaseTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">BarTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BaseTest</span><span class="p">,</span>
                <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">WithParamInterface</span><span class="o">&lt;</span><span class="n">absl</span><span class="o">::</span><span class="n">string_view</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">};</span>
</pre>
      <p>Then, use the <code>TEST_P</code> macro to define as many test patterns using this fixture
        as you want. The <code>_P</code> suffix is for “parameterized” or “pattern”, whichever you
        prefer to think.</p>
      <pre class="chroma"><span class="n">TEST_P</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">DoesBlah</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Inside a test, access the test parameter with the GetParam() method
</span><span class="c1"></span>  <span class="c1">// of the TestWithParam&lt;T&gt; class:
</span><span class="c1"></span>  <span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">Blah</span><span class="p">(</span><span class="n">GetParam</span><span class="p">()));</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="n">TEST_P</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">HasBlahBlah</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre>
      <p>Finally, you can use the <code>INSTANTIATE_TEST_SUITE_P</code> macro to instantiate the
        test suite with any set of parameters you want. GoogleTest defines a number of
        functions for generating test parameters—see details at
        <a href="reference/testing.md#INSTANTIATE_TEST_SUITE_P"><code>INSTANTIATE_TEST_SUITE_P</code></a> in
        the Testing Reference.
      </p>
      <p>For example, the following statement will instantiate tests from the <code>FooTest</code>
        test suite each with parameter values <code>"meeny"</code>, <code>"miny"</code>, and
        <code>"moe"</code> using the
        <a href="reference/testing.md#param-generators"><code>Values</code></a> parameter generator:
      </p>
      <pre class="chroma"><span class="n">INSTANTIATE_TEST_SUITE_P</span><span class="p">(</span><span class="n">MeenyMinyMoe</span><span class="p">,</span>
                         <span class="n">FooTest</span><span class="p">,</span>
                         <span class="n">testing</span><span class="o">::</span><span class="n">Values</span><span class="p">(</span><span class="s">"meeny"</span><span class="p">,</span> <span class="s">"miny"</span><span class="p">,</span> <span class="s">"moe"</span><span class="p">));</span>
</pre>
      <p>{: .callout .note}
        NOTE: The code above must be placed at global or namespace scope, not at
        function scope.</p>
      <p>The first argument to <code>INSTANTIATE_TEST_SUITE_P</code> is a unique name for the
        instantiation of the test suite. The next argument is the name of the test
        pattern, and the last is the
        <a href="reference/testing.md#param-generators">parameter generator</a>.
      </p>
      <p>The parameter generator expression is not evaluated until GoogleTest is
        initialized (via <code>InitGoogleTest()</code>). Any prior initialization done in the
        <code>main</code> function will be accessible from the parameter generator, for example,
        the results of flag parsing.
      </p>
      <p>You can instantiate a test pattern more than once, so to distinguish different
        instances of the pattern, the instantiation name is added as a prefix to the
        actual test suite name. Remember to pick unique prefixes for different
        instantiations. The tests from the instantiation above will have these names:</p>
      <ul>
        <li><code>MeenyMinyMoe/FooTest.DoesBlah/0</code> for <code>"meeny"</code></li>
        <li><code>MeenyMinyMoe/FooTest.DoesBlah/1</code> for <code>"miny"</code></li>
        <li><code>MeenyMinyMoe/FooTest.DoesBlah/2</code> for <code>"moe"</code></li>
        <li><code>MeenyMinyMoe/FooTest.HasBlahBlah/0</code> for <code>"meeny"</code></li>
        <li><code>MeenyMinyMoe/FooTest.HasBlahBlah/1</code> for <code>"miny"</code></li>
        <li><code>MeenyMinyMoe/FooTest.HasBlahBlah/2</code> for <code>"moe"</code></li>
      </ul>
      <p>You can use these names in <a href="#running-a-subset-of-the-tests"><code>--gtest_filter</code></a>.</p>
      <p>The following statement will instantiate all tests from <code>FooTest</code> again, each
        with parameter values <code>"cat"</code> and <code>"dog"</code> using the
        <a href="reference/testing.md#param-generators"><code>ValuesIn</code></a> parameter generator:
      </p>
      <pre class="chroma"><span class="k">constexpr</span> <span class="n">absl</span><span class="o">::</span><span class="n">string_view</span> <span class="n">kPets</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"cat"</span><span class="p">,</span> <span class="s">"dog"</span><span class="p">};</span>
<span class="n">INSTANTIATE_TEST_SUITE_P</span><span class="p">(</span><span class="n">Pets</span><span class="p">,</span> <span class="n">FooTest</span><span class="p">,</span> <span class="n">testing</span><span class="o">::</span><span class="n">ValuesIn</span><span class="p">(</span><span class="n">kPets</span><span class="p">));</span>
</pre>
      <p>The tests from the instantiation above will have these names:</p>
      <ul>
        <li><code>Pets/FooTest.DoesBlah/0</code> for <code>"cat"</code></li>
        <li><code>Pets/FooTest.DoesBlah/1</code> for <code>"dog"</code></li>
        <li><code>Pets/FooTest.HasBlahBlah/0</code> for <code>"cat"</code></li>
        <li><code>Pets/FooTest.HasBlahBlah/1</code> for <code>"dog"</code></li>
      </ul>
      <p>Please note that <code>INSTANTIATE_TEST_SUITE_P</code> will instantiate <em>all</em> tests in the
        given test suite, whether their definitions come before or <em>after</em> the
        <code>INSTANTIATE_TEST_SUITE_P</code> statement.
      </p>
      <p>Additionally, by default, every <code>TEST_P</code> without a corresponding
        <code>INSTANTIATE_TEST_SUITE_P</code> causes a failing test in test suite
        <code>GoogleTestVerification</code>. If you have a test suite where that omission is not an
        error, for example it is in a library that may be linked in for other reasons or
        where the list of test cases is dynamic and may be empty, then this check can be
        suppressed by tagging the test suite:
      </p>
      <pre class="chroma"><span class="n">GTEST_ALLOW_UNINSTANTIATED_PARAMETERIZED_TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">);</span>
</pre>
      <p>You can see <a href="https://github.com/google/googletest/blob/main/googletest/samples/sample7_unittest.cc" title="Parameterized Test example">sample7_unittest.cc</a> and <a href="https://github.com/google/googletest/blob/main/googletest/samples/sample8_unittest.cc" title="Parameterized Test example with multiple parameters">sample8_unittest.cc</a> for more examples.</p>
      <h3 id="creating-value-parameterized-abstract-tests">Creating Value-Parameterized Abstract Tests</h3>
      <p>In the above, we define and instantiate <code>FooTest</code> in the <em>same</em> source file.
        Sometimes you may want to define value-parameterized tests in a library and let
        other people instantiate them later. This pattern is known as <em>abstract tests</em>.
        As an example of its application, when you are designing an interface you can
        write a standard suite of abstract tests (perhaps using a factory function as
        the test parameter) that all implementations of the interface are expected to
        pass. When someone implements the interface, they can instantiate your suite to
        get all the interface-conformance tests for free.</p>
      <p>To define abstract tests, you should organize your code like this:</p>
      <ol>
        <li>Put the definition of the parameterized test fixture class (e.g. <code>FooTest</code>)
          in a header file, say <code>foo_param_test.h</code>. Think of this as <em>declaring</em> your
          abstract tests.</li>
        <li>Put the <code>TEST_P</code> definitions in <code>foo_param_test.cc</code>, which includes
          <code>foo_param_test.h</code>. Think of this as <em>implementing</em> your abstract tests.
        </li>
      </ol>
      <p>Once they are defined, you can instantiate them by including <code>foo_param_test.h</code>,
        invoking <code>INSTANTIATE_TEST_SUITE_P()</code>, and depending on the library target that
        contains <code>foo_param_test.cc</code>. You can instantiate the same abstract test suite
        multiple times, possibly in different source files.</p>
      <h3 id="specifying-names-for-value-parameterized-test-parameters">Specifying Names for Value-Parameterized Test
        Parameters</h3>
      <p>The optional last argument to <code>INSTANTIATE_TEST_SUITE_P()</code> allows the user to
        specify a function or functor that generates custom test name suffixes based on
        the test parameters. The function should accept one argument of type
        <code>testing::TestParamInfo&lt;class ParamType&gt;</code>, and return <code>std::string</code>.
      </p>
      <p><code>testing::PrintToStringParamName</code> is a builtin test suffix generator that
        returns the value of <code>testing::PrintToString(GetParam())</code>. It does not work for
        <code>std::string</code> or C strings.
      </p>
      <p>{: .callout .note}
        NOTE: test names must be non-empty, unique, and may only contain ASCII
        alphanumeric characters. In particular, they
        <a href="#googletest-faq#why-should-test-suite-names-and-test-names-not-contain-underscore">should not contain
          underscores</a>
      </p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">MyTestSuite</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestWithParam</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="p">{};</span>

<span class="n">TEST_P</span><span class="p">(</span><span class="n">MyTestSuite</span><span class="p">,</span> <span class="n">MyTest</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Example Test Param: "</span> <span class="o">&lt;&lt;</span> <span class="n">GetParam</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">INSTANTIATE_TEST_SUITE_P</span><span class="p">(</span><span class="n">MyGroup</span><span class="p">,</span> <span class="n">MyTestSuite</span><span class="p">,</span> <span class="n">testing</span><span class="o">::</span><span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                         <span class="n">testing</span><span class="o">::</span><span class="n">PrintToStringParamName</span><span class="p">());</span>
</pre>
      <p>Providing a custom functor allows for more control over test parameter name
        generation, especially for types where the automatic conversion does not
        generate helpful parameter names (e.g. strings as demonstrated above). The
        following example illustrates this for multiple parameters, an enumeration type
        and a string, and also demonstrates how to combine generators. It uses a lambda
        for conciseness:</p>
      <pre class="chroma"><span class="k">enum</span> <span class="k">class</span> <span class="nc">MyType</span> <span class="p">{</span> <span class="n">MY_FOO</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MY_BAR</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">};</span>

<span class="k">class</span> <span class="nc">MyTestSuite</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestWithParam</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">tuple</span><span class="o">&lt;</span><span class="n">MyType</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
<span class="p">};</span>

<span class="n">INSTANTIATE_TEST_SUITE_P</span><span class="p">(</span>
    <span class="n">MyGroup</span><span class="p">,</span> <span class="n">MyTestSuite</span><span class="p">,</span>
    <span class="n">testing</span><span class="o">::</span><span class="n">Combine</span><span class="p">(</span>
        <span class="n">testing</span><span class="o">::</span><span class="n">Values</span><span class="p">(</span><span class="n">MyType</span><span class="o">::</span><span class="n">MY_FOO</span><span class="p">,</span> <span class="n">MyType</span><span class="o">::</span><span class="n">MY_BAR</span><span class="p">),</span>
        <span class="n">testing</span><span class="o">::</span><span class="n">Values</span><span class="p">(</span><span class="s">"A"</span><span class="p">,</span> <span class="s">"B"</span><span class="p">)),</span>
    <span class="p">[](</span><span class="k">const</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestParamInfo</span><span class="o">&lt;</span><span class="n">MyTestSuite</span><span class="o">::</span><span class="n">ParamType</span><span class="o">&gt;&amp;</span> <span class="n">info</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span> <span class="o">=</span> <span class="n">absl</span><span class="o">::</span><span class="n">StrCat</span><span class="p">(</span>
          <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="n">MyType</span><span class="o">::</span><span class="n">MY_FOO</span> <span class="o">?</span> <span class="s">"Foo"</span> <span class="o">:</span> <span class="s">"Bar"</span><span class="p">,</span>
          <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">param</span><span class="p">));</span>
      <span class="n">absl</span><span class="o">::</span><span class="n">c_replace_if</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[](</span><span class="kt">char</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="n">std</span><span class="o">::</span><span class="n">isalnum</span><span class="p">(</span><span class="n">c</span><span class="p">);</span> <span class="p">},</span> <span class="sc">'_'</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">name</span><span class="p">;</span>
    <span class="p">});</span>
</pre>
      <h2 id="typed-tests">Typed Tests</h2>
      <p>Suppose you have multiple implementations of the same interface and want to make
        sure that all of them satisfy some common requirements. Or, you may have defined
        several types that are supposed to conform to the same “concept” and you want to
        verify it. In both cases, you want the same test logic repeated for different
        types.</p>
      <p>While you can write one <code>TEST</code> or <code>TEST_F</code> for each type you want to test (and
        you may even factor the test logic into a function template that you invoke from
        the <code>TEST</code>), it’s tedious and doesn’t scale: if you want <code>m</code> tests over <code>n</code>
        types, you’ll end up writing <code>m*n</code> <code>TEST</code>s.</p>
      <p><em>Typed tests</em> allow you to repeat the same test logic over a list of types. You
        only need to write the test logic once, although you must know the type list
        when writing typed tests. Here’s how you do it:</p>
      <p>First, define a fixture class template. It should be parameterized by a type.
        Remember to derive it from <code>::testing::Test</code>:</p>
      <pre class="chroma"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="p">...</span>
  <span class="k">using</span> <span class="n">List</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="k">static</span> <span class="n">T</span> <span class="n">shared_</span><span class="p">;</span>
  <span class="n">T</span> <span class="n">value_</span><span class="p">;</span>
<span class="p">};</span>
</pre>
      <p>Next, associate a list of types with the test suite, which will be repeated for
        each type in the list:</p>
      <pre class="chroma"><span class="k">using</span> <span class="n">MyTypes</span> <span class="o">=</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Types</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="n">TYPED_TEST_SUITE</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">MyTypes</span><span class="p">);</span>
</pre>
      <p>The type alias (<code>using</code> or <code>typedef</code>) is necessary for the <code>TYPED_TEST_SUITE</code>
        macro to parse correctly. Otherwise the compiler will think that each comma in
        the type list introduces a new macro argument.</p>
      <p>Then, use <code>TYPED_TEST()</code> instead of <code>TEST_F()</code> to define a typed test for this
        test suite. You can repeat this as many times as you want:</p>
      <pre class="chroma"><span class="n">TYPED_TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">DoesBlah</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Inside a test, refer to the special name TypeParam to get the type
</span><span class="c1"></span>  <span class="c1">// parameter.  Since we are inside a derived class template, C++ requires
</span><span class="c1"></span>  <span class="c1">// us to visit the members of FooTest via 'this'.
</span><span class="c1"></span>  <span class="n">TypeParam</span> <span class="n">n</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">value_</span><span class="p">;</span>

  <span class="c1">// To visit static members of the fixture, add the 'TestFixture::'
</span><span class="c1"></span>  <span class="c1">// prefix.
</span><span class="c1"></span>  <span class="n">n</span> <span class="o">+=</span> <span class="n">TestFixture</span><span class="o">::</span><span class="n">shared_</span><span class="p">;</span>

  <span class="c1">// To refer to typedefs in the fixture, add the 'typename TestFixture::'
</span><span class="c1"></span>  <span class="c1">// prefix.  The 'typename' is required to satisfy the compiler.
</span><span class="c1"></span>  <span class="k">typename</span> <span class="n">TestFixture</span><span class="o">::</span><span class="n">List</span> <span class="n">values</span><span class="p">;</span>

  <span class="n">values</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="n">TYPED_TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">HasPropertyA</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre>
      <p>You can see <a href="https://github.com/google/googletest/blob/main/googletest/samples/sample6_unittest.cc" title="Typed Test example">sample6_unittest.cc</a> for a complete example.</p>
      <h2 id="type-parameterized-tests">Type-Parameterized Tests</h2>
      <p><em>Type-parameterized tests</em> are like typed tests, except that they don’t require
        you to know the list of types ahead of time. Instead, you can define the test
        logic first and instantiate it with different type lists later. You can even
        instantiate it more than once in the same program.</p>
      <p>If you are designing an interface or concept, you can define a suite of
        type-parameterized tests to verify properties that any valid implementation of
        the interface/concept should have. Then, the author of each implementation can
        just instantiate the test suite with their type to verify that it conforms to
        the requirements, without having to write similar tests repeatedly. Here’s an
        example:</p>
      <p>First, define a fixture class template, as we did with typed tests:</p>
      <pre class="chroma"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
  <span class="kt">void</span> <span class="nf">DoSomethingInteresting</span><span class="p">();</span>
  <span class="p">...</span>
<span class="p">};</span>
</pre>
      <p>Next, declare that you will define a type-parameterized test suite:</p>
      <pre class="chroma"><span class="n">TYPED_TEST_SUITE_P</span><span class="p">(</span><span class="n">FooTest</span><span class="p">);</span>
</pre>
      <p>Then, use <code>TYPED_TEST_P()</code> to define a type-parameterized test. You can repeat
        this as many times as you want:</p>
      <pre class="chroma"><span class="n">TYPED_TEST_P</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">DoesBlah</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Inside a test, refer to TypeParam to get the type parameter.
</span><span class="c1"></span>  <span class="n">TypeParam</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// You will need to use `this` explicitly to refer to fixture members.
</span><span class="c1"></span>  <span class="k">this</span><span class="o">-&gt;</span><span class="n">DoSomethingInteresting</span><span class="p">()</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="n">TYPED_TEST_P</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">HasPropertyA</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre>
      <p>Now the tricky part: you need to register all test patterns using the
        <code>REGISTER_TYPED_TEST_SUITE_P</code> macro before you can instantiate them. The first
        argument of the macro is the test suite name; the rest are the names of the
        tests in this test suite:
      </p>
      <pre class="chroma"><span class="n">REGISTER_TYPED_TEST_SUITE_P</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span>
                            <span class="n">DoesBlah</span><span class="p">,</span> <span class="n">HasPropertyA</span><span class="p">);</span>
</pre>
      <p>Finally, you are free to instantiate the pattern with the types you want. If you
        put the above code in a header file, you can <code>#include</code> it in multiple C++
        source files and instantiate it multiple times.</p>
      <pre class="chroma"><span class="k">using</span> <span class="n">MyTypes</span> <span class="o">=</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Types</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="n">INSTANTIATE_TYPED_TEST_SUITE_P</span><span class="p">(</span><span class="n">My</span><span class="p">,</span> <span class="n">FooTest</span><span class="p">,</span> <span class="n">MyTypes</span><span class="p">);</span>
</pre>
      <p>To distinguish different instances of the pattern, the first argument to the
        <code>INSTANTIATE_TYPED_TEST_SUITE_P</code> macro is a prefix that will be added to the
        actual test suite name. Remember to pick unique prefixes for different
        instances.
      </p>
      <p>In the special case where the type list contains only one type, you can write
        that type directly without <code>::testing::Types&lt;...&gt;</code>, like this:</p>
      <pre class="chroma"><span class="n">INSTANTIATE_TYPED_TEST_SUITE_P</span><span class="p">(</span><span class="n">My</span><span class="p">,</span> <span class="n">FooTest</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
</pre>
      <p>You can see <a href="https://github.com/google/googletest/blob/main/googletest/samples/sample6_unittest.cc" title="Typed Test example">sample6_unittest.cc</a> for a complete example.</p>
      <h2 id="testing-private-code">Testing Private Code</h2>
      <p>If you change your software’s internal implementation, your tests should not
        break as long as the change is not observable by users. Therefore, <strong>per the
          black-box testing principle, most of the time you should test your code through
          its public interfaces.</strong></p>
      <p><strong>If you still find yourself needing to test internal implementation code,
          consider if there’s a better design.</strong> The desire to test internal
        implementation is often a sign that the class is doing too much. Consider
        extracting an implementation class, and testing it. Then use that implementation
        class in the original class.</p>
      <p>If you absolutely have to test non-public interface code though, you can. There
        are two cases to consider:</p>
      <ul>
        <li>Static functions ( <em>not</em> the same as static member functions!) or unnamed
          namespaces, and</li>
        <li>Private or protected class members</li>
      </ul>
      <p>To test them, we use the following special techniques:</p>
      <ul>
        <li>
          <p>Both static functions and definitions/declarations in an unnamed namespace
            are only visible within the same translation unit. To test them, you can
            <code>#include</code> the entire <code>.cc</code> file being tested in your <code>*_test.cc</code> file.
            (#including <code>.cc</code> files is not a good way to reuse code - you should not do
            this in production code!)
          </p>
          <p>However, a better approach is to move the private code into the
            <code>foo::internal</code> namespace, where <code>foo</code> is the namespace your project
            normally uses, and put the private declarations in a <code>*-internal.h</code> file.
            Your production <code>.cc</code> files and your tests are allowed to include this
            internal header, but your clients are not. This way, you can fully test your
            internal implementation without leaking it to your clients.
          </p>
        </li>
        <li>
          <p>Private class members are only accessible from within the class or by
            friends. To access a class' private members, you can declare your test
            fixture as a friend to the class and define accessors in your fixture. Tests
            using the fixture can then access the private members of your production
            class via the accessors in the fixture. Note that even though your fixture
            is a friend to your production class, your tests are not automatically
            friends to it, as they are technically defined in sub-classes of the
            fixture.</p>
          <p>Another way to test private members is to refactor them into an
            implementation class, which is then declared in a <code>*-internal.h</code> file. Your
            clients aren’t allowed to include this header but your tests can. Such is
            called the
            <a href="https://www.gamedev.net/articles/programming/general-and-gameplay-programming/the-c-pimpl-r1794/">Pimpl</a>
            (Private Implementation) idiom.
          </p>
          <p>Or, you can declare an individual test as a friend of your class by adding
            this line in the class body:</p>
          <pre class="chroma">    <span class="n">FRIEND_TEST</span><span class="p">(</span><span class="n">TestSuiteName</span><span class="p">,</span> <span class="n">TestName</span><span class="p">);</span>
</pre>
          <p>For example,</p>
          <pre class="chroma"><span class="c1">// foo.h
</span><span class="c1"></span><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="p">...</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">FRIEND_TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">BarReturnsZeroOnNull</span><span class="p">);</span>

  <span class="kt">int</span> <span class="nf">Bar</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">x</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// foo_test.cc
</span><span class="c1"></span><span class="p">...</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">BarReturnsZeroOnNull</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Foo</span> <span class="n">foo</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">Bar</span><span class="p">(</span><span class="nb">NULL</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>  <span class="c1">// Uses Foo's private member Bar().
</span><span class="c1"></span><span class="p">}</span>
</pre>
          <p>Pay special attention when your class is defined in a namespace. If you want
            your test fixtures and tests to be friends of your class, then they must be
            defined in the exact same namespace (no anonymous or inline namespaces).</p>
          <p>For example, if the code to be tested looks like:</p>
          <pre class="chroma"><span class="k">namespace</span> <span class="n">my_namespace</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span> <span class="nc">FooTest</span><span class="p">;</span>
  <span class="n">FRIEND_TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Bar</span><span class="p">);</span>
  <span class="n">FRIEND_TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Baz</span><span class="p">);</span>
  <span class="p">...</span> <span class="n">definition</span> <span class="n">of</span> <span class="n">the</span> <span class="k">class</span> <span class="nc">Foo</span> <span class="p">...</span>
<span class="p">};</span>

<span class="p">}</span>  <span class="c1">// namespace my_namespace
</span></pre>
          <p>Your test code should be something like:</p>
          <pre class="chroma"><span class="k">namespace</span> <span class="n">my_namespace</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
  <span class="p">...</span>
<span class="p">};</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Bar</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Baz</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="p">}</span>  <span class="c1">// namespace my_namespace
</span></pre>
        </li>
      </ul>
      <h2 id="catching-failures">“Catching” Failures</h2>
      <p>If you are building a testing utility on top of GoogleTest, you’ll want to test
        your utility. What framework would you use to test it? GoogleTest, of course.</p>
      <p>The challenge is to verify that your testing utility reports failures correctly.
        In frameworks that report a failure by throwing an exception, you could catch
        the exception and assert on it. But GoogleTest doesn’t use exceptions, so how do
        we test that a piece of code generates an expected failure?</p>
      <p><code>"gtest/gtest-spi.h"</code> contains some constructs to do this.
        After #including this header, you can use</p>
      <pre class="chroma">  <span class="n">EXPECT_FATAL_FAILURE</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">substring</span><span class="p">);</span>
</pre>
      <p>to assert that <code>statement</code> generates a fatal (e.g. <code>ASSERT_*</code>) failure in the
        current thread whose message contains the given <code>substring</code>, or use</p>
      <pre class="chroma">  <span class="n">EXPECT_NONFATAL_FAILURE</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">substring</span><span class="p">);</span>
</pre>
      <p>if you are expecting a non-fatal (e.g. <code>EXPECT_*</code>) failure.</p>
      <p>Only failures in the current thread are checked to determine the result of this
        type of expectations. If <code>statement</code> creates new threads, failures in these
        threads are also ignored. If you want to catch failures in other threads as
        well, use one of the following macros instead:</p>
      <pre class="chroma">  <span class="n">EXPECT_FATAL_FAILURE_ON_ALL_THREADS</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">substring</span><span class="p">);</span>
  <span class="n">EXPECT_NONFATAL_FAILURE_ON_ALL_THREADS</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">substring</span><span class="p">);</span>
</pre>
      <p>{: .callout .note}
        NOTE: Assertions from multiple threads are currently not supported on Windows.</p>
      <p>For technical reasons, there are some caveats:</p>
      <ol>
        <li>
          <p>You cannot stream a failure message to either macro.</p>
        </li>
        <li>
          <p><code>statement</code> in <code>EXPECT_FATAL_FAILURE{_ON_ALL_THREADS}()</code> cannot reference
            local non-static variables or non-static members of <code>this</code> object.</p>
        </li>
        <li>
          <p><code>statement</code> in <code>EXPECT_FATAL_FAILURE{_ON_ALL_THREADS}()</code> cannot return a
            value.</p>
        </li>
      </ol>
      <h2 id="registering-tests-programmatically">Registering tests programmatically</h2>
      <p>The <code>TEST</code> macros handle the vast majority of all use cases, but there are few
        where runtime registration logic is required. For those cases, the framework
        provides the <code>::testing::RegisterTest</code> that allows callers to register arbitrary
        tests dynamically.</p>
      <p>This is an advanced API only to be used when the <code>TEST</code> macros are insufficient.
        The macros should be preferred when possible, as they avoid most of the
        complexity of calling this function.</p>
      <p>It provides the following signature:</p>
      <pre class="chroma"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Factory</span><span class="o">&gt;</span>
<span class="n">TestInfo</span><span class="o">*</span> <span class="n">RegisterTest</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">test_suite_name</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">test_name</span><span class="p">,</span>
                       <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">type_param</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">value_param</span><span class="p">,</span>
                       <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="n">Factory</span> <span class="n">factory</span><span class="p">);</span>
</pre>
      <p>The <code>factory</code> argument is a factory callable (move-constructible) object or
        function pointer that creates a new instance of the Test object. It handles
        ownership to the caller. The signature of the callable is <code>Fixture*()</code>, where
        <code>Fixture</code> is the test fixture class for the test. All tests registered with the
        same <code>test_suite_name</code> must return the same fixture type. This is checked at
        runtime.
      </p>
      <p>The framework will infer the fixture class from the factory and will call the
        <code>SetUpTestSuite</code> and <code>TearDownTestSuite</code> for it.
      </p>
      <p>Must be called before <code>RUN_ALL_TESTS()</code> is invoked, otherwise behavior is
        undefined.</p>
      <p>Use case example:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">MyFixture</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="c1">// All of these optional, just like in regular macro usage.
</span><span class="c1"></span>  <span class="k">static</span> <span class="kt">void</span> <span class="n">SetUpTestSuite</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
  <span class="k">static</span> <span class="kt">void</span> <span class="nf">TearDownTestSuite</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">SetUp</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">TearDown</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">MyFixture</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">explicit</span> <span class="n">MyTest</span><span class="p">(</span><span class="kt">int</span> <span class="n">data</span><span class="p">)</span> <span class="o">:</span> <span class="n">data_</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">void</span> <span class="nf">TestBody</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">data_</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">RegisterMyTests</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">values</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">testing</span><span class="o">::</span><span class="n">RegisterTest</span><span class="p">(</span>
        <span class="s">"MyFixture"</span><span class="p">,</span> <span class="p">(</span><span class="s">"Test"</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">v</span><span class="p">)).</span><span class="n">c_str</span><span class="p">(),</span> <span class="k">nullptr</span><span class="p">,</span>
        <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">v</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span>
        <span class="n">__FILE__</span><span class="p">,</span> <span class="n">__LINE__</span><span class="p">,</span>
        <span class="c1">// Important to use the fixture type as the return type here.
</span><span class="c1"></span>        <span class="p">[</span><span class="o">=</span><span class="p">]()</span> <span class="o">-&gt;</span> <span class="n">MyFixture</span><span class="o">*</span> <span class="p">{</span> <span class="k">return</span> <span class="k">new</span> <span class="n">MyTest</span><span class="p">(</span><span class="n">v</span><span class="p">);</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">testing</span><span class="o">::</span><span class="n">InitGoogleTest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values_to_test</span> <span class="o">=</span> <span class="n">LoadValuesFromConfig</span><span class="p">();</span>
  <span class="n">RegisterMyTests</span><span class="p">(</span><span class="n">values_to_test</span><span class="p">);</span>
  <span class="p">...</span>
  <span class="k">return</span> <span class="n">RUN_ALL_TESTS</span><span class="p">();</span>
<span class="p">}</span>
</pre>
      <h2 id="getting-the-current-tests-name">Getting the Current Test’s Name</h2>
      <p>Sometimes a function may need to know the name of the currently running test.
        For example, you may be using the <code>SetUp()</code> method of your test fixture to set
        the golden file name based on which test is running. The
        <a href="reference/testing.md#TestInfo"><code>TestInfo</code></a> class has this information.
      </p>
      <p>To obtain a <code>TestInfo</code> object for the currently running test, call
        <code>current_test_info()</code> on the <a href="reference/testing.md#UnitTest"><code>UnitTest</code></a>
        singleton object:
      </p>
      <pre class="chroma">  <span class="c1">// Gets information about the currently running test.
</span><span class="c1"></span>  <span class="c1">// Do NOT delete the returned object - it's managed by the UnitTest class.
</span><span class="c1"></span>  <span class="k">const</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestInfo</span><span class="o">*</span> <span class="k">const</span> <span class="n">test_info</span> <span class="o">=</span>
      <span class="n">testing</span><span class="o">::</span><span class="n">UnitTest</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">current_test_info</span><span class="p">();</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"We are in test %s of test suite %s.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
         <span class="n">test_info</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">(),</span>
         <span class="n">test_info</span><span class="o">-&gt;</span><span class="n">test_suite_name</span><span class="p">());</span>
</pre>
      <p><code>current_test_info()</code> returns a null pointer if no test is running. In
        particular, you cannot find the test suite name in <code>SetUpTestSuite()</code>,
        <code>TearDownTestSuite()</code> (where you know the test suite name implicitly), or
        functions called from them.
      </p>
      <h2 id="extending-googletest-by-handling-test-events">Extending GoogleTest by Handling Test Events</h2>
      <p>GoogleTest provides an <strong>event listener API</strong> to let you receive notifications
        about the progress of a test program and test failures. The events you can
        listen to include the start and end of the test program, a test suite, or a test
        method, among others. You may use this API to augment or replace the standard
        console output, replace the XML output, or provide a completely different form
        of output, such as a GUI or a database. You can also use test events as
        checkpoints to implement a resource leak checker, for example.</p>
      <h3 id="defining-event-listeners">Defining Event Listeners</h3>
      <p>To define a event listener, you subclass either
        <a href="reference/testing.md#TestEventListener"><code>testing::TestEventListener</code></a> or
        <a href="reference/testing.md#EmptyTestEventListener"><code>testing::EmptyTestEventListener</code></a>
        The former is an (abstract) interface, where <em>each pure virtual method can be
          overridden to handle a test event</em> (For example, when a test starts, the
        <code>OnTestStart()</code> method will be called.). The latter provides an empty
        implementation of all methods in the interface, such that a subclass only needs
        to override the methods it cares about.
      </p>
      <p>When an event is fired, its context is passed to the handler function as an
        argument. The following argument types are used:</p>
      <ul>
        <li>UnitTest reflects the state of the entire test program,</li>
        <li>TestSuite has information about a test suite, which can contain one or more
          tests,</li>
        <li>TestInfo contains the state of a test, and</li>
        <li>TestPartResult represents the result of a test assertion.</li>
      </ul>
      <p>An event handler function can examine the argument it receives to find out
        interesting information about the event and the test program’s state.</p>
      <p>Here’s an example:</p>
      <pre class="chroma">  <span class="k">class</span> <span class="nc">MinimalistPrinter</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">EmptyTestEventListener</span> <span class="p">{</span>
    <span class="c1">// Called before a test starts.
</span><span class="c1"></span>    <span class="kt">void</span> <span class="nf">OnTestStart</span><span class="p">(</span><span class="k">const</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestInfo</span><span class="o">&amp;</span> <span class="n">test_info</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"*** Test %s.%s starting.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
             <span class="n">test_info</span><span class="p">.</span><span class="n">test_suite_name</span><span class="p">(),</span> <span class="n">test_info</span><span class="p">.</span><span class="n">name</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="c1">// Called after a failed assertion or a SUCCESS().
</span><span class="c1"></span>    <span class="kt">void</span> <span class="nf">OnTestPartResult</span><span class="p">(</span><span class="k">const</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestPartResult</span><span class="o">&amp;</span> <span class="n">test_part_result</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"%s in %s:%d</span><span class="se">\n</span><span class="s">%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
             <span class="n">test_part_result</span><span class="p">.</span><span class="n">failed</span><span class="p">()</span> <span class="o">?</span> <span class="s">"*** Failure"</span> <span class="o">:</span> <span class="s">"Success"</span><span class="p">,</span>
             <span class="n">test_part_result</span><span class="p">.</span><span class="n">file_name</span><span class="p">(),</span>
             <span class="n">test_part_result</span><span class="p">.</span><span class="n">line_number</span><span class="p">(),</span>
             <span class="n">test_part_result</span><span class="p">.</span><span class="n">summary</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="c1">// Called after a test ends.
</span><span class="c1"></span>    <span class="kt">void</span> <span class="nf">OnTestEnd</span><span class="p">(</span><span class="k">const</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestInfo</span><span class="o">&amp;</span> <span class="n">test_info</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"*** Test %s.%s ending.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
             <span class="n">test_info</span><span class="p">.</span><span class="n">test_suite_name</span><span class="p">(),</span> <span class="n">test_info</span><span class="p">.</span><span class="n">name</span><span class="p">());</span>
    <span class="p">}</span>
  <span class="p">};</span>
</pre>
      <h3 id="using-event-listeners">Using Event Listeners</h3>
      <p>To use the event listener you have defined, add an instance of it to the
        GoogleTest event listener list (represented by class
        <a href="reference/testing.md#TestEventListeners"><code>TestEventListeners</code></a> - note the “s”
        at the end of the name) in your <code>main()</code> function, before calling
        <code>RUN_ALL_TESTS()</code>:
      </p>
      <pre class="chroma"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">testing</span><span class="o">::</span><span class="n">InitGoogleTest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="c1">// Gets hold of the event listener list.
</span><span class="c1"></span>  <span class="n">testing</span><span class="o">::</span><span class="n">TestEventListeners</span><span class="o">&amp;</span> <span class="n">listeners</span> <span class="o">=</span>
      <span class="n">testing</span><span class="o">::</span><span class="n">UnitTest</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">listeners</span><span class="p">();</span>
  <span class="c1">// Adds a listener to the end.  GoogleTest takes the ownership.
</span><span class="c1"></span>  <span class="n">listeners</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span><span class="k">new</span> <span class="n">MinimalistPrinter</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">RUN_ALL_TESTS</span><span class="p">();</span>
<span class="p">}</span>
</pre>
      <p>There’s only one problem: the default test result printer is still in effect, so
        its output will mingle with the output from your minimalist printer. To suppress
        the default printer, just release it from the event listener list and delete it.
        You can do so by adding one line:</p>
      <pre class="chroma">  <span class="p">...</span>
  <span class="k">delete</span> <span class="n">listeners</span><span class="p">.</span><span class="n">Release</span><span class="p">(</span><span class="n">listeners</span><span class="p">.</span><span class="n">default_result_printer</span><span class="p">());</span>
  <span class="n">listeners</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span><span class="k">new</span> <span class="n">MinimalistPrinter</span><span class="p">);</span>
  <span class="k">return</span> <span class="nf">RUN_ALL_TESTS</span><span class="p">();</span>
</pre>
      <p>Now, sit back and enjoy a completely different output from your tests. For more
        details, see <a href="https://github.com/google/googletest/blob/main/googletest/samples/sample9_unittest.cc" title="Event listener example">sample9_unittest.cc</a>.</p>
      <p>You may append more than one listener to the list. When an <code>On*Start()</code> or
        <code>OnTestPartResult()</code> event is fired, the listeners will receive it in the order
        they appear in the list (since new listeners are added to the end of the list,
        the default text printer and the default XML generator will receive the event
        first). An <code>On*End()</code> event will be received by the listeners in the <em>reverse</em>
        order. This allows output by listeners added later to be framed by output from
        listeners added earlier.
      </p>
      <h3 id="generating-failures-in-listeners">Generating Failures in Listeners</h3>
      <p>You may use failure-raising macros (<code>EXPECT_*()</code>, <code>ASSERT_*()</code>, <code>FAIL()</code>, etc)
        when processing an event. There are some restrictions:</p>
      <ol>
        <li>You cannot generate any failure in <code>OnTestPartResult()</code> (otherwise it will
          cause <code>OnTestPartResult()</code> to be called recursively).</li>
        <li>A listener that handles <code>OnTestPartResult()</code> is not allowed to generate any
          failure.</li>
      </ol>
      <p>When you add listeners to the listener list, you should put listeners that
        handle <code>OnTestPartResult()</code> <em>before</em> listeners that can generate failures. This
        ensures that failures generated by the latter are attributed to the right test
        by the former.</p>
      <p>See <a href="https://github.com/google/googletest/blob/main/googletest/samples/sample10_unittest.cc" title="Failure-raising listener example">sample10_unittest.cc</a> for an example of a failure-raising
        listener.</p>
      <h2 id="running-test-programs-advanced-options">Running Test Programs: Advanced Options</h2>
      <p>GoogleTest test programs are ordinary executables. Once built, you can run them
        directly and affect their behavior via the following environment variables
        and/or command line flags. For the flags to work, your programs must call
        <code>::testing::InitGoogleTest()</code> before calling <code>RUN_ALL_TESTS()</code>.
      </p>
      <p>To see a list of supported flags and their usage, please run your test program
        with the <code>--help</code> flag.</p>
      <p>If an option is specified both by an environment variable and by a flag, the
        latter takes precedence.</p>
      <h3 id="selecting-tests">Selecting Tests</h3>
      <h4 id="listing-test-names">Listing Test Names</h4>
      <p>Sometimes it is necessary to list the available tests in a program before
        running them so that a filter may be applied if needed. Including the flag
        <code>--gtest_list_tests</code> overrides all other flags and lists tests in the following
        format:
      </p>
      <pre><code class="language-none">TestSuite1.
  TestName1
  TestName2
TestSuite2.
  TestName
</code></pre>
      <p>None of the tests listed are actually run if the flag is provided. There is no
        corresponding environment variable for this flag.</p>
      <h4 id="running-a-subset-of-the-tests">Running a Subset of the Tests</h4>
      <p>By default, a GoogleTest program runs all tests the user has defined. Sometimes,
        you want to run only a subset of the tests (e.g. for debugging or quickly
        verifying a change). If you set the <code>GTEST_FILTER</code> environment variable or the
        <code>--gtest_filter</code> flag to a filter string, GoogleTest will only run the tests
        whose full names (in the form of <code>TestSuiteName.TestName</code>) match the filter.
      </p>
      <p>The format of a filter is a ‘<code>:</code>'-separated list of wildcard patterns (called
        the <em>positive patterns</em>) optionally followed by a ‘<code>-</code>’ and another
        ‘<code>:</code>'-separated pattern list (called the <em>negative patterns</em>). A test matches
        the filter if and only if it matches any of the positive patterns but does not
        match any of the negative patterns.</p>
      <p>A pattern may contain <code>'*'</code> (matches any string) or <code>'?'</code> (matches any
        single
        character). For convenience, the filter <code>'*-NegativePatterns'</code> can be also
        written as <code>'-NegativePatterns'</code>.</p>
      <p>For example:</p>
      <ul>
        <li><code>./foo_test</code> Has no flag, and thus runs all its tests.</li>
        <li><code>./foo_test --gtest_filter=*</code> Also runs everything, due to the single
          match-everything <code>*</code> value.</li>
        <li><code>./foo_test --gtest_filter=FooTest.*</code> Runs everything in test suite
          <code>FooTest</code> .
        </li>
        <li><code>./foo_test --gtest_filter=*Null*:*Constructor*</code> Runs any test whose full
          name contains either <code>"Null"</code> or <code>"Constructor"</code> .</li>
        <li><code>./foo_test --gtest_filter=-*DeathTest.*</code> Runs all non-death tests.</li>
        <li><code>./foo_test --gtest_filter=FooTest.*-FooTest.Bar</code> Runs everything in test
          suite <code>FooTest</code> except <code>FooTest.Bar</code>.</li>
        <li><code>./foo_test --gtest_filter=FooTest.*:BarTest.*-FooTest.Bar:BarTest.Foo</code> Runs
          everything in test suite <code>FooTest</code> except <code>FooTest.Bar</code> and everything in
          test suite <code>BarTest</code> except <code>BarTest.Foo</code>.</li>
      </ul>
      <h4 id="stop-test-execution-upon-first-failure">Stop test execution upon first failure</h4>
      <p>By default, a GoogleTest program runs all tests the user has defined. In some
        cases (e.g. iterative test development &amp; execution) it may be desirable stop
        test execution upon first failure (trading improved latency for completeness).
        If <code>GTEST_FAIL_FAST</code> environment variable or <code>--gtest_fail_fast</code> flag is set,
        the test runner will stop execution as soon as the first test failure is found.</p>
      <h4 id="temporarily-disabling-tests">Temporarily Disabling Tests</h4>
      <p>If you have a broken test that you cannot fix right away, you can add the
        <code>DISABLED_</code> prefix to its name. This will exclude it from execution. This is
        better than commenting out the code or using <code>#if 0</code>, as disabled tests are
        still compiled (and thus won’t rot).
      </p>
      <p>If you need to disable all tests in a test suite, you can either add <code>DISABLED_</code>
        to the front of the name of each test, or alternatively add it to the front of
        the test suite name.</p>
      <p>For example, the following tests won’t be run by GoogleTest, even though they
        will still be compiled:</p>
      <pre class="chroma"><span class="c1">// Tests that Foo does Abc.
</span><span class="c1"></span><span class="n">TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">DISABLED_DoesAbc</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="k">class</span> <span class="nc">DISABLED_BarTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>

<span class="c1">// Tests that Bar does Xyz.
</span><span class="c1"></span><span class="n">TEST_F</span><span class="p">(</span><span class="n">DISABLED_BarTest</span><span class="p">,</span> <span class="n">DoesXyz</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre>
      <p>{: .callout .note}
        NOTE: This feature should only be used for temporary pain-relief. You still have
        to fix the disabled tests at a later date. As a reminder, GoogleTest will print
        a banner warning you if a test program contains any disabled tests.</p>
      <p>{: .callout .tip}
        TIP: You can easily count the number of disabled tests you have using
        <code>grep</code>. This number can be used as a metric for
        improving your test quality.
      </p>
      <h4 id="temporarily-enabling-disabled-tests">Temporarily Enabling Disabled Tests</h4>
      <p>To include disabled tests in test execution, just invoke the test program with
        the <code>--gtest_also_run_disabled_tests</code> flag or set the
        <code>GTEST_ALSO_RUN_DISABLED_TESTS</code> environment variable to a value other than <code>0</code>.
        You can combine this with the <code>--gtest_filter</code> flag to further select which
        disabled tests to run.
      </p>
      <h3 id="repeating-the-tests">Repeating the Tests</h3>
      <p>Once in a while you’ll run into a test whose result is hit-or-miss. Perhaps it
        will fail only 1% of the time, making it rather hard to reproduce the bug under
        a debugger. This can be a major source of frustration.</p>
      <p>The <code>--gtest_repeat</code> flag allows you to repeat all (or selected) test methods in
        a program many times. Hopefully, a flaky test will eventually fail and give you
        a chance to debug. Here’s how to use it:</p>
      <pre><code class="language-none">$ foo_test --gtest_repeat=1000
Repeat foo_test 1000 times and don't stop at failures.

$ foo_test --gtest_repeat=-1
A negative count means repeating forever.

$ foo_test --gtest_repeat=1000 --gtest_break_on_failure
Repeat foo_test 1000 times, stopping at the first failure.  This
is especially useful when running under a debugger: when the test
fails, it will drop into the debugger and you can then inspect
variables and stacks.

$ foo_test --gtest_repeat=1000 --gtest_filter=FooBar.*
Repeat the tests whose name matches the filter 1000 times.
</code></pre>
      <p>If your test program contains
        <a href="#global-set-up-and-tear-down">global set-up/tear-down</a> code, it will be
        repeated in each iteration as well, as the flakiness may be in it. To avoid
        repeating global set-up/tear-down, specify
        <code>--gtest_recreate_environments_when_repeating=false</code>{.nowrap}.
      </p>
      <p>You can also specify the repeat count by setting the <code>GTEST_REPEAT</code> environment
        variable.</p>
      <h3 id="shuffling-the-tests">Shuffling the Tests</h3>
      <p>You can specify the <code>--gtest_shuffle</code> flag (or set the <code>GTEST_SHUFFLE</code>
        environment variable to <code>1</code>) to run the tests in a program in a random order.
        This helps to reveal bad dependencies between tests.</p>
      <p>By default, GoogleTest uses a random seed calculated from the current time.
        Therefore you’ll get a different order every time. The console output includes
        the random seed value, such that you can reproduce an order-related test failure
        later. To specify the random seed explicitly, use the <code>--gtest_random_seed=SEED</code>
        flag (or set the <code>GTEST_RANDOM_SEED</code> environment variable), where <code>SEED</code> is an
        integer in the range [0, 99999]. The seed value 0 is special: it tells
        GoogleTest to do the default behavior of calculating the seed from the current
        time.</p>
      <p>If you combine this with <code>--gtest_repeat=N</code>, GoogleTest will pick a different
        random seed and re-shuffle the tests in each iteration.</p>
      <h3 id="distributing-test-functions-to-multiple-machines">Distributing Test Functions to Multiple Machines</h3>
      <p>If you have more than one machine you can use to run a test program, you might
        want to run the test functions in parallel and get the result faster. We call
        this technique <em>sharding</em>, where each machine is called a <em>shard</em>.</p>
      <p>GoogleTest is compatible with test sharding. To take advantage of this feature,
        your test runner (not part of GoogleTest) needs to do the following:</p>
      <ol>
        <li>Allocate a number of machines (shards) to run the tests.</li>
        <li>On each shard, set the <code>GTEST_TOTAL_SHARDS</code> environment variable to the total
          number of shards. It must be the same for all shards.</li>
        <li>On each shard, set the <code>GTEST_SHARD_INDEX</code> environment variable to the index
          of the shard. Different shards must be assigned different indices, which
          must be in the range <code>[0, GTEST_TOTAL_SHARDS - 1]</code>.</li>
        <li>Run the same test program on all shards. When GoogleTest sees the above two
          environment variables, it will select a subset of the test functions to run.
          Across all shards, each test function in the program will be run exactly
          once.</li>
        <li>Wait for all shards to finish, then collect and report the results.</li>
      </ol>
      <p>Your project may have tests that were written without GoogleTest and thus don’t
        understand this protocol. In order for your test runner to figure out which test
        supports sharding, it can set the environment variable <code>GTEST_SHARD_STATUS_FILE</code>
        to a non-existent file path. If a test program supports sharding, it will create
        this file to acknowledge that fact; otherwise it will not create it. The actual
        contents of the file are not important at this time, although we may put some
        useful information in it in the future.</p>
      <p>Here’s an example to make it clear. Suppose you have a test program <code>foo_test</code>
        that contains the following 5 test functions:</p>
      <pre><code>TEST(A, V)
TEST(A, W)
TEST(B, X)
TEST(B, Y)
TEST(B, Z)
</code></pre>
      <p>Suppose you have 3 machines at your disposal. To run the test functions in
        parallel, you would set <code>GTEST_TOTAL_SHARDS</code> to 3 on all machines, and set
        <code>GTEST_SHARD_INDEX</code> to 0, 1, and 2 on the machines respectively. Then you would
        run the same <code>foo_test</code> on each machine.
      </p>
      <p>GoogleTest reserves the right to change how the work is distributed across the
        shards, but here’s one possible scenario:</p>
      <ul>
        <li>Machine #0 runs <code>A.V</code> and <code>B.X</code>.</li>
        <li>Machine #1 runs <code>A.W</code> and <code>B.Y</code>.</li>
        <li>Machine #2 runs <code>B.Z</code>.</li>
      </ul>
      <h3 id="controlling-test-output">Controlling Test Output</h3>
      <h4 id="colored-terminal-output">Colored Terminal Output</h4>
      <p>GoogleTest can use colors in its terminal output to make it easier to spot the
        important information:</p>
      <pre>...
<font color="green">[----------]</font> 1 test from FooTest
<font color="green">[ RUN      ]</font> FooTest.DoesAbc
<font color="green">[       OK ]</font> FooTest.DoesAbc
<font color="green">[----------]</font> 2 tests from BarTest
<font color="green">[ RUN      ]</font> BarTest.HasXyzProperty
<font color="green">[       OK ]</font> BarTest.HasXyzProperty
<font color="green">[ RUN      ]</font> BarTest.ReturnsTrueOnSuccess
... some error messages ...
<font color="red">[   FAILED ]</font> BarTest.ReturnsTrueOnSuccess
...
<font color="green">[==========]</font> 30 tests from 14 test suites ran.
<font color="green">[   PASSED ]</font> 28 tests.
<font color="red">[   FAILED ]</font> 2 tests, listed below:
<font color="red">[   FAILED ]</font> BarTest.ReturnsTrueOnSuccess
<font color="red">[   FAILED ]</font> AnotherTest.DoesXyz

 2 FAILED TESTS
</pre>
      <p>You can set the <code>GTEST_COLOR</code> environment variable or the <code>--gtest_color</code>
        command line flag to <code>yes</code>, <code>no</code>, or <code>auto</code> (the default) to enable colors,
        disable colors, or let GoogleTest decide. When the value is <code>auto</code>, GoogleTest
        will use colors if and only if the output goes to a terminal and (on non-Windows
        platforms) the <code>TERM</code> environment variable is set to <code>xterm</code> or <code>xterm-color</code>.
      </p>
      <h4 id="suppressing-test-passes">Suppressing test passes</h4>
      <p>By default, GoogleTest prints 1 line of output for each test, indicating if it
        passed or failed. To show only test failures, run the test program with
        <code>--gtest_brief=1</code>, or set the GTEST_BRIEF environment variable to <code>1</code>.
      </p>
      <h4 id="suppressing-the-elapsed-time">Suppressing the Elapsed Time</h4>
      <p>By default, GoogleTest prints the time it takes to run each test. To disable
        that, run the test program with the <code>--gtest_print_time=0</code> command line flag, or
        set the GTEST_PRINT_TIME environment variable to <code>0</code>.</p>
      <h4 id="suppressing-utf-8-text-output">Suppressing UTF-8 Text Output</h4>
      <p>In case of assertion failures, GoogleTest prints expected and actual values of
        type <code>string</code> both as hex-encoded strings as well as in readable UTF-8 text if
        they contain valid non-ASCII UTF-8 characters. If you want to suppress the UTF-8
        text because, for example, you don’t have an UTF-8 compatible output medium, run
        the test program with <code>--gtest_print_utf8=0</code> or set the <code>GTEST_PRINT_UTF8</code>
        environment variable to <code>0</code>.</p>
      <h4 id="generating-an-xml-report">Generating an XML Report</h4>
      <p>GoogleTest can emit a detailed XML report to a file in addition to its normal
        textual output. The report contains the duration of each test, and thus can help
        you identify slow tests.</p>
      <p>To generate the XML report, set the <code>GTEST_OUTPUT</code> environment variable or the
        <code>--gtest_output</code> flag to the string <code>"xml:path_to_output_file"</code>, which will
        create the file at the given location. You can also just use the string <code>"xml"</code>,
        in which case the output can be found in the <code>test_detail.xml</code> file in the
        current directory.
      </p>
      <p>If you specify a directory (for example, <code>"xml:output/directory/"</code> on Linux or
        <code>"xml:output\directory\"</code> on Windows), GoogleTest will create the XML file in
        that directory, named after the test executable (e.g. <code>foo_test.xml</code> for test
        program <code>foo_test</code> or <code>foo_test.exe</code>). If the file already exists (perhaps left
        over from a previous run), GoogleTest will pick a different name (e.g.
        <code>foo_test_1.xml</code>) to avoid overwriting it.
      </p>
      <p>The report is based on the <code>junitreport</code> Ant task. Since that format was
        originally intended for Java, a little interpretation is required to make it
        apply to GoogleTest tests, as shown here:</p>
      <pre class="chroma"><span class="nt">&lt;testsuites</span> <span class="na">name=</span><span class="s">"AllTests"</span> <span class="err">...</span><span class="nt">&gt;</span>
  <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">"test_case_name"</span> <span class="err">...</span><span class="nt">&gt;</span>
    <span class="nt">&lt;testcase</span>    <span class="na">name=</span><span class="s">"test_name"</span> <span class="err">...</span><span class="nt">&gt;</span>
      <span class="nt">&lt;failure</span> <span class="na">message=</span><span class="s">"..."</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;failure</span> <span class="na">message=</span><span class="s">"..."</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;failure</span> <span class="na">message=</span><span class="s">"..."</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/testcase&gt;</span>
  <span class="nt">&lt;/testsuite&gt;</span>
<span class="nt">&lt;/testsuites&gt;</span>
</pre>
      <ul>
        <li>The root <code>&lt;testsuites&gt;</code> element corresponds to the entire test program.</li>
        <li><code>&lt;testsuite&gt;</code> elements correspond to GoogleTest test suites.</li>
        <li><code>&lt;testcase&gt;</code> elements correspond to GoogleTest test functions.</li>
      </ul>
      <p>For instance, the following program</p>
      <pre class="chroma"><span class="n">TEST</span><span class="p">(</span><span class="n">MathTest</span><span class="p">,</span> <span class="n">Addition</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">MathTest</span><span class="p">,</span> <span class="n">Subtraction</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">LogicTest</span><span class="p">,</span> <span class="n">NonContradiction</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre>
      <p>could generate this report:</p>
      <pre class="chroma"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;testsuites</span> <span class="na">tests=</span><span class="s">"3"</span> <span class="na">failures=</span><span class="s">"1"</span> <span class="na">errors=</span><span class="s">"0"</span> <span class="na">time=</span><span class="s">"0.035"</span> <span class="na">timestamp=</span><span class="s">"2011-10-31T18:52:42"</span> <span class="na">name=</span><span class="s">"AllTests"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">"MathTest"</span> <span class="na">tests=</span><span class="s">"2"</span> <span class="na">failures=</span><span class="s">"1"</span> <span class="na">errors=</span><span class="s">"0"</span> <span class="na">time=</span><span class="s">"0.015"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;testcase</span> <span class="na">name=</span><span class="s">"Addition"</span> <span class="na">file=</span><span class="s">"test.cpp"</span> <span class="na">line=</span><span class="s">"1"</span> <span class="na">status=</span><span class="s">"run"</span> <span class="na">time=</span><span class="s">"0.007"</span> <span class="na">classname=</span><span class="s">""</span><span class="nt">&gt;</span>
      <span class="nt">&lt;failure</span> <span class="na">message=</span><span class="s">"Value of: add(1, 1)&amp;#x0A;  Actual: 3&amp;#x0A;Expected: 2"</span> <span class="na">type=</span><span class="s">""</span><span class="nt">&gt;</span>...<span class="nt">&lt;/failure&gt;</span>
      <span class="nt">&lt;failure</span> <span class="na">message=</span><span class="s">"Value of: add(1, -1)&amp;#x0A;  Actual: 1&amp;#x0A;Expected: 0"</span> <span class="na">type=</span><span class="s">""</span><span class="nt">&gt;</span>...<span class="nt">&lt;/failure&gt;</span>
    <span class="nt">&lt;/testcase&gt;</span>
    <span class="nt">&lt;testcase</span> <span class="na">name=</span><span class="s">"Subtraction"</span> <span class="na">file=</span><span class="s">"test.cpp"</span> <span class="na">line=</span><span class="s">"2"</span> <span class="na">status=</span><span class="s">"run"</span> <span class="na">time=</span><span class="s">"0.005"</span> <span class="na">classname=</span><span class="s">""</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/testcase&gt;</span>
  <span class="nt">&lt;/testsuite&gt;</span>
  <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">"LogicTest"</span> <span class="na">tests=</span><span class="s">"1"</span> <span class="na">failures=</span><span class="s">"0"</span> <span class="na">errors=</span><span class="s">"0"</span> <span class="na">time=</span><span class="s">"0.005"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;testcase</span> <span class="na">name=</span><span class="s">"NonContradiction"</span> <span class="na">file=</span><span class="s">"test.cpp"</span> <span class="na">line=</span><span class="s">"3"</span> <span class="na">status=</span><span class="s">"run"</span> <span class="na">time=</span><span class="s">"0.005"</span> <span class="na">classname=</span><span class="s">""</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/testcase&gt;</span>
  <span class="nt">&lt;/testsuite&gt;</span>
<span class="nt">&lt;/testsuites&gt;</span>
</pre>
      <p>Things to note:</p>
      <ul>
        <li>
          <p>The <code>tests</code> attribute of a <code>&lt;testsuites&gt;</code> or <code>&lt;testsuite&gt;</code>
            element tells how
            many test functions the GoogleTest program or test suite contains, while the
            <code>failures</code> attribute tells how many of them failed.
          </p>
        </li>
        <li>
          <p>The <code>time</code> attribute expresses the duration of the test, test suite, or
            entire test program in seconds.</p>
        </li>
        <li>
          <p>The <code>timestamp</code> attribute records the local date and time of the test
            execution.</p>
        </li>
        <li>
          <p>The <code>file</code> and <code>line</code> attributes record the source file location, where the
            test was defined.</p>
        </li>
        <li>
          <p>Each <code>&lt;failure&gt;</code> element corresponds to a single failed GoogleTest
            assertion.</p>
        </li>
      </ul>
      <h4 id="generating-a-json-report">Generating a JSON Report</h4>
      <p>GoogleTest can also emit a JSON report as an alternative format to XML. To
        generate the JSON report, set the <code>GTEST_OUTPUT</code> environment variable or the
        <code>--gtest_output</code> flag to the string <code>"json:path_to_output_file"</code>, which will
        create the file at the given location. You can also just use the string
        <code>"json"</code>, in which case the output can be found in the <code>test_detail.json</code> file
        in the current directory.
      </p>
      <p>The report format conforms to the following JSON Schema:</p>
      <pre class="chroma"><span class="p">{</span>
  <span class="nt">"$schema"</span><span class="p">:</span> <span class="s2">"https://json-schema.org/schema#"</span><span class="p">,</span>
  <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"object"</span><span class="p">,</span>
  <span class="nt">"definitions"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"TestCase"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"object"</span><span class="p">,</span>
      <span class="nt">"properties"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"name"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"string"</span> <span class="p">},</span>
        <span class="nt">"tests"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"integer"</span> <span class="p">},</span>
        <span class="nt">"failures"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"integer"</span> <span class="p">},</span>
        <span class="nt">"disabled"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"integer"</span> <span class="p">},</span>
        <span class="nt">"time"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"string"</span> <span class="p">},</span>
        <span class="nt">"testsuite"</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"array"</span><span class="p">,</span>
          <span class="nt">"items"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"$ref"</span><span class="p">:</span> <span class="s2">"#/definitions/TestInfo"</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">"TestInfo"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"object"</span><span class="p">,</span>
      <span class="nt">"properties"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"name"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"string"</span> <span class="p">},</span>
        <span class="nt">"file"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"string"</span> <span class="p">},</span>
        <span class="nt">"line"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"integer"</span> <span class="p">},</span>
        <span class="nt">"status"</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>
          <span class="nt">"enum"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"RUN"</span><span class="p">,</span> <span class="s2">"NOTRUN"</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">"time"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"string"</span> <span class="p">},</span>
        <span class="nt">"classname"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"string"</span> <span class="p">},</span>
        <span class="nt">"failures"</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"array"</span><span class="p">,</span>
          <span class="nt">"items"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"$ref"</span><span class="p">:</span> <span class="s2">"#/definitions/Failure"</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">"Failure"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"object"</span><span class="p">,</span>
      <span class="nt">"properties"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"failures"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"string"</span> <span class="p">},</span>
        <span class="nt">"type"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"string"</span> <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">"properties"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"tests"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"integer"</span> <span class="p">},</span>
    <span class="nt">"failures"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"integer"</span> <span class="p">},</span>
    <span class="nt">"disabled"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"integer"</span> <span class="p">},</span>
    <span class="nt">"errors"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"integer"</span> <span class="p">},</span>
    <span class="nt">"timestamp"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>
      <span class="nt">"format"</span><span class="p">:</span> <span class="s2">"date-time"</span>
    <span class="p">},</span>
    <span class="nt">"time"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"string"</span> <span class="p">},</span>
    <span class="nt">"name"</span><span class="p">:</span> <span class="p">{</span> <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"string"</span> <span class="p">},</span>
    <span class="nt">"testsuites"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"array"</span><span class="p">,</span>
      <span class="nt">"items"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"$ref"</span><span class="p">:</span> <span class="s2">"#/definitions/TestCase"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
      <p>The report uses the format that conforms to the following Proto3 using the
        <a href="https://developers.google.com/protocol-buffers/docs/proto3#json">JSON encoding</a>:
      </p>
      <pre class="chroma"><span class="n">syntax</span> <span class="o">=</span> <span class="s">"proto3"</span><span class="p">;</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="kn">package</span> <span class="nn">googletest</span><span class="p">;</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">import</span> <span class="s">"google/protobuf/timestamp.proto"</span><span class="p">;</span><span class="err">
</span><span class="err"></span><span class="k">import</span> <span class="s">"google/protobuf/duration.proto"</span><span class="p">;</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="kd">message</span> <span class="nc">UnitTest</span> <span class="p">{</span><span class="err">
</span><span class="err"></span>  <span class="kt">int32</span> <span class="n">tests</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="kt">int32</span> <span class="n">failures</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="kt">int32</span> <span class="n">disabled</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="kt">int32</span> <span class="n">errors</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="n">google.protobuf.Timestamp</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="n">google.protobuf.Duration</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="kt">string</span> <span class="n">name</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="k">repeated</span> <span class="n">TestCase</span> <span class="n">testsuites</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span><span class="err">
</span><span class="err"></span><span class="p">}</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="kd">message</span> <span class="nc">TestCase</span> <span class="p">{</span><span class="err">
</span><span class="err"></span>  <span class="kt">string</span> <span class="n">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="kt">int32</span> <span class="n">tests</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="kt">int32</span> <span class="n">failures</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="kt">int32</span> <span class="n">disabled</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="kt">int32</span> <span class="n">errors</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="n">google.protobuf.Duration</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="k">repeated</span> <span class="n">TestInfo</span> <span class="n">testsuite</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span><span class="err">
</span><span class="err"></span><span class="p">}</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="kd">message</span> <span class="nc">TestInfo</span> <span class="p">{</span><span class="err">
</span><span class="err"></span>  <span class="kt">string</span> <span class="n">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="kt">string</span> <span class="n">file</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="kt">int32</span> <span class="n">line</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="kd">enum</span> <span class="n">Status</span> <span class="p">{</span><span class="err">
</span><span class="err"></span>    <span class="n">RUN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="err">
</span><span class="err"></span>    <span class="n">NOTRUN</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="p">}</span><span class="err">
</span><span class="err"></span>  <span class="n">Status</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="n">google.protobuf.Duration</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="kt">string</span> <span class="n">classname</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="kd">message</span> <span class="nc">Failure</span> <span class="p">{</span><span class="err">
</span><span class="err"></span>    <span class="kt">string</span> <span class="n">failures</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="err">
</span><span class="err"></span>    <span class="kt">string</span> <span class="n">type</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="err">
</span><span class="err"></span>  <span class="p">}</span><span class="err">
</span><span class="err"></span>  <span class="k">repeated</span> <span class="n">Failure</span> <span class="n">failures</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span><span class="err">
</span><span class="err"></span><span class="p">}</span><span class="err">
</span></pre>
      <p>For instance, the following program</p>
      <pre class="chroma"><span class="n">TEST</span><span class="p">(</span><span class="n">MathTest</span><span class="p">,</span> <span class="n">Addition</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">MathTest</span><span class="p">,</span> <span class="n">Subtraction</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">LogicTest</span><span class="p">,</span> <span class="n">NonContradiction</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre>
      <p>could generate this report:</p>
      <pre class="chroma"><span class="p">{</span>
  <span class="nt">"tests"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="nt">"failures"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">"errors"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">"time"</span><span class="p">:</span> <span class="s2">"0.035s"</span><span class="p">,</span>
  <span class="nt">"timestamp"</span><span class="p">:</span> <span class="s2">"2011-10-31T18:52:42Z"</span><span class="p">,</span>
  <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"AllTests"</span><span class="p">,</span>
  <span class="nt">"testsuites"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"MathTest"</span><span class="p">,</span>
      <span class="nt">"tests"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="nt">"failures"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="nt">"errors"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nt">"time"</span><span class="p">:</span> <span class="s2">"0.015s"</span><span class="p">,</span>
      <span class="nt">"testsuite"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"Addition"</span><span class="p">,</span>
          <span class="nt">"file"</span><span class="p">:</span> <span class="s2">"test.cpp"</span><span class="p">,</span>
          <span class="nt">"line"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="nt">"status"</span><span class="p">:</span> <span class="s2">"RUN"</span><span class="p">,</span>
          <span class="nt">"time"</span><span class="p">:</span> <span class="s2">"0.007s"</span><span class="p">,</span>
          <span class="nt">"classname"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
          <span class="nt">"failures"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="nt">"message"</span><span class="p">:</span> <span class="s2">"Value of: add(1, 1)\n  Actual: 3\nExpected: 2"</span><span class="p">,</span>
              <span class="nt">"type"</span><span class="p">:</span> <span class="s2">""</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="nt">"message"</span><span class="p">:</span> <span class="s2">"Value of: add(1, -1)\n  Actual: 1\nExpected: 0"</span><span class="p">,</span>
              <span class="nt">"type"</span><span class="p">:</span> <span class="s2">""</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"Subtraction"</span><span class="p">,</span>
          <span class="nt">"file"</span><span class="p">:</span> <span class="s2">"test.cpp"</span><span class="p">,</span>
          <span class="nt">"line"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
          <span class="nt">"status"</span><span class="p">:</span> <span class="s2">"RUN"</span><span class="p">,</span>
          <span class="nt">"time"</span><span class="p">:</span> <span class="s2">"0.005s"</span><span class="p">,</span>
          <span class="nt">"classname"</span><span class="p">:</span> <span class="s2">""</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"LogicTest"</span><span class="p">,</span>
      <span class="nt">"tests"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="nt">"failures"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nt">"errors"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nt">"time"</span><span class="p">:</span> <span class="s2">"0.005s"</span><span class="p">,</span>
      <span class="nt">"testsuite"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"NonContradiction"</span><span class="p">,</span>
          <span class="nt">"file"</span><span class="p">:</span> <span class="s2">"test.cpp"</span><span class="p">,</span>
          <span class="nt">"line"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
          <span class="nt">"status"</span><span class="p">:</span> <span class="s2">"RUN"</span><span class="p">,</span>
          <span class="nt">"time"</span><span class="p">:</span> <span class="s2">"0.005s"</span><span class="p">,</span>
          <span class="nt">"classname"</span><span class="p">:</span> <span class="s2">""</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre>
      <p>{: .callout .important}
        IMPORTANT: The exact format of the JSON document is subject to change.</p>
      <h3 id="controlling-how-failures-are-reported">Controlling How Failures Are Reported</h3>
      <h4 id="detecting-test-premature-exit">Detecting Test Premature Exit</h4>
      <p>Google Test implements the <em>premature-exit-file</em> protocol for test runners to
        catch any kind of unexpected exits of test programs. Upon start, Google Test
        creates the file which will be automatically deleted after all work has been
        finished. Then, the test runner can check if this file exists. In case the file
        remains undeleted, the inspected test has exited prematurely.</p>
      <p>This feature is enabled only if the <code>TEST_PREMATURE_EXIT_FILE</code> environment
        variable has been set.</p>
      <h4 id="turning-assertion-failures-into-break-points">Turning Assertion Failures into Break-Points</h4>
      <p>When running test programs under a debugger, it’s very convenient if the
        debugger can catch an assertion failure and automatically drop into interactive
        mode. GoogleTest’s <em>break-on-failure</em> mode supports this behavior.</p>
      <p>To enable it, set the <code>GTEST_BREAK_ON_FAILURE</code> environment variable to a value
        other than <code>0</code>. Alternatively, you can use the <code>--gtest_break_on_failure</code>
        command line flag.</p>
      <h4 id="disabling-catching-test-thrown-exceptions">Disabling Catching Test-Thrown Exceptions</h4>
      <p>GoogleTest can be used either with or without exceptions enabled. If a test
        throws a C++ exception or (on Windows) a structured exception (SEH), by default
        GoogleTest catches it, reports it as a test failure, and continues with the next
        test method. This maximizes the coverage of a test run. Also, on Windows an
        uncaught exception will cause a pop-up window, so catching the exceptions allows
        you to run the tests automatically.</p>
      <p>When debugging the test failures, however, you may instead want the exceptions
        to be handled by the debugger, such that you can examine the call stack when an
        exception is thrown. To achieve that, set the <code>GTEST_CATCH_EXCEPTIONS</code>
        environment variable to <code>0</code>, or use the <code>--gtest_catch_exceptions=0</code> flag when
        running the tests.</p>
      <h3 id="sanitizer-integration">Sanitizer Integration</h3>
      <p>The
        <a href="https://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html">Undefined Behavior Sanitizer</a>,
        <a href="https://github.com/google/sanitizers/wiki/AddressSanitizer">Address Sanitizer</a>,
        and
        <a href="https://github.com/google/sanitizers/wiki/ThreadSanitizerCppManual">Thread Sanitizer</a>
        all provide weak functions that you can override to trigger explicit failures
        when they detect sanitizer errors, such as creating a reference from <code>nullptr</code>.
        To override these functions, place definitions for them in a source file that
        you compile as part of your main binary:
      </p>
      <pre><code>extern "C" {
void __ubsan_on_report() {
  FAIL() &lt;&lt; "Encountered an undefined behavior sanitizer error";
}
void __asan_on_error() {
  FAIL() &lt;&lt; "Encountered an address sanitizer error";
}
void __tsan_on_report() {
  FAIL() &lt;&lt; "Encountered a thread sanitizer error";
}
}  // extern "C"
</code></pre>
      <p>After compiling your project with one of the sanitizers enabled, if a particular
        test triggers a sanitizer error, GoogleTest will report that it failed.</p>
      <h1 id="gmock-for-dummies">gMock for Dummies</h1>
      <h2 id="what-is-gmock">What Is gMock?</h2>
      <p>When you write a prototype or test, often it’s not feasible or wise to rely on
        real objects entirely. A <strong>mock object</strong> implements the same interface as a real
        object (so it can be used as one), but lets you specify at run time how it will
        be used and what it should do (which methods will be called? in which order? how
        many times? with what arguments? what will they return? etc).</p>
      <p>It is easy to confuse the term <em>fake objects</em> with mock objects. Fakes and mocks
        actually mean very different things in the Test-Driven Development (TDD)
        community:</p>
      <ul>
        <li><strong>Fake</strong> objects have working implementations, but usually take some
          shortcut (perhaps to make the operations less expensive), which makes them
          not suitable for production. An in-memory file system would be an example of
          a fake.</li>
        <li><strong>Mocks</strong> are objects pre-programmed with <em>expectations</em>, which form a
          specification of the calls they are expected to receive.</li>
      </ul>
      <p>If all this seems too abstract for you, don’t worry - the most important thing
        to remember is that a mock allows you to check the <em>interaction</em> between itself
        and code that uses it. The difference between fakes and mocks shall become much
        clearer once you start to use mocks.</p>
      <p><strong>gMock</strong> is a library (sometimes we also call it a “framework” to make it sound
        cool) for creating mock classes and using them. It does to C++ what
        jMock/EasyMock does to Java (well, more or less).</p>
      <p>When using gMock,</p>
      <ol>
        <li>first, you use some simple macros to describe the interface you want to
          mock, and they will expand to the implementation of your mock class;</li>
        <li>next, you create some mock objects and specify its expectations and behavior
          using an intuitive syntax;</li>
        <li>then you exercise code that uses the mock objects. gMock will catch any
          violation to the expectations as soon as it arises.</li>
      </ol>
      <h2 id="why-gmock">Why gMock?</h2>
      <p>While mock objects help you remove unnecessary dependencies in tests and make
        them fast and reliable, using mocks manually in C++ is <em>hard</em>:</p>
      <ul>
        <li>Someone has to implement the mocks. The job is usually tedious and
          error-prone. No wonder people go great distance to avoid it.</li>
        <li>The quality of those manually written mocks is a bit, uh, unpredictable. You
          may see some really polished ones, but you may also see some that were
          hacked up in a hurry and have all sorts of ad hoc restrictions.</li>
        <li>The knowledge you gained from using one mock doesn’t transfer to the next
          one.</li>
      </ul>
      <p>In contrast, Java and Python programmers have some fine mock frameworks (jMock,
        EasyMock, etc), which automate the creation of mocks. As a result, mocking is a
        proven effective technique and widely adopted practice in those communities.
        Having the right tool absolutely makes the difference.</p>
      <p>gMock was built to help C++ programmers. It was inspired by jMock and EasyMock,
        but designed with C++’s specifics in mind. It is your friend if any of the
        following problems is bothering you:</p>
      <ul>
        <li>You are stuck with a sub-optimal design and wish you had done more
          prototyping before it was too late, but prototyping in C++ is by no means
          “rapid”.</li>
        <li>Your tests are slow as they depend on too many libraries or use expensive
          resources (e.g. a database).</li>
        <li>Your tests are brittle as some resources they use are unreliable (e.g. the
          network).</li>
        <li>You want to test how your code handles a failure (e.g. a file checksum
          error), but it’s not easy to cause one.</li>
        <li>You need to make sure that your module interacts with other modules in the
          right way, but it’s hard to observe the interaction; therefore you resort to
          observing the side effects at the end of the action, but it’s awkward at
          best.</li>
        <li>You want to “mock out” your dependencies, except that they don’t have mock
          implementations yet; and, frankly, you aren’t thrilled by some of those
          hand-written mocks.</li>
      </ul>
      <p>We encourage you to use gMock as</p>
      <ul>
        <li>a <em>design</em> tool, for it lets you experiment with your interface design early
          and often. More iterations lead to better designs!</li>
        <li>a <em>testing</em> tool to cut your tests' outbound dependencies and probe the
          interaction between your module and its collaborators.</li>
      </ul>
      <h2 id="getting-started">Getting Started</h2>
      <p>gMock is bundled with googletest.</p>
      <h2 id="a-case-for-mock-turtles">A Case for Mock Turtles</h2>
      <p>Let’s look at an example. Suppose you are developing a graphics program that
        relies on a <a href="https://en.wikipedia.org/wiki/Logo_programming_language">LOGO</a>-like
        API for drawing. How would you test that it does the right thing? Well, you can
        run it and compare the screen with a golden screen snapshot, but let’s admit it:
        tests like this are expensive to run and fragile (What if you just upgraded to a
        shiny new graphics card that has better anti-aliasing? Suddenly you have to
        update all your golden images.). It would be too painful if all your tests are
        like this. Fortunately, you learned about
        <a href="https://en.wikipedia.org/wiki/Dependency_injection">Dependency Injection</a> and know the right thing
        to do: instead of having your application talk to the system API directly, wrap
        the API in an interface (say, <code>Turtle</code>) and code to that interface:
      </p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">Turtle</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Turtle</span><span class="p">()</span> <span class="p">{}</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">PenUp</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">PenDown</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">Forward</span><span class="p">(</span><span class="kt">int</span> <span class="n">distance</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">Turn</span><span class="p">(</span><span class="kt">int</span> <span class="n">degrees</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">GoTo</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">GetX</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">GetY</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre>
      <p>(Note that the destructor of <code>Turtle</code> <strong>must</strong> be virtual, as is the case for
        <strong>all</strong> classes you intend to inherit from - otherwise the destructor of the
        derived class will not be called when you delete an object through a base
        pointer, and you’ll get corrupted program states like memory leaks.)
      </p>
      <p>You can control whether the turtle’s movement will leave a trace using <code>PenUp()</code>
        and <code>PenDown()</code>, and control its movement using <code>Forward()</code>, <code>Turn()</code>, and
        <code>GoTo()</code>. Finally, <code>GetX()</code> and <code>GetY()</code> tell you the current position of the
        turtle.
      </p>
      <p>Your program will normally use a real implementation of this interface. In
        tests, you can use a mock implementation instead. This allows you to easily
        check what drawing primitives your program is calling, with what arguments, and
        in which order. Tests written this way are much more robust (they won’t break
        because your new machine does anti-aliasing differently), easier to read and
        maintain (the intent of a test is expressed in the code, not in some binary
        images), and run <em>much, much faster</em>.</p>
      <h2 id="writing-the-mock-class">Writing the Mock Class</h2>
      <p>If you are lucky, the mocks you need to use have already been implemented by
        some nice people. If, however, you find yourself in the position to write a mock
        class, relax - gMock turns this task into a fun game! (Well, almost.)</p>
      <h3 id="how-to-define-it">How to Define It</h3>
      <p>Using the <code>Turtle</code> interface as example, here are the simple steps you need to
        follow:</p>
      <ul>
        <li>Derive a class <code>MockTurtle</code> from <code>Turtle</code>.</li>
        <li>Take a <em>virtual</em> function of <code>Turtle</code> (while it’s possible to
          <a href="#gmock-cookbook#MockingNonVirtualMethods">mock non-virtual methods using templates</a>,
          it’s much more involved).
        </li>
        <li>In the <code>public:</code> section of the child class, write <code>MOCK_METHOD();</code></li>
        <li>Now comes the fun part: you take the function signature, cut-and-paste it
          into the macro, and add two commas - one between the return type and the
          name, another between the name and the argument list.</li>
        <li>If you’re mocking a const method, add a 4th parameter containing <code>(const)</code>
          (the parentheses are required).</li>
        <li>Since you’re overriding a virtual method, we suggest adding the <code>override</code>
          keyword. For const methods the 4th parameter becomes <code>(const, override)</code>,
          for non-const methods just <code>(override)</code>. This isn’t mandatory.</li>
        <li>Repeat until all virtual functions you want to mock are done. (It goes
          without saying that <em>all</em> pure virtual methods in your abstract class must
          be either mocked or overridden.)</li>
      </ul>
      <p>After the process, you should have something like:</p>
      <pre class="chroma"><span class="cp">#include</span> <span class="cpf">&lt;gmock/gmock.h&gt;  // Brings in gMock.</span><span class="cp">
</span><span class="cp"></span>
<span class="k">class</span> <span class="nc">MockTurtle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Turtle</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="p">...</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">PenUp</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">PenDown</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Forward</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">distance</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Turn</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">degrees</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">GoTo</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">GetX</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">const</span><span class="p">,</span> <span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">GetY</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">const</span><span class="p">,</span> <span class="k">override</span><span class="p">));</span>
<span class="p">};</span>
</pre>
      <p>You don’t need to define these mock methods somewhere else - the <code>MOCK_METHOD</code>
        macro will generate the definitions for you. It’s that simple!</p>
      <h3 id="where-to-put-it">Where to Put It</h3>
      <p>When you define a mock class, you need to decide where to put its definition.
        Some people put it in a <code>_test.cc</code>. This is fine when the interface being mocked
        (say, <code>Foo</code>) is owned by the same person or team. Otherwise, when the owner of
        <code>Foo</code> changes it, your test could break. (You can’t really expect <code>Foo</code>’s
        maintainer to fix every test that uses <code>Foo</code>, can you?)
      </p>
      <p>Generally, you should not mock classes you don’t own. If you must mock such a
        class owned by others, define the mock class in <code>Foo</code>’s Bazel package (usually
        the same directory or a <code>testing</code> sub-directory), and put it in a <code>.h</code> and a
        <code>cc_library</code> with <code>testonly=True</code>. Then everyone can reference them from their
        tests. If <code>Foo</code> ever changes, there is only one copy of <code>MockFoo</code> to change, and
        only tests that depend on the changed methods need to be fixed.
      </p>
      <p>Another way to do it: you can introduce a thin layer <code>FooAdaptor</code> on top of
        <code>Foo</code> and code to this new interface. Since you own <code>FooAdaptor</code>, you can absorb
        changes in <code>Foo</code> much more easily. While this is more work initially, carefully
        choosing the adaptor interface can make your code easier to write and more
        readable (a net win in the long run), as you can choose <code>FooAdaptor</code> to fit your
        specific domain much better than <code>Foo</code> does.
      </p>
      <h2 id="using-mocks-in-tests">Using Mocks in Tests</h2>
      <p>Once you have a mock class, using it is easy. The typical work flow is:</p>
      <ol>
        <li>Import the gMock names from the <code>testing</code> namespace such that you can use
          them unqualified (You only have to do it once per file). Remember that
          namespaces are a good idea.</li>
        <li>Create some mock objects.</li>
        <li>Specify your expectations on them (How many times will a method be called?
          With what arguments? What should it do? etc.).</li>
        <li>Exercise some code that uses the mocks; optionally, check the result using
          googletest assertions. If a mock method is called more than expected or with
          wrong arguments, you’ll get an error immediately.</li>
        <li>When a mock is destructed, gMock will automatically check whether all
          expectations on it have been satisfied.</li>
      </ol>
      <p>Here’s an example:</p>
      <pre class="chroma"><span class="cp">#include</span> <span class="cpf">"path/to/mock-turtle.h"</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;gmock/gmock.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;gtest/gtest.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">AtLeast</span><span class="p">;</span>                         <span class="c1">// #1
</span><span class="c1"></span>
<span class="n">TEST</span><span class="p">(</span><span class="n">PainterTest</span><span class="p">,</span> <span class="n">CanDrawSomething</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">MockTurtle</span> <span class="n">turtle</span><span class="p">;</span>                              <span class="c1">// #2
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">PenDown</span><span class="p">())</span>                  <span class="c1">// #3
</span><span class="c1"></span>      <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>

  <span class="n">Painter</span> <span class="nf">painter</span><span class="p">(</span><span class="o">&amp;</span><span class="n">turtle</span><span class="p">);</span>                       <span class="c1">// #4
</span><span class="c1"></span>
  <span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">painter</span><span class="p">.</span><span class="n">DrawCircle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">));</span>      <span class="c1">// #5
</span><span class="c1"></span><span class="p">}</span>
</pre>
      <p>As you might have guessed, this test checks that <code>PenDown()</code> is called at least
        once. If the <code>painter</code> object didn’t call this method, your test will fail with
        a message like this:</p>
      <pre class="chroma">path/to/my_test.cc:119: Failure
Actual function call count doesn't match this expectation:
Actually: never called;
Expected: called at least once.
Stack trace:
...
</pre>
      <p><strong>Tip 1:</strong> If you run the test from an Emacs buffer, you can hit <code>&lt;Enter&gt;</code> on
        the line number to jump right to the failed expectation.</p>
      <p><strong>Tip 2:</strong> If your mock objects are never deleted, the final verification won’t
        happen. Therefore it’s a good idea to turn on the heap checker in your tests
        when you allocate mocks on the heap. You get that automatically if you use the
        <code>gtest_main</code> library already.
      </p>
      <h6 id="expectation-ordering">Expectation Ordering</h6>
      <p><strong>Important note:</strong> gMock requires expectations to be set <strong>before</strong> the mock
        functions are called, otherwise the behavior is <strong>undefined</strong>. Do not alternate
        between calls to <code>EXPECT_CALL()</code> and calls to the mock functions, and do not set
        any expectations on a mock after passing the mock to an API.</p>
      <p>This means <code>EXPECT_CALL()</code> should be read as expecting that a call will occur
        <em>in the future</em>, not that a call has occurred. Why does gMock work like that?
        Well, specifying the expectation beforehand allows gMock to report a violation
        as soon as it rises, when the context (stack trace, etc) is still available.
        This makes debugging much easier.
      </p>
      <p>Admittedly, this test is contrived and doesn’t do much. You can easily achieve
        the same effect without using gMock. However, as we shall reveal soon, gMock
        allows you to do <em>so much more</em> with the mocks.</p>
      <h2 id="setting-expectations">Setting Expectations</h2>
      <p>The key to using a mock object successfully is to set the <em>right expectations</em>
        on it. If you set the expectations too strict, your test will fail as the result
        of unrelated changes. If you set them too loose, bugs can slip through. You want
        to do it just right such that your test can catch exactly the kind of bugs you
        intend it to catch. gMock provides the necessary means for you to do it “just
        right.”</p>
      <h3 id="general-syntax">General Syntax</h3>
      <p>In gMock we use the <code>EXPECT_CALL()</code> macro to set an expectation on a mock
        method. The general syntax is:</p>
      <pre class="chroma"><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_object</span><span class="p">,</span> <span class="n">method</span><span class="p">(</span><span class="n">matchers</span><span class="p">))</span>
    <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">cardinality</span><span class="p">)</span>
    <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">action</span><span class="p">);</span>
</pre>
      <p>The macro has two arguments: first the mock object, and then the method and its
        arguments. Note that the two are separated by a comma (<code>,</code>), not a period (<code>.</code>).
        (Why using a comma? The answer is that it was necessary for technical reasons.)
        If the method is not overloaded, the macro can also be called without matchers:</p>
      <pre class="chroma"><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_object</span><span class="p">,</span> <span class="n">non</span><span class="o">-</span><span class="n">overloaded</span><span class="o">-</span><span class="n">method</span><span class="p">)</span>
    <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">cardinality</span><span class="p">)</span>
    <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">action</span><span class="p">);</span>
</pre>
      <p>This syntax allows the test writer to specify “called with any arguments”
        without explicitly specifying the number or types of arguments. To avoid
        unintended ambiguity, this syntax may only be used for methods that are not
        overloaded.</p>
      <p>Either form of the macro can be followed by some optional <em>clauses</em> that provide
        more information about the expectation. We’ll discuss how each clause works in
        the coming sections.</p>
      <p>This syntax is designed to make an expectation read like English. For example,
        you can probably guess that</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">GetX</span><span class="p">())</span>
    <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
    <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">150</span><span class="p">))</span>
    <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">200</span><span class="p">));</span>
</pre>
      <p>says that the <code>turtle</code> object’s <code>GetX()</code> method will be called five times, it
        will return 100 the first time, 150 the second time, and then 200 every time.
        Some people like to call this style of syntax a Domain-Specific Language (DSL).</p>
      <p>{: .callout .note}
        <strong>Note:</strong> Why do we use a macro to do this? Well it serves two purposes: first
        it makes expectations easily identifiable (either by <code>grep</code> or by a human
        reader), and second it allows gMock to include the source file location of a
        failed expectation in messages, making debugging easier.
      </p>
      <h3 id="matchers-what-arguments-do-we-expect">Matchers: What Arguments Do We Expect?</h3>
      <p>When a mock function takes arguments, we may specify what arguments we are
        expecting, for example:</p>
      <pre class="chroma"><span class="c1">// Expects the turtle to move forward by 100 units.
</span><span class="c1"></span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">Forward</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
</pre>
      <p>Oftentimes you do not want to be too specific. Remember that talk about tests
        being too rigid? Over specification leads to brittle tests and obscures the
        intent of tests. Therefore we encourage you to specify only what’s necessary—no
        more, no less. If you aren’t interested in the value of an argument, write <code>_</code>
        as the argument, which means “anything goes”:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="p">...</span>
<span class="c1">// Expects that the turtle jumps to somewhere on the x=50 line.
</span><span class="c1"></span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">GoTo</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">_</span><span class="p">));</span>
</pre>
      <p><code>_</code> is an instance of what we call <strong>matchers</strong>. A matcher is like a predicate
        and can test whether an argument is what we’d expect. You can use a matcher
        inside <code>EXPECT_CALL()</code> wherever a function argument is expected. <code>_</code> is a
        convenient way of saying “any value”.</p>
      <p>In the above examples, <code>100</code> and <code>50</code> are also matchers; implicitly, they are
        the same as <code>Eq(100)</code> and <code>Eq(50)</code>, which specify that the argument must be
        equal (using <code>operator==</code>) to the matcher argument. There are many
        <a href="reference/matchers.md">built-in matchers</a> for common types (as well as
        <a href="#gmock-cookbook#NewMatchers">custom matchers</a>); for example:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Ge</span><span class="p">;</span>
<span class="p">...</span>
<span class="c1">// Expects the turtle moves forward by at least 100.
</span><span class="c1"></span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">Forward</span><span class="p">(</span><span class="n">Ge</span><span class="p">(</span><span class="mi">100</span><span class="p">)));</span>
</pre>
      <p>If you don’t care about <em>any</em> arguments, rather than specify <code>_</code> for each of
        them you may instead omit the parameter list:</p>
      <pre class="chroma"><span class="c1">// Expects the turtle to move forward.
</span><span class="c1"></span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">Forward</span><span class="p">);</span>
<span class="c1">// Expects the turtle to jump somewhere.
</span><span class="c1"></span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">GoTo</span><span class="p">);</span>
</pre>
      <p>This works for all non-overloaded methods; if a method is overloaded, you need
        to help gMock resolve which overload is expected by specifying the number of
        arguments and possibly also the
        <a href="#gmock-cookbook#SelectOverload">types of the arguments</a>.
      </p>
      <h3 id="cardinalities-how-many-times-will-it-be-called">Cardinalities: How Many Times Will It Be Called?</h3>
      <p>The first clause we can specify following an <code>EXPECT_CALL()</code> is <code>Times()</code>. We
        call its argument a <strong>cardinality</strong> as it tells <em>how many times</em> the call should
        occur. It allows us to repeat an expectation many times without actually writing
        it as many times. More importantly, a cardinality can be “fuzzy”, just like a
        matcher can be. This allows a user to express the intent of a test exactly.</p>
      <p>An interesting special case is when we say <code>Times(0)</code>. You may have guessed - it
        means that the function shouldn’t be called with the given arguments at all, and
        gMock will report a googletest failure whenever the function is (wrongfully)
        called.</p>
      <p>We’ve seen <code>AtLeast(n)</code> as an example of fuzzy cardinalities earlier. For the
        list of built-in cardinalities you can use, see
        <a href="#gmock-cheat-sheet#CardinalityList">here</a>.
      </p>
      <p>The <code>Times()</code> clause can be omitted. <strong>If you omit <code>Times()</code>, gMock will infer
          the cardinality for you.</strong> The rules are easy to remember:</p>
      <ul>
        <li>If <strong>neither</strong> <code>WillOnce()</code> <strong>nor</strong> <code>WillRepeatedly()</code> is in
          the
          <code>EXPECT_CALL()</code>, the inferred cardinality is <code>Times(1)</code>.
        </li>
        <li>If there are <em>n</em> <code>WillOnce()</code>’s but <strong>no</strong> <code>WillRepeatedly()</code>,
          where <em>n</em> &gt;=
          1, the cardinality is <code>Times(n)</code>.</li>
        <li>If there are <em>n</em> <code>WillOnce()</code>’s and <strong>one</strong> <code>WillRepeatedly()</code>,
          where <em>n</em> &gt;=
          0, the cardinality is <code>Times(AtLeast(n))</code>.</li>
      </ul>
      <p><strong>Quick quiz:</strong> what do you think will happen if a function is expected to be
        called twice but actually called four times?</p>
      <h3 id="actions-what-should-it-do">Actions: What Should It Do?</h3>
      <p>Remember that a mock object doesn’t really have a working implementation? We as
        users have to tell it what to do when a method is invoked. This is easy in
        gMock.</p>
      <p>First, if the return type of a mock function is a built-in type or a pointer,
        the function has a <strong>default action</strong> (a <code>void</code> function will just return, a
        <code>bool</code> function will return <code>false</code>, and other functions will return 0). In
        addition, in C++ 11 and above, a mock function whose return type is
        default-constructible (i.e. has a default constructor) has a default action of
        returning a default-constructed value. If you don’t say anything, this behavior
        will be used.
      </p>
      <p>Second, if a mock function doesn’t have a default action, or the default action
        doesn’t suit you, you can specify the action to be taken each time the
        expectation matches using a series of <code>WillOnce()</code> clauses followed by an
        optional <code>WillRepeatedly()</code>. For example,</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">GetX</span><span class="p">())</span>
     <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
     <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
     <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">300</span><span class="p">));</span>
</pre>
      <p>says that <code>turtle.GetX()</code> will be called <em>exactly three times</em> (gMock inferred
        this from how many <code>WillOnce()</code> clauses we’ve written, since we didn’t
        explicitly write <code>Times()</code>), and will return 100, 200, and 300 respectively.</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">GetY</span><span class="p">())</span>
     <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
     <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
     <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">300</span><span class="p">));</span>
</pre>
      <p>says that <code>turtle.GetY()</code> will be called <em>at least twice</em> (gMock knows this as
        we’ve written two <code>WillOnce()</code> clauses and a <code>WillRepeatedly()</code> while having no
        explicit <code>Times()</code>), will return 100 and 200 respectively the first two times,
        and 300 from the third time on.</p>
      <p>Of course, if you explicitly write a <code>Times()</code>, gMock will not try to infer the
        cardinality itself. What if the number you specified is larger than there are
        <code>WillOnce()</code> clauses? Well, after all <code>WillOnce()</code>s are used up, gMock will do
        the <em>default</em> action for the function every time (unless, of course, you have a
        <code>WillRepeatedly()</code>.).
      </p>
      <p>What can we do inside <code>WillOnce()</code> besides <code>Return()</code>? You can return a
        reference using <code>ReturnRef(</code><em><code>variable</code></em><code>)</code>, or invoke a pre-defined
        function,
        among <a href="#gmock-cookbook#using-actions">others</a>.</p>
      <p><strong>Important note:</strong> The <code>EXPECT_CALL()</code> statement evaluates the action clause
        only once, even though the action may be performed many times. Therefore you
        must be careful about side effects. The following may not do what you want:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">GetX</span><span class="p">())</span>
    <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="n">n</span><span class="o">++</span><span class="p">));</span>
</pre>
      <p>Instead of returning 100, 101, 102, …, consecutively, this mock function will
        always return 100 as <code>n++</code> is only evaluated once. Similarly, <code>Return(new Foo)</code>
        will create a new <code>Foo</code> object when the <code>EXPECT_CALL()</code> is executed, and will
        return the same pointer every time. If you want the side effect to happen every
        time, you need to define a custom action, which we’ll teach in the
        <a href="#gmock-cookbook">cook book</a>.
      </p>
      <p>Time for another quiz! What do you think the following means?</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">GetY</span><span class="p">())</span>
    <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
</pre>
      <p>Obviously <code>turtle.GetY()</code> is expected to be called four times. But if you think
        it will return 100 every time, think twice! Remember that one <code>WillOnce()</code>
        clause will be consumed each time the function is invoked and the default action
        will be taken afterwards. So the right answer is that <code>turtle.GetY()</code> will
        return 100 the first time, but <strong>return 0 from the second time on</strong>, as
        returning 0 is the default action for <code>int</code> functions.</p>
      <h3 id="using-multiple-expectations-multiexpectations">Using Multiple Expectations {#MultiExpectations}</h3>
      <p>So far we’ve only shown examples where you have a single expectation. More
        realistically, you’ll specify expectations on multiple mock methods which may be
        from multiple mock objects.</p>
      <p>By default, when a mock method is invoked, gMock will search the expectations in
        the <strong>reverse order</strong> they are defined, and stop when an active expectation that
        matches the arguments is found (you can think of it as “newer rules override
        older ones."). If the matching expectation cannot take any more calls, you will
        get an upper-bound-violated failure. Here’s an example:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">Forward</span><span class="p">(</span><span class="n">_</span><span class="p">));</span>  <span class="c1">// #1
</span><span class="c1"></span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">Forward</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>  <span class="c1">// #2
</span><span class="c1"></span>    <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</pre>
      <p>If <code>Forward(10)</code> is called three times in a row, the third time it will be an
        error, as the last matching expectation (#2) has been saturated. If, however,
        the third <code>Forward(10)</code> call is replaced by <code>Forward(20)</code>, then it would be OK,
        as now #1 will be the matching expectation.</p>
      <p>{: .callout .note}
        <strong>Note:</strong> Why does gMock search for a match in the <em>reverse</em> order of the
        expectations? The reason is that this allows a user to set up the default
        expectations in a mock object’s constructor or the test fixture’s set-up phase
        and then customize the mock by writing more specific expectations in the test
        body. So, if you have two expectations on the same method, you want to put the
        one with more specific matchers <strong>after</strong> the other, or the more specific rule
        would be shadowed by the more general one that comes after it.
      </p>
      <p>{: .callout .tip}
        <strong>Tip:</strong> It is very common to start with a catch-all expectation for a method
        and <code>Times(AnyNumber())</code> (omitting arguments, or with <code>_</code> for all arguments, if
        overloaded). This makes any calls to the method expected. This is not necessary
        for methods that are not mentioned at all (these are “uninteresting”), but is
        useful for methods that have some expectations, but for which other calls are
        ok. See
        <a href="#gmock-cookbook#uninteresting-vs-unexpected">Understanding Uninteresting vs Unexpected Calls</a>.
      </p>
      <h3 id="ordered-vs-unordered-calls-orderedcalls">Ordered vs Unordered Calls {#OrderedCalls}</h3>
      <p>By default, an expectation can match a call even though an earlier expectation
        hasn’t been satisfied. In other words, the calls don’t have to occur in the
        order the expectations are specified.</p>
      <p>Sometimes, you may want all the expected calls to occur in a strict order. To
        say this in gMock is easy:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">InSequence</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">DrawsLineSegment</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="p">{</span>
    <span class="n">InSequence</span> <span class="n">seq</span><span class="p">;</span>

    <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">PenDown</span><span class="p">());</span>
    <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">Forward</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
    <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">PenUp</span><span class="p">());</span>
  <span class="p">}</span>
  <span class="n">Foo</span><span class="p">();</span>
<span class="p">}</span>
</pre>
      <p>By creating an object of type <code>InSequence</code>, all expectations in its scope are
        put into a <em>sequence</em> and have to occur <em>sequentially</em>. Since we are just
        relying on the constructor and destructor of this object to do the actual work,
        its name is really irrelevant.</p>
      <p>In this example, we test that <code>Foo()</code> calls the three expected functions in the
        order as written. If a call is made out-of-order, it will be an error.</p>
      <p>(What if you care about the relative order of some of the calls, but not all of
        them? Can you specify an arbitrary partial order? The answer is … yes! The
        details can be found <a href="#gmock-cookbook#OrderedCalls">here</a>.)</p>
      <h3 id="all-expectations-are-sticky-unless-said-otherwise-stickyexpectations">All Expectations Are Sticky (Unless
        Said Otherwise) {#StickyExpectations}</h3>
      <p>Now let’s do a quick quiz to see how well you can use this mock stuff already.
        How would you test that the turtle is asked to go to the origin <em>exactly twice</em>
        (you want to ignore any other instructions it receives)?</p>
      <p>After you’ve come up with your answer, take a look at ours and compare notes
        (solve it yourself first - don’t cheat!):</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">AnyNumber</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">GoTo</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span>  <span class="c1">// #1
</span><span class="c1"></span>     <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">AnyNumber</span><span class="p">());</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">GoTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1">// #2
</span><span class="c1"></span>     <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</pre>
      <p>Suppose <code>turtle.GoTo(0, 0)</code> is called three times. In the third time, gMock will
        see that the arguments match expectation #2 (remember that we always pick the
        last matching expectation). Now, since we said that there should be only two
        such calls, gMock will report an error immediately. This is basically what we’ve
        told you in the <a href="#MultiExpectations">Using Multiple Expectations</a> section above.</p>
      <p>This example shows that <strong>expectations in gMock are “sticky” by default</strong>, in
        the sense that they remain active even after we have reached their invocation
        upper bounds. This is an important rule to remember, as it affects the meaning
        of the spec, and is <strong>different</strong> to how it’s done in many other mocking
        frameworks (Why’d we do that? Because we think our rule makes the common cases
        easier to express and understand.).</p>
      <p>Simple? Let’s see if you’ve really understood it: what does the following code
        say?</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">GetX</span><span class="p">())</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">i</span><span class="p">));</span>
<span class="p">}</span>
</pre>
      <p>If you think it says that <code>turtle.GetX()</code> will be called <code>n</code> times and will
        return 10, 20, 30, …, consecutively, think twice! The problem is that, as we
        said, expectations are sticky. So, the second time <code>turtle.GetX()</code> is called,
        the last (latest) <code>EXPECT_CALL()</code> statement will match, and will immediately
        lead to an “upper bound violated” error - this piece of code is not very useful!</p>
      <p>One correct way of saying that <code>turtle.GetX()</code> will return 10, 20, 30, …, is
        to explicitly say that the expectations are <em>not</em> sticky. In other words, they
        should <em>retire</em> as soon as they are saturated:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">GetX</span><span class="p">())</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">i</span><span class="p">))</span>
      <span class="p">.</span><span class="n">RetiresOnSaturation</span><span class="p">();</span>
<span class="p">}</span>
</pre>
      <p>And, there’s a better way to do it: in this case, we expect the calls to occur
        in a specific order, and we line up the actions to match the order. Since the
        order is important here, we should make it explicit using a sequence:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">InSequence</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="p">{</span>
  <span class="n">InSequence</span> <span class="n">s</span><span class="p">;</span>

  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">turtle</span><span class="p">,</span> <span class="n">GetX</span><span class="p">())</span>
        <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">i</span><span class="p">))</span>
        <span class="p">.</span><span class="n">RetiresOnSaturation</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
      <p>By the way, the other situation where an expectation may <em>not</em> be sticky is when
        it’s in a sequence - as soon as another expectation that comes after it in the
        sequence has been used, it automatically retires (and will never be used to
        match any call).</p>
      <h3 id="uninteresting-calls">Uninteresting Calls</h3>
      <p>A mock object may have many methods, and not all of them are that interesting.
        For example, in some tests we may not care about how many times <code>GetX()</code> and
        <code>GetY()</code> get called.
      </p>
      <p>In gMock, if you are not interested in a method, just don’t say anything about
        it. If a call to this method occurs, you’ll see a warning in the test output,
        but it won’t be a failure. This is called “naggy” behavior; to change, see
        <a href="#gmock-cookbook#NiceStrictNaggy">The Nice, the Strict, and the Naggy</a>.
      </p>
      <h1 id="gmock-cookbook">gMock Cookbook</h1>
      <p>You can find recipes for using gMock here. If you haven’t yet, please read
        <a href="#gmock-for-dummies">the dummy guide</a> first to make sure you understand the
        basics.
      </p>
      <p>{: .callout .note}
        <strong>Note:</strong> gMock lives in the <code>testing</code> name space. For readability, it is
        recommended to write <code>using ::testing::Foo;</code> once in your file before using the
        name <code>Foo</code> defined by gMock. We omit such <code>using</code> statements in this section for
        brevity, but you should do it in your own code.
      </p>
      <h2 id="creating-mock-classes">Creating Mock Classes</h2>
      <p>Mock classes are defined as normal classes, using the <code>MOCK_METHOD</code> macro to
        generate mocked methods. The macro gets 3 or 4 parameters:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">MyMock</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="n">ReturnType</span><span class="p">,</span> <span class="n">MethodName</span><span class="p">,</span> <span class="p">(</span><span class="n">Args</span><span class="p">...));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="n">ReturnType</span><span class="p">,</span> <span class="n">MethodName</span><span class="p">,</span> <span class="p">(</span><span class="n">Args</span><span class="p">...),</span> <span class="p">(</span><span class="n">Specs</span><span class="p">...));</span>
<span class="p">};</span>
</pre>
      <p>The first 3 parameters are simply the method declaration, split into 3 parts.
        The 4th parameter accepts a closed list of qualifiers, which affect the
        generated method:</p>
      <ul>
        <li><strong><code>const</code></strong> - Makes the mocked method a <code>const</code> method. Required if
          overriding a <code>const</code> method.</li>
        <li><strong><code>override</code></strong> - Marks the method with <code>override</code>. Recommended if
          overriding
          a <code>virtual</code> method.</li>
        <li><strong><code>noexcept</code></strong> - Marks the method with <code>noexcept</code>. Required if overriding
          a
          <code>noexcept</code> method.
        </li>
        <li><strong><code>Calltype(...)</code></strong> - Sets the call type for the method (e.g. to
          <code>STDMETHODCALLTYPE</code>), useful in Windows.
        </li>
        <li><strong><code>ref(...)</code></strong> - Marks the method with the reference qualification
          specified. Required if overriding a method that has reference
          qualifications. Eg <code>ref(&amp;)</code> or <code>ref(&amp;&amp;)</code>.</li>
      </ul>
      <h3 id="dealing-with-unprotected-commas">Dealing with unprotected commas</h3>
      <p>Unprotected commas, i.e. commas which are not surrounded by parentheses, prevent
        <code>MOCK_METHOD</code> from parsing its arguments correctly:
      </p>
      <p>{: .bad}</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">MockFoo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">GetPair</span><span class="p">,</span> <span class="p">());</span>  <span class="c1">// Won't compile!
</span><span class="c1"></span>  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">CheckMap</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">bool</span><span class="p">));</span>  <span class="c1">// Won't compile!
</span><span class="c1"></span><span class="p">};</span>
</pre>
      <p>Solution 1 - wrap with parentheses:</p>
      <p>{: .good}</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">MockFoo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">((</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">),</span> <span class="n">GetPair</span><span class="p">,</span> <span class="p">());</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">CheckMap</span><span class="p">,</span> <span class="p">((</span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span><span class="p">),</span> <span class="kt">bool</span><span class="p">));</span>
<span class="p">};</span>
</pre>
      <p>Note that wrapping a return or argument type with parentheses is, in general,
        invalid C++. <code>MOCK_METHOD</code> removes the parentheses.</p>
      <p>Solution 2 - define an alias:</p>
      <p>{: .good}</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">MockFoo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">BoolAndInt</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="n">BoolAndInt</span><span class="p">,</span> <span class="n">GetPair</span><span class="p">,</span> <span class="p">());</span>
  <span class="k">using</span> <span class="n">MapIntDouble</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">CheckMap</span><span class="p">,</span> <span class="p">(</span><span class="n">MapIntDouble</span><span class="p">,</span> <span class="kt">bool</span><span class="p">));</span>
<span class="p">};</span>
</pre>
      <h3 id="mocking-private-or-protected-methods">Mocking Private or Protected Methods</h3>
      <p>You must always put a mock method definition (<code>MOCK_METHOD</code>) in a <code>public:</code>
        section of the mock class, regardless of the method being mocked being <code>public</code>,
        <code>protected</code>, or <code>private</code> in the base class. This allows <code>ON_CALL</code> and
        <code>EXPECT_CALL</code> to reference the mock function from outside of the mock class.
        (Yes, C++ allows a subclass to change the access level of a virtual function in
        the base class.) Example:
      </p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="p">...</span>
  <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">Transform</span><span class="p">(</span><span class="n">Gadget</span><span class="o">*</span> <span class="n">g</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

 <span class="k">protected</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">Resume</span><span class="p">();</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="n">GetTimeOut</span><span class="p">();</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="p">...</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">Transform</span><span class="p">,</span> <span class="p">(</span><span class="n">Gadget</span><span class="o">*</span> <span class="n">g</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>

  <span class="c1">// The following must be in the public section, even though the
</span><span class="c1"></span>  <span class="c1">// methods are protected or private in the base class.
</span><span class="c1"></span>  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Resume</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">GetTimeOut</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>
</pre>
      <h3 id="mocking-overloaded-methods">Mocking Overloaded Methods</h3>
      <p>You can mock overloaded functions as usual. No special attention is required:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="p">...</span>

  <span class="c1">// Must be virtual as we'll inherit from Foo.
</span><span class="c1"></span>  <span class="k">virtual</span> <span class="o">~</span><span class="n">Foo</span><span class="p">();</span>

  <span class="c1">// Overloaded on the types and/or numbers of arguments.
</span><span class="c1"></span>  <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">Add</span><span class="p">(</span><span class="n">Element</span> <span class="n">x</span><span class="p">);</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">Add</span><span class="p">(</span><span class="kt">int</span> <span class="n">times</span><span class="p">,</span> <span class="n">Element</span> <span class="n">x</span><span class="p">);</span>

  <span class="c1">// Overloaded on the const-ness of this object.
</span><span class="c1"></span>  <span class="k">virtual</span> <span class="n">Bar</span><span class="o">&amp;</span> <span class="n">GetBar</span><span class="p">();</span>
  <span class="k">virtual</span> <span class="k">const</span> <span class="n">Bar</span><span class="o">&amp;</span> <span class="n">GetBar</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">Add</span><span class="p">,</span> <span class="p">(</span><span class="n">Element</span> <span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">Add</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">times</span><span class="p">,</span> <span class="n">Element</span> <span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>

  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="n">Bar</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">GetBar</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="k">const</span> <span class="n">Bar</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">GetBar</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">const</span><span class="p">,</span> <span class="k">override</span><span class="p">));</span>
<span class="p">};</span>
</pre>
      <p>{: .callout .note}
        <strong>Note:</strong> if you don’t mock all versions of the overloaded method, the compiler
        will give you a warning about some methods in the base class being hidden. To
        fix that, use <code>using</code> to bring them in scope:
      </p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">using</span> <span class="n">Foo</span><span class="o">::</span><span class="n">Add</span><span class="p">;</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">Add</span><span class="p">,</span> <span class="p">(</span><span class="n">Element</span> <span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="c1">// We don't want to mock int Add(int times, Element x);
</span><span class="c1"></span>  <span class="p">...</span>
<span class="p">};</span>
</pre>
      <h3 id="mocking-class-templates">Mocking Class Templates</h3>
      <p>You can mock class templates just like any class.</p>
      <pre class="chroma"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Elem</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">StackInterface</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="c1">// Must be virtual as we'll inherit from StackInterface.
</span><span class="c1"></span>  <span class="k">virtual</span> <span class="o">~</span><span class="n">StackInterface</span><span class="p">();</span>

  <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">GetSize</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">Push</span><span class="p">(</span><span class="k">const</span> <span class="n">Elem</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Elem</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">MockStack</span> <span class="o">:</span> <span class="k">public</span> <span class="n">StackInterface</span><span class="o">&lt;</span><span class="n">Elem</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">GetSize</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Push</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">Elem</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>
</pre>
      <h3 id="mocking-non-virtual-methods-mockingnonvirtualmethods">Mocking Non-virtual Methods
        {#MockingNonVirtualMethods}</h3>
      <p>gMock can mock non-virtual functions to be used in Hi-perf dependency injection.</p>
      <p>In this case, instead of sharing a common base class with the real class, your
        mock class will be <em>unrelated</em> to the real class, but contain methods with the
        same signatures. The syntax for mocking non-virtual methods is the <em>same</em> as
        mocking virtual methods (just don’t add <code>override</code>):</p>
      <pre class="chroma"><span class="c1">// A simple packet stream class.  None of its members is virtual.
</span><span class="c1"></span><span class="k">class</span> <span class="nc">ConcretePacketStream</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">AppendPacket</span><span class="p">(</span><span class="n">Packet</span><span class="o">*</span> <span class="n">new_packet</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">Packet</span><span class="o">*</span> <span class="nf">GetPacket</span><span class="p">(</span><span class="n">size_t</span> <span class="n">packet_number</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">size_t</span> <span class="nf">NumberOfPackets</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="p">...</span>
<span class="p">};</span>

<span class="c1">// A mock packet stream class.  It inherits from no other, but defines
</span><span class="c1">// GetPacket() and NumberOfPackets().
</span><span class="c1"></span><span class="k">class</span> <span class="nc">MockPacketStream</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="k">const</span> <span class="n">Packet</span><span class="o">*</span><span class="p">,</span> <span class="n">GetPacket</span><span class="p">,</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">packet_number</span><span class="p">),</span> <span class="p">(</span><span class="k">const</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="n">size_t</span><span class="p">,</span> <span class="n">NumberOfPackets</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">const</span><span class="p">));</span>
  <span class="p">...</span>
<span class="p">};</span>
</pre>
      <p>Note that the mock class doesn’t define <code>AppendPacket()</code>, unlike the real class.
        That’s fine as long as the test doesn’t need to call it.</p>
      <p>Next, you need a way to say that you want to use <code>ConcretePacketStream</code> in
        production code, and use <code>MockPacketStream</code> in tests. Since the functions are
        not virtual and the two classes are unrelated, you must specify your choice at
        <em>compile time</em> (as opposed to run time).
      </p>
      <p>One way to do it is to templatize your code that needs to use a packet stream.
        More specifically, you will give your code a template type argument for the type
        of the packet stream. In production, you will instantiate your template with
        <code>ConcretePacketStream</code> as the type argument. In tests, you will instantiate the
        same template with <code>MockPacketStream</code>. For example, you may write:
      </p>
      <pre class="chroma"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">PacketStream</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">CreateConnection</span><span class="p">(</span><span class="n">PacketStream</span><span class="o">*</span> <span class="n">stream</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">PacketStream</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">PacketReader</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">ReadPackets</span><span class="p">(</span><span class="n">PacketStream</span><span class="o">*</span> <span class="n">stream</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">packet_num</span><span class="p">);</span>
<span class="p">};</span>
</pre>
      <p>Then you can use <code>CreateConnection&lt;ConcretePacketStream&gt;()</code> and
        <code>PacketReader&lt;ConcretePacketStream&gt;</code> in production code, and use
        <code>CreateConnection&lt;MockPacketStream&gt;()</code> and <code>PacketReader&lt;MockPacketStream&gt;</code> in
        tests.
      </p>
      <pre class="chroma">  <span class="n">MockPacketStream</span> <span class="n">mock_stream</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_stream</span><span class="p">,</span> <span class="p">...)...;</span>
  <span class="p">..</span> <span class="n">set</span> <span class="n">more</span> <span class="n">expectations</span> <span class="n">on</span> <span class="n">mock_stream</span> <span class="p">...</span>
  <span class="n">PacketReader</span><span class="o">&lt;</span><span class="n">MockPacketStream</span><span class="o">&gt;</span> <span class="n">reader</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mock_stream</span><span class="p">);</span>
  <span class="p">...</span> <span class="n">exercise</span> <span class="n">reader</span> <span class="p">...</span>
</pre>
      <h3 id="mocking-free-functions">Mocking Free Functions</h3>
      <p>It is not possible to directly mock a free function (i.e. a C-style function or
        a static method). If you need to, you can rewrite your code to use an interface
        (abstract class).</p>
      <p>Instead of calling a free function (say, <code>OpenFile</code>) directly, introduce an
        interface for it and have a concrete subclass that calls the free function:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">FileInterface</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="p">...</span>
  <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">Open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">path</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">mode</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">File</span> <span class="o">:</span> <span class="k">public</span> <span class="n">FileInterface</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="p">...</span>
  <span class="kt">bool</span> <span class="n">Open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">path</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">mode</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
     <span class="k">return</span> <span class="nf">OpenFile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre>
      <p>Your code should talk to <code>FileInterface</code> to open a file. Now it’s easy to mock
        out the function.</p>
      <p>This may seem like a lot of hassle, but in practice you often have multiple
        related functions that you can put in the same interface, so the per-function
        syntactic overhead will be much lower.</p>
      <p>If you are concerned about the performance overhead incurred by virtual
        functions, and profiling confirms your concern, you can combine this with the
        recipe for <a href="#MockingNonVirtualMethods">mocking non-virtual methods</a>.</p>
      <p>Alternatively, instead of introducing a new interface, you can rewrite your code
        to accept a std::function instead of the free function, and then use
        <a href="#MockFunction">MockFunction</a> to mock the std::function.
      </p>
      <h3 id="old-style-mock-methodn-macros">Old-Style <code>MOCK_METHODn</code> Macros</h3>
      <p>Before the generic <code>MOCK_METHOD</code> macro
        <a href="https://github.com/google/googletest/commit/c5f08bf91944ce1b19bcf414fa1760e69d20afc2">was introduced in
          2018</a>,
        mocks where created using a family of macros collectively called <code>MOCK_METHODn</code>.
        These macros are still supported, though migration to the new <code>MOCK_METHOD</code> is
        recommended.
      </p>
      <p>The macros in the <code>MOCK_METHODn</code> family differ from <code>MOCK_METHOD</code>:</p>
      <ul>
        <li>The general structure is <code>MOCK_METHODn(MethodName, ReturnType(Args))</code>,
          instead of <code>MOCK_METHOD(ReturnType, MethodName, (Args))</code>.</li>
        <li>The number <code>n</code> must equal the number of arguments.</li>
        <li>When mocking a const method, one must use <code>MOCK_CONST_METHODn</code>.</li>
        <li>When mocking a class template, the macro name must be suffixed with <code>_T</code>.</li>
        <li>In order to specify the call type, the macro name must be suffixed with
          <code>_WITH_CALLTYPE</code>, and the call type is the first macro argument.
        </li>
      </ul>
      <p>Old macros and their new equivalents:</p>
      <table>
        <tbody>
          <tr>
            <th colspan="2">Simple</th>
          </tr>
          <tr>
            <td>Old</td>
            <td><code>MOCK_METHOD1(Foo, bool(int))</code></td>
          </tr>
          <tr>
            <td>New</td>
            <td><code>MOCK_METHOD(bool, Foo, (int))</code></td>
          </tr>
          <tr>
            <th colspan="2">Const Method</th>
          </tr>
          <tr>
            <td>Old</td>
            <td><code>MOCK_CONST_METHOD1(Foo, bool(int))</code></td>
          </tr>
          <tr>
            <td>New</td>
            <td><code>MOCK_METHOD(bool, Foo, (int), (const))</code></td>
          </tr>
          <tr>
            <th colspan="2">Method in a Class Template</th>
          </tr>
          <tr>
            <td>Old</td>
            <td><code>MOCK_METHOD1_T(Foo, bool(int))</code></td>
          </tr>
          <tr>
            <td>New</td>
            <td><code>MOCK_METHOD(bool, Foo, (int))</code></td>
          </tr>
          <tr>
            <th colspan="2">Const Method in a Class Template</th>
          </tr>
          <tr>
            <td>Old</td>
            <td><code>MOCK_CONST_METHOD1_T(Foo, bool(int))</code></td>
          </tr>
          <tr>
            <td>New</td>
            <td><code>MOCK_METHOD(bool, Foo, (int), (const))</code></td>
          </tr>
          <tr>
            <th colspan="2">Method with Call Type</th>
          </tr>
          <tr>
            <td>Old</td>
            <td><code>MOCK_METHOD1_WITH_CALLTYPE(STDMETHODCALLTYPE, Foo, bool(int))</code></td>
          </tr>
          <tr>
            <td>New</td>
            <td><code>MOCK_METHOD(bool, Foo, (int), (Calltype(STDMETHODCALLTYPE)))</code></td>
          </tr>
          <tr>
            <th colspan="2">Const Method with Call Type</th>
          </tr>
          <tr>
            <td>Old</td>
            <td><code>MOCK_CONST_METHOD1_WITH_CALLTYPE(STDMETHODCALLTYPE, Foo, bool(int))</code></td>
          </tr>
          <tr>
            <td>New</td>
            <td><code>MOCK_METHOD(bool, Foo, (int), (const, Calltype(STDMETHODCALLTYPE)))</code></td>
          </tr>
          <tr>
            <th colspan="2">Method with Call Type in a Class Template</th>
          </tr>
          <tr>
            <td>Old</td>
            <td><code>MOCK_METHOD1_T_WITH_CALLTYPE(STDMETHODCALLTYPE, Foo, bool(int))</code></td>
          </tr>
          <tr>
            <td>New</td>
            <td><code>MOCK_METHOD(bool, Foo, (int), (Calltype(STDMETHODCALLTYPE)))</code></td>
          </tr>
          <tr>
            <th colspan="2">Const Method with Call Type in a Class Template</th>
          </tr>
          <tr>
            <td>Old</td>
            <td><code>MOCK_CONST_METHOD1_T_WITH_CALLTYPE(STDMETHODCALLTYPE, Foo, bool(int))</code></td>
          </tr>
          <tr>
            <td>New</td>
            <td><code>MOCK_METHOD(bool, Foo, (int), (const, Calltype(STDMETHODCALLTYPE)))</code></td>
          </tr>
        </tbody>
      </table>
      <h3 id="the-nice-the-strict-and-the-naggy-nicestrictnaggy">The Nice, the Strict, and the Naggy {#NiceStrictNaggy}
      </h3>
      <p>If a mock method has no <code>EXPECT_CALL</code> spec but is called, we say that it’s an
        “uninteresting call”, and the default action (which can be specified using
        <code>ON_CALL()</code>) of the method will be taken. Currently, an uninteresting call will
        also by default cause gMock to print a warning.
      </p>
      <p>However, sometimes you may want to ignore these uninteresting calls, and
        sometimes you may want to treat them as errors. gMock lets you make the decision
        on a per-mock-object basis.</p>
      <p>Suppose your test uses a mock class <code>MockFoo</code>:</p>
      <pre class="chroma"><span class="n">TEST</span><span class="p">(...)</span> <span class="p">{</span>
  <span class="n">MockFoo</span> <span class="n">mock_foo</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">());</span>
  <span class="p">...</span> <span class="n">code</span> <span class="n">that</span> <span class="n">uses</span> <span class="n">mock_foo</span> <span class="p">...</span>
<span class="p">}</span>
</pre>
      <p>If a method of <code>mock_foo</code> other than <code>DoThis()</code> is called, you will get a
        warning. However, if you rewrite your test to use <code>NiceMock&lt;MockFoo&gt;</code> instead,
        you can suppress the warning:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">NiceMock</span><span class="p">;</span>

<span class="n">TEST</span><span class="p">(...)</span> <span class="p">{</span>
  <span class="n">NiceMock</span><span class="o">&lt;</span><span class="n">MockFoo</span><span class="o">&gt;</span> <span class="n">mock_foo</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">());</span>
  <span class="p">...</span> <span class="n">code</span> <span class="n">that</span> <span class="n">uses</span> <span class="n">mock_foo</span> <span class="p">...</span>
<span class="p">}</span>
</pre>
      <p><code>NiceMock&lt;MockFoo&gt;</code> is a subclass of <code>MockFoo</code>, so it can be used wherever
        <code>MockFoo</code> is accepted.
      </p>
      <p>It also works if <code>MockFoo</code>’s constructor takes some arguments, as
        <code>NiceMock&lt;MockFoo&gt;</code> “inherits” <code>MockFoo</code>’s constructors:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">NiceMock</span><span class="p">;</span>

<span class="n">TEST</span><span class="p">(...)</span> <span class="p">{</span>
  <span class="n">NiceMock</span><span class="o">&lt;</span><span class="n">MockFoo</span><span class="o">&gt;</span> <span class="n">mock_foo</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s">"hi"</span><span class="p">);</span>  <span class="c1">// Calls MockFoo(5, "hi").
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">());</span>
  <span class="p">...</span> <span class="n">code</span> <span class="n">that</span> <span class="n">uses</span> <span class="n">mock_foo</span> <span class="p">...</span>
<span class="p">}</span>
</pre>
      <p>The usage of <code>StrictMock</code> is similar, except that it makes all uninteresting
        calls failures:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">StrictMock</span><span class="p">;</span>

<span class="n">TEST</span><span class="p">(...)</span> <span class="p">{</span>
  <span class="n">StrictMock</span><span class="o">&lt;</span><span class="n">MockFoo</span><span class="o">&gt;</span> <span class="n">mock_foo</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">());</span>
  <span class="p">...</span> <span class="n">code</span> <span class="n">that</span> <span class="n">uses</span> <span class="n">mock_foo</span> <span class="p">...</span>

  <span class="c1">// The test will fail if a method of mock_foo other than DoThis()
</span><span class="c1"></span>  <span class="c1">// is called.
</span><span class="c1"></span><span class="p">}</span>
</pre>
      <p>{: .callout .note}
        NOTE: <code>NiceMock</code> and <code>StrictMock</code> only affects <em>uninteresting</em> calls (calls of
        <em>methods</em> with no expectations); they do not affect <em>unexpected</em> calls (calls of
        methods with expectations, but they don’t match). See
        <a href="#uninteresting-vs-unexpected">Understanding Uninteresting vs Unexpected Calls</a>.
      </p>
      <p>There are some caveats though (sadly they are side effects of C++’s
        limitations):</p>
      <ol>
        <li><code>NiceMock&lt;MockFoo&gt;</code> and <code>StrictMock&lt;MockFoo&gt;</code> only work for mock methods
          defined using the <code>MOCK_METHOD</code> macro <strong>directly</strong> in the <code>MockFoo</code> class.
          If a mock method is defined in a <strong>base class</strong> of <code>MockFoo</code>, the “nice” or
          “strict” modifier may not affect it, depending on the compiler. In
          particular, nesting <code>NiceMock</code> and <code>StrictMock</code> (e.g.
          <code>NiceMock&lt;StrictMock&lt;MockFoo&gt; &gt;</code>) is <strong>not</strong> supported.
        </li>
        <li><code>NiceMock&lt;MockFoo&gt;</code> and <code>StrictMock&lt;MockFoo&gt;</code> may not work correctly if
          the
          destructor of <code>MockFoo</code> is not virtual. We would like to fix this, but it
          requires cleaning up existing tests.</li>
      </ol>
      <p>Finally, you should be <strong>very cautious</strong> about when to use naggy or strict
        mocks, as they tend to make tests more brittle and harder to maintain. When you
        refactor your code without changing its externally visible behavior, ideally you
        shouldn’t need to update any tests. If your code interacts with a naggy mock,
        however, you may start to get spammed with warnings as the result of your
        change. Worse, if your code interacts with a strict mock, your tests may start
        to fail and you’ll be forced to fix them. Our general recommendation is to use
        nice mocks (not yet the default) most of the time, use naggy mocks (the current
        default) when developing or debugging tests, and use strict mocks only as the
        last resort.</p>
      <h3 id="simplifying-the-interface-without-breaking-existing-code-simplerinterfaces">Simplifying the Interface
        without Breaking Existing Code {#SimplerInterfaces}</h3>
      <p>Sometimes a method has a long list of arguments that is mostly uninteresting.
        For example:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">LogSink</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="p">...</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">send</span><span class="p">(</span><span class="n">LogSeverity</span> <span class="n">severity</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">full_filename</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">base_filename</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span>
                    <span class="k">const</span> <span class="k">struct</span> <span class="nc">tm</span><span class="o">*</span> <span class="n">tm_time</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">message_len</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre>
      <p>This method’s argument list is lengthy and hard to work with (the <code>message</code>
        argument is not even 0-terminated). If we mock it as is, using the mock will be
        awkward. If, however, we try to simplify this interface, we’ll need to fix all
        clients depending on it, which is often infeasible.</p>
      <p>The trick is to redispatch the method in the mock class:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">ScopedMockLog</span> <span class="o">:</span> <span class="k">public</span> <span class="n">LogSink</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="p">...</span>
  <span class="kt">void</span> <span class="n">send</span><span class="p">(</span><span class="n">LogSeverity</span> <span class="n">severity</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">full_filename</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">base_filename</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="k">const</span> <span class="n">tm</span><span class="o">*</span> <span class="n">tm_time</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">message</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">message_len</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
    <span class="c1">// We are only interested in the log severity, full file name, and
</span><span class="c1"></span>    <span class="c1">// log message.
</span><span class="c1"></span>    <span class="n">Log</span><span class="p">(</span><span class="n">severity</span><span class="p">,</span> <span class="n">full_filename</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">message_len</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="c1">// Implements the mock method:
</span><span class="c1"></span>  <span class="c1">//
</span><span class="c1"></span>  <span class="c1">//   void Log(LogSeverity severity,
</span><span class="c1"></span>  <span class="c1">//            const string&amp; file_path,
</span><span class="c1"></span>  <span class="c1">//            const string&amp; message);
</span><span class="c1"></span>  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Log</span><span class="p">,</span>
              <span class="p">(</span><span class="n">LogSeverity</span> <span class="n">severity</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">file_path</span><span class="p">,</span>
               <span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">message</span><span class="p">));</span>
<span class="p">};</span>
</pre>
      <p>By defining a new mock method with a trimmed argument list, we make the mock
        class more user-friendly.</p>
      <p>This technique may also be applied to make overloaded methods more amenable to
        mocking. For example, when overloads have been used to implement default
        arguments:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">MockTurtleFactory</span> <span class="o">:</span> <span class="k">public</span> <span class="n">TurtleFactory</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">Turtle</span><span class="o">*</span> <span class="n">MakeTurtle</span><span class="p">(</span><span class="kt">int</span> <span class="n">length</span><span class="p">,</span> <span class="kt">int</span> <span class="n">weight</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
  <span class="n">Turtle</span><span class="o">*</span> <span class="nf">MakeTurtle</span><span class="p">(</span><span class="kt">int</span> <span class="n">length</span><span class="p">,</span> <span class="kt">int</span> <span class="n">weight</span><span class="p">,</span> <span class="kt">int</span> <span class="n">speed</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

  <span class="c1">// the above methods delegate to this one:
</span><span class="c1"></span>  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="n">Turtle</span><span class="o">*</span><span class="p">,</span> <span class="n">DoMakeTurtle</span><span class="p">,</span> <span class="p">());</span>
<span class="p">};</span>
</pre>
      <p>This allows tests that don’t care which overload was invoked to avoid specifying
        argument matchers:</p>
      <pre class="chroma"><span class="n">ON_CALL</span><span class="p">(</span><span class="n">factory</span><span class="p">,</span> <span class="n">DoMakeTurtle</span><span class="p">)</span>
    <span class="p">.</span><span class="n">WillByDefault</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="n">MakeMockTurtle</span><span class="p">()));</span>
</pre>
      <h3 id="alternative-to-mocking-concrete-classes">Alternative to Mocking Concrete Classes</h3>
      <p>Often you may find yourself using classes that don’t implement interfaces. In
        order to test your code that uses such a class (let’s call it <code>Concrete</code>), you
        may be tempted to make the methods of <code>Concrete</code> virtual and then mock it.</p>
      <p>Try not to do that.</p>
      <p>Making a non-virtual function virtual is a big decision. It creates an extension
        point where subclasses can tweak your class' behavior. This weakens your control
        on the class because now it’s harder to maintain the class invariants. You
        should make a function virtual only when there is a valid reason for a subclass
        to override it.</p>
      <p>Mocking concrete classes directly is problematic as it creates a tight coupling
        between the class and the tests - any small change in the class may invalidate
        your tests and make test maintenance a pain.</p>
      <p>To avoid such problems, many programmers have been practicing “coding to
        interfaces”: instead of talking to the <code>Concrete</code> class, your code would define
        an interface and talk to it. Then you implement that interface as an adaptor on
        top of <code>Concrete</code>. In tests, you can easily mock that interface to observe how
        your code is doing.</p>
      <p>This technique incurs some overhead:</p>
      <ul>
        <li>You pay the cost of virtual function calls (usually not a problem).</li>
        <li>There is more abstraction for the programmers to learn.</li>
      </ul>
      <p>However, it can also bring significant benefits in addition to better
        testability:</p>
      <ul>
        <li><code>Concrete</code>’s API may not fit your problem domain very well, as you may not
          be the only client it tries to serve. By designing your own interface, you
          have a chance to tailor it to your need - you may add higher-level
          functionalities, rename stuff, etc instead of just trimming the class. This
          allows you to write your code (user of the interface) in a more natural way,
          which means it will be more readable, more maintainable, and you’ll be more
          productive.</li>
        <li>If <code>Concrete</code>’s implementation ever has to change, you don’t have to rewrite
          everywhere it is used. Instead, you can absorb the change in your
          implementation of the interface, and your other code and tests will be
          insulated from this change.</li>
      </ul>
      <p>Some people worry that if everyone is practicing this technique, they will end
        up writing lots of redundant code. This concern is totally understandable.
        However, there are two reasons why it may not be the case:</p>
      <ul>
        <li>Different projects may need to use <code>Concrete</code> in different ways, so the best
          interfaces for them will be different. Therefore, each of them will have its
          own domain-specific interface on top of <code>Concrete</code>, and they will not be the
          same code.</li>
        <li>If enough projects want to use the same interface, they can always share it,
          just like they have been sharing <code>Concrete</code>. You can check in the interface
          and the adaptor somewhere near <code>Concrete</code> (perhaps in a <code>contrib</code>
          sub-directory) and let many projects use it.</li>
      </ul>
      <p>You need to weigh the pros and cons carefully for your particular problem, but
        I’d like to assure you that the Java community has been practicing this for a
        long time and it’s a proven effective technique applicable in a wide variety of
        situations. :-)</p>
      <h3 id="delegating-calls-to-a-fake-delegatingtofake">Delegating Calls to a Fake {#DelegatingToFake}</h3>
      <p>Some times you have a non-trivial fake implementation of an interface. For
        example:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Foo</span><span class="p">()</span> <span class="p">{}</span>
  <span class="k">virtual</span> <span class="kt">char</span> <span class="nf">DoThis</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">DoThat</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">FakeFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">char</span> <span class="n">DoThis</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="sc">'+'</span> <span class="o">:</span>
           <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="sc">'-'</span> <span class="o">:</span> <span class="sc">'0'</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="nf">DoThat</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre>
      <p>Now you want to mock this interface such that you can set expectations on it.
        However, you also want to use <code>FakeFoo</code> for the default behavior, as duplicating
        it in the mock object is, well, a lot of work.</p>
      <p>When you define the mock class using gMock, you can have it delegate its default
        action to a fake class you already have, using this pattern:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="c1">// Normal mock method definitions using gMock.
</span><span class="c1"></span>  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">char</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">p</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>

  <span class="c1">// Delegates the default actions of the methods to a FakeFoo object.
</span><span class="c1"></span>  <span class="c1">// This must be called *before* the custom ON_CALL() statements.
</span><span class="c1"></span>  <span class="kt">void</span> <span class="nf">DelegateToFake</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ON_CALL</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">).</span><span class="n">WillByDefault</span><span class="p">([</span><span class="k">this</span><span class="p">](</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">fake_</span><span class="p">.</span><span class="n">DoThis</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="n">ON_CALL</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">).</span><span class="n">WillByDefault</span><span class="p">([</span><span class="k">this</span><span class="p">](</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">fake_</span><span class="p">.</span><span class="n">DoThat</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="n">FakeFoo</span> <span class="n">fake_</span><span class="p">;</span>  <span class="c1">// Keeps an instance of the fake in the mock.
</span><span class="c1"></span><span class="p">};</span>
</pre>
      <p>With that, you can use <code>MockFoo</code> in your tests as usual. Just remember that if
        you don’t explicitly set an action in an <code>ON_CALL()</code> or <code>EXPECT_CALL()</code>, the
        fake will be called upon to do it.:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">AbcTest</span><span class="p">,</span> <span class="n">Xyz</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">MockFoo</span> <span class="n">foo</span><span class="p">;</span>

  <span class="n">foo</span><span class="p">.</span><span class="n">DelegateToFake</span><span class="p">();</span>  <span class="c1">// Enables the fake for delegation.
</span><span class="c1"></span>
  <span class="c1">// Put your ON_CALL(foo, ...)s here, if any.
</span><span class="c1"></span>
  <span class="c1">// No action specified, meaning to use the default action.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">));</span>

  <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">DoThis</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="sc">'+'</span><span class="p">);</span>  <span class="c1">// FakeFoo::DoThis() is invoked.
</span><span class="c1"></span>  <span class="n">foo</span><span class="p">.</span><span class="n">DoThat</span><span class="p">(</span><span class="s">"Hi"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>  <span class="c1">// FakeFoo::DoThat() is invoked.
</span><span class="c1"></span>  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>
</pre>
      <p><strong>Some tips:</strong></p>
      <ul>
        <li>
          <p>If you want, you can still override the default action by providing your own
            <code>ON_CALL()</code> or using <code>.WillOnce()</code> / <code>.WillRepeatedly()</code> in
            <code>EXPECT_CALL()</code>.
          </p>
        </li>
        <li>
          <p>In <code>DelegateToFake()</code>, you only need to delegate the methods whose fake
            implementation you intend to use.</p>
        </li>
        <li>
          <p>The general technique discussed here works for overloaded methods, but
            you’ll need to tell the compiler which version you mean. To disambiguate a
            mock function (the one you specify inside the parentheses of <code>ON_CALL()</code>),
            use <a href="#SelectOverload">this technique</a>; to disambiguate a fake function (the
            one you place inside <code>Invoke()</code>), use a <code>static_cast</code> to specify the
            function’s type. For instance, if class <code>Foo</code> has methods <code>char DoThis(int n)</code> and
            <code>bool DoThis(double x) const</code>, and you want to invoke the latter,
            you need to write
            <code>Invoke(&amp;fake_, static_cast&lt;bool (FakeFoo::*)(double) const&gt;(&amp;FakeFoo::DoThis))</code>
            instead of <code>Invoke(&amp;fake_, &amp;FakeFoo::DoThis)</code>
            (The strange-looking thing inside the angled brackets of <code>static_cast</code> is
            the type of a function pointer to the second <code>DoThis()</code> method.).
          </p>
        </li>
        <li>
          <p>Having to mix a mock and a fake is often a sign of something gone wrong.
            Perhaps you haven’t got used to the interaction-based way of testing yet. Or
            perhaps your interface is taking on too many roles and should be split up.
            Therefore, <strong>don’t abuse this</strong>. We would only recommend to do it as an
            intermediate step when you are refactoring your code.</p>
        </li>
      </ul>
      <p>Regarding the tip on mixing a mock and a fake, here’s an example on why it may
        be a bad sign: Suppose you have a class <code>System</code> for low-level system
        operations. In particular, it does file and I/O operations. And suppose you want
        to test how your code uses <code>System</code> to do I/O, and you just want the file
        operations to work normally. If you mock out the entire <code>System</code> class, you’ll
        have to provide a fake implementation for the file operation part, which
        suggests that <code>System</code> is taking on too many roles.</p>
      <p>Instead, you can define a <code>FileOps</code> interface and an <code>IOOps</code> interface and split
        <code>System</code>’s functionalities into the two. Then you can mock <code>IOOps</code> without
        mocking <code>FileOps</code>.
      </p>
      <h3 id="delegating-calls-to-a-real-object">Delegating Calls to a Real Object</h3>
      <p>When using testing doubles (mocks, fakes, stubs, and etc), sometimes their
        behaviors will differ from those of the real objects. This difference could be
        either intentional (as in simulating an error such that you can test the error
        handling code) or unintentional. If your mocks have different behaviors than the
        real objects by mistake, you could end up with code that passes the tests but
        fails in production.</p>
      <p>You can use the <em>delegating-to-real</em> technique to ensure that your mock has the
        same behavior as the real object while retaining the ability to validate calls.
        This technique is very similar to the <a href="#DelegatingToFake">delegating-to-fake</a>
        technique, the difference being that we use a real object instead of a fake.
        Here’s an example:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">AtLeast</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MockFoo</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// By default, all calls are delegated to the real object.
</span><span class="c1"></span>    <span class="n">ON_CALL</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">).</span><span class="n">WillByDefault</span><span class="p">([</span><span class="k">this</span><span class="p">](</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">real_</span><span class="p">.</span><span class="n">DoThis</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="n">ON_CALL</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">).</span><span class="n">WillByDefault</span><span class="p">([</span><span class="k">this</span><span class="p">](</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">real_</span><span class="p">.</span><span class="n">DoThat</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="p">...</span>
  <span class="p">}</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">char</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">,</span> <span class="p">...);</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">,</span> <span class="p">...);</span>
  <span class="p">...</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">Foo</span> <span class="n">real_</span><span class="p">;</span>
<span class="p">};</span>

<span class="p">...</span>
  <span class="n">MockFoo</span> <span class="n">mock</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">())</span>
      <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">(</span><span class="s">"Hi"</span><span class="p">))</span>
      <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">AtLeast</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
  <span class="p">...</span> <span class="n">use</span> <span class="n">mock</span> <span class="n">in</span> <span class="n">test</span> <span class="p">...</span>
</pre>
      <p>With this, gMock will verify that your code made the right calls (with the right
        arguments, in the right order, called the right number of times, etc), and a
        real object will answer the calls (so the behavior will be the same as in
        production). This gives you the best of both worlds.</p>
      <h3 id="delegating-calls-to-a-parent-class">Delegating Calls to a Parent Class</h3>
      <p>Ideally, you should code to interfaces, whose methods are all pure virtual. In
        reality, sometimes you do need to mock a virtual method that is not pure (i.e,
        it already has an implementation). For example:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Foo</span><span class="p">();</span>

  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">Pure</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">Concrete</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="c1">// Mocking a pure method.
</span><span class="c1"></span>  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Pure</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="c1">// Mocking a concrete method.  Foo::Concrete() is shadowed.
</span><span class="c1"></span>  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">Concrete</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>
</pre>
      <p>Sometimes you may want to call <code>Foo::Concrete()</code> instead of
        <code>MockFoo::Concrete()</code>. Perhaps you want to do it as part of a stub action, or
        perhaps your test doesn’t need to mock <code>Concrete()</code> at all (but it would be
        oh-so painful to have to define a new mock class whenever you don’t need to mock
        one of its methods).
      </p>
      <p>You can call <code>Foo::Concrete()</code> inside an action by:</p>
      <pre class="chroma"><span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Concrete</span><span class="p">).</span><span class="n">WillOnce</span><span class="p">([</span><span class="o">&amp;</span><span class="n">foo</span><span class="p">](</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">foo</span><span class="p">.</span><span class="n">Foo</span><span class="o">::</span><span class="n">Concrete</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
  <span class="p">});</span>
</pre>
      <p>or tell the mock object that you don’t want to mock <code>Concrete()</code>:</p>
      <pre class="chroma"><span class="p">...</span>
  <span class="n">ON_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Concrete</span><span class="p">).</span><span class="n">WillByDefault</span><span class="p">([</span><span class="o">&amp;</span><span class="n">foo</span><span class="p">](</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">foo</span><span class="p">.</span><span class="n">Foo</span><span class="o">::</span><span class="n">Concrete</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
  <span class="p">});</span>
</pre>
      <p>(Why don’t we just write <code>{ return foo.Concrete(str); }</code>? If you do that,
        <code>MockFoo::Concrete()</code> will be called (and cause an infinite recursion) since
        <code>Foo::Concrete()</code> is virtual. That’s just how C++ works.)
      </p>
      <h2 id="using-matchers">Using Matchers</h2>
      <h3 id="matching-argument-values-exactly">Matching Argument Values Exactly</h3>
      <p>You can specify exactly which arguments a mock method is expecting:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="sc">'a'</span><span class="p">));</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">,</span> <span class="n">bar</span><span class="p">));</span>
</pre>
      <h3 id="using-simple-matchers">Using Simple Matchers</h3>
      <p>You can use matchers to match arguments that have a certain property:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">NotNull</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">(</span><span class="n">Ge</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>  <span class="c1">// The argument must be &gt;= 5.
</span><span class="c1"></span>      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="sc">'a'</span><span class="p">));</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">,</span> <span class="n">NotNull</span><span class="p">()));</span>
      <span class="c1">// The second argument must not be NULL.
</span></pre>
      <p>A frequently used matcher is <code>_</code>, which matches anything:</p>
      <pre class="chroma">  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">NotNull</span><span class="p">()));</span>
</pre>
      <h3 id="combining-matchers-combiningmatchers">Combining Matchers {#CombiningMatchers}</h3>
      <p>You can build complex matchers from existing ones using <code>AllOf()</code>,
        <code>AllOfArray()</code>, <code>AnyOf()</code>, <code>AnyOfArray()</code> and <code>Not()</code>:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">AllOf</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Gt</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">HasSubstr</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Ne</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Not</span><span class="p">;</span>
<span class="p">...</span>
  <span class="c1">// The argument must be &gt; 5 and != 10.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">(</span><span class="n">AllOf</span><span class="p">(</span><span class="n">Gt</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
                                <span class="n">Ne</span><span class="p">(</span><span class="mi">10</span><span class="p">))));</span>

  <span class="c1">// The first argument must not contain sub-string "blah".
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">(</span><span class="n">Not</span><span class="p">(</span><span class="n">HasSubstr</span><span class="p">(</span><span class="s">"blah"</span><span class="p">)),</span>
                          <span class="nb">NULL</span><span class="p">));</span>
</pre>
      <p>Matchers are function objects, and parametrized matchers can be composed just
        like any other function. However because their types can be long and rarely
        provide meaningful information, it can be easier to express them with C++14
        generic lambdas to avoid specifying types. For example,</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Contains</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Property</span><span class="p">;</span>

<span class="kr">inline</span> <span class="k">constexpr</span> <span class="k">auto</span> <span class="n">HasFoo</span> <span class="o">=</span> <span class="p">[](</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">Property</span><span class="p">(</span><span class="s">"foo"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">MyClass</span><span class="o">::</span><span class="n">foo</span><span class="p">,</span> <span class="n">Contains</span><span class="p">(</span><span class="n">f</span><span class="p">));</span>
<span class="p">};</span>
<span class="p">...</span>
  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">HasFoo</span><span class="p">(</span><span class="s">"blah"</span><span class="p">));</span>
</pre>
      <h3 id="casting-matchers-safematchercast">Casting Matchers {#SafeMatcherCast}</h3>
      <p>gMock matchers are statically typed, meaning that the compiler can catch your
        mistake if you use a matcher of the wrong type (for example, if you use <code>Eq(5)</code>
        to match a <code>string</code> argument). Good for you!</p>
      <p>Sometimes, however, you know what you’re doing and want the compiler to give you
        some slack. One example is that you have a matcher for <code>long</code> and the argument
        you want to match is <code>int</code>. While the two types aren’t exactly the same, there
        is nothing really wrong with using a <code>Matcher&lt;long&gt;</code> to match an <code>int</code> - after
        all, we can first convert the <code>int</code> argument to a <code>long</code> losslessly before
        giving it to the matcher.</p>
      <p>To support this need, gMock gives you the <code>SafeMatcherCast&lt;T&gt;(m)</code> function. It
        casts a matcher <code>m</code> to type <code>Matcher&lt;T&gt;</code>. To ensure safety, gMock checks that
        (let <code>U</code> be the type <code>m</code> accepts :</p>
      <ol>
        <li>Type <code>T</code> can be <em>implicitly</em> cast to type <code>U</code>;</li>
        <li>When both <code>T</code> and <code>U</code> are built-in arithmetic types (<code>bool</code>, integers, and
          floating-point numbers), the conversion from <code>T</code> to <code>U</code> is not lossy (in
          other words, any value representable by <code>T</code> can also be represented by <code>U</code>);
          and</li>
        <li>When <code>U</code> is a reference, <code>T</code> must also be a reference (as the underlying
          matcher may be interested in the address of the <code>U</code> value).</li>
      </ol>
      <p>The code won’t compile if any of these conditions isn’t met.</p>
      <p>Here’s one example:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">SafeMatcherCast</span><span class="p">;</span>

<span class="c1">// A base class and a child class.
</span><span class="c1"></span><span class="k">class</span> <span class="nc">Base</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
<span class="k">class</span> <span class="nc">Derived</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Base</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>

<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">,</span> <span class="p">(</span><span class="n">Derived</span><span class="o">*</span> <span class="n">derived</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>

<span class="p">...</span>
  <span class="n">MockFoo</span> <span class="n">foo</span><span class="p">;</span>
  <span class="c1">// m is a Matcher&lt;Base*&gt; we got from somewhere.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">(</span><span class="n">SafeMatcherCast</span><span class="o">&lt;</span><span class="n">Derived</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">m</span><span class="p">)));</span>
</pre>
      <p>If you find <code>SafeMatcherCast&lt;T&gt;(m)</code> too limiting, you can use a similar function
        <code>MatcherCast&lt;T&gt;(m)</code>. The difference is that <code>MatcherCast</code> works as long as you
        can <code>static_cast</code> type <code>T</code> to type <code>U</code>.
      </p>
      <p><code>MatcherCast</code> essentially lets you bypass C++’s type system (<code>static_cast</code> isn’t
        always safe as it could throw away information, for example), so be careful not
        to misuse/abuse it.</p>
      <h3 id="selecting-between-overloaded-functions-selectoverload">Selecting Between Overloaded Functions
        {#SelectOverload}</h3>
      <p>If you expect an overloaded function to be called, the compiler may need some
        help on which overloaded version it is.</p>
      <p>To disambiguate functions overloaded on the const-ness of this object, use the
        <code>Const()</code> argument wrapper.
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">ReturnRef</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="n">Bar</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">GetBar</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="k">const</span> <span class="n">Bar</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">GetBar</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">const</span><span class="p">,</span> <span class="k">override</span><span class="p">));</span>
<span class="p">};</span>

<span class="p">...</span>
  <span class="n">MockFoo</span> <span class="n">foo</span><span class="p">;</span>
  <span class="n">Bar</span> <span class="n">bar1</span><span class="p">,</span> <span class="n">bar2</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">GetBar</span><span class="p">())</span>         <span class="c1">// The non-const GetBar().
</span><span class="c1"></span>      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">ReturnRef</span><span class="p">(</span><span class="n">bar1</span><span class="p">));</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">Const</span><span class="p">(</span><span class="n">foo</span><span class="p">),</span> <span class="n">GetBar</span><span class="p">())</span>  <span class="c1">// The const GetBar().
</span><span class="c1"></span>      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">ReturnRef</span><span class="p">(</span><span class="n">bar2</span><span class="p">));</span>
</pre>
      <p>(<code>Const()</code> is defined by gMock and returns a <code>const</code> reference to its argument.)</p>
      <p>To disambiguate overloaded functions with the same number of arguments but
        different argument types, you may need to specify the exact type of a matcher,
        either by wrapping your matcher in <code>Matcher&lt;type&gt;()</code>, or using a matcher whose
        type is fixed (<code>TypedEq&lt;type&gt;</code>, <code>An&lt;type&gt;()</code>, etc):</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">An</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Matcher</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">TypedEq</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MockPrinter</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Printer</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Print</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Print</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">PrinterTest</span><span class="p">,</span> <span class="n">Print</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">MockPrinter</span> <span class="n">printer</span><span class="p">;</span>

  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">printer</span><span class="p">,</span> <span class="n">Print</span><span class="p">(</span><span class="n">An</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">()));</span>            <span class="c1">// void Print(int);
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">printer</span><span class="p">,</span> <span class="n">Print</span><span class="p">(</span><span class="n">Matcher</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Lt</span><span class="p">(</span><span class="mi">5</span><span class="p">))));</span>  <span class="c1">// void Print(int);
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">printer</span><span class="p">,</span> <span class="n">Print</span><span class="p">(</span><span class="n">TypedEq</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="sc">'a'</span><span class="p">)));</span>   <span class="c1">// void Print(char);
</span><span class="c1"></span>
  <span class="n">printer</span><span class="p">.</span><span class="n">Print</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="n">printer</span><span class="p">.</span><span class="n">Print</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
  <span class="n">printer</span><span class="p">.</span><span class="n">Print</span><span class="p">(</span><span class="sc">'a'</span><span class="p">);</span>
<span class="p">}</span>
</pre>
      <h3 id="performing-different-actions-based-on-the-arguments">Performing Different Actions Based on the Arguments
      </h3>
      <p>When a mock method is called, the <em>last</em> matching expectation that’s still
        active will be selected (think “newer overrides older”). So, you can make a
        method do different things depending on its argument values like this:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Lt</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
  <span class="c1">// The default case.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="sc">'b'</span><span class="p">));</span>
  <span class="c1">// The more specific case.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">(</span><span class="n">Lt</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
      <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="sc">'a'</span><span class="p">));</span>
</pre>
      <p>Now, if <code>foo.DoThis()</code> is called with a value less than 5, <code>'a'</code> will be
        returned; otherwise <code>'b'</code> will be returned.</p>
      <h3 id="matching-multiple-arguments-as-a-whole">Matching Multiple Arguments as a Whole</h3>
      <p>Sometimes it’s not enough to match the arguments individually. For example, we
        may want to say that the first argument must be less than the second argument.
        The <code>With()</code> clause allows us to match all arguments of a mock function as a
        whole. For example,</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Ne</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Lt</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">InRange</span><span class="p">(</span><span class="n">Ne</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">With</span><span class="p">(</span><span class="n">Lt</span><span class="p">());</span>
</pre>
      <p>says that the first argument of <code>InRange()</code> must not be 0, and must be less than
        the second argument.</p>
      <p>The expression inside <code>With()</code> must be a matcher of type
        <code>Matcher&lt;std::tuple&lt;A1, ..., An&gt;&gt;</code>, where <code>A1</code>, …, <code>An</code> are the
        types of the function arguments.
      </p>
      <p>You can also write <code>AllArgs(m)</code> instead of <code>m</code> inside <code>.With()</code>. The two forms
        are equivalent, but <code>.With(AllArgs(Lt()))</code> is more readable than <code>.With(Lt())</code>.</p>
      <p>You can use <code>Args&lt;k1, ..., kn&gt;(m)</code> to match the <code>n</code> selected arguments (as a
        tuple) against <code>m</code>. For example,</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">AllOf</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Args</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Lt</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Blah</span><span class="p">)</span>
      <span class="p">.</span><span class="n">With</span><span class="p">(</span><span class="n">AllOf</span><span class="p">(</span><span class="n">Args</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Lt</span><span class="p">()),</span> <span class="n">Args</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Lt</span><span class="p">())));</span>
</pre>
      <p>says that <code>Blah</code> will be called with arguments <code>x</code>, <code>y</code>, and <code>z</code>
        where <code>x &lt; y &lt; z</code>. Note that in this example, it wasn’t necessary to specify the positional
        matchers.</p>
      <p>As a convenience and example, gMock provides some matchers for 2-tuples,
        including the <code>Lt()</code> matcher above. See
        <a href="reference/matchers.md#MultiArgMatchers">Multi-argument Matchers</a> for the
        complete list.
      </p>
      <p>Note that if you want to pass the arguments to a predicate of your own (e.g.
        <code>.With(Args&lt;0, 1&gt;(Truly(&amp;MyPredicate)))</code>), that predicate MUST be written to
        take a <code>std::tuple</code> as its argument; gMock will pass the <code>n</code> selected arguments
        as <em>one</em> single tuple to the predicate.
      </p>
      <h3 id="using-matchers-as-predicates">Using Matchers as Predicates</h3>
      <p>Have you noticed that a matcher is just a fancy predicate that also knows how to
        describe itself? Many existing algorithms take predicates as arguments (e.g.
        those defined in STL’s <code>&lt;algorithm&gt;</code> header), and it would be a shame if gMock
        matchers were not allowed to participate.</p>
      <p>Luckily, you can use a matcher where a unary predicate functor is expected by
        wrapping it inside the <code>Matches()</code> function. For example,</p>
      <pre class="chroma"><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Matches</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Ge</span><span class="p">;</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
<span class="p">...</span>
<span class="c1">// How many elements in v are &gt;= 10?
</span><span class="c1"></span><span class="k">const</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">count_if</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">Matches</span><span class="p">(</span><span class="n">Ge</span><span class="p">(</span><span class="mi">10</span><span class="p">)));</span>
</pre>
      <p>Since you can build complex matchers from simpler ones easily using gMock, this
        gives you a way to conveniently construct composite predicates (doing the same
        using STL’s <code>&lt;functional&gt;</code> header is just painful). For example, here’s a
        predicate that’s satisfied by any number that is &gt;= 0, &lt;= 100, and != 50:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">AllOf</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Ge</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Le</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Matches</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Ne</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">Matches</span><span class="p">(</span><span class="n">AllOf</span><span class="p">(</span><span class="n">Ge</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">Le</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">Ne</span><span class="p">(</span><span class="mi">50</span><span class="p">)))</span>
</pre>
      <h3 id="using-matchers-in-googletest-assertions">Using Matchers in googletest Assertions</h3>
      <p>See <a href="reference/assertions.md#EXPECT_THAT"><code>EXPECT_THAT</code></a> in the Assertions
        Reference.</p>
      <h3 id="using-predicates-as-matchers">Using Predicates as Matchers</h3>
      <p>gMock provides a set of built-in matchers for matching arguments with expected
        values—see the <a href="reference/matchers.md">Matchers Reference</a> for more information.
        In case you find the built-in set lacking, you can use an arbitrary unary
        predicate function or functor as a matcher - as long as the predicate accepts a
        value of the type you want. You do this by wrapping the predicate inside the
        <code>Truly()</code> function, for example:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Truly</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">IsEven</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
<span class="p">...</span>
  <span class="c1">// Bar() must be called with an even number.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="n">Truly</span><span class="p">(</span><span class="n">IsEven</span><span class="p">)));</span>
</pre>
      <p>Note that the predicate function / functor doesn’t have to return <code>bool</code>. It
        works as long as the return value can be used as the condition in the statement
        <code>if (condition) ...</code>.
      </p>
      <h3 id="matching-arguments-that-are-not-copyable">Matching Arguments that Are Not Copyable</h3>
      <p>When you do an <code>EXPECT_CALL(mock_obj, Foo(bar))</code>, gMock saves away a copy of
        <code>bar</code>. When <code>Foo()</code> is called later, gMock compares the argument to <code>Foo()</code>
        with
        the saved copy of <code>bar</code>. This way, you don’t need to worry about <code>bar</code> being
        modified or destroyed after the <code>EXPECT_CALL()</code> is executed. The same is true
        when you use matchers like <code>Eq(bar)</code>, <code>Le(bar)</code>, and so on.
      </p>
      <p>But what if <code>bar</code> cannot be copied (i.e. has no copy constructor)? You could
        define your own matcher function or callback and use it with <code>Truly()</code>, as the
        previous couple of recipes have shown. Or, you may be able to get away from it
        if you can guarantee that <code>bar</code> won’t be changed after the <code>EXPECT_CALL()</code> is
        executed. Just tell gMock that it should save a reference to <code>bar</code>, instead of a
        copy of it. Here’s how:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Eq</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Lt</span><span class="p">;</span>
<span class="p">...</span>
  <span class="c1">// Expects that Foo()'s argument == bar.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_obj</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ref</span><span class="p">(</span><span class="n">bar</span><span class="p">))));</span>

  <span class="c1">// Expects that Foo()'s argument &lt; bar.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_obj</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(</span><span class="n">Lt</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ref</span><span class="p">(</span><span class="n">bar</span><span class="p">))));</span>
</pre>
      <p>Remember: if you do this, don’t change <code>bar</code> after the <code>EXPECT_CALL()</code>, or the
        result is undefined.</p>
      <h3 id="validating-a-member-of-an-object">Validating a Member of an Object</h3>
      <p>Often a mock function takes a reference to object as an argument. When matching
        the argument, you may not want to compare the entire object against a fixed
        object, as that may be over-specification. Instead, you may need to validate a
        certain member variable or the result of a certain getter method of the object.
        You can do this with <code>Field()</code> and <code>Property()</code>. More specifically,</p>
      <pre class="chroma"><span class="n">Field</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Foo</span><span class="o">::</span><span class="n">bar</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
</pre>
      <p>is a matcher that matches a <code>Foo</code> object whose <code>bar</code> member variable satisfies
        matcher <code>m</code>.</p>
      <pre class="chroma"><span class="n">Property</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Foo</span><span class="o">::</span><span class="n">baz</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
</pre>
      <p>is a matcher that matches a <code>Foo</code> object whose <code>baz()</code> method returns a value
        that satisfies matcher <code>m</code>.</p>
      <p>For example:</p>
      <table>
        <thead>
          <tr>
            <th align="left">Expression</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>Field(&amp;Foo::number, Ge(3))</code></td>
            <td align="left">Matches <code>x</code> where <code>x.number &gt;= 3</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>Property(&amp;Foo::name,  StartsWith("John "))</code></td>
            <td align="left">Matches <code>x</code> where <code>x.name()</code> starts with
              <code>"John "</code>.
            </td>
          </tr>
        </tbody>
      </table>
      <p>Note that in <code>Property(&amp;Foo::baz, ...)</code>, method <code>baz()</code> must take no argument
        and be declared as <code>const</code>. Don’t use <code>Property()</code> against member functions that
        you do not own, because taking addresses of functions is fragile and generally
        not part of the contract of the function.</p>
      <p><code>Field()</code> and <code>Property()</code> can also match plain pointers to objects. For
        instance,</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Field</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Ge</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">Field</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Foo</span><span class="o">::</span><span class="n">number</span><span class="p">,</span> <span class="n">Ge</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre>
      <p>matches a plain pointer <code>p</code> where <code>p-&gt;number &gt;= 3</code>. If <code>p</code> is
        <code>NULL</code>, the match
        will always fail regardless of the inner matcher.
      </p>
      <p>What if you want to validate more than one members at the same time? Remember
        that there are <a href="#CombiningMatchers"><code>AllOf()</code> and <code>AllOfArray()</code></a>.</p>
      <p>Finally <code>Field()</code> and <code>Property()</code> provide overloads that take the field or
        property names as the first argument to include it in the error message. This
        can be useful when creating combined matchers.</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">AllOf</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Field</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Matcher</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">SafeMatcherCast</span><span class="p">;</span>

<span class="n">Matcher</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span> <span class="n">IsFoo</span><span class="p">(</span><span class="k">const</span> <span class="n">Foo</span><span class="o">&amp;</span> <span class="n">foo</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">AllOf</span><span class="p">(</span><span class="n">Field</span><span class="p">(</span><span class="s">"some_field"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Foo</span><span class="o">::</span><span class="n">some_field</span><span class="p">,</span> <span class="n">foo</span><span class="p">.</span><span class="n">some_field</span><span class="p">),</span>
               <span class="n">Field</span><span class="p">(</span><span class="s">"other_field"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Foo</span><span class="o">::</span><span class="n">other_field</span><span class="p">,</span> <span class="n">foo</span><span class="p">.</span><span class="n">other_field</span><span class="p">),</span>
               <span class="n">Field</span><span class="p">(</span><span class="s">"last_field"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Foo</span><span class="o">::</span><span class="n">last_field</span><span class="p">,</span> <span class="n">foo</span><span class="p">.</span><span class="n">last_field</span><span class="p">));</span>
<span class="p">}</span>
</pre>
      <h3 id="validating-the-value-pointed-to-by-a-pointer-argument">Validating the Value Pointed to by a Pointer
        Argument</h3>
      <p>C++ functions often take pointers as arguments. You can use matchers like
        <code>IsNull()</code>, <code>NotNull()</code>, and other comparison matchers to match a pointer, but
        what if you want to make sure the value <em>pointed to</em> by the pointer, instead of
        the pointer itself, has a certain property? Well, you can use the <code>Pointee(m)</code>
        matcher.
      </p>
      <p><code>Pointee(m)</code> matches a pointer if and only if <code>m</code> matches the value the pointer
        points to. For example:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Ge</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Pointee</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="n">Pointee</span><span class="p">(</span><span class="n">Ge</span><span class="p">(</span><span class="mi">3</span><span class="p">))));</span>
</pre>
      <p>expects <code>foo.Bar()</code> to be called with a pointer that points to a value greater
        than or equal to 3.</p>
      <p>One nice thing about <code>Pointee()</code> is that it treats a <code>NULL</code> pointer as a match
        failure, so you can write <code>Pointee(m)</code> instead of</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">AllOf</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">NotNull</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Pointee</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">AllOf</span><span class="p">(</span><span class="n">NotNull</span><span class="p">(),</span> <span class="n">Pointee</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</pre>
      <p>without worrying that a <code>NULL</code> pointer will crash your test.</p>
      <p>Also, did we tell you that <code>Pointee()</code> works with both raw pointers <strong>and</strong>
        smart pointers (<code>std::unique_ptr</code>, <code>std::shared_ptr</code>, etc)?</p>
      <p>What if you have a pointer to pointer? You guessed it - you can use nested
        <code>Pointee()</code> to probe deeper inside the value. For example,
        <code>Pointee(Pointee(Lt(3)))</code> matches a pointer that points to a pointer that points
        to a number less than 3 (what a mouthful…).
      </p>
      <h3 id="defining-a-custom-matcher-class-custommatcherclass">Defining a Custom Matcher Class {#CustomMatcherClass}
      </h3>
      <p>Most matchers can be simply defined using <a href="#NewMatchers">the MATCHER* macros</a>,
        which are terse and flexible, and produce good error messages. However, these
        macros are not very explicit about the interfaces they create and are not always
        suitable, especially for matchers that will be widely reused.</p>
      <p>For more advanced cases, you may need to define your own matcher class. A custom
        matcher allows you to test a specific invariant property of that object. Let’s
        take a look at how to do so.</p>
      <p>Imagine you have a mock function that takes an object of type <code>Foo</code>, which has
        an <code>int bar()</code> method and an <code>int baz()</code> method. You want to constrain that the
        argument’s <code>bar()</code> value plus its <code>baz()</code> value is a given number. (This is an
        invariant.) Here’s how we can write and use a matcher class to do so:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">BarPlusBazEqMatcher</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">is_gtest_matcher</span> <span class="o">=</span> <span class="kt">void</span><span class="p">;</span>

  <span class="k">explicit</span> <span class="nf">BarPlusBazEqMatcher</span><span class="p">(</span><span class="kt">int</span> <span class="n">expected_sum</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">expected_sum_</span><span class="p">(</span><span class="n">expected_sum</span><span class="p">)</span> <span class="p">{}</span>

  <span class="kt">bool</span> <span class="nf">MatchAndExplain</span><span class="p">(</span><span class="k">const</span> <span class="n">Foo</span><span class="o">&amp;</span> <span class="n">foo</span><span class="p">,</span>
                       <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="cm">/* listener */</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">bar</span><span class="p">()</span> <span class="o">+</span> <span class="n">foo</span><span class="p">.</span><span class="n">baz</span><span class="p">())</span> <span class="o">==</span> <span class="n">expected_sum_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="nf">DescribeTo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"bar() + baz() equals "</span> <span class="o">&lt;&lt;</span> <span class="n">expected_sum_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="nf">DescribeNegationTo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"bar() + baz() does not equal "</span> <span class="o">&lt;&lt;</span> <span class="n">expected_sum_</span><span class="p">;</span>
  <span class="p">}</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="k">const</span> <span class="kt">int</span> <span class="n">expected_sum_</span><span class="p">;</span>
<span class="p">};</span>

<span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Matcher</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Foo</span><span class="o">&amp;&gt;</span> <span class="n">BarPlusBazEq</span><span class="p">(</span><span class="kt">int</span> <span class="n">expected_sum</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">BarPlusBazEqMatcher</span><span class="p">(</span><span class="n">expected_sum</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">...</span>
  <span class="n">Foo</span> <span class="n">foo</span><span class="p">;</span>
  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">BarPlusBazEq</span><span class="p">(</span><span class="mi">5</span><span class="p">))...;</span>
</pre>
      <h3 id="matching-containers">Matching Containers</h3>
      <p>Sometimes an STL container (e.g. list, vector, map, …) is passed to a mock
        function and you may want to validate it. Since most STL containers support the
        <code>==</code> operator, you can write <code>Eq(expected_container)</code> or simply
        <code>expected_container</code> to match a container exactly.
      </p>
      <p>Sometimes, though, you may want to be more flexible (for example, the first
        element must be an exact match, but the second element can be any positive
        number, and so on). Also, containers used in tests often have a small number of
        elements, and having to define the expected container out-of-line is a bit of a
        hassle.</p>
      <p>You can use the <code>ElementsAre()</code> or <code>UnorderedElementsAre()</code> matcher in such
        cases:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">ElementsAre</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Gt</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Foo</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">numbers</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(</span><span class="n">ElementsAre</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">_</span><span class="p">,</span> <span class="mi">5</span><span class="p">)));</span>
</pre>
      <p>The above matcher says that the container must have 4 elements, which must be 1,
        greater than 0, anything, and 5 respectively.</p>
      <p>If you instead write:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Gt</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">UnorderedElementsAre</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Foo</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">numbers</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(</span><span class="n">UnorderedElementsAre</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">_</span><span class="p">,</span> <span class="mi">5</span><span class="p">)));</span>
</pre>
      <p>It means that the container must have 4 elements, which (under some permutation)
        must be 1, greater than 0, anything, and 5 respectively.</p>
      <p>As an alternative you can place the arguments in a C-style array and use
        <code>ElementsAreArray()</code> or <code>UnorderedElementsAreArray()</code> instead:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">ElementsAreArray</span><span class="p">;</span>
<span class="p">...</span>
  <span class="c1">// ElementsAreArray accepts an array of element values.
</span><span class="c1"></span>  <span class="k">const</span> <span class="kt">int</span> <span class="n">expected_vector1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">...};</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(</span><span class="n">ElementsAreArray</span><span class="p">(</span><span class="n">expected_vector1</span><span class="p">)));</span>

  <span class="c1">// Or, an array of element matchers.
</span><span class="c1"></span>  <span class="n">Matcher</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">expected_vector2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">_</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">...};</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(</span><span class="n">ElementsAreArray</span><span class="p">(</span><span class="n">expected_vector2</span><span class="p">)));</span>
</pre>
      <p>In case the array needs to be dynamically created (and therefore the array size
        cannot be inferred by the compiler), you can give <code>ElementsAreArray()</code> an
        additional argument to specify the array size:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">ElementsAreArray</span><span class="p">;</span>
<span class="p">...</span>
  <span class="kt">int</span><span class="o">*</span> <span class="k">const</span> <span class="n">expected_vector3</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">count</span><span class="p">];</span>
  <span class="p">...</span> <span class="n">fill</span> <span class="n">expected_vector3</span> <span class="n">with</span> <span class="n">values</span> <span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(</span><span class="n">ElementsAreArray</span><span class="p">(</span><span class="n">expected_vector3</span><span class="p">,</span> <span class="n">count</span><span class="p">)));</span>
</pre>
      <p>Use <code>Pair</code> when comparing maps or other associative containers.</p>
      <p>{% raw %}</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">UnorderedElementsAre</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Pair</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">absl</span><span class="o">::</span><span class="n">flat_hash_map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="p">{{</span><span class="s">"a"</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s">"b"</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="s">"c"</span><span class="p">,</span> <span class="mi">3</span><span class="p">}};</span>
  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">UnorderedElementsAre</span><span class="p">(</span>
      <span class="n">Pair</span><span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">Pair</span><span class="p">(</span><span class="s">"b"</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">Pair</span><span class="p">(</span><span class="s">"c"</span><span class="p">,</span> <span class="mi">3</span><span class="p">)));</span>
</pre>
      <p>{% endraw %}</p>
      <p><strong>Tips:</strong></p>
      <ul>
        <li><code>ElementsAre*()</code> can be used to match <em>any</em> container that implements the
          STL iterator pattern (i.e. it has a <code>const_iterator</code> type and supports
          <code>begin()/end()</code>), not just the ones defined in STL. It will even work with
          container types yet to be written - as long as they follows the above
          pattern.
        </li>
        <li>You can use nested <code>ElementsAre*()</code> to match nested (multi-dimensional)
          containers.</li>
        <li>If the container is passed by pointer instead of by reference, just write
          <code>Pointee(ElementsAre*(...))</code>.
        </li>
        <li>The order of elements <em>matters</em> for <code>ElementsAre*()</code>. If you are using it
          with containers whose element order are undefined (such as a
          <code>std::unordered_map</code>) you should use <code>UnorderedElementsAre</code>.
        </li>
      </ul>
      <h3 id="sharing-matchers">Sharing Matchers</h3>
      <p>Under the hood, a gMock matcher object consists of a pointer to a ref-counted
        implementation object. Copying matchers is allowed and very efficient, as only
        the pointer is copied. When the last matcher that references the implementation
        object dies, the implementation object will be deleted.</p>
      <p>Therefore, if you have some complex matcher that you want to use again and
        again, there is no need to build it every time. Just assign it to a matcher
        variable and use that variable repeatedly! For example,</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">AllOf</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Gt</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Le</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Matcher</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">Matcher</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">in_range</span> <span class="o">=</span> <span class="n">AllOf</span><span class="p">(</span><span class="n">Gt</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">Le</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
  <span class="p">...</span> <span class="n">use</span> <span class="n">in_range</span> <span class="n">as</span> <span class="n">a</span> <span class="n">matcher</span> <span class="n">in</span> <span class="n">multiple</span> <span class="n">EXPECT_CALLs</span> <span class="p">...</span>
</pre>
      <h3 id="matchers-must-have-no-side-effects-purematchers">Matchers must have no side-effects {#PureMatchers}</h3>
      <p>{: .callout .warning}
        WARNING: gMock does not guarantee when or how many times a matcher will be
        invoked. Therefore, all matchers must be <em>purely functional</em>: they cannot have
        any side effects, and the match result must not depend on anything other than
        the matcher’s parameters and the value being matched.</p>
      <p>This requirement must be satisfied no matter how a matcher is defined (e.g., if
        it is one of the standard matchers, or a custom matcher). In particular, a
        matcher can never call a mock function, as that will affect the state of the
        mock object and gMock.</p>
      <h2 id="setting-expectations">Setting Expectations</h2>
      <h3 id="knowing-when-to-expect-useoncall">Knowing When to Expect {#UseOnCall}</h3>
      <p><strong><code>ON_CALL</code></strong> is likely the <em>single most under-utilized construct</em> in gMock.</p>
      <p>There are basically two constructs for defining the behavior of a mock object:
        <code>ON_CALL</code> and <code>EXPECT_CALL</code>. The difference? <code>ON_CALL</code> defines what happens
        when
        a mock method is called, but <em>doesn’t imply any expectation on the method
          being called</em>. <code>EXPECT_CALL</code> not only defines the behavior, but also sets an
        expectation that <em>the method will be called with the given arguments, for the
          given number of times</em> (and <em>in the given order</em> when you specify the order
        too).
      </p>
      <p>Since <code>EXPECT_CALL</code> does more, isn’t it better than <code>ON_CALL</code>? Not really. Every
        <code>EXPECT_CALL</code> adds a constraint on the behavior of the code under test. Having
        more constraints than necessary is <em>baaad</em> - even worse than not having enough
        constraints.
      </p>
      <p>This may be counter-intuitive. How could tests that verify more be worse than
        tests that verify less? Isn’t verification the whole point of tests?</p>
      <p>The answer lies in <em>what</em> a test should verify. <strong>A good test verifies the
          contract of the code.</strong> If a test over-specifies, it doesn’t leave enough
        freedom to the implementation. As a result, changing the implementation without
        breaking the contract (e.g. refactoring and optimization), which should be
        perfectly fine to do, can break such tests. Then you have to spend time fixing
        them, only to see them broken again the next time the implementation is changed.</p>
      <p>Keep in mind that one doesn’t have to verify more than one property in one test.
        In fact, <strong>it’s a good style to verify only one thing in one test.</strong> If you do
        that, a bug will likely break only one or two tests instead of dozens (which
        case would you rather debug?). If you are also in the habit of giving tests
        descriptive names that tell what they verify, you can often easily guess what’s
        wrong just from the test log itself.</p>
      <p>So use <code>ON_CALL</code> by default, and only use <code>EXPECT_CALL</code> when you actually intend
        to verify that the call is made. For example, you may have a bunch of <code>ON_CALL</code>s
        in your test fixture to set the common mock behavior shared by all tests in the
        same group, and write (scarcely) different <code>EXPECT_CALL</code>s in different <code>TEST_F</code>s
        to verify different aspects of the code’s behavior. Compared with the style
        where each <code>TEST</code> has many <code>EXPECT_CALL</code>s, this leads to tests that are more
        resilient to implementational changes (and thus less likely to require
        maintenance) and makes the intent of the tests more obvious (so they are easier
        to maintain when you do need to maintain them).</p>
      <p>If you are bothered by the “Uninteresting mock function call” message printed
        when a mock method without an <code>EXPECT_CALL</code> is called, you may use a <code>NiceMock</code>
        instead to suppress all such messages for the mock object, or suppress the
        message for specific methods by adding <code>EXPECT_CALL(...).Times(AnyNumber())</code>. DO
        NOT suppress it by blindly adding an <code>EXPECT_CALL(...)</code>, or you’ll have a test
        that’s a pain to maintain.</p>
      <h3 id="ignoring-uninteresting-calls">Ignoring Uninteresting Calls</h3>
      <p>If you are not interested in how a mock method is called, just don’t say
        anything about it. In this case, if the method is ever called, gMock will
        perform its default action to allow the test program to continue. If you are not
        happy with the default action taken by gMock, you can override it using
        <code>DefaultValue&lt;T&gt;::Set()</code> (described <a href="#DefaultValue">here</a>) or
        <code>ON_CALL()</code>.
      </p>
      <p>Please note that once you expressed interest in a particular mock method (via
        <code>EXPECT_CALL()</code>), all invocations to it must match some expectation. If this
        function is called but the arguments don’t match any <code>EXPECT_CALL()</code> statement,
        it will be an error.
      </p>
      <h3 id="disallowing-unexpected-calls">Disallowing Unexpected Calls</h3>
      <p>If a mock method shouldn’t be called at all, explicitly say so:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</pre>
      <p>If some calls to the method are allowed, but the rest are not, just list all the
        expected calls:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">AnyNumber</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Gt</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="n">Gt</span><span class="p">(</span><span class="mi">10</span><span class="p">)))</span>
      <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">AnyNumber</span><span class="p">());</span>
</pre>
      <p>A call to <code>foo.Bar()</code> that doesn’t match any of the <code>EXPECT_CALL()</code> statements
        will be an error.</p>
      <h3 id="understanding-uninteresting-vs-unexpected-calls-uninteresting-vs-unexpected">Understanding Uninteresting
        vs Unexpected Calls {#uninteresting-vs-unexpected}</h3>
      <p><em>Uninteresting</em> calls and <em>unexpected</em> calls are different concepts in gMock.
        <em>Very</em> different.
      </p>
      <p>A call <code>x.Y(...)</code> is <strong>uninteresting</strong> if there’s <em>not even a single</em>
        <code>EXPECT_CALL(x, Y(...))</code> set. In other words, the test isn’t interested in the
        <code>x.Y()</code> method at all, as evident in that the test doesn’t care to say anything
        about it.
      </p>
      <p>A call <code>x.Y(...)</code> is <strong>unexpected</strong> if there are <em>some</em>
        <code>EXPECT_CALL(x, Y(...))</code>s set, but none of them matches the call. Put another way, the test is
        interested in the <code>x.Y()</code> method (therefore it explicitly sets some
        <code>EXPECT_CALL</code> to verify how it’s called); however, the verification fails as the
        test doesn’t expect this particular call to happen.
      </p>
      <p><strong>An unexpected call is always an error,</strong> as the code under test doesn’t behave
        the way the test expects it to behave.</p>
      <p><strong>By default, an uninteresting call is not an error,</strong> as it violates no
        constraint specified by the test. (gMock’s philosophy is that saying nothing
        means there is no constraint.) However, it leads to a warning, as it <em>might</em>
        indicate a problem (e.g. the test author might have forgotten to specify a
        constraint).</p>
      <p>In gMock, <code>NiceMock</code> and <code>StrictMock</code> can be used to make a mock class “nice” or
        “strict”. How does this affect uninteresting calls and unexpected calls?</p>
      <p>A <strong>nice mock</strong> suppresses uninteresting call <em>warnings</em>. It is less chatty than
        the default mock, but otherwise is the same. If a test fails with a default
        mock, it will also fail using a nice mock instead. And vice versa. Don’t expect
        making a mock nice to change the test’s result.</p>
      <p>A <strong>strict mock</strong> turns uninteresting call warnings into errors. So making a
        mock strict may change the test’s result.</p>
      <p>Let’s look at an example:</p>
      <pre class="chroma"><span class="n">TEST</span><span class="p">(...)</span> <span class="p">{</span>
  <span class="n">NiceMock</span><span class="o">&lt;</span><span class="n">MockDomainRegistry</span><span class="o">&gt;</span> <span class="n">mock_registry</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_registry</span><span class="p">,</span> <span class="n">GetDomainOwner</span><span class="p">(</span><span class="s">"google.com"</span><span class="p">))</span>
          <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="s">"Larry Page"</span><span class="p">));</span>

  <span class="c1">// Use mock_registry in code under test.
</span><span class="c1"></span>  <span class="p">...</span> <span class="o">&amp;</span><span class="n">mock_registry</span> <span class="p">...</span>
<span class="p">}</span>
</pre>
      <p>The sole <code>EXPECT_CALL</code> here says that all calls to <code>GetDomainOwner()</code> must have
        <code>"google.com"</code> as the argument. If <code>GetDomainOwner("yahoo.com")</code> is
        called, it
        will be an unexpected call, and thus an error. <em>Having a nice mock doesn’t
          change the severity of an unexpected call.</em>
      </p>
      <p>So how do we tell gMock that <code>GetDomainOwner()</code> can be called with some other
        arguments as well? The standard technique is to add a “catch all” <code>EXPECT_CALL</code>:</p>
      <pre class="chroma">  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_registry</span><span class="p">,</span> <span class="n">GetDomainOwner</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
        <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">AnyNumber</span><span class="p">());</span>  <span class="c1">// catches all other calls to this method.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_registry</span><span class="p">,</span> <span class="n">GetDomainOwner</span><span class="p">(</span><span class="s">"google.com"</span><span class="p">))</span>
        <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="s">"Larry Page"</span><span class="p">));</span>
</pre>
      <p>Remember that <code>_</code> is the wildcard matcher that matches anything. With this, if
        <code>GetDomainOwner("google.com")</code> is called, it will do what the second
        <code>EXPECT_CALL</code> says; if it is called with a different argument, it will do what
        the first <code>EXPECT_CALL</code> says.
      </p>
      <p>Note that the order of the two <code>EXPECT_CALL</code>s is important, as a newer
        <code>EXPECT_CALL</code> takes precedence over an older one.
      </p>
      <p>For more on uninteresting calls, nice mocks, and strict mocks, read
        <a href="#NiceStrictNaggy">“The Nice, the Strict, and the Naggy”</a>.
      </p>
      <h3 id="ignoring-uninteresting-arguments-parameterlessexpectations">Ignoring Uninteresting Arguments
        {#ParameterlessExpectations}</h3>
      <p>If your test doesn’t care about the parameters (it only cares about the number
        or order of calls), you can often simply omit the parameter list:</p>
      <pre class="chroma">  <span class="c1">// Expect foo.Bar( ... ) twice with any arguments.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">).</span><span class="n">Times</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

  <span class="c1">// Delegate to the given method whenever the factory is invoked.
</span><span class="c1"></span>  <span class="n">ON_CALL</span><span class="p">(</span><span class="n">foo_factory</span><span class="p">,</span> <span class="n">MakeFoo</span><span class="p">)</span>
      <span class="p">.</span><span class="n">WillByDefault</span><span class="p">(</span><span class="o">&amp;</span><span class="n">BuildFooForTest</span><span class="p">);</span>
</pre>
      <p>This functionality is only available when a method is not overloaded; to prevent
        unexpected behavior it is a compilation error to try to set an expectation on a
        method where the specific overload is ambiguous. You can work around this by
        supplying a <a href="#SimplerInterfaces">simpler mock interface</a> than the mocked class
        provides.</p>
      <p>This pattern is also useful when the arguments are interesting, but match logic
        is substantially complex. You can leave the argument list unspecified and use
        SaveArg actions to <a href="#SaveArgVerify">save the values for later verification</a>. If
        you do that, you can easily differentiate calling the method the wrong number of
        times from calling it with the wrong arguments.</p>
      <h3 id="expecting-ordered-calls-orderedcalls">Expecting Ordered Calls {#OrderedCalls}</h3>
      <p>Although an <code>EXPECT_CALL()</code> statement defined later takes precedence when gMock
        tries to match a function call with an expectation, by default calls don’t have
        to happen in the order <code>EXPECT_CALL()</code> statements are written. For example, if
        the arguments match the matchers in the second <code>EXPECT_CALL()</code>, but not those in
        the first and third, then the second expectation will be used.</p>
      <p>If you would rather have all calls occur in the order of the expectations, put
        the <code>EXPECT_CALL()</code> statements in a block where you define a variable of type
        <code>InSequence</code>:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">InSequence</span><span class="p">;</span>

  <span class="p">{</span>
    <span class="n">InSequence</span> <span class="n">s</span><span class="p">;</span>

    <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
    <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">bar</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
        <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">(</span><span class="mi">6</span><span class="p">));</span>
  <span class="p">}</span>
</pre>
      <p>In this example, we expect a call to <code>foo.DoThis(5)</code>, followed by two calls to
        <code>bar.DoThat()</code> where the argument can be anything, which are in turn followed by
        a call to <code>foo.DoThis(6)</code>. If a call occurred out-of-order, gMock will report an
        error.
      </p>
      <h3 id="expecting-partially-ordered-calls-partialorder">Expecting Partially Ordered Calls {#PartialOrder}</h3>
      <p>Sometimes requiring everything to occur in a predetermined order can lead to
        brittle tests. For example, we may care about <code>A</code> occurring before both <code>B</code> and
        <code>C</code>, but aren’t interested in the relative order of <code>B</code> and <code>C</code>. In this case,
        the test should reflect our real intent, instead of being overly constraining.
      </p>
      <p>gMock allows you to impose an arbitrary DAG (directed acyclic graph) on the
        calls. One way to express the DAG is to use the
        <a href="reference/mocking.md#EXPECT_CALL.After"><code>After</code> clause</a> of <code>EXPECT_CALL</code>.
      </p>
      <p>Another way is via the <code>InSequence()</code> clause (not the same as the <code>InSequence</code>
        class), which we borrowed from jMock 2. It’s less flexible than <code>After()</code>, but
        more convenient when you have long chains of sequential calls, as it doesn’t
        require you to come up with different names for the expectations in the chains.
        Here’s how it works:</p>
      <p>If we view <code>EXPECT_CALL()</code> statements as nodes in a graph, and add an edge from
        node A to node B wherever A must occur before B, we can get a DAG. We use the
        term “sequence” to mean a directed path in this DAG. Now, if we decompose the
        DAG into sequences, we just need to know which sequences each <code>EXPECT_CALL()</code>
        belongs to in order to be able to reconstruct the original DAG.</p>
      <p>So, to specify the partial order on the expectations we need to do two things:
        first to define some <code>Sequence</code> objects, and then for each <code>EXPECT_CALL()</code> say
        which <code>Sequence</code> objects it is part of.</p>
      <p>Expectations in the same sequence must occur in the order they are written. For
        example,</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Sequence</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">Sequence</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">;</span>

  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">A</span><span class="p">())</span>
      <span class="p">.</span><span class="n">InSequence</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">);</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">bar</span><span class="p">,</span> <span class="n">B</span><span class="p">())</span>
      <span class="p">.</span><span class="n">InSequence</span><span class="p">(</span><span class="n">s1</span><span class="p">);</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">bar</span><span class="p">,</span> <span class="n">C</span><span class="p">())</span>
      <span class="p">.</span><span class="n">InSequence</span><span class="p">(</span><span class="n">s2</span><span class="p">);</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">D</span><span class="p">())</span>
      <span class="p">.</span><span class="n">InSequence</span><span class="p">(</span><span class="n">s2</span><span class="p">);</span>
</pre>
      <p>specifies the following DAG (where <code>s1</code> is <code>A -&gt; B</code>, and <code>s2</code> is
        <code>A -&gt; C -&gt; D</code>):
      </p>
      <pre class="chroma">       +---&gt; B
       |
  A ---|
       |
       +---&gt; C ---&gt; D
</pre>
      <p>This means that A must occur before B and C, and C must occur before D. There’s
        no restriction about the order other than these.</p>
      <h3 id="controlling-when-an-expectation-retires">Controlling When an Expectation Retires</h3>
      <p>When a mock method is called, gMock only considers expectations that are still
        active. An expectation is active when created, and becomes inactive (aka
        <em>retires</em>) when a call that has to occur later has occurred. For example, in
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Sequence</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">Sequence</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">;</span>

  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">Log</span><span class="p">(</span><span class="n">WARNING</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="s">"File too large."</span><span class="p">))</span>      <span class="c1">// #1
</span><span class="c1"></span>      <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">AnyNumber</span><span class="p">())</span>
      <span class="p">.</span><span class="n">InSequence</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">);</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">Log</span><span class="p">(</span><span class="n">WARNING</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="s">"Data set is empty."</span><span class="p">))</span>   <span class="c1">// #2
</span><span class="c1"></span>      <span class="p">.</span><span class="n">InSequence</span><span class="p">(</span><span class="n">s1</span><span class="p">);</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">Log</span><span class="p">(</span><span class="n">WARNING</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="s">"User not found."</span><span class="p">))</span>      <span class="c1">// #3
</span><span class="c1"></span>      <span class="p">.</span><span class="n">InSequence</span><span class="p">(</span><span class="n">s2</span><span class="p">);</span>
</pre>
      <p>as soon as either #2 or #3 is matched, #1 will retire. If a warning <code>"File too large."</code> is
        logged after this, it will be an error.</p>
      <p>Note that an expectation doesn’t retire automatically when it’s saturated. For
        example,</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">Log</span><span class="p">(</span><span class="n">WARNING</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">));</span>                     <span class="c1">// #1
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">Log</span><span class="p">(</span><span class="n">WARNING</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="s">"File too large."</span><span class="p">));</span>     <span class="c1">// #2
</span></pre>
      <p>says that there will be exactly one warning with the message <code>"File too large."</code>. If the
        second warning contains this message too, #2 will match again
        and result in an upper-bound-violated error.</p>
      <p>If this is not what you want, you can ask an expectation to retire as soon as it
        becomes saturated:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">Log</span><span class="p">(</span><span class="n">WARNING</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">));</span>                     <span class="c1">// #1
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">Log</span><span class="p">(</span><span class="n">WARNING</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="s">"File too large."</span><span class="p">))</span>      <span class="c1">// #2
</span><span class="c1"></span>      <span class="p">.</span><span class="n">RetiresOnSaturation</span><span class="p">();</span>
</pre>
      <p>Here #2 can be used only once, so if you have two warnings with the message
        <code>"File too large."</code>, the first will match #2 and the second will match #1 -
        there will be no error.
      </p>
      <h2 id="using-actions">Using Actions</h2>
      <h3 id="returning-references-from-mock-methods">Returning References from Mock Methods</h3>
      <p>If a mock function’s return type is a reference, you need to use <code>ReturnRef()</code>
        instead of <code>Return()</code> to return a result:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">ReturnRef</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="n">Bar</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">GetBar</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>
<span class="p">...</span>
  <span class="n">MockFoo</span> <span class="n">foo</span><span class="p">;</span>
  <span class="n">Bar</span> <span class="n">bar</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">GetBar</span><span class="p">())</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">ReturnRef</span><span class="p">(</span><span class="n">bar</span><span class="p">));</span>
<span class="p">...</span>
</pre>
      <h3 id="returning-live-values-from-mock-methods">Returning Live Values from Mock Methods</h3>
      <p>The <code>Return(x)</code> action saves a copy of <code>x</code> when the action is created, and
        always returns the same value whenever it’s executed. Sometimes you may want to
        instead return the <em>live</em> value of <code>x</code> (i.e. its value at the time when the
        action is <em>executed</em>.). Use either <code>ReturnRef()</code> or <code>ReturnPointee()</code> for this
        purpose.</p>
      <p>If the mock function’s return type is a reference, you can do it using
        <code>ReturnRef(x)</code>, as shown in the previous recipe (“Returning References from Mock
        Methods”). However, gMock doesn’t let you use <code>ReturnRef()</code> in a mock function
        whose return type is not a reference, as doing that usually indicates a user
        error. So, what shall you do?
      </p>
      <p>Though you may be tempted, DO NOT use <code>std::ref()</code>:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">GetValue</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>
<span class="p">...</span>
  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">MockFoo</span> <span class="n">foo</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">GetValue</span><span class="p">())</span>
      <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ref</span><span class="p">(</span><span class="n">x</span><span class="p">)));</span>  <span class="c1">// Wrong!
</span><span class="c1"></span>  <span class="n">x</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(),</span> <span class="mi">42</span><span class="p">);</span>
</pre>
      <p>Unfortunately, it doesn’t work here. The above code will fail with error:</p>
      <pre class="chroma">Value of: foo.GetValue()
  Actual: 0
Expected: 42
</pre>
      <p>The reason is that <code>Return(*value*)</code> converts <code>value</code> to the actual return type
        of the mock function at the time when the action is <em>created</em>, not when it is
        <em>executed</em>. (This behavior was chosen for the action to be safe when <code>value</code> is
        a proxy object that references some temporary objects.) As a result,
        <code>std::ref(x)</code> is converted to an <code>int</code> value (instead of a <code>const int&amp;</code>)
        when
        the expectation is set, and <code>Return(std::ref(x))</code> will always return 0.
      </p>
      <p><code>ReturnPointee(pointer)</code> was provided to solve this problem specifically. It
        returns the value pointed to by <code>pointer</code> at the time the action is <em>executed</em>:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">ReturnPointee</span><span class="p">;</span>
<span class="p">...</span>
  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">MockFoo</span> <span class="n">foo</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">GetValue</span><span class="p">())</span>
      <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">ReturnPointee</span><span class="p">(</span><span class="o">&amp;</span><span class="n">x</span><span class="p">));</span>  <span class="c1">// Note the &amp; here.
</span><span class="c1"></span>  <span class="n">x</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(),</span> <span class="mi">42</span><span class="p">);</span>  <span class="c1">// This will succeed now.
</span></pre>
      <h3 id="combining-actions">Combining Actions</h3>
      <p>Want to do more than one thing when a function is called? That’s fine. <code>DoAll()</code>
        allows you to do a sequence of actions every time. Only the return value of the
        last action in the sequence will be used.</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">DoAll</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">Bar</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">DoAll</span><span class="p">(</span><span class="n">action_1</span><span class="p">,</span>
                      <span class="n">action_2</span><span class="p">,</span>
                      <span class="p">...</span>
                      <span class="n">action_n</span><span class="p">));</span>
</pre>
      <p>The return value of the last action <strong>must</strong> match the return type of the mocked
        method. In the example above, <code>action_n</code> could be <code>Return(true)</code>, or a lambda
        that returns a <code>bool</code>, but not <code>SaveArg</code>, which returns <code>void</code>. Otherwise the
        signature of <code>DoAll</code> would not match the signature expected by <code>WillOnce</code>, which
        is the signature of the mocked method, and it wouldn’t compile.</p>
      <h3 id="verifying-complex-arguments-saveargverify">Verifying Complex Arguments {#SaveArgVerify}</h3>
      <p>If you want to verify that a method is called with a particular argument but the
        match criteria is complex, it can be difficult to distinguish between
        cardinality failures (calling the method the wrong number of times) and argument
        match failures. Similarly, if you are matching multiple parameters, it may not
        be easy to distinguishing which argument failed to match. For example:</p>
      <pre class="chroma">  <span class="c1">// Not ideal: this could fail because of a problem with arg1 or arg2, or maybe
</span><span class="c1"></span>  <span class="c1">// just the method wasn't called.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">SendValues</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">ElementsAre</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">EqualsProto</span><span class="p">(</span> <span class="p">...</span> <span class="p">)));</span>
</pre>
      <p>You can instead save the arguments and test them individually:</p>
      <pre class="chroma">  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">SendValues</span><span class="p">)</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">DoAll</span><span class="p">(</span><span class="n">SaveArg</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">actual_array</span><span class="p">),</span> <span class="n">SaveArg</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">actual_proto</span><span class="p">)));</span>
  <span class="p">...</span> <span class="n">run</span> <span class="n">the</span> <span class="n">test</span>
  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">actual_array</span><span class="p">,</span> <span class="n">ElementsAre</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">));</span>
  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">actual_proto</span><span class="p">,</span> <span class="n">EqualsProto</span><span class="p">(</span> <span class="p">...</span> <span class="p">));</span>
</pre>
      <h3 id="mocking-side-effects-mockingsideeffects">Mocking Side Effects {#MockingSideEffects}</h3>
      <p>Sometimes a method exhibits its effect not via returning a value but via side
        effects. For example, it may change some global state or modify an output
        argument. To mock side effects, in general you can define your own action by
        implementing <code>::testing::ActionInterface</code>.</p>
      <p>If all you need to do is to change an output argument, the built-in
        <code>SetArgPointee()</code> action is convenient:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">SetArgPointee</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MockMutator</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Mutator</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Mutate</span><span class="p">,</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">mutate</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">value</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="p">...</span>
<span class="p">}</span>
<span class="p">...</span>
  <span class="n">MockMutator</span> <span class="n">mutator</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mutator</span><span class="p">,</span> <span class="n">Mutate</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">SetArgPointee</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
</pre>
      <p>In this example, when <code>mutator.Mutate()</code> is called, we will assign 5 to the
        <code>int</code> variable pointed to by argument #1 (0-based).
      </p>
      <p><code>SetArgPointee()</code> conveniently makes an internal copy of the value you pass to
        it, removing the need to keep the value in scope and alive. The implication
        however is that the value must have a copy constructor and assignment operator.</p>
      <p>If the mock method also needs to return a value as well, you can chain
        <code>SetArgPointee()</code> with <code>Return()</code> using <code>DoAll()</code>, remembering to put the
        <code>Return()</code> statement last:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">DoAll</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">SetArgPointee</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MockMutator</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Mutator</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="p">...</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">MutateInt</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">value</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">}</span>
<span class="p">...</span>
  <span class="n">MockMutator</span> <span class="n">mutator</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mutator</span><span class="p">,</span> <span class="n">MutateInt</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">DoAll</span><span class="p">(</span><span class="n">SetArgPointee</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
                      <span class="n">Return</span><span class="p">(</span><span class="nb">true</span><span class="p">)));</span>
</pre>
      <p>Note, however, that if you use the <code>ReturnOKWith()</code> method, it will override the
        values provided by <code>SetArgPointee()</code> in the response parameters of your function
        call.</p>
      <p>If the output argument is an array, use the <code>SetArrayArgument&lt;N&gt;(first, last)</code>
        action instead. It copies the elements in source range <code>[first, last)</code> to the
        array pointed to by the <code>N</code>-th (0-based) argument:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">NotNull</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">SetArrayArgument</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MockArrayMutator</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ArrayMutator</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Mutate</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">values</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_values</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="p">...</span>
<span class="p">}</span>
<span class="p">...</span>
  <span class="n">MockArrayMutator</span> <span class="n">mutator</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">values</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">};</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mutator</span><span class="p">,</span> <span class="n">Mutate</span><span class="p">(</span><span class="n">NotNull</span><span class="p">(),</span> <span class="mi">5</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">SetArrayArgument</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">values</span> <span class="o">+</span> <span class="mi">5</span><span class="p">));</span>
</pre>
      <p>This also works when the argument is an output iterator:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">SetArrayArgument</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MockRolodex</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Rolodex</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">GetNames</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">back_insert_iterator</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">),</span>
              <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="p">...</span>
<span class="p">}</span>
<span class="p">...</span>
  <span class="n">MockRolodex</span> <span class="n">rolodex</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">names</span> <span class="o">=</span> <span class="p">{</span><span class="s">"George"</span><span class="p">,</span> <span class="s">"John"</span><span class="p">,</span> <span class="s">"Thomas"</span><span class="p">};</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">rolodex</span><span class="p">,</span> <span class="n">GetNames</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">SetArrayArgument</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">names</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">names</span><span class="p">.</span><span class="n">end</span><span class="p">()));</span>
</pre>
      <h3 id="changing-a-mock-objects-behavior-based-on-the-state">Changing a Mock Object’s Behavior Based on the State
      </h3>
      <p>If you expect a call to change the behavior of a mock object, you can use
        <code>::testing::InSequence</code> to specify different behaviors before and after the
        call:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">InSequence</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>

<span class="p">...</span>
  <span class="p">{</span>
     <span class="n">InSequence</span> <span class="n">seq</span><span class="p">;</span>
     <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">IsDirty</span><span class="p">())</span>
         <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="nb">true</span><span class="p">));</span>
     <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">Flush</span><span class="p">());</span>
     <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">IsDirty</span><span class="p">())</span>
         <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="nb">false</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="n">my_mock</span><span class="p">.</span><span class="n">FlushIfDirty</span><span class="p">();</span>
</pre>
      <p>This makes <code>my_mock.IsDirty()</code> return <code>true</code> before <code>my_mock.Flush()</code> is
        called
        and return <code>false</code> afterwards.</p>
      <p>If the behavior change is more complex, you can store the effects in a variable
        and make a mock method get its return value from that variable:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">SaveArg</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>

<span class="n">ACTION_P</span><span class="p">(</span><span class="n">ReturnPointee</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span> <span class="p">}</span>
<span class="p">...</span>
  <span class="kt">int</span> <span class="n">previous_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">GetPrevValue</span><span class="p">)</span>
      <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">ReturnPointee</span><span class="p">(</span><span class="o">&amp;</span><span class="n">previous_value</span><span class="p">));</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">UpdateValue</span><span class="p">)</span>
      <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">SaveArg</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">previous_value</span><span class="p">));</span>
  <span class="n">my_mock</span><span class="p">.</span><span class="n">DoSomethingToUpdateValue</span><span class="p">();</span>
</pre>
      <p>Here <code>my_mock.GetPrevValue()</code> will always return the argument of the last
        <code>UpdateValue()</code> call.
      </p>
      <h3 id="setting-the-default-value-for-a-return-type-defaultvalue">Setting the Default Value for a Return Type
        {#DefaultValue}</h3>
      <p>If a mock method’s return type is a built-in C++ type or pointer, by default it
        will return 0 when invoked. Also, in C++ 11 and above, a mock method whose
        return type has a default constructor will return a default-constructed value by
        default. You only need to specify an action if this default value doesn’t work
        for you.</p>
      <p>Sometimes, you may want to change this default value, or you may want to specify
        a default value for types gMock doesn’t know about. You can do this using the
        <code>::testing::DefaultValue</code> class template:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">DefaultValue</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="n">Bar</span><span class="p">,</span> <span class="n">CalculateBar</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>


<span class="p">...</span>
  <span class="n">Bar</span> <span class="n">default_bar</span><span class="p">;</span>
  <span class="c1">// Sets the default return value for type Bar.
</span><span class="c1"></span>  <span class="n">DefaultValue</span><span class="o">&lt;</span><span class="n">Bar</span><span class="o">&gt;::</span><span class="n">Set</span><span class="p">(</span><span class="n">default_bar</span><span class="p">);</span>

  <span class="n">MockFoo</span> <span class="n">foo</span><span class="p">;</span>

  <span class="c1">// We don't need to specify an action here, as the default
</span><span class="c1"></span>  <span class="c1">// return value works for us.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">CalculateBar</span><span class="p">());</span>

  <span class="n">foo</span><span class="p">.</span><span class="n">CalculateBar</span><span class="p">();</span>  <span class="c1">// This should return default_bar.
</span><span class="c1"></span>
  <span class="c1">// Unsets the default return value.
</span><span class="c1"></span>  <span class="n">DefaultValue</span><span class="o">&lt;</span><span class="n">Bar</span><span class="o">&gt;::</span><span class="n">Clear</span><span class="p">();</span>
</pre>
      <p>Please note that changing the default value for a type can make your tests hard
        to understand. We recommend you to use this feature judiciously. For example,
        you may want to make sure the <code>Set()</code> and <code>Clear()</code> calls are right next to the
        code that uses your mock.</p>
      <h3 id="setting-the-default-actions-for-a-mock-method">Setting the Default Actions for a Mock Method</h3>
      <p>You’ve learned how to change the default value of a given type. However, this
        may be too coarse for your purpose: perhaps you have two mock methods with the
        same return type and you want them to have different behaviors. The <code>ON_CALL()</code>
        macro allows you to customize your mock’s behavior at the method level:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">AnyNumber</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Gt</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">ON_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Sign</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillByDefault</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
  <span class="n">ON_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Sign</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillByDefault</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
  <span class="n">ON_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Sign</span><span class="p">(</span><span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
      <span class="p">.</span><span class="n">WillByDefault</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>

  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Sign</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">AnyNumber</span><span class="p">());</span>

  <span class="n">foo</span><span class="p">.</span><span class="n">Sign</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>   <span class="c1">// This should return 1.
</span><span class="c1"></span>  <span class="n">foo</span><span class="p">.</span><span class="n">Sign</span><span class="p">(</span><span class="o">-</span><span class="mi">9</span><span class="p">);</span>  <span class="c1">// This should return -1.
</span><span class="c1"></span>  <span class="n">foo</span><span class="p">.</span><span class="n">Sign</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>   <span class="c1">// This should return 0.
</span></pre>
      <p>As you may have guessed, when there are more than one <code>ON_CALL()</code> statements,
        the newer ones in the order take precedence over the older ones. In other words,
        the <strong>last</strong> one that matches the function arguments will be used. This matching
        order allows you to set up the common behavior in a mock object’s constructor or
        the test fixture’s set-up phase and specialize the mock’s behavior later.</p>
      <p>Note that both <code>ON_CALL</code> and <code>EXPECT_CALL</code> have the same “later statements take
        precedence” rule, but they don’t interact. That is, <code>EXPECT_CALL</code>s have their
        own precedence order distinct from the <code>ON_CALL</code> precedence order.</p>
      <h3 id="using-functionsmethodsfunctorslambdas-as-actions-functionsasactions">Using
        Functions/Methods/Functors/Lambdas as Actions {#FunctionsAsActions}</h3>
      <p>If the built-in actions don’t suit you, you can use an existing callable
        (function, <code>std::function</code>, method, functor, lambda) as an action.</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span> <span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Invoke</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">Sum</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">ComplexJob</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">CalculateSum</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>
<span class="kt">int</span> <span class="nf">Sum3</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">z</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span><span class="p">;</span> <span class="p">}</span>

<span class="k">class</span> <span class="nc">Helper</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">bool</span> <span class="n">ComplexJob</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">);</span>
<span class="p">};</span>

<span class="p">...</span>
  <span class="n">MockFoo</span> <span class="n">foo</span><span class="p">;</span>
  <span class="n">Helper</span> <span class="n">helper</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Sum</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CalculateSum</span><span class="p">)</span>
      <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Invoke</span><span class="p">(</span><span class="n">NewPermanentCallback</span><span class="p">(</span><span class="n">Sum3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)));</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">ComplexJob</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Invoke</span><span class="p">(</span><span class="o">&amp;</span><span class="n">helper</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Helper</span><span class="o">::</span><span class="n">ComplexJob</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">([]</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span> <span class="p">})</span>
      <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">([](</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">});</span>

  <span class="n">foo</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>         <span class="c1">// Invokes CalculateSum(5, 6).
</span><span class="c1"></span>  <span class="n">foo</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>         <span class="c1">// Invokes Sum3(1, 2, 3).
</span><span class="c1"></span>  <span class="n">foo</span><span class="p">.</span><span class="n">ComplexJob</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>    <span class="c1">// Invokes helper.ComplexJob(10).
</span><span class="c1"></span>  <span class="n">foo</span><span class="p">.</span><span class="n">ComplexJob</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>    <span class="c1">// Invokes the inline lambda.
</span></pre>
      <p>The only requirement is that the type of the function, etc must be <em>compatible</em>
        with the signature of the mock function, meaning that the latter’s arguments (if
        it takes any) can be implicitly converted to the corresponding arguments of the
        former, and the former’s return type can be implicitly converted to that of the
        latter. So, you can invoke something whose type is <em>not</em> exactly the same as the
        mock function, as long as it’s safe to do so - nice, huh?</p>
      <p>Note that:</p>
      <ul>
        <li>
          <p>The action takes ownership of the callback and will delete it when the
            action itself is destructed.</p>
        </li>
        <li>
          <p>If the type of a callback is derived from a base callback type <code>C</code>, you need
            to implicitly cast it to <code>C</code> to resolve the overloading, e.g.</p>
          <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Invoke</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">ResultCallback</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;*</span> <span class="n">is_ok</span> <span class="o">=</span> <span class="p">...;</span>
  <span class="p">...</span> <span class="n">Invoke</span><span class="p">(</span><span class="n">is_ok</span><span class="p">)</span> <span class="p">...;</span>  <span class="c1">// This works.
</span><span class="c1"></span>
  <span class="n">BlockingClosure</span><span class="o">*</span> <span class="n">done</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BlockingClosure</span><span class="p">;</span>
  <span class="p">...</span> <span class="n">Invoke</span><span class="p">(</span><span class="n">implicit_cast</span><span class="o">&lt;</span><span class="n">Closure</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">done</span><span class="p">))</span> <span class="p">...;</span>  <span class="c1">// The cast is necessary.
</span></pre>
        </li>
      </ul>
      <h3 id="using-functions-with-extra-info-as-actions">Using Functions with Extra Info as Actions</h3>
      <p>The function or functor you call using <code>Invoke()</code> must have the same number of
        arguments as the mock function you use it for. Sometimes you may have a function
        that takes more arguments, and you are willing to pass in the extra arguments
        yourself to fill the gap. You can do this in gMock using callbacks with
        pre-bound arguments. Here’s an example:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Invoke</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">char</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>

<span class="kt">char</span> <span class="nf">SignOfSum</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">const</span> <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">sum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="sc">'+'</span> <span class="o">:</span> <span class="p">(</span><span class="n">sum</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="sc">'-'</span> <span class="o">:</span> <span class="sc">'0'</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Test</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">MockFoo</span> <span class="n">foo</span><span class="p">;</span>

  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Invoke</span><span class="p">(</span><span class="n">NewPermanentCallback</span><span class="p">(</span><span class="n">SignOfSum</span><span class="p">,</span> <span class="mi">5</span><span class="p">)));</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">DoThis</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="sc">'+'</span><span class="p">);</span>  <span class="c1">// Invokes SignOfSum(5, 2).
</span><span class="c1"></span><span class="p">}</span>
</pre>
      <h3 id="invoking-a-functionmethodfunctorlambdacallback-without-arguments">Invoking a
        Function/Method/Functor/Lambda/Callback Without Arguments</h3>
      <p><code>Invoke()</code> passes the mock function’s arguments to the function, etc being
        invoked such that the callee has the full context of the call to work with. If
        the invoked function is not interested in some or all of the arguments, it can
        simply ignore them.</p>
      <p>Yet, a common pattern is that a test author wants to invoke a function without
        the arguments of the mock function. She could do that using a wrapper function
        that throws away the arguments before invoking an underlining nullary function.
        Needless to say, this can be tedious and obscures the intent of the test.</p>
      <p>There are two solutions to this problem. First, you can pass any callable of
        zero args as an action. Alternatively, use <code>InvokeWithoutArgs()</code>, which is like
        <code>Invoke()</code> except that it doesn’t pass the mock function’s arguments to the
        callee. Here’s an example of each:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">InvokeWithoutArgs</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">ComplexJob</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>

<span class="kt">bool</span> <span class="nf">Job1</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="kt">bool</span> <span class="nf">Job2</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">char</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="p">...</span>
  <span class="n">MockFoo</span> <span class="n">foo</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">ComplexJob</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">([]</span> <span class="p">{</span> <span class="n">Job1</span><span class="p">();</span> <span class="p">});</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">InvokeWithoutArgs</span><span class="p">(</span><span class="n">NewPermanentCallback</span><span class="p">(</span><span class="n">Job2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="sc">'a'</span><span class="p">)));</span>

  <span class="n">foo</span><span class="p">.</span><span class="n">ComplexJob</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>  <span class="c1">// Invokes Job1().
</span><span class="c1"></span>  <span class="n">foo</span><span class="p">.</span><span class="n">ComplexJob</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>  <span class="c1">// Invokes Job2(5, 'a').
</span></pre>
      <p>Note that:</p>
      <ul>
        <li>
          <p>The action takes ownership of the callback and will delete it when the
            action itself is destructed.</p>
        </li>
        <li>
          <p>If the type of a callback is derived from a base callback type <code>C</code>, you need
            to implicitly cast it to <code>C</code> to resolve the overloading, e.g.</p>
          <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">InvokeWithoutArgs</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">ResultCallback</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;*</span> <span class="n">is_ok</span> <span class="o">=</span> <span class="p">...;</span>
  <span class="p">...</span> <span class="n">InvokeWithoutArgs</span><span class="p">(</span><span class="n">is_ok</span><span class="p">)</span> <span class="p">...;</span>  <span class="c1">// This works.
</span><span class="c1"></span>
  <span class="n">BlockingClosure</span><span class="o">*</span> <span class="n">done</span> <span class="o">=</span> <span class="p">...;</span>
  <span class="p">...</span> <span class="n">InvokeWithoutArgs</span><span class="p">(</span><span class="n">implicit_cast</span><span class="o">&lt;</span><span class="n">Closure</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">done</span><span class="p">))</span> <span class="p">...;</span>
  <span class="c1">// The cast is necessary.
</span></pre>
        </li>
      </ul>
      <h3 id="invoking-an-argument-of-the-mock-function">Invoking an Argument of the Mock Function</h3>
      <p>Sometimes a mock function will receive a function pointer, a functor (in other
        words, a “callable”) as an argument, e.g.</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">ResultCallback1</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;*</span> <span class="n">callback</span><span class="p">)),</span>
              <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>
</pre>
      <p>and you may want to invoke this callable argument:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">MockFoo</span> <span class="n">foo</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(...);</span>
      <span class="c1">// Will execute callback-&gt;Run(5), where callback is the
</span><span class="c1"></span>      <span class="c1">// second argument DoThis() receives.
</span></pre>
      <p>{: .callout .note}
        NOTE: The section below is legacy documentation from before C++ had lambdas:</p>
      <p>Arghh, you need to refer to a mock function argument but C++ has no lambda
        (yet), so you have to define your own action. :-( Or do you really?</p>
      <p>Well, gMock has an action to solve <em>exactly</em> this problem:</p>
      <pre class="chroma"><span class="n">InvokeArgument</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="p">(</span><span class="n">arg_1</span><span class="p">,</span> <span class="n">arg_2</span><span class="p">,</span> <span class="p">...,</span> <span class="n">arg_m</span><span class="p">)</span>
</pre>
      <p>will invoke the <code>N</code>-th (0-based) argument the mock function receives, with
        <code>arg_1</code>, <code>arg_2</code>, …, and <code>arg_m</code>. No matter if the argument is a function
        pointer, a functor, or a callback. gMock handles them all.
      </p>
      <p>With that, you could write:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">InvokeArgument</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">InvokeArgument</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
      <span class="c1">// Will execute callback-&gt;Run(5), where callback is the
</span><span class="c1"></span>      <span class="c1">// second argument DoThis() receives.
</span></pre>
      <p>What if the callable takes an argument by reference? No problem - just wrap it
        inside <code>std::ref()</code>:</p>
      <pre class="chroma">  <span class="p">...</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">Bar</span><span class="p">,</span>
              <span class="p">((</span><span class="n">ResultCallback2</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="k">const</span> <span class="n">Helper</span><span class="o">&amp;&gt;*</span> <span class="n">callback</span><span class="p">)),</span>
              <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="p">...</span>
  <span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
  <span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">InvokeArgument</span><span class="p">;</span>
  <span class="p">...</span>
  <span class="n">MockFoo</span> <span class="n">foo</span><span class="p">;</span>
  <span class="n">Helper</span> <span class="n">helper</span><span class="p">;</span>
  <span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">InvokeArgument</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ref</span><span class="p">(</span><span class="n">helper</span><span class="p">)));</span>
      <span class="c1">// std::ref(helper) guarantees that a reference to helper, not a copy of
</span><span class="c1"></span>      <span class="c1">// it, will be passed to the callback.
</span></pre>
      <p>What if the callable takes an argument by reference and we do <strong>not</strong> wrap the
        argument in <code>std::ref()</code>? Then <code>InvokeArgument()</code> will <em>make a copy</em> of the
        argument, and pass a <em>reference to the copy</em>, instead of a reference to the
        original value, to the callable. This is especially handy when the argument is a
        temporary value:</p>
      <pre class="chroma">  <span class="p">...</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">,</span> <span class="p">(</span><span class="kt">bool</span> <span class="p">(</span><span class="o">*</span><span class="n">f</span><span class="p">)(</span><span class="k">const</span> <span class="kt">double</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)),</span>
              <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="p">...</span>
  <span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
  <span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">InvokeArgument</span><span class="p">;</span>
  <span class="p">...</span>
  <span class="n">MockFoo</span> <span class="n">foo</span><span class="p">;</span>
  <span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">InvokeArgument</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">string</span><span class="p">(</span><span class="s">"Hi"</span><span class="p">)));</span>
      <span class="c1">// Will execute (*f)(5.0, string("Hi")), where f is the function pointer
</span><span class="c1"></span>      <span class="c1">// DoThat() receives.  Note that the values 5.0 and string("Hi") are
</span><span class="c1"></span>      <span class="c1">// temporary and dead once the EXPECT_CALL() statement finishes.  Yet
</span><span class="c1"></span>      <span class="c1">// it's fine to perform this action later, since a copy of the values
</span><span class="c1"></span>      <span class="c1">// are kept inside the InvokeArgument action.
</span></pre>
      <h3 id="ignoring-an-actions-result">Ignoring an Action’s Result</h3>
      <p>Sometimes you have an action that returns <em>something</em>, but you need an action
        that returns <code>void</code> (perhaps you want to use it in a mock function that returns
        <code>void</code>, or perhaps it needs to be used in <code>DoAll()</code> and it’s not the last in the
        list). <code>IgnoreResult()</code> lets you do that. For example:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">DoAll</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">IgnoreResult</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">Process</span><span class="p">(</span><span class="k">const</span> <span class="n">MyData</span><span class="o">&amp;</span> <span class="n">data</span><span class="p">);</span>
<span class="n">string</span> <span class="nf">DoSomething</span><span class="p">();</span>

<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Abc</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">MyData</span><span class="o">&amp;</span> <span class="n">data</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">Xyz</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>

  <span class="p">...</span>
  <span class="n">MockFoo</span> <span class="n">foo</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Abc</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
      <span class="c1">// .WillOnce(Invoke(Process));
</span><span class="c1"></span>      <span class="c1">// The above line won't compile as Process() returns int but Abc() needs
</span><span class="c1"></span>      <span class="c1">// to return void.
</span><span class="c1"></span>      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">IgnoreResult</span><span class="p">(</span><span class="n">Process</span><span class="p">));</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Xyz</span><span class="p">())</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">DoAll</span><span class="p">(</span><span class="n">IgnoreResult</span><span class="p">(</span><span class="n">DoSomething</span><span class="p">),</span>
                      <span class="c1">// Ignores the string DoSomething() returns.
</span><span class="c1"></span>                      <span class="n">Return</span><span class="p">(</span><span class="nb">true</span><span class="p">)));</span>
</pre>
      <p>Note that you <strong>cannot</strong> use <code>IgnoreResult()</code> on an action that already returns
        <code>void</code>. Doing so will lead to ugly compiler errors.
      </p>
      <h3 id="selecting-an-actions-arguments-selectingargs">Selecting an Action’s Arguments {#SelectingArgs}</h3>
      <p>Say you have a mock function <code>Foo()</code> that takes seven arguments, and you have a
        custom action that you want to invoke when <code>Foo()</code> is called. Trouble is, the
        custom action only wants three arguments:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Invoke</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">Foo</span><span class="p">,</span>
              <span class="p">(</span><span class="kt">bool</span> <span class="n">visible</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span>
               <span class="p">(</span><span class="k">const</span> <span class="n">map</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">),</span> <span class="kt">double</span><span class="o">&amp;</span> <span class="n">weight</span><span class="p">,</span> <span class="kt">double</span> <span class="n">min_weight</span><span class="p">,</span>
               <span class="kt">double</span> <span class="n">max_wight</span><span class="p">));</span>
<span class="p">...</span>
<span class="kt">bool</span> <span class="n">IsVisibleInQuadrant1</span><span class="p">(</span><span class="kt">bool</span> <span class="n">visible</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">visible</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Foo</span><span class="p">)</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Invoke</span><span class="p">(</span><span class="n">IsVisibleInQuadrant1</span><span class="p">));</span>  <span class="c1">// Uh, won't compile. :-(
</span></pre>
      <p>To please the compiler God, you need to define an “adaptor” that has the same
        signature as <code>Foo()</code> and calls the custom action with the right arguments:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Invoke</span><span class="p">;</span>
<span class="p">...</span>
<span class="kt">bool</span> <span class="n">MyIsVisibleInQuadrant1</span><span class="p">(</span><span class="kt">bool</span> <span class="n">visible</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span>
                            <span class="k">const</span> <span class="n">map</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;&amp;</span> <span class="n">weight</span><span class="p">,</span>
                            <span class="kt">double</span> <span class="n">min_weight</span><span class="p">,</span> <span class="kt">double</span> <span class="n">max_wight</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">IsVisibleInQuadrant1</span><span class="p">(</span><span class="n">visible</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Foo</span><span class="p">)</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Invoke</span><span class="p">(</span><span class="n">MyIsVisibleInQuadrant1</span><span class="p">));</span>  <span class="c1">// Now it works.
</span></pre>
      <p>But isn’t this awkward?</p>
      <p>gMock provides a generic <em>action adaptor</em>, so you can spend your time minding
        more important business than writing your own adaptors. Here’s the syntax:</p>
      <pre class="chroma"><span class="n">WithArgs</span><span class="o">&lt;</span><span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">,</span> <span class="p">...,</span> <span class="n">Nk</span><span class="o">&gt;</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</pre>
      <p>creates an action that passes the arguments of the mock function at the given
        indices (0-based) to the inner <code>action</code> and performs it. Using <code>WithArgs</code>, our
        original example can be written as:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Invoke</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">WithArgs</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Foo</span><span class="p">)</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">WithArgs</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Invoke</span><span class="p">(</span><span class="n">IsVisibleInQuadrant1</span><span class="p">)));</span>  <span class="c1">// No need to define your own adaptor.
</span></pre>
      <p>For better readability, gMock also gives you:</p>
      <ul>
        <li><code>WithoutArgs(action)</code> when the inner <code>action</code> takes <em>no</em> argument, and</li>
        <li><code>WithArg&lt;N&gt;(action)</code> (no <code>s</code> after <code>Arg</code>) when the inner
          <code>action</code> takes
          <em>one</em> argument.
        </li>
      </ul>
      <p>As you may have realized, <code>InvokeWithoutArgs(...)</code> is just syntactic sugar for
        <code>WithoutArgs(Invoke(...))</code>.
      </p>
      <p>Here are more tips:</p>
      <ul>
        <li>The inner action used in <code>WithArgs</code> and friends does not have to be
          <code>Invoke()</code> – it can be anything.
        </li>
        <li>You can repeat an argument in the argument list if necessary, e.g.
          <code>WithArgs&lt;2, 3, 3, 5&gt;(...)</code>.
        </li>
        <li>You can change the order of the arguments, e.g. <code>WithArgs&lt;3, 2, 1&gt;(...)</code>.</li>
        <li>The types of the selected arguments do <em>not</em> have to match the signature of
          the inner action exactly. It works as long as they can be implicitly
          converted to the corresponding arguments of the inner action. For example,
          if the 4-th argument of the mock function is an <code>int</code> and <code>my_action</code> takes
          a <code>double</code>, <code>WithArg&lt;4&gt;(my_action)</code> will work.</li>
      </ul>
      <h3 id="ignoring-arguments-in-action-functions">Ignoring Arguments in Action Functions</h3>
      <p>The <a href="#SelectingArgs">selecting-an-action’s-arguments</a> recipe showed us one way
        to make a mock function and an action with incompatible argument lists fit
        together. The downside is that wrapping the action in <code>WithArgs&lt;...&gt;()</code> can get
        tedious for people writing the tests.</p>
      <p>If you are defining a function (or method, functor, lambda, callback) to be used
        with <code>Invoke*()</code>, and you are not interested in some of its arguments, an
        alternative to <code>WithArgs</code> is to declare the uninteresting arguments as <code>Unused</code>.
        This makes the definition less cluttered and less fragile in case the types of
        the uninteresting arguments change. It could also increase the chance the action
        function can be reused. For example, given</p>
      <pre class="chroma"> <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span> <span class="n">Foo</span><span class="p">,</span> <span class="kt">double</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">label</span><span class="p">,</span> <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">),</span>
              <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span> <span class="n">Bar</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
</pre>
      <p>instead of</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Invoke</span><span class="p">;</span>

<span class="kt">double</span> <span class="nf">DistanceToOriginWithLabel</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">label</span><span class="p">,</span> <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">double</span> <span class="nf">DistanceToOriginWithIndex</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(</span><span class="s">"abc"</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Invoke</span><span class="p">(</span><span class="n">DistanceToOriginWithLabel</span><span class="p">));</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Invoke</span><span class="p">(</span><span class="n">DistanceToOriginWithIndex</span><span class="p">));</span>
</pre>
      <p>you could write</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Invoke</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Unused</span><span class="p">;</span>

<span class="kt">double</span> <span class="nf">DistanceToOrigin</span><span class="p">(</span><span class="n">Unused</span><span class="p">,</span> <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(</span><span class="s">"abc"</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Invoke</span><span class="p">(</span><span class="n">DistanceToOrigin</span><span class="p">));</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Invoke</span><span class="p">(</span><span class="n">DistanceToOrigin</span><span class="p">));</span>
</pre>
      <h3 id="sharing-actions">Sharing Actions</h3>
      <p>Just like matchers, a gMock action object consists of a pointer to a ref-counted
        implementation object. Therefore copying actions is also allowed and very
        efficient. When the last action that references the implementation object dies,
        the implementation object will be deleted.</p>
      <p>If you have some complex action that you want to use again and again, you may
        not have to build it from scratch every time. If the action doesn’t have an
        internal state (i.e. if it always does the same thing no matter how many times
        it has been called), you can assign it to an action variable and use that
        variable repeatedly. For example:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Action</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">DoAll</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">SetArgPointee</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">Action</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">set_flag</span> <span class="o">=</span> <span class="n">DoAll</span><span class="p">(</span><span class="n">SetArgPointee</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
                                      <span class="n">Return</span><span class="p">(</span><span class="nb">true</span><span class="p">));</span>
  <span class="p">...</span> <span class="n">use</span> <span class="n">set_flag</span> <span class="n">in</span> <span class="p">.</span><span class="n">WillOnce</span><span class="p">()</span> <span class="n">and</span> <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">()</span> <span class="p">...</span>
</pre>
      <p>However, if the action has its own state, you may be surprised if you share the
        action object. Suppose you have an action factory <code>IncrementCounter(init)</code> which
        creates an action that increments and returns a counter whose initial value is
        <code>init</code>, using two actions created from the same expression and using a shared
        action will exhibit different behaviors. Example:
      </p>
      <pre class="chroma">  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">())</span>
      <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">IncrementCounter</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">())</span>
      <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">IncrementCounter</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
  <span class="n">foo</span><span class="p">.</span><span class="n">DoThis</span><span class="p">();</span>  <span class="c1">// Returns 1.
</span><span class="c1"></span>  <span class="n">foo</span><span class="p">.</span><span class="n">DoThis</span><span class="p">();</span>  <span class="c1">// Returns 2.
</span><span class="c1"></span>  <span class="n">foo</span><span class="p">.</span><span class="n">DoThat</span><span class="p">();</span>  <span class="c1">// Returns 1 - DoThat() uses a different
</span><span class="c1"></span>                 <span class="c1">// counter than DoThis()'s.
</span></pre>
      <p>versus</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Action</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">Action</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">()</span><span class="o">&gt;</span> <span class="n">increment</span> <span class="o">=</span> <span class="n">IncrementCounter</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">())</span>
      <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">increment</span><span class="p">);</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">())</span>
      <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">increment</span><span class="p">);</span>
  <span class="n">foo</span><span class="p">.</span><span class="n">DoThis</span><span class="p">();</span>  <span class="c1">// Returns 1.
</span><span class="c1"></span>  <span class="n">foo</span><span class="p">.</span><span class="n">DoThis</span><span class="p">();</span>  <span class="c1">// Returns 2.
</span><span class="c1"></span>  <span class="n">foo</span><span class="p">.</span><span class="n">DoThat</span><span class="p">();</span>  <span class="c1">// Returns 3 - the counter is shared.
</span></pre>
      <h3 id="testing-asynchronous-behavior">Testing Asynchronous Behavior</h3>
      <p>One oft-encountered problem with gMock is that it can be hard to test
        asynchronous behavior. Suppose you had a <code>EventQueue</code> class that you wanted to
        test, and you created a separate <code>EventDispatcher</code> interface so that you could
        easily mock it out. However, the implementation of the class fired all the
        events on a background thread, which made test timings difficult. You could just
        insert <code>sleep()</code> statements and hope for the best, but that makes your test
        behavior nondeterministic. A better way is to use gMock actions and
        <code>Notification</code> objects to force your asynchronous test to behave synchronously.
      </p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">MockEventDispatcher</span> <span class="o">:</span> <span class="k">public</span> <span class="n">EventDispatcher</span> <span class="p">{</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">DispatchEvent</span><span class="p">,</span> <span class="p">(</span><span class="n">int32</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">EventQueueTest</span><span class="p">,</span> <span class="n">EnqueueEventTest</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">MockEventDispatcher</span> <span class="n">mock_event_dispatcher</span><span class="p">;</span>
  <span class="n">EventQueue</span> <span class="nf">event_queue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mock_event_dispatcher</span><span class="p">);</span>

  <span class="k">const</span> <span class="n">int32</span> <span class="n">kEventId</span> <span class="o">=</span> <span class="mi">321</span><span class="p">;</span>
  <span class="n">absl</span><span class="o">::</span><span class="n">Notification</span> <span class="n">done</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_event_dispatcher</span><span class="p">,</span> <span class="n">DispatchEvent</span><span class="p">(</span><span class="n">kEventId</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">([</span><span class="o">&amp;</span><span class="n">done</span><span class="p">]</span> <span class="p">{</span> <span class="n">done</span><span class="p">.</span><span class="n">Notify</span><span class="p">();</span> <span class="p">});</span>

  <span class="n">event_queue</span><span class="p">.</span><span class="n">EnqueueEvent</span><span class="p">(</span><span class="n">kEventId</span><span class="p">);</span>
  <span class="n">done</span><span class="p">.</span><span class="n">WaitForNotification</span><span class="p">();</span>
<span class="p">}</span>
</pre>
      <p>In the example above, we set our normal gMock expectations, but then add an
        additional action to notify the <code>Notification</code> object. Now we can just call
        <code>Notification::WaitForNotification()</code> in the main thread to wait for the
        asynchronous call to finish. After that, our test suite is complete and we can
        safely exit.
      </p>
      <p>{: .callout .note}
        Note: this example has a downside: namely, if the expectation is not satisfied,
        our test will run forever. It will eventually time-out and fail, but it will
        take longer and be slightly harder to debug. To alleviate this problem, you can
        use <code>WaitForNotificationWithTimeout(ms)</code> instead of <code>WaitForNotification()</code>.</p>
      <h2 id="misc-recipes-on-using-gmock">Misc Recipes on Using gMock</h2>
      <h3 id="mocking-methods-that-use-move-only-types">Mocking Methods That Use Move-Only Types</h3>
      <p>C++11 introduced <em>move-only types</em>. A move-only-typed value can be moved from
        one object to another, but cannot be copied. <code>std::unique_ptr&lt;T&gt;</code> is probably
        the most commonly used move-only type.</p>
      <p>Mocking a method that takes and/or returns move-only types presents some
        challenges, but nothing insurmountable. This recipe shows you how you can do it.
        Note that the support for move-only method arguments was only introduced to
        gMock in April 2017; in older code, you may find more complex
        <a href="#LegacyMoveOnly">workarounds</a> for lack of this feature.
      </p>
      <p>Let’s say we are working on a fictional project that lets one post and share
        snippets called “buzzes”. Your code uses these types:</p>
      <pre class="chroma"><span class="k">enum</span> <span class="k">class</span> <span class="nc">AccessLevel</span> <span class="p">{</span> <span class="n">kInternal</span><span class="p">,</span> <span class="n">kPublic</span> <span class="p">};</span>

<span class="k">class</span> <span class="nc">Buzz</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">explicit</span> <span class="n">Buzz</span><span class="p">(</span><span class="n">AccessLevel</span> <span class="n">access</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
  <span class="p">...</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Buzzer</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Buzzer</span><span class="p">()</span> <span class="p">{}</span>
  <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Buzz</span><span class="o">&gt;</span> <span class="n">MakeBuzz</span><span class="p">(</span><span class="n">StringPiece</span> <span class="n">text</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">ShareBuzz</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Buzz</span><span class="o">&gt;</span> <span class="n">buzz</span><span class="p">,</span> <span class="kt">int64_t</span> <span class="n">timestamp</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">...</span>
<span class="p">};</span>
</pre>
      <p>A <code>Buzz</code> object represents a snippet being posted. A class that implements the
        <code>Buzzer</code> interface is capable of creating and sharing <code>Buzz</code>es. Methods in
        <code>Buzzer</code> may return a <code>unique_ptr&lt;Buzz&gt;</code> or take a
        <code>unique_ptr&lt;Buzz&gt;</code>. Now we
        need to mock <code>Buzzer</code> in our tests.
      </p>
      <p>To mock a method that accepts or returns move-only types, you just use the
        familiar <code>MOCK_METHOD</code> syntax as usual:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">MockBuzzer</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Buzzer</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Buzz</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">MakeBuzz</span><span class="p">,</span> <span class="p">(</span><span class="n">StringPiece</span> <span class="n">text</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">ShareBuzz</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Buzz</span><span class="o">&gt;</span> <span class="n">buzz</span><span class="p">,</span> <span class="kt">int64_t</span> <span class="n">timestamp</span><span class="p">),</span>
              <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>
</pre>
      <p>Now that we have the mock class defined, we can use it in tests. In the
        following code examples, we assume that we have defined a <code>MockBuzzer</code> object
        named <code>mock_buzzer_</code>:</p>
      <pre class="chroma">  <span class="n">MockBuzzer</span> <span class="n">mock_buzzer_</span><span class="p">;</span>
</pre>
      <p>First let’s see how we can set expectations on the <code>MakeBuzz()</code> method, which
        returns a <code>unique_ptr&lt;Buzz&gt;</code>.</p>
      <p>As usual, if you set an expectation without an action (i.e. the <code>.WillOnce()</code> or
        <code>.WillRepeatedly()</code> clause), when that expectation fires, the default action for
        that method will be taken. Since <code>unique_ptr&lt;&gt;</code> has a default constructor that
        returns a null <code>unique_ptr</code>, that’s what you’ll get if you don’t specify an
        action:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">IsNull</span><span class="p">;</span>
<span class="p">...</span>
  <span class="c1">// Use the default action.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_buzzer_</span><span class="p">,</span> <span class="n">MakeBuzz</span><span class="p">(</span><span class="s">"hello"</span><span class="p">));</span>

  <span class="c1">// Triggers the previous EXPECT_CALL.
</span><span class="c1"></span>  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">mock_buzzer_</span><span class="p">.</span><span class="n">MakeBuzz</span><span class="p">(</span><span class="s">"hello"</span><span class="p">),</span> <span class="n">IsNull</span><span class="p">());</span>
</pre>
      <p>If you are not happy with the default action, you can tweak it as usual; see
        <a href="#OnCall">Setting Default Actions</a>.
      </p>
      <p>If you just need to return a move-only value, you can use it in combination with
        <code>WillOnce</code>. For example:
      </p>
      <pre class="chroma">  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_buzzer_</span><span class="p">,</span> <span class="n">MakeBuzz</span><span class="p">(</span><span class="s">"hello"</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Buzz</span><span class="o">&gt;</span><span class="p">(</span><span class="n">AccessLevel</span><span class="o">::</span><span class="n">kInternal</span><span class="p">)));</span>
  <span class="n">EXPECT_NE</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span> <span class="n">mock_buzzer_</span><span class="p">.</span><span class="n">MakeBuzz</span><span class="p">(</span><span class="s">"hello"</span><span class="p">));</span>
</pre>
      <p>Quiz time! What do you think will happen if a <code>Return</code> action is performed more
        than once (e.g. you write <code>... .WillRepeatedly(Return(std::move(...)));</code>)? Come
        think of it, after the first time the action runs, the source value will be
        consumed (since it’s a move-only value), so the next time around, there’s no
        value to move from – you’ll get a run-time error that <code>Return(std::move(...))</code>
        can only be run once.</p>
      <p>If you need your mock method to do more than just moving a pre-defined value,
        remember that you can always use a lambda or a callable object, which can do
        pretty much anything you want:</p>
      <pre class="chroma">  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_buzzer_</span><span class="p">,</span> <span class="n">MakeBuzz</span><span class="p">(</span><span class="s">"x"</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">([](</span><span class="n">StringPiece</span> <span class="n">text</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Buzz</span><span class="o">&gt;</span><span class="p">(</span><span class="n">AccessLevel</span><span class="o">::</span><span class="n">kInternal</span><span class="p">);</span>
      <span class="p">});</span>

  <span class="n">EXPECT_NE</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span> <span class="n">mock_buzzer_</span><span class="p">.</span><span class="n">MakeBuzz</span><span class="p">(</span><span class="s">"x"</span><span class="p">));</span>
  <span class="n">EXPECT_NE</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span> <span class="n">mock_buzzer_</span><span class="p">.</span><span class="n">MakeBuzz</span><span class="p">(</span><span class="s">"x"</span><span class="p">));</span>
</pre>
      <p>Every time this <code>EXPECT_CALL</code> fires, a new <code>unique_ptr&lt;Buzz&gt;</code> will be created
        and returned. You cannot do this with <code>Return(std::make_unique&lt;...&gt;(...))</code>.</p>
      <p>That covers returning move-only values; but how do we work with methods
        accepting move-only arguments? The answer is that they work normally, although
        some actions will not compile when any of method’s arguments are move-only. You
        can always use <code>Return</code>, or a <a href="#FunctionsAsActions">lambda or functor</a>:</p>
      <pre class="chroma">  <span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Unused</span><span class="p">;</span>

  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_buzzer_</span><span class="p">,</span> <span class="n">ShareBuzz</span><span class="p">(</span><span class="n">NotNull</span><span class="p">(),</span> <span class="n">_</span><span class="p">)).</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="nb">true</span><span class="p">));</span>
  <span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">mock_buzzer_</span><span class="p">.</span><span class="n">ShareBuzz</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Buzz</span><span class="o">&gt;</span><span class="p">(</span><span class="n">AccessLevel</span><span class="o">::</span><span class="n">kInternal</span><span class="p">)),</span>
              <span class="mi">0</span><span class="p">);</span>

  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_buzzer_</span><span class="p">,</span> <span class="n">ShareBuzz</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)).</span><span class="n">WillOnce</span><span class="p">(</span>
      <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Buzz</span><span class="o">&gt;</span> <span class="n">buzz</span><span class="p">,</span> <span class="n">Unused</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">buzz</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">;</span> <span class="p">});</span>
  <span class="n">EXPECT_FALSE</span><span class="p">(</span><span class="n">mock_buzzer_</span><span class="p">.</span><span class="n">ShareBuzz</span><span class="p">(</span><span class="k">nullptr</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</pre>
      <p>Many built-in actions (<code>WithArgs</code>, <code>WithoutArgs</code>,<code>DeleteArg</code>,
        <code>SaveArg</code>, …)
        could in principle support move-only arguments, but the support for this is not
        implemented yet. If this is blocking you, please file a bug.
      </p>
      <p>A few actions (e.g. <code>DoAll</code>) copy their arguments internally, so they can never
        work with non-copyable objects; you’ll have to use functors instead.</p>
      <h4 id="legacy-workarounds-for-move-only-types-legacymoveonly">Legacy workarounds for move-only types
        {#LegacyMoveOnly}</h4>
      <p>Support for move-only function arguments was only introduced to gMock in April
        of 2017. In older code, you may encounter the following workaround for the lack
        of this feature (it is no longer necessary - we’re including it just for
        reference):</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">MockBuzzer</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Buzzer</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">DoShareBuzz</span><span class="p">,</span> <span class="p">(</span><span class="n">Buzz</span><span class="o">*</span> <span class="n">buzz</span><span class="p">,</span> <span class="n">Time</span> <span class="n">timestamp</span><span class="p">));</span>
  <span class="kt">bool</span> <span class="nf">ShareBuzz</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Buzz</span><span class="o">&gt;</span> <span class="n">buzz</span><span class="p">,</span> <span class="n">Time</span> <span class="n">timestamp</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">DoShareBuzz</span><span class="p">(</span><span class="n">buzz</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">timestamp</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre>
      <p>The trick is to delegate the <code>ShareBuzz()</code> method to a mock method (let’s call
        it <code>DoShareBuzz()</code>) that does not take move-only parameters. Then, instead of
        setting expectations on <code>ShareBuzz()</code>, you set them on the <code>DoShareBuzz()</code> mock
        method:</p>
      <pre class="chroma">  <span class="n">MockBuzzer</span> <span class="n">mock_buzzer_</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_buzzer_</span><span class="p">,</span> <span class="n">DoShareBuzz</span><span class="p">(</span><span class="n">NotNull</span><span class="p">(),</span> <span class="n">_</span><span class="p">));</span>

  <span class="c1">// When one calls ShareBuzz() on the MockBuzzer like this, the call is
</span><span class="c1"></span>  <span class="c1">// forwarded to DoShareBuzz(), which is mocked.  Therefore this statement
</span><span class="c1"></span>  <span class="c1">// will trigger the above EXPECT_CALL.
</span><span class="c1"></span>  <span class="n">mock_buzzer_</span><span class="p">.</span><span class="n">ShareBuzz</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Buzz</span><span class="o">&gt;</span><span class="p">(</span><span class="n">AccessLevel</span><span class="o">::</span><span class="n">kInternal</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</pre>
      <h3 id="making-the-compilation-faster">Making the Compilation Faster</h3>
      <p>Believe it or not, the <em>vast majority</em> of the time spent on compiling a mock
        class is in generating its constructor and destructor, as they perform
        non-trivial tasks (e.g. verification of the expectations). What’s more, mock
        methods with different signatures have different types and thus their
        constructors/destructors need to be generated by the compiler separately. As a
        result, if you mock many different types of methods, compiling your mock class
        can get really slow.</p>
      <p>If you are experiencing slow compilation, you can move the definition of your
        mock class' constructor and destructor out of the class body and into a <code>.cc</code>
        file. This way, even if you <code>#include</code> your mock class in N files, the compiler
        only needs to generate its constructor and destructor once, resulting in a much
        faster compilation.</p>
      <p>Let’s illustrate the idea using an example. Here’s the definition of a mock
        class before applying this recipe:</p>
      <pre class="chroma"><span class="c1">// File mock_foo.h.
</span><span class="c1"></span><span class="p">...</span>
<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="c1">// Since we don't declare the constructor or the destructor,
</span><span class="c1"></span>  <span class="c1">// the compiler will generate them in every translation unit
</span><span class="c1"></span>  <span class="c1">// where this mock class is used.
</span><span class="c1"></span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="p">...</span> <span class="n">more</span> <span class="n">mock</span> <span class="n">methods</span> <span class="p">...</span>
<span class="p">};</span>
</pre>
      <p>After the change, it would look like:</p>
      <pre class="chroma"><span class="c1">// File mock_foo.h.
</span><span class="c1"></span><span class="p">...</span>
<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="c1">// The constructor and destructor are declared, but not defined, here.
</span><span class="c1"></span>  <span class="n">MockFoo</span><span class="p">();</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">MockFoo</span><span class="p">();</span>

  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="p">...</span> <span class="n">more</span> <span class="n">mock</span> <span class="n">methods</span> <span class="p">...</span>
<span class="p">};</span>
</pre>
      <p>and</p>
      <pre class="chroma"><span class="c1">// File mock_foo.cc.
</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">"path/to/mock_foo.h"</span><span class="cp">
</span><span class="cp"></span>
<span class="c1">// The definitions may appear trivial, but the functions actually do a
</span><span class="c1">// lot of things through the constructors/destructors of the member
</span><span class="c1">// variables used to implement the mock methods.
</span><span class="c1"></span><span class="n">MockFoo</span><span class="o">::</span><span class="n">MockFoo</span><span class="p">()</span> <span class="p">{}</span>
<span class="n">MockFoo</span><span class="o">::~</span><span class="n">MockFoo</span><span class="p">()</span> <span class="p">{}</span>
</pre>
      <h3 id="forcing-a-verification">Forcing a Verification</h3>
      <p>When it’s being destroyed, your friendly mock object will automatically verify
        that all expectations on it have been satisfied, and will generate googletest
        failures if not. This is convenient as it leaves you with one less thing to
        worry about. That is, unless you are not sure if your mock object will be
        destroyed.</p>
      <p>How could it be that your mock object won’t eventually be destroyed? Well, it
        might be created on the heap and owned by the code you are testing. Suppose
        there’s a bug in that code and it doesn’t delete the mock object properly - you
        could end up with a passing test when there’s actually a bug.</p>
      <p>Using a heap checker is a good idea and can alleviate the concern, but its
        implementation is not 100% reliable. So, sometimes you do want to <em>force</em> gMock
        to verify a mock object before it is (hopefully) destructed. You can do this
        with <code>Mock::VerifyAndClearExpectations(&amp;mock_object)</code>:</p>
      <pre class="chroma"><span class="n">TEST</span><span class="p">(</span><span class="n">MyServerTest</span><span class="p">,</span> <span class="n">ProcessesRequest</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Mock</span><span class="p">;</span>

  <span class="n">MockFoo</span><span class="o">*</span> <span class="k">const</span> <span class="n">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MockFoo</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="o">*</span><span class="n">foo</span><span class="p">,</span> <span class="p">...)...;</span>
  <span class="c1">// ... other expectations ...
</span><span class="c1"></span>
  <span class="c1">// server now owns foo.
</span><span class="c1"></span>  <span class="n">MyServer</span> <span class="nf">server</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span>
  <span class="n">server</span><span class="p">.</span><span class="n">ProcessRequest</span><span class="p">(...);</span>

  <span class="c1">// In case that server's destructor will forget to delete foo,
</span><span class="c1"></span>  <span class="c1">// this will verify the expectations anyway.
</span><span class="c1"></span>  <span class="n">Mock</span><span class="o">::</span><span class="n">VerifyAndClearExpectations</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// server is destroyed when it goes out of scope here.
</span></pre>
      <p>{: .callout .tip}
        <strong>Tip:</strong> The <code>Mock::VerifyAndClearExpectations()</code> function returns a <code>bool</code>
        to
        indicate whether the verification was successful (<code>true</code> for yes), so you can
        wrap that function call inside a <code>ASSERT_TRUE()</code> if there is no point going
        further when the verification has failed.
      </p>
      <p>Do not set new expectations after verifying and clearing a mock after its use.
        Setting expectations after code that exercises the mock has undefined behavior.
        See <a href="#gmock-for-dummies#using-mocks-in-tests">Using Mocks in Tests</a> for more
        information.</p>
      <h3 id="using-checkpoints-usingcheckpoints">Using Checkpoints {#UsingCheckPoints}</h3>
      <p>Sometimes you might want to test a mock object’s behavior in phases whose sizes
        are each manageable, or you might want to set more detailed expectations about
        which API calls invoke which mock functions.</p>
      <p>A technique you can use is to put the expectations in a sequence and insert
        calls to a dummy “checkpoint” function at specific places. Then you can verify
        that the mock function calls do happen at the right time. For example, if you
        are exercising the code:</p>
      <pre class="chroma">  <span class="n">Foo</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">Foo</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">Foo</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</pre>
      <p>and want to verify that <code>Foo(1)</code> and <code>Foo(3)</code> both invoke
        <code>mock.Bar("a")</code>, but
        <code>Foo(2)</code> doesn’t invoke anything, you can write:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">MockFunction</span><span class="p">;</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">InvokesBarCorrectly</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">MyMock</span> <span class="n">mock</span><span class="p">;</span>
  <span class="c1">// Class MockFunction&lt;F&gt; has exactly one mock method.  It is named
</span><span class="c1"></span>  <span class="c1">// Call() and has type F.
</span><span class="c1"></span>  <span class="n">MockFunction</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="n">string</span> <span class="n">check_point_name</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">check</span><span class="p">;</span>
  <span class="p">{</span>
    <span class="n">InSequence</span> <span class="n">s</span><span class="p">;</span>

    <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="s">"a"</span><span class="p">));</span>
    <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="n">Call</span><span class="p">(</span><span class="s">"1"</span><span class="p">));</span>
    <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="n">Call</span><span class="p">(</span><span class="s">"2"</span><span class="p">));</span>
    <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="s">"a"</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="n">Foo</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">check</span><span class="p">.</span><span class="n">Call</span><span class="p">(</span><span class="s">"1"</span><span class="p">);</span>
  <span class="n">Foo</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">check</span><span class="p">.</span><span class="n">Call</span><span class="p">(</span><span class="s">"2"</span><span class="p">);</span>
  <span class="n">Foo</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>
</pre>
      <p>The expectation spec says that the first <code>Bar("a")</code> call must happen before
        checkpoint “1”, the second <code>Bar("a")</code> call must happen after checkpoint “2”, and
        nothing should happen between the two checkpoints. The explicit checkpoints make
        it clear which <code>Bar("a")</code> is called by which call to <code>Foo()</code>.</p>
      <h3 id="mocking-destructors">Mocking Destructors</h3>
      <p>Sometimes you want to make sure a mock object is destructed at the right time,
        e.g. after <code>bar-&gt;A()</code> is called but before <code>bar-&gt;B()</code> is called. We already know
        that you can specify constraints on the <a href="#OrderedCalls">order</a> of mock function
        calls, so all we need to do is to mock the destructor of the mock function.</p>
      <p>This sounds simple, except for one problem: a destructor is a special function
        with special syntax and special semantics, and the <code>MOCK_METHOD</code> macro doesn’t
        work for it:</p>
      <pre class="chroma"><span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="o">~</span><span class="n">MockFoo</span><span class="p">,</span> <span class="p">());</span>  <span class="c1">// Won't compile!
</span></pre>
      <p>The good news is that you can use a simple pattern to achieve the same effect.
        First, add a mock function <code>Die()</code> to your mock class and call it in the
        destructor, like this:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="c1">// Add the following two lines to the mock class.
</span><span class="c1"></span>  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Die</span><span class="p">,</span> <span class="p">());</span>
  <span class="o">~</span><span class="n">MockFoo</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="n">Die</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
</pre>
      <p>(If the name <code>Die()</code> clashes with an existing symbol, choose another name.) Now,
        we have translated the problem of testing when a <code>MockFoo</code> object dies to
        testing when its <code>Die()</code> method is called:</p>
      <pre class="chroma">  <span class="n">MockFoo</span><span class="o">*</span> <span class="n">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MockFoo</span><span class="p">;</span>
  <span class="n">MockBar</span><span class="o">*</span> <span class="n">bar</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MockBar</span><span class="p">;</span>
  <span class="p">...</span>
  <span class="p">{</span>
    <span class="n">InSequence</span> <span class="n">s</span><span class="p">;</span>

    <span class="c1">// Expects *foo to die after bar-&gt;A() and before bar-&gt;B().
</span><span class="c1"></span>    <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="o">*</span><span class="n">bar</span><span class="p">,</span> <span class="n">A</span><span class="p">());</span>
    <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="o">*</span><span class="n">foo</span><span class="p">,</span> <span class="n">Die</span><span class="p">());</span>
    <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="o">*</span><span class="n">bar</span><span class="p">,</span> <span class="n">B</span><span class="p">());</span>
  <span class="p">}</span>
</pre>
      <p>And that’s that.</p>
      <h3 id="using-gmock-and-threads-usingthreads">Using gMock and Threads {#UsingThreads}</h3>
      <p>In a <strong>unit</strong> test, it’s best if you could isolate and test a piece of code in a
        single-threaded context. That avoids race conditions and dead locks, and makes
        debugging your test much easier.</p>
      <p>Yet most programs are multi-threaded, and sometimes to test something we need to
        pound on it from more than one thread. gMock works for this purpose too.</p>
      <p>Remember the steps for using a mock:</p>
      <ol>
        <li>Create a mock object <code>foo</code>.</li>
        <li>Set its default actions and expectations using <code>ON_CALL()</code> and
          <code>EXPECT_CALL()</code>.
        </li>
        <li>The code under test calls methods of <code>foo</code>.</li>
        <li>Optionally, verify and reset the mock.</li>
        <li>Destroy the mock yourself, or let the code under test destroy it. The
          destructor will automatically verify it.</li>
      </ol>
      <p>If you follow the following simple rules, your mocks and threads can live
        happily together:</p>
      <ul>
        <li>Execute your <em>test code</em> (as opposed to the code being tested) in <em>one</em>
          thread. This makes your test easy to follow.</li>
        <li>Obviously, you can do step #1 without locking.</li>
        <li>When doing step #2 and #5, make sure no other thread is accessing <code>foo</code>.
          Obvious too, huh?</li>
        <li>#3 and #4 can be done either in one thread or in multiple threads - anyway
          you want. gMock takes care of the locking, so you don’t have to do any -
          unless required by your test logic.</li>
      </ul>
      <p>If you violate the rules (for example, if you set expectations on a mock while
        another thread is calling its methods), you get undefined behavior. That’s not
        fun, so don’t do it.</p>
      <p>gMock guarantees that the action for a mock function is done in the same thread
        that called the mock function. For example, in</p>
      <pre class="chroma">  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">action1</span><span class="p">);</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">action2</span><span class="p">);</span>
</pre>
      <p>if <code>Foo(1)</code> is called in thread 1 and <code>Foo(2)</code> is called in thread 2, gMock will
        execute <code>action1</code> in thread 1 and <code>action2</code> in thread 2.</p>
      <p>gMock does <em>not</em> impose a sequence on actions performed in different threads
        (doing so may create deadlocks as the actions may need to cooperate). This means
        that the execution of <code>action1</code> and <code>action2</code> in the above example <em>may</em>
        interleave. If this is a problem, you should add proper synchronization logic to
        <code>action1</code> and <code>action2</code> to make the test thread-safe.
      </p>
      <p>Also, remember that <code>DefaultValue&lt;T&gt;</code> is a global resource that potentially
        affects <em>all</em> living mock objects in your program. Naturally, you won’t want to
        mess with it from multiple threads or when there still are mocks in action.</p>
      <h3 id="controlling-how-much-information-gmock-prints">Controlling How Much Information gMock Prints</h3>
      <p>When gMock sees something that has the potential of being an error (e.g. a mock
        function with no expectation is called, a.k.a. an uninteresting call, which is
        allowed but perhaps you forgot to explicitly ban the call), it prints some
        warning messages, including the arguments of the function, the return value, and
        the stack trace. Hopefully this will remind you to take a look and see if there
        is indeed a problem.</p>
      <p>Sometimes you are confident that your tests are correct and may not appreciate
        such friendly messages. Some other times, you are debugging your tests or
        learning about the behavior of the code you are testing, and wish you could
        observe every mock call that happens (including argument values, the return
        value, and the stack trace). Clearly, one size doesn’t fit all.</p>
      <p>You can control how much gMock tells you using the <code>--gmock_verbose=LEVEL</code>
        command-line flag, where <code>LEVEL</code> is a string with three possible values:</p>
      <ul>
        <li><code>info</code>: gMock will print all informational messages, warnings, and errors
          (most verbose). At this setting, gMock will also log any calls to the
          <code>ON_CALL/EXPECT_CALL</code> macros. It will include a stack trace in
          “uninteresting call” warnings.
        </li>
        <li><code>warning</code>: gMock will print both warnings and errors (less verbose); it will
          omit the stack traces in “uninteresting call” warnings. This is the default.</li>
        <li><code>error</code>: gMock will print errors only (least verbose).</li>
      </ul>
      <p>Alternatively, you can adjust the value of that flag from within your tests like
        so:</p>
      <pre class="chroma">  <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">FLAGS_gmock_verbose</span> <span class="o">=</span> <span class="s">"error"</span><span class="p">;</span>
</pre>
      <p>If you find gMock printing too many stack frames with its informational or
        warning messages, remember that you can control their amount with the
        <code>--gtest_stack_trace_depth=max_depth</code> flag.
      </p>
      <p>Now, judiciously use the right flag to enable gMock serve you better!</p>
      <h3 id="gaining-super-vision-into-mock-calls">Gaining Super Vision into Mock Calls</h3>
      <p>You have a test using gMock. It fails: gMock tells you some expectations aren’t
        satisfied. However, you aren’t sure why: Is there a typo somewhere in the
        matchers? Did you mess up the order of the <code>EXPECT_CALL</code>s? Or is the code under
        test doing something wrong? How can you find out the cause?</p>
      <p>Won’t it be nice if you have X-ray vision and can actually see the trace of all
        <code>EXPECT_CALL</code>s and mock method calls as they are made? For each call, would you
        like to see its actual argument values and which <code>EXPECT_CALL</code> gMock thinks it
        matches? If you still need some help to figure out who made these calls, how
        about being able to see the complete stack trace at each mock call?
      </p>
      <p>You can unlock this power by running your test with the <code>--gmock_verbose=info</code>
        flag. For example, given the test program:</p>
      <pre class="chroma"><span class="cp">#include</span> <span class="cpf">&lt;gmock/gmock.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">HasSubstr</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MockFoo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">y</span><span class="p">));</span>
<span class="p">};</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">MockFoo</span> <span class="n">mock</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)).</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Return</span><span class="p">());</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">));</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="s">"c"</span><span class="p">,</span> <span class="n">HasSubstr</span><span class="p">(</span><span class="s">"d"</span><span class="p">)));</span>

  <span class="n">mock</span><span class="p">.</span><span class="n">F</span><span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"good"</span><span class="p">);</span>
  <span class="n">mock</span><span class="p">.</span><span class="n">F</span><span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">);</span>
<span class="p">}</span>
</pre>
      <p>if you run it with <code>--gmock_verbose=info</code>, you will see this output:</p>
      <pre class="chroma"><span class="o">[</span> RUN       <span class="o">]</span> Foo.Bar

foo_test.cc:14: EXPECT_CALL<span class="o">(</span>mock, F<span class="o">(</span>_, _<span class="o">))</span> invoked
Stack trace: ...

foo_test.cc:15: EXPECT_CALL<span class="o">(</span>mock, F<span class="o">(</span><span class="s2">"a"</span>, <span class="s2">"b"</span><span class="o">))</span> invoked
Stack trace: ...

foo_test.cc:16: EXPECT_CALL<span class="o">(</span>mock, F<span class="o">(</span><span class="s2">"c"</span>, HasSubstr<span class="o">(</span><span class="s2">"d"</span><span class="o">)))</span> invoked
Stack trace: ...

foo_test.cc:14: Mock <span class="k">function</span> call matches EXPECT_CALL<span class="o">(</span>mock, F<span class="o">(</span>_, _<span class="o">))</span>...
    Function call: F<span class="o">(</span>@0x7fff7c8dad40<span class="s2">"a"</span>,@0x7fff7c8dad10<span class="s2">"good"</span><span class="o">)</span>
Stack trace: ...

foo_test.cc:15: Mock <span class="k">function</span> call matches EXPECT_CALL<span class="o">(</span>mock, F<span class="o">(</span><span class="s2">"a"</span>, <span class="s2">"b"</span><span class="o">))</span>...
    Function call: F<span class="o">(</span>@0x7fff7c8dada0<span class="s2">"a"</span>,@0x7fff7c8dad70<span class="s2">"b"</span><span class="o">)</span>
Stack trace: ...

foo_test.cc:16: Failure
Actual <span class="k">function</span> call count doesn<span class="err">'</span>t match EXPECT_CALL<span class="o">(</span>mock, F<span class="o">(</span><span class="s2">"c"</span>, HasSubstr<span class="o">(</span><span class="s2">"d"</span><span class="o">)))</span>...
         Expected: to be called once
           Actual: never called - unsatisfied and active
<span class="o">[</span>  FAILED  <span class="o">]</span> Foo.Bar
</pre>
      <p>Suppose the bug is that the <code>"c"</code> in the third <code>EXPECT_CALL</code> is a typo and
        should actually be <code>"a"</code>. With the above message, you should see that the actual
        <code>F("a", "good")</code> call is matched by the first <code>EXPECT_CALL</code>, not the third
        as
        you thought. From that it should be obvious that the third <code>EXPECT_CALL</code> is
        written wrong. Case solved.
      </p>
      <p>If you are interested in the mock call trace but not the stack traces, you can
        combine <code>--gmock_verbose=info</code> with <code>--gtest_stack_trace_depth=0</code> on the test
        command line.</p>
      <h3 id="running-tests-in-emacs">Running Tests in Emacs</h3>
      <p>If you build and run your tests in Emacs using the <code>M-x google-compile</code> command
        (as many googletest users do), the source file locations of gMock and googletest
        errors will be highlighted. Just press <code>&lt;Enter&gt;</code> on one of them and you’ll be
        taken to the offending line. Or, you can just type `C-x`` to jump to the next
        error.</p>
      <p>To make it even easier, you can add the following lines to your <code>~/.emacs</code> file:</p>
      <pre class="chroma">(global-set-key "\M-m"  'google-compile)  ; m is for make
(global-set-key [M-down] 'next-error)
(global-set-key [M-up]  '(lambda () (interactive) (next-error -1)))
</pre>
      <p>Then you can type <code>M-m</code> to start a build (if you want to run the test as well,
        just make sure <code>foo_test.run</code> or <code>runtests</code> is in the build command you supply
        after typing <code>M-m</code>), or <code>M-up</code>/<code>M-down</code> to move back and forth between errors.
      </p>
      <h2 id="extending-gmock">Extending gMock</h2>
      <h3 id="writing-new-matchers-quickly-newmatchers">Writing New Matchers Quickly {#NewMatchers}</h3>
      <p>{: .callout .warning}
        WARNING: gMock does not guarantee when or how many times a matcher will be
        invoked. Therefore, all matchers must be functionally pure. See
        <a href="#PureMatchers">this section</a> for more details.
      </p>
      <p>The <code>MATCHER*</code> family of macros can be used to define custom matchers easily.
        The syntax:</p>
      <pre class="chroma"><span class="n">MATCHER</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description_string_expression</span><span class="p">)</span> <span class="p">{</span> <span class="n">statements</span><span class="p">;</span> <span class="p">}</span>
</pre>
      <p>will define a matcher with the given name that executes the statements, which
        must return a <code>bool</code> to indicate if the match succeeds. Inside the statements,
        you can refer to the value being matched by <code>arg</code>, and refer to its type by
        <code>arg_type</code>.
      </p>
      <p>The <em>description string</em> is a <code>string</code>-typed expression that documents what the
        matcher does, and is used to generate the failure message when the match fails.
        It can (and should) reference the special <code>bool</code> variable <code>negation</code>, and should
        evaluate to the description of the matcher when <code>negation</code> is <code>false</code>, or that
        of the matcher’s negation when <code>negation</code> is <code>true</code>.</p>
      <p>For convenience, we allow the description string to be empty (<code>""</code>), in which
        case gMock will use the sequence of words in the matcher name as the
        description.</p>
      <h4 id="basic-example">Basic Example</h4>
      <pre class="chroma"><span class="n">MATCHER</span><span class="p">(</span><span class="n">IsDivisibleBy7</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">arg</span> <span class="o">%</span> <span class="mi">7</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
</pre>
      <p>allows you to write</p>
      <pre class="chroma">  <span class="c1">// Expects mock_foo.Bar(n) to be called where n is divisible by 7.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="n">IsDivisibleBy7</span><span class="p">()));</span>
</pre>
      <p>or,</p>
      <pre class="chroma">  <span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Not</span><span class="p">;</span>
  <span class="p">...</span>
  <span class="c1">// Verifies that a value is divisible by 7 and the other is not.
</span><span class="c1"></span>  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">some_expression</span><span class="p">,</span> <span class="n">IsDivisibleBy7</span><span class="p">());</span>
  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">some_other_expression</span><span class="p">,</span> <span class="n">Not</span><span class="p">(</span><span class="n">IsDivisibleBy7</span><span class="p">()));</span>
</pre>
      <p>If the above assertions fail, they will print something like:</p>
      <pre class="chroma">  Value of: some_expression
  Expected: is divisible by <span class="m">7</span>
    Actual: <span class="m">27</span>
  ...
  Value of: some_other_expression
  Expected: not <span class="o">(</span>is divisible by 7<span class="o">)</span>
    Actual: <span class="m">21</span>
</pre>
      <p>where the descriptions <code>"is divisible by 7"</code> and
        <code>"not (is divisible by 7)"</code> are
        automatically calculated from the matcher name <code>IsDivisibleBy7</code>.
      </p>
      <h4 id="adding-custom-failure-messages">Adding Custom Failure Messages</h4>
      <p>As you may have noticed, the auto-generated descriptions (especially those for
        the negation) may not be so great. You can always override them with a <code>string</code>
        expression of your own:</p>
      <pre class="chroma"><span class="n">MATCHER</span><span class="p">(</span><span class="n">IsDivisibleBy7</span><span class="p">,</span>
        <span class="n">absl</span><span class="o">::</span><span class="n">StrCat</span><span class="p">(</span><span class="n">negation</span> <span class="o">?</span> <span class="s">"isn't"</span> <span class="o">:</span> <span class="s">"is"</span><span class="p">,</span> <span class="s">" divisible by 7"</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">arg</span> <span class="o">%</span> <span class="mi">7</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre>
      <p>Optionally, you can stream additional information to a hidden argument named
        <code>result_listener</code> to explain the match result. For example, a better definition
        of <code>IsDivisibleBy7</code> is:
      </p>
      <pre class="chroma"><span class="n">MATCHER</span><span class="p">(</span><span class="n">IsDivisibleBy7</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">arg</span> <span class="o">%</span> <span class="mi">7</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>

  <span class="o">*</span><span class="n">result_listener</span> <span class="o">&lt;&lt;</span> <span class="s">"the remainder is "</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">arg</span> <span class="o">%</span> <span class="mi">7</span><span class="p">);</span>
  <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre>
      <p>With this definition, the above assertion will give a better message:</p>
      <pre class="chroma">  Value of: some_expression
  Expected: is divisible by <span class="m">7</span>
    Actual: <span class="m">27</span> <span class="o">(</span>the remainder is 6<span class="o">)</span>
</pre>
      <h4 id="using-expect--statements-in-matchers">Using EXPECT_ Statements in Matchers</h4>
      <p>You can also use <code>EXPECT_...</code> (and <code>ASSERT_...</code>) statements inside custom
        matcher definitions. In many cases, this allows you to write your matcher more
        concisely while still providing an informative error message. For example:</p>
      <pre class="chroma"><span class="n">MATCHER</span><span class="p">(</span><span class="n">IsDivisibleBy7</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">const</span> <span class="k">auto</span> <span class="n">remainder</span> <span class="o">=</span> <span class="n">arg</span> <span class="o">%</span> <span class="mi">7</span><span class="p">;</span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">remainder</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre>
      <p>If you write a test that includes the line <code>EXPECT_THAT(27, IsDivisibleBy7());</code>,
        you will get an error something like the following:</p>
      <pre class="chroma">Expected equality of these values:
  remainder
    Which is: <span class="m">6</span>
  <span class="m">0</span>
</pre>
      <h4 id="matchandexplain"><code>MatchAndExplain</code></h4>
      <p>You should let <code>MatchAndExplain()</code> print <em>any additional information</em> that can
        help a user understand the match result. Note that it should explain why the
        match succeeds in case of a success (unless it’s obvious) - this is useful when
        the matcher is used inside <code>Not()</code>. There is no need to print the argument value
        itself, as gMock already prints it for you.</p>
      <h4 id="argument-types">Argument Types</h4>
      <p>The type of the value being matched (<code>arg_type</code>) is determined by the
        context in which you use the matcher and is supplied to you by the compiler, so
        you don’t need to worry about declaring it (nor can you). This allows the
        matcher to be polymorphic. For example, <code>IsDivisibleBy7()</code> can be used to match
        any type where the value of <code>(arg % 7) == 0</code> can be implicitly converted to a
        <code>bool</code>. In the <code>Bar(IsDivisibleBy7())</code> example above, if method <code>Bar()</code> takes
        an
        <code>int</code>, <code>arg_type</code> will be <code>int</code>; if it takes an <code>unsigned long</code>,
        <code>arg_type</code> will
        be <code>unsigned long</code>; and so on.
      </p>
      <h3 id="writing-new-parameterized-matchers-quickly">Writing New Parameterized Matchers Quickly</h3>
      <p>Sometimes you’ll want to define a matcher that has parameters. For that you can
        use the macro:</p>
      <pre class="chroma"><span class="n">MATCHER_P</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">description_string</span><span class="p">)</span> <span class="p">{</span> <span class="n">statements</span><span class="p">;</span> <span class="p">}</span>
</pre>
      <p>where the description string can be either <code>""</code> or a <code>string</code> expression that
        references <code>negation</code> and <code>param_name</code>.</p>
      <p>For example:</p>
      <pre class="chroma"><span class="n">MATCHER_P</span><span class="p">(</span><span class="n">HasAbsoluteValue</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">==</span> <span class="n">value</span><span class="p">;</span> <span class="p">}</span>
</pre>
      <p>will allow you to write:</p>
      <pre class="chroma">  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">Blah</span><span class="p">(</span><span class="s">"a"</span><span class="p">),</span> <span class="n">HasAbsoluteValue</span><span class="p">(</span><span class="n">n</span><span class="p">));</span>
</pre>
      <p>which may lead to this message (assuming <code>n</code> is 10):</p>
      <pre class="chroma">  Value of: Blah<span class="o">(</span><span class="s2">"a"</span><span class="o">)</span>
  Expected: has absolute value <span class="m">10</span>
    Actual: -9
</pre>
      <p>Note that both the matcher description and its parameter are printed, making the
        message human-friendly.</p>
      <p>In the matcher definition body, you can write <code>foo_type</code> to reference the type
        of a parameter named <code>foo</code>. For example, in the body of
        <code>MATCHER_P(HasAbsoluteValue, value)</code> above, you can write <code>value_type</code> to refer
        to the type of <code>value</code>.
      </p>
      <p>gMock also provides <code>MATCHER_P2</code>, <code>MATCHER_P3</code>, …, up to <code>MATCHER_P10</code> to
        support multi-parameter matchers:</p>
      <pre class="chroma"><span class="n">MATCHER_Pk</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">param_1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">param_k</span><span class="p">,</span> <span class="n">description_string</span><span class="p">)</span> <span class="p">{</span> <span class="n">statements</span><span class="p">;</span> <span class="p">}</span>
</pre>
      <p>Please note that the custom description string is for a particular <em>instance</em> of
        the matcher, where the parameters have been bound to actual values. Therefore
        usually you’ll want the parameter values to be part of the description. gMock
        lets you do that by referencing the matcher parameters in the description string
        expression.</p>
      <p>For example,</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">PrintToString</span><span class="p">;</span>
<span class="n">MATCHER_P2</span><span class="p">(</span><span class="n">InClosedRange</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span>
           <span class="n">absl</span><span class="o">::</span><span class="n">StrFormat</span><span class="p">(</span><span class="s">"%s in range [%s, %s]"</span><span class="p">,</span> <span class="n">negation</span> <span class="o">?</span> <span class="s">"isn't"</span> <span class="o">:</span> <span class="s">"is"</span><span class="p">,</span>
                           <span class="n">PrintToString</span><span class="p">(</span><span class="n">low</span><span class="p">),</span> <span class="n">PrintToString</span><span class="p">(</span><span class="n">hi</span><span class="p">)))</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">low</span> <span class="o">&lt;=</span> <span class="n">arg</span> <span class="o">&amp;&amp;</span> <span class="n">arg</span> <span class="o">&lt;=</span> <span class="n">hi</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="n">EXPECT_THAT</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">InClosedRange</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
</pre>
      <p>would generate a failure that contains the message:</p>
      <pre class="chroma">  Expected: is in range <span class="o">[</span>4, 6<span class="o">]</span>
</pre>
      <p>If you specify <code>""</code> as the description, the failure message will contain the
        sequence of words in the matcher name followed by the parameter values printed
        as a tuple. For example,</p>
      <pre class="chroma">  <span class="n">MATCHER_P2</span><span class="p">(</span><span class="n">InClosedRange</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
  <span class="p">...</span>
  <span class="n">EXPECT_THAT</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">InClosedRange</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
</pre>
      <p>would generate a failure that contains the text:</p>
      <pre class="chroma">  Expected: in closed range <span class="o">(</span>4, 6<span class="o">)</span>
</pre>
      <p>For the purpose of typing, you can view</p>
      <pre class="chroma"><span class="n">MATCHER_Pk</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">description_string</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre>
      <p>as shorthand for</p>
      <pre class="chroma"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">p1_type</span><span class="p">,</span> <span class="p">...,</span> <span class="k">typename</span> <span class="n">pk_type</span><span class="o">&gt;</span>
<span class="n">FooMatcherPk</span><span class="o">&lt;</span><span class="n">p1_type</span><span class="p">,</span> <span class="p">...,</span> <span class="n">pk_type</span><span class="o">&gt;</span>
<span class="n">Foo</span><span class="p">(</span><span class="n">p1_type</span> <span class="n">p1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">pk_type</span> <span class="n">pk</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre>
      <p>When you write <code>Foo(v1, ..., vk)</code>, the compiler infers the types of the
        parameters <code>v1</code>, …, and <code>vk</code> for you. If you are not happy with the result of
        the type inference, you can specify the types by explicitly instantiating the
        template, as in <code>Foo&lt;long, bool&gt;(5, false)</code>. As said earlier, you don’t get to
        (or need to) specify <code>arg_type</code> as that’s determined by the context in which the
        matcher is used.</p>
      <p>You can assign the result of expression <code>Foo(p1, ..., pk)</code> to a variable of type
        <code>FooMatcherPk&lt;p1_type, ..., pk_type&gt;</code>. This can be useful when composing
        matchers. Matchers that don’t have a parameter or have only one parameter have
        special types: you can assign <code>Foo()</code> to a <code>FooMatcher</code>-typed variable, and
        assign <code>Foo(p)</code> to a <code>FooMatcherP&lt;p_type&gt;</code>-typed variable.
      </p>
      <p>While you can instantiate a matcher template with reference types, passing the
        parameters by pointer usually makes your code more readable. If, however, you
        still want to pass a parameter by reference, be aware that in the failure
        message generated by the matcher you will see the value of the referenced object
        but not its address.</p>
      <p>You can overload matchers with different numbers of parameters:</p>
      <pre class="chroma"><span class="n">MATCHER_P</span><span class="p">(</span><span class="n">Blah</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">description_string_1</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">MATCHER_P2</span><span class="p">(</span><span class="n">Blah</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">description_string_2</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre>
      <p>While it’s tempting to always use the <code>MATCHER*</code> macros when defining a new
        matcher, you should also consider implementing the matcher interface directly
        instead (see the recipes that follow), especially if you need to use the matcher
        a lot. While these approaches require more work, they give you more control on
        the types of the value being matched and the matcher parameters, which in
        general leads to better compiler error messages that pay off in the long run.
        They also allow overloading matchers based on parameter types (as opposed to
        just based on the number of parameters).</p>
      <h3 id="writing-new-monomorphic-matchers">Writing New Monomorphic Matchers</h3>
      <p>A matcher of argument type <code>T</code> implements the matcher interface for <code>T</code> and does
        two things: it tests whether a value of type <code>T</code> matches the matcher, and can
        describe what kind of values it matches. The latter ability is used for
        generating readable error messages when expectations are violated.</p>
      <p>A matcher of <code>T</code> must declare a typedef like:</p>
      <pre class="chroma"><span class="k">using</span> <span class="n">is_gtest_matcher</span> <span class="o">=</span> <span class="kt">void</span><span class="p">;</span>
</pre>
      <p>and supports the following operations:</p>
      <pre class="chroma"><span class="c1">// Match a value and optionally explain into an ostream.
</span><span class="c1"></span><span class="kt">bool</span> <span class="n">matched</span> <span class="o">=</span> <span class="n">matcher</span><span class="p">.</span><span class="n">MatchAndExplain</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">maybe_os</span><span class="p">);</span>
<span class="c1">// where `value` is of type `T` and
</span><span class="c1">// `maybe_os` is of type `std::ostream*`, where it can be null if the caller
</span><span class="c1">// is not interested in there textual explanation.
</span><span class="c1"></span>
<span class="n">matcher</span><span class="p">.</span><span class="n">DescribeTo</span><span class="p">(</span><span class="n">os</span><span class="p">);</span>
<span class="n">matcher</span><span class="p">.</span><span class="n">DescribeNegationTo</span><span class="p">(</span><span class="n">os</span><span class="p">);</span>
<span class="c1">// where `os` is of type `std::ostream*`.
</span></pre>
      <p>If you need a custom matcher but <code>Truly()</code> is not a good option (for example,
        you may not be happy with the way <code>Truly(predicate)</code> describes itself, or you
        may want your matcher to be polymorphic as <code>Eq(value)</code> is), you can define a
        matcher to do whatever you want in two steps: first implement the matcher
        interface, and then define a factory function to create a matcher instance. The
        second step is not strictly needed but it makes the syntax of using the matcher
        nicer.</p>
      <p>For example, you can define a matcher to test whether an <code>int</code> is divisible by 7
        and then use it like this:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Matcher</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DivisibleBy7Matcher</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">is_gtest_matcher</span> <span class="o">=</span> <span class="kt">void</span><span class="p">;</span>

  <span class="kt">bool</span> <span class="nf">MatchAndExplain</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">7</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="nf">DescribeTo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"is divisible by 7"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="nf">DescribeNegationTo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"is not divisible by 7"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="n">Matcher</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">DivisibleBy7</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">DivisibleBy7Matcher</span><span class="p">();</span>
<span class="p">}</span>

<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="n">DivisibleBy7</span><span class="p">()));</span>
</pre>
      <p>You may improve the matcher message by streaming additional information to the
        <code>os</code> argument in <code>MatchAndExplain()</code>:
      </p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">DivisibleBy7Matcher</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">bool</span> <span class="n">MatchAndExplain</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">remainder</span> <span class="o">=</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">7</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">remainder</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">os</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">)</span> <span class="p">{</span>
      <span class="o">*</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"the remainder is "</span> <span class="o">&lt;&lt;</span> <span class="n">remainder</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">remainder</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="p">...</span>
<span class="p">};</span>
</pre>
      <p>Then, <code>EXPECT_THAT(x, DivisibleBy7());</code> may generate a message like this:</p>
      <pre class="chroma">Value of: x
Expected: is divisible by <span class="m">7</span>
  Actual: <span class="m">23</span> <span class="o">(</span>the remainder is 2<span class="o">)</span>
</pre>
      <p>{: .callout .tip}
        Tip: for convenience, <code>MatchAndExplain()</code> can take a <code>MatchResultListener*</code>
        instead of <code>std::ostream*</code>.</p>
      <h3 id="writing-new-polymorphic-matchers">Writing New Polymorphic Matchers</h3>
      <p>Expanding what we learned above to <em>polymorphic</em> matchers is now just as simple
        as adding templates in the right place.</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">NotNullMatcher</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">is_gtest_matcher</span> <span class="o">=</span> <span class="kt">void</span><span class="p">;</span>

  <span class="c1">// To implement a polymorphic matcher, we just need to make MatchAndExplain a
</span><span class="c1"></span>  <span class="c1">// template on its first argument.
</span><span class="c1"></span>
  <span class="c1">// In this example, we want to use NotNull() with any pointer, so
</span><span class="c1"></span>  <span class="c1">// MatchAndExplain() accepts a pointer of any type as its first argument.
</span><span class="c1"></span>  <span class="c1">// In general, you can define MatchAndExplain() as an ordinary method or
</span><span class="c1"></span>  <span class="c1">// a method template, or even overload it.
</span><span class="c1"></span>  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
  <span class="kt">bool</span> <span class="n">MatchAndExplain</span><span class="p">(</span><span class="n">T</span><span class="o">*</span> <span class="n">p</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">p</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Describes the property of a value matching this matcher.
</span><span class="c1"></span>  <span class="kt">void</span> <span class="nf">DescribeTo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="o">*</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"is not NULL"</span><span class="p">;</span> <span class="p">}</span>

  <span class="c1">// Describes the property of a value NOT matching this matcher.
</span><span class="c1"></span>  <span class="kt">void</span> <span class="nf">DescribeNegationTo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="o">*</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"is NULL"</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="n">NotNullMatcher</span> <span class="nf">NotNull</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">NotNullMatcher</span><span class="p">();</span>
<span class="p">}</span>

<span class="p">...</span>

  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="n">NotNull</span><span class="p">()));</span>  <span class="c1">// The argument must be a non-NULL pointer.
</span></pre>
      <h3 id="legacy-matcher-implementation">Legacy Matcher Implementation</h3>
      <p>Defining matchers used to be somewhat more complicated, in which it required
        several supporting classes and virtual functions. To implement a matcher for
        type <code>T</code> using the legacy API you have to derive from <code>MatcherInterface&lt;T&gt;</code> and
        call <code>MakeMatcher</code> to construct the object.</p>
      <p>The interface looks like this:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">MatchResultListener</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="p">...</span>
  <span class="c1">// Streams x to the underlying ostream; does nothing if the ostream
</span><span class="c1"></span>  <span class="c1">// is NULL.
</span><span class="c1"></span>  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
  <span class="n">MatchResultListener</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">);</span>

  <span class="c1">// Returns the underlying ostream.
</span><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">stream</span><span class="p">();</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">MatcherInterface</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">MatcherInterface</span><span class="p">();</span>

  <span class="c1">// Returns true if and only if the matcher matches x; also explains the match
</span><span class="c1"></span>  <span class="c1">// result to 'listener'.
</span><span class="c1"></span>  <span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">MatchAndExplain</span><span class="p">(</span><span class="n">T</span> <span class="n">x</span><span class="p">,</span> <span class="n">MatchResultListener</span><span class="o">*</span> <span class="n">listener</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// Describes this matcher to an ostream.
</span><span class="c1"></span>  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">DescribeTo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// Describes the negation of this matcher to an ostream.
</span><span class="c1"></span>  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">DescribeNegationTo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
</pre>
      <p>Fortunately, most of the time you can define a polymorphic matcher easily with
        the help of <code>MakePolymorphicMatcher()</code>. Here’s how you can define <code>NotNull()</code> as
        an example:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">MakePolymorphicMatcher</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">MatchResultListener</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">PolymorphicMatcher</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">NotNullMatcher</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="c1">// To implement a polymorphic matcher, first define a COPYABLE class
</span><span class="c1"></span>  <span class="c1">// that has three members MatchAndExplain(), DescribeTo(), and
</span><span class="c1"></span>  <span class="c1">// DescribeNegationTo(), like the following.
</span><span class="c1"></span>
  <span class="c1">// In this example, we want to use NotNull() with any pointer, so
</span><span class="c1"></span>  <span class="c1">// MatchAndExplain() accepts a pointer of any type as its first argument.
</span><span class="c1"></span>  <span class="c1">// In general, you can define MatchAndExplain() as an ordinary method or
</span><span class="c1"></span>  <span class="c1">// a method template, or even overload it.
</span><span class="c1"></span>  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
  <span class="kt">bool</span> <span class="n">MatchAndExplain</span><span class="p">(</span><span class="n">T</span><span class="o">*</span> <span class="n">p</span><span class="p">,</span>
                       <span class="n">MatchResultListener</span><span class="o">*</span> <span class="cm">/* listener */</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">p</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Describes the property of a value matching this matcher.
</span><span class="c1"></span>  <span class="kt">void</span> <span class="nf">DescribeTo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="o">*</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"is not NULL"</span><span class="p">;</span> <span class="p">}</span>

  <span class="c1">// Describes the property of a value NOT matching this matcher.
</span><span class="c1"></span>  <span class="kt">void</span> <span class="nf">DescribeNegationTo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="o">*</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"is NULL"</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// To construct a polymorphic matcher, pass an instance of the class
</span><span class="c1">// to MakePolymorphicMatcher().  Note the return type.
</span><span class="c1"></span><span class="n">PolymorphicMatcher</span><span class="o">&lt;</span><span class="n">NotNullMatcher</span><span class="o">&gt;</span> <span class="n">NotNull</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">MakePolymorphicMatcher</span><span class="p">(</span><span class="n">NotNullMatcher</span><span class="p">());</span>
<span class="p">}</span>

<span class="p">...</span>

  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="n">NotNull</span><span class="p">()));</span>  <span class="c1">// The argument must be a non-NULL pointer.
</span></pre>
      <p>{: .callout .note}
        <strong>Note:</strong> Your polymorphic matcher class does <strong>not</strong> need to inherit from
        <code>MatcherInterface</code> or any other class, and its methods do <strong>not</strong> need to be
        virtual.
      </p>
      <p>Like in a monomorphic matcher, you may explain the match result by streaming
        additional information to the <code>listener</code> argument in <code>MatchAndExplain()</code>.</p>
      <h3 id="writing-new-cardinalities">Writing New Cardinalities</h3>
      <p>A cardinality is used in <code>Times()</code> to tell gMock how many times you expect a
        call to occur. It doesn’t have to be exact. For example, you can say
        <code>AtLeast(5)</code> or <code>Between(2, 4)</code>.
      </p>
      <p>If the <a href="#gmock-cheat-sheet#CardinalityList">built-in set</a> of cardinalities
        doesn’t suit you, you are free to define your own by implementing the following
        interface (in namespace <code>testing</code>):</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">CardinalityInterface</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">CardinalityInterface</span><span class="p">();</span>

  <span class="c1">// Returns true if and only if call_count calls will satisfy this cardinality.
</span><span class="c1"></span>  <span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">IsSatisfiedByCallCount</span><span class="p">(</span><span class="kt">int</span> <span class="n">call_count</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// Returns true if and only if call_count calls will saturate this
</span><span class="c1"></span>  <span class="c1">// cardinality.
</span><span class="c1"></span>  <span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">IsSaturatedByCallCount</span><span class="p">(</span><span class="kt">int</span> <span class="n">call_count</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// Describes self to an ostream.
</span><span class="c1"></span>  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">DescribeTo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre>
      <p>For example, to specify that a call must occur even number of times, you can
        write</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Cardinality</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">CardinalityInterface</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">MakeCardinality</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EvenNumberCardinality</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CardinalityInterface</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">bool</span> <span class="n">IsSatisfiedByCallCount</span><span class="p">(</span><span class="kt">int</span> <span class="n">call_count</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">call_count</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">bool</span> <span class="nf">IsSaturatedByCallCount</span><span class="p">(</span><span class="kt">int</span> <span class="n">call_count</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="nf">DescribeTo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">*</span> <span class="n">os</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"called even number of times"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="n">Cardinality</span> <span class="nf">EvenNumber</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">MakeCardinality</span><span class="p">(</span><span class="k">new</span> <span class="n">EvenNumberCardinality</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
      <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">EvenNumber</span><span class="p">());</span>
</pre>
      <h3 id="writing-new-actions-quicknewactions">Writing New Actions {#QuickNewActions}</h3>
      <p>If the built-in actions don’t work for you, you can easily define your own one.
        All you need is a call operator with a signature compatible with the mocked
        function. So you can use a lambda:</p>
      <pre class="chroma"><span class="n">MockFunction</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">mock</span><span class="p">;</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Call</span><span class="p">).</span><span class="n">WillOnce</span><span class="p">([](</span><span class="k">const</span> <span class="kt">int</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">input</span> <span class="o">*</span> <span class="mi">7</span><span class="p">;</span> <span class="p">});</span>
<span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">mock</span><span class="p">.</span><span class="n">AsStdFunction</span><span class="p">()(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">14</span><span class="p">);</span>
</pre>
      <p>Or a struct with a call operator (even a templated one):</p>
      <pre class="chroma"><span class="k">struct</span> <span class="nc">MultiplyBy</span> <span class="p">{</span>
  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
  <span class="n">T</span> <span class="k">operator</span><span class="p">()(</span><span class="n">T</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">arg</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">;</span> <span class="p">}</span>

  <span class="kt">int</span> <span class="n">multiplier</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Then use:
</span><span class="c1">// EXPECT_CALL(...).WillOnce(MultiplyBy{7});
</span></pre>
      <p>It’s also fine for the callable to take no arguments, ignoring the arguments
        supplied to the mock function:</p>
      <pre class="chroma"><span class="n">MockFunction</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">mock</span><span class="p">;</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Call</span><span class="p">).</span><span class="n">WillOnce</span><span class="p">([]</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">17</span><span class="p">;</span> <span class="p">});</span>
<span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">mock</span><span class="p">.</span><span class="n">AsStdFunction</span><span class="p">()(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">17</span><span class="p">);</span>
</pre>
      <p>When used with <code>WillOnce</code>, the callable can assume it will be called at most
        once and is allowed to be a move-only type:</p>
      <pre class="chroma"><span class="c1">// An action that contains move-only types and has an &amp;&amp;-qualified operator,
</span><span class="c1">// demanding in the type system that it be called at most once. This can be
</span><span class="c1">// used with WillOnce, but the compiler will reject it if handed to
</span><span class="c1">// WillRepeatedly.
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">MoveOnlyAction</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">move_only_state</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="k">operator</span><span class="p">()()</span> <span class="o">&amp;&amp;</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">move_only_state</span><span class="p">);</span> <span class="p">}</span>
<span class="p">};</span>

<span class="n">MockFunction</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">()</span><span class="o">&gt;</span> <span class="n">mock</span><span class="p">;</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Call</span><span class="p">).</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">MoveOnlyAction</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">17</span><span class="p">)});</span>
<span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">mock</span><span class="p">.</span><span class="n">AsStdFunction</span><span class="p">()(),</span> <span class="n">Pointee</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="mi">17</span><span class="p">)));</span>
</pre>
      <p>More generally, to use with a mock function whose signature is <code>R(Args...)</code> the
        object can be anything convertible to <code>OnceAction&lt;R(Args...)&gt;</code> or
        <code>Action&lt;R(Args...)</code>&gt;. The difference between the two is that <code>OnceAction</code> has
        weaker requirements (<code>Action</code> requires a copy-constructible input that can be
        called repeatedly whereas <code>OnceAction</code> requires only move-constructible and
        supports <code>&amp;&amp;</code>-qualified call operators), but can be used only with <code>WillOnce</code>.
        <code>OnceAction</code> is typically relevant only when supporting move-only types or
        actions that want a type-system guarantee that they will be called at most once.
      </p>
      <p>Typically the <code>OnceAction</code> and <code>Action</code> templates need not be referenced
        directly in your actions: a struct or class with a call operator is sufficient,
        as in the examples above. But fancier polymorphic actions that need to know the
        specific return type of the mock function can define templated conversion
        operators to make that possible. See <code>gmock-actions.h</code> for examples.</p>
      <h4 id="legacy-macro-based-actions">Legacy macro-based Actions</h4>
      <p>Before C++11, the functor-based actions were not supported; the old way of
        writing actions was through a set of <code>ACTION*</code> macros. We suggest to avoid them
        in new code; they hide a lot of logic behind the macro, potentially leading to
        harder-to-understand compiler errors. Nevertheless, we cover them here for
        completeness.</p>
      <p>By writing</p>
      <pre class="chroma"><span class="n">ACTION</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span> <span class="n">statements</span><span class="p">;</span> <span class="p">}</span>
</pre>
      <p>in a namespace scope (i.e. not inside a class or function), you will define an
        action with the given name that executes the statements. The value returned by
        <code>statements</code> will be used as the return value of the action. Inside the
        statements, you can refer to the K-th (0-based) argument of the mock function as
        <code>argK</code>. For example:
      </p>
      <pre class="chroma"><span class="n">ACTION</span><span class="p">(</span><span class="n">IncrementArg1</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">++</span><span class="p">(</span><span class="o">*</span><span class="n">arg1</span><span class="p">);</span> <span class="p">}</span>
</pre>
      <p>allows you to write</p>
      <pre class="chroma"><span class="p">...</span> <span class="n">WillOnce</span><span class="p">(</span><span class="n">IncrementArg1</span><span class="p">());</span>
</pre>
      <p>Note that you don’t need to specify the types of the mock function arguments.
        Rest assured that your code is type-safe though: you’ll get a compiler error if
        <code>*arg1</code> doesn’t support the <code>++</code> operator, or if the type of <code>++(*arg1)</code> isn’t
        compatible with the mock function’s return type.
      </p>
      <p>Another example:</p>
      <pre class="chroma"><span class="n">ACTION</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">(</span><span class="o">*</span><span class="n">arg2</span><span class="p">)(</span><span class="mi">5</span><span class="p">);</span>
  <span class="n">Blah</span><span class="p">();</span>
  <span class="o">*</span><span class="n">arg1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">arg0</span><span class="p">;</span>
<span class="p">}</span>
</pre>
      <p>defines an action <code>Foo()</code> that invokes argument #2 (a function pointer) with 5,
        calls function <code>Blah()</code>, sets the value pointed to by argument #1 to 0, and
        returns argument #0.</p>
      <p>For more convenience and flexibility, you can also use the following pre-defined
        symbols in the body of <code>ACTION</code>:</p>
      <table>
        <thead>
          <tr>
            <th align="left"><code>argK_type</code></th>
            <th align="left">The type of the K-th (0-based) argument of the mock function</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>args</code></td>
            <td align="left">All arguments of the mock function as a tuple</td>
          </tr>
          <tr>
            <td align="left"><code>args_type</code></td>
            <td align="left">The type of all arguments of the mock function as a tuple</td>
          </tr>
          <tr>
            <td align="left"><code>return_type</code></td>
            <td align="left">The return type of the mock function</td>
          </tr>
          <tr>
            <td align="left"><code>function_type</code></td>
            <td align="left">The type of the mock function</td>
          </tr>
        </tbody>
      </table>
      <p>For example, when using an <code>ACTION</code> as a stub action for mock function:</p>
      <pre class="chroma"><span class="kt">int</span> <span class="nf">DoSomething</span><span class="p">(</span><span class="kt">bool</span> <span class="n">flag</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">ptr</span><span class="p">);</span>
</pre>
      <p>we have:</p>
      <table>
        <thead>
          <tr>
            <th>Pre-defined Symbol</th>
            <th>Is Bound To</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>arg0</code></td>
            <td>the value of <code>flag</code></td>
          </tr>
          <tr>
            <td><code>arg0_type</code></td>
            <td>the type <code>bool</code></td>
          </tr>
          <tr>
            <td><code>arg1</code></td>
            <td>the value of <code>ptr</code></td>
          </tr>
          <tr>
            <td><code>arg1_type</code></td>
            <td>the type <code>int*</code></td>
          </tr>
          <tr>
            <td><code>args</code></td>
            <td>the tuple <code>(flag, ptr)</code></td>
          </tr>
          <tr>
            <td><code>args_type</code></td>
            <td>the type <code>std::tuple&lt;bool, int*&gt;</code></td>
          </tr>
          <tr>
            <td><code>return_type</code></td>
            <td>the type <code>int</code></td>
          </tr>
          <tr>
            <td><code>function_type</code></td>
            <td>the type <code>int(bool, int*)</code></td>
          </tr>
        </tbody>
      </table>
      <h4 id="legacy-macro-based-parameterized-actions">Legacy macro-based parameterized Actions</h4>
      <p>Sometimes you’ll want to parameterize an action you define. For that we have
        another macro</p>
      <pre class="chroma"><span class="n">ACTION_P</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span> <span class="p">{</span> <span class="n">statements</span><span class="p">;</span> <span class="p">}</span>
</pre>
      <p>For example,</p>
      <pre class="chroma"><span class="n">ACTION_P</span><span class="p">(</span><span class="n">Add</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">arg0</span> <span class="o">+</span> <span class="n">n</span><span class="p">;</span> <span class="p">}</span>
</pre>
      <p>will allow you to write</p>
      <pre class="chroma"><span class="c1">// Returns argument #0 + 5.
</span><span class="c1"></span><span class="p">...</span> <span class="n">WillOnce</span><span class="p">(</span><span class="n">Add</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
</pre>
      <p>For convenience, we use the term <em>arguments</em> for the values used to invoke the
        mock function, and the term <em>parameters</em> for the values used to instantiate an
        action.</p>
      <p>Note that you don’t need to provide the type of the parameter either. Suppose
        the parameter is named <code>param</code>, you can also use the gMock-defined symbol
        <code>param_type</code> to refer to the type of the parameter as inferred by the compiler.
        For example, in the body of <code>ACTION_P(Add, n)</code> above, you can write <code>n_type</code> for
        the type of <code>n</code>.
      </p>
      <p>gMock also provides <code>ACTION_P2</code>, <code>ACTION_P3</code>, and etc to support multi-parameter
        actions. For example,</p>
      <pre class="chroma"><span class="n">ACTION_P2</span><span class="p">(</span><span class="n">ReturnDistanceTo</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">arg0</span> <span class="o">-</span> <span class="n">x</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">arg1</span> <span class="o">-</span> <span class="n">y</span><span class="p">;</span>
  <span class="k">return</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">);</span>
<span class="p">}</span>
</pre>
      <p>lets you write</p>
      <pre class="chroma"><span class="p">...</span> <span class="n">WillOnce</span><span class="p">(</span><span class="n">ReturnDistanceTo</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">26.5</span><span class="p">));</span>
</pre>
      <p>You can view <code>ACTION</code> as a degenerated parameterized action where the number of
        parameters is 0.</p>
      <p>You can also easily define actions overloaded on the number of parameters:</p>
      <pre class="chroma"><span class="n">ACTION_P</span><span class="p">(</span><span class="n">Plus</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">ACTION_P2</span><span class="p">(</span><span class="n">Plus</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre>
      <h3 id="restricting-the-type-of-an-argument-or-parameter-in-an-action">Restricting the Type of an Argument or
        Parameter in an ACTION</h3>
      <p>For maximum brevity and reusability, the <code>ACTION*</code> macros don’t ask you to
        provide the types of the mock function arguments and the action parameters.
        Instead, we let the compiler infer the types for us.</p>
      <p>Sometimes, however, we may want to be more explicit about the types. There are
        several tricks to do that. For example:</p>
      <pre class="chroma"><span class="n">ACTION</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Makes sure arg0 can be converted to int.
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">arg0</span><span class="p">;</span>
  <span class="p">...</span> <span class="n">use</span> <span class="n">n</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">arg0</span> <span class="n">here</span> <span class="p">...</span>
<span class="p">}</span>

<span class="n">ACTION_P</span><span class="p">(</span><span class="n">Bar</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Makes sure the type of arg1 is const char*.
</span><span class="c1"></span>  <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">StaticAssertTypeEq</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">,</span> <span class="n">arg1_type</span><span class="o">&gt;</span><span class="p">();</span>

  <span class="c1">// Makes sure param can be converted to bool.
</span><span class="c1"></span>  <span class="kt">bool</span> <span class="n">flag</span> <span class="o">=</span> <span class="n">param</span><span class="p">;</span>
<span class="p">}</span>
</pre>
      <p>where <code>StaticAssertTypeEq</code> is a compile-time assertion in googletest that
        verifies two types are the same.</p>
      <h3 id="writing-new-action-templates-quickly">Writing New Action Templates Quickly</h3>
      <p>Sometimes you want to give an action explicit template parameters that cannot be
        inferred from its value parameters. <code>ACTION_TEMPLATE()</code> supports that and can be
        viewed as an extension to <code>ACTION()</code> and <code>ACTION_P*()</code>.</p>
      <p>The syntax:</p>
      <pre class="chroma"><span class="n">ACTION_TEMPLATE</span><span class="p">(</span><span class="n">ActionName</span><span class="p">,</span>
                <span class="n">HAS_m_TEMPLATE_PARAMS</span><span class="p">(</span><span class="n">kind1</span><span class="p">,</span> <span class="n">name1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">kind_m</span><span class="p">,</span> <span class="n">name_m</span><span class="p">),</span>
                <span class="n">AND_n_VALUE_PARAMS</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">p_n</span><span class="p">))</span> <span class="p">{</span> <span class="n">statements</span><span class="p">;</span> <span class="p">}</span>
</pre>
      <p>defines an action template that takes <em>m</em> explicit template parameters and <em>n</em>
        value parameters, where <em>m</em> is in [1, 10] and <em>n</em> is in [0, 10]. <code>name_i</code> is the
        name of the <em>i</em>-th template parameter, and <code>kind_i</code> specifies whether it’s a
        <code>typename</code>, an integral constant, or a template. <code>p_i</code> is the name of the <em>i</em>-th
        value parameter.
      </p>
      <p>Example:</p>
      <pre class="chroma"><span class="c1">// DuplicateArg&lt;k, T&gt;(output) converts the k-th argument of the mock
</span><span class="c1">// function to type T and copies it to *output.
</span><span class="c1"></span><span class="n">ACTION_TEMPLATE</span><span class="p">(</span><span class="n">DuplicateArg</span><span class="p">,</span>
                <span class="c1">// Note the comma between int and k:
</span><span class="c1"></span>                <span class="n">HAS_2_TEMPLATE_PARAMS</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="k">typename</span><span class="p">,</span> <span class="n">T</span><span class="p">),</span>
                <span class="n">AND_1_VALUE_PARAMS</span><span class="p">(</span><span class="n">output</span><span class="p">))</span> <span class="p">{</span>
  <span class="o">*</span><span class="n">output</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="n">k</span><span class="o">&gt;</span><span class="p">(</span><span class="n">args</span><span class="p">));</span>
<span class="p">}</span>
</pre>
      <p>To create an instance of an action template, write:</p>
      <pre class="chroma"><span class="n">ActionName</span><span class="o">&lt;</span><span class="n">t1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">t_m</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">v_n</span><span class="p">)</span>
</pre>
      <p>where the <code>t</code>s are the template arguments and the <code>v</code>s are the value arguments.
        The value argument types are inferred by the compiler. For example:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="p">...</span>
  <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Foo</span><span class="p">).</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">DuplicateArg</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">n</span><span class="p">));</span>
</pre>
      <p>If you want to explicitly specify the value argument types, you can provide
        additional template arguments:</p>
      <pre class="chroma"><span class="n">ActionName</span><span class="o">&lt;</span><span class="n">t1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">t_m</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">u_k</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">v_n</span><span class="p">)</span>
</pre>
      <p>where <code>u_i</code> is the desired type of <code>v_i</code>.</p>
      <p><code>ACTION_TEMPLATE</code> and <code>ACTION</code>/<code>ACTION_P*</code> can be overloaded on the number of
        value parameters, but not on the number of template parameters. Without the
        restriction, the meaning of the following is unclear:</p>
      <pre class="chroma">  <span class="n">OverloadedAction</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
</pre>
      <p>Are we using a single-template-parameter action where <code>bool</code> refers to the type
        of <code>x</code>, or a two-template-parameter action where the compiler is asked to infer
        the type of <code>x</code>?</p>
      <h3 id="using-the-action-objects-type">Using the ACTION Object’s Type</h3>
      <p>If you are writing a function that returns an <code>ACTION</code> object, you’ll need to
        know its type. The type depends on the macro used to define the action and the
        parameter types. The rule is relatively simple:</p>
      <table>
        <thead>
          <tr>
            <th>Given Definition</th>
            <th>Expression</th>
            <th>Has Type</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>ACTION(Foo)</code></td>
            <td><code>Foo()</code></td>
            <td><code>FooAction</code></td>
          </tr>
          <tr>
            <td><code>ACTION_TEMPLATE(Foo, HAS_m_TEMPLATE_PARAMS(...), AND_0_VALUE_PARAMS())</code></td>
            <td><code>Foo&lt;t1, ..., t_m&gt;()</code></td>
            <td><code>FooAction&lt;t1, ..., t_m&gt;</code></td>
          </tr>
          <tr>
            <td><code>ACTION_P(Bar, param)</code></td>
            <td><code>Bar(int_value)</code></td>
            <td><code>BarActionP&lt;int&gt;</code></td>
          </tr>
          <tr>
            <td><code>ACTION_TEMPLATE(Bar, HAS_m_TEMPLATE_PARAMS(...), AND_1_VALUE_PARAMS(p1))</code></td>
            <td><code>Bar&lt;t1, ..., t_m&gt;(int_value)</code></td>
            <td><code>BarActionP&lt;t1, ..., t_m, int&gt;</code></td>
          </tr>
          <tr>
            <td><code>ACTION_P2(Baz, p1, p2)</code></td>
            <td><code>Baz(bool_value, int_value)</code></td>
            <td><code>BazActionP2&lt;bool, int&gt;</code></td>
          </tr>
          <tr>
            <td><code>ACTION_TEMPLATE(Baz, HAS_m_TEMPLATE_PARAMS(...), AND_2_VALUE_PARAMS(p1, p2))</code></td>
            <td><code>Baz&lt;t1, ..., t_m&gt;(bool_value, int_value)</code></td>
            <td><code>BazActionP2&lt;t1, ..., t_m, bool, int&gt;</code></td>
          </tr>
          <tr>
            <td>…</td>
            <td>…</td>
            <td>…</td>
          </tr>
        </tbody>
      </table>
      <p>Note that we have to pick different suffixes (<code>Action</code>, <code>ActionP</code>, <code>ActionP2</code>,
        and etc) for actions with different numbers of value parameters, or the action
        definitions cannot be overloaded on the number of them.</p>
      <h3 id="writing-new-monomorphic-actions-newmonoactions">Writing New Monomorphic Actions {#NewMonoActions}</h3>
      <p>While the <code>ACTION*</code> macros are very convenient, sometimes they are
        inappropriate. For example, despite the tricks shown in the previous recipes,
        they don’t let you directly specify the types of the mock function arguments and
        the action parameters, which in general leads to unoptimized compiler error
        messages that can baffle unfamiliar users. They also don’t allow overloading
        actions based on parameter types without jumping through some hoops.</p>
      <p>An alternative to the <code>ACTION*</code> macros is to implement
        <code>::testing::ActionInterface&lt;F&gt;</code>, where <code>F</code> is the type of the mock function in
        which the action will be used. For example:
      </p>
      <pre class="chroma"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">ActionInterface</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">ActionInterface</span><span class="p">();</span>

  <span class="c1">// Performs the action.  Result is the return type of function type
</span><span class="c1"></span>  <span class="c1">// F, and ArgumentTuple is the tuple of arguments of F.
</span><span class="c1"></span>  <span class="c1">//
</span><span class="c1"></span>
  <span class="c1">// For example, if F is int(bool, const string&amp;), then Result would
</span><span class="c1"></span>  <span class="c1">// be int, and ArgumentTuple would be std::tuple&lt;bool, const string&amp;&gt;.
</span><span class="c1"></span>  <span class="k">virtual</span> <span class="n">Result</span> <span class="nf">Perform</span><span class="p">(</span><span class="k">const</span> <span class="n">ArgumentTuple</span><span class="o">&amp;</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Action</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">ActionInterface</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">MakeAction</span><span class="p">;</span>

<span class="k">typedef</span> <span class="kt">int</span> <span class="nf">IncrementMethod</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">);</span>

<span class="k">class</span> <span class="nc">IncrementArgumentAction</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ActionInterface</span><span class="o">&lt;</span><span class="n">IncrementMethod</span><span class="o">&gt;</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">Perform</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">tuple</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*&gt;&amp;</span> <span class="n">args</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
    <span class="kt">int</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>  <span class="c1">// Grabs the first argument.
</span><span class="c1"></span>    <span class="k">return</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="n">Action</span><span class="o">&lt;</span><span class="n">IncrementMethod</span><span class="o">&gt;</span> <span class="n">IncrementArgument</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">MakeAction</span><span class="p">(</span><span class="k">new</span> <span class="n">IncrementArgumentAction</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Baz</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">IncrementArgument</span><span class="p">());</span>

  <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="n">foo</span><span class="p">.</span><span class="n">Baz</span><span class="p">(</span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>  <span class="c1">// Should return 5 and change n to 6.
</span></pre>
      <h3 id="writing-new-polymorphic-actions-newpolyactions">Writing New Polymorphic Actions {#NewPolyActions}</h3>
      <p>The previous recipe showed you how to define your own action. This is all good,
        except that you need to know the type of the function in which the action will
        be used. Sometimes that can be a problem. For example, if you want to use the
        action in functions with <em>different</em> types (e.g. like <code>Return()</code> and
        <code>SetArgPointee()</code>).
      </p>
      <p>If an action can be used in several types of mock functions, we say it’s
        <em>polymorphic</em>. The <code>MakePolymorphicAction()</code> function template makes it easy to
        define such an action:
      </p>
      <pre class="chroma"><span class="k">namespace</span> <span class="n">testing</span> <span class="p">{</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Impl</span><span class="o">&gt;</span>
<span class="n">PolymorphicAction</span><span class="o">&lt;</span><span class="n">Impl</span><span class="o">&gt;</span> <span class="n">MakePolymorphicAction</span><span class="p">(</span><span class="k">const</span> <span class="n">Impl</span><span class="o">&amp;</span> <span class="n">impl</span><span class="p">);</span>
<span class="p">}</span>  <span class="c1">// namespace testing
</span></pre>
      <p>As an example, let’s define an action that returns the second argument in the
        mock function’s argument list. The first step is to define an implementation
        class:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">ReturnSecondArgumentAction</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Result</span><span class="p">,</span> <span class="k">typename</span> <span class="n">ArgumentTuple</span><span class="o">&gt;</span>
  <span class="n">Result</span> <span class="n">Perform</span><span class="p">(</span><span class="k">const</span> <span class="n">ArgumentTuple</span><span class="o">&amp;</span> <span class="n">args</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="c1">// To get the i-th (0-based) argument, use std::get(args).
</span><span class="c1"></span>    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre>
      <p>This implementation class does <em>not</em> need to inherit from any particular class.
        What matters is that it must have a <code>Perform()</code> method template. This method
        template takes the mock function’s arguments as a tuple in a <strong>single</strong>
        argument, and returns the result of the action. It can be either <code>const</code> or not,
        but must be invocable with exactly one template argument, which is the result
        type. In other words, you must be able to call <code>Perform&lt;R&gt;(args)</code> where <code>R</code> is
        the mock function’s return type and <code>args</code> is its arguments in a tuple.</p>
      <p>Next, we use <code>MakePolymorphicAction()</code> to turn an instance of the implementation
        class into the polymorphic action we need. It will be convenient to have a
        wrapper for this:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">MakePolymorphicAction</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">PolymorphicAction</span><span class="p">;</span>

<span class="n">PolymorphicAction</span><span class="o">&lt;</span><span class="n">ReturnSecondArgumentAction</span><span class="o">&gt;</span> <span class="n">ReturnSecondArgument</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">MakePolymorphicAction</span><span class="p">(</span><span class="n">ReturnSecondArgumentAction</span><span class="p">());</span>
<span class="p">}</span>
</pre>
      <p>Now, you can use this polymorphic action the same way you use the built-in ones:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">,</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">flag</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str1</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str2</span><span class="p">),</span>
              <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>

  <span class="p">...</span>
  <span class="n">MockFoo</span> <span class="n">foo</span><span class="p">;</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThis</span><span class="p">).</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">ReturnSecondArgument</span><span class="p">());</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">DoThat</span><span class="p">).</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">ReturnSecondArgument</span><span class="p">());</span>
  <span class="p">...</span>
  <span class="n">foo</span><span class="p">.</span><span class="n">DoThis</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>  <span class="c1">// Will return 5.
</span><span class="c1"></span>  <span class="n">foo</span><span class="p">.</span><span class="n">DoThat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">"Hi"</span><span class="p">,</span> <span class="s">"Bye"</span><span class="p">);</span>  <span class="c1">// Will return "Hi".
</span></pre>
      <h3 id="teaching-gmock-how-to-print-your-values">Teaching gMock How to Print Your Values</h3>
      <p>When an uninteresting or unexpected call occurs, gMock prints the argument
        values and the stack trace to help you debug. Assertion macros like
        <code>EXPECT_THAT</code> and <code>EXPECT_EQ</code> also print the values in question when the
        assertion fails. gMock and googletest do this using googletest’s user-extensible
        value printer.
      </p>
      <p>This printer knows how to print built-in C++ types, native arrays, STL
        containers, and any type that supports the <code>&lt;&lt;</code> operator. For other types, it
        prints the raw bytes in the value and hopes that you the user can figure it out.
        <a href="#advanced-googletest-topics#teaching-googletest-how-to-print-your-values">The GoogleTest advanced
          guide</a>
        explains how to extend the printer to do a better job at printing your
        particular type than to dump the bytes.
      </p>
      <h2 id="useful-mocks-created-using-gmock">Useful Mocks Created Using gMock</h2>
      <!--#include file="includes/g3_testing_LOGs.md"-->
      <!--#include file="includes/g3_mock_callbacks.md"-->
      <h3 id="mock-stdfunction-mockfunction">Mock std::function {#MockFunction}</h3>
      <p><code>std::function</code> is a general function type introduced in C++11. It is a
        preferred way of passing callbacks to new interfaces. Functions are copyable,
        and are not usually passed around by pointer, which makes them tricky to mock.
        But fear not - <code>MockFunction</code> can help you with that.</p>
      <p><code>MockFunction&lt;R(T1, ..., Tn)&gt;</code> has a mock method <code>Call()</code> with the signature:</p>
      <pre class="chroma">  <span class="n">R</span> <span class="nf">Call</span><span class="p">(</span><span class="n">T1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">Tn</span><span class="p">);</span>
</pre>
      <p>It also has a <code>AsStdFunction()</code> method, which creates a <code>std::function</code> proxy
        forwarding to Call:</p>
      <pre class="chroma">  <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="n">R</span><span class="p">(</span><span class="n">T1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">Tn</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">AsStdFunction</span><span class="p">();</span>
</pre>
      <p>To use <code>MockFunction</code>, first create <code>MockFunction</code> object and set up
        expectations on its <code>Call</code> method. Then pass proxy obtained from
        <code>AsStdFunction()</code> to the code you are testing. For example:
      </p>
      <pre class="chroma"><span class="n">TEST</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">RunsCallbackWithBarArgument</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 1. Create a mock object.
</span><span class="c1"></span>  <span class="n">MockFunction</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">mock_function</span><span class="p">;</span>

  <span class="c1">// 2. Set expectations on Call() method.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_function</span><span class="p">,</span> <span class="n">Call</span><span class="p">(</span><span class="s">"bar"</span><span class="p">)).</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>

  <span class="c1">// 3. Exercise code that uses std::function.
</span><span class="c1"></span>  <span class="n">Foo</span><span class="p">(</span><span class="n">mock_function</span><span class="p">.</span><span class="n">AsStdFunction</span><span class="p">());</span>
  <span class="c1">// Foo's signature can be either of:
</span><span class="c1"></span>  <span class="c1">// void Foo(const std::function&lt;int(string)&gt;&amp; fun);
</span><span class="c1"></span>  <span class="c1">// void Foo(std::function&lt;int(string)&gt; fun);
</span><span class="c1"></span>
  <span class="c1">// 4. All expectations will be verified when mock_function
</span><span class="c1"></span>  <span class="c1">//     goes out of scope and is destroyed.
</span><span class="c1"></span><span class="p">}</span>
</pre>
      <p>Remember that function objects created with <code>AsStdFunction()</code> are just
        forwarders. If you create multiple of them, they will share the same set of
        expectations.</p>
      <p>Although <code>std::function</code> supports unlimited number of arguments, <code>MockFunction</code>
        implementation is limited to ten. If you ever hit that limit… well, your
        callback has bigger problems than being mockable. :-)</p>
      <h1 id="gmock-cheat-sheet">gMock Cheat Sheet</h1>
      <h2 id="defining-a-mock-class">Defining a Mock Class</h2>
      <h3 id="mocking-a-normal-class-mockclass">Mocking a Normal Class {#MockClass}</h3>
      <p>Given</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Foo</span><span class="p">();</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">GetSize</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="n">string</span> <span class="nf">Describe</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">name</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="n">string</span> <span class="nf">Describe</span><span class="p">(</span><span class="kt">int</span> <span class="n">type</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">Process</span><span class="p">(</span><span class="n">Bar</span> <span class="n">elem</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre>
      <p>(note that <code>~Foo()</code> <strong>must</strong> be virtual) we can define its mock as</p>
      <pre class="chroma"><span class="cp">#include</span> <span class="cpf">&lt;gmock/gmock.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">GetSize</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">const</span><span class="p">,</span> <span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">Describe</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">name</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">Describe</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">type</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">Process</span><span class="p">,</span> <span class="p">(</span><span class="n">Bar</span> <span class="n">elem</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>
</pre>
      <p>To create a “nice” mock, which ignores all uninteresting calls, a “naggy” mock,
        which warns on all uninteresting calls, or a “strict” mock, which treats them as
        failures:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">NiceMock</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">NaggyMock</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">StrictMock</span><span class="p">;</span>

<span class="n">NiceMock</span><span class="o">&lt;</span><span class="n">MockFoo</span><span class="o">&gt;</span> <span class="n">nice_foo</span><span class="p">;</span>      <span class="c1">// The type is a subclass of MockFoo.
</span><span class="c1"></span><span class="n">NaggyMock</span><span class="o">&lt;</span><span class="n">MockFoo</span><span class="o">&gt;</span> <span class="n">naggy_foo</span><span class="p">;</span>    <span class="c1">// The type is a subclass of MockFoo.
</span><span class="c1"></span><span class="n">StrictMock</span><span class="o">&lt;</span><span class="n">MockFoo</span><span class="o">&gt;</span> <span class="n">strict_foo</span><span class="p">;</span>  <span class="c1">// The type is a subclass of MockFoo.
</span></pre>
      <p>{: .callout .note}
        <strong>Note:</strong> A mock object is currently naggy by default. We may make it nice by
        default in the future.
      </p>
      <h3 id="mocking-a-class-template-mocktemplate">Mocking a Class Template {#MockTemplate}</h3>
      <p>Class templates can be mocked just like any class.</p>
      <p>To mock</p>
      <pre class="chroma"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Elem</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">StackInterface</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">StackInterface</span><span class="p">();</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">GetSize</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">Push</span><span class="p">(</span><span class="k">const</span> <span class="n">Elem</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre>
      <p>(note that all member functions that are mocked, including <code>~StackInterface()</code>
        <strong>must</strong> be virtual).
      </p>
      <pre class="chroma"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Elem</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">MockStack</span> <span class="o">:</span> <span class="k">public</span> <span class="n">StackInterface</span><span class="o">&lt;</span><span class="n">Elem</span><span class="o">&gt;</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">GetSize</span><span class="p">,</span> <span class="p">(),</span> <span class="p">(</span><span class="k">const</span><span class="p">,</span> <span class="k">override</span><span class="p">));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Push</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">Elem</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>
</pre>
      <h3 id="specifying-calling-conventions-for-mock-functions">Specifying Calling Conventions for Mock Functions</h3>
      <p>If your mock function doesn’t use the default calling convention, you can
        specify it by adding <code>Calltype(convention)</code> to <code>MOCK_METHOD</code>’s 4th parameter.
        For example,</p>
      <pre class="chroma">  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">Foo</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">),</span> <span class="p">(</span><span class="n">Calltype</span><span class="p">(</span><span class="n">STDMETHODCALLTYPE</span><span class="p">)));</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">Bar</span><span class="p">,</span> <span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">),</span>
              <span class="p">(</span><span class="k">const</span><span class="p">,</span> <span class="n">Calltype</span><span class="p">(</span><span class="n">STDMETHODCALLTYPE</span><span class="p">)));</span>
</pre>
      <p>where <code>STDMETHODCALLTYPE</code> is defined by <code>&lt;objbase.h&gt;</code> on Windows.</p>
      <h2 id="using-mocks-in-tests-usingmocks">Using Mocks in Tests {#UsingMocks}</h2>
      <p>The typical work flow is:</p>
      <ol>
        <li>Import the gMock names you need to use. All gMock symbols are in the
          <code>testing</code> namespace unless they are macros or otherwise noted.
        </li>
        <li>Create the mock objects.</li>
        <li>Optionally, set the default actions of the mock objects.</li>
        <li>Set your expectations on the mock objects (How will they be called? What
          will they do?).</li>
        <li>Exercise code that uses the mock objects; if necessary, check the result
          using googletest assertions.</li>
        <li>When a mock object is destructed, gMock automatically verifies that all
          expectations on it have been satisfied.</li>
      </ol>
      <p>Here’s an example:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>                          <span class="c1">// #1
</span><span class="c1"></span>
<span class="n">TEST</span><span class="p">(</span><span class="n">BarTest</span><span class="p">,</span> <span class="n">DoesThis</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">MockFoo</span> <span class="n">foo</span><span class="p">;</span>                                    <span class="c1">// #2
</span><span class="c1"></span>
  <span class="n">ON_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">GetSize</span><span class="p">())</span>                         <span class="c1">// #3
</span><span class="c1"></span>      <span class="p">.</span><span class="n">WillByDefault</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
  <span class="c1">// ... other default actions ...
</span><span class="c1"></span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Describe</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>                   <span class="c1">// #4
</span><span class="c1"></span>      <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
      <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="s">"Category 5"</span><span class="p">));</span>
  <span class="c1">// ... other expectations ...
</span><span class="c1"></span>
  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">MyProductionFunction</span><span class="p">(</span><span class="o">&amp;</span><span class="n">foo</span><span class="p">),</span> <span class="s">"good"</span><span class="p">);</span>  <span class="c1">// #5
</span><span class="c1"></span><span class="p">}</span>                                                 <span class="c1">// #6
</span></pre>
      <h2 id="setting-default-actions-oncall">Setting Default Actions {#OnCall}</h2>
      <p>gMock has a <strong>built-in default action</strong> for any function that returns <code>void</code>,
        <code>bool</code>, a numeric value, or a pointer. In C++11, it will additionally returns
        the default-constructed value, if one exists for the given type.
      </p>
      <p>To customize the default action for functions with return type <code>T</code>, use
        <a href="reference/mocking.md#DefaultValue"><code>DefaultValue&lt;T&gt;</code></a>. For example:
      </p>
      <pre class="chroma">  <span class="c1">// Sets the default action for return type std::unique_ptr&lt;Buzz&gt; to
</span><span class="c1"></span>  <span class="c1">// creating a new Buzz every time.
</span><span class="c1"></span>  <span class="n">DefaultValue</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Buzz</span><span class="o">&gt;&gt;::</span><span class="n">SetFactory</span><span class="p">(</span>
      <span class="p">[]</span> <span class="p">{</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Buzz</span><span class="o">&gt;</span><span class="p">(</span><span class="n">AccessLevel</span><span class="o">::</span><span class="n">kInternal</span><span class="p">);</span> <span class="p">});</span>

  <span class="c1">// When this fires, the default action of MakeBuzz() will run, which
</span><span class="c1"></span>  <span class="c1">// will return a new Buzz object.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_buzzer_</span><span class="p">,</span> <span class="n">MakeBuzz</span><span class="p">(</span><span class="s">"hello"</span><span class="p">)).</span><span class="n">Times</span><span class="p">(</span><span class="n">AnyNumber</span><span class="p">());</span>

  <span class="k">auto</span> <span class="n">buzz1</span> <span class="o">=</span> <span class="n">mock_buzzer_</span><span class="p">.</span><span class="n">MakeBuzz</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">buzz2</span> <span class="o">=</span> <span class="n">mock_buzzer_</span><span class="p">.</span><span class="n">MakeBuzz</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span>
  <span class="n">EXPECT_NE</span><span class="p">(</span><span class="n">buzz1</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">);</span>
  <span class="n">EXPECT_NE</span><span class="p">(</span><span class="n">buzz2</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">);</span>
  <span class="n">EXPECT_NE</span><span class="p">(</span><span class="n">buzz1</span><span class="p">,</span> <span class="n">buzz2</span><span class="p">);</span>

  <span class="c1">// Resets the default action for return type std::unique_ptr&lt;Buzz&gt;,
</span><span class="c1"></span>  <span class="c1">// to avoid interfere with other tests.
</span><span class="c1"></span>  <span class="n">DefaultValue</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Buzz</span><span class="o">&gt;&gt;::</span><span class="n">Clear</span><span class="p">();</span>
</pre>
      <p>To customize the default action for a particular method of a specific mock
        object, use <a href="reference/mocking.md#ON_CALL"><code>ON_CALL</code></a>. <code>ON_CALL</code> has a similar
        syntax to <code>EXPECT_CALL</code>, but it is used for setting default behaviors when you
        do not require that the mock method is called. See
        <a href="#gmock-cookbook#UseOnCall">Knowing When to Expect</a> for a more detailed
        discussion.
      </p>
      <h2 id="setting-expectations-expectcall">Setting Expectations {#ExpectCall}</h2>
      <p>See <a href="reference/mocking.md#EXPECT_CALL"><code>EXPECT_CALL</code></a> in the Mocking Reference.</p>
      <h2 id="matchers-matcherlist">Matchers {#MatcherList}</h2>
      <p>See the <a href="reference/matchers.md">Matchers Reference</a>.</p>
      <h2 id="actions-actionlist">Actions {#ActionList}</h2>
      <p>See the <a href="reference/actions.md">Actions Reference</a>.</p>
      <h2 id="cardinalities-cardinalitylist">Cardinalities {#CardinalityList}</h2>
      <p>See the <a href="reference/mocking.md#EXPECT_CALL.Times"><code>Times</code> clause</a> of
        <code>EXPECT_CALL</code> in the Mocking Reference.
      </p>
      <h2 id="expectation-order">Expectation Order</h2>
      <p>By default, expectations can be matched in <em>any</em> order. If some or all
        expectations must be matched in a given order, you can use the
        <a href="reference/mocking.md#EXPECT_CALL.After"><code>After</code> clause</a> or
        <a href="reference/mocking.md#EXPECT_CALL.InSequence"><code>InSequence</code> clause</a> of
        <code>EXPECT_CALL</code>, or use an <a href="reference/mocking.md#InSequence"><code>InSequence</code>
          object</a>.
      </p>
      <h2 id="verifying-and-resetting-a-mock">Verifying and Resetting a Mock</h2>
      <p>gMock will verify the expectations on a mock object when it is destructed, or
        you can do it earlier:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Mock</span><span class="p">;</span>
<span class="p">...</span>
<span class="c1">// Verifies and removes the expectations on mock_obj;
</span><span class="c1">// returns true if and only if successful.
</span><span class="c1"></span><span class="n">Mock</span><span class="o">::</span><span class="n">VerifyAndClearExpectations</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mock_obj</span><span class="p">);</span>
<span class="p">...</span>
<span class="c1">// Verifies and removes the expectations on mock_obj;
</span><span class="c1">// also removes the default actions set by ON_CALL();
</span><span class="c1">// returns true if and only if successful.
</span><span class="c1"></span><span class="n">Mock</span><span class="o">::</span><span class="n">VerifyAndClear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mock_obj</span><span class="p">);</span>
</pre>
      <p>Do not set new expectations after verifying and clearing a mock after its use.
        Setting expectations after code that exercises the mock has undefined behavior.
        See <a href="#gmock-for-dummies#using-mocks-in-tests">Using Mocks in Tests</a> for more
        information.</p>
      <p>You can also tell gMock that a mock object can be leaked and doesn’t need to be
        verified:</p>
      <pre class="chroma"><span class="n">Mock</span><span class="o">::</span><span class="n">AllowLeak</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mock_obj</span><span class="p">);</span>
</pre>
      <h2 id="mock-classes">Mock Classes</h2>
      <p>gMock defines a convenient mock class template</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">MockFunction</span><span class="o">&lt;</span><span class="n">R</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">An</span><span class="p">)</span><span class="o">&gt;</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Call</span><span class="p">,</span> <span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">An</span><span class="p">));</span>
<span class="p">};</span>
</pre>
      <p>See this <a href="#gmock-cookbook#UsingCheckPoints">recipe</a> for one application of
        it.</p>
      <h2 id="flags">Flags</h2>
      <table>
        <thead>
          <tr>
            <th align="left">Flag</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>--gmock_catch_leaked_mocks=0</code></td>
            <td align="left">Don’t report leaked mock objects as failures.</td>
          </tr>
          <tr>
            <td align="left"><code>--gmock_verbose=LEVEL</code></td>
            <td align="left">Sets the default verbosity level (<code>info</code>, <code>warning</code>, or
              <code>error</code>) of Google Mock messages.
            </td>
          </tr>
        </tbody>
      </table>
      <h1 id="testing-reference">Testing Reference</h1>
      <!--* toc_depth: 3 *-->
      <p>This page lists the facilities provided by GoogleTest for writing test programs.
        To use them, add <code>#include &lt;gtest/gtest.h&gt;</code>.</p>
      <h2 id="macros">Macros</h2>
      <p>GoogleTest defines the following macros for writing tests.</p>
      <h3 id="test-test">TEST {#TEST}</h3>
      <pre>TEST(<em>TestSuiteName</em>, <em>TestName</em>) {
  ... <em>statements</em> ...
}
</pre>
      <p>Defines an individual test named <em><code>TestName</code></em> in the test suite
        <em><code>TestSuiteName</code></em>, consisting of the given statements.
      </p>
      <p>Both arguments <em><code>TestSuiteName</code></em> and <em><code>TestName</code></em> must be valid C++
        identifiers
        and must not contain underscores (<code>_</code>). Tests in different test suites can have
        the same individual name.</p>
      <p>The statements within the test body can be any code under test.
        <a href="assertions.md">Assertions</a> used within the test body determine the outcome of
        the test.
      </p>
      <h3 id="test-f-test-f">TEST_F {#TEST_F}</h3>
      <pre>TEST_F(<em>TestFixtureName</em>, <em>TestName</em>) {
  ... <em>statements</em> ...
}
</pre>
      <p>Defines an individual test named <em><code>TestName</code></em> that uses the test fixture class
        <em><code>TestFixtureName</code></em>. The test suite name is <em><code>TestFixtureName</code></em>.
      </p>
      <p>Both arguments <em><code>TestFixtureName</code></em> and <em><code>TestName</code></em> must be valid C++
        identifiers and must not contain underscores (<code>_</code>). <em><code>TestFixtureName</code></em> must be
        the name of a test fixture class—see
        <a href="../primer.md#same-data-multiple-tests">Test Fixtures</a>.
      </p>
      <p>The statements within the test body can be any code under test.
        <a href="assertions.md">Assertions</a> used within the test body determine the outcome of
        the test.
      </p>
      <h3 id="test-p-test-p">TEST_P {#TEST_P}</h3>
      <pre>TEST_P(<em>TestFixtureName</em>, <em>TestName</em>) {
  ... <em>statements</em> ...
}
</pre>
      <p>Defines an individual value-parameterized test named <em><code>TestName</code></em> that uses the
        test fixture class <em><code>TestFixtureName</code></em>. The test suite name is
        <em><code>TestFixtureName</code></em>.
      </p>
      <p>Both arguments <em><code>TestFixtureName</code></em> and <em><code>TestName</code></em> must be valid C++
        identifiers and must not contain underscores (<code>_</code>). <em><code>TestFixtureName</code></em> must be
        the name of a value-parameterized test fixture class—see
        <a href="../#advanced-googletest-topics#value-parameterized-tests">Value-Parameterized Tests</a>.
      </p>
      <p>The statements within the test body can be any code under test. Within the test
        body, the test parameter can be accessed with the <code>GetParam()</code> function (see
        <a href="#WithParamInterface"><code>WithParamInterface</code></a>). For example:
      </p>
      <pre class="chroma"><span class="n">TEST_P</span><span class="p">(</span><span class="n">MyTestSuite</span><span class="p">,</span> <span class="n">DoesSomething</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">DoSomething</span><span class="p">(</span><span class="n">GetParam</span><span class="p">()));</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre>
      <p><a href="assertions.md">Assertions</a> used within the test body determine the outcome of
        the test.</p>
      <p>See also <a href="#INSTANTIATE_TEST_SUITE_P"><code>INSTANTIATE_TEST_SUITE_P</code></a>.</p>
      <h3 id="instantiate-test-suite-p-instantiate-test-suite-p">INSTANTIATE_TEST_SUITE_P {#INSTANTIATE_TEST_SUITE_P}
      </h3>
      <p>
        <code>INSTANTIATE_TEST_SUITE_P(</code><em><code>InstantiationName</code></em><code>,</code><em><code>TestSuiteName</code></em><code>,</code><em><code>param_generator</code></em><code>)</code>
        <br>
        <code>INSTANTIATE_TEST_SUITE_P(</code><em><code>InstantiationName</code></em><code>,</code><em><code>TestSuiteName</code></em><code>,</code><em><code>param_generator</code></em><code>,</code><em><code>name_generator</code></em><code>)</code>
      </p>
      <p>Instantiates the value-parameterized test suite <em><code>TestSuiteName</code></em> (defined with
        <a href="#TEST_P"><code>TEST_P</code></a>).
      </p>
      <p>The argument <em><code>InstantiationName</code></em> is a unique name for the instantiation of the
        test suite, to distinguish between multiple instantiations. In test output, the
        instantiation name is added as a prefix to the test suite name
        <em><code>TestSuiteName</code></em>. If <em><code>InstantiationName</code></em> is empty
        (<code>INSTANTIATE_TEST_SUITE_P(, ...)</code>), no prefix is added.
      </p>
      <p>The argument <em><code>param_generator</code></em> is one of the following GoogleTest-provided
        functions that generate the test parameters, all defined in the <code>::testing</code>
        namespace:</p>
      <p><span id="param-generators"></span></p>
      <table>
        <thead>
          <tr>
            <th>Parameter Generator</th>
            <th>Behavior</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Range(begin, end [, step])</code></td>
            <td>Yields values <code>{begin, begin+step, begin+step+step, ...}</code>. The values do not include
              <code>end</code>. <code>step</code> defaults to 1.
            </td>
          </tr>
          <tr>
            <td><code>Values(v1, v2, ..., vN)</code></td>
            <td>Yields values <code>{v1, v2, ..., vN}</code>.</td>
          </tr>
          <tr>
            <td><code>ValuesIn(container)</code> or <code>ValuesIn(begin,end)</code></td>
            <td>Yields values from a C-style array, an STL-style container, or an iterator range
              <code>[begin, end)</code>.
            </td>
          </tr>
          <tr>
            <td><code>Bool()</code></td>
            <td>Yields sequence <code>{false, true}</code>.</td>
          </tr>
          <tr>
            <td><code>Combine(g1, g2, ..., gN)</code></td>
            <td>Yields as <code>std::tuple</code> <em>n</em>-tuples all combinations (Cartesian product) of the values
              generated by the given <em>n</em> generators <code>g1</code>, <code>g2</code>, …, <code>gN</code>.</td>
          </tr>
          <tr>
            <td><code>ConvertGenerator&lt;T&gt;(g)</code></td>
            <td>Yields values generated by generator <code>g</code>, <code>static_cast</code> to <code>T</code>.</td>
          </tr>
        </tbody>
      </table>
      <p>The optional last argument <em><code>name_generator</code></em> is a function or functor that
        generates custom test name suffixes based on the test parameters. The function
        must accept an argument of type
        <a href="#TestParamInfo"><code>TestParamInfo&lt;class ParamType&gt;</code></a> and return a
        <code>std::string</code>.
        The test name suffix can only contain alphanumeric characters and underscores.
        GoogleTest provides <a href="#PrintToStringParamName"><code>PrintToStringParamName</code></a>, or a
        custom function can be used for more control:
      </p>
      <pre class="chroma"><span class="n">INSTANTIATE_TEST_SUITE_P</span><span class="p">(</span>
    <span class="n">MyInstantiation</span><span class="p">,</span> <span class="n">MyTestSuite</span><span class="p">,</span>
    <span class="n">testing</span><span class="o">::</span><span class="n">Values</span><span class="p">(...),</span>
    <span class="p">[](</span><span class="k">const</span> <span class="n">testing</span><span class="o">::</span><span class="n">TestParamInfo</span><span class="o">&lt;</span><span class="n">MyTestSuite</span><span class="o">::</span><span class="n">ParamType</span><span class="o">&gt;&amp;</span> <span class="n">info</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Can use info.param here to generate the test suffix
</span><span class="c1"></span>      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span> <span class="o">=</span> <span class="p">...</span>
      <span class="k">return</span> <span class="n">name</span><span class="p">;</span>
    <span class="p">});</span>
</pre>
      <p>For more information, see
        <a href="../#advanced-googletest-topics#value-parameterized-tests">Value-Parameterized Tests</a>.
      </p>
      <p>See also
        <a href="#GTEST_ALLOW_UNINSTANTIATED_PARAMETERIZED_TEST"><code>GTEST_ALLOW_UNINSTANTIATED_PARAMETERIZED_TEST</code></a>.
      </p>
      <h3 id="typed-test-suite-typed-test-suite">TYPED_TEST_SUITE {#TYPED_TEST_SUITE}</h3>
      <p>
        <code>TYPED_TEST_SUITE(</code><em><code>TestFixtureName</code></em><code>,</code><em><code>Types</code></em><code>)</code>
        <code>TYPED_TEST_SUITE(</code><em><code>TestFixtureName</code></em><code>,</code><em><code>Types</code></em><code>,</code><em><code>NameGenerator</code></em><code>)</code>
      </p>
      <p>Defines a typed test suite based on the test fixture <em><code>TestFixtureName</code></em>. The
        test suite name is <em><code>TestFixtureName</code></em>.</p>
      <p>The argument <em><code>TestFixtureName</code></em> is a fixture class template, parameterized by a
        type, for example:</p>
      <pre class="chroma"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">MyFixture</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="p">...</span>
  <span class="k">using</span> <span class="n">List</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="k">static</span> <span class="n">T</span> <span class="n">shared_</span><span class="p">;</span>
  <span class="n">T</span> <span class="n">value_</span><span class="p">;</span>
<span class="p">};</span>
</pre>
      <p>The argument <em><code>Types</code></em> is a <a href="#Types"><code>Types</code></a> object representing the
        list of
        types to run the tests on, for example:</p>
      <pre class="chroma"><span class="k">using</span> <span class="n">MyTypes</span> <span class="o">=</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Types</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="n">TYPED_TEST_SUITE</span><span class="p">(</span><span class="n">MyFixture</span><span class="p">,</span> <span class="n">MyTypes</span><span class="p">);</span>
</pre>
      <p>The type alias (<code>using</code> or <code>typedef</code>) is necessary for the <code>TYPED_TEST_SUITE</code>
        macro to parse correctly.</p>
      <p>The optional third argument <em><code>NameGenerator</code></em> allows specifying a class that
        exposes a templated static function <code>GetName(int)</code>. For example:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">NameGenerator</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
  <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetName</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nf">constexpr</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">char</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">return</span> <span class="s">"char"</span><span class="p">;</span>
    <span class="k">if</span> <span class="nf">constexpr</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">return</span> <span class="s">"int"</span><span class="p">;</span>
    <span class="k">if</span> <span class="nf">constexpr</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">return</span> <span class="s">"unsignedInt"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="n">TYPED_TEST_SUITE</span><span class="p">(</span><span class="n">MyFixture</span><span class="p">,</span> <span class="n">MyTypes</span><span class="p">,</span> <span class="n">NameGenerator</span><span class="p">);</span>
</pre>
      <p>See also <a href="#TYPED_TEST"><code>TYPED_TEST</code></a> and
        <a href="../#advanced-googletest-topics#typed-tests">Typed Tests</a> for more information.
      </p>
      <h3 id="typed-test-typed-test">TYPED_TEST {#TYPED_TEST}</h3>
      <pre>TYPED_TEST(<em>TestSuiteName</em>, <em>TestName</em>) {
  ... <em>statements</em> ...
}
</pre>
      <p>Defines an individual typed test named <em><code>TestName</code></em> in the typed test suite
        <em><code>TestSuiteName</code></em>. The test suite must be defined with
        <a href="#TYPED_TEST_SUITE"><code>TYPED_TEST_SUITE</code></a>.
      </p>
      <p>Within the test body, the special name <code>TypeParam</code> refers to the type parameter,
        and <code>TestFixture</code> refers to the fixture class. See the following example:</p>
      <pre class="chroma"><span class="n">TYPED_TEST</span><span class="p">(</span><span class="n">MyFixture</span><span class="p">,</span> <span class="n">Example</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Inside a test, refer to the special name TypeParam to get the type
</span><span class="c1"></span>  <span class="c1">// parameter.  Since we are inside a derived class template, C++ requires
</span><span class="c1"></span>  <span class="c1">// us to visit the members of MyFixture via 'this'.
</span><span class="c1"></span>  <span class="n">TypeParam</span> <span class="n">n</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">value_</span><span class="p">;</span>

  <span class="c1">// To visit static members of the fixture, add the 'TestFixture::'
</span><span class="c1"></span>  <span class="c1">// prefix.
</span><span class="c1"></span>  <span class="n">n</span> <span class="o">+=</span> <span class="n">TestFixture</span><span class="o">::</span><span class="n">shared_</span><span class="p">;</span>

  <span class="c1">// To refer to typedefs in the fixture, add the 'typename TestFixture::'
</span><span class="c1"></span>  <span class="c1">// prefix. The 'typename' is required to satisfy the compiler.
</span><span class="c1"></span>  <span class="k">typename</span> <span class="n">TestFixture</span><span class="o">::</span><span class="n">List</span> <span class="n">values</span><span class="p">;</span>

  <span class="n">values</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre>
      <p>For more information, see <a href="../#advanced-googletest-topics#typed-tests">Typed Tests</a>.</p>
      <h3 id="typed-test-suite-p-typed-test-suite-p">TYPED_TEST_SUITE_P {#TYPED_TEST_SUITE_P}</h3>
      <p><code>TYPED_TEST_SUITE_P(</code><em><code>TestFixtureName</code></em><code>)</code></p>
      <p>Defines a type-parameterized test suite based on the test fixture
        <em><code>TestFixtureName</code></em>. The test suite name is <em><code>TestFixtureName</code></em>.
      </p>
      <p>The argument <em><code>TestFixtureName</code></em> is a fixture class template, parameterized by a
        type. See <a href="#TYPED_TEST_SUITE"><code>TYPED_TEST_SUITE</code></a> for an example.</p>
      <p>See also <a href="#TYPED_TEST_P"><code>TYPED_TEST_P</code></a> and
        <a href="../#advanced-googletest-topics#type-parameterized-tests">Type-Parameterized Tests</a> for more
        information.
      </p>
      <h3 id="typed-test-p-typed-test-p">TYPED_TEST_P {#TYPED_TEST_P}</h3>
      <pre>TYPED_TEST_P(<em>TestSuiteName</em>, <em>TestName</em>) {
  ... <em>statements</em> ...
}
</pre>
      <p>Defines an individual type-parameterized test named <em><code>TestName</code></em> in the
        type-parameterized test suite <em><code>TestSuiteName</code></em>. The test suite must be defined
        with <a href="#TYPED_TEST_SUITE_P"><code>TYPED_TEST_SUITE_P</code></a>.</p>
      <p>Within the test body, the special name <code>TypeParam</code> refers to the type parameter,
        and <code>TestFixture</code> refers to the fixture class. See <a href="#TYPED_TEST"><code>TYPED_TEST</code></a>
        for an example.</p>
      <p>See also <a href="#REGISTER_TYPED_TEST_SUITE_P"><code>REGISTER_TYPED_TEST_SUITE_P</code></a> and
        <a href="../#advanced-googletest-topics#type-parameterized-tests">Type-Parameterized Tests</a> for more
        information.
      </p>
      <h3 id="register-typed-test-suite-p-register-typed-test-suite-p">REGISTER_TYPED_TEST_SUITE_P
        {#REGISTER_TYPED_TEST_SUITE_P}</h3>
      <p>
        <code>REGISTER_TYPED_TEST_SUITE_P(</code><em><code>TestSuiteName</code></em><code>,</code><em><code>TestNames...</code></em><code>)</code>
      </p>
      <p>Registers the type-parameterized tests <em><code>TestNames...</code></em> of the test suite
        <em><code>TestSuiteName</code></em>. The test suite and tests must be defined with
        <a href="#TYPED_TEST_SUITE_P"><code>TYPED_TEST_SUITE_P</code></a> and <a href="#TYPED_TEST_P"><code>TYPED_TEST_P</code></a>.
      </p>
      <p>For example:</p>
      <pre class="chroma"><span class="c1">// Define the test suite and tests.
</span><span class="c1"></span><span class="n">TYPED_TEST_SUITE_P</span><span class="p">(</span><span class="n">MyFixture</span><span class="p">);</span>
<span class="n">TYPED_TEST_P</span><span class="p">(</span><span class="n">MyFixture</span><span class="p">,</span> <span class="n">HasPropertyA</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TYPED_TEST_P</span><span class="p">(</span><span class="n">MyFixture</span><span class="p">,</span> <span class="n">HasPropertyB</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="c1">// Register the tests in the test suite.
</span><span class="c1"></span><span class="n">REGISTER_TYPED_TEST_SUITE_P</span><span class="p">(</span><span class="n">MyFixture</span><span class="p">,</span> <span class="n">HasPropertyA</span><span class="p">,</span> <span class="n">HasPropertyB</span><span class="p">);</span>
</pre>
      <p>See also <a href="#INSTANTIATE_TYPED_TEST_SUITE_P"><code>INSTANTIATE_TYPED_TEST_SUITE_P</code></a> and
        <a href="../#advanced-googletest-topics#type-parameterized-tests">Type-Parameterized Tests</a> for more
        information.
      </p>
      <h3 id="instantiate-typed-test-suite-p-instantiate-typed-test-suite-p">INSTANTIATE_TYPED_TEST_SUITE_P
        {#INSTANTIATE_TYPED_TEST_SUITE_P}</h3>
      <p>
        <code>INSTANTIATE_TYPED_TEST_SUITE_P(</code><em><code>InstantiationName</code></em><code>,</code><em><code>TestSuiteName</code></em><code>,</code><em><code>Types</code></em><code>)</code>
      </p>
      <p>Instantiates the type-parameterized test suite <em><code>TestSuiteName</code></em>. The test suite
        must be registered with
        <a href="#REGISTER_TYPED_TEST_SUITE_P"><code>REGISTER_TYPED_TEST_SUITE_P</code></a>.
      </p>
      <p>The argument <em><code>InstantiationName</code></em> is a unique name for the instantiation of the
        test suite, to distinguish between multiple instantiations. In test output, the
        instantiation name is added as a prefix to the test suite name
        <em><code>TestSuiteName</code></em>. If <em><code>InstantiationName</code></em> is empty
        (<code>INSTANTIATE_TYPED_TEST_SUITE_P(, ...)</code>), no prefix is added.
      </p>
      <p>The argument <em><code>Types</code></em> is a <a href="#Types"><code>Types</code></a> object representing the
        list of
        types to run the tests on, for example:</p>
      <pre class="chroma"><span class="k">using</span> <span class="n">MyTypes</span> <span class="o">=</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Types</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="n">INSTANTIATE_TYPED_TEST_SUITE_P</span><span class="p">(</span><span class="n">MyInstantiation</span><span class="p">,</span> <span class="n">MyFixture</span><span class="p">,</span> <span class="n">MyTypes</span><span class="p">);</span>
</pre>
      <p>The type alias (<code>using</code> or <code>typedef</code>) is necessary for the
        <code>INSTANTIATE_TYPED_TEST_SUITE_P</code> macro to parse correctly.
      </p>
      <p>For more information, see
        <a href="../#advanced-googletest-topics#type-parameterized-tests">Type-Parameterized Tests</a>.
      </p>
      <h3 id="friend-test-friend-test">FRIEND_TEST {#FRIEND_TEST}</h3>
      <p>
        <code>FRIEND_TEST(</code><em><code>TestSuiteName</code></em><code>,</code><em><code>TestName</code></em><code>)</code>
      </p>
      <p>Within a class body, declares an individual test as a friend of the class,
        enabling the test to access private class members.</p>
      <p>If the class is defined in a namespace, then in order to be friends of the
        class, test fixtures and tests must be defined in the exact same namespace,
        without inline or anonymous namespaces.</p>
      <p>For example, if the class definition looks like the following:</p>
      <pre class="chroma"><span class="k">namespace</span> <span class="n">my_namespace</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">MyClass</span> <span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span> <span class="nc">MyClassTest</span><span class="p">;</span>
  <span class="n">FRIEND_TEST</span><span class="p">(</span><span class="n">MyClassTest</span><span class="p">,</span> <span class="n">HasPropertyA</span><span class="p">);</span>
  <span class="n">FRIEND_TEST</span><span class="p">(</span><span class="n">MyClassTest</span><span class="p">,</span> <span class="n">HasPropertyB</span><span class="p">);</span>
  <span class="p">...</span> <span class="n">definition</span> <span class="n">of</span> <span class="k">class</span> <span class="nc">MyClass</span> <span class="p">...</span>
<span class="p">};</span>

<span class="p">}</span>  <span class="c1">// namespace my_namespace
</span></pre>
      <p>Then the test code should look like:</p>
      <pre class="chroma"><span class="k">namespace</span> <span class="n">my_namespace</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">MyClassTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">};</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">MyClassTest</span><span class="p">,</span> <span class="n">HasPropertyA</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">MyClassTest</span><span class="p">,</span> <span class="n">HasPropertyB</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="p">}</span>  <span class="c1">// namespace my_namespace
</span></pre>
      <p>See <a href="../#advanced-googletest-topics#testing-private-code">Testing Private Code</a> for more
        information.</p>
      <h3 id="scoped-trace-scoped-trace">SCOPED_TRACE {#SCOPED_TRACE}</h3>
      <p><code>SCOPED_TRACE(</code><em><code>message</code></em><code>)</code></p>
      <p>Causes the current file name, line number, and the given message <em><code>message</code></em> to
        be added to the failure message for each assertion failure that occurs in the
        scope.</p>
      <p>For more information, see
        <a href="../#advanced-googletest-topics#adding-traces-to-assertions">Adding Traces to Assertions</a>.
      </p>
      <p>See also the <a href="#ScopedTrace"><code>ScopedTrace</code> class</a>.</p>
      <h3 id="gtest-skip-gtest-skip">GTEST_SKIP {#GTEST_SKIP}</h3>
      <p><code>GTEST_SKIP()</code></p>
      <p>Prevents further test execution at runtime.</p>
      <p>Can be used in individual test cases or in the <code>SetUp()</code> methods of test
        environments or test fixtures (classes derived from the
        <a href="#Environment"><code>Environment</code></a> or <a href="#Test"><code>Test</code></a> classes). If used
        in a global
        test environment <code>SetUp()</code> method, it skips all tests in the test program. If
        used in a test fixture <code>SetUp()</code> method, it skips all tests in the corresponding
        test suite.
      </p>
      <p>Similar to assertions, <code>GTEST_SKIP</code> allows streaming a custom message into it.</p>
      <p>See <a href="../#advanced-googletest-topics#skipping-test-execution">Skipping Test Execution</a> for more
        information.</p>
      <h3 id="gtest-allow-uninstantiated-parameterized-test-gtest-allow-uninstantiated-parameterized-test">
        GTEST_ALLOW_UNINSTANTIATED_PARAMETERIZED_TEST {#GTEST_ALLOW_UNINSTANTIATED_PARAMETERIZED_TEST}</h3>
      <p><code>GTEST_ALLOW_UNINSTANTIATED_PARAMETERIZED_TEST(</code><em><code>TestSuiteName</code></em><code>)</code>
      </p>
      <p>Allows the value-parameterized test suite <em><code>TestSuiteName</code></em> to be
        uninstantiated.</p>
      <p>By default, every <a href="#TEST_P"><code>TEST_P</code></a> call without a corresponding
        <a href="#INSTANTIATE_TEST_SUITE_P"><code>INSTANTIATE_TEST_SUITE_P</code></a> call causes a failing
        test in the test suite <code>GoogleTestVerification</code>.
        <code>GTEST_ALLOW_UNINSTANTIATED_PARAMETERIZED_TEST</code> suppresses this failure for the
        given test suite.
      </p>
      <h2 id="classes-and-types">Classes and types</h2>
      <p>GoogleTest defines the following classes and types to help with writing tests.</p>
      <h3 id="assertionresult-assertionresult">AssertionResult {#AssertionResult}</h3>
      <p><code>testing::AssertionResult</code></p>
      <p>A class for indicating whether an assertion was successful.</p>
      <p>When the assertion wasn’t successful, the <code>AssertionResult</code> object stores a
        non-empty failure message that can be retrieved with the object’s <code>message()</code>
        method.</p>
      <p>To create an instance of this class, use one of the factory functions
        <a href="#AssertionSuccess"><code>AssertionSuccess()</code></a> or
        <a href="#AssertionFailure"><code>AssertionFailure()</code></a>.
      </p>
      <h3 id="assertionexception-assertionexception">AssertionException {#AssertionException}</h3>
      <p><code>testing::AssertionException</code></p>
      <p>Exception which can be thrown from
        <a href="#TestEventListener::OnTestPartResult"><code>TestEventListener::OnTestPartResult</code></a>.
      </p>
      <h3 id="emptytesteventlistener-emptytesteventlistener">EmptyTestEventListener {#EmptyTestEventListener}</h3>
      <p><code>testing::EmptyTestEventListener</code></p>
      <p>Provides an empty implementation of all methods in the
        <a href="#TestEventListener"><code>TestEventListener</code></a> interface, such that a subclass only
        needs to override the methods it cares about.
      </p>
      <h3 id="environment-environment">Environment {#Environment}</h3>
      <p><code>testing::Environment</code></p>
      <p>Represents a global test environment. See
        <a href="../#advanced-googletest-topics#global-set-up-and-tear-down">Global Set-Up and Tear-Down</a>.
      </p>
      <h4 id="protected-methods-environment-protected">Protected Methods {#Environment-protected}</h4>
      <h5 id="setup-environmentsetup">SetUp {#Environment::SetUp}</h5>
      <p><code>virtual void Environment::SetUp()</code></p>
      <p>Override this to define how to set up the environment.</p>
      <h5 id="teardown-environmentteardown">TearDown {#Environment::TearDown}</h5>
      <p><code>virtual void Environment::TearDown()</code></p>
      <p>Override this to define how to tear down the environment.</p>
      <h3 id="scopedtrace-scopedtrace">ScopedTrace {#ScopedTrace}</h3>
      <p><code>testing::ScopedTrace</code></p>
      <p>An instance of this class causes a trace to be included in every test failure
        message generated by code in the scope of the lifetime of the <code>ScopedTrace</code>
        instance. The effect is undone with the destruction of the instance.</p>
      <p>The <code>ScopedTrace</code> constructor has the following form:</p>
      <pre class="chroma"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="n">ScopedTrace</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">message</span><span class="p">)</span>
</pre>
      <p>Example usage:</p>
      <pre class="chroma"><span class="n">testing</span><span class="o">::</span><span class="n">ScopedTrace</span> <span class="n">trace</span><span class="p">(</span><span class="s">"file.cc"</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="s">"message"</span><span class="p">);</span>
</pre>
      <p>The resulting trace includes the given source file path and line number, and the
        given message. The <code>message</code> argument can be anything streamable to
        <code>std::ostream</code>.
      </p>
      <p>See also <a href="#SCOPED_TRACE"><code>SCOPED_TRACE</code></a>.</p>
      <h3 id="test-test-1">Test {#Test}</h3>
      <p><code>testing::Test</code></p>
      <p>The abstract class that all tests inherit from. <code>Test</code> is not copyable.</p>
      <h4 id="public-methods-test-public">Public Methods {#Test-public}</h4>
      <h5 id="setuptestsuite-testsetuptestsuite">SetUpTestSuite {#Test::SetUpTestSuite}</h5>
      <p><code>static void Test::SetUpTestSuite()</code></p>
      <p>Performs shared setup for all tests in the test suite. GoogleTest calls
        <code>SetUpTestSuite()</code> before running the first test in the test suite.
      </p>
      <h5 id="teardowntestsuite-testteardowntestsuite">TearDownTestSuite {#Test::TearDownTestSuite}</h5>
      <p><code>static void Test::TearDownTestSuite()</code></p>
      <p>Performs shared teardown for all tests in the test suite. GoogleTest calls
        <code>TearDownTestSuite()</code> after running the last test in the test suite.
      </p>
      <h5 id="hasfatalfailure-testhasfatalfailure">HasFatalFailure {#Test::HasFatalFailure}</h5>
      <p><code>static bool Test::HasFatalFailure()</code></p>
      <p>Returns true if and only if the current test has a fatal failure.</p>
      <h5 id="hasnonfatalfailure-testhasnonfatalfailure">HasNonfatalFailure {#Test::HasNonfatalFailure}</h5>
      <p><code>static bool Test::HasNonfatalFailure()</code></p>
      <p>Returns true if and only if the current test has a nonfatal failure.</p>
      <h5 id="hasfailure-testhasfailure">HasFailure {#Test::HasFailure}</h5>
      <p><code>static bool Test::HasFailure()</code></p>
      <p>Returns true if and only if the current test has any failure, either fatal or
        nonfatal.</p>
      <h5 id="isskipped-testisskipped">IsSkipped {#Test::IsSkipped}</h5>
      <p><code>static bool Test::IsSkipped()</code></p>
      <p>Returns true if and only if the current test was skipped.</p>
      <h5 id="recordproperty-testrecordproperty">RecordProperty {#Test::RecordProperty}</h5>
      <p><code>static void Test::RecordProperty(const std::string&amp; key, const std::string&amp; value)</code><br>
        <code>static void Test::RecordProperty(const std::string&amp; key, int value)</code>
      </p>
      <p>Logs a property for the current test, test suite, or entire invocation of the
        test program. Only the last value for a given key is logged.</p>
      <p>The key must be a valid XML attribute name, and cannot conflict with the ones
        already used by GoogleTest (<code>name</code>, <code>file</code>, <code>line</code>, <code>status</code>,
        <code>time</code>,
        <code>classname</code>, <code>type_param</code>, and <code>value_param</code>).
      </p>
      <p><code>RecordProperty</code> is <code>public static</code> so it can be called from utility functions
        that are not members of the test fixture.</p>
      <p>Calls to <code>RecordProperty</code> made during the lifespan of the test (from the moment
        its constructor starts to the moment its destructor finishes) are output in XML
        as attributes of the <code>&lt;testcase&gt;</code> element. Properties recorded from a fixture’s
        <code>SetUpTestSuite</code> or <code>TearDownTestSuite</code> methods are logged as attributes of the
        corresponding <code>&lt;testsuite&gt;</code> element. Calls to <code>RecordProperty</code> made in the
        global context (before or after invocation of <code>RUN_ALL_TESTS</code> or from the
        <code>SetUp</code>/<code>TearDown</code> methods of registered <code>Environment</code> objects) are output as
        attributes of the <code>&lt;testsuites&gt;</code> element.
      </p>
      <h4 id="protected-methods-test-protected">Protected Methods {#Test-protected}</h4>
      <h5 id="setup-testsetup">SetUp {#Test::SetUp}</h5>
      <p><code>virtual void Test::SetUp()</code></p>
      <p>Override this to perform test fixture setup. GoogleTest calls <code>SetUp()</code> before
        running each individual test.</p>
      <h5 id="teardown-testteardown">TearDown {#Test::TearDown}</h5>
      <p><code>virtual void Test::TearDown()</code></p>
      <p>Override this to perform test fixture teardown. GoogleTest calls <code>TearDown()</code>
        after running each individual test.</p>
      <h3 id="testwithparam-testwithparam">TestWithParam {#TestWithParam}</h3>
      <p><code>testing::TestWithParam&lt;T&gt;</code></p>
      <p>A convenience class which inherits from both <a href="#Test"><code>Test</code></a> and
        <a href="#WithParamInterface"><code>WithParamInterface&lt;T&gt;</code></a>.
      </p>
      <h3 id="testsuite-testsuite">TestSuite {#TestSuite}</h3>
      <p>Represents a test suite. <code>TestSuite</code> is not copyable.</p>
      <h4 id="public-methods-testsuite-public">Public Methods {#TestSuite-public}</h4>
      <h5 id="name-testsuitename">name {#TestSuite::name}</h5>
      <p><code>const char* TestSuite::name() const</code></p>
      <p>Gets the name of the test suite.</p>
      <h5 id="type-param-testsuitetype-param">type_param {#TestSuite::type_param}</h5>
      <p><code>const char* TestSuite::type_param() const</code></p>
      <p>Returns the name of the parameter type, or <code>NULL</code> if this is not a typed or
        type-parameterized test suite. See <a href="../#advanced-googletest-topics#typed-tests">Typed Tests</a> and
        <a href="../#advanced-googletest-topics#type-parameterized-tests">Type-Parameterized Tests</a>.
      </p>
      <h5 id="should-run-testsuiteshould-run">should_run {#TestSuite::should_run}</h5>
      <p><code>bool TestSuite::should_run() const</code></p>
      <p>Returns true if any test in this test suite should run.</p>
      <h5 id="successful-test-count-testsuitesuccessful-test-count">successful_test_count
        {#TestSuite::successful_test_count}</h5>
      <p><code>int TestSuite::successful_test_count() const</code></p>
      <p>Gets the number of successful tests in this test suite.</p>
      <h5 id="skipped-test-count-testsuiteskipped-test-count">skipped_test_count {#TestSuite::skipped_test_count}</h5>
      <p><code>int TestSuite::skipped_test_count() const</code></p>
      <p>Gets the number of skipped tests in this test suite.</p>
      <h5 id="failed-test-count-testsuitefailed-test-count">failed_test_count {#TestSuite::failed_test_count}</h5>
      <p><code>int TestSuite::failed_test_count() const</code></p>
      <p>Gets the number of failed tests in this test suite.</p>
      <h5 id="reportable-disabled-test-count-testsuitereportable-disabled-test-count">reportable_disabled_test_count
        {#TestSuite::reportable_disabled_test_count}</h5>
      <p><code>int TestSuite::reportable_disabled_test_count() const</code></p>
      <p>Gets the number of disabled tests that will be reported in the XML report.</p>
      <h5 id="disabled-test-count-testsuitedisabled-test-count">disabled_test_count {#TestSuite::disabled_test_count}
      </h5>
      <p><code>int TestSuite::disabled_test_count() const</code></p>
      <p>Gets the number of disabled tests in this test suite.</p>
      <h5 id="reportable-test-count-testsuitereportable-test-count">reportable_test_count
        {#TestSuite::reportable_test_count}</h5>
      <p><code>int TestSuite::reportable_test_count() const</code></p>
      <p>Gets the number of tests to be printed in the XML report.</p>
      <h5 id="test-to-run-count-testsuitetest-to-run-count">test_to_run_count {#TestSuite::test_to_run_count}</h5>
      <p><code>int TestSuite::test_to_run_count() const</code></p>
      <p>Get the number of tests in this test suite that should run.</p>
      <h5 id="total-test-count-testsuitetotal-test-count">total_test_count {#TestSuite::total_test_count}</h5>
      <p><code>int TestSuite::total_test_count() const</code></p>
      <p>Gets the number of all tests in this test suite.</p>
      <h5 id="passed-testsuitepassed">Passed {#TestSuite::Passed}</h5>
      <p><code>bool TestSuite::Passed() const</code></p>
      <p>Returns true if and only if the test suite passed.</p>
      <h5 id="failed-testsuitefailed">Failed {#TestSuite::Failed}</h5>
      <p><code>bool TestSuite::Failed() const</code></p>
      <p>Returns true if and only if the test suite failed.</p>
      <h5 id="elapsed-time-testsuiteelapsed-time">elapsed_time {#TestSuite::elapsed_time}</h5>
      <p><code>TimeInMillis TestSuite::elapsed_time() const</code></p>
      <p>Returns the elapsed time, in milliseconds.</p>
      <h5 id="start-timestamp-testsuitestart-timestamp">start_timestamp {#TestSuite::start_timestamp}</h5>
      <p><code>TimeInMillis TestSuite::start_timestamp() const</code></p>
      <p>Gets the time of the test suite start, in ms from the start of the UNIX epoch.</p>
      <h5 id="gettestinfo-testsuitegettestinfo">GetTestInfo {#TestSuite::GetTestInfo}</h5>
      <p><code>const TestInfo* TestSuite::GetTestInfo(int i) const</code></p>
      <p>Returns the <a href="#TestInfo"><code>TestInfo</code></a> for the <code>i</code>-th test among all the tests.
        <code>i</code>
        can range from 0 to <code>total_test_count() - 1</code>. If <code>i</code> is not in that range,
        returns <code>NULL</code>.
      </p>
      <h5 id="ad-hoc-test-result-testsuitead-hoc-test-result">ad_hoc_test_result {#TestSuite::ad_hoc_test_result}</h5>
      <p><code>const TestResult&amp; TestSuite::ad_hoc_test_result() const</code></p>
      <p>Returns the <a href="#TestResult"><code>TestResult</code></a> that holds test properties recorded
        during execution of <code>SetUpTestSuite</code> and <code>TearDownTestSuite</code>.</p>
      <h3 id="testinfo-testinfo">TestInfo {#TestInfo}</h3>
      <p><code>testing::TestInfo</code></p>
      <p>Stores information about a test.</p>
      <h4 id="public-methods-testinfo-public">Public Methods {#TestInfo-public}</h4>
      <h5 id="test-suite-name-testinfotest-suite-name">test_suite_name {#TestInfo::test_suite_name}</h5>
      <p><code>const char* TestInfo::test_suite_name() const</code></p>
      <p>Returns the test suite name.</p>
      <h5 id="name-testinfoname">name {#TestInfo::name}</h5>
      <p><code>const char* TestInfo::name() const</code></p>
      <p>Returns the test name.</p>
      <h5 id="type-param-testinfotype-param">type_param {#TestInfo::type_param}</h5>
      <p><code>const char* TestInfo::type_param() const</code></p>
      <p>Returns the name of the parameter type, or <code>NULL</code> if this is not a typed or
        type-parameterized test. See <a href="../#advanced-googletest-topics#typed-tests">Typed Tests</a> and
        <a href="../#advanced-googletest-topics#type-parameterized-tests">Type-Parameterized Tests</a>.
      </p>
      <h5 id="value-param-testinfovalue-param">value_param {#TestInfo::value_param}</h5>
      <p><code>const char* TestInfo::value_param() const</code></p>
      <p>Returns the text representation of the value parameter, or <code>NULL</code> if this is not
        a value-parameterized test. See
        <a href="../#advanced-googletest-topics#value-parameterized-tests">Value-Parameterized Tests</a>.
      </p>
      <h5 id="file-testinfofile">file {#TestInfo::file}</h5>
      <p><code>const char* TestInfo::file() const</code></p>
      <p>Returns the file name where this test is defined.</p>
      <h5 id="line-testinfoline">line {#TestInfo::line}</h5>
      <p><code>int TestInfo::line() const</code></p>
      <p>Returns the line where this test is defined.</p>
      <h5 id="is-in-another-shard-testinfois-in-another-shard">is_in_another_shard {#TestInfo::is_in_another_shard}</h5>
      <p><code>bool TestInfo::is_in_another_shard() const</code></p>
      <p>Returns true if this test should not be run because it’s in another shard.</p>
      <h5 id="should-run-testinfoshould-run">should_run {#TestInfo::should_run}</h5>
      <p><code>bool TestInfo::should_run() const</code></p>
      <p>Returns true if this test should run, that is if the test is not disabled (or it
        is disabled but the <code>also_run_disabled_tests</code> flag has been specified) and its
        full name matches the user-specified filter.</p>
      <p>GoogleTest allows the user to filter the tests by their full names. Only the
        tests that match the filter will run. See
        <a href="../#advanced-googletest-topics#running-a-subset-of-the-tests">Running a Subset of the Tests</a>
        for more information.
      </p>
      <h5 id="is-reportable-testinfois-reportable">is_reportable {#TestInfo::is_reportable}</h5>
      <p><code>bool TestInfo::is_reportable() const</code></p>
      <p>Returns true if and only if this test will appear in the XML report.</p>
      <h5 id="result-testinforesult">result {#TestInfo::result}</h5>
      <p><code>const TestResult* TestInfo::result() const</code></p>
      <p>Returns the result of the test. See <a href="#TestResult"><code>TestResult</code></a>.</p>
      <h3 id="testparaminfo-testparaminfo">TestParamInfo {#TestParamInfo}</h3>
      <p><code>testing::TestParamInfo&lt;T&gt;</code></p>
      <p>Describes a parameter to a value-parameterized test. The type <code>T</code> is the type of
        the parameter.</p>
      <p>Contains the fields <code>param</code> and <code>index</code> which hold the value of the parameter
        and its integer index respectively.</p>
      <h3 id="unittest-unittest">UnitTest {#UnitTest}</h3>
      <p><code>testing::UnitTest</code></p>
      <p>This class contains information about the test program.</p>
      <p><code>UnitTest</code> is a singleton class. The only instance is created when
        <code>UnitTest::GetInstance()</code> is first called. This instance is never deleted.
      </p>
      <p><code>UnitTest</code> is not copyable.</p>
      <h4 id="public-methods-unittest-public">Public Methods {#UnitTest-public}</h4>
      <h5 id="getinstance-unittestgetinstance">GetInstance {#UnitTest::GetInstance}</h5>
      <p><code>static UnitTest* UnitTest::GetInstance()</code></p>
      <p>Gets the singleton <code>UnitTest</code> object. The first time this method is called, a
        <code>UnitTest</code> object is constructed and returned. Consecutive calls will return the
        same object.
      </p>
      <h5 id="original-working-dir-unittestoriginal-working-dir">original_working_dir {#UnitTest::original_working_dir}
      </h5>
      <p><code>const char* UnitTest::original_working_dir() const</code></p>
      <p>Returns the working directory when the first <a href="#TEST"><code>TEST()</code></a> or
        <a href="#TEST_F"><code>TEST_F()</code></a> was executed. The <code>UnitTest</code> object owns the string.
      </p>
      <h5 id="current-test-suite-unittestcurrent-test-suite">current_test_suite {#UnitTest::current_test_suite}</h5>
      <p><code>const TestSuite* UnitTest::current_test_suite() const</code></p>
      <p>Returns the <a href="#TestSuite"><code>TestSuite</code></a> object for the test that’s currently
        running, or <code>NULL</code> if no test is running.</p>
      <h5 id="current-test-info-unittestcurrent-test-info">current_test_info {#UnitTest::current_test_info}</h5>
      <p><code>const TestInfo* UnitTest::current_test_info() const</code></p>
      <p>Returns the <a href="#TestInfo"><code>TestInfo</code></a> object for the test that’s currently
        running, or <code>NULL</code> if no test is running.</p>
      <h5 id="random-seed-unittestrandom-seed">random_seed {#UnitTest::random_seed}</h5>
      <p><code>int UnitTest::random_seed() const</code></p>
      <p>Returns the random seed used at the start of the current test run.</p>
      <h5 id="successful-test-suite-count-unittestsuccessful-test-suite-count">successful_test_suite_count
        {#UnitTest::successful_test_suite_count}</h5>
      <p><code>int UnitTest::successful_test_suite_count() const</code></p>
      <p>Gets the number of successful test suites.</p>
      <h5 id="failed-test-suite-count-unittestfailed-test-suite-count">failed_test_suite_count
        {#UnitTest::failed_test_suite_count}</h5>
      <p><code>int UnitTest::failed_test_suite_count() const</code></p>
      <p>Gets the number of failed test suites.</p>
      <h5 id="total-test-suite-count-unittesttotal-test-suite-count">total_test_suite_count
        {#UnitTest::total_test_suite_count}</h5>
      <p><code>int UnitTest::total_test_suite_count() const</code></p>
      <p>Gets the number of all test suites.</p>
      <h5 id="test-suite-to-run-count-unittesttest-suite-to-run-count">test_suite_to_run_count
        {#UnitTest::test_suite_to_run_count}</h5>
      <p><code>int UnitTest::test_suite_to_run_count() const</code></p>
      <p>Gets the number of all test suites that contain at least one test that should
        run.</p>
      <h5 id="successful-test-count-unittestsuccessful-test-count">successful_test_count
        {#UnitTest::successful_test_count}</h5>
      <p><code>int UnitTest::successful_test_count() const</code></p>
      <p>Gets the number of successful tests.</p>
      <h5 id="skipped-test-count-unittestskipped-test-count">skipped_test_count {#UnitTest::skipped_test_count}</h5>
      <p><code>int UnitTest::skipped_test_count() const</code></p>
      <p>Gets the number of skipped tests.</p>
      <h5 id="failed-test-count-unittestfailed-test-count">failed_test_count {#UnitTest::failed_test_count}</h5>
      <p><code>int UnitTest::failed_test_count() const</code></p>
      <p>Gets the number of failed tests.</p>
      <h5 id="reportable-disabled-test-count-unittestreportable-disabled-test-count">reportable_disabled_test_count
        {#UnitTest::reportable_disabled_test_count}</h5>
      <p><code>int UnitTest::reportable_disabled_test_count() const</code></p>
      <p>Gets the number of disabled tests that will be reported in the XML report.</p>
      <h5 id="disabled-test-count-unittestdisabled-test-count">disabled_test_count {#UnitTest::disabled_test_count}</h5>
      <p><code>int UnitTest::disabled_test_count() const</code></p>
      <p>Gets the number of disabled tests.</p>
      <h5 id="reportable-test-count-unittestreportable-test-count">reportable_test_count
        {#UnitTest::reportable_test_count}</h5>
      <p><code>int UnitTest::reportable_test_count() const</code></p>
      <p>Gets the number of tests to be printed in the XML report.</p>
      <h5 id="total-test-count-unittesttotal-test-count">total_test_count {#UnitTest::total_test_count}</h5>
      <p><code>int UnitTest::total_test_count() const</code></p>
      <p>Gets the number of all tests.</p>
      <h5 id="test-to-run-count-unittesttest-to-run-count">test_to_run_count {#UnitTest::test_to_run_count}</h5>
      <p><code>int UnitTest::test_to_run_count() const</code></p>
      <p>Gets the number of tests that should run.</p>
      <h5 id="start-timestamp-unitteststart-timestamp">start_timestamp {#UnitTest::start_timestamp}</h5>
      <p><code>TimeInMillis UnitTest::start_timestamp() const</code></p>
      <p>Gets the time of the test program start, in ms from the start of the UNIX epoch.</p>
      <h5 id="elapsed-time-unittestelapsed-time">elapsed_time {#UnitTest::elapsed_time}</h5>
      <p><code>TimeInMillis UnitTest::elapsed_time() const</code></p>
      <p>Gets the elapsed time, in milliseconds.</p>
      <h5 id="passed-unittestpassed">Passed {#UnitTest::Passed}</h5>
      <p><code>bool UnitTest::Passed() const</code></p>
      <p>Returns true if and only if the unit test passed (i.e. all test suites passed).</p>
      <h5 id="failed-unittestfailed">Failed {#UnitTest::Failed}</h5>
      <p><code>bool UnitTest::Failed() const</code></p>
      <p>Returns true if and only if the unit test failed (i.e. some test suite failed or
        something outside of all tests failed).</p>
      <h5 id="gettestsuite-unittestgettestsuite">GetTestSuite {#UnitTest::GetTestSuite}</h5>
      <p><code>const TestSuite* UnitTest::GetTestSuite(int i) const</code></p>
      <p>Gets the <a href="#TestSuite"><code>TestSuite</code></a> object for the <code>i</code>-th test suite among all
        the test suites. <code>i</code> can range from 0 to <code>total_test_suite_count() - 1</code>. If <code>i</code>
        is not in that range, returns <code>NULL</code>.</p>
      <h5 id="ad-hoc-test-result-unittestad-hoc-test-result">ad_hoc_test_result {#UnitTest::ad_hoc_test_result}</h5>
      <p><code>const TestResult&amp; UnitTest::ad_hoc_test_result() const</code></p>
      <p>Returns the <a href="#TestResult"><code>TestResult</code></a> containing information on test failures
        and properties logged outside of individual test suites.</p>
      <h5 id="listeners-unittestlisteners">listeners {#UnitTest::listeners}</h5>
      <p><code>TestEventListeners&amp; UnitTest::listeners()</code></p>
      <p>Returns the list of event listeners that can be used to track events inside
        GoogleTest. See <a href="#TestEventListeners"><code>TestEventListeners</code></a>.</p>
      <h3 id="testeventlistener-testeventlistener">TestEventListener {#TestEventListener}</h3>
      <p><code>testing::TestEventListener</code></p>
      <p>The interface for tracing execution of tests. The methods below are listed in
        the order the corresponding events are fired.</p>
      <h4 id="public-methods-testeventlistener-public">Public Methods {#TestEventListener-public}</h4>
      <h5 id="ontestprogramstart-testeventlistenerontestprogramstart">OnTestProgramStart
        {#TestEventListener::OnTestProgramStart}</h5>
      <p><code>virtual void TestEventListener::OnTestProgramStart(const UnitTest&amp; unit_test)</code></p>
      <p>Fired before any test activity starts.</p>
      <h5 id="ontestiterationstart-testeventlistenerontestiterationstart">OnTestIterationStart
        {#TestEventListener::OnTestIterationStart}</h5>
      <p><code>virtual void TestEventListener::OnTestIterationStart(const UnitTest&amp; unit_test, int iteration)</code>
      </p>
      <p>Fired before each iteration of tests starts. There may be more than one
        iteration if <code>GTEST_FLAG(repeat)</code> is set. <code>iteration</code> is the iteration index,
        starting from 0.</p>
      <h5 id="onenvironmentssetupstart-testeventlisteneronenvironmentssetupstart">OnEnvironmentsSetUpStart
        {#TestEventListener::OnEnvironmentsSetUpStart}</h5>
      <p><code>virtual void TestEventListener::OnEnvironmentsSetUpStart(const UnitTest&amp; unit_test)</code></p>
      <p>Fired before environment set-up for each iteration of tests starts.</p>
      <h5 id="onenvironmentssetupend-testeventlisteneronenvironmentssetupend">OnEnvironmentsSetUpEnd
        {#TestEventListener::OnEnvironmentsSetUpEnd}</h5>
      <p><code>virtual void TestEventListener::OnEnvironmentsSetUpEnd(const UnitTest&amp; unit_test)</code></p>
      <p>Fired after environment set-up for each iteration of tests ends.</p>
      <h5 id="ontestsuitestart-testeventlistenerontestsuitestart">OnTestSuiteStart
        {#TestEventListener::OnTestSuiteStart}</h5>
      <p><code>virtual void TestEventListener::OnTestSuiteStart(const TestSuite&amp; test_suite)</code></p>
      <p>Fired before the test suite starts.</p>
      <h5 id="onteststart-testeventlisteneronteststart">OnTestStart {#TestEventListener::OnTestStart}</h5>
      <p><code>virtual void TestEventListener::OnTestStart(const TestInfo&amp; test_info)</code></p>
      <p>Fired before the test starts.</p>
      <h5 id="ontestpartresult-testeventlistenerontestpartresult">OnTestPartResult
        {#TestEventListener::OnTestPartResult}</h5>
      <p><code>virtual void TestEventListener::OnTestPartResult(const TestPartResult&amp; test_part_result)</code></p>
      <p>Fired after a failed assertion or a <code>SUCCEED()</code> invocation. If you want to throw
        an exception from this function to skip to the next test, it must be an
        <a href="#AssertionException"><code>AssertionException</code></a> or inherited from it.
      </p>
      <h5 id="ontestend-testeventlistenerontestend">OnTestEnd {#TestEventListener::OnTestEnd}</h5>
      <p><code>virtual void TestEventListener::OnTestEnd(const TestInfo&amp; test_info)</code></p>
      <p>Fired after the test ends.</p>
      <h5 id="ontestsuiteend-testeventlistenerontestsuiteend">OnTestSuiteEnd {#TestEventListener::OnTestSuiteEnd}</h5>
      <p><code>virtual void TestEventListener::OnTestSuiteEnd(const TestSuite&amp; test_suite)</code></p>
      <p>Fired after the test suite ends.</p>
      <h5 id="onenvironmentsteardownstart-testeventlisteneronenvironmentsteardownstart">OnEnvironmentsTearDownStart
        {#TestEventListener::OnEnvironmentsTearDownStart}</h5>
      <p><code>virtual void TestEventListener::OnEnvironmentsTearDownStart(const UnitTest&amp; unit_test)</code></p>
      <p>Fired before environment tear-down for each iteration of tests starts.</p>
      <h5 id="onenvironmentsteardownend-testeventlisteneronenvironmentsteardownend">OnEnvironmentsTearDownEnd
        {#TestEventListener::OnEnvironmentsTearDownEnd}</h5>
      <p><code>virtual void TestEventListener::OnEnvironmentsTearDownEnd(const UnitTest&amp; unit_test)</code></p>
      <p>Fired after environment tear-down for each iteration of tests ends.</p>
      <h5 id="ontestiterationend-testeventlistenerontestiterationend">OnTestIterationEnd
        {#TestEventListener::OnTestIterationEnd}</h5>
      <p><code>virtual void TestEventListener::OnTestIterationEnd(const UnitTest&amp; unit_test, int iteration)</code>
      </p>
      <p>Fired after each iteration of tests finishes.</p>
      <h5 id="ontestprogramend-testeventlistenerontestprogramend">OnTestProgramEnd
        {#TestEventListener::OnTestProgramEnd}</h5>
      <p><code>virtual void TestEventListener::OnTestProgramEnd(const UnitTest&amp; unit_test)</code></p>
      <p>Fired after all test activities have ended.</p>
      <h3 id="testeventlisteners-testeventlisteners">TestEventListeners {#TestEventListeners}</h3>
      <p><code>testing::TestEventListeners</code></p>
      <p>Lets users add listeners to track events in GoogleTest.</p>
      <h4 id="public-methods-testeventlisteners-public">Public Methods {#TestEventListeners-public}</h4>
      <h5 id="append-testeventlistenersappend">Append {#TestEventListeners::Append}</h5>
      <p><code>void TestEventListeners::Append(TestEventListener* listener)</code></p>
      <p>Appends an event listener to the end of the list. GoogleTest assumes ownership
        of the listener (i.e. it will delete the listener when the test program
        finishes).</p>
      <h5 id="release-testeventlistenersrelease">Release {#TestEventListeners::Release}</h5>
      <p><code>TestEventListener* TestEventListeners::Release(TestEventListener* listener)</code></p>
      <p>Removes the given event listener from the list and returns it. It then becomes
        the caller’s responsibility to delete the listener. Returns <code>NULL</code> if the
        listener is not found in the list.</p>
      <h5 id="default-result-printer-testeventlistenersdefault-result-printer">default_result_printer
        {#TestEventListeners::default_result_printer}</h5>
      <p><code>TestEventListener* TestEventListeners::default_result_printer() const</code></p>
      <p>Returns the standard listener responsible for the default console output. Can be
        removed from the listeners list to shut down default console output. Note that
        removing this object from the listener list with
        <a href="#TestEventListeners::Release"><code>Release()</code></a> transfers its ownership to the
        caller and makes this function return <code>NULL</code> the next time.
      </p>
      <h5 id="default-xml-generator-testeventlistenersdefault-xml-generator">default_xml_generator
        {#TestEventListeners::default_xml_generator}</h5>
      <p><code>TestEventListener* TestEventListeners::default_xml_generator() const</code></p>
      <p>Returns the standard listener responsible for the default XML output controlled
        by the <code>--gtest_output=xml</code> flag. Can be removed from the listeners list by
        users who want to shut down the default XML output controlled by this flag and
        substitute it with custom one. Note that removing this object from the listener
        list with <a href="#TestEventListeners::Release"><code>Release()</code></a> transfers its ownership to
        the caller and makes this function return <code>NULL</code> the next time.</p>
      <h3 id="testpartresult-testpartresult">TestPartResult {#TestPartResult}</h3>
      <p><code>testing::TestPartResult</code></p>
      <p>A copyable object representing the result of a test part (i.e. an assertion or
        an explicit <code>FAIL()</code>, <code>ADD_FAILURE()</code>, or <code>SUCCESS()</code>).</p>
      <h4 id="public-methods-testpartresult-public">Public Methods {#TestPartResult-public}</h4>
      <h5 id="type-testpartresulttype">type {#TestPartResult::type}</h5>
      <p><code>Type TestPartResult::type() const</code></p>
      <p>Gets the outcome of the test part.</p>
      <p>The return type <code>Type</code> is an enum defined as follows:</p>
      <pre class="chroma"><span class="k">enum</span> <span class="nc">Type</span> <span class="p">{</span>
  <span class="n">kSuccess</span><span class="p">,</span>          <span class="c1">// Succeeded.
</span><span class="c1"></span>  <span class="n">kNonFatalFailure</span><span class="p">,</span>  <span class="c1">// Failed but the test can continue.
</span><span class="c1"></span>  <span class="n">kFatalFailure</span><span class="p">,</span>     <span class="c1">// Failed and the test should be terminated.
</span><span class="c1"></span>  <span class="n">kSkip</span>              <span class="c1">// Skipped.
</span><span class="c1"></span><span class="p">};</span>
</pre>
      <h5 id="file-name-testpartresultfile-name">file_name {#TestPartResult::file_name}</h5>
      <p><code>const char* TestPartResult::file_name() const</code></p>
      <p>Gets the name of the source file where the test part took place, or <code>NULL</code> if
        it’s unknown.</p>
      <h5 id="line-number-testpartresultline-number">line_number {#TestPartResult::line_number}</h5>
      <p><code>int TestPartResult::line_number() const</code></p>
      <p>Gets the line in the source file where the test part took place, or <code>-1</code> if it’s
        unknown.</p>
      <h5 id="summary-testpartresultsummary">summary {#TestPartResult::summary}</h5>
      <p><code>const char* TestPartResult::summary() const</code></p>
      <p>Gets the summary of the failure message.</p>
      <h5 id="message-testpartresultmessage">message {#TestPartResult::message}</h5>
      <p><code>const char* TestPartResult::message() const</code></p>
      <p>Gets the message associated with the test part.</p>
      <h5 id="skipped-testpartresultskipped">skipped {#TestPartResult::skipped}</h5>
      <p><code>bool TestPartResult::skipped() const</code></p>
      <p>Returns true if and only if the test part was skipped.</p>
      <h5 id="passed-testpartresultpassed">passed {#TestPartResult::passed}</h5>
      <p><code>bool TestPartResult::passed() const</code></p>
      <p>Returns true if and only if the test part passed.</p>
      <h5 id="nonfatally-failed-testpartresultnonfatally-failed">nonfatally_failed {#TestPartResult::nonfatally_failed}
      </h5>
      <p><code>bool TestPartResult::nonfatally_failed() const</code></p>
      <p>Returns true if and only if the test part non-fatally failed.</p>
      <h5 id="fatally-failed-testpartresultfatally-failed">fatally_failed {#TestPartResult::fatally_failed}</h5>
      <p><code>bool TestPartResult::fatally_failed() const</code></p>
      <p>Returns true if and only if the test part fatally failed.</p>
      <h5 id="failed-testpartresultfailed">failed {#TestPartResult::failed}</h5>
      <p><code>bool TestPartResult::failed() const</code></p>
      <p>Returns true if and only if the test part failed.</p>
      <h3 id="testproperty-testproperty">TestProperty {#TestProperty}</h3>
      <p><code>testing::TestProperty</code></p>
      <p>A copyable object representing a user-specified test property which can be
        output as a key/value string pair.</p>
      <h4 id="public-methods-testproperty-public">Public Methods {#TestProperty-public}</h4>
      <h5 id="key-key">key {#key}</h5>
      <p><code>const char* key() const</code></p>
      <p>Gets the user-supplied key.</p>
      <h5 id="value-value">value {#value}</h5>
      <p><code>const char* value() const</code></p>
      <p>Gets the user-supplied value.</p>
      <h5 id="setvalue-setvalue">SetValue {#SetValue}</h5>
      <p><code>void SetValue(const std::string&amp; new_value)</code></p>
      <p>Sets a new value, overriding the previous one.</p>
      <h3 id="testresult-testresult">TestResult {#TestResult}</h3>
      <p><code>testing::TestResult</code></p>
      <p>Contains information about the result of a single test.</p>
      <p><code>TestResult</code> is not copyable.</p>
      <h4 id="public-methods-testresult-public">Public Methods {#TestResult-public}</h4>
      <h5 id="total-part-count-testresulttotal-part-count">total_part_count {#TestResult::total_part_count}</h5>
      <p><code>int TestResult::total_part_count() const</code></p>
      <p>Gets the number of all test parts. This is the sum of the number of successful
        test parts and the number of failed test parts.</p>
      <h5 id="test-property-count-testresulttest-property-count">test_property_count {#TestResult::test_property_count}
      </h5>
      <p><code>int TestResult::test_property_count() const</code></p>
      <p>Returns the number of test properties.</p>
      <h5 id="passed-testresultpassed">Passed {#TestResult::Passed}</h5>
      <p><code>bool TestResult::Passed() const</code></p>
      <p>Returns true if and only if the test passed (i.e. no test part failed).</p>
      <h5 id="skipped-testresultskipped">Skipped {#TestResult::Skipped}</h5>
      <p><code>bool TestResult::Skipped() const</code></p>
      <p>Returns true if and only if the test was skipped.</p>
      <h5 id="failed-testresultfailed">Failed {#TestResult::Failed}</h5>
      <p><code>bool TestResult::Failed() const</code></p>
      <p>Returns true if and only if the test failed.</p>
      <h5 id="hasfatalfailure-testresulthasfatalfailure">HasFatalFailure {#TestResult::HasFatalFailure}</h5>
      <p><code>bool TestResult::HasFatalFailure() const</code></p>
      <p>Returns true if and only if the test fatally failed.</p>
      <h5 id="hasnonfatalfailure-testresulthasnonfatalfailure">HasNonfatalFailure {#TestResult::HasNonfatalFailure}</h5>
      <p><code>bool TestResult::HasNonfatalFailure() const</code></p>
      <p>Returns true if and only if the test has a non-fatal failure.</p>
      <h5 id="elapsed-time-testresultelapsed-time">elapsed_time {#TestResult::elapsed_time}</h5>
      <p><code>TimeInMillis TestResult::elapsed_time() const</code></p>
      <p>Returns the elapsed time, in milliseconds.</p>
      <h5 id="start-timestamp-testresultstart-timestamp">start_timestamp {#TestResult::start_timestamp}</h5>
      <p><code>TimeInMillis TestResult::start_timestamp() const</code></p>
      <p>Gets the time of the test case start, in ms from the start of the UNIX epoch.</p>
      <h5 id="gettestpartresult-testresultgettestpartresult">GetTestPartResult {#TestResult::GetTestPartResult}</h5>
      <p><code>const TestPartResult&amp; TestResult::GetTestPartResult(int i) const</code></p>
      <p>Returns the <a href="#TestPartResult"><code>TestPartResult</code></a> for the <code>i</code>-th test part
        result
        among all the results. <code>i</code> can range from 0 to <code>total_part_count() - 1</code>. If <code>i</code>
        is not in that range, aborts the program.</p>
      <h5 id="gettestproperty-testresultgettestproperty">GetTestProperty {#TestResult::GetTestProperty}</h5>
      <p><code>const TestProperty&amp; TestResult::GetTestProperty(int i) const</code></p>
      <p>Returns the <a href="#TestProperty"><code>TestProperty</code></a> object for the <code>i</code>-th test
        property.
        <code>i</code> can range from 0 to <code>test_property_count() - 1</code>. If <code>i</code> is not in that
        range, aborts the program.
      </p>
      <h3 id="timeinmillis-timeinmillis">TimeInMillis {#TimeInMillis}</h3>
      <p><code>testing::TimeInMillis</code></p>
      <p>An integer type representing time in milliseconds.</p>
      <h3 id="types-types">Types {#Types}</h3>
      <p><code>testing::Types&lt;T...&gt;</code></p>
      <p>Represents a list of types for use in typed tests and type-parameterized tests.</p>
      <p>The template argument <code>T...</code> can be any number of types, for example:</p>
      <pre><code>testing::Types&lt;char, int, unsigned int&gt;
</code></pre>
      <p>See <a href="../#advanced-googletest-topics#typed-tests">Typed Tests</a> and
        <a href="../#advanced-googletest-topics#type-parameterized-tests">Type-Parameterized Tests</a> for more
        information.
      </p>
      <h3 id="withparaminterface-withparaminterface">WithParamInterface {#WithParamInterface}</h3>
      <p><code>testing::WithParamInterface&lt;T&gt;</code></p>
      <p>The pure interface class that all value-parameterized tests inherit from.</p>
      <p>A value-parameterized test fixture class must inherit from both <a href="#Test"><code>Test</code></a>
        and <code>WithParamInterface</code>. In most cases that just means inheriting from
        <a href="#TestWithParam"><code>TestWithParam</code></a>, but more complicated test hierarchies may
        need to inherit from <code>Test</code> and <code>WithParamInterface</code> at different levels.
      </p>
      <p>This interface defines the type alias <code>ParamType</code> for the parameter type <code>T</code> and
        has support for accessing the test parameter value via the <code>GetParam()</code> method:</p>
      <pre><code>static const ParamType&amp; GetParam()
</code></pre>
      <p>For more information, see
        <a href="../#advanced-googletest-topics#value-parameterized-tests">Value-Parameterized Tests</a>.
      </p>
      <h2 id="functions">Functions</h2>
      <p>GoogleTest defines the following functions to help with writing and running
        tests.</p>
      <h3 id="initgoogletest-initgoogletest">InitGoogleTest {#InitGoogleTest}</h3>
      <p><code>void testing::InitGoogleTest(int* argc, char** argv)</code><br>
        <code>void testing::InitGoogleTest(int* argc, wchar_t** argv)</code><br>
        <code>void testing::InitGoogleTest()</code>
      </p>
      <p>Initializes GoogleTest. This must be called before calling
        <a href="#RUN_ALL_TESTS"><code>RUN_ALL_TESTS()</code></a>. In particular, it parses the command line
        for the flags that GoogleTest recognizes. Whenever a GoogleTest flag is seen, it
        is removed from <code>argv</code>, and <code>*argc</code> is decremented. Keep in mind that <code>argv</code>
        must terminate with a <code>NULL</code> pointer (i.e. <code>argv[argc]</code> is <code>NULL</code>), which is
        already the case with the default <code>argv</code> passed to <code>main</code>.
      </p>
      <p>No value is returned. Instead, the GoogleTest flag variables are updated.</p>
      <p>The <code>InitGoogleTest(int* argc, wchar_t** argv)</code> overload can be used in Windows
        programs compiled in <code>UNICODE</code> mode.</p>
      <p>The argument-less <code>InitGoogleTest()</code> overload can be used on Arduino/embedded
        platforms where there is no <code>argc</code>/<code>argv</code>.</p>
      <h3 id="addglobaltestenvironment-addglobaltestenvironment">AddGlobalTestEnvironment {#AddGlobalTestEnvironment}
      </h3>
      <p><code>Environment* testing::AddGlobalTestEnvironment(Environment* env)</code></p>
      <p>Adds a test environment to the test program. Must be called before
        <a href="#RUN_ALL_TESTS"><code>RUN_ALL_TESTS()</code></a> is called. See
        <a href="../#advanced-googletest-topics#global-set-up-and-tear-down">Global Set-Up and Tear-Down</a> for
        more information.
      </p>
      <p>See also <a href="#Environment"><code>Environment</code></a>.</p>
      <h3 id="registertest-registertest">RegisterTest {#RegisterTest}</h3>
      <pre class="chroma"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Factory</span><span class="o">&gt;</span>
<span class="n">TestInfo</span><span class="o">*</span> <span class="n">testing</span><span class="o">::</span><span class="n">RegisterTest</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">test_suite_name</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">test_name</span><span class="p">,</span>
                                  <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">type_param</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">value_param</span><span class="p">,</span>
                                  <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="n">Factory</span> <span class="n">factory</span><span class="p">)</span>
</pre>
      <p>Dynamically registers a test with the framework.</p>
      <p>The <code>factory</code> argument is a factory callable (move-constructible) object or
        function pointer that creates a new instance of the <code>Test</code> object. It handles
        ownership to the caller. The signature of the callable is <code>Fixture*()</code>, where
        <code>Fixture</code> is the test fixture class for the test. All tests registered with the
        same <code>test_suite_name</code> must return the same fixture type. This is checked at
        runtime.
      </p>
      <p>The framework will infer the fixture class from the factory and will call the
        <code>SetUpTestSuite</code> and <code>TearDownTestSuite</code> methods for it.
      </p>
      <p>Must be called before <a href="#RUN_ALL_TESTS"><code>RUN_ALL_TESTS()</code></a> is invoked, otherwise
        behavior is undefined.</p>
      <p>See
        <a href="../#advanced-googletest-topics#registering-tests-programmatically">Registering tests
          programmatically</a>
        for more information.
      </p>
      <h3 id="run-all-tests-run-all-tests">RUN_ALL_TESTS {#RUN_ALL_TESTS}</h3>
      <p><code>int RUN_ALL_TESTS()</code></p>
      <p>Use this function in <code>main()</code> to run all tests. It returns <code>0</code> if all tests are
        successful, or <code>1</code> otherwise.</p>
      <p><code>RUN_ALL_TESTS()</code> should be invoked after the command line has been parsed by
        <a href="#InitGoogleTest"><code>InitGoogleTest()</code></a>.
      </p>
      <p>This function was formerly a macro; thus, it is in the global namespace and has
        an all-caps name.</p>
      <h3 id="assertionsuccess-assertionsuccess">AssertionSuccess {#AssertionSuccess}</h3>
      <p><code>AssertionResult testing::AssertionSuccess()</code></p>
      <p>Creates a successful assertion result. See
        <a href="#AssertionResult"><code>AssertionResult</code></a>.
      </p>
      <h3 id="assertionfailure-assertionfailure">AssertionFailure {#AssertionFailure}</h3>
      <p><code>AssertionResult testing::AssertionFailure()</code></p>
      <p>Creates a failed assertion result. Use the <code>&lt;&lt;</code> operator to store a failure
        message:</p>
      <pre class="chroma"><span class="n">testing</span><span class="o">::</span><span class="n">AssertionFailure</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"My failure message"</span><span class="p">;</span>
</pre>
      <p>See <a href="#AssertionResult"><code>AssertionResult</code></a>.</p>
      <h3 id="staticasserttypeeq-staticasserttypeeq">StaticAssertTypeEq {#StaticAssertTypeEq}</h3>
      <p><code>testing::StaticAssertTypeEq&lt;T1, T2&gt;()</code></p>
      <p>Compile-time assertion for type equality. Compiles if and only if <code>T1</code> and <code>T2</code>
        are the same type. The value it returns is irrelevant.</p>
      <p>See <a href="../#advanced-googletest-topics#type-assertions">Type Assertions</a> for more information.</p>
      <h3 id="printtostring-printtostring">PrintToString {#PrintToString}</h3>
      <p><code>std::string testing::PrintToString(x)</code></p>
      <p>Prints any value <code>x</code> using GoogleTest’s value printer.</p>
      <p>See
        <a href="../#advanced-googletest-topics#teaching-googletest-how-to-print-your-values">Teaching GoogleTest How to
          Print Your Values</a>
        for more information.
      </p>
      <h3 id="printtostringparamname-printtostringparamname">PrintToStringParamName {#PrintToStringParamName}</h3>
      <p><code>std::string testing::PrintToStringParamName(TestParamInfo&lt;T&gt;&amp; info)</code></p>
      <p>A built-in parameterized test name generator which returns the result of
        <a href="#PrintToString"><code>PrintToString</code></a> called on <code>info.param</code>. Does not work when
        the
        test parameter is a <code>std::string</code> or C string. See
        <a href="../#advanced-googletest-topics#specifying-names-for-value-parameterized-test-parameters">Specifying
          Names for Value-Parameterized Test Parameters</a>
        for more information.
      </p>
      <p>See also <a href="#TestParamInfo"><code>TestParamInfo</code></a> and
        <a href="#INSTANTIATE_TEST_SUITE_P"><code>INSTANTIATE_TEST_SUITE_P</code></a>.
      </p>
      <h1 id="mocking-reference">Mocking Reference</h1>
      <p>This page lists the facilities provided by GoogleTest for creating and working
        with mock objects. To use them, add <code>#include &lt;gmock/gmock.h&gt;</code>.</p>
      <h2 id="macros-macros">Macros {#macros}</h2>
      <p>GoogleTest defines the following macros for working with mocks.</p>
      <h3 id="mock-method-mock-method">MOCK_METHOD {#MOCK_METHOD}</h3>
      <p>
        <code>MOCK_METHOD(</code><em><code>return_type</code></em><code>,</code><em><code>method_name</code></em><code>, (</code><em><code>args...</code></em><code>));</code><br>
        <code>MOCK_METHOD(</code><em><code>return_type</code></em><code>,</code><em><code>method_name</code></em><code>, (</code><em><code>args...</code></em><code>), (</code><em><code>specs...</code></em><code>));</code>
      </p>
      <p>Defines a mock method <em><code>method_name</code></em> with arguments
        <code>(</code><em><code>args...</code></em><code>)</code> and
        return type <em><code>return_type</code></em> within a mock class.
      </p>
      <p>The parameters of <code>MOCK_METHOD</code> mirror the method declaration. The optional
        fourth parameter <em><code>specs...</code></em> is a comma-separated list of qualifiers. The
        following qualifiers are accepted:</p>
      <table>
        <thead>
          <tr>
            <th>Qualifier</th>
            <th>Meaning</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>const</code></td>
            <td>Makes the mocked method a <code>const</code> method. Required if overriding a <code>const</code> method.
            </td>
          </tr>
          <tr>
            <td><code>override</code></td>
            <td>Marks the method with <code>override</code>. Recommended if overriding a <code>virtual</code> method.
            </td>
          </tr>
          <tr>
            <td><code>noexcept</code></td>
            <td>Marks the method with <code>noexcept</code>. Required if overriding a <code>noexcept</code> method.</td>
          </tr>
          <tr>
            <td><code>Calltype(</code><em><code>calltype</code></em><code>)</code></td>
            <td>Sets the call type for the method, for example <code>Calltype(STDMETHODCALLTYPE)</code>. Useful on
              Windows.</td>
          </tr>
          <tr>
            <td><code>ref(</code><em><code>qualifier</code></em><code>)</code></td>
            <td>Marks the method with the given reference qualifier, for example <code>ref(&amp;)</code> or
              <code>ref(&amp;&amp;)</code>. Required if overriding a method that has a reference qualifier.
            </td>
          </tr>
        </tbody>
      </table>
      <p>Note that commas in arguments prevent <code>MOCK_METHOD</code> from parsing the arguments
        correctly if they are not appropriately surrounded by parentheses. See the
        following example:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">MyMock</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="c1">// The following 2 lines will not compile due to commas in the arguments:
</span><span class="c1"></span>  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">GetPair</span><span class="p">,</span> <span class="p">());</span>              <span class="c1">// Error!
</span><span class="c1"></span>  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">CheckMap</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">bool</span><span class="p">));</span>  <span class="c1">// Error!
</span><span class="c1"></span>
  <span class="c1">// One solution - wrap arguments that contain commas in parentheses:
</span><span class="c1"></span>  <span class="n">MOCK_METHOD</span><span class="p">((</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">),</span> <span class="n">GetPair</span><span class="p">,</span> <span class="p">());</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">CheckMap</span><span class="p">,</span> <span class="p">((</span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span><span class="p">),</span> <span class="kt">bool</span><span class="p">));</span>

  <span class="c1">// Another solution - use type aliases:
</span><span class="c1"></span>  <span class="k">using</span> <span class="n">BoolAndInt</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="n">BoolAndInt</span><span class="p">,</span> <span class="n">GetPair</span><span class="p">,</span> <span class="p">());</span>
  <span class="k">using</span> <span class="n">MapIntDouble</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">CheckMap</span><span class="p">,</span> <span class="p">(</span><span class="n">MapIntDouble</span><span class="p">,</span> <span class="kt">bool</span><span class="p">));</span>
<span class="p">};</span>
</pre>
      <p><code>MOCK_METHOD</code> must be used in the <code>public:</code> section of a mock class definition,
        regardless of whether the method being mocked is <code>public</code>, <code>protected</code>, or
        <code>private</code> in the base class.
      </p>
      <h3 id="expect-call-expect-call">EXPECT_CALL {#EXPECT_CALL}</h3>
      <p>
        <code>EXPECT_CALL(</code><em><code>mock_object</code></em><code>,</code><em><code>method_name</code></em><code>(</code><em><code>matchers...</code></em><code>))</code>
      </p>
      <p>Creates an <a href="../#gmock-for-dummies#setting-expectations">expectation</a> that the
        method <em><code>method_name</code></em> of the object <em><code>mock_object</code></em> is called with
        arguments
        that match the given matchers <em><code>matchers...</code></em>. <code>EXPECT_CALL</code> must precede any
        code that exercises the mock object.</p>
      <p>The parameter <em><code>matchers...</code></em> is a comma-separated list of
        <a href="../#gmock-for-dummies#matchers-what-arguments-do-we-expect">matchers</a> that
        correspond to each argument of the method <em><code>method_name</code></em>. The expectation will
        apply only to calls of <em><code>method_name</code></em> whose arguments match all of the
        matchers. If <code>(</code><em><code>matchers...</code></em><code>)</code> is omitted, the expectation behaves
        as if
        each argument’s matcher were a <a href="matchers.md#wildcard">wildcard matcher (<code>_</code>)</a>.
        See the <a href="matchers.md">Matchers Reference</a> for a list of all built-in matchers.
      </p>
      <p>The following chainable clauses can be used to modify the expectation, and they
        must be used in the following order:</p>
      <pre class="chroma"><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_object</span><span class="p">,</span> <span class="n">method_name</span><span class="p">(</span><span class="n">matchers</span><span class="p">...))</span>
    <span class="p">.</span><span class="n">With</span><span class="p">(</span><span class="n">multi_argument_matcher</span><span class="p">)</span>  <span class="c1">// Can be used at most once
</span><span class="c1"></span>    <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">cardinality</span><span class="p">)</span>            <span class="c1">// Can be used at most once
</span><span class="c1"></span>    <span class="p">.</span><span class="n">InSequence</span><span class="p">(</span><span class="n">sequences</span><span class="p">...)</span>      <span class="c1">// Can be used any number of times
</span><span class="c1"></span>    <span class="p">.</span><span class="n">After</span><span class="p">(</span><span class="n">expectations</span><span class="p">...)</span>        <span class="c1">// Can be used any number of times
</span><span class="c1"></span>    <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>              <span class="c1">// Can be used any number of times
</span><span class="c1"></span>    <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>        <span class="c1">// Can be used at most once
</span><span class="c1"></span>    <span class="p">.</span><span class="n">RetiresOnSaturation</span><span class="p">();</span>        <span class="c1">// Can be used at most once
</span></pre>
      <p>See details for each modifier clause below.</p>
      <h4 id="with-expect-callwith">With {#EXPECT_CALL.With}</h4>
      <p><code>.With(</code><em><code>multi_argument_matcher</code></em><code>)</code></p>
      <p>Restricts the expectation to apply only to mock function calls whose arguments
        as a whole match the multi-argument matcher <em><code>multi_argument_matcher</code></em>.</p>
      <p>GoogleTest passes all of the arguments as one tuple into the matcher. The
        parameter <em><code>multi_argument_matcher</code></em> must thus be a matcher of type
        <code>Matcher&lt;std::tuple&lt;A1, ..., An&gt;&gt;</code>, where <code>A1, ..., An</code> are the types of the
        function arguments.
      </p>
      <p>For example, the following code sets the expectation that
        <code>my_mock.SetPosition()</code> is called with any two arguments, the first argument
        being less than the second:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Lt</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">SetPosition</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span>
    <span class="p">.</span><span class="n">With</span><span class="p">(</span><span class="n">Lt</span><span class="p">());</span>
</pre>
      <p>GoogleTest provides some built-in matchers for 2-tuples, including the <code>Lt()</code>
        matcher above. See <a href="matchers.md#MultiArgMatchers">Multi-argument Matchers</a>.</p>
      <p>The <code>With</code> clause can be used at most once on an expectation and must be the
        first clause.</p>
      <h4 id="times-expect-calltimes">Times {#EXPECT_CALL.Times}</h4>
      <p><code>.Times(</code><em><code>cardinality</code></em><code>)</code></p>
      <p>Specifies how many times the mock function call is expected.</p>
      <p>The parameter <em><code>cardinality</code></em> represents the number of expected calls and can be
        one of the following, all defined in the <code>::testing</code> namespace:</p>
      <table>
        <thead>
          <tr>
            <th>Cardinality</th>
            <th>Meaning</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>AnyNumber()</code></td>
            <td>The function can be called any number of times.</td>
          </tr>
          <tr>
            <td><code>AtLeast(n)</code></td>
            <td>The function call is expected at least <em>n</em> times.</td>
          </tr>
          <tr>
            <td><code>AtMost(n)</code></td>
            <td>The function call is expected at most <em>n</em> times.</td>
          </tr>
          <tr>
            <td><code>Between(m, n)</code></td>
            <td>The function call is expected between <em>m</em> and <em>n</em> times, inclusive.</td>
          </tr>
          <tr>
            <td><code>Exactly(n)</code> or <code>n</code></td>
            <td>The function call is expected exactly <em>n</em> times. If <em>n</em> is 0, the call should never
              happen.</td>
          </tr>
        </tbody>
      </table>
      <p>If the <code>Times</code> clause is omitted, GoogleTest infers the cardinality as follows:</p>
      <ul>
        <li>If neither <a href="#EXPECT_CALL.WillOnce"><code>WillOnce</code></a> nor
          <a href="#EXPECT_CALL.WillRepeatedly"><code>WillRepeatedly</code></a> are specified, the inferred
          cardinality is <code>Times(1)</code>.
        </li>
        <li>If there are <em>n</em> <code>WillOnce</code> clauses and no <code>WillRepeatedly</code> clause, where
          <em>n</em> &gt;= 1, the inferred cardinality is <code>Times(n)</code>.
        </li>
        <li>If there are <em>n</em> <code>WillOnce</code> clauses and one <code>WillRepeatedly</code> clause, where
          <em>n</em> &gt;= 0, the inferred cardinality is <code>Times(AtLeast(n))</code>.
        </li>
      </ul>
      <p>The <code>Times</code> clause can be used at most once on an expectation.</p>
      <h4 id="insequence-expect-callinsequence">InSequence {#EXPECT_CALL.InSequence}</h4>
      <p><code>.InSequence(</code><em><code>sequences...</code></em><code>)</code></p>
      <p>Specifies that the mock function call is expected in a certain sequence.</p>
      <p>The parameter <em><code>sequences...</code></em> is any number of <a href="#Sequence"><code>Sequence</code></a>
        objects.
        Expected calls assigned to the same sequence are expected to occur in the order
        the expectations are declared.</p>
      <p>For example, the following code sets the expectation that the <code>Reset()</code> method
        of <code>my_mock</code> is called before both <code>GetSize()</code> and <code>Describe()</code>, and
        <code>GetSize()</code>
        and <code>Describe()</code> can occur in any order relative to each other:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Sequence</span><span class="p">;</span>
<span class="n">Sequence</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">Reset</span><span class="p">())</span>
    <span class="p">.</span><span class="n">InSequence</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">);</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">GetSize</span><span class="p">())</span>
    <span class="p">.</span><span class="n">InSequence</span><span class="p">(</span><span class="n">s1</span><span class="p">);</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">Describe</span><span class="p">())</span>
    <span class="p">.</span><span class="n">InSequence</span><span class="p">(</span><span class="n">s2</span><span class="p">);</span>
</pre>
      <p>The <code>InSequence</code> clause can be used any number of times on an expectation.</p>
      <p>See also the <a href="#InSequence"><code>InSequence</code> class</a>.</p>
      <h4 id="after-expect-callafter">After {#EXPECT_CALL.After}</h4>
      <p><code>.After(</code><em><code>expectations...</code></em><code>)</code></p>
      <p>Specifies that the mock function call is expected to occur after one or more
        other calls.</p>
      <p>The parameter <em><code>expectations...</code></em> can be up to five
        <a href="#Expectation"><code>Expectation</code></a> or <a href="#ExpectationSet"><code>ExpectationSet</code></a>
        objects.
        The mock function call is expected to occur after all of the given expectations.
      </p>
      <p>For example, the following code sets the expectation that the <code>Describe()</code>
        method of <code>my_mock</code> is called only after both <code>InitX()</code> and <code>InitY()</code> have been
        called.</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Expectation</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">Expectation</span> <span class="n">init_x</span> <span class="o">=</span> <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">InitX</span><span class="p">());</span>
<span class="n">Expectation</span> <span class="n">init_y</span> <span class="o">=</span> <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">InitY</span><span class="p">());</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">Describe</span><span class="p">())</span>
    <span class="p">.</span><span class="n">After</span><span class="p">(</span><span class="n">init_x</span><span class="p">,</span> <span class="n">init_y</span><span class="p">);</span>
</pre>
      <p>The <code>ExpectationSet</code> object is helpful when the number of prerequisites for an
        expectation is large or variable, for example:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">ExpectationSet</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">ExpectationSet</span> <span class="n">all_inits</span><span class="p">;</span>
<span class="c1">// Collect all expectations of InitElement() calls
</span><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">element_count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">all_inits</span> <span class="o">+=</span> <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">InitElement</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
<span class="p">}</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">Describe</span><span class="p">())</span>
    <span class="p">.</span><span class="n">After</span><span class="p">(</span><span class="n">all_inits</span><span class="p">);</span>  <span class="c1">// Expect Describe() call after all InitElement() calls
</span></pre>
      <p>The <code>After</code> clause can be used any number of times on an expectation.</p>
      <h4 id="willonce-expect-callwillonce">WillOnce {#EXPECT_CALL.WillOnce}</h4>
      <p><code>.WillOnce(</code><em><code>action</code></em><code>)</code></p>
      <p>Specifies the mock function’s actual behavior when invoked, for a single
        matching function call.</p>
      <p>The parameter <em><code>action</code></em> represents the
        <a href="../#gmock-for-dummies#actions-what-should-it-do">action</a> that the function
        call will perform. See the <a href="actions.md">Actions Reference</a> for a list of
        built-in actions.
      </p>
      <p>The use of <code>WillOnce</code> implicitly sets a cardinality on the expectation when
        <code>Times</code> is not specified. See <a href="#EXPECT_CALL.Times"><code>Times</code></a>.
      </p>
      <p>Each matching function call will perform the next action in the order declared.
        For example, the following code specifies that <code>my_mock.GetNumber()</code> is expected
        to be called exactly 3 times and will return <code>1</code>, <code>2</code>, and <code>3</code> respectively on
        the first, second, and third calls:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">GetNumber</span><span class="p">())</span>
    <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</pre>
      <p>The <code>WillOnce</code> clause can be used any number of times on an expectation. Unlike
        <code>WillRepeatedly</code>, the action fed to each <code>WillOnce</code> call will be called at most
        once, so may be a move-only type and/or have an <code>&amp;&amp;</code>-qualified call operator.
      </p>
      <h4 id="willrepeatedly-expect-callwillrepeatedly">WillRepeatedly {#EXPECT_CALL.WillRepeatedly}</h4>
      <p><code>.WillRepeatedly(</code><em><code>action</code></em><code>)</code></p>
      <p>Specifies the mock function’s actual behavior when invoked, for all subsequent
        matching function calls. Takes effect after the actions specified in the
        <a href="#EXPECT_CALL.WillOnce"><code>WillOnce</code></a> clauses, if any, have been performed.
      </p>
      <p>The parameter <em><code>action</code></em> represents the
        <a href="../#gmock-for-dummies#actions-what-should-it-do">action</a> that the function
        call will perform. See the <a href="actions.md">Actions Reference</a> for a list of
        built-in actions.
      </p>
      <p>The use of <code>WillRepeatedly</code> implicitly sets a cardinality on the expectation
        when <code>Times</code> is not specified. See <a href="#EXPECT_CALL.Times"><code>Times</code></a>.</p>
      <p>If any <code>WillOnce</code> clauses have been specified, matching function calls will
        perform those actions before the action specified by <code>WillRepeatedly</code>. See the
        following example:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">GetName</span><span class="p">())</span>
    <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="s">"John Doe"</span><span class="p">));</span>  <span class="c1">// Return "John Doe" on all calls
</span><span class="c1"></span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">GetNumber</span><span class="p">())</span>
    <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">42</span><span class="p">))</span>        <span class="c1">// Return 42 on the first call
</span><span class="c1"></span>    <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">7</span><span class="p">));</span>  <span class="c1">// Return 7 on all subsequent calls
</span></pre>
      <p>The <code>WillRepeatedly</code> clause can be used at most once on an expectation.</p>
      <h4 id="retiresonsaturation-expect-callretiresonsaturation">RetiresOnSaturation {#EXPECT_CALL.RetiresOnSaturation}
      </h4>
      <p><code>.RetiresOnSaturation()</code></p>
      <p>Indicates that the expectation will no longer be active after the expected
        number of matching function calls has been reached.</p>
      <p>The <code>RetiresOnSaturation</code> clause is only meaningful for expectations with an
        upper-bounded cardinality. The expectation will <em>retire</em> (no longer match any
        function calls) after it has been <em>saturated</em> (the upper bound has been
        reached). See the following example:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">AnyNumber</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">SetNumber</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>  <span class="c1">// Expectation 1
</span><span class="c1"></span>    <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">AnyNumber</span><span class="p">());</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">SetNumber</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>  <span class="c1">// Expectation 2
</span><span class="c1"></span>    <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">.</span><span class="n">RetiresOnSaturation</span><span class="p">();</span>
</pre>
      <p>In the above example, the first two calls to <code>my_mock.SetNumber(7)</code> match
        expectation 2, which then becomes inactive and no longer matches any calls. A
        third call to <code>my_mock.SetNumber(7)</code> would then match expectation 1. Without
        <code>RetiresOnSaturation()</code> on expectation 2, a third call to <code>my_mock.SetNumber(7)</code>
        would match expectation 2 again, producing a failure since the limit of 2 calls
        was exceeded.
      </p>
      <p>The <code>RetiresOnSaturation</code> clause can be used at most once on an expectation and
        must be the last clause.</p>
      <h3 id="on-call-on-call">ON_CALL {#ON_CALL}</h3>
      <p>
        <code>ON_CALL(</code><em><code>mock_object</code></em><code>,</code><em><code>method_name</code></em><code>(</code><em><code>matchers...</code></em><code>))</code>
      </p>
      <p>Defines what happens when the method <em><code>method_name</code></em> of the object
        <em><code>mock_object</code></em> is called with arguments that match the given matchers
        <em><code>matchers...</code></em>. Requires a modifier clause to specify the method’s behavior.
        <em>Does not</em> set any expectations that the method will be called.
      </p>
      <p>The parameter <em><code>matchers...</code></em> is a comma-separated list of
        <a href="../#gmock-for-dummies#matchers-what-arguments-do-we-expect">matchers</a> that
        correspond to each argument of the method <em><code>method_name</code></em>. The <code>ON_CALL</code>
        specification will apply only to calls of <em><code>method_name</code></em> whose arguments match
        all of the matchers. If <code>(</code><em><code>matchers...</code></em><code>)</code> is omitted, the behavior
        is as if
        each argument’s matcher were a <a href="matchers.md#wildcard">wildcard matcher (<code>_</code>)</a>.
        See the <a href="matchers.md">Matchers Reference</a> for a list of all built-in matchers.
      </p>
      <p>The following chainable clauses can be used to set the method’s behavior, and
        they must be used in the following order:</p>
      <pre class="chroma"><span class="n">ON_CALL</span><span class="p">(</span><span class="n">mock_object</span><span class="p">,</span> <span class="n">method_name</span><span class="p">(</span><span class="n">matchers</span><span class="p">...))</span>
    <span class="p">.</span><span class="n">With</span><span class="p">(</span><span class="n">multi_argument_matcher</span><span class="p">)</span>  <span class="c1">// Can be used at most once
</span><span class="c1"></span>    <span class="p">.</span><span class="n">WillByDefault</span><span class="p">(</span><span class="n">action</span><span class="p">);</span>        <span class="c1">// Required
</span></pre>
      <p>See details for each modifier clause below.</p>
      <h4 id="with-on-callwith">With {#ON_CALL.With}</h4>
      <p><code>.With(</code><em><code>multi_argument_matcher</code></em><code>)</code></p>
      <p>Restricts the specification to only mock function calls whose arguments as a
        whole match the multi-argument matcher <em><code>multi_argument_matcher</code></em>.</p>
      <p>GoogleTest passes all of the arguments as one tuple into the matcher. The
        parameter <em><code>multi_argument_matcher</code></em> must thus be a matcher of type
        <code>Matcher&lt;std::tuple&lt;A1, ..., An&gt;&gt;</code>, where <code>A1, ..., An</code> are the types of the
        function arguments.
      </p>
      <p>For example, the following code sets the default behavior when
        <code>my_mock.SetPosition()</code> is called with any two arguments, the first argument
        being less than the second:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Lt</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">ON_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">SetPosition</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span>
    <span class="p">.</span><span class="n">With</span><span class="p">(</span><span class="n">Lt</span><span class="p">())</span>
    <span class="p">.</span><span class="n">WillByDefault</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="nb">true</span><span class="p">));</span>
</pre>
      <p>GoogleTest provides some built-in matchers for 2-tuples, including the <code>Lt()</code>
        matcher above. See <a href="matchers.md#MultiArgMatchers">Multi-argument Matchers</a>.</p>
      <p>The <code>With</code> clause can be used at most once with each <code>ON_CALL</code> statement.</p>
      <h4 id="willbydefault-on-callwillbydefault">WillByDefault {#ON_CALL.WillByDefault}</h4>
      <p><code>.WillByDefault(</code><em><code>action</code></em><code>)</code></p>
      <p>Specifies the default behavior of a matching mock function call.</p>
      <p>The parameter <em><code>action</code></em> represents the
        <a href="../#gmock-for-dummies#actions-what-should-it-do">action</a> that the function
        call will perform. See the <a href="actions.md">Actions Reference</a> for a list of
        built-in actions.
      </p>
      <p>For example, the following code specifies that by default, a call to
        <code>my_mock.Greet()</code> will return <code>"hello"</code>:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">ON_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">Greet</span><span class="p">())</span>
    <span class="p">.</span><span class="n">WillByDefault</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="s">"hello"</span><span class="p">));</span>
</pre>
      <p>The action specified by <code>WillByDefault</code> is superseded by the actions specified
        on a matching <code>EXPECT_CALL</code> statement, if any. See the
        <a href="#EXPECT_CALL.WillOnce"><code>WillOnce</code></a> and
        <a href="#EXPECT_CALL.WillRepeatedly"><code>WillRepeatedly</code></a> clauses of <code>EXPECT_CALL</code>.
      </p>
      <p>The <code>WillByDefault</code> clause must be used exactly once with each <code>ON_CALL</code>
        statement.</p>
      <h2 id="classes-classes">Classes {#classes}</h2>
      <p>GoogleTest defines the following classes for working with mocks.</p>
      <h3 id="defaultvalue-defaultvalue">DefaultValue {#DefaultValue}</h3>
      <p><code>::testing::DefaultValue&lt;T&gt;</code></p>
      <p>Allows a user to specify the default value for a type <code>T</code> that is both copyable
        and publicly destructible (i.e. anything that can be used as a function return
        type). For mock functions with a return type of <code>T</code>, this default value is
        returned from function calls that do not specify an action.</p>
      <p>Provides the static methods <code>Set()</code>, <code>SetFactory()</code>, and <code>Clear()</code> to manage
        the
        default value:</p>
      <pre class="chroma"><span class="c1">// Sets the default value to be returned. T must be copy constructible.
</span><span class="c1"></span><span class="n">DefaultValue</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">Set</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>

<span class="c1">// Sets a factory. Will be invoked on demand. T must be move constructible.
</span><span class="c1"></span><span class="n">T</span> <span class="nf">MakeT</span><span class="p">();</span>
<span class="n">DefaultValue</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">SetFactory</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MakeT</span><span class="p">);</span>

<span class="c1">// Unsets the default value.
</span><span class="c1"></span><span class="n">DefaultValue</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">Clear</span><span class="p">();</span>
</pre>
      <h3 id="nicemock-nicemock">NiceMock {#NiceMock}</h3>
      <p><code>::testing::NiceMock&lt;T&gt;</code></p>
      <p>Represents a mock object that suppresses warnings on
        <a href="../#gmock-cookbook#uninteresting-vs-unexpected">uninteresting calls</a>. The
        template parameter <code>T</code> is any mock class, except for another <code>NiceMock</code>,
        <code>NaggyMock</code>, or <code>StrictMock</code>.
      </p>
      <p>Usage of <code>NiceMock&lt;T&gt;</code> is analogous to usage of <code>T</code>. <code>NiceMock&lt;T&gt;</code>
        is a subclass
        of <code>T</code>, so it can be used wherever an object of type <code>T</code> is accepted. In
        addition, <code>NiceMock&lt;T&gt;</code> can be constructed with any arguments that a constructor
        of <code>T</code> accepts.</p>
      <p>For example, the following code suppresses warnings on the mock <code>my_mock</code> of
        type <code>MockClass</code> if a method other than <code>DoSomething()</code> is called:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">NiceMock</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">NiceMock</span><span class="o">&lt;</span><span class="n">MockClass</span><span class="o">&gt;</span> <span class="n">my_mock</span><span class="p">(</span><span class="s">"some"</span><span class="p">,</span> <span class="s">"args"</span><span class="p">);</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">DoSomething</span><span class="p">());</span>
<span class="p">...</span> <span class="n">code</span> <span class="n">that</span> <span class="n">uses</span> <span class="n">my_mock</span> <span class="p">...</span>
</pre>
      <p><code>NiceMock&lt;T&gt;</code> only works for mock methods defined using the <code>MOCK_METHOD</code> macro
        directly in the definition of class <code>T</code>. If a mock method is defined in a base
        class of <code>T</code>, a warning might still be generated.</p>
      <p><code>NiceMock&lt;T&gt;</code> might not work correctly if the destructor of <code>T</code> is not virtual.</p>
      <h3 id="naggymock-naggymock">NaggyMock {#NaggyMock}</h3>
      <p><code>::testing::NaggyMock&lt;T&gt;</code></p>
      <p>Represents a mock object that generates warnings on
        <a href="../#gmock-cookbook#uninteresting-vs-unexpected">uninteresting calls</a>. The
        template parameter <code>T</code> is any mock class, except for another <code>NiceMock</code>,
        <code>NaggyMock</code>, or <code>StrictMock</code>.
      </p>
      <p>Usage of <code>NaggyMock&lt;T&gt;</code> is analogous to usage of <code>T</code>.
        <code>NaggyMock&lt;T&gt;</code> is a
        subclass of <code>T</code>, so it can be used wherever an object of type <code>T</code> is accepted.
        In addition, <code>NaggyMock&lt;T&gt;</code> can be constructed with any arguments that a
        constructor of <code>T</code> accepts.
      </p>
      <p>For example, the following code generates warnings on the mock <code>my_mock</code> of type
        <code>MockClass</code> if a method other than <code>DoSomething()</code> is called:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">NaggyMock</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">NaggyMock</span><span class="o">&lt;</span><span class="n">MockClass</span><span class="o">&gt;</span> <span class="n">my_mock</span><span class="p">(</span><span class="s">"some"</span><span class="p">,</span> <span class="s">"args"</span><span class="p">);</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">DoSomething</span><span class="p">());</span>
<span class="p">...</span> <span class="n">code</span> <span class="n">that</span> <span class="n">uses</span> <span class="n">my_mock</span> <span class="p">...</span>
</pre>
      <p>Mock objects of type <code>T</code> by default behave the same way as <code>NaggyMock&lt;T&gt;</code>.</p>
      <h3 id="strictmock-strictmock">StrictMock {#StrictMock}</h3>
      <p><code>::testing::StrictMock&lt;T&gt;</code></p>
      <p>Represents a mock object that generates test failures on
        <a href="../#gmock-cookbook#uninteresting-vs-unexpected">uninteresting calls</a>. The
        template parameter <code>T</code> is any mock class, except for another <code>NiceMock</code>,
        <code>NaggyMock</code>, or <code>StrictMock</code>.
      </p>
      <p>Usage of <code>StrictMock&lt;T&gt;</code> is analogous to usage of <code>T</code>.
        <code>StrictMock&lt;T&gt;</code> is a
        subclass of <code>T</code>, so it can be used wherever an object of type <code>T</code> is accepted.
        In addition, <code>StrictMock&lt;T&gt;</code> can be constructed with any arguments that a
        constructor of <code>T</code> accepts.
      </p>
      <p>For example, the following code generates a test failure on the mock <code>my_mock</code>
        of type <code>MockClass</code> if a method other than <code>DoSomething()</code> is called:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">StrictMock</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">StrictMock</span><span class="o">&lt;</span><span class="n">MockClass</span><span class="o">&gt;</span> <span class="n">my_mock</span><span class="p">(</span><span class="s">"some"</span><span class="p">,</span> <span class="s">"args"</span><span class="p">);</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">my_mock</span><span class="p">,</span> <span class="n">DoSomething</span><span class="p">());</span>
<span class="p">...</span> <span class="n">code</span> <span class="n">that</span> <span class="n">uses</span> <span class="n">my_mock</span> <span class="p">...</span>
</pre>
      <p><code>StrictMock&lt;T&gt;</code> only works for mock methods defined using the <code>MOCK_METHOD</code>
        macro directly in the definition of class <code>T</code>. If a mock method is defined in a
        base class of <code>T</code>, a failure might not be generated.</p>
      <p><code>StrictMock&lt;T&gt;</code> might not work correctly if the destructor of <code>T</code> is not
        virtual.</p>
      <h3 id="sequence-sequence">Sequence {#Sequence}</h3>
      <p><code>::testing::Sequence</code></p>
      <p>Represents a chronological sequence of expectations. See the
        <a href="#EXPECT_CALL.InSequence"><code>InSequence</code></a> clause of <code>EXPECT_CALL</code> for usage.
      </p>
      <h3 id="insequence-insequence">InSequence {#InSequence}</h3>
      <p><code>::testing::InSequence</code></p>
      <p>An object of this type causes all expectations encountered in its scope to be
        put in an anonymous sequence.</p>
      <p>This allows more convenient expression of multiple expectations in a single
        sequence:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">InSequence</span><span class="p">;</span>
<span class="p">{</span>
  <span class="n">InSequence</span> <span class="n">seq</span><span class="p">;</span>

  <span class="c1">// The following are expected to occur in the order declared.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(...);</span>
  <span class="n">EXPECT_CALL</span><span class="p">(...);</span>
  <span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(...);</span>
<span class="p">}</span>
</pre>
      <p>The name of the <code>InSequence</code> object does not matter.</p>
      <h3 id="expectation-expectation">Expectation {#Expectation}</h3>
      <p><code>::testing::Expectation</code></p>
      <p>Represents a mock function call expectation as created by
        <a href="#EXPECT_CALL"><code>EXPECT_CALL</code></a>:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Expectation</span><span class="p">;</span>
<span class="n">Expectation</span> <span class="n">my_expectation</span> <span class="o">=</span> <span class="n">EXPECT_CALL</span><span class="p">(...);</span>
</pre>
      <p>Useful for specifying sequences of expectations; see the
        <a href="#EXPECT_CALL.After"><code>After</code></a> clause of <code>EXPECT_CALL</code>.
      </p>
      <h3 id="expectationset-expectationset">ExpectationSet {#ExpectationSet}</h3>
      <p><code>::testing::ExpectationSet</code></p>
      <p>Represents a set of mock function call expectations.</p>
      <p>Use the <code>+=</code> operator to add <a href="#Expectation"><code>Expectation</code></a> objects to the set:
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">ExpectationSet</span><span class="p">;</span>
<span class="n">ExpectationSet</span> <span class="n">my_expectations</span><span class="p">;</span>
<span class="n">my_expectations</span> <span class="o">+=</span> <span class="n">EXPECT_CALL</span><span class="p">(...);</span>
</pre>
      <p>Useful for specifying sequences of expectations; see the
        <a href="#EXPECT_CALL.After"><code>After</code></a> clause of <code>EXPECT_CALL</code>.
      </p>
      <h1 id="assertions-reference">Assertions Reference</h1>
      <p>This page lists the assertion macros provided by GoogleTest for verifying code
        behavior. To use them, add <code>#include &lt;gtest/gtest.h&gt;</code>.</p>
      <p>The majority of the macros listed below come as a pair with an <code>EXPECT_</code> variant
        and an <code>ASSERT_</code> variant. Upon failure, <code>EXPECT_</code> macros generate nonfatal
        failures and allow the current function to continue running, while <code>ASSERT_</code>
        macros generate fatal failures and abort the current function.</p>
      <p>All assertion macros support streaming a custom failure message into them with
        the <code>&lt;&lt;</code> operator, for example:</p>
      <pre class="chroma"><span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">my_condition</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"My condition is not true"</span><span class="p">;</span>
</pre>
      <p>Anything that can be streamed to an <code>ostream</code> can be streamed to an assertion
        macro—in particular, C strings and string objects. If a wide string (<code>wchar_t*</code>,
        <code>TCHAR*</code> in <code>UNICODE</code> mode on Windows, or <code>std::wstring</code>) is streamed to an
        assertion, it will be translated to UTF-8 when printed.
      </p>
      <h2 id="explicit-success-and-failure-success-failure">Explicit Success and Failure {#success-failure}</h2>
      <p>The assertions in this section generate a success or failure directly instead of
        testing a value or expression. These are useful when control flow, rather than a
        Boolean expression, determines the test’s success or failure, as shown by the
        following example:</p>
      <pre class="chroma"><span class="k">switch</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
    <span class="p">...</span> <span class="n">some</span> <span class="n">checks</span> <span class="p">...</span>
  <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
    <span class="p">...</span> <span class="n">some</span> <span class="n">other</span> <span class="n">checks</span> <span class="p">...</span>
  <span class="k">default</span><span class="o">:</span>
    <span class="n">FAIL</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"We shouldn't get here."</span><span class="p">;</span>
<span class="p">}</span>
</pre>
      <h3 id="succeed-succeed">SUCCEED {#SUCCEED}</h3>
      <p><code>SUCCEED()</code></p>
      <p>Generates a success. This <em>does not</em> make the overall test succeed. A test is
        considered successful only if none of its assertions fail during its execution.</p>
      <p>The <code>SUCCEED</code> assertion is purely documentary and currently doesn’t generate any
        user-visible output. However, we may add <code>SUCCEED</code> messages to GoogleTest output
        in the future.</p>
      <h3 id="fail-fail">FAIL {#FAIL}</h3>
      <p><code>FAIL()</code></p>
      <p>Generates a fatal failure, which returns from the current function.</p>
      <p>Can only be used in functions that return <code>void</code>. See
        <a href="../#advanced-googletest-topics#assertion-placement">Assertion Placement</a> for more information.
      </p>
      <h3 id="add-failure-add-failure">ADD_FAILURE {#ADD_FAILURE}</h3>
      <p><code>ADD_FAILURE()</code></p>
      <p>Generates a nonfatal failure, which allows the current function to continue
        running.</p>
      <h3 id="add-failure-at-add-failure-at">ADD_FAILURE_AT {#ADD_FAILURE_AT}</h3>
      <p>
        <code>ADD_FAILURE_AT(</code><em><code>file_path</code></em><code>,</code><em><code>line_number</code></em><code>)</code>
      </p>
      <p>Generates a nonfatal failure at the file and line number specified.</p>
      <h2 id="generalized-assertion-generalized">Generalized Assertion {#generalized}</h2>
      <p>The following assertion allows <a href="matchers.md">matchers</a> to be used to verify
        values.</p>
      <h3 id="expect-that-expect-that">EXPECT_THAT {#EXPECT_THAT}</h3>
      <p>
        <code>EXPECT_THAT(</code><em><code>value</code></em><code>,</code><em><code>matcher</code></em><code>)</code><br>
        <code>ASSERT_THAT(</code><em><code>value</code></em><code>,</code><em><code>matcher</code></em><code>)</code>
      </p>
      <p>Verifies that <em><code>value</code></em> matches the <a href="matchers.md">matcher</a>
        <em><code>matcher</code></em>.
      </p>
      <p>For example, the following code verifies that the string <code>value1</code> starts with
        <code>"Hello"</code>, <code>value2</code> matches a regular expression, and <code>value3</code> is
        between 5 and
        10:
      </p>
      <pre class="chroma"><span class="cp">#include</span> <span class="cpf">&lt;gmock/gmock.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">AllOf</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Gt</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Lt</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">MatchesRegex</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">StartsWith</span><span class="p">;</span>

<span class="p">...</span>
<span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">StartsWith</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">));</span>
<span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">value2</span><span class="p">,</span> <span class="n">MatchesRegex</span><span class="p">(</span><span class="s">"Line </span><span class="se">\\</span><span class="s">d+"</span><span class="p">));</span>
<span class="n">ASSERT_THAT</span><span class="p">(</span><span class="n">value3</span><span class="p">,</span> <span class="n">AllOf</span><span class="p">(</span><span class="n">Gt</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">Lt</span><span class="p">(</span><span class="mi">10</span><span class="p">)));</span>
</pre>
      <p>Matchers enable assertions of this form to read like English and generate
        informative failure messages. For example, if the above assertion on <code>value1</code>
        fails, the resulting message will be similar to the following:</p>
      <pre><code>Value of: value1
  Actual: "Hi, world!"
Expected: starts with "Hello"
</code></pre>
      <p>GoogleTest provides a built-in library of matchers—see the
        <a href="matchers.md">Matchers Reference</a>. It is also possible to write your own
        matchers—see <a href="../#gmock-cookbook#NewMatchers">Writing New Matchers Quickly</a>.
        The use of matchers makes <code>EXPECT_THAT</code> a powerful, extensible assertion.
      </p>
      <p><em>The idea for this assertion was borrowed from Joe Walnes' Hamcrest project,
          which adds <code>assertThat()</code> to JUnit.</em></p>
      <h2 id="boolean-conditions-boolean">Boolean Conditions {#boolean}</h2>
      <p>The following assertions test Boolean conditions.</p>
      <h3 id="expect-true-expect-true">EXPECT_TRUE {#EXPECT_TRUE}</h3>
      <p><code>EXPECT_TRUE(</code><em><code>condition</code></em><code>)</code><br>
        <code>ASSERT_TRUE(</code><em><code>condition</code></em><code>)</code>
      </p>
      <p>Verifies that <em><code>condition</code></em> is true.</p>
      <h3 id="expect-false-expect-false">EXPECT_FALSE {#EXPECT_FALSE}</h3>
      <p><code>EXPECT_FALSE(</code><em><code>condition</code></em><code>)</code><br>
        <code>ASSERT_FALSE(</code><em><code>condition</code></em><code>)</code>
      </p>
      <p>Verifies that <em><code>condition</code></em> is false.</p>
      <h2 id="binary-comparison-binary-comparison">Binary Comparison {#binary-comparison}</h2>
      <p>The following assertions compare two values. The value arguments must be
        comparable by the assertion’s comparison operator, otherwise a compiler error
        will result.</p>
      <p>If an argument supports the <code>&lt;&lt;</code> operator, it will be called to print the
        argument when the assertion fails. Otherwise, GoogleTest will attempt to print
        them in the best way it can—see
        <a href="../#advanced-googletest-topics#teaching-googletest-how-to-print-your-values">Teaching GoogleTest How to
          Print Your Values</a>.
      </p>
      <p>Arguments are always evaluated exactly once, so it’s OK for the arguments to
        have side effects. However, the argument evaluation order is undefined and
        programs should not depend on any particular argument evaluation order.</p>
      <p>These assertions work with both narrow and wide string objects (<code>string</code> and
        <code>wstring</code>).
      </p>
      <p>See also the <a href="#floating-point">Floating-Point Comparison</a> assertions to compare
        floating-point numbers and avoid problems caused by rounding.</p>
      <h3 id="expect-eq-expect-eq">EXPECT_EQ {#EXPECT_EQ}</h3>
      <p><code>EXPECT_EQ(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code><br>
        <code>ASSERT_EQ(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code>
      </p>
      <p>Verifies that <em><code>val1</code></em><code>==</code><em><code>val2</code></em>.</p>
      <p>Does pointer equality on pointers. If used on two C strings, it tests if they
        are in the same memory location, not if they have the same value. Use
        <a href="#EXPECT_STREQ"><code>EXPECT_STREQ</code></a> to compare C strings (e.g. <code>const char*</code>) by
        value.
      </p>
      <p>When comparing a pointer to <code>NULL</code>, use
        <code>EXPECT_EQ(</code><em><code>ptr</code></em><code>, nullptr)</code> instead
        of <code>EXPECT_EQ(</code><em><code>ptr</code></em><code>, NULL)</code>.
      </p>
      <h3 id="expect-ne-expect-ne">EXPECT_NE {#EXPECT_NE}</h3>
      <p><code>EXPECT_NE(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code><br>
        <code>ASSERT_NE(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code>
      </p>
      <p>Verifies that <em><code>val1</code></em><code>!=</code><em><code>val2</code></em>.</p>
      <p>Does pointer equality on pointers. If used on two C strings, it tests if they
        are in different memory locations, not if they have different values. Use
        <a href="#EXPECT_STRNE"><code>EXPECT_STRNE</code></a> to compare C strings (e.g. <code>const char*</code>) by
        value.
      </p>
      <p>When comparing a pointer to <code>NULL</code>, use
        <code>EXPECT_NE(</code><em><code>ptr</code></em><code>, nullptr)</code> instead
        of <code>EXPECT_NE(</code><em><code>ptr</code></em><code>, NULL)</code>.
      </p>
      <h3 id="expect-lt-expect-lt">EXPECT_LT {#EXPECT_LT}</h3>
      <p><code>EXPECT_LT(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code><br>
        <code>ASSERT_LT(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code>
      </p>
      <p>Verifies that <em><code>val1</code></em><code>&lt;</code><em><code>val2</code></em>.</p>
      <h3 id="expect-le-expect-le">EXPECT_LE {#EXPECT_LE}</h3>
      <p><code>EXPECT_LE(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code><br>
        <code>ASSERT_LE(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code>
      </p>
      <p>Verifies that <em><code>val1</code></em><code>&lt;=</code><em><code>val2</code></em>.</p>
      <h3 id="expect-gt-expect-gt">EXPECT_GT {#EXPECT_GT}</h3>
      <p><code>EXPECT_GT(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code><br>
        <code>ASSERT_GT(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code>
      </p>
      <p>Verifies that <em><code>val1</code></em><code>&gt;</code><em><code>val2</code></em>.</p>
      <h3 id="expect-ge-expect-ge">EXPECT_GE {#EXPECT_GE}</h3>
      <p><code>EXPECT_GE(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code><br>
        <code>ASSERT_GE(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code>
      </p>
      <p>Verifies that <em><code>val1</code></em><code>&gt;=</code><em><code>val2</code></em>.</p>
      <h2 id="string-comparison-c-strings">String Comparison {#c-strings}</h2>
      <p>The following assertions compare two <strong>C strings</strong>. To compare two <code>string</code>
        objects, use <a href="#EXPECT_EQ"><code>EXPECT_EQ</code></a> or <a href="#EXPECT_NE"><code>EXPECT_NE</code></a>
        instead.</p>
      <p>These assertions also accept wide C strings (<code>wchar_t*</code>). If a comparison of two
        wide strings fails, their values will be printed as UTF-8 narrow strings.</p>
      <p>To compare a C string with <code>NULL</code>, use
        <code>EXPECT_EQ(</code><em><code>c_string</code></em><code>, nullptr)</code> or
        <code>EXPECT_NE(</code><em><code>c_string</code></em><code>, nullptr)</code>.
      </p>
      <h3 id="expect-streq-expect-streq">EXPECT_STREQ {#EXPECT_STREQ}</h3>
      <p>
        <code>EXPECT_STREQ(</code><em><code>str1</code></em><code>,</code><em><code>str2</code></em><code>)</code><br>
        <code>ASSERT_STREQ(</code><em><code>str1</code></em><code>,</code><em><code>str2</code></em><code>)</code>
      </p>
      <p>Verifies that the two C strings <em><code>str1</code></em> and <em><code>str2</code></em> have the same
        contents.</p>
      <h3 id="expect-strne-expect-strne">EXPECT_STRNE {#EXPECT_STRNE}</h3>
      <p>
        <code>EXPECT_STRNE(</code><em><code>str1</code></em><code>,</code><em><code>str2</code></em><code>)</code><br>
        <code>ASSERT_STRNE(</code><em><code>str1</code></em><code>,</code><em><code>str2</code></em><code>)</code>
      </p>
      <p>Verifies that the two C strings <em><code>str1</code></em> and <em><code>str2</code></em> have different
        contents.</p>
      <h3 id="expect-strcaseeq-expect-strcaseeq">EXPECT_STRCASEEQ {#EXPECT_STRCASEEQ}</h3>
      <p>
        <code>EXPECT_STRCASEEQ(</code><em><code>str1</code></em><code>,</code><em><code>str2</code></em><code>)</code><br>
        <code>ASSERT_STRCASEEQ(</code><em><code>str1</code></em><code>,</code><em><code>str2</code></em><code>)</code>
      </p>
      <p>Verifies that the two C strings <em><code>str1</code></em> and <em><code>str2</code></em> have the same
        contents,
        ignoring case.</p>
      <h3 id="expect-strcasene-expect-strcasene">EXPECT_STRCASENE {#EXPECT_STRCASENE}</h3>
      <p>
        <code>EXPECT_STRCASENE(</code><em><code>str1</code></em><code>,</code><em><code>str2</code></em><code>)</code><br>
        <code>ASSERT_STRCASENE(</code><em><code>str1</code></em><code>,</code><em><code>str2</code></em><code>)</code>
      </p>
      <p>Verifies that the two C strings <em><code>str1</code></em> and <em><code>str2</code></em> have different
        contents,
        ignoring case.</p>
      <h2 id="floating-point-comparison-floating-point">Floating-Point Comparison {#floating-point}</h2>
      <p>The following assertions compare two floating-point values.</p>
      <p>Due to rounding errors, it is very unlikely that two floating-point values will
        match exactly, so <code>EXPECT_EQ</code> is not suitable. In general, for floating-point
        comparison to make sense, the user needs to carefully choose the error bound.</p>
      <p>GoogleTest also provides assertions that use a default error bound based on
        Units in the Last Place (ULPs). To learn more about ULPs, see the article
        <a href="https://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/">Comparing
          Floating Point Numbers</a>.
      </p>
      <h3 id="expect-float-eq-expect-float-eq">EXPECT_FLOAT_EQ {#EXPECT_FLOAT_EQ}</h3>
      <p>
        <code>EXPECT_FLOAT_EQ(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code><br>
        <code>ASSERT_FLOAT_EQ(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code>
      </p>
      <p>Verifies that the two <code>float</code> values <em><code>val1</code></em> and <em><code>val2</code></em> are
        approximately
        equal, to within 4 ULPs from each other.</p>
      <h3 id="expect-double-eq-expect-double-eq">EXPECT_DOUBLE_EQ {#EXPECT_DOUBLE_EQ}</h3>
      <p>
        <code>EXPECT_DOUBLE_EQ(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code><br>
        <code>ASSERT_DOUBLE_EQ(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code>
      </p>
      <p>Verifies that the two <code>double</code> values <em><code>val1</code></em> and <em><code>val2</code></em> are
        approximately
        equal, to within 4 ULPs from each other.</p>
      <h3 id="expect-near-expect-near">EXPECT_NEAR {#EXPECT_NEAR}</h3>
      <p>
        <code>EXPECT_NEAR(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>,</code><em><code>abs_error</code></em><code>)</code><br>
        <code>ASSERT_NEAR(</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>,</code><em><code>abs_error</code></em><code>)</code>
      </p>
      <p>Verifies that the difference between <em><code>val1</code></em> and <em><code>val2</code></em> does not exceed
        the
        absolute error bound <em><code>abs_error</code></em>.</p>
      <h2 id="exception-assertions-exceptions">Exception Assertions {#exceptions}</h2>
      <p>The following assertions verify that a piece of code throws, or does not throw,
        an exception. Usage requires exceptions to be enabled in the build environment.</p>
      <p>Note that the piece of code under test can be a compound statement, for example:</p>
      <pre class="chroma"><span class="n">EXPECT_NO_THROW</span><span class="p">({</span>
  <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="n">DoSomething</span><span class="p">(</span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
<span class="p">});</span>
</pre>
      <h3 id="expect-throw-expect-throw">EXPECT_THROW {#EXPECT_THROW}</h3>
      <p>
        <code>EXPECT_THROW(</code><em><code>statement</code></em><code>,</code><em><code>exception_type</code></em><code>)</code><br>
        <code>ASSERT_THROW(</code><em><code>statement</code></em><code>,</code><em><code>exception_type</code></em><code>)</code>
      </p>
      <p>Verifies that <em><code>statement</code></em> throws an exception of type <em><code>exception_type</code></em>.
      </p>
      <h3 id="expect-any-throw-expect-any-throw">EXPECT_ANY_THROW {#EXPECT_ANY_THROW}</h3>
      <p><code>EXPECT_ANY_THROW(</code><em><code>statement</code></em><code>)</code><br>
        <code>ASSERT_ANY_THROW(</code><em><code>statement</code></em><code>)</code>
      </p>
      <p>Verifies that <em><code>statement</code></em> throws an exception of any type.</p>
      <h3 id="expect-no-throw-expect-no-throw">EXPECT_NO_THROW {#EXPECT_NO_THROW}</h3>
      <p><code>EXPECT_NO_THROW(</code><em><code>statement</code></em><code>)</code><br>
        <code>ASSERT_NO_THROW(</code><em><code>statement</code></em><code>)</code>
      </p>
      <p>Verifies that <em><code>statement</code></em> does not throw any exception.</p>
      <h2 id="predicate-assertions-predicates">Predicate Assertions {#predicates}</h2>
      <p>The following assertions enable more complex predicates to be verified while
        printing a more clear failure message than if <code>EXPECT_TRUE</code> were used alone.</p>
      <h3 id="expect-pred-expect-pred">EXPECT_PRED* {#EXPECT_PRED}</h3>
      <p>
        <code>EXPECT_PRED1(</code><em><code>pred</code></em><code>,</code><em><code>val1</code></em><code>)</code><br>
        <code>EXPECT_PRED2(</code><em><code>pred</code></em><code>,</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code><br>
        <code>EXPECT_PRED3(</code><em><code>pred</code></em><code>,</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>,</code><em><code>val3</code></em><code>)</code><br>
        <code>EXPECT_PRED4(</code><em><code>pred</code></em><code>,</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>,</code><em><code>val3</code></em><code>,</code><em><code>val4</code></em><code>)</code><br>
        <code>EXPECT_PRED5(</code><em><code>pred</code></em><code>,</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>,</code><em><code>val3</code></em><code>,</code><em><code>val4</code></em><code>,</code><em><code>val5</code></em><code>)</code>
      </p>
      <p>
        <code>ASSERT_PRED1(</code><em><code>pred</code></em><code>,</code><em><code>val1</code></em><code>)</code><br>
        <code>ASSERT_PRED2(</code><em><code>pred</code></em><code>,</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code><br>
        <code>ASSERT_PRED3(</code><em><code>pred</code></em><code>,</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>,</code><em><code>val3</code></em><code>)</code><br>
        <code>ASSERT_PRED4(</code><em><code>pred</code></em><code>,</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>,</code><em><code>val3</code></em><code>,</code><em><code>val4</code></em><code>)</code><br>
        <code>ASSERT_PRED5(</code><em><code>pred</code></em><code>,</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>,</code><em><code>val3</code></em><code>,</code><em><code>val4</code></em><code>,</code><em><code>val5</code></em><code>)</code>
      </p>
      <p>Verifies that the predicate <em><code>pred</code></em> returns <code>true</code> when passed the given values
        as arguments.</p>
      <p>The parameter <em><code>pred</code></em> is a function or functor that accepts as many arguments
        as the corresponding macro accepts values. If <em><code>pred</code></em> returns <code>true</code> for the
        given arguments, the assertion succeeds, otherwise the assertion fails.</p>
      <p>When the assertion fails, it prints the value of each argument. Arguments are
        always evaluated exactly once.</p>
      <p>As an example, see the following code:</p>
      <pre class="chroma"><span class="c1">// Returns true if m and n have no common divisors except 1.
</span><span class="c1"></span><span class="kt">bool</span> <span class="nf">MutuallyPrime</span><span class="p">(</span><span class="kt">int</span> <span class="n">m</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">...</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_PRED2</span><span class="p">(</span><span class="n">MutuallyPrime</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>  <span class="c1">// Succeeds
</span><span class="c1"></span><span class="n">EXPECT_PRED2</span><span class="p">(</span><span class="n">MutuallyPrime</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>  <span class="c1">// Fails
</span></pre>
      <p>In the above example, the first assertion succeeds, and the second fails with
        the following message:</p>
      <pre><code>MutuallyPrime(b, c) is false, where
b is 4
c is 10
</code></pre>
      <p>Note that if the given predicate is an overloaded function or a function
        template, the assertion macro might not be able to determine which version to
        use, and it might be necessary to explicitly specify the type of the function.
        For example, for a Boolean function <code>IsPositive()</code> overloaded to take either a
        single <code>int</code> or <code>double</code> argument, it would be necessary to write one of the
        following:</p>
      <pre class="chroma"><span class="n">EXPECT_PRED1</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">int</span><span class="p">)</span><span class="o">&gt;</span><span class="p">(</span><span class="n">IsPositive</span><span class="p">),</span> <span class="mi">5</span><span class="p">);</span>
<span class="n">EXPECT_PRED1</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">double</span><span class="p">)</span><span class="o">&gt;</span><span class="p">(</span><span class="n">IsPositive</span><span class="p">),</span> <span class="mf">3.14</span><span class="p">);</span>
</pre>
      <p>Writing simply <code>EXPECT_PRED1(IsPositive, 5);</code> would result in a compiler error.
        Similarly, to use a template function, specify the template arguments:</p>
      <pre class="chroma"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="kt">bool</span> <span class="n">IsNegative</span><span class="p">(</span><span class="n">T</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="n">EXPECT_PRED1</span><span class="p">(</span><span class="n">IsNegative</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">);</span>  <span class="c1">// Must specify type for IsNegative
</span></pre>
      <p>If a template has multiple parameters, wrap the predicate in parentheses so the
        macro arguments are parsed correctly:</p>
      <pre class="chroma"><span class="n">ASSERT_PRED2</span><span class="p">((</span><span class="n">MyPredicate</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</pre>
      <h3 id="expect-pred-format-expect-pred-format">EXPECT_PRED_FORMAT* {#EXPECT_PRED_FORMAT}</h3>
      <p>
        <code>EXPECT_PRED_FORMAT1(</code><em><code>pred_formatter</code></em><code>,</code><em><code>val1</code></em><code>)</code><br>
        <code>EXPECT_PRED_FORMAT2(</code><em><code>pred_formatter</code></em><code>,</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code><br>
        <code>EXPECT_PRED_FORMAT3(</code><em><code>pred_formatter</code></em><code>,</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>,</code><em><code>val3</code></em><code>)</code><br>
        <code>EXPECT_PRED_FORMAT4(</code><em><code>pred_formatter</code></em><code>,</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>,</code><em><code>val3</code></em><code>,</code><em><code>val4</code></em><code>)</code>
        <br>
        <code>EXPECT_PRED_FORMAT5(</code><em><code>pred_formatter</code></em><code>,</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>,</code><em><code>val3</code></em><code>,</code><em><code>val4</code></em><code>,</code><em><code>val5</code></em><code>)</code>
      </p>
      <p>
        <code>ASSERT_PRED_FORMAT1(</code><em><code>pred_formatter</code></em><code>,</code><em><code>val1</code></em><code>)</code><br>
        <code>ASSERT_PRED_FORMAT2(</code><em><code>pred_formatter</code></em><code>,</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>)</code><br>
        <code>ASSERT_PRED_FORMAT3(</code><em><code>pred_formatter</code></em><code>,</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>,</code><em><code>val3</code></em><code>)</code><br>
        <code>ASSERT_PRED_FORMAT4(</code><em><code>pred_formatter</code></em><code>,</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>,</code><em><code>val3</code></em><code>,</code><em><code>val4</code></em><code>)</code>
        <br>
        <code>ASSERT_PRED_FORMAT5(</code><em><code>pred_formatter</code></em><code>,</code><em><code>val1</code></em><code>,</code><em><code>val2</code></em><code>,</code><em><code>val3</code></em><code>,</code><em><code>val4</code></em><code>,</code><em><code>val5</code></em><code>)</code>
      </p>
      <p>Verifies that the predicate <em><code>pred_formatter</code></em> succeeds when passed the given
        values as arguments.</p>
      <p>The parameter <em><code>pred_formatter</code></em> is a <em>predicate-formatter</em>, which is a function
        or functor with the signature:</p>
      <pre class="chroma"><span class="n">testing</span><span class="o">::</span><span class="n">AssertionResult</span> <span class="n">PredicateFormatter</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">expr1</span><span class="p">,</span>
                                            <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">expr2</span><span class="p">,</span>
                                            <span class="p">...</span>
                                            <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">exprn</span><span class="p">,</span>
                                            <span class="n">T1</span> <span class="n">val1</span><span class="p">,</span>
                                            <span class="n">T2</span> <span class="n">val2</span><span class="p">,</span>
                                            <span class="p">...</span>
                                            <span class="n">Tn</span> <span class="n">valn</span><span class="p">);</span>
</pre>
      <p>where <em><code>val1</code></em>, <em><code>val2</code></em>, …, <em><code>valn</code></em> are the values of
        the predicate
        arguments, and <em><code>expr1</code></em>, <em><code>expr2</code></em>, …, <em><code>exprn</code></em> are the
        corresponding
        expressions as they appear in the source code. The types <code>T1</code>, <code>T2</code>, …, <code>Tn</code>
        can be either value types or reference types; if an argument has type <code>T</code>, it
        can be declared as either <code>T</code> or <code>const T&amp;</code>, whichever is appropriate. For more
        about the return type <code>testing::AssertionResult</code>, see
        <a href="../#advanced-googletest-topics#using-a-function-that-returns-an-assertionresult">Using a Function That
          Returns an AssertionResult</a>.
      </p>
      <p>As an example, see the following code:</p>
      <pre class="chroma"><span class="c1">// Returns the smallest prime common divisor of m and n,
</span><span class="c1">// or 1 when m and n are mutually prime.
</span><span class="c1"></span><span class="kt">int</span> <span class="nf">SmallestPrimeCommonDivisor</span><span class="p">(</span><span class="kt">int</span> <span class="n">m</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="c1">// Returns true if m and n have no common divisors except 1.
</span><span class="c1"></span><span class="kt">bool</span> <span class="nf">MutuallyPrime</span><span class="p">(</span><span class="kt">int</span> <span class="n">m</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="c1">// A predicate-formatter for asserting that two integers are mutually prime.
</span><span class="c1"></span><span class="n">testing</span><span class="o">::</span><span class="n">AssertionResult</span> <span class="n">AssertMutuallyPrime</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">m_expr</span><span class="p">,</span>
                                             <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">n_expr</span><span class="p">,</span>
                                             <span class="kt">int</span> <span class="n">m</span><span class="p">,</span>
                                             <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">MutuallyPrime</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="k">return</span> <span class="n">testing</span><span class="o">::</span><span class="n">AssertionSuccess</span><span class="p">();</span>

  <span class="k">return</span> <span class="n">testing</span><span class="o">::</span><span class="n">AssertionFailure</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">m_expr</span> <span class="o">&lt;&lt;</span> <span class="s">" and "</span> <span class="o">&lt;&lt;</span> <span class="n">n_expr</span>
      <span class="o">&lt;&lt;</span> <span class="s">" ("</span> <span class="o">&lt;&lt;</span> <span class="n">m</span> <span class="o">&lt;&lt;</span> <span class="s">" and "</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="s">") are not mutually prime, "</span>
      <span class="o">&lt;&lt;</span> <span class="s">"as they have a common divisor "</span> <span class="o">&lt;&lt;</span> <span class="n">SmallestPrimeCommonDivisor</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">...</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">EXPECT_PRED_FORMAT2</span><span class="p">(</span><span class="n">AssertMutuallyPrime</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>  <span class="c1">// Succeeds
</span><span class="c1"></span><span class="n">EXPECT_PRED_FORMAT2</span><span class="p">(</span><span class="n">AssertMutuallyPrime</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>  <span class="c1">// Fails
</span></pre>
      <p>In the above example, the final assertion fails and the predicate-formatter
        produces the following failure message:</p>
      <pre><code>b and c (4 and 10) are not mutually prime, as they have a common divisor 2
</code></pre>
      <h2 id="windows-hresult-assertions-hresult">Windows HRESULT Assertions {#HRESULT}</h2>
      <p>The following assertions test for <code>HRESULT</code> success or failure. For example:</p>
      <pre class="chroma"><span class="n">CComPtr</span><span class="o">&lt;</span><span class="n">IShellDispatch2</span><span class="o">&gt;</span> <span class="n">shell</span><span class="p">;</span>
<span class="n">ASSERT_HRESULT_SUCCEEDED</span><span class="p">(</span><span class="n">shell</span><span class="p">.</span><span class="n">CoCreateInstance</span><span class="p">(</span><span class="sa">L</span><span class="s">"Shell.Application"</span><span class="p">));</span>
<span class="n">CComVariant</span> <span class="n">empty</span><span class="p">;</span>
<span class="n">ASSERT_HRESULT_SUCCEEDED</span><span class="p">(</span><span class="n">shell</span><span class="o">-&gt;</span><span class="n">ShellExecute</span><span class="p">(</span><span class="n">CComBSTR</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="n">empty</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">empty</span><span class="p">));</span>
</pre>
      <p>The generated output contains the human-readable error message associated with
        the returned <code>HRESULT</code> code.</p>
      <h3 id="expect-hresult-succeeded-expect-hresult-succeeded">EXPECT_HRESULT_SUCCEEDED {#EXPECT_HRESULT_SUCCEEDED}
      </h3>
      <p><code>EXPECT_HRESULT_SUCCEEDED(</code><em><code>expression</code></em><code>)</code><br>
        <code>ASSERT_HRESULT_SUCCEEDED(</code><em><code>expression</code></em><code>)</code>
      </p>
      <p>Verifies that <em><code>expression</code></em> is a success <code>HRESULT</code>.</p>
      <h3 id="expect-hresult-failed-expect-hresult-failed">EXPECT_HRESULT_FAILED {#EXPECT_HRESULT_FAILED}</h3>
      <p><code>EXPECT_HRESULT_FAILED(</code><em><code>expression</code></em><code>)</code><br>
        <code>ASSERT_HRESULT_FAILED(</code><em><code>expression</code></em><code>)</code>
      </p>
      <p>Verifies that <em><code>expression</code></em> is a failure <code>HRESULT</code>.</p>
      <h2 id="death-assertions-death">Death Assertions {#death}</h2>
      <p>The following assertions verify that a piece of code causes the process to
        terminate. For context, see <a href="../#advanced-googletest-topics#death-tests">Death Tests</a>.</p>
      <p>These assertions spawn a new process and execute the code under test in that
        process. How that happens depends on the platform and the variable
        <code>::testing::GTEST_FLAG(death_test_style)</code>, which is initialized from the
        command-line flag <code>--gtest_death_test_style</code>.
      </p>
      <ul>
        <li>On POSIX systems, <code>fork()</code> (or <code>clone()</code> on Linux) is used to spawn the
          child, after which:
          <ul>
            <li>If the variable’s value is <code>"fast"</code>, the death test statement is
              immediately executed.</li>
            <li>If the variable’s value is <code>"threadsafe"</code>, the child process re-executes
              the unit test binary just as it was originally invoked, but with some
              extra flags to cause just the single death test under consideration to
              be run.</li>
          </ul>
        </li>
        <li>On Windows, the child is spawned using the <code>CreateProcess()</code> API, and
          re-executes the binary to cause just the single death test under
          consideration to be run - much like the <code>"threadsafe"</code> mode on POSIX.</li>
      </ul>
      <p>Other values for the variable are illegal and will cause the death test to fail.
        Currently, the flag’s default value is
        <strong><code>"fast"</code></strong>.
      </p>
      <p>If the death test statement runs to completion without dying, the child process
        will nonetheless terminate, and the assertion fails.</p>
      <p>Note that the piece of code under test can be a compound statement, for example:</p>
      <pre class="chroma"><span class="n">EXPECT_DEATH</span><span class="p">({</span>
  <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="n">DoSomething</span><span class="p">(</span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
<span class="p">},</span> <span class="s">"Error on line .* of DoSomething()"</span><span class="p">);</span>
</pre>
      <h3 id="expect-death-expect-death">EXPECT_DEATH {#EXPECT_DEATH}</h3>
      <p>
        <code>EXPECT_DEATH(</code><em><code>statement</code></em><code>,</code><em><code>matcher</code></em><code>)</code><br>
        <code>ASSERT_DEATH(</code><em><code>statement</code></em><code>,</code><em><code>matcher</code></em><code>)</code>
      </p>
      <p>Verifies that <em><code>statement</code></em> causes the process to terminate with a nonzero exit
        status and produces <code>stderr</code> output that matches <em><code>matcher</code></em>.</p>
      <p>The parameter <em><code>matcher</code></em> is either a <a href="matchers.md">matcher</a> for a
        <code>const std::string&amp;</code>, or a regular expression (see
        <a href="../#advanced-googletest-topics#regular-expression-syntax">Regular Expression Syntax</a>)—a bare
        string <em><code>s</code></em> (with no matcher) is treated as
        <a href="matchers.md#string-matchers"><code>ContainsRegex(s)</code></a>, <strong>not</strong>
        <a href="matchers.md#generic-comparison"><code>Eq(s)</code></a>.
      </p>
      <p>For example, the following code verifies that calling <code>DoSomething(42)</code> causes
        the process to die with an error message that contains the text <code>My error</code>:</p>
      <pre class="chroma"><span class="n">EXPECT_DEATH</span><span class="p">(</span><span class="n">DoSomething</span><span class="p">(</span><span class="mi">42</span><span class="p">),</span> <span class="s">"My error"</span><span class="p">);</span>
</pre>
      <h3 id="expect-death-if-supported-expect-death-if-supported">EXPECT_DEATH_IF_SUPPORTED
        {#EXPECT_DEATH_IF_SUPPORTED}</h3>
      <p>
        <code>EXPECT_DEATH_IF_SUPPORTED(</code><em><code>statement</code></em><code>,</code><em><code>matcher</code></em><code>)</code><br>
        <code>ASSERT_DEATH_IF_SUPPORTED(</code><em><code>statement</code></em><code>,</code><em><code>matcher</code></em><code>)</code>
      </p>
      <p>If death tests are supported, behaves the same as
        <a href="#EXPECT_DEATH"><code>EXPECT_DEATH</code></a>. Otherwise, verifies nothing.
      </p>
      <h3 id="expect-debug-death-expect-debug-death">EXPECT_DEBUG_DEATH {#EXPECT_DEBUG_DEATH}</h3>
      <p>
        <code>EXPECT_DEBUG_DEATH(</code><em><code>statement</code></em><code>,</code><em><code>matcher</code></em><code>)</code><br>
        <code>ASSERT_DEBUG_DEATH(</code><em><code>statement</code></em><code>,</code><em><code>matcher</code></em><code>)</code>
      </p>
      <p>In debug mode, behaves the same as <a href="#EXPECT_DEATH"><code>EXPECT_DEATH</code></a>. When not in
        debug mode (i.e. <code>NDEBUG</code> is defined), just executes <em><code>statement</code></em>.</p>
      <h3 id="expect-exit-expect-exit">EXPECT_EXIT {#EXPECT_EXIT}</h3>
      <p>
        <code>EXPECT_EXIT(</code><em><code>statement</code></em><code>,</code><em><code>predicate</code></em><code>,</code><em><code>matcher</code></em><code>)</code><br>
        <code>ASSERT_EXIT(</code><em><code>statement</code></em><code>,</code><em><code>predicate</code></em><code>,</code><em><code>matcher</code></em><code>)</code>
      </p>
      <p>Verifies that <em><code>statement</code></em> causes the process to terminate with an exit status
        that satisfies <em><code>predicate</code></em>, and produces <code>stderr</code> output that matches
        <em><code>matcher</code></em>.
      </p>
      <p>The parameter <em><code>predicate</code></em> is a function or functor that accepts an <code>int</code> exit
        status and returns a <code>bool</code>. GoogleTest provides two predicates to handle common
        cases:</p>
      <pre class="chroma"><span class="c1">// Returns true if the program exited normally with the given exit status code.
</span><span class="c1"></span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">ExitedWithCode</span><span class="p">(</span><span class="n">exit_code</span><span class="p">);</span>

<span class="c1">// Returns true if the program was killed by the given signal.
</span><span class="c1">// Not available on Windows.
</span><span class="c1"></span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">KilledBySignal</span><span class="p">(</span><span class="n">signal_number</span><span class="p">);</span>
</pre>
      <p>The parameter <em><code>matcher</code></em> is either a <a href="matchers.md">matcher</a> for a
        <code>const std::string&amp;</code>, or a regular expression (see
        <a href="../#advanced-googletest-topics#regular-expression-syntax">Regular Expression Syntax</a>)—a bare
        string <em><code>s</code></em> (with no matcher) is treated as
        <a href="matchers.md#string-matchers"><code>ContainsRegex(s)</code></a>, <strong>not</strong>
        <a href="matchers.md#generic-comparison"><code>Eq(s)</code></a>.
      </p>
      <p>For example, the following code verifies that calling <code>NormalExit()</code> causes the
        process to print a message containing the text <code>Success</code> to <code>stderr</code> and exit
        with exit status code 0:</p>
      <pre class="chroma"><span class="n">EXPECT_EXIT</span><span class="p">(</span><span class="n">NormalExit</span><span class="p">(),</span> <span class="n">testing</span><span class="o">::</span><span class="n">ExitedWithCode</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"Success"</span><span class="p">);</span>
</pre>
      <h1 id="matchers-reference">Matchers Reference</h1>
      <p>A <strong>matcher</strong> matches a <em>single</em> argument. You can use it inside <code>ON_CALL()</code> or
        <code>EXPECT_CALL()</code>, or use it to validate a value directly using two macros:
      </p>
      <table>
        <thead>
          <tr>
            <th align="left">Macro</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>EXPECT_THAT(actual_value, matcher)</code></td>
            <td align="left">Asserts that <code>actual_value</code> matches <code>matcher</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>ASSERT_THAT(actual_value, matcher)</code></td>
            <td align="left">The same as <code>EXPECT_THAT(actual_value, matcher)</code>, except that it generates a
              <strong>fatal</strong> failure.
            </td>
          </tr>
        </tbody>
      </table>
      <p>{: .callout .warning}
        <strong>WARNING:</strong> Equality matching via <code>EXPECT_THAT(actual_value, expected_value)</code>
        is supported, however note that implicit conversions can cause surprising
        results. For example, <code>EXPECT_THAT(some_bool, "some string")</code> will compile and
        may pass unintentionally.
      </p>
      <p><strong>BEST PRACTICE:</strong> Prefer to make the comparison explicit via
        <code>EXPECT_THAT(actual_value, Eq(expected_value))</code> or
        <code>EXPECT_EQ(actual_value, expected_value)</code>.
      </p>
      <p>Built-in matchers (where <code>argument</code> is the function argument, e.g.
        <code>actual_value</code> in the example above, or when used in the context of
        <code>EXPECT_CALL(mock_object, method(matchers))</code>, the arguments of <code>method</code>) are
        divided into several categories. All matchers are defined in the <code>::testing</code>
        namespace unless otherwise noted.
      </p>
      <h2 id="wildcard">Wildcard</h2>
      <table>
        <thead>
          <tr>
            <th align="left">Matcher</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>_</code></td>
            <td align="left"><code>argument</code> can be any value of the correct type.</td>
          </tr>
          <tr>
            <td align="left"><code>A&lt;type&gt;()</code> or <code>An&lt;type&gt;()</code></td>
            <td align="left"><code>argument</code> can be any value of type <code>type</code>.</td>
          </tr>
        </tbody>
      </table>
      <h2 id="generic-comparison">Generic Comparison</h2>
      <table>
        <thead>
          <tr>
            <th align="left">Matcher</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>Eq(value)</code> or <code>value</code></td>
            <td align="left"><code>argument == value</code></td>
          </tr>
          <tr>
            <td align="left"><code>Ge(value)</code></td>
            <td align="left"><code>argument &gt;= value</code></td>
          </tr>
          <tr>
            <td align="left"><code>Gt(value)</code></td>
            <td align="left"><code>argument &gt; value</code></td>
          </tr>
          <tr>
            <td align="left"><code>Le(value)</code></td>
            <td align="left"><code>argument &lt;= value</code></td>
          </tr>
          <tr>
            <td align="left"><code>Lt(value)</code></td>
            <td align="left"><code>argument &lt; value</code></td>
          </tr>
          <tr>
            <td align="left"><code>Ne(value)</code></td>
            <td align="left"><code>argument != value</code></td>
          </tr>
          <tr>
            <td align="left"><code>IsFalse()</code></td>
            <td align="left"><code>argument</code> evaluates to <code>false</code> in a Boolean context.</td>
          </tr>
          <tr>
            <td align="left"><code>IsTrue()</code></td>
            <td align="left"><code>argument</code> evaluates to <code>true</code> in a Boolean context.</td>
          </tr>
          <tr>
            <td align="left"><code>IsNull()</code></td>
            <td align="left"><code>argument</code> is a <code>NULL</code> pointer (raw or smart).</td>
          </tr>
          <tr>
            <td align="left"><code>NotNull()</code></td>
            <td align="left"><code>argument</code> is a non-null pointer (raw or smart).</td>
          </tr>
          <tr>
            <td align="left"><code>Optional(m)</code></td>
            <td align="left"><code>argument</code> is <code>optional&lt;&gt;</code> that contains a value matching
              <code>m</code>. (For testing whether an <code>optional&lt;&gt;</code> is set, check for equality with
              <code>nullopt</code>. You may need to use <code>Eq(nullopt)</code> if the inner type doesn’t have
              <code>==</code>.)
            </td>
          </tr>
          <tr>
            <td align="left"><code>VariantWith&lt;T&gt;(m)</code></td>
            <td align="left"><code>argument</code> is <code>variant&lt;&gt;</code> that holds the alternative of type T
              with a value matching <code>m</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>Ref(variable)</code></td>
            <td align="left"><code>argument</code> is a reference to <code>variable</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>TypedEq&lt;type&gt;(value)</code></td>
            <td align="left"><code>argument</code> has type <code>type</code> and is equal to <code>value</code>. You
              may need to use this instead of <code>Eq(value)</code> when the mock function is overloaded.</td>
          </tr>
        </tbody>
      </table>
      <p>Except <code>Ref()</code>, these matchers make a <em>copy</em> of <code>value</code> in case it’s modified or
        destructed later. If the compiler complains that <code>value</code> doesn’t have a public
        copy constructor, try wrap it in <code>std::ref()</code>, e.g.
        <code>Eq(std::ref(non_copyable_value))</code>. If you do that, make sure
        <code>non_copyable_value</code> is not changed afterwards, or the meaning of your matcher
        will be changed.
      </p>
      <p><code>IsTrue</code> and <code>IsFalse</code> are useful when you need to use a matcher, or for types
        that can be explicitly converted to Boolean, but are not implicitly converted to
        Boolean. In other cases, you can use the basic
        <a href="assertions.md#boolean"><code>EXPECT_TRUE</code> and <code>EXPECT_FALSE</code></a> assertions.
      </p>
      <h2 id="floating-point-matchers-fpmatchers">Floating-Point Matchers {#FpMatchers}</h2>
      <table>
        <thead>
          <tr>
            <th align="left">Matcher</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>DoubleEq(a_double)</code></td>
            <td align="left"><code>argument</code> is a <code>double</code> value approximately equal to
              <code>a_double</code>, treating two NaNs as unequal.
            </td>
          </tr>
          <tr>
            <td align="left"><code>FloatEq(a_float)</code></td>
            <td align="left"><code>argument</code> is a <code>float</code> value approximately equal to
              <code>a_float</code>, treating two NaNs as unequal.
            </td>
          </tr>
          <tr>
            <td align="left"><code>NanSensitiveDoubleEq(a_double)</code></td>
            <td align="left"><code>argument</code> is a <code>double</code> value approximately equal to
              <code>a_double</code>, treating two NaNs as equal.
            </td>
          </tr>
          <tr>
            <td align="left"><code>NanSensitiveFloatEq(a_float)</code></td>
            <td align="left"><code>argument</code> is a <code>float</code> value approximately equal to
              <code>a_float</code>, treating two NaNs as equal.
            </td>
          </tr>
          <tr>
            <td align="left"><code>IsNan()</code></td>
            <td align="left"><code>argument</code> is any floating-point type with a NaN value.</td>
          </tr>
        </tbody>
      </table>
      <p>The above matchers use ULP-based comparison (the same as used in googletest).
        They automatically pick a reasonable error bound based on the absolute value of
        the expected value. <code>DoubleEq()</code> and <code>FloatEq()</code> conform to the IEEE standard,
        which requires comparing two NaNs for equality to return false. The
        <code>NanSensitive*</code> version instead treats two NaNs as equal, which is often what a
        user wants.
      </p>
      <table>
        <thead>
          <tr>
            <th align="left">Matcher</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>DoubleNear(a_double, max_abs_error)</code></td>
            <td align="left"><code>argument</code> is a <code>double</code> value close to <code>a_double</code>
              (absolute error &lt;= <code>max_abs_error</code>), treating two NaNs as unequal.</td>
          </tr>
          <tr>
            <td align="left"><code>FloatNear(a_float, max_abs_error)</code></td>
            <td align="left"><code>argument</code> is a <code>float</code> value close to <code>a_float</code> (absolute
              error &lt;= <code>max_abs_error</code>), treating two NaNs as unequal.</td>
          </tr>
          <tr>
            <td align="left"><code>NanSensitiveDoubleNear(a_double, max_abs_error)</code></td>
            <td align="left"><code>argument</code> is a <code>double</code> value close to <code>a_double</code>
              (absolute error &lt;= <code>max_abs_error</code>), treating two NaNs as equal.</td>
          </tr>
          <tr>
            <td align="left"><code>NanSensitiveFloatNear(a_float, max_abs_error)</code></td>
            <td align="left"><code>argument</code> is a <code>float</code> value close to <code>a_float</code> (absolute
              error &lt;= <code>max_abs_error</code>), treating two NaNs as equal.</td>
          </tr>
        </tbody>
      </table>
      <h2 id="string-matchers">String Matchers</h2>
      <p>The <code>argument</code> can be either a C string or a C++ string object:</p>
      <table>
        <thead>
          <tr>
            <th align="left">Matcher</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>ContainsRegex(string)</code></td>
            <td align="left"><code>argument</code> matches the given regular expression.</td>
          </tr>
          <tr>
            <td align="left"><code>EndsWith(suffix)</code></td>
            <td align="left"><code>argument</code> ends with string <code>suffix</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>HasSubstr(string)</code></td>
            <td align="left"><code>argument</code> contains <code>string</code> as a sub-string.</td>
          </tr>
          <tr>
            <td align="left"><code>IsEmpty()</code></td>
            <td align="left"><code>argument</code> is an empty string.</td>
          </tr>
          <tr>
            <td align="left"><code>MatchesRegex(string)</code></td>
            <td align="left"><code>argument</code> matches the given regular expression with the match starting at the
              first character and ending at the last character.</td>
          </tr>
          <tr>
            <td align="left"><code>StartsWith(prefix)</code></td>
            <td align="left"><code>argument</code> starts with string <code>prefix</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>StrCaseEq(string)</code></td>
            <td align="left"><code>argument</code> is equal to <code>string</code>, ignoring case.</td>
          </tr>
          <tr>
            <td align="left"><code>StrCaseNe(string)</code></td>
            <td align="left"><code>argument</code> is not equal to <code>string</code>, ignoring case.</td>
          </tr>
          <tr>
            <td align="left"><code>StrEq(string)</code></td>
            <td align="left"><code>argument</code> is equal to <code>string</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>StrNe(string)</code></td>
            <td align="left"><code>argument</code> is not equal to <code>string</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>WhenBase64Unescaped(m)</code></td>
            <td align="left"><code>argument</code> is a base-64 escaped string whose unescaped string matches
              <code>m</code>. The web-safe format from <a href="https://www.rfc-editor.org/rfc/rfc4648#section-5">RFC
                4648</a> is supported.
            </td>
          </tr>
        </tbody>
      </table>
      <p><code>ContainsRegex()</code> and <code>MatchesRegex()</code> take ownership of the <code>RE</code> object. They
        use the regular expression syntax defined
        <a href="../#advanced-googletest-topics#regular-expression-syntax">here</a>. All of these matchers, except
        <code>ContainsRegex()</code> and <code>MatchesRegex()</code> work for wide strings as well.
      </p>
      <h2 id="container-matchers">Container Matchers</h2>
      <p>Most STL-style containers support <code>==</code>, so you can use <code>Eq(expected_container)</code>
        or simply <code>expected_container</code> to match a container exactly. If you want to
        write the elements in-line, match them more flexibly, or get more informative
        messages, you can use:</p>
      <table>
        <thead>
          <tr>
            <th align="left">Matcher</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>BeginEndDistanceIs(m)</code></td>
            <td align="left"><code>argument</code> is a container whose <code>begin()</code> and <code>end()</code>
              iterators are separated by a number of increments matching <code>m</code>. E.g.
              <code>BeginEndDistanceIs(2)</code> or <code>BeginEndDistanceIs(Lt(2))</code>. For containers that define a
              <code>size()</code> method, <code>SizeIs(m)</code> may be more efficient.
            </td>
          </tr>
          <tr>
            <td align="left"><code>ContainerEq(container)</code></td>
            <td align="left">The same as <code>Eq(container)</code> except that the failure message also includes which
              elements are in one container but not the other.</td>
          </tr>
          <tr>
            <td align="left"><code>Contains(e)</code></td>
            <td align="left"><code>argument</code> contains an element that matches <code>e</code>, which can be either
              a value or a matcher.</td>
          </tr>
          <tr>
            <td align="left"><code>Contains(e).Times(n)</code></td>
            <td align="left"><code>argument</code> contains elements that match <code>e</code>, which can be either a
              value or a matcher, and the number of matches is <code>n</code>, which can be either a value or a matcher.
              Unlike the plain <code>Contains</code> and <code>Each</code> this allows to check for arbitrary
              occurrences including testing for absence with <code>Contains(e).Times(0)</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>Each(e)</code></td>
            <td align="left"><code>argument</code> is a container where <em>every</em> element matches <code>e</code>,
              which can be either a value or a matcher.</td>
          </tr>
          <tr>
            <td align="left"><code>ElementsAre(e0, e1, ..., en)</code></td>
            <td align="left"><code>argument</code> has <code>n + 1</code> elements, where the <em>i</em>-th element
              matches <code>ei</code>, which can be a value or a matcher.</td>
          </tr>
          <tr>
            <td align="left"><code>ElementsAreArray({e0, e1, ..., en})</code>,
              <code>ElementsAreArray(a_container)</code>, <code>ElementsAreArray(begin, end)</code>,
              <code>ElementsAreArray(array)</code>, or <code>ElementsAreArray(array, count)</code>
            </td>
            <td align="left">The same as <code>ElementsAre()</code> except that the expected element values/matchers
              come from an initializer list, STL-style container, iterator range, or C-style array.</td>
          </tr>
          <tr>
            <td align="left"><code>IsEmpty()</code></td>
            <td align="left"><code>argument</code> is an empty container (<code>container.empty()</code>).</td>
          </tr>
          <tr>
            <td align="left"><code>IsSubsetOf({e0, e1, ..., en})</code>, <code>IsSubsetOf(a_container)</code>,
              <code>IsSubsetOf(begin, end)</code>, <code>IsSubsetOf(array)</code>, or
              <code>IsSubsetOf(array, count)</code>
            </td>
            <td align="left"><code>argument</code> matches <code>UnorderedElementsAre(x0, x1, ..., xk)</code> for some
              subset <code>{x0, x1, ..., xk}</code> of the expected matchers.</td>
          </tr>
          <tr>
            <td align="left"><code>IsSupersetOf({e0, e1, ..., en})</code>, <code>IsSupersetOf(a_container)</code>,
              <code>IsSupersetOf(begin, end)</code>, <code>IsSupersetOf(array)</code>, or
              <code>IsSupersetOf(array, count)</code>
            </td>
            <td align="left">Some subset of <code>argument</code> matches <code>UnorderedElementsAre(</code>expected
              matchers<code>)</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>Pointwise(m, container)</code>, <code>Pointwise(m, {e0, e1, ..., en})</code></td>
            <td align="left"><code>argument</code> contains the same number of elements as in <code>container</code>,
              and for all i, (the i-th element in <code>argument</code>, the i-th element in <code>container</code>)
              match <code>m</code>, which is a matcher on 2-tuples. E.g. <code>Pointwise(Le(), upper_bounds)</code>
              verifies that each element in <code>argument</code> doesn’t exceed the corresponding element in
              <code>upper_bounds</code>. See more detail below.
            </td>
          </tr>
          <tr>
            <td align="left"><code>SizeIs(m)</code></td>
            <td align="left"><code>argument</code> is a container whose size matches <code>m</code>. E.g.
              <code>SizeIs(2)</code> or <code>SizeIs(Lt(2))</code>.
            </td>
          </tr>
          <tr>
            <td align="left"><code>UnorderedElementsAre(e0, e1, ..., en)</code></td>
            <td align="left"><code>argument</code> has <code>n + 1</code> elements, and under <em>some</em> permutation
              of the elements, each element matches an <code>ei</code> (for a different <code>i</code>), which can be a
              value or a matcher.</td>
          </tr>
          <tr>
            <td align="left"><code>UnorderedElementsAreArray({e0, e1, ..., en})</code>,
              <code>UnorderedElementsAreArray(a_container)</code>, <code>UnorderedElementsAreArray(begin, end)</code>,
              <code>UnorderedElementsAreArray(array)</code>, or <code>UnorderedElementsAreArray(array, count)</code>
            </td>
            <td align="left">The same as <code>UnorderedElementsAre()</code> except that the expected element
              values/matchers come from an initializer list, STL-style container, iterator range, or C-style array.</td>
          </tr>
          <tr>
            <td align="left"><code>UnorderedPointwise(m, container)</code>,
              <code>UnorderedPointwise(m, {e0, e1, ..., en})</code>
            </td>
            <td align="left">Like <code>Pointwise(m, container)</code>, but ignores the order of elements.</td>
          </tr>
          <tr>
            <td align="left"><code>WhenSorted(m)</code></td>
            <td align="left">When <code>argument</code> is sorted using the <code>&lt;</code> operator, it matches
              container matcher <code>m</code>. E.g. <code>WhenSorted(ElementsAre(1, 2, 3))</code> verifies that
              <code>argument</code> contains elements 1, 2, and 3, ignoring order.
            </td>
          </tr>
          <tr>
            <td align="left"><code>WhenSortedBy(comparator, m)</code></td>
            <td align="left">The same as <code>WhenSorted(m)</code>, except that the given comparator instead of
              <code>&lt;</code> is used to sort <code>argument</code>. E.g.
              <code>WhenSortedBy(std::greater(), ElementsAre(3, 2, 1))</code>.
            </td>
          </tr>
        </tbody>
      </table>
      <p><strong>Notes:</strong></p>
      <ul>
        <li>
          <p>These matchers can also match:</p>
          <ol>
            <li>a native array passed by reference (e.g. in <code>Foo(const int (&amp;a)[5])</code>),
              and</li>
            <li>an array passed as a pointer and a count (e.g. in <code>Bar(const T* buffer, int len)</code> – see <a href="#MultiArgMatchers">Multi-argument Matchers</a>).</li>
          </ol>
        </li>
        <li>
          <p>The array being matched may be multi-dimensional (i.e. its elements can be
            arrays).</p>
        </li>
        <li>
          <p><code>m</code> in <code>Pointwise(m, ...)</code> and <code>UnorderedPointwise(m, ...)</code> should be a
            matcher for <code>::std::tuple&lt;T, U&gt;</code> where <code>T</code> and <code>U</code> are the element
            type of
            the actual container and the expected container, respectively. For example,
            to compare two <code>Foo</code> containers where <code>Foo</code> doesn’t support <code>operator==</code>,
            one might write:</p>
          <pre class="chroma"><span class="n">MATCHER</span><span class="p">(</span><span class="n">FooEq</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">arg</span><span class="p">).</span><span class="n">Equals</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">arg</span><span class="p">));</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">actual_foos</span><span class="p">,</span> <span class="n">Pointwise</span><span class="p">(</span><span class="n">FooEq</span><span class="p">(),</span> <span class="n">expected_foos</span><span class="p">));</span>
</pre>
        </li>
      </ul>
      <h2 id="member-matchers">Member Matchers</h2>
      <table>
        <thead>
          <tr>
            <th align="left">Matcher</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>Field(&amp;class::field, m)</code></td>
            <td align="left"><code>argument.field</code> (or <code>argument-&gt;field</code> when <code>argument</code>
              is a plain pointer) matches matcher <code>m</code>, where <code>argument</code> is an object of type
              <em>class</em>.
            </td>
          </tr>
          <tr>
            <td align="left"><code>Field(field_name, &amp;class::field, m)</code></td>
            <td align="left">The same as the two-parameter version, but provides a better error message.</td>
          </tr>
          <tr>
            <td align="left"><code>Key(e)</code></td>
            <td align="left"><code>argument.first</code> matches <code>e</code>, which can be either a value or a
              matcher. E.g. <code>Contains(Key(Le(5)))</code> can verify that a <code>map</code> contains a key
              <code>&lt;= 5</code>.
            </td>
          </tr>
          <tr>
            <td align="left"><code>Pair(m1, m2)</code></td>
            <td align="left"><code>argument</code> is an <code>std::pair</code> whose <code>first</code> field matches
              <code>m1</code> and <code>second</code> field matches <code>m2</code>.
            </td>
          </tr>
          <tr>
            <td align="left"><code>FieldsAre(m...)</code></td>
            <td align="left"><code>argument</code> is a compatible object where each field matches piecewise with the
              matchers <code>m...</code>. A compatible object is any that supports the
              <code>std::tuple_size&lt;Obj&gt;</code>+<code>get&lt;I&gt;(obj)</code> protocol. In C++17 and up this also
              supports types compatible with structured bindings, like aggregates.
            </td>
          </tr>
          <tr>
            <td align="left"><code>Property(&amp;class::property, m)</code></td>
            <td align="left"><code>argument.property()</code> (or <code>argument-&gt;property()</code> when
              <code>argument</code> is a plain pointer) matches matcher <code>m</code>, where <code>argument</code> is
              an object of type <em>class</em>. The method <code>property()</code> must take no argument and be declared
              as <code>const</code>.
            </td>
          </tr>
          <tr>
            <td align="left"><code>Property(property_name, &amp;class::property, m)</code></td>
            <td align="left">The same as the two-parameter version, but provides a better error message.</td>
          </tr>
        </tbody>
      </table>
      <p><strong>Notes:</strong></p>
      <ul>
        <li>
          <p>You can use <code>FieldsAre()</code> to match any type that supports structured
            bindings, such as <code>std::tuple</code>, <code>std::pair</code>, <code>std::array</code>, and aggregate
            types. For example:</p>
          <pre class="chroma"><span class="n">std</span><span class="o">::</span><span class="n">tuple</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">my_tuple</span><span class="p">{</span><span class="mi">7</span><span class="p">,</span> <span class="s">"hello world"</span><span class="p">};</span>
<span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">my_tuple</span><span class="p">,</span> <span class="n">FieldsAre</span><span class="p">(</span><span class="n">Ge</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">HasSubstr</span><span class="p">(</span><span class="s">"hello"</span><span class="p">)));</span>

<span class="k">struct</span> <span class="nc">MyStruct</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">greeting</span> <span class="o">=</span> <span class="s">"aloha"</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">MyStruct</span> <span class="n">s</span><span class="p">;</span>
<span class="n">EXPECT_THAT</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">FieldsAre</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="s">"aloha"</span><span class="p">));</span>
</pre>
        </li>
        <li>
          <p>Don’t use <code>Property()</code> against member functions that you do not own, because
            taking addresses of functions is fragile and generally not part of the
            contract of the function.</p>
        </li>
      </ul>
      <h2 id="matching-the-result-of-a-function-functor-or-callback">Matching the Result of a Function, Functor, or
        Callback</h2>
      <table>
        <thead>
          <tr>
            <th align="left">Matcher</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>ResultOf(f, m)</code></td>
            <td align="left"><code>f(argument)</code> matches matcher <code>m</code>, where <code>f</code> is a function
              or functor.</td>
          </tr>
          <tr>
            <td align="left"><code>ResultOf(result_description, f, m)</code></td>
            <td align="left">The same as the two-parameter version, but provides a better error message.</td>
          </tr>
        </tbody>
      </table>
      <h2 id="pointer-matchers">Pointer Matchers</h2>
      <table>
        <thead>
          <tr>
            <th align="left">Matcher</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>Address(m)</code></td>
            <td align="left">the result of <code>std::addressof(argument)</code> matches <code>m</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>Pointee(m)</code></td>
            <td align="left"><code>argument</code> (either a smart pointer or a raw pointer) points to a value that
              matches matcher <code>m</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>Pointer(m)</code></td>
            <td align="left"><code>argument</code> (either a smart pointer or a raw pointer) contains a pointer that
              matches <code>m</code>. <code>m</code> will match against the raw pointer regardless of the type of
              <code>argument</code>.
            </td>
          </tr>
          <tr>
            <td align="left"><code>WhenDynamicCastTo&lt;T&gt;(m)</code></td>
            <td align="left">when <code>argument</code> is passed through <code>dynamic_cast&lt;T&gt;()</code>, it
              matches matcher <code>m</code>.</td>
          </tr>
        </tbody>
      </table>
      <h2 id="multi-argument-matchers-multiargmatchers">Multi-argument Matchers {#MultiArgMatchers}</h2>
      <p>Technically, all matchers match a <em>single</em> value. A “multi-argument” matcher is
        just one that matches a <em>tuple</em>. The following matchers can be used to match a
        tuple <code>(x, y)</code>:</p>
      <table>
        <thead>
          <tr>
            <th align="left">Matcher</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>Eq()</code></td>
            <td align="left"><code>x == y</code></td>
          </tr>
          <tr>
            <td align="left"><code>Ge()</code></td>
            <td align="left"><code>x &gt;= y</code></td>
          </tr>
          <tr>
            <td align="left"><code>Gt()</code></td>
            <td align="left"><code>x &gt; y</code></td>
          </tr>
          <tr>
            <td align="left"><code>Le()</code></td>
            <td align="left"><code>x &lt;= y</code></td>
          </tr>
          <tr>
            <td align="left"><code>Lt()</code></td>
            <td align="left"><code>x &lt; y</code></td>
          </tr>
          <tr>
            <td align="left"><code>Ne()</code></td>
            <td align="left"><code>x != y</code></td>
          </tr>
        </tbody>
      </table>
      <p>You can use the following selectors to pick a subset of the arguments (or
        reorder them) to participate in the matching:</p>
      <table>
        <thead>
          <tr>
            <th align="left">Matcher</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>AllArgs(m)</code></td>
            <td align="left">Equivalent to <code>m</code>. Useful as syntactic sugar in <code>.With(AllArgs(m))</code>.
            </td>
          </tr>
          <tr>
            <td align="left"><code>Args&lt;N1, N2, ..., Nk&gt;(m)</code></td>
            <td align="left">The tuple of the <code>k</code> selected (using 0-based indices) arguments matches
              <code>m</code>, e.g. <code>Args&lt;1, 2&gt;(Eq())</code>.
            </td>
          </tr>
        </tbody>
      </table>
      <h2 id="composite-matchers">Composite Matchers</h2>
      <p>You can make a matcher from one or more other matchers:</p>
      <table>
        <thead>
          <tr>
            <th align="left">Matcher</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>AllOf(m1, m2, ..., mn)</code></td>
            <td align="left"><code>argument</code> matches all of the matchers <code>m1</code> to <code>mn</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>AllOfArray({m0, m1, ..., mn})</code>, <code>AllOfArray(a_container)</code>,
              <code>AllOfArray(begin, end)</code>, <code>AllOfArray(array)</code>, or
              <code>AllOfArray(array, count)</code>
            </td>
            <td align="left">The same as <code>AllOf()</code> except that the matchers come from an initializer list,
              STL-style container, iterator range, or C-style array.</td>
          </tr>
          <tr>
            <td align="left"><code>AnyOf(m1, m2, ..., mn)</code></td>
            <td align="left"><code>argument</code> matches at least one of the matchers <code>m1</code> to
              <code>mn</code>.
            </td>
          </tr>
          <tr>
            <td align="left"><code>AnyOfArray({m0, m1, ..., mn})</code>, <code>AnyOfArray(a_container)</code>,
              <code>AnyOfArray(begin, end)</code>, <code>AnyOfArray(array)</code>, or
              <code>AnyOfArray(array, count)</code>
            </td>
            <td align="left">The same as <code>AnyOf()</code> except that the matchers come from an initializer list,
              STL-style container, iterator range, or C-style array.</td>
          </tr>
          <tr>
            <td align="left"><code>Not(m)</code></td>
            <td align="left"><code>argument</code> doesn’t match matcher <code>m</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>Conditional(cond, m1, m2)</code></td>
            <td align="left">Matches matcher <code>m1</code> if <code>cond</code> evaluates to true, else matches
              <code>m2</code>.
            </td>
          </tr>
        </tbody>
      </table>
      <h2 id="adapters-for-matchers">Adapters for Matchers</h2>
      <table>
        <thead>
          <tr>
            <th align="left">Matcher</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>MatcherCast&lt;T&gt;(m)</code></td>
            <td align="left">casts matcher <code>m</code> to type <code>Matcher&lt;T&gt;</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>SafeMatcherCast&lt;T&gt;(m)</code></td>
            <td align="left"><a href="../#gmock-cookbook#SafeMatcherCast">safely casts</a> matcher <code>m</code> to
              type <code>Matcher&lt;T&gt;</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>Truly(predicate)</code></td>
            <td align="left"><code>predicate(argument)</code> returns something considered by C++ to be true, where
              <code>predicate</code> is a function or functor.
            </td>
          </tr>
        </tbody>
      </table>
      <p><code>AddressSatisfies(callback)</code> and <code>Truly(callback)</code> take ownership of
        <code>callback</code>,
        which must be a permanent callback.
      </p>
      <h2 id="using-matchers-as-predicates-matchersaspredicatescheat">Using Matchers as Predicates
        {#MatchersAsPredicatesCheat}</h2>
      <table>
        <thead>
          <tr>
            <th align="left">Matcher</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>Matches(m)(value)</code></td>
            <td align="left">evaluates to <code>true</code> if <code>value</code> matches <code>m</code>. You can use
              <code>Matches(m)</code> alone as a unary functor.
            </td>
          </tr>
          <tr>
            <td align="left"><code>ExplainMatchResult(m, value, result_listener)</code></td>
            <td align="left">evaluates to <code>true</code> if <code>value</code> matches <code>m</code>, explaining the
              result to <code>result_listener</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>Value(value, m)</code></td>
            <td align="left">evaluates to <code>true</code> if <code>value</code> matches <code>m</code>.</td>
          </tr>
        </tbody>
      </table>
      <h2 id="defining-matchers">Defining Matchers</h2>
      <table>
        <thead>
          <tr>
            <th align="left">Macro</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>MATCHER(IsEven, "") { return (arg % 2) == 0; }</code></td>
            <td align="left">Defines a matcher <code>IsEven()</code> to match an even number.</td>
          </tr>
          <tr>
            <td align="left">
              <code>MATCHER_P(IsDivisibleBy, n, "") { *result_listener &lt;&lt; "where the remainder is " &lt;&lt; (arg % n); return (arg % n) == 0; }</code>
            </td>
            <td align="left">Defines a matcher <code>IsDivisibleBy(n)</code> to match a number divisible by
              <code>n</code>.
            </td>
          </tr>
          <tr>
            <td align="left">
              <code>MATCHER_P2(IsBetween, a, b, absl::StrCat(negation ? "isn't" : "is", " between ", PrintToString(a), " and ", PrintToString(b))) { return a &lt;= arg &amp;&amp; arg &lt;= b; }</code>
            </td>
            <td align="left">Defines a matcher <code>IsBetween(a, b)</code> to match a value in the range
              [<code>a</code>, <code>b</code>].</td>
          </tr>
        </tbody>
      </table>
      <p><strong>Notes:</strong></p>
      <ol>
        <li>
          <p>The <code>MATCHER*</code> macros cannot be used inside a function or class.</p>
        </li>
        <li>
          <p>The matcher body must be <em>purely functional</em> (i.e. it cannot have any side
            effect, and the result must not depend on anything other than the value
            being matched and the matcher parameters).</p>
        </li>
        <li>
          <p>You can use <code>PrintToString(x)</code> to convert a value <code>x</code> of any type to a
            string.</p>
        </li>
        <li>
          <p>You can use <code>ExplainMatchResult()</code> in a custom matcher to wrap another
            matcher, for example:</p>
          <pre class="chroma"><span class="n">MATCHER_P</span><span class="p">(</span><span class="n">NestedPropertyMatches</span><span class="p">,</span> <span class="n">matcher</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">ExplainMatchResult</span><span class="p">(</span><span class="n">matcher</span><span class="p">,</span> <span class="n">arg</span><span class="p">.</span><span class="n">nested</span><span class="p">().</span><span class="n">property</span><span class="p">(),</span> <span class="n">result_listener</span><span class="p">);</span>
<span class="p">}</span>
</pre>
        </li>
        <li>
          <p>You can use <code>DescribeMatcher&lt;&gt;</code> to describe another matcher. For example:</p>
          <pre class="chroma"><span class="n">MATCHER_P</span><span class="p">(</span><span class="n">XAndYThat</span><span class="p">,</span> <span class="n">matcher</span><span class="p">,</span>
          <span class="s">"X that "</span> <span class="o">+</span> <span class="n">DescribeMatcher</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">matcher</span><span class="p">,</span> <span class="n">negation</span><span class="p">)</span> <span class="o">+</span>
              <span class="p">(</span><span class="n">negation</span> <span class="o">?</span> <span class="s">" or"</span> <span class="o">:</span> <span class="s">" and"</span><span class="p">)</span> <span class="o">+</span> <span class="s">" Y that "</span> <span class="o">+</span>
              <span class="n">DescribeMatcher</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">matcher</span><span class="p">,</span> <span class="n">negation</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">ExplainMatchResult</span><span class="p">(</span><span class="n">matcher</span><span class="p">,</span> <span class="n">arg</span><span class="p">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">result_listener</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
         <span class="n">ExplainMatchResult</span><span class="p">(</span><span class="n">matcher</span><span class="p">,</span> <span class="n">arg</span><span class="p">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">result_listener</span><span class="p">);</span>
<span class="p">}</span>
</pre>
        </li>
      </ol>
      <h1 id="actions-reference">Actions Reference</h1>
      <p><a href="../#gmock-for-dummies#actions-what-should-it-do"><strong>Actions</strong></a> specify what a
        mock function should do when invoked. This page lists the built-in actions
        provided by GoogleTest. All actions are defined in the <code>::testing</code> namespace.</p>
      <h2 id="returning-a-value">Returning a Value</h2>
      <table>
        <thead>
          <tr>
            <th align="left">Action</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>Return()</code></td>
            <td align="left">Return from a <code>void</code> mock function.</td>
          </tr>
          <tr>
            <td align="left"><code>Return(value)</code></td>
            <td align="left">Return <code>value</code>. If the type of <code>value</code> is different to the mock
              function’s return type, <code>value</code> is converted to the latter type <i>at the time the expectation
                is set</i>, not when the action is executed.</td>
          </tr>
          <tr>
            <td align="left"><code>ReturnArg&lt;N&gt;()</code></td>
            <td align="left">Return the <code>N</code>-th (0-based) argument.</td>
          </tr>
          <tr>
            <td align="left"><code>ReturnNew&lt;T&gt;(a1, ..., ak)</code></td>
            <td align="left">Return <code>new T(a1, ..., ak)</code>; a different object is created each time.</td>
          </tr>
          <tr>
            <td align="left"><code>ReturnNull()</code></td>
            <td align="left">Return a null pointer.</td>
          </tr>
          <tr>
            <td align="left"><code>ReturnPointee(ptr)</code></td>
            <td align="left">Return the value pointed to by <code>ptr</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>ReturnRef(variable)</code></td>
            <td align="left">Return a reference to <code>variable</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>ReturnRefOfCopy(value)</code></td>
            <td align="left">Return a reference to a copy of <code>value</code>; the copy lives as long as the action.
            </td>
          </tr>
          <tr>
            <td align="left"><code>ReturnRoundRobin({a1, ..., ak})</code></td>
            <td align="left">Each call will return the next <code>ai</code> in the list, starting at the beginning when
              the end of the list is reached.</td>
          </tr>
        </tbody>
      </table>
      <h2 id="side-effects">Side Effects</h2>
      <table>
        <thead>
          <tr>
            <th align="left">Action</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>Assign(&amp;variable, value)</code></td>
            <td align="left">Assign <code>value</code> to variable.</td>
          </tr>
          <tr>
            <td align="left"><code>DeleteArg&lt;N&gt;()</code></td>
            <td align="left">Delete the <code>N</code>-th (0-based) argument, which must be a pointer.</td>
          </tr>
          <tr>
            <td align="left"><code>SaveArg&lt;N&gt;(pointer)</code></td>
            <td align="left">Save the <code>N</code>-th (0-based) argument to <code>*pointer</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>SaveArgPointee&lt;N&gt;(pointer)</code></td>
            <td align="left">Save the value pointed to by the <code>N</code>-th (0-based) argument to
              <code>*pointer</code>.
            </td>
          </tr>
          <tr>
            <td align="left"><code>SetArgReferee&lt;N&gt;(value)</code></td>
            <td align="left">Assign <code>value</code> to the variable referenced by the <code>N</code>-th (0-based)
              argument.</td>
          </tr>
          <tr>
            <td align="left"><code>SetArgPointee&lt;N&gt;(value)</code></td>
            <td align="left">Assign <code>value</code> to the variable pointed by the <code>N</code>-th (0-based)
              argument.</td>
          </tr>
          <tr>
            <td align="left"><code>SetArgumentPointee&lt;N&gt;(value)</code></td>
            <td align="left">Same as <code>SetArgPointee&lt;N&gt;(value)</code>. Deprecated. Will be removed in v1.7.0.
            </td>
          </tr>
          <tr>
            <td align="left"><code>SetArrayArgument&lt;N&gt;(first, last)</code></td>
            <td align="left">Copies the elements in source range [<code>first</code>, <code>last</code>) to the array
              pointed to by the <code>N</code>-th (0-based) argument, which can be either a pointer or an iterator. The
              action does not take ownership of the elements in the source range.</td>
          </tr>
          <tr>
            <td align="left"><code>SetErrnoAndReturn(error, value)</code></td>
            <td align="left">Set <code>errno</code> to <code>error</code> and return <code>value</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>Throw(exception)</code></td>
            <td align="left">Throws the given exception, which can be any copyable value. Available since v1.1.0.</td>
          </tr>
        </tbody>
      </table>
      <h2 id="using-a-function-functor-or-lambda-as-an-action">Using a Function, Functor, or Lambda as an Action</h2>
      <p>In the following, by “callable” we mean a free function, <code>std::function</code>,
        functor, or lambda.</p>
      <table>
        <thead>
          <tr>
            <th align="left">Action</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>f</code></td>
            <td align="left">Invoke <code>f</code> with the arguments passed to the mock function, where <code>f</code>
              is a callable.</td>
          </tr>
          <tr>
            <td align="left"><code>Invoke(f)</code></td>
            <td align="left">Invoke <code>f</code> with the arguments passed to the mock function, where <code>f</code>
              can be a global/static function or a functor.</td>
          </tr>
          <tr>
            <td align="left"><code>Invoke(object_pointer, &amp;class::method)</code></td>
            <td align="left">Invoke the method on the object with the arguments passed to the mock function.</td>
          </tr>
          <tr>
            <td align="left"><code>InvokeWithoutArgs(f)</code></td>
            <td align="left">Invoke <code>f</code>, which can be a global/static function or a functor. <code>f</code>
              must take no arguments.</td>
          </tr>
          <tr>
            <td align="left"><code>InvokeWithoutArgs(object_pointer, &amp;class::method)</code></td>
            <td align="left">Invoke the method on the object, which takes no arguments.</td>
          </tr>
          <tr>
            <td align="left"><code>InvokeArgument&lt;N&gt;(arg1, arg2, ..., argk)</code></td>
            <td align="left">Invoke the mock function’s <code>N</code>-th (0-based) argument, which must be a function
              or a functor, with the <code>k</code> arguments.</td>
          </tr>
        </tbody>
      </table>
      <p>The return value of the invoked function is used as the return value of the
        action.</p>
      <p>When defining a callable to be used with <code>Invoke*()</code>, you can declare any unused
        parameters as <code>Unused</code>:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Invoke</span><span class="p">;</span>
<span class="kt">double</span> <span class="nf">Distance</span><span class="p">(</span><span class="n">Unused</span><span class="p">,</span> <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">);</span> <span class="p">}</span>
<span class="p">...</span>
<span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(</span><span class="s">"Hi"</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)).</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Invoke</span><span class="p">(</span><span class="n">Distance</span><span class="p">));</span>
</pre>
      <p><code>Invoke(callback)</code> and <code>InvokeWithoutArgs(callback)</code> take ownership of
        <code>callback</code>, which must be permanent. The type of <code>callback</code> must be a base
        callback type instead of a derived one, e.g.
      </p>
      <pre class="chroma">  <span class="n">BlockingClosure</span><span class="o">*</span> <span class="n">done</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BlockingClosure</span><span class="p">;</span>
  <span class="p">...</span> <span class="n">Invoke</span><span class="p">(</span><span class="n">done</span><span class="p">)</span> <span class="p">...;</span>  <span class="c1">// This won't compile!
</span><span class="c1"></span>
  <span class="n">Closure</span><span class="o">*</span> <span class="n">done2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BlockingClosure</span><span class="p">;</span>
  <span class="p">...</span> <span class="n">Invoke</span><span class="p">(</span><span class="n">done2</span><span class="p">)</span> <span class="p">...;</span>  <span class="c1">// This works.
</span></pre>
      <p>In <code>InvokeArgument&lt;N&gt;(...)</code>, if an argument needs to be passed by reference,
        wrap it inside <code>std::ref()</code>. For example,</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">InvokeArgument</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">InvokeArgument</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">string</span><span class="p">(</span><span class="s">"Hi"</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">ref</span><span class="p">(</span><span class="n">foo</span><span class="p">))</span>
</pre>
      <p>calls the mock function’s #2 argument, passing to it <code>5</code> and <code>string("Hi")</code> by
        value, and <code>foo</code> by reference.</p>
      <h2 id="default-action">Default Action</h2>
      <table>
        <thead>
          <tr>
            <th align="left">Action</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>DoDefault()</code></td>
            <td align="left">Do the default action (specified by <code>ON_CALL()</code> or the built-in one).</td>
          </tr>
        </tbody>
      </table>
      <p>{: .callout .note}
        <strong>Note:</strong> due to technical reasons, <code>DoDefault()</code> cannot be used inside a
        composite action - trying to do so will result in a run-time error.
      </p>
      <h2 id="composite-actions">Composite Actions</h2>
      <table>
        <thead>
          <tr>
            <th align="left">Action</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>DoAll(a1, a2, ..., an)</code></td>
            <td align="left">Do all actions <code>a1</code> to <code>an</code> and return the result of <code>an</code>
              in each invocation. The first <code>n - 1</code> sub-actions must return void and will receive a readonly
              view of the arguments.</td>
          </tr>
          <tr>
            <td align="left"><code>IgnoreResult(a)</code></td>
            <td align="left">Perform action <code>a</code> and ignore its result. <code>a</code> must not return void.
            </td>
          </tr>
          <tr>
            <td align="left"><code>WithArg&lt;N&gt;(a)</code></td>
            <td align="left">Pass the <code>N</code>-th (0-based) argument of the mock function to action <code>a</code>
              and perform it.</td>
          </tr>
          <tr>
            <td align="left"><code>WithArgs&lt;N1, N2, ..., Nk&gt;(a)</code></td>
            <td align="left">Pass the selected (0-based) arguments of the mock function to action <code>a</code> and
              perform it.</td>
          </tr>
          <tr>
            <td align="left"><code>WithoutArgs(a)</code></td>
            <td align="left">Perform action <code>a</code> without any arguments.</td>
          </tr>
        </tbody>
      </table>
      <h2 id="defining-actions">Defining Actions</h2>
      <table>
        <thead>
          <tr>
            <th align="left">Macro</th>
            <th align="left">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left"><code>ACTION(Sum) { return arg0 + arg1; }</code></td>
            <td align="left">Defines an action <code>Sum()</code> to return the sum of the mock function’s argument #0
              and #1.</td>
          </tr>
          <tr>
            <td align="left"><code>ACTION_P(Plus, n) { return arg0 + n; }</code></td>
            <td align="left">Defines an action <code>Plus(n)</code> to return the sum of the mock function’s argument #0
              and <code>n</code>.</td>
          </tr>
          <tr>
            <td align="left"><code>ACTION_Pk(Foo, p1, ..., pk) { statements; }</code></td>
            <td align="left">Defines a parameterized action <code>Foo(p1, ..., pk)</code> to execute the given
              <code>statements</code>.
            </td>
          </tr>
        </tbody>
      </table>
      <p>The <code>ACTION*</code> macros cannot be used inside a function or class.</p>
      <h1 id="googletest-faq">GoogleTest FAQ</h1>
      <h2 id="why-should-test-suite-names-and-test-names-not-contain-underscore">Why should test suite names and test
        names not contain underscore?</h2>
      <p>{: .callout .note}
        Note: GoogleTest reserves underscore (<code>_</code>) for special-purpose keywords, such as
        <a href="#advanced-googletest-topics#temporarily-disabling-tests">the <code>DISABLED_</code> prefix</a>, in
        addition
        to the following rationale.
      </p>
      <p>Underscore (<code>_</code>) is special, as C++ reserves the following to be used by the
        compiler and the standard library:</p>
      <ol>
        <li>any identifier that starts with an <code>_</code> followed by an upper-case letter, and</li>
        <li>any identifier that contains two consecutive underscores (i.e. <code>__</code>)
          <em>anywhere</em> in its name.
        </li>
      </ol>
      <p>User code is <em>prohibited</em> from using such identifiers.</p>
      <p>Now let’s look at what this means for <code>TEST</code> and <code>TEST_F</code>.</p>
      <p>Currently <code>TEST(TestSuiteName, TestName)</code> generates a class named
        <code>TestSuiteName_TestName_Test</code>. What happens if <code>TestSuiteName</code> or <code>TestName</code>
        contains <code>_</code>?
      </p>
      <ol>
        <li>If <code>TestSuiteName</code> starts with an <code>_</code> followed by an upper-case letter (say,
          <code>_Foo</code>), we end up with <code>_Foo_TestName_Test</code>, which is reserved and thus
          invalid.
        </li>
        <li>If <code>TestSuiteName</code> ends with an <code>_</code> (say, <code>Foo_</code>), we get
          <code>Foo__TestName_Test</code>, which is invalid.
        </li>
        <li>If <code>TestName</code> starts with an <code>_</code> (say, <code>_Bar</code>), we get
          <code>TestSuiteName__Bar_Test</code>, which is invalid.
        </li>
        <li>If <code>TestName</code> ends with an <code>_</code> (say, <code>Bar_</code>), we get
          <code>TestSuiteName_Bar__Test</code>, which is invalid.
        </li>
      </ol>
      <p>So clearly <code>TestSuiteName</code> and <code>TestName</code> cannot start or end with <code>_</code>
        (Actually, <code>TestSuiteName</code> can start with <code>_</code>—as long as the <code>_</code> isn’t followed
        by an upper-case letter. But that’s getting complicated. So for simplicity we
        just say that it cannot start with <code>_</code>.).</p>
      <p>It may seem fine for <code>TestSuiteName</code> and <code>TestName</code> to contain <code>_</code> in the
        middle. However, consider this:</p>
      <pre class="chroma"><span class="n">TEST</span><span class="p">(</span><span class="n">Time</span><span class="p">,</span> <span class="n">Flies_Like_An_Arrow</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">Time_Flies</span><span class="p">,</span> <span class="n">Like_An_Arrow</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre>
      <p>Now, the two <code>TEST</code>s will both generate the same class
        (<code>Time_Flies_Like_An_Arrow_Test</code>). That’s not good.</p>
      <p>So for simplicity, we just ask the users to avoid <code>_</code> in <code>TestSuiteName</code> and
        <code>TestName</code>. The rule is more constraining than necessary, but it’s simple and
        easy to remember. It also gives GoogleTest some wiggle room in case its
        implementation needs to change in the future.
      </p>
      <p>If you violate the rule, there may not be immediate consequences, but your test
        may (just may) break with a new compiler (or a new version of the compiler you
        are using) or with a new version of GoogleTest. Therefore it’s best to follow
        the rule.</p>
      <h2 id="why-does-googletest-support-expect-eqnull-ptr-and-assert-eqnull-ptr-but-not-expect-nenull-ptr-and-assert-nenull-ptr">
        Why does GoogleTest support <code>EXPECT_EQ(NULL, ptr)</code> and <code>ASSERT_EQ(NULL, ptr)</code> but not
        <code>EXPECT_NE(NULL, ptr)</code> and <code>ASSERT_NE(NULL, ptr)</code>?
      </h2>
      <p>First of all, you can use <code>nullptr</code> with each of these macros, e.g.
        <code>EXPECT_EQ(ptr, nullptr)</code>, <code>EXPECT_NE(ptr, nullptr)</code>,
        <code>ASSERT_EQ(ptr, nullptr)</code>,
        <code>ASSERT_NE(ptr, nullptr)</code>. This is the preferred syntax in the style guide
        because <code>nullptr</code> does not have the type problems that <code>NULL</code> does.
      </p>
      <p>Due to some peculiarity of C++, it requires some non-trivial template meta
        programming tricks to support using <code>NULL</code> as an argument of the <code>EXPECT_XX()</code>
        and <code>ASSERT_XX()</code> macros. Therefore we only do it where it’s most needed
        (otherwise we make the implementation of GoogleTest harder to maintain and more
        error-prone than necessary).</p>
      <p>Historically, the <code>EXPECT_EQ()</code> macro took the <em>expected</em> value as its first
        argument and the <em>actual</em> value as the second, though this argument order is now
        discouraged. It was reasonable that someone wanted
        to write <code>EXPECT_EQ(NULL, some_expression)</code>, and this indeed was requested
        several times. Therefore we implemented it.</p>
      <p>The need for <code>EXPECT_NE(NULL, ptr)</code> wasn’t nearly as strong. When the assertion
        fails, you already know that <code>ptr</code> must be <code>NULL</code>, so it doesn’t add any
        information to print <code>ptr</code> in this case. That means <code>EXPECT_TRUE(ptr != NULL)</code>
        works just as well.</p>
      <p>If we were to support <code>EXPECT_NE(NULL, ptr)</code>, for consistency we’d have to
        support <code>EXPECT_NE(ptr, NULL)</code> as well. This means using the template meta
        programming tricks twice in the implementation, making it even harder to
        understand and maintain. We believe the benefit doesn’t justify the cost.</p>
      <p>Finally, with the growth of the gMock matcher library, we are encouraging people
        to use the unified <code>EXPECT_THAT(value, matcher)</code> syntax more often in tests. One
        significant advantage of the matcher approach is that matchers can be easily
        combined to form new matchers, while the <code>EXPECT_NE</code>, etc, macros cannot be
        easily combined. Therefore we want to invest more in the matchers than in the
        <code>EXPECT_XX()</code> macros.
      </p>
      <h2 id="i-need-to-test-that-different-implementations-of-an-interface-satisfy-some-common-requirements-should-i-use-typed-tests-or-value-parameterized-tests">
        I need to test that different implementations of an interface satisfy some common requirements. Should I use
        typed tests or value-parameterized tests?</h2>
      <p>For testing various implementations of the same interface, either typed tests or
        value-parameterized tests can get it done. It’s really up to you the user to
        decide which is more convenient for you, depending on your particular case. Some
        rough guidelines:</p>
      <ul>
        <li>Typed tests can be easier to write if instances of the different
          implementations can be created the same way, modulo the type. For example,
          if all these implementations have a public default constructor (such that
          you can write <code>new TypeParam</code>), or if their factory functions have the same
          form (e.g. <code>CreateInstance&lt;TypeParam&gt;()</code>).</li>
        <li>Value-parameterized tests can be easier to write if you need different code
          patterns to create different implementations' instances, e.g. <code>new Foo</code> vs
          <code>new Bar(5)</code>. To accommodate for the differences, you can write factory
          function wrappers and pass these function pointers to the tests as their
          parameters.
        </li>
        <li>When a typed test fails, the default output includes the name of the type,
          which can help you quickly identify which implementation is wrong.
          Value-parameterized tests only show the number of the failed iteration by
          default. You will need to define a function that returns the iteration name
          and pass it as the third parameter to INSTANTIATE_TEST_SUITE_P to have more
          useful output.</li>
        <li>When using typed tests, you need to make sure you are testing against the
          interface type, not the concrete types (in other words, you want to make
          sure <code>implicit_cast&lt;MyInterface*&gt;(my_concrete_impl)</code> works, not just that
          <code>my_concrete_impl</code> works). It’s less likely to make mistakes in this area
          when using value-parameterized tests.
        </li>
      </ul>
      <p>I hope I didn’t confuse you more. :-) If you don’t mind, I’d suggest you to give
        both approaches a try. Practice is a much better way to grasp the subtle
        differences between the two tools. Once you have some concrete experience, you
        can much more easily decide which one to use the next time.</p>
      <h2 id="my-death-test-modifies-some-state-but-the-change-seems-lost-after-the-death-test-finishes-why">My death
        test modifies some state, but the change seems lost after the death test finishes. Why?</h2>
      <p>Death tests (<code>EXPECT_DEATH</code>, etc.) are executed in a sub-process s.t. the
        expected crash won’t kill the test program (i.e. the parent process). As a
        result, any in-memory side effects they incur are observable in their respective
        sub-processes, but not in the parent process. You can think of them as running
        in a parallel universe, more or less.</p>
      <p>In particular, if you use mocking and the death test statement invokes some mock
        methods, the parent process will think the calls have never occurred. Therefore,
        you may want to move your <code>EXPECT_CALL</code> statements inside the <code>EXPECT_DEATH</code>
        macro.</p>
      <h2 id="expect-eqhtonlblah-blah-blah-generates-weird-compiler-errors-in-opt-mode-is-this-a-googletest-bug">
        EXPECT_EQ(htonl(blah), blah_blah) generates weird compiler errors in opt mode. Is this a GoogleTest bug?</h2>
      <p>Actually, the bug is in <code>htonl()</code>.</p>
      <p>According to <code>'man htonl'</code>, <code>htonl()</code> is a <em>function</em>, which means it’s
        valid to
        use <code>htonl</code> as a function pointer. However, in opt mode <code>htonl()</code> is defined as
        a <em>macro</em>, which breaks this usage.</p>
      <p>Worse, the macro definition of <code>htonl()</code> uses a <code>gcc</code> extension and is <em>not</em>
        standard C++. That hacky implementation has some ad hoc limitations. In
        particular, it prevents you from writing <code>Foo&lt;sizeof(htonl(x))&gt;()</code>, where <code>Foo</code>
        is a template that has an integral argument.</p>
      <p>The implementation of <code>EXPECT_EQ(a, b)</code> uses <code>sizeof(... a ...)</code> inside a
        template argument, and thus doesn’t compile in opt mode when <code>a</code> contains a call
        to <code>htonl()</code>. It is difficult to make <code>EXPECT_EQ</code> bypass the <code>htonl()</code> bug, as
        the solution must work with different compilers on various platforms.</p>
      <h2 id="the-compiler-complains-about-undefined-references-to-some-static-const-member-variables-but-i-did-define-them-in-the-class-body-whats-wrong">
        The compiler complains about “undefined references” to some static const member variables, but I did define them
        in the class body. What’s wrong?</h2>
      <p>If your class has a static data member:</p>
      <pre class="chroma"><span class="c1">// foo.h
</span><span class="c1"></span><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">kBar</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">};</span>
</pre>
      <p>you also need to define it <em>outside</em> of the class body in <code>foo.cc</code>:</p>
      <pre class="chroma"><span class="k">const</span> <span class="kt">int</span> <span class="n">Foo</span><span class="o">::</span><span class="n">kBar</span><span class="p">;</span>  <span class="c1">// No initializer here.
</span></pre>
      <p>Otherwise your code is <strong>invalid C++</strong>, and may break in unexpected ways. In
        particular, using it in GoogleTest comparison assertions (<code>EXPECT_EQ</code>, etc.)
        will generate an “undefined reference” linker error. The fact that “it used to
        work” doesn’t mean it’s valid. It just means that you were lucky. :-)</p>
      <p>If the declaration of the static data member is <code>constexpr</code> then it is
        implicitly an <code>inline</code> definition, and a separate definition in <code>foo.cc</code> is not
        needed:</p>
      <pre class="chroma"><span class="c1">// foo.h
</span><span class="c1"></span><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">int</span> <span class="n">kBar</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>  <span class="c1">// Defines kBar, no need to do it in foo.cc.
</span><span class="c1"></span><span class="p">};</span>
</pre>
      <h2 id="can-i-derive-a-test-fixture-from-another">Can I derive a test fixture from another?</h2>
      <p>Yes.</p>
      <p>Each test fixture has a corresponding and same named test suite. This means only
        one test suite can use a particular fixture. Sometimes, however, multiple test
        cases may want to use the same or slightly different fixtures. For example, you
        may want to make sure that all of a GUI library’s test suites don’t leak
        important system resources like fonts and brushes.</p>
      <p>In GoogleTest, you share a fixture among test suites by putting the shared logic
        in a base test fixture, then deriving from that base a separate fixture for each
        test suite that wants to use this common logic. You then use <code>TEST_F()</code> to write
        tests using each derived fixture.</p>
      <p>Typically, your code looks like this:</p>
      <pre class="chroma"><span class="c1">// Defines a base test fixture.
</span><span class="c1"></span><span class="k">class</span> <span class="nc">BaseTest</span> <span class="o">:</span> <span class="k">public</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
  <span class="p">...</span>
<span class="p">};</span>

<span class="c1">// Derives a fixture FooTest from BaseTest.
</span><span class="c1"></span><span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BaseTest</span> <span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">SetUp</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span>
    <span class="n">BaseTest</span><span class="o">::</span><span class="n">SetUp</span><span class="p">();</span>  <span class="c1">// Sets up the base fixture first.
</span><span class="c1"></span>    <span class="p">...</span> <span class="n">additional</span> <span class="n">set</span><span class="o">-</span><span class="n">up</span> <span class="n">work</span> <span class="p">...</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="nf">TearDown</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span>
    <span class="p">...</span> <span class="n">clean</span><span class="o">-</span><span class="n">up</span> <span class="n">work</span> <span class="k">for</span> <span class="n">FooTest</span> <span class="p">...</span>
    <span class="n">BaseTest</span><span class="o">::</span><span class="n">TearDown</span><span class="p">();</span>  <span class="c1">// Remember to tear down the base fixture
</span><span class="c1"></span>                           <span class="c1">// after cleaning up FooTest!
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="p">...</span> <span class="n">functions</span> <span class="n">and</span> <span class="n">variables</span> <span class="k">for</span> <span class="n">FooTest</span> <span class="p">...</span>
<span class="p">};</span>

<span class="c1">// Tests that use the fixture FooTest.
</span><span class="c1"></span><span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Bar</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Baz</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="p">...</span> <span class="n">additional</span> <span class="n">fixtures</span> <span class="n">derived</span> <span class="n">from</span> <span class="n">BaseTest</span> <span class="p">...</span>
</pre>
      <p>If necessary, you can continue to derive test fixtures from a derived fixture.
        GoogleTest has no limit on how deep the hierarchy can be.</p>
      <p>For a complete example using derived test fixtures, see
        <a href="https://github.com/google/googletest/blob/main/googletest/samples/sample5_unittest.cc">sample5_unittest.cc</a>.
      </p>
      <h2 id="my-compiler-complains-void-value-not-ignored-as-it-ought-to-be-what-does-this-mean">My compiler complains
        “void value not ignored as it ought to be.” What does this mean?</h2>
      <p>You’re probably using an <code>ASSERT_*()</code> in a function that doesn’t return <code>void</code>.
        <code>ASSERT_*()</code> can only be used in <code>void</code> functions, due to exceptions being
        disabled by our build system. Please see more details
        <a href="#advanced-googletest-topics#assertion-placement">here</a>.
      </p>
      <h2 id="my-death-test-hangs-or-seg-faults-how-do-i-fix-it">My death test hangs (or seg-faults). How do I fix it?
      </h2>
      <p>In GoogleTest, death tests are run in a child process and the way they work is
        delicate. To write death tests you really need to understand how they work—see
        the details at <a href="reference/assertions.md#death">Death Assertions</a> in the
        Assertions Reference.</p>
      <p>In particular, death tests don’t like having multiple threads in the parent
        process. So the first thing you can try is to eliminate creating threads outside
        of <code>EXPECT_DEATH()</code>. For example, you may want to use mocks or fake objects
        instead of real ones in your tests.</p>
      <p>Sometimes this is impossible as some library you must use may be creating
        threads before <code>main()</code> is even reached. In this case, you can try to minimize
        the chance of conflicts by either moving as many activities as possible inside
        <code>EXPECT_DEATH()</code> (in the extreme case, you want to move everything inside), or
        leaving as few things as possible in it. Also, you can try to set the death test
        style to <code>"threadsafe"</code>, which is safer but slower, and see if it helps.
      </p>
      <p>If you go with thread-safe death tests, remember that they rerun the test
        program from the beginning in the child process. Therefore make sure your
        program can run side-by-side with itself and is deterministic.</p>
      <p>In the end, this boils down to good concurrent programming. You have to make
        sure that there are no race conditions or deadlocks in your program. No silver
        bullet - sorry!</p>
      <h2 id="should-i-use-the-constructordestructor-of-the-test-fixture-or-setupteardown-ctorvssetup">Should I use the
        constructor/destructor of the test fixture or SetUp()/TearDown()? {#CtorVsSetUp}</h2>
      <p>The first thing to remember is that GoogleTest does <strong>not</strong> reuse the same test
        fixture object across multiple tests. For each <code>TEST_F</code>, GoogleTest will create
        a <strong>fresh</strong> test fixture object, immediately call <code>SetUp()</code>, run the test body,
        call <code>TearDown()</code>, and then delete the test fixture object.</p>
      <p>When you need to write per-test set-up and tear-down logic, you have the choice
        between using the test fixture constructor/destructor or <code>SetUp()</code>/<code>TearDown()</code>.
        The former is usually preferred, as it has the following benefits:</p>
      <ul>
        <li>By initializing a member variable in the constructor, we have the option to
          make it <code>const</code>, which helps prevent accidental changes to its value and
          makes the tests more obviously correct.</li>
        <li>In case we need to subclass the test fixture class, the subclass'
          constructor is guaranteed to call the base class' constructor <em>first</em>, and
          the subclass' destructor is guaranteed to call the base class' destructor
          <em>afterward</em>. With <code>SetUp()/TearDown()</code>, a subclass may make the mistake of
          forgetting to call the base class' <code>SetUp()/TearDown()</code> or call them at the
          wrong time.
        </li>
      </ul>
      <p>You may still want to use <code>SetUp()/TearDown()</code> in the following cases:</p>
      <ul>
        <li>C++ does not allow virtual function calls in constructors and destructors.
          You can call a method declared as virtual, but it will not use dynamic
          dispatch. It will use the definition from the class the constructor of which
          is currently executing. This is because calling a virtual method before the
          derived class constructor has a chance to run is very dangerous - the
          virtual method might operate on uninitialized data. Therefore, if you need
          to call a method that will be overridden in a derived class, you have to use
          <code>SetUp()/TearDown()</code>.
        </li>
        <li>In the body of a constructor (or destructor), it’s not possible to use the
          <code>ASSERT_xx</code> macros. Therefore, if the set-up operation could cause a fatal
          test failure that should prevent the test from running, it’s necessary to
          use <code>abort</code> and abort the whole test
          executable, or to use <code>SetUp()</code> instead of a constructor.
        </li>
        <li>If the tear-down operation could throw an exception, you must use
          <code>TearDown()</code> as opposed to the destructor, as throwing in a destructor leads
          to undefined behavior and usually will kill your program right away. Note
          that many standard libraries (like STL) may throw when exceptions are
          enabled in the compiler. Therefore you should prefer <code>TearDown()</code> if you
          want to write portable tests that work with or without exceptions.
        </li>
        <li>The GoogleTest team is considering making the assertion macros throw on
          platforms where exceptions are enabled (e.g. Windows, Mac OS, and Linux
          client-side), which will eliminate the need for the user to propagate
          failures from a subroutine to its caller. Therefore, you shouldn’t use
          GoogleTest assertions in a destructor if your code could run on such a
          platform.</li>
      </ul>
      <h2 id="the-compiler-complains-no-matching-function-to-call-when-i-use-assert-pred-how-do-i-fix-it">The compiler
        complains “no matching function to call” when I use <code>ASSERT_PRED*</code>. How do I fix it?</h2>
      <p>See details for <a href="reference/assertions.md#EXPECT_PRED"><code>EXPECT_PRED*</code></a> in the
        Assertions Reference.</p>
      <h2 id="my-compiler-complains-about-ignoring-return-value-when-i-call-run-all-tests-why">My compiler complains
        about “ignoring return value” when I call RUN_ALL_TESTS(). Why?</h2>
      <p>Some people had been ignoring the return value of <code>RUN_ALL_TESTS()</code>. That is,
        instead of</p>
      <pre class="chroma">  <span class="k">return</span> <span class="nf">RUN_ALL_TESTS</span><span class="p">();</span>
</pre>
      <p>they write</p>
      <pre class="chroma">  <span class="n">RUN_ALL_TESTS</span><span class="p">();</span>
</pre>
      <p>This is <strong>wrong and dangerous</strong>. The testing services needs to see the return
        value of <code>RUN_ALL_TESTS()</code> in order to determine if a test has passed. If your
        <code>main()</code> function ignores it, your test will be considered successful even if it
        has a GoogleTest assertion failure. Very bad.
      </p>
      <p>We have decided to fix this (thanks to Michael Chastain for the idea). Now, your
        code will no longer be able to ignore <code>RUN_ALL_TESTS()</code> when compiled with
        <code>gcc</code>. If you do so, you’ll get a compiler error.
      </p>
      <p>If you see the compiler complaining about you ignoring the return value of
        <code>RUN_ALL_TESTS()</code>, the fix is simple: just make sure its value is used as the
        return value of <code>main()</code>.
      </p>
      <p>But how could we introduce a change that breaks existing tests? Well, in this
        case, the code was already broken in the first place, so we didn’t break it. :-)</p>
      <h2 id="my-compiler-complains-that-a-constructor-or-destructor-cannot-return-a-value-whats-going-on">My compiler
        complains that a constructor (or destructor) cannot return a value. What’s going on?</h2>
      <p>Due to a peculiarity of C++, in order to support the syntax for streaming
        messages to an <code>ASSERT_*</code>, e.g.</p>
      <pre class="chroma">  <span class="n">ASSERT_EQ</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Foo</span><span class="p">())</span> <span class="o">&lt;&lt;</span> <span class="s">"blah blah"</span> <span class="o">&lt;&lt;</span> <span class="n">foo</span><span class="p">;</span>
</pre>
      <p>we had to give up using <code>ASSERT*</code> and <code>FAIL*</code> (but not <code>EXPECT*</code> and
        <code>ADD_FAILURE*</code>) in constructors and destructors. The workaround is to move the
        content of your constructor/destructor to a private void member function, or
        switch to <code>EXPECT_*()</code> if that works. This
        <a href="#advanced-googletest-topics#assertion-placement">section</a> in the user’s guide explains it.
      </p>
      <h2 id="my-setup-function-is-not-called-why">My SetUp() function is not called. Why?</h2>
      <p>C++ is case-sensitive. Did you spell it as <code>Setup()</code>?</p>
      <p>Similarly, sometimes people spell <code>SetUpTestSuite()</code> as <code>SetupTestSuite()</code> and
        wonder why it’s never called.</p>
      <h2 id="i-have-several-test-suites-which-share-the-same-test-fixture-logic-do-i-have-to-define-a-new-test-fixture-class-for-each-of-them-this-seems-pretty-tedious">
        I have several test suites which share the same test fixture logic; do I have to define a new test fixture class
        for each of them? This seems pretty tedious.</h2>
      <p>You don’t have to. Instead of</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BaseTest</span> <span class="p">{};</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Abc</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Def</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="k">class</span> <span class="nc">BarTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BaseTest</span> <span class="p">{};</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">BarTest</span><span class="p">,</span> <span class="n">Abc</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">BarTest</span><span class="p">,</span> <span class="n">Def</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre>
      <p>you can simply <code>typedef</code> the test fixtures:</p>
      <pre class="chroma"><span class="k">typedef</span> <span class="n">BaseTest</span> <span class="n">FooTest</span><span class="p">;</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Abc</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Def</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="k">typedef</span> <span class="n">BaseTest</span> <span class="n">BarTest</span><span class="p">;</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">BarTest</span><span class="p">,</span> <span class="n">Abc</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">BarTest</span><span class="p">,</span> <span class="n">Def</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre>
      <h2 id="googletest-output-is-buried-in-a-whole-bunch-of-log-messages-what-do-i-do">GoogleTest output is buried in
        a whole bunch of LOG messages. What do I do?</h2>
      <p>The GoogleTest output is meant to be a concise and human-friendly report. If
        your test generates textual output itself, it will mix with the GoogleTest
        output, making it hard to read. However, there is an easy solution to this
        problem.</p>
      <p>Since <code>LOG</code> messages go to stderr, we decided to let GoogleTest output go to
        stdout. This way, you can easily separate the two using redirection. For
        example:</p>
      <pre class="chroma">$ ./my_test &gt; gtest_output.txt
</pre>
      <h2 id="why-should-i-prefer-test-fixtures-over-global-variables">Why should I prefer test fixtures over global
        variables?</h2>
      <p>There are several good reasons:</p>
      <ol>
        <li>It’s likely your test needs to change the states of its global variables.
          This makes it difficult to keep side effects from escaping one test and
          contaminating others, making debugging difficult. By using fixtures, each
          test has a fresh set of variables that’s different (but with the same
          names). Thus, tests are kept independent of each other.</li>
        <li>Global variables pollute the global namespace.</li>
        <li>Test fixtures can be reused via subclassing, which cannot be done easily
          with global variables. This is useful if many test suites have something in
          common.</li>
      </ol>
      <h2 id="what-can-the-statement-argument-in-assert-death-be">What can the statement argument in ASSERT_DEATH() be?
      </h2>
      <p><code>ASSERT_DEATH(statement, matcher)</code> (or any death assertion macro) can be used
        wherever <em><code>statement</code></em> is valid. So basically <em><code>statement</code></em> can be any C++
        statement that makes sense in the current context. In particular, it can
        reference global and/or local variables, and can be:</p>
      <ul>
        <li>a simple function call (often the case),</li>
        <li>a complex expression, or</li>
        <li>a compound statement.</li>
      </ul>
      <p>Some examples are shown here:</p>
      <pre class="chroma"><span class="c1">// A death test can be a simple function call.
</span><span class="c1"></span><span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">FunctionCall</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ASSERT_DEATH</span><span class="p">(</span><span class="n">Xyz</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="s">"Xyz failed"</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Or a complex expression that references variables and functions.
</span><span class="c1"></span><span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">ComplexExpression</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">const</span> <span class="kt">bool</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">();</span>
  <span class="n">ASSERT_DEATH</span><span class="p">((</span><span class="n">c</span> <span class="o">?</span> <span class="n">Func1</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="n">object2</span><span class="p">.</span><span class="n">Method</span><span class="p">(</span><span class="s">"test"</span><span class="p">)),</span>
               <span class="s">"(Func1|Method) failed"</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Death assertions can be used anywhere in a function.  In
</span><span class="c1">// particular, they can be inside a loop.
</span><span class="c1"></span><span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">InsideLoop</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Verifies that Foo(0), Foo(1), ..., and Foo(4) all die.
</span><span class="c1"></span>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">EXPECT_DEATH_M</span><span class="p">(</span><span class="n">Foo</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s">"Foo has </span><span class="se">\\</span><span class="s">d+ errors"</span><span class="p">,</span>
                   <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Message</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"where i is "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// A death assertion can contain a compound statement.
</span><span class="c1"></span><span class="n">TEST</span><span class="p">(</span><span class="n">MyDeathTest</span><span class="p">,</span> <span class="n">CompoundStatement</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Verifies that at lease one of Bar(0), Bar(1), ..., and
</span><span class="c1"></span>  <span class="c1">// Bar(4) dies.
</span><span class="c1"></span>  <span class="n">ASSERT_DEATH</span><span class="p">({</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Bar</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s">"Bar has </span><span class="se">\\</span><span class="s">d+ errors"</span><span class="p">);</span>
<span class="p">}</span>
</pre>
      <h2 id="i-have-a-fixture-class-footest-but-test-ffootest-bar-gives-me-error-no-matching-function-for-call-to-footestfootest-why">
        I have a fixture class <code>FooTest</code>, but <code>TEST_F(FooTest, Bar)</code> gives me error
        <code>"no matching function for call to `FooTest::FooTest()'"</code>. Why?
      </h2>
      <p>GoogleTest needs to be able to create objects of your test fixture class, so it
        must have a default constructor. Normally the compiler will define one for you.
        However, there are cases where you have to define your own:</p>
      <ul>
        <li>If you explicitly declare a non-default constructor for class <code>FooTest</code>
          (<code>DISALLOW_EVIL_CONSTRUCTORS()</code> does this), then you need to define a
          default constructor, even if it would be empty.</li>
        <li>If <code>FooTest</code> has a const non-static data member, then you have to define the
          default constructor <em>and</em> initialize the const member in the initializer
          list of the constructor. (Early versions of <code>gcc</code> doesn’t force you to
          initialize the const member. It’s a bug that has been fixed in <code>gcc 4</code>.)</li>
      </ul>
      <h2 id="why-does-assert-death-complain-about-previous-threads-that-were-already-joined">Why does ASSERT_DEATH
        complain about previous threads that were already joined?</h2>
      <p>With the Linux pthread library, there is no turning back once you cross the line
        from a single thread to multiple threads. The first time you create a thread, a
        manager thread is created in addition, so you get 3, not 2, threads. Later when
        the thread you create joins the main thread, the thread count decrements by 1,
        but the manager thread will never be killed, so you still have 2 threads, which
        means you cannot safely run a death test.</p>
      <p>The new NPTL thread library doesn’t suffer from this problem, as it doesn’t
        create a manager thread. However, if you don’t control which machine your test
        runs on, you shouldn’t depend on this.</p>
      <h2 id="why-does-googletest-require-the-entire-test-suite-instead-of-individual-tests-to-be-named-deathtest-when-it-uses-assert-death">
        Why does GoogleTest require the entire test suite, instead of individual tests, to be named
        <code>*DeathTest</code> when it uses <code>ASSERT_DEATH</code>?
      </h2>
      <p>GoogleTest does not interleave tests from different test suites. That is, it
        runs all tests in one test suite first, and then runs all tests in the next test
        suite, and so on. GoogleTest does this because it needs to set up a test suite
        before the first test in it is run, and tear it down afterwards. Splitting up
        the test case would require multiple set-up and tear-down processes, which is
        inefficient and makes the semantics unclean.</p>
      <p>If we were to determine the order of tests based on test name instead of test
        case name, then we would have a problem with the following situation:</p>
      <pre class="chroma"><span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">AbcDeathTest</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Uvw</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">BarTest</span><span class="p">,</span> <span class="n">DefDeathTest</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">BarTest</span><span class="p">,</span> <span class="n">Xyz</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre>
      <p>Since <code>FooTest.AbcDeathTest</code> needs to run before <code>BarTest.Xyz</code>, and we don’t
        interleave tests from different test suites, we need to run all tests in the
        <code>FooTest</code> case before running any test in the <code>BarTest</code> case. This contradicts
        with the requirement to run <code>BarTest.DefDeathTest</code> before <code>FooTest.Uvw</code>.
      </p>
      <h2 id="but-i-dont-like-calling-my-entire-test-suite-deathtest-when-it-contains-both-death-tests-and-non-death-tests-what-do-i-do">
        But I don’t like calling my entire test suite <code>*DeathTest</code> when it contains both death tests and
        non-death tests. What do I do?</h2>
      <p>You don’t have to, but if you like, you may split up the test suite into
        <code>FooTest</code> and <code>FooDeathTest</code>, where the names make it clear that they are
        related:
      </p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">FooTest</span> <span class="o">:</span> <span class="k">public</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Abc</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooTest</span><span class="p">,</span> <span class="n">Def</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="k">using</span> <span class="n">FooDeathTest</span> <span class="o">=</span> <span class="n">FooTest</span><span class="p">;</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooDeathTest</span><span class="p">,</span> <span class="n">Uvw</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="n">EXPECT_DEATH</span><span class="p">(...)</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">TEST_F</span><span class="p">(</span><span class="n">FooDeathTest</span><span class="p">,</span> <span class="n">Xyz</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="n">ASSERT_DEATH</span><span class="p">(...)</span> <span class="p">...</span> <span class="p">}</span>
</pre>
      <h2 id="googletest-prints-the-log-messages-in-a-death-tests-child-process-only-when-the-test-fails-how-can-i-see-the-log-messages-when-the-death-test-succeeds">
        GoogleTest prints the LOG messages in a death test’s child process only when the test fails. How can I see the
        LOG messages when the death test succeeds?</h2>
      <p>Printing the LOG messages generated by the statement inside <code>EXPECT_DEATH()</code>
        makes it harder to search for real problems in the parent’s log. Therefore,
        GoogleTest only prints them when the death test has failed.</p>
      <p>If you really need to see such LOG messages, a workaround is to temporarily
        break the death test (e.g. by changing the regex pattern it is expected to
        match). Admittedly, this is a hack. We’ll consider a more permanent solution
        after the fork-and-exec-style death tests are implemented.</p>
      <h2 id="the-compiler-complains-about-no-match-for-operator-when-i-use-an-assertion-what-gives">The compiler
        complains about <code>no match for 'operator&lt;&lt;'</code> when I use an assertion. What gives?</h2>
      <p>If you use a user-defined type <code>FooType</code> in an assertion, you must make sure
        there is an <code>std::ostream&amp; operator&lt;&lt;(std::ostream&amp;, const FooType&amp;)</code> function
        defined such that we can print a value of <code>FooType</code>.</p>
      <p>In addition, if <code>FooType</code> is declared in a name space, the <code>&lt;&lt;</code> operator also
        needs to be defined in the <em>same</em> name space. See
        <a href="https://abseil.io/tips/49">Tip of the Week #49</a> for details.
      </p>
      <h2 id="how-do-i-suppress-the-memory-leak-messages-on-windows">How do I suppress the memory leak messages on
        Windows?</h2>
      <p>Since the statically initialized GoogleTest singleton requires allocations on
        the heap, the Visual C++ memory leak detector will report memory leaks at the
        end of the program run. The easiest way to avoid this is to use the
        <code>_CrtMemCheckpoint</code> and <code>_CrtMemDumpAllObjectsSince</code> calls to not report any
        statically initialized heap objects. See MSDN for more details and additional
        heap check/debug routines.
      </p>
      <h2 id="how-can-my-code-detect-if-it-is-running-in-a-test">How can my code detect if it is running in a test?</h2>
      <p>If you write code that sniffs whether it’s running in a test and does different
        things accordingly, you are leaking test-only logic into production code and
        there is no easy way to ensure that the test-only code paths aren’t run by
        mistake in production. Such cleverness also leads to
        <a href="https://en.wikipedia.org/wiki/Heisenbug">Heisenbugs</a>. Therefore we strongly
        advise against the practice, and GoogleTest doesn’t provide a way to do it.
      </p>
      <p>In general, the recommended way to cause the code to behave differently under
        test is <a href="https://en.wikipedia.org/wiki/Dependency_injection">Dependency Injection</a>. You can inject
        different functionality from the test and from the production code. Since your
        production code doesn’t link in the for-test logic at all (the
        <a href="https://docs.bazel.build/versions/master/be/common-definitions.html#common.testonly"><code>testonly</code></a>
        attribute for BUILD targets helps to ensure
        that), there is no danger in accidentally running it.
      </p>
      <p>However, if you <em>really</em>, <em>really</em>, <em>really</em> have no choice, and if you follow
        the rule of ending your test program names with <code>_test</code>, you can use the
        <em>horrible</em> hack of sniffing your executable name (<code>argv[0]</code> in <code>main()</code>) to know
        whether the code is under test.
      </p>
      <h2 id="how-do-i-temporarily-disable-a-test">How do I temporarily disable a test?</h2>
      <p>If you have a broken test that you cannot fix right away, you can add the
        <code>DISABLED_</code> prefix to its name. This will exclude it from execution. This is
        better than commenting out the code or using <code>#if 0</code>, as disabled tests are
        still compiled (and thus won’t rot).
      </p>
      <p>To include disabled tests in test execution, just invoke the test program with
        the <code>--gtest_also_run_disabled_tests</code> flag.</p>
      <h2 id="is-it-ok-if-i-have-two-separate-testfoo-bar-test-methods-defined-in-different-namespaces">Is it OK if I
        have two separate <code>TEST(Foo, Bar)</code> test methods defined in different namespaces?</h2>
      <p>Yes.</p>
      <p>The rule is <strong>all test methods in the same test suite must use the same fixture
          class</strong>. This means that the following is <strong>allowed</strong> because both tests use the
        same fixture class (<code>::testing::Test</code>).</p>
      <pre class="chroma"><span class="k">namespace</span> <span class="n">foo</span> <span class="p">{</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">CoolTest</span><span class="p">,</span> <span class="n">DoSomething</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SUCCEED</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">}</span>  <span class="c1">// namespace foo
</span><span class="c1"></span>
<span class="k">namespace</span> <span class="n">bar</span> <span class="p">{</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">CoolTest</span><span class="p">,</span> <span class="n">DoSomething</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SUCCEED</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">}</span>  <span class="c1">// namespace bar
</span></pre>
      <p>However, the following code is <strong>not allowed</strong> and will produce a runtime error
        from GoogleTest because the test methods are using different test fixture
        classes with the same test suite name.</p>
      <pre class="chroma"><span class="k">namespace</span> <span class="n">foo</span> <span class="p">{</span>
<span class="k">class</span> <span class="nc">CoolTest</span> <span class="o">:</span> <span class="k">public</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{};</span>  <span class="c1">// Fixture foo::CoolTest
</span><span class="c1"></span><span class="n">TEST_F</span><span class="p">(</span><span class="n">CoolTest</span><span class="p">,</span> <span class="n">DoSomething</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SUCCEED</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">}</span>  <span class="c1">// namespace foo
</span><span class="c1"></span>
<span class="k">namespace</span> <span class="n">bar</span> <span class="p">{</span>
<span class="k">class</span> <span class="nc">CoolTest</span> <span class="o">:</span> <span class="k">public</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{};</span>  <span class="c1">// Fixture: bar::CoolTest
</span><span class="c1"></span><span class="n">TEST_F</span><span class="p">(</span><span class="n">CoolTest</span><span class="p">,</span> <span class="n">DoSomething</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SUCCEED</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">}</span>  <span class="c1">// namespace bar
</span></pre>
      <h1 id="legacy-gmock-faq">Legacy gMock FAQ</h1>
      <h3 id="when-i-call-a-method-on-my-mock-object-the-method-for-the-real-object-is-invoked-instead-whats-the-problem">
        When I call a method on my mock object, the method for the real object is invoked instead. What’s the problem?
      </h3>
      <p>In order for a method to be mocked, it must be <em>virtual</em>, unless you use the
        <a href="#gmock-cookbook#MockingNonVirtualMethods">high-perf dependency injection technique</a>.
      </p>
      <h3 id="can-i-mock-a-variadic-function">Can I mock a variadic function?</h3>
      <p>You cannot mock a variadic function (i.e. a function taking ellipsis (<code>...</code>)
        arguments) directly in gMock.</p>
      <p>The problem is that in general, there is <em>no way</em> for a mock object to know how
        many arguments are passed to the variadic method, and what the arguments' types
        are. Only the <em>author of the base class</em> knows the protocol, and we cannot look
        into his or her head.</p>
      <p>Therefore, to mock such a function, the <em>user</em> must teach the mock object how to
        figure out the number of arguments and their types. One way to do it is to
        provide overloaded versions of the function.</p>
      <p>Ellipsis arguments are inherited from C and not really a C++ feature. They are
        unsafe to use and don’t work with arguments that have constructors or
        destructors. Therefore we recommend to avoid them in C++ as much as possible.</p>
      <h3 id="msvc-gives-me-warning-c4301-or-c4373-when-i-define-a-mock-method-with-a-const-parameter-why">MSVC gives me
        warning C4301 or C4373 when I define a mock method with a const parameter. Why?</h3>
      <p>If you compile this using Microsoft Visual C++ 2005 SP1:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">Bar</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">MockFoo</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Foo</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Bar</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">i</span><span class="p">),</span> <span class="p">(</span><span class="k">override</span><span class="p">));</span>
<span class="p">};</span>
</pre>
      <p>You may get the following warning:</p>
      <pre class="chroma">warning C4301: <span class="s1">'MockFoo::Bar'</span>: overriding virtual <span class="k">function</span> only differs from <span class="s1">'Foo::Bar'</span> by const/volatile qualifier
</pre>
      <p>This is a MSVC bug. The same code compiles fine with gcc, for example. If you
        use Visual C++ 2008 SP1, you would get the warning:</p>
      <pre class="chroma">warning C4373: <span class="s1">'MockFoo::Bar'</span>: virtual <span class="k">function</span> overrides <span class="s1">'Foo::Bar'</span>, previous versions of the compiler did not override when parameters only differed by const/volatile qualifiers
</pre>
      <p>In C++, if you <em>declare</em> a function with a <code>const</code> parameter, the <code>const</code>
        modifier is ignored. Therefore, the <code>Foo</code> base class above is equivalent to:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">Bar</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// int or const int?  Makes no difference.
</span><span class="c1"></span><span class="p">};</span>
</pre>
      <p>In fact, you can <em>declare</em> <code>Bar()</code> with an <code>int</code> parameter, and define it with a
        <code>const int</code> parameter. The compiler will still match them up.
      </p>
      <p>Since making a parameter <code>const</code> is meaningless in the method declaration, we
        recommend to remove it in both <code>Foo</code> and <code>MockFoo</code>. That should workaround the
        VC bug.</p>
      <p>Note that we are talking about the <em>top-level</em> <code>const</code> modifier here. If the
        function parameter is passed by pointer or reference, declaring the pointee or
        referee as <code>const</code> is still meaningful. For example, the following two
        declarations are <em>not</em> equivalent:</p>
      <pre class="chroma"><span class="kt">void</span> <span class="nf">Bar</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">p</span><span class="p">);</span>         <span class="c1">// Neither p nor *p is const.
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">Bar</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span><span class="o">*</span> <span class="n">p</span><span class="p">);</span>  <span class="c1">// p is not const, but *p is.
</span></pre>
      <h3 id="i-cant-figure-out-why-gmock-thinks-my-expectations-are-not-satisfied-what-should-i-do">I can’t figure out
        why gMock thinks my expectations are not satisfied. What should I do?</h3>
      <p>You might want to run your test with <code>--gmock_verbose=info</code>. This flag lets
        gMock print a trace of every mock function call it receives. By studying the
        trace, you’ll gain insights on why the expectations you set are not met.</p>
      <p>If you see the message “The mock function has no default action set, and its
        return type has no default value set.”, then try
        <a href="#gmock-cheat-sheet#OnCall">adding a default action</a>. Due to a known issue,
        unexpected calls on mocks without default actions don’t print out a detailed
        comparison between the actual arguments and the expected arguments.
      </p>
      <h3 id="my-program-crashed-and-scopedmocklog-spit-out-tons-of-messages-is-it-a-gmock-bug">My program crashed and
        <code>ScopedMockLog</code> spit out tons of messages. Is it a gMock bug?
      </h3>
      <p>gMock and <code>ScopedMockLog</code> are likely doing the right thing here.</p>
      <p>When a test crashes, the failure signal handler will try to log a lot of
        information (the stack trace, and the address map, for example). The messages
        are compounded if you have many threads with depth stacks. When <code>ScopedMockLog</code>
        intercepts these messages and finds that they don’t match any expectations, it
        prints an error for each of them.</p>
      <p>You can learn to ignore the errors, or you can rewrite your expectations to make
        your test more robust, for example, by adding something like:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">AnyNumber</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Not</span><span class="p">;</span>
<span class="p">...</span>
  <span class="c1">// Ignores any log not done by us.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">Log</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">Not</span><span class="p">(</span><span class="n">EndsWith</span><span class="p">(</span><span class="s">"/my_file.cc"</span><span class="p">)),</span> <span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">AnyNumber</span><span class="p">());</span>
</pre>
      <h3 id="how-can-i-assert-that-a-function-is-never-called">How can I assert that a function is NEVER called?</h3>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</pre>
      <h3 id="i-have-a-failed-test-where-gmock-tells-me-twice-that-a-particular-expectation-is-not-satisfied-isnt-this-redundant">
        I have a failed test where gMock tells me TWICE that a particular expectation is not satisfied. Isn’t this
        redundant?</h3>
      <p>When gMock detects a failure, it prints relevant information (the mock function
        arguments, the state of relevant expectations, and etc) to help the user debug.
        If another failure is detected, gMock will do the same, including printing the
        state of relevant expectations.</p>
      <p>Sometimes an expectation’s state didn’t change between two failures, and you’ll
        see the same description of the state twice. They are however <em>not</em> redundant,
        as they refer to <em>different points in time</em>. The fact they are the same <em>is</em>
        interesting information.</p>
      <h3 id="i-get-a-heapcheck-failure-when-using-a-mock-object-but-using-a-real-object-is-fine-what-can-be-wrong">I
        get a heapcheck failure when using a mock object, but using a real object is fine. What can be wrong?</h3>
      <p>Does the class (hopefully a pure interface) you are mocking have a virtual
        destructor?</p>
      <p>Whenever you derive from a base class, make sure its destructor is virtual.
        Otherwise Bad Things will happen. Consider the following code:</p>
      <pre class="chroma"><span class="k">class</span> <span class="nc">Base</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="c1">// Not virtual, but should be.
</span><span class="c1"></span>  <span class="o">~</span><span class="n">Base</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
  <span class="p">...</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Derived</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Base</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="p">...</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">value_</span><span class="p">;</span>
<span class="p">};</span>

<span class="p">...</span>
  <span class="n">Base</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Derived</span><span class="p">;</span>
  <span class="p">...</span>
  <span class="k">delete</span> <span class="n">p</span><span class="p">;</span>  <span class="c1">// Surprise! ~Base() will be called, but ~Derived() will not
</span><span class="c1"></span>                 <span class="c1">// - value_ is leaked.
</span></pre>
      <p>By changing <code>~Base()</code> to virtual, <code>~Derived()</code> will be correctly called when
        <code>delete p</code> is executed, and the heap checker will be happy.
      </p>
      <h3 id="the-newer-expectations-override-older-ones-rule-makes-writing-expectations-awkward-why-does-gmock-do-that">
        The “newer expectations override older ones” rule makes writing expectations awkward. Why does gMock do that?
      </h3>
      <p>When people complain about this, often they are referring to code like:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
  <span class="c1">// foo.Bar() should be called twice, return 1 the first time, and return
</span><span class="c1"></span>  <span class="c1">// 2 the second time.  However, I have to write the expectations in the
</span><span class="c1"></span>  <span class="c1">// reverse order.  This sucks big time!!!
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">())</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
      <span class="p">.</span><span class="n">RetiresOnSaturation</span><span class="p">();</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">())</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
      <span class="p">.</span><span class="n">RetiresOnSaturation</span><span class="p">();</span>
</pre>
      <p>The problem, is that they didn’t pick the <strong>best</strong> way to express the test’s
        intent.</p>
      <p>By default, expectations don’t have to be matched in <em>any</em> particular order. If
        you want them to match in a certain order, you need to be explicit. This is
        gMock’s (and jMock’s) fundamental philosophy: it’s easy to accidentally
        over-specify your tests, and we want to make it harder to do so.</p>
      <p>There are two better ways to write the test spec. You could either put the
        expectations in sequence:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
  <span class="c1">// foo.Bar() should be called twice, return 1 the first time, and return
</span><span class="c1"></span>  <span class="c1">// 2 the second time.  Using a sequence, we can write the expectations
</span><span class="c1"></span>  <span class="c1">// in their natural order.
</span><span class="c1"></span>  <span class="p">{</span>
    <span class="n">InSequence</span> <span class="n">s</span><span class="p">;</span>
    <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">())</span>
        <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="p">.</span><span class="n">RetiresOnSaturation</span><span class="p">();</span>
    <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">())</span>
        <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="p">.</span><span class="n">RetiresOnSaturation</span><span class="p">();</span>
  <span class="p">}</span>
</pre>
      <p>or you can put the sequence of actions in the same expectation:</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Return</span><span class="p">;</span>
<span class="p">...</span>
  <span class="c1">// foo.Bar() should be called twice, return 1 the first time, and return
</span><span class="c1"></span>  <span class="c1">// 2 the second time.
</span><span class="c1"></span>  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">())</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
      <span class="p">.</span><span class="n">RetiresOnSaturation</span><span class="p">();</span>
</pre>
      <p>Back to the original questions: why does gMock search the expectations (and
        <code>ON_CALL</code>s) from back to front? Because this allows a user to set up a mock’s
        behavior for the common case early (e.g. in the mock’s constructor or the test
        fixture’s set-up phase) and customize it with more specific rules later. If
        gMock searches from front to back, this very useful pattern won’t be possible.
      </p>
      <h3 id="gmock-prints-a-warning-when-a-function-without-expect-call-is-called-even-if-i-have-set-its-behavior-using-on-call-would-it-be-reasonable-not-to-show-the-warning-in-this-case">
        gMock prints a warning when a function without EXPECT_CALL is called, even if I have set its behavior using
        ON_CALL. Would it be reasonable not to show the warning in this case?</h3>
      <p>When choosing between being neat and being safe, we lean toward the latter. So
        the answer is that we think it’s better to show the warning.</p>
      <p>Often people write <code>ON_CALL</code>s in the mock object’s constructor or <code>SetUp()</code>, as
        the default behavior rarely changes from test to test. Then in the test body
        they set the expectations, which are often different for each test. Having an
        <code>ON_CALL</code> in the set-up part of a test doesn’t mean that the calls are expected.
        If there’s no <code>EXPECT_CALL</code> and the method is called, it’s possibly an error. If
        we quietly let the call go through without notifying the user, bugs may creep in
        unnoticed.
      </p>
      <p>If, however, you are sure that the calls are OK, you can write</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillRepeatedly</span><span class="p">(...);</span>
</pre>
      <p>instead of</p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="p">...</span>
  <span class="n">ON_CALL</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillByDefault</span><span class="p">(...);</span>
</pre>
      <p>This tells gMock that you do expect the calls and no warning should be printed.</p>
      <p>Also, you can control the verbosity by specifying <code>--gmock_verbose=error</code>. Other
        values are <code>info</code> and <code>warning</code>. If you find the output too noisy when
        debugging, just choose a less verbose level.</p>
      <h3 id="how-can-i-delete-the-mock-functions-argument-in-an-action">How can I delete the mock function’s argument
        in an action?</h3>
      <p>If your mock function takes a pointer argument and you want to delete that
        argument, you can use testing::DeleteArg<n>() to delete the N’th (zero-indexed)
          argument:</n>
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
  <span class="p">...</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Bar</span><span class="p">,</span> <span class="p">(</span><span class="n">X</span><span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="n">Y</span><span class="o">&amp;</span> <span class="n">y</span><span class="p">));</span>
  <span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_foo_</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">testing</span><span class="o">::</span><span class="n">DeleteArg</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">()));</span>
</pre>
      <h3 id="how-can-i-perform-an-arbitrary-action-on-a-mock-functions-argument">How can I perform an arbitrary action
        on a mock function’s argument?</h3>
      <p>If you find yourself needing to perform some action that’s not supported by
        gMock directly, remember that you can define your own actions using
        <a href="#NewMonoActions"><code>MakeAction()</code></a> or
        <a href="#NewPolyActions"><code>MakePolymorphicAction()</code></a>, or you can write a stub function
        and invoke it using <a href="#FunctionsAsActions"><code>Invoke()</code></a>.
      </p>
      <pre class="chroma"><span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">_</span><span class="p">;</span>
<span class="k">using</span> <span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Invoke</span><span class="p">;</span>
  <span class="p">...</span>
  <span class="n">MOCK_METHOD</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">Bar</span><span class="p">,</span> <span class="p">(</span><span class="n">X</span><span class="o">*</span> <span class="n">p</span><span class="p">));</span>
  <span class="p">...</span>
  <span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">mock_foo_</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="n">_</span><span class="p">))</span>
      <span class="p">.</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Invoke</span><span class="p">(</span><span class="n">MyAction</span><span class="p">(...)));</span>
</pre>
      <h3 id="my-code-calls-a-staticglobal-function-can-i-mock-it">My code calls a static/global function. Can I mock
        it?</h3>
      <p>You can, but you need to make some changes.</p>
      <p>In general, if you find yourself needing to mock a static function, it’s a sign
        that your modules are too tightly coupled (and less flexible, less reusable,
        less testable, etc). You are probably better off defining a small interface and
        call the function through that interface, which then can be easily mocked. It’s
        a bit of work initially, but usually pays for itself quickly.</p>
      <p>This Google Testing Blog
        <a href="https://testing.googleblog.com/2008/06/defeat-static-cling.html">post</a> says it
        excellently. Check it out.
      </p>
      <h3 id="my-mock-object-needs-to-do-complex-stuff-its-a-lot-of-pain-to-specify-the-actions-gmock-sucks">My mock
        object needs to do complex stuff. It’s a lot of pain to specify the actions. gMock sucks!</h3>
      <p>I know it’s not a question, but you get an answer for free any way. :-)</p>
      <p>With gMock, you can create mocks in C++ easily. And people might be tempted to
        use them everywhere. Sometimes they work great, and sometimes you may find them,
        well, a pain to use. So, what’s wrong in the latter case?</p>
      <p>When you write a test without using mocks, you exercise the code and assert that
        it returns the correct value or that the system is in an expected state. This is
        sometimes called “state-based testing”.</p>
      <p>Mocks are great for what some call “interaction-based” testing: instead of
        checking the system state at the very end, mock objects verify that they are
        invoked the right way and report an error as soon as it arises, giving you a
        handle on the precise context in which the error was triggered. This is often
        more effective and economical to do than state-based testing.</p>
      <p>If you are doing state-based testing and using a test double just to simulate
        the real object, you are probably better off using a fake. Using a mock in this
        case causes pain, as it’s not a strong point for mocks to perform complex
        actions. If you experience this and think that mocks suck, you are just not
        using the right tool for your problem. Or, you might be trying to solve the
        wrong problem. :-)</p>
      <h3 id="i-got-a-warning-uninteresting-function-call-encountered---default-action-taken-should-i-panic">I got a
        warning “Uninteresting function call encountered - default action taken..” Should I panic?</h3>
      <p>By all means, NO! It’s just an FYI. :-)</p>
      <p>What it means is that you have a mock function, you haven’t set any expectations
        on it (by gMock’s rule this means that you are not interested in calls to this
        function and therefore it can be called any number of times), and it is called.
        That’s OK - you didn’t say it’s not OK to call the function!</p>
      <p>What if you actually meant to disallow this function to be called, but forgot to
        write <code>EXPECT_CALL(foo, Bar()).Times(0)</code>? While one can argue that it’s the
        user’s fault, gMock tries to be nice and prints you a note.</p>
      <p>So, when you see the message and believe that there shouldn’t be any
        uninteresting calls, you should investigate what’s going on. To make your life
        easier, gMock dumps the stack trace when an uninteresting call is encountered.
        From that you can figure out which mock function it is, and how it is called.</p>
      <h3 id="i-want-to-define-a-custom-action-should-i-use-invoke-or-implement-the-actioninterface-interface">I want to
        define a custom action. Should I use Invoke() or implement the ActionInterface interface?</h3>
      <p>Either way is fine - you want to choose the one that’s more convenient for your
        circumstance.</p>
      <p>Usually, if your action is for a particular function type, defining it using
        <code>Invoke()</code> should be easier; if your action can be used in functions of
        different types (e.g. if you are defining <code>Return(*value*)</code>),
        <code>MakePolymorphicAction()</code> is easiest. Sometimes you want precise control on what
        types of functions the action can be used in, and implementing <code>ActionInterface</code>
        is the way to go here. See the implementation of <code>Return()</code> in <code>gmock-actions.h</code>
        for an example.
      </p>
      <h3 id="i-use-setargpointee-in-willonce-but-gcc-complains-about-conflicting-return-type-specified-what-does-it-mean">
        I use SetArgPointee() in WillOnce(), but gcc complains about “conflicting return type specified”. What does it
        mean?</h3>
      <p>You got this error as gMock has no idea what value it should return when the
        mock method is called. <code>SetArgPointee()</code> says what the side effect is, but
        doesn’t say what the return value should be. You need <code>DoAll()</code> to chain a
        <code>SetArgPointee()</code> with a <code>Return()</code> that provides a value appropriate to the API
        being mocked.
      </p>
      <p>See this <a href="#gmock-cookbook#mocking-side-effects">recipe</a> for more details and
        an example.</p>
      <h3 id="i-have-a-huge-mock-class-and-microsoft-visual-c-runs-out-of-memory-when-compiling-it-what-can-i-do">I have
        a huge mock class, and Microsoft Visual C++ runs out of memory when compiling it. What can I do?</h3>
      <p>We’ve noticed that when the <code>/clr</code> compiler flag is used, Visual C++ uses 5~6
        times as much memory when compiling a mock class. We suggest to avoid <code>/clr</code>
        when compiling native C++ mocks.</p>
      <h1 id="googletest-samples">Googletest Samples</h1>
      <p>If you’re like us, you’d like to look at
        <a href="https://github.com/google/googletest/blob/main/googletest/samples">googletest samples.</a>
        The sample directory has a number of well-commented samples showing how to use a
        variety of googletest features.
      </p>
      <ul>
        <li>Sample #1 shows the basic steps of using googletest to test C++ functions.</li>
        <li>Sample #2 shows a more complex unit test for a class with multiple member
          functions.</li>
        <li>Sample #3 uses a test fixture.</li>
        <li>Sample #4 teaches you how to use googletest and <code>googletest.h</code> together to
          get the best of both libraries.</li>
        <li>Sample #5 puts shared testing logic in a base test fixture, and reuses it in
          derived fixtures.</li>
        <li>Sample #6 demonstrates type-parameterized tests.</li>
        <li>Sample #7 teaches the basics of value-parameterized tests.</li>
        <li>Sample #8 shows using <code>Combine()</code> in value-parameterized tests.</li>
        <li>Sample #9 shows use of the listener API to modify Google Test’s console
          output and the use of its reflection API to inspect test results.</li>
        <li>Sample #10 shows use of the listener API to implement a primitive memory
          leak checker.</li>
      </ul>
      <h2 id="using-googletest-from-various-build-systems">Using GoogleTest from various build systems</h2>
      <p>GoogleTest comes with pkg-config files that can be used to determine all
        necessary flags for compiling and linking to GoogleTest (and GoogleMock).
        Pkg-config is a standardised plain-text format containing</p>
      <ul>
        <li>the includedir (-I) path</li>
        <li>necessary macro (-D) definitions</li>
        <li>further required flags (-pthread)</li>
        <li>the library (-L) path</li>
        <li>the library (-l) to link to</li>
      </ul>
      <p>All current build systems support pkg-config in one way or another. For all
        examples here we assume you want to compile the sample
        <code>samples/sample3_unittest.cc</code>.
      </p>
      <h3 id="cmake">CMake</h3>
      <p>Using <code>pkg-config</code> in CMake is fairly easy:</p>
      <pre class="chroma"><span class="nb">find_package</span><span class="p">(</span><span class="s">PkgConfig</span><span class="p">)</span><span class="err">
</span><span class="err"></span><span class="nb">pkg_search_module</span><span class="p">(</span><span class="s">GTEST</span> <span class="s">REQUIRED</span> <span class="s">gtest_main</span><span class="p">)</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">add_executable</span><span class="p">(</span><span class="s">testapp</span><span class="p">)</span><span class="err">
</span><span class="err"></span><span class="nb">target_sources</span><span class="p">(</span><span class="s">testapp</span> <span class="s">PRIVATE</span> <span class="s">samples/sample3_unittest.cc</span><span class="p">)</span><span class="err">
</span><span class="err"></span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">testapp</span> <span class="s">PRIVATE</span> <span class="o">${</span><span class="nv">GTEST_LDFLAGS</span><span class="o">}</span><span class="p">)</span><span class="err">
</span><span class="err"></span><span class="nb">target_compile_options</span><span class="p">(</span><span class="s">testapp</span> <span class="s">PRIVATE</span> <span class="o">${</span><span class="nv">GTEST_CFLAGS</span><span class="o">}</span><span class="p">)</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">enable_testing</span><span class="p">()</span><span class="err">
</span><span class="err"></span><span class="nb">add_test</span><span class="p">(</span><span class="s">first_and_only_test</span> <span class="s">testapp</span><span class="p">)</span><span class="err">
</span></pre>
      <p>It is generally recommended that you use <code>target_compile_options</code> + <code>_CFLAGS</code>
        over <code>target_include_directories</code> + <code>_INCLUDE_DIRS</code> as the former includes not
        just -I flags (GoogleTest might require a macro indicating to internal headers
        that all libraries have been compiled with threading enabled. In addition,
        GoogleTest might also require <code>-pthread</code> in the compiling step, and as such
        splitting the pkg-config <code>Cflags</code> variable into include dirs and macros for
        <code>target_compile_definitions()</code> might still miss this). The same recommendation
        goes for using <code>_LDFLAGS</code> over the more commonplace <code>_LIBRARIES</code>, which happens
        to discard <code>-L</code> flags and <code>-pthread</code>.
      </p>
      <h3 id="help-pkg-config-cant-find-googletest">Help! pkg-config can’t find GoogleTest!</h3>
      <p>Let’s say you have a <code>CMakeLists.txt</code> along the lines of the one in this
        tutorial and you try to run <code>cmake</code>. It is very possible that you get a failure
        along the lines of:</p>
      <pre><code>-- Checking for one of the modules 'gtest_main'
CMake Error at /usr/share/cmake/Modules/FindPkgConfig.cmake:640 (message):
  None of the required 'gtest_main' found
</code></pre>
      <p>These failures are common if you installed GoogleTest yourself and have not
        sourced it from a distro or other package manager. If so, you need to tell
        pkg-config where it can find the <code>.pc</code> files containing the information. Say you
        installed GoogleTest to <code>/usr/local</code>, then it might be that the <code>.pc</code> files are
        installed under <code>/usr/local/lib64/pkgconfig</code>. If you set</p>
      <pre><code>export PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig
</code></pre>
      <p>pkg-config will also try to look in <code>PKG_CONFIG_PATH</code> to find <code>gtest_main.pc</code>.</p>
      <h3 id="using-pkg-config-in-a-cross-compilation-setting">Using pkg-config in a cross-compilation setting</h3>
      <p>Pkg-config can be used in a cross-compilation setting too. To do this, let’s
        assume the final prefix of the cross-compiled installation will be <code>/usr</code>, and
        your sysroot is <code>/home/MYUSER/sysroot</code>. Configure and install GTest using</p>
      <pre><code>mkdir build &amp;&amp; cmake -DCMAKE_INSTALL_PREFIX=/usr ..
</code></pre>
      <p>Install into the sysroot using <code>DESTDIR</code>:</p>
      <pre><code>make -j install DESTDIR=/home/MYUSER/sysroot
</code></pre>
      <p>Before we continue, it is recommended to <strong>always</strong> define the following two
        variables for pkg-config in a cross-compilation setting:</p>
      <pre><code>export PKG_CONFIG_ALLOW_SYSTEM_CFLAGS=yes
export PKG_CONFIG_ALLOW_SYSTEM_LIBS=yes
</code></pre>
      <p>otherwise <code>pkg-config</code> will filter <code>-I</code> and <code>-L</code> flags against standard
        prefixes
        such as <code>/usr</code> (see <a href="https://bugs.freedesktop.org/show_bug.cgi?id=28264#c3">https://bugs.freedesktop.org/show_bug.cgi?id=28264#c3</a>
        for
        reasons why this stripping needs to occur usually).</p>
      <p>If you look at the generated pkg-config file, it will look something like</p>
      <pre><code>libdir=/usr/lib64
includedir=/usr/include

Name: gtest
Description: GoogleTest (without main() function)
Version: 1.11.0
URL: https://github.com/google/googletest
Libs: -L${libdir} -lgtest -lpthread
Cflags: -I${includedir} -DGTEST_HAS_PTHREAD=1 -lpthread
</code></pre>
      <p>Notice that the sysroot is not included in <code>libdir</code> and <code>includedir</code>! If you try
        to run <code>pkg-config</code> with the correct
        <code>PKG_CONFIG_LIBDIR=/home/MYUSER/sysroot/usr/lib64/pkgconfig</code> against this <code>.pc</code>
        file, you will get
      </p>
      <pre><code>$ pkg-config --cflags gtest
-DGTEST_HAS_PTHREAD=1 -lpthread -I/usr/include
$ pkg-config --libs gtest
-L/usr/lib64 -lgtest -lpthread
</code></pre>
      <p>which is obviously wrong and points to the <code>CBUILD</code> and not <code>CHOST</code> root. In
        order to use this in a cross-compilation setting, we need to tell pkg-config to
        inject the actual sysroot into <code>-I</code> and <code>-L</code> variables. Let us now tell
        pkg-config about the actual sysroot</p>
      <pre><code>export PKG_CONFIG_DIR=
export PKG_CONFIG_SYSROOT_DIR=/home/MYUSER/sysroot
export PKG_CONFIG_LIBDIR=${PKG_CONFIG_SYSROOT_DIR}/usr/lib64/pkgconfig
</code></pre>
      <p>and running <code>pkg-config</code> again we get</p>
      <pre><code>$ pkg-config --cflags gtest
-DGTEST_HAS_PTHREAD=1 -lpthread -I/home/MYUSER/sysroot/usr/include
$ pkg-config --libs gtest
-L/home/MYUSER/sysroot/usr/lib64 -lgtest -lpthread
</code></pre>
      <p>which contains the correct sysroot now. For a more comprehensive guide to also
        including <code>${CHOST}</code> in build system calls, see the excellent tutorial by Diego
        Elio Pettenò: <a href="https://autotools.io/pkgconfig/cross-compiling.html">https://autotools.io/pkgconfig/cross-compiling.html</a>
      </p>
      <h1 id="community-created-documentation">Community-Created Documentation</h1>
      <p>The following is a list, in no particular order, of links to documentation
        created by the Googletest community.</p>
      <ul>
        <li><a href="https://github.com/ElectricRCAircraftGuy/eRCaGuy_dotfiles/blob/master/googletest/insights.md">Googlemock
            Insights</a>,
          by <a href="https://github.com/ElectricRCAircraftGuy">ElectricRCAircraftGuy</a></li>
      </ul>

    </div>
  </div>
  </div>



<script id="res-script" src="/res/dist/res/main.js" type="text/javascript"></script>
</body></html>
